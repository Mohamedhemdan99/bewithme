var P3=r=>{throw TypeError(r)};var Ob=(r,i,a)=>i.has(r)||P3("Cannot "+a);var De=(r,i,a)=>(Ob(r,i,"read from private field"),a?a.call(r):i.get(r)),An=(r,i,a)=>i.has(r)?P3("Cannot add the same private member more than once"):i instanceof WeakSet?i.add(r):i.set(r,a),Zt=(r,i,a,l)=>(Ob(r,i,"write to private field"),l?l.call(r,a):i.set(r,a),a),Ti=(r,i,a)=>(Ob(r,i,"access private method"),a);var Bv=(r,i,a,l)=>({set _(u){Zt(r,i,u,a)},get _(){return De(r,i,l)}});function Ice(r,i){for(var a=0;a<i.length;a++){const l=i[a];if(typeof l!="string"&&!Array.isArray(l)){for(const u in l)if(u!=="default"&&!(u in r)){const f=Object.getOwnPropertyDescriptor(l,u);f&&Object.defineProperty(r,u,f.get?f:{enumerable:!0,get:()=>l[u]})}}}return Object.freeze(Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}))}(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const u of document.querySelectorAll('link[rel="modulepreload"]'))l(u);new MutationObserver(u=>{for(const f of u)if(f.type==="childList")for(const _ of f.addedNodes)_.tagName==="LINK"&&_.rel==="modulepreload"&&l(_)}).observe(document,{childList:!0,subtree:!0});function a(u){const f={};return u.integrity&&(f.integrity=u.integrity),u.referrerPolicy&&(f.referrerPolicy=u.referrerPolicy),u.crossOrigin==="use-credentials"?f.credentials="include":u.crossOrigin==="anonymous"?f.credentials="omit":f.credentials="same-origin",f}function l(u){if(u.ep)return;u.ep=!0;const f=a(u);fetch(u.href,f)}})();var Wv=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function KA(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var g6={exports:{}},NS={},_6={exports:{}},ln={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var kg=Symbol.for("react.element"),Ace=Symbol.for("react.portal"),Nce=Symbol.for("react.fragment"),Oce=Symbol.for("react.strict_mode"),Pce=Symbol.for("react.profiler"),Dce=Symbol.for("react.provider"),kce=Symbol.for("react.context"),xce=Symbol.for("react.forward_ref"),Lce=Symbol.for("react.suspense"),Mce=Symbol.for("react.memo"),Uce=Symbol.for("react.lazy"),D3=Symbol.iterator;function jce(r){return r===null||typeof r!="object"?null:(r=D3&&r[D3]||r["@@iterator"],typeof r=="function"?r:null)}var E6={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},v6=Object.assign,y6={};function Op(r,i,a){this.props=r,this.context=i,this.refs=y6,this.updater=a||E6}Op.prototype.isReactComponent={};Op.prototype.setState=function(r,i){if(typeof r!="object"&&typeof r!="function"&&r!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,r,i,"setState")};Op.prototype.forceUpdate=function(r){this.updater.enqueueForceUpdate(this,r,"forceUpdate")};function S6(){}S6.prototype=Op.prototype;function YA(r,i,a){this.props=r,this.context=i,this.refs=y6,this.updater=a||E6}var qA=YA.prototype=new S6;qA.constructor=YA;v6(qA,Op.prototype);qA.isPureReactComponent=!0;var k3=Array.isArray,T6=Object.prototype.hasOwnProperty,XA={current:null},w6={key:!0,ref:!0,__self:!0,__source:!0};function R6(r,i,a){var l,u={},f=null,_=null;if(i!=null)for(l in i.ref!==void 0&&(_=i.ref),i.key!==void 0&&(f=""+i.key),i)T6.call(i,l)&&!w6.hasOwnProperty(l)&&(u[l]=i[l]);var v=arguments.length-2;if(v===1)u.children=a;else if(1<v){for(var w=Array(v),C=0;C<v;C++)w[C]=arguments[C+2];u.children=w}if(r&&r.defaultProps)for(l in v=r.defaultProps,v)u[l]===void 0&&(u[l]=v[l]);return{$$typeof:kg,type:r,key:f,ref:_,props:u,_owner:XA.current}}function Vce(r,i){return{$$typeof:kg,type:r.type,key:i,ref:r.ref,props:r.props,_owner:r._owner}}function $A(r){return typeof r=="object"&&r!==null&&r.$$typeof===kg}function Fce(r){var i={"=":"=0",":":"=2"};return"$"+r.replace(/[=:]/g,function(a){return i[a]})}var x3=/\/+/g;function Pb(r,i){return typeof r=="object"&&r!==null&&r.key!=null?Fce(""+r.key):i.toString(36)}function _y(r,i,a,l,u){var f=typeof r;(f==="undefined"||f==="boolean")&&(r=null);var _=!1;if(r===null)_=!0;else switch(f){case"string":case"number":_=!0;break;case"object":switch(r.$$typeof){case kg:case Ace:_=!0}}if(_)return _=r,u=u(_),r=l===""?"."+Pb(_,0):l,k3(u)?(a="",r!=null&&(a=r.replace(x3,"$&/")+"/"),_y(u,i,a,"",function(C){return C})):u!=null&&($A(u)&&(u=Vce(u,a+(!u.key||_&&_.key===u.key?"":(""+u.key).replace(x3,"$&/")+"/")+r)),i.push(u)),1;if(_=0,l=l===""?".":l+":",k3(r))for(var v=0;v<r.length;v++){f=r[v];var w=l+Pb(f,v);_+=_y(f,i,a,w,u)}else if(w=jce(r),typeof w=="function")for(r=w.call(r),v=0;!(f=r.next()).done;)f=f.value,w=l+Pb(f,v++),_+=_y(f,i,a,w,u);else if(f==="object")throw i=String(r),Error("Objects are not valid as a React child (found: "+(i==="[object Object]"?"object with keys {"+Object.keys(r).join(", ")+"}":i)+"). If you meant to render a collection of children, use an array instead.");return _}function Hv(r,i,a){if(r==null)return r;var l=[],u=0;return _y(r,l,"","",function(f){return i.call(a,f,u++)}),l}function Bce(r){if(r._status===-1){var i=r._result;i=i(),i.then(function(a){(r._status===0||r._status===-1)&&(r._status=1,r._result=a)},function(a){(r._status===0||r._status===-1)&&(r._status=2,r._result=a)}),r._status===-1&&(r._status=0,r._result=i)}if(r._status===1)return r._result.default;throw r._result}var Bi={current:null},Ey={transition:null},Wce={ReactCurrentDispatcher:Bi,ReactCurrentBatchConfig:Ey,ReactCurrentOwner:XA};function C6(){throw Error("act(...) is not supported in production builds of React.")}ln.Children={map:Hv,forEach:function(r,i,a){Hv(r,function(){i.apply(this,arguments)},a)},count:function(r){var i=0;return Hv(r,function(){i++}),i},toArray:function(r){return Hv(r,function(i){return i})||[]},only:function(r){if(!$A(r))throw Error("React.Children.only expected to receive a single React element child.");return r}};ln.Component=Op;ln.Fragment=Nce;ln.Profiler=Pce;ln.PureComponent=YA;ln.StrictMode=Oce;ln.Suspense=Lce;ln.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Wce;ln.act=C6;ln.cloneElement=function(r,i,a){if(r==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+r+".");var l=v6({},r.props),u=r.key,f=r.ref,_=r._owner;if(i!=null){if(i.ref!==void 0&&(f=i.ref,_=XA.current),i.key!==void 0&&(u=""+i.key),r.type&&r.type.defaultProps)var v=r.type.defaultProps;for(w in i)T6.call(i,w)&&!w6.hasOwnProperty(w)&&(l[w]=i[w]===void 0&&v!==void 0?v[w]:i[w])}var w=arguments.length-2;if(w===1)l.children=a;else if(1<w){v=Array(w);for(var C=0;C<w;C++)v[C]=arguments[C+2];l.children=v}return{$$typeof:kg,type:r.type,key:u,ref:f,props:l,_owner:_}};ln.createContext=function(r){return r={$$typeof:kce,_currentValue:r,_currentValue2:r,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},r.Provider={$$typeof:Dce,_context:r},r.Consumer=r};ln.createElement=R6;ln.createFactory=function(r){var i=R6.bind(null,r);return i.type=r,i};ln.createRef=function(){return{current:null}};ln.forwardRef=function(r){return{$$typeof:xce,render:r}};ln.isValidElement=$A;ln.lazy=function(r){return{$$typeof:Uce,_payload:{_status:-1,_result:r},_init:Bce}};ln.memo=function(r,i){return{$$typeof:Mce,type:r,compare:i===void 0?null:i}};ln.startTransition=function(r){var i=Ey.transition;Ey.transition={};try{r()}finally{Ey.transition=i}};ln.unstable_act=C6;ln.useCallback=function(r,i){return Bi.current.useCallback(r,i)};ln.useContext=function(r){return Bi.current.useContext(r)};ln.useDebugValue=function(){};ln.useDeferredValue=function(r){return Bi.current.useDeferredValue(r)};ln.useEffect=function(r,i){return Bi.current.useEffect(r,i)};ln.useId=function(){return Bi.current.useId()};ln.useImperativeHandle=function(r,i,a){return Bi.current.useImperativeHandle(r,i,a)};ln.useInsertionEffect=function(r,i){return Bi.current.useInsertionEffect(r,i)};ln.useLayoutEffect=function(r,i){return Bi.current.useLayoutEffect(r,i)};ln.useMemo=function(r,i){return Bi.current.useMemo(r,i)};ln.useReducer=function(r,i,a){return Bi.current.useReducer(r,i,a)};ln.useRef=function(r){return Bi.current.useRef(r)};ln.useState=function(r){return Bi.current.useState(r)};ln.useSyncExternalStore=function(r,i,a){return Bi.current.useSyncExternalStore(r,i,a)};ln.useTransition=function(){return Bi.current.useTransition()};ln.version="18.3.1";_6.exports=ln;var k=_6.exports;const Ve=KA(k),b6=Ice({__proto__:null,default:Ve},[k]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Hce=k,Gce=Symbol.for("react.element"),zce=Symbol.for("react.fragment"),Kce=Object.prototype.hasOwnProperty,Yce=Hce.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,qce={key:!0,ref:!0,__self:!0,__source:!0};function I6(r,i,a){var l,u={},f=null,_=null;a!==void 0&&(f=""+a),i.key!==void 0&&(f=""+i.key),i.ref!==void 0&&(_=i.ref);for(l in i)Kce.call(i,l)&&!qce.hasOwnProperty(l)&&(u[l]=i[l]);if(r&&r.defaultProps)for(l in i=r.defaultProps,i)u[l]===void 0&&(u[l]=i[l]);return{$$typeof:Gce,type:r,key:f,ref:_,props:u,_owner:Yce.current}}NS.Fragment=zce;NS.jsx=I6;NS.jsxs=I6;g6.exports=NS;var S=g6.exports,A6={exports:{}},xo={},N6={exports:{}},O6={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(r){function i(le,Le){var ot=le.length;le.push(Le);e:for(;0<ot;){var Xe=ot-1>>>1,st=le[Xe];if(0<u(st,Le))le[Xe]=Le,le[ot]=st,ot=Xe;else break e}}function a(le){return le.length===0?null:le[0]}function l(le){if(le.length===0)return null;var Le=le[0],ot=le.pop();if(ot!==Le){le[0]=ot;e:for(var Xe=0,st=le.length,ze=st>>>1;Xe<ze;){var ht=2*(Xe+1)-1,dt=le[ht],at=ht+1,Fe=le[at];if(0>u(dt,ot))at<st&&0>u(Fe,dt)?(le[Xe]=Fe,le[at]=ot,Xe=at):(le[Xe]=dt,le[ht]=ot,Xe=ht);else if(at<st&&0>u(Fe,ot))le[Xe]=Fe,le[at]=ot,Xe=at;else break e}}return Le}function u(le,Le){var ot=le.sortIndex-Le.sortIndex;return ot!==0?ot:le.id-Le.id}if(typeof performance=="object"&&typeof performance.now=="function"){var f=performance;r.unstable_now=function(){return f.now()}}else{var _=Date,v=_.now();r.unstable_now=function(){return _.now()-v}}var w=[],C=[],N=1,D=null,O=3,G=!1,F=!1,V=!1,L=typeof setTimeout=="function"?setTimeout:null,B=typeof clearTimeout=="function"?clearTimeout:null,W=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function z(le){for(var Le=a(C);Le!==null;){if(Le.callback===null)l(C);else if(Le.startTime<=le)l(C),Le.sortIndex=Le.expirationTime,i(w,Le);else break;Le=a(C)}}function $(le){if(V=!1,z(le),!F)if(a(w)!==null)F=!0,je(te);else{var Le=a(C);Le!==null&&Ge($,Le.startTime-le)}}function te(le,Le){F=!1,V&&(V=!1,B(pe),pe=-1),G=!0;var ot=O;try{for(z(Le),D=a(w);D!==null&&(!(D.expirationTime>Le)||le&&!ge());){var Xe=D.callback;if(typeof Xe=="function"){D.callback=null,O=D.priorityLevel;var st=Xe(D.expirationTime<=Le);Le=r.unstable_now(),typeof st=="function"?D.callback=st:D===a(w)&&l(w),z(Le)}else l(w);D=a(w)}if(D!==null)var ze=!0;else{var ht=a(C);ht!==null&&Ge($,ht.startTime-Le),ze=!1}return ze}finally{D=null,O=ot,G=!1}}var ie=!1,ce=null,pe=-1,Pe=5,_e=-1;function ge(){return!(r.unstable_now()-_e<Pe)}function fe(){if(ce!==null){var le=r.unstable_now();_e=le;var Le=!0;try{Le=ce(!0,le)}finally{Le?xe():(ie=!1,ce=null)}}else ie=!1}var xe;if(typeof W=="function")xe=function(){W(fe)};else if(typeof MessageChannel<"u"){var be=new MessageChannel,ft=be.port2;be.port1.onmessage=fe,xe=function(){ft.postMessage(null)}}else xe=function(){L(fe,0)};function je(le){ce=le,ie||(ie=!0,xe())}function Ge(le,Le){pe=L(function(){le(r.unstable_now())},Le)}r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function(le){le.callback=null},r.unstable_continueExecution=function(){F||G||(F=!0,je(te))},r.unstable_forceFrameRate=function(le){0>le||125<le?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Pe=0<le?Math.floor(1e3/le):5},r.unstable_getCurrentPriorityLevel=function(){return O},r.unstable_getFirstCallbackNode=function(){return a(w)},r.unstable_next=function(le){switch(O){case 1:case 2:case 3:var Le=3;break;default:Le=O}var ot=O;O=Le;try{return le()}finally{O=ot}},r.unstable_pauseExecution=function(){},r.unstable_requestPaint=function(){},r.unstable_runWithPriority=function(le,Le){switch(le){case 1:case 2:case 3:case 4:case 5:break;default:le=3}var ot=O;O=le;try{return Le()}finally{O=ot}},r.unstable_scheduleCallback=function(le,Le,ot){var Xe=r.unstable_now();switch(typeof ot=="object"&&ot!==null?(ot=ot.delay,ot=typeof ot=="number"&&0<ot?Xe+ot:Xe):ot=Xe,le){case 1:var st=-1;break;case 2:st=250;break;case 5:st=1073741823;break;case 4:st=1e4;break;default:st=5e3}return st=ot+st,le={id:N++,callback:Le,priorityLevel:le,startTime:ot,expirationTime:st,sortIndex:-1},ot>Xe?(le.sortIndex=ot,i(C,le),a(w)===null&&le===a(C)&&(V?(B(pe),pe=-1):V=!0,Ge($,ot-Xe))):(le.sortIndex=st,i(w,le),F||G||(F=!0,je(te))),le},r.unstable_shouldYield=ge,r.unstable_wrapCallback=function(le){var Le=O;return function(){var ot=O;O=Le;try{return le.apply(this,arguments)}finally{O=ot}}}})(O6);N6.exports=O6;var Xce=N6.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $ce=k,ko=Xce;function Ue(r){for(var i="https://reactjs.org/docs/error-decoder.html?invariant="+r,a=1;a<arguments.length;a++)i+="&args[]="+encodeURIComponent(arguments[a]);return"Minified React error #"+r+"; visit "+i+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var P6=new Set,rg={};function su(r,i){Ep(r,i),Ep(r+"Capture",i)}function Ep(r,i){for(rg[r]=i,r=0;r<i.length;r++)P6.add(i[r])}var pc=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),RI=Object.prototype.hasOwnProperty,Jce=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,L3={},M3={};function Qce(r){return RI.call(M3,r)?!0:RI.call(L3,r)?!1:Jce.test(r)?M3[r]=!0:(L3[r]=!0,!1)}function Zce(r,i,a,l){if(a!==null&&a.type===0)return!1;switch(typeof i){case"function":case"symbol":return!0;case"boolean":return l?!1:a!==null?!a.acceptsBooleans:(r=r.toLowerCase().slice(0,5),r!=="data-"&&r!=="aria-");default:return!1}}function ele(r,i,a,l){if(i===null||typeof i>"u"||Zce(r,i,a,l))return!0;if(l)return!1;if(a!==null)switch(a.type){case 3:return!i;case 4:return i===!1;case 5:return isNaN(i);case 6:return isNaN(i)||1>i}return!1}function Wi(r,i,a,l,u,f,_){this.acceptsBooleans=i===2||i===3||i===4,this.attributeName=l,this.attributeNamespace=u,this.mustUseProperty=a,this.propertyName=r,this.type=i,this.sanitizeURL=f,this.removeEmptyString=_}var pi={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(r){pi[r]=new Wi(r,0,!1,r,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(r){var i=r[0];pi[i]=new Wi(i,1,!1,r[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(r){pi[r]=new Wi(r,2,!1,r.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(r){pi[r]=new Wi(r,2,!1,r,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(r){pi[r]=new Wi(r,3,!1,r.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(r){pi[r]=new Wi(r,3,!0,r,null,!1,!1)});["capture","download"].forEach(function(r){pi[r]=new Wi(r,4,!1,r,null,!1,!1)});["cols","rows","size","span"].forEach(function(r){pi[r]=new Wi(r,6,!1,r,null,!1,!1)});["rowSpan","start"].forEach(function(r){pi[r]=new Wi(r,5,!1,r.toLowerCase(),null,!1,!1)});var JA=/[\-:]([a-z])/g;function QA(r){return r[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(r){var i=r.replace(JA,QA);pi[i]=new Wi(i,1,!1,r,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(r){var i=r.replace(JA,QA);pi[i]=new Wi(i,1,!1,r,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(r){var i=r.replace(JA,QA);pi[i]=new Wi(i,1,!1,r,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(r){pi[r]=new Wi(r,1,!1,r.toLowerCase(),null,!1,!1)});pi.xlinkHref=new Wi("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(r){pi[r]=new Wi(r,1,!1,r.toLowerCase(),null,!0,!0)});function ZA(r,i,a,l){var u=pi.hasOwnProperty(i)?pi[i]:null;(u!==null?u.type!==0:l||!(2<i.length)||i[0]!=="o"&&i[0]!=="O"||i[1]!=="n"&&i[1]!=="N")&&(ele(i,a,u,l)&&(a=null),l||u===null?Qce(i)&&(a===null?r.removeAttribute(i):r.setAttribute(i,""+a)):u.mustUseProperty?r[u.propertyName]=a===null?u.type===3?!1:"":a:(i=u.attributeName,l=u.attributeNamespace,a===null?r.removeAttribute(i):(u=u.type,a=u===3||u===4&&a===!0?"":""+a,l?r.setAttributeNS(l,i,a):r.setAttribute(i,a))))}var vc=$ce.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Gv=Symbol.for("react.element"),Wh=Symbol.for("react.portal"),Hh=Symbol.for("react.fragment"),eN=Symbol.for("react.strict_mode"),CI=Symbol.for("react.profiler"),D6=Symbol.for("react.provider"),k6=Symbol.for("react.context"),tN=Symbol.for("react.forward_ref"),bI=Symbol.for("react.suspense"),II=Symbol.for("react.suspense_list"),nN=Symbol.for("react.memo"),ol=Symbol.for("react.lazy"),x6=Symbol.for("react.offscreen"),U3=Symbol.iterator;function Cm(r){return r===null||typeof r!="object"?null:(r=U3&&r[U3]||r["@@iterator"],typeof r=="function"?r:null)}var mr=Object.assign,Db;function Fm(r){if(Db===void 0)try{throw Error()}catch(a){var i=a.stack.trim().match(/\n( *(at )?)/);Db=i&&i[1]||""}return`
`+Db+r}var kb=!1;function xb(r,i){if(!r||kb)return"";kb=!0;var a=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(i)if(i=function(){throw Error()},Object.defineProperty(i.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(i,[])}catch(C){var l=C}Reflect.construct(r,[],i)}else{try{i.call()}catch(C){l=C}r.call(i.prototype)}else{try{throw Error()}catch(C){l=C}r()}}catch(C){if(C&&l&&typeof C.stack=="string"){for(var u=C.stack.split(`
`),f=l.stack.split(`
`),_=u.length-1,v=f.length-1;1<=_&&0<=v&&u[_]!==f[v];)v--;for(;1<=_&&0<=v;_--,v--)if(u[_]!==f[v]){if(_!==1||v!==1)do if(_--,v--,0>v||u[_]!==f[v]){var w=`
`+u[_].replace(" at new "," at ");return r.displayName&&w.includes("<anonymous>")&&(w=w.replace("<anonymous>",r.displayName)),w}while(1<=_&&0<=v);break}}}finally{kb=!1,Error.prepareStackTrace=a}return(r=r?r.displayName||r.name:"")?Fm(r):""}function tle(r){switch(r.tag){case 5:return Fm(r.type);case 16:return Fm("Lazy");case 13:return Fm("Suspense");case 19:return Fm("SuspenseList");case 0:case 2:case 15:return r=xb(r.type,!1),r;case 11:return r=xb(r.type.render,!1),r;case 1:return r=xb(r.type,!0),r;default:return""}}function AI(r){if(r==null)return null;if(typeof r=="function")return r.displayName||r.name||null;if(typeof r=="string")return r;switch(r){case Hh:return"Fragment";case Wh:return"Portal";case CI:return"Profiler";case eN:return"StrictMode";case bI:return"Suspense";case II:return"SuspenseList"}if(typeof r=="object")switch(r.$$typeof){case k6:return(r.displayName||"Context")+".Consumer";case D6:return(r._context.displayName||"Context")+".Provider";case tN:var i=r.render;return r=r.displayName,r||(r=i.displayName||i.name||"",r=r!==""?"ForwardRef("+r+")":"ForwardRef"),r;case nN:return i=r.displayName||null,i!==null?i:AI(r.type)||"Memo";case ol:i=r._payload,r=r._init;try{return AI(r(i))}catch{}}return null}function nle(r){var i=r.type;switch(r.tag){case 24:return"Cache";case 9:return(i.displayName||"Context")+".Consumer";case 10:return(i._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return r=i.render,r=r.displayName||r.name||"",i.displayName||(r!==""?"ForwardRef("+r+")":"ForwardRef");case 7:return"Fragment";case 5:return i;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return AI(i);case 8:return i===eN?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof i=="function")return i.displayName||i.name||null;if(typeof i=="string")return i}return null}function Al(r){switch(typeof r){case"boolean":case"number":case"string":case"undefined":return r;case"object":return r;default:return""}}function L6(r){var i=r.type;return(r=r.nodeName)&&r.toLowerCase()==="input"&&(i==="checkbox"||i==="radio")}function rle(r){var i=L6(r)?"checked":"value",a=Object.getOwnPropertyDescriptor(r.constructor.prototype,i),l=""+r[i];if(!r.hasOwnProperty(i)&&typeof a<"u"&&typeof a.get=="function"&&typeof a.set=="function"){var u=a.get,f=a.set;return Object.defineProperty(r,i,{configurable:!0,get:function(){return u.call(this)},set:function(_){l=""+_,f.call(this,_)}}),Object.defineProperty(r,i,{enumerable:a.enumerable}),{getValue:function(){return l},setValue:function(_){l=""+_},stopTracking:function(){r._valueTracker=null,delete r[i]}}}}function zv(r){r._valueTracker||(r._valueTracker=rle(r))}function M6(r){if(!r)return!1;var i=r._valueTracker;if(!i)return!0;var a=i.getValue(),l="";return r&&(l=L6(r)?r.checked?"true":"false":r.value),r=l,r!==a?(i.setValue(r),!0):!1}function By(r){if(r=r||(typeof document<"u"?document:void 0),typeof r>"u")return null;try{return r.activeElement||r.body}catch{return r.body}}function NI(r,i){var a=i.checked;return mr({},i,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:a??r._wrapperState.initialChecked})}function j3(r,i){var a=i.defaultValue==null?"":i.defaultValue,l=i.checked!=null?i.checked:i.defaultChecked;a=Al(i.value!=null?i.value:a),r._wrapperState={initialChecked:l,initialValue:a,controlled:i.type==="checkbox"||i.type==="radio"?i.checked!=null:i.value!=null}}function U6(r,i){i=i.checked,i!=null&&ZA(r,"checked",i,!1)}function OI(r,i){U6(r,i);var a=Al(i.value),l=i.type;if(a!=null)l==="number"?(a===0&&r.value===""||r.value!=a)&&(r.value=""+a):r.value!==""+a&&(r.value=""+a);else if(l==="submit"||l==="reset"){r.removeAttribute("value");return}i.hasOwnProperty("value")?PI(r,i.type,a):i.hasOwnProperty("defaultValue")&&PI(r,i.type,Al(i.defaultValue)),i.checked==null&&i.defaultChecked!=null&&(r.defaultChecked=!!i.defaultChecked)}function V3(r,i,a){if(i.hasOwnProperty("value")||i.hasOwnProperty("defaultValue")){var l=i.type;if(!(l!=="submit"&&l!=="reset"||i.value!==void 0&&i.value!==null))return;i=""+r._wrapperState.initialValue,a||i===r.value||(r.value=i),r.defaultValue=i}a=r.name,a!==""&&(r.name=""),r.defaultChecked=!!r._wrapperState.initialChecked,a!==""&&(r.name=a)}function PI(r,i,a){(i!=="number"||By(r.ownerDocument)!==r)&&(a==null?r.defaultValue=""+r._wrapperState.initialValue:r.defaultValue!==""+a&&(r.defaultValue=""+a))}var Bm=Array.isArray;function ep(r,i,a,l){if(r=r.options,i){i={};for(var u=0;u<a.length;u++)i["$"+a[u]]=!0;for(a=0;a<r.length;a++)u=i.hasOwnProperty("$"+r[a].value),r[a].selected!==u&&(r[a].selected=u),u&&l&&(r[a].defaultSelected=!0)}else{for(a=""+Al(a),i=null,u=0;u<r.length;u++){if(r[u].value===a){r[u].selected=!0,l&&(r[u].defaultSelected=!0);return}i!==null||r[u].disabled||(i=r[u])}i!==null&&(i.selected=!0)}}function DI(r,i){if(i.dangerouslySetInnerHTML!=null)throw Error(Ue(91));return mr({},i,{value:void 0,defaultValue:void 0,children:""+r._wrapperState.initialValue})}function F3(r,i){var a=i.value;if(a==null){if(a=i.children,i=i.defaultValue,a!=null){if(i!=null)throw Error(Ue(92));if(Bm(a)){if(1<a.length)throw Error(Ue(93));a=a[0]}i=a}i==null&&(i=""),a=i}r._wrapperState={initialValue:Al(a)}}function j6(r,i){var a=Al(i.value),l=Al(i.defaultValue);a!=null&&(a=""+a,a!==r.value&&(r.value=a),i.defaultValue==null&&r.defaultValue!==a&&(r.defaultValue=a)),l!=null&&(r.defaultValue=""+l)}function B3(r){var i=r.textContent;i===r._wrapperState.initialValue&&i!==""&&i!==null&&(r.value=i)}function V6(r){switch(r){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function kI(r,i){return r==null||r==="http://www.w3.org/1999/xhtml"?V6(i):r==="http://www.w3.org/2000/svg"&&i==="foreignObject"?"http://www.w3.org/1999/xhtml":r}var Kv,F6=function(r){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(i,a,l,u){MSApp.execUnsafeLocalFunction(function(){return r(i,a,l,u)})}:r}(function(r,i){if(r.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in r)r.innerHTML=i;else{for(Kv=Kv||document.createElement("div"),Kv.innerHTML="<svg>"+i.valueOf().toString()+"</svg>",i=Kv.firstChild;r.firstChild;)r.removeChild(r.firstChild);for(;i.firstChild;)r.appendChild(i.firstChild)}});function ig(r,i){if(i){var a=r.firstChild;if(a&&a===r.lastChild&&a.nodeType===3){a.nodeValue=i;return}}r.textContent=i}var Km={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},ile=["Webkit","ms","Moz","O"];Object.keys(Km).forEach(function(r){ile.forEach(function(i){i=i+r.charAt(0).toUpperCase()+r.substring(1),Km[i]=Km[r]})});function B6(r,i,a){return i==null||typeof i=="boolean"||i===""?"":a||typeof i!="number"||i===0||Km.hasOwnProperty(r)&&Km[r]?(""+i).trim():i+"px"}function W6(r,i){r=r.style;for(var a in i)if(i.hasOwnProperty(a)){var l=a.indexOf("--")===0,u=B6(a,i[a],l);a==="float"&&(a="cssFloat"),l?r.setProperty(a,u):r[a]=u}}var ole=mr({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function xI(r,i){if(i){if(ole[r]&&(i.children!=null||i.dangerouslySetInnerHTML!=null))throw Error(Ue(137,r));if(i.dangerouslySetInnerHTML!=null){if(i.children!=null)throw Error(Ue(60));if(typeof i.dangerouslySetInnerHTML!="object"||!("__html"in i.dangerouslySetInnerHTML))throw Error(Ue(61))}if(i.style!=null&&typeof i.style!="object")throw Error(Ue(62))}}function LI(r,i){if(r.indexOf("-")===-1)return typeof i.is=="string";switch(r){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var MI=null;function rN(r){return r=r.target||r.srcElement||window,r.correspondingUseElement&&(r=r.correspondingUseElement),r.nodeType===3?r.parentNode:r}var UI=null,tp=null,np=null;function W3(r){if(r=Mg(r)){if(typeof UI!="function")throw Error(Ue(280));var i=r.stateNode;i&&(i=xS(i),UI(r.stateNode,r.type,i))}}function H6(r){tp?np?np.push(r):np=[r]:tp=r}function G6(){if(tp){var r=tp,i=np;if(np=tp=null,W3(r),i)for(r=0;r<i.length;r++)W3(i[r])}}function z6(r,i){return r(i)}function K6(){}var Lb=!1;function Y6(r,i,a){if(Lb)return r(i,a);Lb=!0;try{return z6(r,i,a)}finally{Lb=!1,(tp!==null||np!==null)&&(K6(),G6())}}function og(r,i){var a=r.stateNode;if(a===null)return null;var l=xS(a);if(l===null)return null;a=l[i];e:switch(i){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(l=!l.disabled)||(r=r.type,l=!(r==="button"||r==="input"||r==="select"||r==="textarea")),r=!l;break e;default:r=!1}if(r)return null;if(a&&typeof a!="function")throw Error(Ue(231,i,typeof a));return a}var jI=!1;if(pc)try{var bm={};Object.defineProperty(bm,"passive",{get:function(){jI=!0}}),window.addEventListener("test",bm,bm),window.removeEventListener("test",bm,bm)}catch{jI=!1}function sle(r,i,a,l,u,f,_,v,w){var C=Array.prototype.slice.call(arguments,3);try{i.apply(a,C)}catch(N){this.onError(N)}}var Ym=!1,Wy=null,Hy=!1,VI=null,ale={onError:function(r){Ym=!0,Wy=r}};function cle(r,i,a,l,u,f,_,v,w){Ym=!1,Wy=null,sle.apply(ale,arguments)}function lle(r,i,a,l,u,f,_,v,w){if(cle.apply(this,arguments),Ym){if(Ym){var C=Wy;Ym=!1,Wy=null}else throw Error(Ue(198));Hy||(Hy=!0,VI=C)}}function au(r){var i=r,a=r;if(r.alternate)for(;i.return;)i=i.return;else{r=i;do i=r,i.flags&4098&&(a=i.return),r=i.return;while(r)}return i.tag===3?a:null}function q6(r){if(r.tag===13){var i=r.memoizedState;if(i===null&&(r=r.alternate,r!==null&&(i=r.memoizedState)),i!==null)return i.dehydrated}return null}function H3(r){if(au(r)!==r)throw Error(Ue(188))}function dle(r){var i=r.alternate;if(!i){if(i=au(r),i===null)throw Error(Ue(188));return i!==r?null:r}for(var a=r,l=i;;){var u=a.return;if(u===null)break;var f=u.alternate;if(f===null){if(l=u.return,l!==null){a=l;continue}break}if(u.child===f.child){for(f=u.child;f;){if(f===a)return H3(u),r;if(f===l)return H3(u),i;f=f.sibling}throw Error(Ue(188))}if(a.return!==l.return)a=u,l=f;else{for(var _=!1,v=u.child;v;){if(v===a){_=!0,a=u,l=f;break}if(v===l){_=!0,l=u,a=f;break}v=v.sibling}if(!_){for(v=f.child;v;){if(v===a){_=!0,a=f,l=u;break}if(v===l){_=!0,l=f,a=u;break}v=v.sibling}if(!_)throw Error(Ue(189))}}if(a.alternate!==l)throw Error(Ue(190))}if(a.tag!==3)throw Error(Ue(188));return a.stateNode.current===a?r:i}function X6(r){return r=dle(r),r!==null?$6(r):null}function $6(r){if(r.tag===5||r.tag===6)return r;for(r=r.child;r!==null;){var i=$6(r);if(i!==null)return i;r=r.sibling}return null}var J6=ko.unstable_scheduleCallback,G3=ko.unstable_cancelCallback,ule=ko.unstable_shouldYield,hle=ko.unstable_requestPaint,Pr=ko.unstable_now,ple=ko.unstable_getCurrentPriorityLevel,iN=ko.unstable_ImmediatePriority,Q6=ko.unstable_UserBlockingPriority,Gy=ko.unstable_NormalPriority,fle=ko.unstable_LowPriority,Z6=ko.unstable_IdlePriority,OS=null,Pa=null;function mle(r){if(Pa&&typeof Pa.onCommitFiberRoot=="function")try{Pa.onCommitFiberRoot(OS,r,void 0,(r.current.flags&128)===128)}catch{}}var Hs=Math.clz32?Math.clz32:Ele,gle=Math.log,_le=Math.LN2;function Ele(r){return r>>>=0,r===0?32:31-(gle(r)/_le|0)|0}var Yv=64,qv=4194304;function Wm(r){switch(r&-r){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return r&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return r}}function zy(r,i){var a=r.pendingLanes;if(a===0)return 0;var l=0,u=r.suspendedLanes,f=r.pingedLanes,_=a&268435455;if(_!==0){var v=_&~u;v!==0?l=Wm(v):(f&=_,f!==0&&(l=Wm(f)))}else _=a&~u,_!==0?l=Wm(_):f!==0&&(l=Wm(f));if(l===0)return 0;if(i!==0&&i!==l&&!(i&u)&&(u=l&-l,f=i&-i,u>=f||u===16&&(f&4194240)!==0))return i;if(l&4&&(l|=a&16),i=r.entangledLanes,i!==0)for(r=r.entanglements,i&=l;0<i;)a=31-Hs(i),u=1<<a,l|=r[a],i&=~u;return l}function vle(r,i){switch(r){case 1:case 2:case 4:return i+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return i+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function yle(r,i){for(var a=r.suspendedLanes,l=r.pingedLanes,u=r.expirationTimes,f=r.pendingLanes;0<f;){var _=31-Hs(f),v=1<<_,w=u[_];w===-1?(!(v&a)||v&l)&&(u[_]=vle(v,i)):w<=i&&(r.expiredLanes|=v),f&=~v}}function FI(r){return r=r.pendingLanes&-1073741825,r!==0?r:r&1073741824?1073741824:0}function e8(){var r=Yv;return Yv<<=1,!(Yv&4194240)&&(Yv=64),r}function Mb(r){for(var i=[],a=0;31>a;a++)i.push(r);return i}function xg(r,i,a){r.pendingLanes|=i,i!==536870912&&(r.suspendedLanes=0,r.pingedLanes=0),r=r.eventTimes,i=31-Hs(i),r[i]=a}function Sle(r,i){var a=r.pendingLanes&~i;r.pendingLanes=i,r.suspendedLanes=0,r.pingedLanes=0,r.expiredLanes&=i,r.mutableReadLanes&=i,r.entangledLanes&=i,i=r.entanglements;var l=r.eventTimes;for(r=r.expirationTimes;0<a;){var u=31-Hs(a),f=1<<u;i[u]=0,l[u]=-1,r[u]=-1,a&=~f}}function oN(r,i){var a=r.entangledLanes|=i;for(r=r.entanglements;a;){var l=31-Hs(a),u=1<<l;u&i|r[l]&i&&(r[l]|=i),a&=~u}}var xn=0;function t8(r){return r&=-r,1<r?4<r?r&268435455?16:536870912:4:1}var n8,sN,r8,i8,o8,BI=!1,Xv=[],El=null,vl=null,yl=null,sg=new Map,ag=new Map,al=[],Tle="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function z3(r,i){switch(r){case"focusin":case"focusout":El=null;break;case"dragenter":case"dragleave":vl=null;break;case"mouseover":case"mouseout":yl=null;break;case"pointerover":case"pointerout":sg.delete(i.pointerId);break;case"gotpointercapture":case"lostpointercapture":ag.delete(i.pointerId)}}function Im(r,i,a,l,u,f){return r===null||r.nativeEvent!==f?(r={blockedOn:i,domEventName:a,eventSystemFlags:l,nativeEvent:f,targetContainers:[u]},i!==null&&(i=Mg(i),i!==null&&sN(i)),r):(r.eventSystemFlags|=l,i=r.targetContainers,u!==null&&i.indexOf(u)===-1&&i.push(u),r)}function wle(r,i,a,l,u){switch(i){case"focusin":return El=Im(El,r,i,a,l,u),!0;case"dragenter":return vl=Im(vl,r,i,a,l,u),!0;case"mouseover":return yl=Im(yl,r,i,a,l,u),!0;case"pointerover":var f=u.pointerId;return sg.set(f,Im(sg.get(f)||null,r,i,a,l,u)),!0;case"gotpointercapture":return f=u.pointerId,ag.set(f,Im(ag.get(f)||null,r,i,a,l,u)),!0}return!1}function s8(r){var i=Dd(r.target);if(i!==null){var a=au(i);if(a!==null){if(i=a.tag,i===13){if(i=q6(a),i!==null){r.blockedOn=i,o8(r.priority,function(){r8(a)});return}}else if(i===3&&a.stateNode.current.memoizedState.isDehydrated){r.blockedOn=a.tag===3?a.stateNode.containerInfo:null;return}}}r.blockedOn=null}function vy(r){if(r.blockedOn!==null)return!1;for(var i=r.targetContainers;0<i.length;){var a=WI(r.domEventName,r.eventSystemFlags,i[0],r.nativeEvent);if(a===null){a=r.nativeEvent;var l=new a.constructor(a.type,a);MI=l,a.target.dispatchEvent(l),MI=null}else return i=Mg(a),i!==null&&sN(i),r.blockedOn=a,!1;i.shift()}return!0}function K3(r,i,a){vy(r)&&a.delete(i)}function Rle(){BI=!1,El!==null&&vy(El)&&(El=null),vl!==null&&vy(vl)&&(vl=null),yl!==null&&vy(yl)&&(yl=null),sg.forEach(K3),ag.forEach(K3)}function Am(r,i){r.blockedOn===i&&(r.blockedOn=null,BI||(BI=!0,ko.unstable_scheduleCallback(ko.unstable_NormalPriority,Rle)))}function cg(r){function i(u){return Am(u,r)}if(0<Xv.length){Am(Xv[0],r);for(var a=1;a<Xv.length;a++){var l=Xv[a];l.blockedOn===r&&(l.blockedOn=null)}}for(El!==null&&Am(El,r),vl!==null&&Am(vl,r),yl!==null&&Am(yl,r),sg.forEach(i),ag.forEach(i),a=0;a<al.length;a++)l=al[a],l.blockedOn===r&&(l.blockedOn=null);for(;0<al.length&&(a=al[0],a.blockedOn===null);)s8(a),a.blockedOn===null&&al.shift()}var rp=vc.ReactCurrentBatchConfig,Ky=!0;function Cle(r,i,a,l){var u=xn,f=rp.transition;rp.transition=null;try{xn=1,aN(r,i,a,l)}finally{xn=u,rp.transition=f}}function ble(r,i,a,l){var u=xn,f=rp.transition;rp.transition=null;try{xn=4,aN(r,i,a,l)}finally{xn=u,rp.transition=f}}function aN(r,i,a,l){if(Ky){var u=WI(r,i,a,l);if(u===null)Kb(r,i,l,Yy,a),z3(r,l);else if(wle(u,r,i,a,l))l.stopPropagation();else if(z3(r,l),i&4&&-1<Tle.indexOf(r)){for(;u!==null;){var f=Mg(u);if(f!==null&&n8(f),f=WI(r,i,a,l),f===null&&Kb(r,i,l,Yy,a),f===u)break;u=f}u!==null&&l.stopPropagation()}else Kb(r,i,l,null,a)}}var Yy=null;function WI(r,i,a,l){if(Yy=null,r=rN(l),r=Dd(r),r!==null)if(i=au(r),i===null)r=null;else if(a=i.tag,a===13){if(r=q6(i),r!==null)return r;r=null}else if(a===3){if(i.stateNode.current.memoizedState.isDehydrated)return i.tag===3?i.stateNode.containerInfo:null;r=null}else i!==r&&(r=null);return Yy=r,null}function a8(r){switch(r){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(ple()){case iN:return 1;case Q6:return 4;case Gy:case fle:return 16;case Z6:return 536870912;default:return 16}default:return 16}}var fl=null,cN=null,yy=null;function c8(){if(yy)return yy;var r,i=cN,a=i.length,l,u="value"in fl?fl.value:fl.textContent,f=u.length;for(r=0;r<a&&i[r]===u[r];r++);var _=a-r;for(l=1;l<=_&&i[a-l]===u[f-l];l++);return yy=u.slice(r,1<l?1-l:void 0)}function Sy(r){var i=r.keyCode;return"charCode"in r?(r=r.charCode,r===0&&i===13&&(r=13)):r=i,r===10&&(r=13),32<=r||r===13?r:0}function $v(){return!0}function Y3(){return!1}function Lo(r){function i(a,l,u,f,_){this._reactName=a,this._targetInst=u,this.type=l,this.nativeEvent=f,this.target=_,this.currentTarget=null;for(var v in r)r.hasOwnProperty(v)&&(a=r[v],this[v]=a?a(f):f[v]);return this.isDefaultPrevented=(f.defaultPrevented!=null?f.defaultPrevented:f.returnValue===!1)?$v:Y3,this.isPropagationStopped=Y3,this}return mr(i.prototype,{preventDefault:function(){this.defaultPrevented=!0;var a=this.nativeEvent;a&&(a.preventDefault?a.preventDefault():typeof a.returnValue!="unknown"&&(a.returnValue=!1),this.isDefaultPrevented=$v)},stopPropagation:function(){var a=this.nativeEvent;a&&(a.stopPropagation?a.stopPropagation():typeof a.cancelBubble!="unknown"&&(a.cancelBubble=!0),this.isPropagationStopped=$v)},persist:function(){},isPersistent:$v}),i}var Pp={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(r){return r.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},lN=Lo(Pp),Lg=mr({},Pp,{view:0,detail:0}),Ile=Lo(Lg),Ub,jb,Nm,PS=mr({},Lg,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:dN,button:0,buttons:0,relatedTarget:function(r){return r.relatedTarget===void 0?r.fromElement===r.srcElement?r.toElement:r.fromElement:r.relatedTarget},movementX:function(r){return"movementX"in r?r.movementX:(r!==Nm&&(Nm&&r.type==="mousemove"?(Ub=r.screenX-Nm.screenX,jb=r.screenY-Nm.screenY):jb=Ub=0,Nm=r),Ub)},movementY:function(r){return"movementY"in r?r.movementY:jb}}),q3=Lo(PS),Ale=mr({},PS,{dataTransfer:0}),Nle=Lo(Ale),Ole=mr({},Lg,{relatedTarget:0}),Vb=Lo(Ole),Ple=mr({},Pp,{animationName:0,elapsedTime:0,pseudoElement:0}),Dle=Lo(Ple),kle=mr({},Pp,{clipboardData:function(r){return"clipboardData"in r?r.clipboardData:window.clipboardData}}),xle=Lo(kle),Lle=mr({},Pp,{data:0}),X3=Lo(Lle),Mle={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Ule={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},jle={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Vle(r){var i=this.nativeEvent;return i.getModifierState?i.getModifierState(r):(r=jle[r])?!!i[r]:!1}function dN(){return Vle}var Fle=mr({},Lg,{key:function(r){if(r.key){var i=Mle[r.key]||r.key;if(i!=="Unidentified")return i}return r.type==="keypress"?(r=Sy(r),r===13?"Enter":String.fromCharCode(r)):r.type==="keydown"||r.type==="keyup"?Ule[r.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:dN,charCode:function(r){return r.type==="keypress"?Sy(r):0},keyCode:function(r){return r.type==="keydown"||r.type==="keyup"?r.keyCode:0},which:function(r){return r.type==="keypress"?Sy(r):r.type==="keydown"||r.type==="keyup"?r.keyCode:0}}),Ble=Lo(Fle),Wle=mr({},PS,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),$3=Lo(Wle),Hle=mr({},Lg,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:dN}),Gle=Lo(Hle),zle=mr({},Pp,{propertyName:0,elapsedTime:0,pseudoElement:0}),Kle=Lo(zle),Yle=mr({},PS,{deltaX:function(r){return"deltaX"in r?r.deltaX:"wheelDeltaX"in r?-r.wheelDeltaX:0},deltaY:function(r){return"deltaY"in r?r.deltaY:"wheelDeltaY"in r?-r.wheelDeltaY:"wheelDelta"in r?-r.wheelDelta:0},deltaZ:0,deltaMode:0}),qle=Lo(Yle),Xle=[9,13,27,32],uN=pc&&"CompositionEvent"in window,qm=null;pc&&"documentMode"in document&&(qm=document.documentMode);var $le=pc&&"TextEvent"in window&&!qm,l8=pc&&(!uN||qm&&8<qm&&11>=qm),J3=" ",Q3=!1;function d8(r,i){switch(r){case"keyup":return Xle.indexOf(i.keyCode)!==-1;case"keydown":return i.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function u8(r){return r=r.detail,typeof r=="object"&&"data"in r?r.data:null}var Gh=!1;function Jle(r,i){switch(r){case"compositionend":return u8(i);case"keypress":return i.which!==32?null:(Q3=!0,J3);case"textInput":return r=i.data,r===J3&&Q3?null:r;default:return null}}function Qle(r,i){if(Gh)return r==="compositionend"||!uN&&d8(r,i)?(r=c8(),yy=cN=fl=null,Gh=!1,r):null;switch(r){case"paste":return null;case"keypress":if(!(i.ctrlKey||i.altKey||i.metaKey)||i.ctrlKey&&i.altKey){if(i.char&&1<i.char.length)return i.char;if(i.which)return String.fromCharCode(i.which)}return null;case"compositionend":return l8&&i.locale!=="ko"?null:i.data;default:return null}}var Zle={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Z3(r){var i=r&&r.nodeName&&r.nodeName.toLowerCase();return i==="input"?!!Zle[r.type]:i==="textarea"}function h8(r,i,a,l){H6(l),i=qy(i,"onChange"),0<i.length&&(a=new lN("onChange","change",null,a,l),r.push({event:a,listeners:i}))}var Xm=null,lg=null;function ede(r){w8(r,0)}function DS(r){var i=Yh(r);if(M6(i))return r}function tde(r,i){if(r==="change")return i}var p8=!1;if(pc){var Fb;if(pc){var Bb="oninput"in document;if(!Bb){var eB=document.createElement("div");eB.setAttribute("oninput","return;"),Bb=typeof eB.oninput=="function"}Fb=Bb}else Fb=!1;p8=Fb&&(!document.documentMode||9<document.documentMode)}function tB(){Xm&&(Xm.detachEvent("onpropertychange",f8),lg=Xm=null)}function f8(r){if(r.propertyName==="value"&&DS(lg)){var i=[];h8(i,lg,r,rN(r)),Y6(ede,i)}}function nde(r,i,a){r==="focusin"?(tB(),Xm=i,lg=a,Xm.attachEvent("onpropertychange",f8)):r==="focusout"&&tB()}function rde(r){if(r==="selectionchange"||r==="keyup"||r==="keydown")return DS(lg)}function ide(r,i){if(r==="click")return DS(i)}function ode(r,i){if(r==="input"||r==="change")return DS(i)}function sde(r,i){return r===i&&(r!==0||1/r===1/i)||r!==r&&i!==i}var zs=typeof Object.is=="function"?Object.is:sde;function dg(r,i){if(zs(r,i))return!0;if(typeof r!="object"||r===null||typeof i!="object"||i===null)return!1;var a=Object.keys(r),l=Object.keys(i);if(a.length!==l.length)return!1;for(l=0;l<a.length;l++){var u=a[l];if(!RI.call(i,u)||!zs(r[u],i[u]))return!1}return!0}function nB(r){for(;r&&r.firstChild;)r=r.firstChild;return r}function rB(r,i){var a=nB(r);r=0;for(var l;a;){if(a.nodeType===3){if(l=r+a.textContent.length,r<=i&&l>=i)return{node:a,offset:i-r};r=l}e:{for(;a;){if(a.nextSibling){a=a.nextSibling;break e}a=a.parentNode}a=void 0}a=nB(a)}}function m8(r,i){return r&&i?r===i?!0:r&&r.nodeType===3?!1:i&&i.nodeType===3?m8(r,i.parentNode):"contains"in r?r.contains(i):r.compareDocumentPosition?!!(r.compareDocumentPosition(i)&16):!1:!1}function g8(){for(var r=window,i=By();i instanceof r.HTMLIFrameElement;){try{var a=typeof i.contentWindow.location.href=="string"}catch{a=!1}if(a)r=i.contentWindow;else break;i=By(r.document)}return i}function hN(r){var i=r&&r.nodeName&&r.nodeName.toLowerCase();return i&&(i==="input"&&(r.type==="text"||r.type==="search"||r.type==="tel"||r.type==="url"||r.type==="password")||i==="textarea"||r.contentEditable==="true")}function ade(r){var i=g8(),a=r.focusedElem,l=r.selectionRange;if(i!==a&&a&&a.ownerDocument&&m8(a.ownerDocument.documentElement,a)){if(l!==null&&hN(a)){if(i=l.start,r=l.end,r===void 0&&(r=i),"selectionStart"in a)a.selectionStart=i,a.selectionEnd=Math.min(r,a.value.length);else if(r=(i=a.ownerDocument||document)&&i.defaultView||window,r.getSelection){r=r.getSelection();var u=a.textContent.length,f=Math.min(l.start,u);l=l.end===void 0?f:Math.min(l.end,u),!r.extend&&f>l&&(u=l,l=f,f=u),u=rB(a,f);var _=rB(a,l);u&&_&&(r.rangeCount!==1||r.anchorNode!==u.node||r.anchorOffset!==u.offset||r.focusNode!==_.node||r.focusOffset!==_.offset)&&(i=i.createRange(),i.setStart(u.node,u.offset),r.removeAllRanges(),f>l?(r.addRange(i),r.extend(_.node,_.offset)):(i.setEnd(_.node,_.offset),r.addRange(i)))}}for(i=[],r=a;r=r.parentNode;)r.nodeType===1&&i.push({element:r,left:r.scrollLeft,top:r.scrollTop});for(typeof a.focus=="function"&&a.focus(),a=0;a<i.length;a++)r=i[a],r.element.scrollLeft=r.left,r.element.scrollTop=r.top}}var cde=pc&&"documentMode"in document&&11>=document.documentMode,zh=null,HI=null,$m=null,GI=!1;function iB(r,i,a){var l=a.window===a?a.document:a.nodeType===9?a:a.ownerDocument;GI||zh==null||zh!==By(l)||(l=zh,"selectionStart"in l&&hN(l)?l={start:l.selectionStart,end:l.selectionEnd}:(l=(l.ownerDocument&&l.ownerDocument.defaultView||window).getSelection(),l={anchorNode:l.anchorNode,anchorOffset:l.anchorOffset,focusNode:l.focusNode,focusOffset:l.focusOffset}),$m&&dg($m,l)||($m=l,l=qy(HI,"onSelect"),0<l.length&&(i=new lN("onSelect","select",null,i,a),r.push({event:i,listeners:l}),i.target=zh)))}function Jv(r,i){var a={};return a[r.toLowerCase()]=i.toLowerCase(),a["Webkit"+r]="webkit"+i,a["Moz"+r]="moz"+i,a}var Kh={animationend:Jv("Animation","AnimationEnd"),animationiteration:Jv("Animation","AnimationIteration"),animationstart:Jv("Animation","AnimationStart"),transitionend:Jv("Transition","TransitionEnd")},Wb={},_8={};pc&&(_8=document.createElement("div").style,"AnimationEvent"in window||(delete Kh.animationend.animation,delete Kh.animationiteration.animation,delete Kh.animationstart.animation),"TransitionEvent"in window||delete Kh.transitionend.transition);function kS(r){if(Wb[r])return Wb[r];if(!Kh[r])return r;var i=Kh[r],a;for(a in i)if(i.hasOwnProperty(a)&&a in _8)return Wb[r]=i[a];return r}var E8=kS("animationend"),v8=kS("animationiteration"),y8=kS("animationstart"),S8=kS("transitionend"),T8=new Map,oB="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ll(r,i){T8.set(r,i),su(i,[r])}for(var Hb=0;Hb<oB.length;Hb++){var Gb=oB[Hb],lde=Gb.toLowerCase(),dde=Gb[0].toUpperCase()+Gb.slice(1);Ll(lde,"on"+dde)}Ll(E8,"onAnimationEnd");Ll(v8,"onAnimationIteration");Ll(y8,"onAnimationStart");Ll("dblclick","onDoubleClick");Ll("focusin","onFocus");Ll("focusout","onBlur");Ll(S8,"onTransitionEnd");Ep("onMouseEnter",["mouseout","mouseover"]);Ep("onMouseLeave",["mouseout","mouseover"]);Ep("onPointerEnter",["pointerout","pointerover"]);Ep("onPointerLeave",["pointerout","pointerover"]);su("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));su("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));su("onBeforeInput",["compositionend","keypress","textInput","paste"]);su("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));su("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));su("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Hm="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),ude=new Set("cancel close invalid load scroll toggle".split(" ").concat(Hm));function sB(r,i,a){var l=r.type||"unknown-event";r.currentTarget=a,lle(l,i,void 0,r),r.currentTarget=null}function w8(r,i){i=(i&4)!==0;for(var a=0;a<r.length;a++){var l=r[a],u=l.event;l=l.listeners;e:{var f=void 0;if(i)for(var _=l.length-1;0<=_;_--){var v=l[_],w=v.instance,C=v.currentTarget;if(v=v.listener,w!==f&&u.isPropagationStopped())break e;sB(u,v,C),f=w}else for(_=0;_<l.length;_++){if(v=l[_],w=v.instance,C=v.currentTarget,v=v.listener,w!==f&&u.isPropagationStopped())break e;sB(u,v,C),f=w}}}if(Hy)throw r=VI,Hy=!1,VI=null,r}function Zn(r,i){var a=i[XI];a===void 0&&(a=i[XI]=new Set);var l=r+"__bubble";a.has(l)||(R8(i,r,2,!1),a.add(l))}function zb(r,i,a){var l=0;i&&(l|=4),R8(a,r,l,i)}var Qv="_reactListening"+Math.random().toString(36).slice(2);function ug(r){if(!r[Qv]){r[Qv]=!0,P6.forEach(function(a){a!=="selectionchange"&&(ude.has(a)||zb(a,!1,r),zb(a,!0,r))});var i=r.nodeType===9?r:r.ownerDocument;i===null||i[Qv]||(i[Qv]=!0,zb("selectionchange",!1,i))}}function R8(r,i,a,l){switch(a8(i)){case 1:var u=Cle;break;case 4:u=ble;break;default:u=aN}a=u.bind(null,i,a,r),u=void 0,!jI||i!=="touchstart"&&i!=="touchmove"&&i!=="wheel"||(u=!0),l?u!==void 0?r.addEventListener(i,a,{capture:!0,passive:u}):r.addEventListener(i,a,!0):u!==void 0?r.addEventListener(i,a,{passive:u}):r.addEventListener(i,a,!1)}function Kb(r,i,a,l,u){var f=l;if(!(i&1)&&!(i&2)&&l!==null)e:for(;;){if(l===null)return;var _=l.tag;if(_===3||_===4){var v=l.stateNode.containerInfo;if(v===u||v.nodeType===8&&v.parentNode===u)break;if(_===4)for(_=l.return;_!==null;){var w=_.tag;if((w===3||w===4)&&(w=_.stateNode.containerInfo,w===u||w.nodeType===8&&w.parentNode===u))return;_=_.return}for(;v!==null;){if(_=Dd(v),_===null)return;if(w=_.tag,w===5||w===6){l=f=_;continue e}v=v.parentNode}}l=l.return}Y6(function(){var C=f,N=rN(a),D=[];e:{var O=T8.get(r);if(O!==void 0){var G=lN,F=r;switch(r){case"keypress":if(Sy(a)===0)break e;case"keydown":case"keyup":G=Ble;break;case"focusin":F="focus",G=Vb;break;case"focusout":F="blur",G=Vb;break;case"beforeblur":case"afterblur":G=Vb;break;case"click":if(a.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":G=q3;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":G=Nle;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":G=Gle;break;case E8:case v8:case y8:G=Dle;break;case S8:G=Kle;break;case"scroll":G=Ile;break;case"wheel":G=qle;break;case"copy":case"cut":case"paste":G=xle;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":G=$3}var V=(i&4)!==0,L=!V&&r==="scroll",B=V?O!==null?O+"Capture":null:O;V=[];for(var W=C,z;W!==null;){z=W;var $=z.stateNode;if(z.tag===5&&$!==null&&(z=$,B!==null&&($=og(W,B),$!=null&&V.push(hg(W,$,z)))),L)break;W=W.return}0<V.length&&(O=new G(O,F,null,a,N),D.push({event:O,listeners:V}))}}if(!(i&7)){e:{if(O=r==="mouseover"||r==="pointerover",G=r==="mouseout"||r==="pointerout",O&&a!==MI&&(F=a.relatedTarget||a.fromElement)&&(Dd(F)||F[fc]))break e;if((G||O)&&(O=N.window===N?N:(O=N.ownerDocument)?O.defaultView||O.parentWindow:window,G?(F=a.relatedTarget||a.toElement,G=C,F=F?Dd(F):null,F!==null&&(L=au(F),F!==L||F.tag!==5&&F.tag!==6)&&(F=null)):(G=null,F=C),G!==F)){if(V=q3,$="onMouseLeave",B="onMouseEnter",W="mouse",(r==="pointerout"||r==="pointerover")&&(V=$3,$="onPointerLeave",B="onPointerEnter",W="pointer"),L=G==null?O:Yh(G),z=F==null?O:Yh(F),O=new V($,W+"leave",G,a,N),O.target=L,O.relatedTarget=z,$=null,Dd(N)===C&&(V=new V(B,W+"enter",F,a,N),V.target=z,V.relatedTarget=L,$=V),L=$,G&&F)t:{for(V=G,B=F,W=0,z=V;z;z=Mh(z))W++;for(z=0,$=B;$;$=Mh($))z++;for(;0<W-z;)V=Mh(V),W--;for(;0<z-W;)B=Mh(B),z--;for(;W--;){if(V===B||B!==null&&V===B.alternate)break t;V=Mh(V),B=Mh(B)}V=null}else V=null;G!==null&&aB(D,O,G,V,!1),F!==null&&L!==null&&aB(D,L,F,V,!0)}}e:{if(O=C?Yh(C):window,G=O.nodeName&&O.nodeName.toLowerCase(),G==="select"||G==="input"&&O.type==="file")var te=tde;else if(Z3(O))if(p8)te=ode;else{te=rde;var ie=nde}else(G=O.nodeName)&&G.toLowerCase()==="input"&&(O.type==="checkbox"||O.type==="radio")&&(te=ide);if(te&&(te=te(r,C))){h8(D,te,a,N);break e}ie&&ie(r,O,C),r==="focusout"&&(ie=O._wrapperState)&&ie.controlled&&O.type==="number"&&PI(O,"number",O.value)}switch(ie=C?Yh(C):window,r){case"focusin":(Z3(ie)||ie.contentEditable==="true")&&(zh=ie,HI=C,$m=null);break;case"focusout":$m=HI=zh=null;break;case"mousedown":GI=!0;break;case"contextmenu":case"mouseup":case"dragend":GI=!1,iB(D,a,N);break;case"selectionchange":if(cde)break;case"keydown":case"keyup":iB(D,a,N)}var ce;if(uN)e:{switch(r){case"compositionstart":var pe="onCompositionStart";break e;case"compositionend":pe="onCompositionEnd";break e;case"compositionupdate":pe="onCompositionUpdate";break e}pe=void 0}else Gh?d8(r,a)&&(pe="onCompositionEnd"):r==="keydown"&&a.keyCode===229&&(pe="onCompositionStart");pe&&(l8&&a.locale!=="ko"&&(Gh||pe!=="onCompositionStart"?pe==="onCompositionEnd"&&Gh&&(ce=c8()):(fl=N,cN="value"in fl?fl.value:fl.textContent,Gh=!0)),ie=qy(C,pe),0<ie.length&&(pe=new X3(pe,r,null,a,N),D.push({event:pe,listeners:ie}),ce?pe.data=ce:(ce=u8(a),ce!==null&&(pe.data=ce)))),(ce=$le?Jle(r,a):Qle(r,a))&&(C=qy(C,"onBeforeInput"),0<C.length&&(N=new X3("onBeforeInput","beforeinput",null,a,N),D.push({event:N,listeners:C}),N.data=ce))}w8(D,i)})}function hg(r,i,a){return{instance:r,listener:i,currentTarget:a}}function qy(r,i){for(var a=i+"Capture",l=[];r!==null;){var u=r,f=u.stateNode;u.tag===5&&f!==null&&(u=f,f=og(r,a),f!=null&&l.unshift(hg(r,f,u)),f=og(r,i),f!=null&&l.push(hg(r,f,u))),r=r.return}return l}function Mh(r){if(r===null)return null;do r=r.return;while(r&&r.tag!==5);return r||null}function aB(r,i,a,l,u){for(var f=i._reactName,_=[];a!==null&&a!==l;){var v=a,w=v.alternate,C=v.stateNode;if(w!==null&&w===l)break;v.tag===5&&C!==null&&(v=C,u?(w=og(a,f),w!=null&&_.unshift(hg(a,w,v))):u||(w=og(a,f),w!=null&&_.push(hg(a,w,v)))),a=a.return}_.length!==0&&r.push({event:i,listeners:_})}var hde=/\r\n?/g,pde=/\u0000|\uFFFD/g;function cB(r){return(typeof r=="string"?r:""+r).replace(hde,`
`).replace(pde,"")}function Zv(r,i,a){if(i=cB(i),cB(r)!==i&&a)throw Error(Ue(425))}function Xy(){}var zI=null,KI=null;function YI(r,i){return r==="textarea"||r==="noscript"||typeof i.children=="string"||typeof i.children=="number"||typeof i.dangerouslySetInnerHTML=="object"&&i.dangerouslySetInnerHTML!==null&&i.dangerouslySetInnerHTML.__html!=null}var qI=typeof setTimeout=="function"?setTimeout:void 0,fde=typeof clearTimeout=="function"?clearTimeout:void 0,lB=typeof Promise=="function"?Promise:void 0,mde=typeof queueMicrotask=="function"?queueMicrotask:typeof lB<"u"?function(r){return lB.resolve(null).then(r).catch(gde)}:qI;function gde(r){setTimeout(function(){throw r})}function Yb(r,i){var a=i,l=0;do{var u=a.nextSibling;if(r.removeChild(a),u&&u.nodeType===8)if(a=u.data,a==="/$"){if(l===0){r.removeChild(u),cg(i);return}l--}else a!=="$"&&a!=="$?"&&a!=="$!"||l++;a=u}while(a);cg(i)}function Sl(r){for(;r!=null;r=r.nextSibling){var i=r.nodeType;if(i===1||i===3)break;if(i===8){if(i=r.data,i==="$"||i==="$!"||i==="$?")break;if(i==="/$")return null}}return r}function dB(r){r=r.previousSibling;for(var i=0;r;){if(r.nodeType===8){var a=r.data;if(a==="$"||a==="$!"||a==="$?"){if(i===0)return r;i--}else a==="/$"&&i++}r=r.previousSibling}return null}var Dp=Math.random().toString(36).slice(2),Na="__reactFiber$"+Dp,pg="__reactProps$"+Dp,fc="__reactContainer$"+Dp,XI="__reactEvents$"+Dp,_de="__reactListeners$"+Dp,Ede="__reactHandles$"+Dp;function Dd(r){var i=r[Na];if(i)return i;for(var a=r.parentNode;a;){if(i=a[fc]||a[Na]){if(a=i.alternate,i.child!==null||a!==null&&a.child!==null)for(r=dB(r);r!==null;){if(a=r[Na])return a;r=dB(r)}return i}r=a,a=r.parentNode}return null}function Mg(r){return r=r[Na]||r[fc],!r||r.tag!==5&&r.tag!==6&&r.tag!==13&&r.tag!==3?null:r}function Yh(r){if(r.tag===5||r.tag===6)return r.stateNode;throw Error(Ue(33))}function xS(r){return r[pg]||null}var $I=[],qh=-1;function Ml(r){return{current:r}}function tr(r){0>qh||(r.current=$I[qh],$I[qh]=null,qh--)}function Yn(r,i){qh++,$I[qh]=r.current,r.current=i}var Nl={},Ni=Ml(Nl),so=Ml(!1),Yd=Nl;function vp(r,i){var a=r.type.contextTypes;if(!a)return Nl;var l=r.stateNode;if(l&&l.__reactInternalMemoizedUnmaskedChildContext===i)return l.__reactInternalMemoizedMaskedChildContext;var u={},f;for(f in a)u[f]=i[f];return l&&(r=r.stateNode,r.__reactInternalMemoizedUnmaskedChildContext=i,r.__reactInternalMemoizedMaskedChildContext=u),u}function ao(r){return r=r.childContextTypes,r!=null}function $y(){tr(so),tr(Ni)}function uB(r,i,a){if(Ni.current!==Nl)throw Error(Ue(168));Yn(Ni,i),Yn(so,a)}function C8(r,i,a){var l=r.stateNode;if(i=i.childContextTypes,typeof l.getChildContext!="function")return a;l=l.getChildContext();for(var u in l)if(!(u in i))throw Error(Ue(108,nle(r)||"Unknown",u));return mr({},a,l)}function Jy(r){return r=(r=r.stateNode)&&r.__reactInternalMemoizedMergedChildContext||Nl,Yd=Ni.current,Yn(Ni,r),Yn(so,so.current),!0}function hB(r,i,a){var l=r.stateNode;if(!l)throw Error(Ue(169));a?(r=C8(r,i,Yd),l.__reactInternalMemoizedMergedChildContext=r,tr(so),tr(Ni),Yn(Ni,r)):tr(so),Yn(so,a)}var lc=null,LS=!1,qb=!1;function b8(r){lc===null?lc=[r]:lc.push(r)}function vde(r){LS=!0,b8(r)}function Ul(){if(!qb&&lc!==null){qb=!0;var r=0,i=xn;try{var a=lc;for(xn=1;r<a.length;r++){var l=a[r];do l=l(!0);while(l!==null)}lc=null,LS=!1}catch(u){throw lc!==null&&(lc=lc.slice(r+1)),J6(iN,Ul),u}finally{xn=i,qb=!1}}return null}var Xh=[],$h=0,Qy=null,Zy=0,ls=[],ds=0,qd=null,dc=1,uc="";function Ad(r,i){Xh[$h++]=Zy,Xh[$h++]=Qy,Qy=r,Zy=i}function I8(r,i,a){ls[ds++]=dc,ls[ds++]=uc,ls[ds++]=qd,qd=r;var l=dc;r=uc;var u=32-Hs(l)-1;l&=~(1<<u),a+=1;var f=32-Hs(i)+u;if(30<f){var _=u-u%5;f=(l&(1<<_)-1).toString(32),l>>=_,u-=_,dc=1<<32-Hs(i)+u|a<<u|l,uc=f+r}else dc=1<<f|a<<u|l,uc=r}function pN(r){r.return!==null&&(Ad(r,1),I8(r,1,0))}function fN(r){for(;r===Qy;)Qy=Xh[--$h],Xh[$h]=null,Zy=Xh[--$h],Xh[$h]=null;for(;r===qd;)qd=ls[--ds],ls[ds]=null,uc=ls[--ds],ls[ds]=null,dc=ls[--ds],ls[ds]=null}var Oo=null,Ao=null,or=!1,Bs=null;function A8(r,i){var a=us(5,null,null,0);a.elementType="DELETED",a.stateNode=i,a.return=r,i=r.deletions,i===null?(r.deletions=[a],r.flags|=16):i.push(a)}function pB(r,i){switch(r.tag){case 5:var a=r.type;return i=i.nodeType!==1||a.toLowerCase()!==i.nodeName.toLowerCase()?null:i,i!==null?(r.stateNode=i,Oo=r,Ao=Sl(i.firstChild),!0):!1;case 6:return i=r.pendingProps===""||i.nodeType!==3?null:i,i!==null?(r.stateNode=i,Oo=r,Ao=null,!0):!1;case 13:return i=i.nodeType!==8?null:i,i!==null?(a=qd!==null?{id:dc,overflow:uc}:null,r.memoizedState={dehydrated:i,treeContext:a,retryLane:1073741824},a=us(18,null,null,0),a.stateNode=i,a.return=r,r.child=a,Oo=r,Ao=null,!0):!1;default:return!1}}function JI(r){return(r.mode&1)!==0&&(r.flags&128)===0}function QI(r){if(or){var i=Ao;if(i){var a=i;if(!pB(r,i)){if(JI(r))throw Error(Ue(418));i=Sl(a.nextSibling);var l=Oo;i&&pB(r,i)?A8(l,a):(r.flags=r.flags&-4097|2,or=!1,Oo=r)}}else{if(JI(r))throw Error(Ue(418));r.flags=r.flags&-4097|2,or=!1,Oo=r}}}function fB(r){for(r=r.return;r!==null&&r.tag!==5&&r.tag!==3&&r.tag!==13;)r=r.return;Oo=r}function ey(r){if(r!==Oo)return!1;if(!or)return fB(r),or=!0,!1;var i;if((i=r.tag!==3)&&!(i=r.tag!==5)&&(i=r.type,i=i!=="head"&&i!=="body"&&!YI(r.type,r.memoizedProps)),i&&(i=Ao)){if(JI(r))throw N8(),Error(Ue(418));for(;i;)A8(r,i),i=Sl(i.nextSibling)}if(fB(r),r.tag===13){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(Ue(317));e:{for(r=r.nextSibling,i=0;r;){if(r.nodeType===8){var a=r.data;if(a==="/$"){if(i===0){Ao=Sl(r.nextSibling);break e}i--}else a!=="$"&&a!=="$!"&&a!=="$?"||i++}r=r.nextSibling}Ao=null}}else Ao=Oo?Sl(r.stateNode.nextSibling):null;return!0}function N8(){for(var r=Ao;r;)r=Sl(r.nextSibling)}function yp(){Ao=Oo=null,or=!1}function mN(r){Bs===null?Bs=[r]:Bs.push(r)}var yde=vc.ReactCurrentBatchConfig;function Om(r,i,a){if(r=a.ref,r!==null&&typeof r!="function"&&typeof r!="object"){if(a._owner){if(a=a._owner,a){if(a.tag!==1)throw Error(Ue(309));var l=a.stateNode}if(!l)throw Error(Ue(147,r));var u=l,f=""+r;return i!==null&&i.ref!==null&&typeof i.ref=="function"&&i.ref._stringRef===f?i.ref:(i=function(_){var v=u.refs;_===null?delete v[f]:v[f]=_},i._stringRef=f,i)}if(typeof r!="string")throw Error(Ue(284));if(!a._owner)throw Error(Ue(290,r))}return r}function ty(r,i){throw r=Object.prototype.toString.call(i),Error(Ue(31,r==="[object Object]"?"object with keys {"+Object.keys(i).join(", ")+"}":r))}function mB(r){var i=r._init;return i(r._payload)}function O8(r){function i(B,W){if(r){var z=B.deletions;z===null?(B.deletions=[W],B.flags|=16):z.push(W)}}function a(B,W){if(!r)return null;for(;W!==null;)i(B,W),W=W.sibling;return null}function l(B,W){for(B=new Map;W!==null;)W.key!==null?B.set(W.key,W):B.set(W.index,W),W=W.sibling;return B}function u(B,W){return B=Cl(B,W),B.index=0,B.sibling=null,B}function f(B,W,z){return B.index=z,r?(z=B.alternate,z!==null?(z=z.index,z<W?(B.flags|=2,W):z):(B.flags|=2,W)):(B.flags|=1048576,W)}function _(B){return r&&B.alternate===null&&(B.flags|=2),B}function v(B,W,z,$){return W===null||W.tag!==6?(W=tI(z,B.mode,$),W.return=B,W):(W=u(W,z),W.return=B,W)}function w(B,W,z,$){var te=z.type;return te===Hh?N(B,W,z.props.children,$,z.key):W!==null&&(W.elementType===te||typeof te=="object"&&te!==null&&te.$$typeof===ol&&mB(te)===W.type)?($=u(W,z.props),$.ref=Om(B,W,z),$.return=B,$):($=Ay(z.type,z.key,z.props,null,B.mode,$),$.ref=Om(B,W,z),$.return=B,$)}function C(B,W,z,$){return W===null||W.tag!==4||W.stateNode.containerInfo!==z.containerInfo||W.stateNode.implementation!==z.implementation?(W=nI(z,B.mode,$),W.return=B,W):(W=u(W,z.children||[]),W.return=B,W)}function N(B,W,z,$,te){return W===null||W.tag!==7?(W=Wd(z,B.mode,$,te),W.return=B,W):(W=u(W,z),W.return=B,W)}function D(B,W,z){if(typeof W=="string"&&W!==""||typeof W=="number")return W=tI(""+W,B.mode,z),W.return=B,W;if(typeof W=="object"&&W!==null){switch(W.$$typeof){case Gv:return z=Ay(W.type,W.key,W.props,null,B.mode,z),z.ref=Om(B,null,W),z.return=B,z;case Wh:return W=nI(W,B.mode,z),W.return=B,W;case ol:var $=W._init;return D(B,$(W._payload),z)}if(Bm(W)||Cm(W))return W=Wd(W,B.mode,z,null),W.return=B,W;ty(B,W)}return null}function O(B,W,z,$){var te=W!==null?W.key:null;if(typeof z=="string"&&z!==""||typeof z=="number")return te!==null?null:v(B,W,""+z,$);if(typeof z=="object"&&z!==null){switch(z.$$typeof){case Gv:return z.key===te?w(B,W,z,$):null;case Wh:return z.key===te?C(B,W,z,$):null;case ol:return te=z._init,O(B,W,te(z._payload),$)}if(Bm(z)||Cm(z))return te!==null?null:N(B,W,z,$,null);ty(B,z)}return null}function G(B,W,z,$,te){if(typeof $=="string"&&$!==""||typeof $=="number")return B=B.get(z)||null,v(W,B,""+$,te);if(typeof $=="object"&&$!==null){switch($.$$typeof){case Gv:return B=B.get($.key===null?z:$.key)||null,w(W,B,$,te);case Wh:return B=B.get($.key===null?z:$.key)||null,C(W,B,$,te);case ol:var ie=$._init;return G(B,W,z,ie($._payload),te)}if(Bm($)||Cm($))return B=B.get(z)||null,N(W,B,$,te,null);ty(W,$)}return null}function F(B,W,z,$){for(var te=null,ie=null,ce=W,pe=W=0,Pe=null;ce!==null&&pe<z.length;pe++){ce.index>pe?(Pe=ce,ce=null):Pe=ce.sibling;var _e=O(B,ce,z[pe],$);if(_e===null){ce===null&&(ce=Pe);break}r&&ce&&_e.alternate===null&&i(B,ce),W=f(_e,W,pe),ie===null?te=_e:ie.sibling=_e,ie=_e,ce=Pe}if(pe===z.length)return a(B,ce),or&&Ad(B,pe),te;if(ce===null){for(;pe<z.length;pe++)ce=D(B,z[pe],$),ce!==null&&(W=f(ce,W,pe),ie===null?te=ce:ie.sibling=ce,ie=ce);return or&&Ad(B,pe),te}for(ce=l(B,ce);pe<z.length;pe++)Pe=G(ce,B,pe,z[pe],$),Pe!==null&&(r&&Pe.alternate!==null&&ce.delete(Pe.key===null?pe:Pe.key),W=f(Pe,W,pe),ie===null?te=Pe:ie.sibling=Pe,ie=Pe);return r&&ce.forEach(function(ge){return i(B,ge)}),or&&Ad(B,pe),te}function V(B,W,z,$){var te=Cm(z);if(typeof te!="function")throw Error(Ue(150));if(z=te.call(z),z==null)throw Error(Ue(151));for(var ie=te=null,ce=W,pe=W=0,Pe=null,_e=z.next();ce!==null&&!_e.done;pe++,_e=z.next()){ce.index>pe?(Pe=ce,ce=null):Pe=ce.sibling;var ge=O(B,ce,_e.value,$);if(ge===null){ce===null&&(ce=Pe);break}r&&ce&&ge.alternate===null&&i(B,ce),W=f(ge,W,pe),ie===null?te=ge:ie.sibling=ge,ie=ge,ce=Pe}if(_e.done)return a(B,ce),or&&Ad(B,pe),te;if(ce===null){for(;!_e.done;pe++,_e=z.next())_e=D(B,_e.value,$),_e!==null&&(W=f(_e,W,pe),ie===null?te=_e:ie.sibling=_e,ie=_e);return or&&Ad(B,pe),te}for(ce=l(B,ce);!_e.done;pe++,_e=z.next())_e=G(ce,B,pe,_e.value,$),_e!==null&&(r&&_e.alternate!==null&&ce.delete(_e.key===null?pe:_e.key),W=f(_e,W,pe),ie===null?te=_e:ie.sibling=_e,ie=_e);return r&&ce.forEach(function(fe){return i(B,fe)}),or&&Ad(B,pe),te}function L(B,W,z,$){if(typeof z=="object"&&z!==null&&z.type===Hh&&z.key===null&&(z=z.props.children),typeof z=="object"&&z!==null){switch(z.$$typeof){case Gv:e:{for(var te=z.key,ie=W;ie!==null;){if(ie.key===te){if(te=z.type,te===Hh){if(ie.tag===7){a(B,ie.sibling),W=u(ie,z.props.children),W.return=B,B=W;break e}}else if(ie.elementType===te||typeof te=="object"&&te!==null&&te.$$typeof===ol&&mB(te)===ie.type){a(B,ie.sibling),W=u(ie,z.props),W.ref=Om(B,ie,z),W.return=B,B=W;break e}a(B,ie);break}else i(B,ie);ie=ie.sibling}z.type===Hh?(W=Wd(z.props.children,B.mode,$,z.key),W.return=B,B=W):($=Ay(z.type,z.key,z.props,null,B.mode,$),$.ref=Om(B,W,z),$.return=B,B=$)}return _(B);case Wh:e:{for(ie=z.key;W!==null;){if(W.key===ie)if(W.tag===4&&W.stateNode.containerInfo===z.containerInfo&&W.stateNode.implementation===z.implementation){a(B,W.sibling),W=u(W,z.children||[]),W.return=B,B=W;break e}else{a(B,W);break}else i(B,W);W=W.sibling}W=nI(z,B.mode,$),W.return=B,B=W}return _(B);case ol:return ie=z._init,L(B,W,ie(z._payload),$)}if(Bm(z))return F(B,W,z,$);if(Cm(z))return V(B,W,z,$);ty(B,z)}return typeof z=="string"&&z!==""||typeof z=="number"?(z=""+z,W!==null&&W.tag===6?(a(B,W.sibling),W=u(W,z),W.return=B,B=W):(a(B,W),W=tI(z,B.mode,$),W.return=B,B=W),_(B)):a(B,W)}return L}var Sp=O8(!0),P8=O8(!1),eS=Ml(null),tS=null,Jh=null,gN=null;function _N(){gN=Jh=tS=null}function EN(r){var i=eS.current;tr(eS),r._currentValue=i}function ZI(r,i,a){for(;r!==null;){var l=r.alternate;if((r.childLanes&i)!==i?(r.childLanes|=i,l!==null&&(l.childLanes|=i)):l!==null&&(l.childLanes&i)!==i&&(l.childLanes|=i),r===a)break;r=r.return}}function ip(r,i){tS=r,gN=Jh=null,r=r.dependencies,r!==null&&r.firstContext!==null&&(r.lanes&i&&(oo=!0),r.firstContext=null)}function ps(r){var i=r._currentValue;if(gN!==r)if(r={context:r,memoizedValue:i,next:null},Jh===null){if(tS===null)throw Error(Ue(308));Jh=r,tS.dependencies={lanes:0,firstContext:r}}else Jh=Jh.next=r;return i}var kd=null;function vN(r){kd===null?kd=[r]:kd.push(r)}function D8(r,i,a,l){var u=i.interleaved;return u===null?(a.next=a,vN(i)):(a.next=u.next,u.next=a),i.interleaved=a,mc(r,l)}function mc(r,i){r.lanes|=i;var a=r.alternate;for(a!==null&&(a.lanes|=i),a=r,r=r.return;r!==null;)r.childLanes|=i,a=r.alternate,a!==null&&(a.childLanes|=i),a=r,r=r.return;return a.tag===3?a.stateNode:null}var sl=!1;function yN(r){r.updateQueue={baseState:r.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function k8(r,i){r=r.updateQueue,i.updateQueue===r&&(i.updateQueue={baseState:r.baseState,firstBaseUpdate:r.firstBaseUpdate,lastBaseUpdate:r.lastBaseUpdate,shared:r.shared,effects:r.effects})}function hc(r,i){return{eventTime:r,lane:i,tag:0,payload:null,callback:null,next:null}}function Tl(r,i,a){var l=r.updateQueue;if(l===null)return null;if(l=l.shared,yn&2){var u=l.pending;return u===null?i.next=i:(i.next=u.next,u.next=i),l.pending=i,mc(r,a)}return u=l.interleaved,u===null?(i.next=i,vN(l)):(i.next=u.next,u.next=i),l.interleaved=i,mc(r,a)}function Ty(r,i,a){if(i=i.updateQueue,i!==null&&(i=i.shared,(a&4194240)!==0)){var l=i.lanes;l&=r.pendingLanes,a|=l,i.lanes=a,oN(r,a)}}function gB(r,i){var a=r.updateQueue,l=r.alternate;if(l!==null&&(l=l.updateQueue,a===l)){var u=null,f=null;if(a=a.firstBaseUpdate,a!==null){do{var _={eventTime:a.eventTime,lane:a.lane,tag:a.tag,payload:a.payload,callback:a.callback,next:null};f===null?u=f=_:f=f.next=_,a=a.next}while(a!==null);f===null?u=f=i:f=f.next=i}else u=f=i;a={baseState:l.baseState,firstBaseUpdate:u,lastBaseUpdate:f,shared:l.shared,effects:l.effects},r.updateQueue=a;return}r=a.lastBaseUpdate,r===null?a.firstBaseUpdate=i:r.next=i,a.lastBaseUpdate=i}function nS(r,i,a,l){var u=r.updateQueue;sl=!1;var f=u.firstBaseUpdate,_=u.lastBaseUpdate,v=u.shared.pending;if(v!==null){u.shared.pending=null;var w=v,C=w.next;w.next=null,_===null?f=C:_.next=C,_=w;var N=r.alternate;N!==null&&(N=N.updateQueue,v=N.lastBaseUpdate,v!==_&&(v===null?N.firstBaseUpdate=C:v.next=C,N.lastBaseUpdate=w))}if(f!==null){var D=u.baseState;_=0,N=C=w=null,v=f;do{var O=v.lane,G=v.eventTime;if((l&O)===O){N!==null&&(N=N.next={eventTime:G,lane:0,tag:v.tag,payload:v.payload,callback:v.callback,next:null});e:{var F=r,V=v;switch(O=i,G=a,V.tag){case 1:if(F=V.payload,typeof F=="function"){D=F.call(G,D,O);break e}D=F;break e;case 3:F.flags=F.flags&-65537|128;case 0:if(F=V.payload,O=typeof F=="function"?F.call(G,D,O):F,O==null)break e;D=mr({},D,O);break e;case 2:sl=!0}}v.callback!==null&&v.lane!==0&&(r.flags|=64,O=u.effects,O===null?u.effects=[v]:O.push(v))}else G={eventTime:G,lane:O,tag:v.tag,payload:v.payload,callback:v.callback,next:null},N===null?(C=N=G,w=D):N=N.next=G,_|=O;if(v=v.next,v===null){if(v=u.shared.pending,v===null)break;O=v,v=O.next,O.next=null,u.lastBaseUpdate=O,u.shared.pending=null}}while(!0);if(N===null&&(w=D),u.baseState=w,u.firstBaseUpdate=C,u.lastBaseUpdate=N,i=u.shared.interleaved,i!==null){u=i;do _|=u.lane,u=u.next;while(u!==i)}else f===null&&(u.shared.lanes=0);$d|=_,r.lanes=_,r.memoizedState=D}}function _B(r,i,a){if(r=i.effects,i.effects=null,r!==null)for(i=0;i<r.length;i++){var l=r[i],u=l.callback;if(u!==null){if(l.callback=null,l=a,typeof u!="function")throw Error(Ue(191,u));u.call(l)}}}var Ug={},Da=Ml(Ug),fg=Ml(Ug),mg=Ml(Ug);function xd(r){if(r===Ug)throw Error(Ue(174));return r}function SN(r,i){switch(Yn(mg,i),Yn(fg,r),Yn(Da,Ug),r=i.nodeType,r){case 9:case 11:i=(i=i.documentElement)?i.namespaceURI:kI(null,"");break;default:r=r===8?i.parentNode:i,i=r.namespaceURI||null,r=r.tagName,i=kI(i,r)}tr(Da),Yn(Da,i)}function Tp(){tr(Da),tr(fg),tr(mg)}function x8(r){xd(mg.current);var i=xd(Da.current),a=kI(i,r.type);i!==a&&(Yn(fg,r),Yn(Da,a))}function TN(r){fg.current===r&&(tr(Da),tr(fg))}var hr=Ml(0);function rS(r){for(var i=r;i!==null;){if(i.tag===13){var a=i.memoizedState;if(a!==null&&(a=a.dehydrated,a===null||a.data==="$?"||a.data==="$!"))return i}else if(i.tag===19&&i.memoizedProps.revealOrder!==void 0){if(i.flags&128)return i}else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===r)break;for(;i.sibling===null;){if(i.return===null||i.return===r)return null;i=i.return}i.sibling.return=i.return,i=i.sibling}return null}var Xb=[];function wN(){for(var r=0;r<Xb.length;r++)Xb[r]._workInProgressVersionPrimary=null;Xb.length=0}var wy=vc.ReactCurrentDispatcher,$b=vc.ReactCurrentBatchConfig,Xd=0,fr=null,Yr=null,ri=null,iS=!1,Jm=!1,gg=0,Sde=0;function wi(){throw Error(Ue(321))}function RN(r,i){if(i===null)return!1;for(var a=0;a<i.length&&a<r.length;a++)if(!zs(r[a],i[a]))return!1;return!0}function CN(r,i,a,l,u,f){if(Xd=f,fr=i,i.memoizedState=null,i.updateQueue=null,i.lanes=0,wy.current=r===null||r.memoizedState===null?Cde:bde,r=a(l,u),Jm){f=0;do{if(Jm=!1,gg=0,25<=f)throw Error(Ue(301));f+=1,ri=Yr=null,i.updateQueue=null,wy.current=Ide,r=a(l,u)}while(Jm)}if(wy.current=oS,i=Yr!==null&&Yr.next!==null,Xd=0,ri=Yr=fr=null,iS=!1,i)throw Error(Ue(300));return r}function bN(){var r=gg!==0;return gg=0,r}function Ca(){var r={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ri===null?fr.memoizedState=ri=r:ri=ri.next=r,ri}function fs(){if(Yr===null){var r=fr.alternate;r=r!==null?r.memoizedState:null}else r=Yr.next;var i=ri===null?fr.memoizedState:ri.next;if(i!==null)ri=i,Yr=r;else{if(r===null)throw Error(Ue(310));Yr=r,r={memoizedState:Yr.memoizedState,baseState:Yr.baseState,baseQueue:Yr.baseQueue,queue:Yr.queue,next:null},ri===null?fr.memoizedState=ri=r:ri=ri.next=r}return ri}function _g(r,i){return typeof i=="function"?i(r):i}function Jb(r){var i=fs(),a=i.queue;if(a===null)throw Error(Ue(311));a.lastRenderedReducer=r;var l=Yr,u=l.baseQueue,f=a.pending;if(f!==null){if(u!==null){var _=u.next;u.next=f.next,f.next=_}l.baseQueue=u=f,a.pending=null}if(u!==null){f=u.next,l=l.baseState;var v=_=null,w=null,C=f;do{var N=C.lane;if((Xd&N)===N)w!==null&&(w=w.next={lane:0,action:C.action,hasEagerState:C.hasEagerState,eagerState:C.eagerState,next:null}),l=C.hasEagerState?C.eagerState:r(l,C.action);else{var D={lane:N,action:C.action,hasEagerState:C.hasEagerState,eagerState:C.eagerState,next:null};w===null?(v=w=D,_=l):w=w.next=D,fr.lanes|=N,$d|=N}C=C.next}while(C!==null&&C!==f);w===null?_=l:w.next=v,zs(l,i.memoizedState)||(oo=!0),i.memoizedState=l,i.baseState=_,i.baseQueue=w,a.lastRenderedState=l}if(r=a.interleaved,r!==null){u=r;do f=u.lane,fr.lanes|=f,$d|=f,u=u.next;while(u!==r)}else u===null&&(a.lanes=0);return[i.memoizedState,a.dispatch]}function Qb(r){var i=fs(),a=i.queue;if(a===null)throw Error(Ue(311));a.lastRenderedReducer=r;var l=a.dispatch,u=a.pending,f=i.memoizedState;if(u!==null){a.pending=null;var _=u=u.next;do f=r(f,_.action),_=_.next;while(_!==u);zs(f,i.memoizedState)||(oo=!0),i.memoizedState=f,i.baseQueue===null&&(i.baseState=f),a.lastRenderedState=f}return[f,l]}function L8(){}function M8(r,i){var a=fr,l=fs(),u=i(),f=!zs(l.memoizedState,u);if(f&&(l.memoizedState=u,oo=!0),l=l.queue,IN(V8.bind(null,a,l,r),[r]),l.getSnapshot!==i||f||ri!==null&&ri.memoizedState.tag&1){if(a.flags|=2048,Eg(9,j8.bind(null,a,l,u,i),void 0,null),ii===null)throw Error(Ue(349));Xd&30||U8(a,i,u)}return u}function U8(r,i,a){r.flags|=16384,r={getSnapshot:i,value:a},i=fr.updateQueue,i===null?(i={lastEffect:null,stores:null},fr.updateQueue=i,i.stores=[r]):(a=i.stores,a===null?i.stores=[r]:a.push(r))}function j8(r,i,a,l){i.value=a,i.getSnapshot=l,F8(i)&&B8(r)}function V8(r,i,a){return a(function(){F8(i)&&B8(r)})}function F8(r){var i=r.getSnapshot;r=r.value;try{var a=i();return!zs(r,a)}catch{return!0}}function B8(r){var i=mc(r,1);i!==null&&Gs(i,r,1,-1)}function EB(r){var i=Ca();return typeof r=="function"&&(r=r()),i.memoizedState=i.baseState=r,r={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:_g,lastRenderedState:r},i.queue=r,r=r.dispatch=Rde.bind(null,fr,r),[i.memoizedState,r]}function Eg(r,i,a,l){return r={tag:r,create:i,destroy:a,deps:l,next:null},i=fr.updateQueue,i===null?(i={lastEffect:null,stores:null},fr.updateQueue=i,i.lastEffect=r.next=r):(a=i.lastEffect,a===null?i.lastEffect=r.next=r:(l=a.next,a.next=r,r.next=l,i.lastEffect=r)),r}function W8(){return fs().memoizedState}function Ry(r,i,a,l){var u=Ca();fr.flags|=r,u.memoizedState=Eg(1|i,a,void 0,l===void 0?null:l)}function MS(r,i,a,l){var u=fs();l=l===void 0?null:l;var f=void 0;if(Yr!==null){var _=Yr.memoizedState;if(f=_.destroy,l!==null&&RN(l,_.deps)){u.memoizedState=Eg(i,a,f,l);return}}fr.flags|=r,u.memoizedState=Eg(1|i,a,f,l)}function vB(r,i){return Ry(8390656,8,r,i)}function IN(r,i){return MS(2048,8,r,i)}function H8(r,i){return MS(4,2,r,i)}function G8(r,i){return MS(4,4,r,i)}function z8(r,i){if(typeof i=="function")return r=r(),i(r),function(){i(null)};if(i!=null)return r=r(),i.current=r,function(){i.current=null}}function K8(r,i,a){return a=a!=null?a.concat([r]):null,MS(4,4,z8.bind(null,i,r),a)}function AN(){}function Y8(r,i){var a=fs();i=i===void 0?null:i;var l=a.memoizedState;return l!==null&&i!==null&&RN(i,l[1])?l[0]:(a.memoizedState=[r,i],r)}function q8(r,i){var a=fs();i=i===void 0?null:i;var l=a.memoizedState;return l!==null&&i!==null&&RN(i,l[1])?l[0]:(r=r(),a.memoizedState=[r,i],r)}function X8(r,i,a){return Xd&21?(zs(a,i)||(a=e8(),fr.lanes|=a,$d|=a,r.baseState=!0),i):(r.baseState&&(r.baseState=!1,oo=!0),r.memoizedState=a)}function Tde(r,i){var a=xn;xn=a!==0&&4>a?a:4,r(!0);var l=$b.transition;$b.transition={};try{r(!1),i()}finally{xn=a,$b.transition=l}}function $8(){return fs().memoizedState}function wde(r,i,a){var l=Rl(r);if(a={lane:l,action:a,hasEagerState:!1,eagerState:null,next:null},J8(r))Q8(i,a);else if(a=D8(r,i,a,l),a!==null){var u=Fi();Gs(a,r,l,u),Z8(a,i,l)}}function Rde(r,i,a){var l=Rl(r),u={lane:l,action:a,hasEagerState:!1,eagerState:null,next:null};if(J8(r))Q8(i,u);else{var f=r.alternate;if(r.lanes===0&&(f===null||f.lanes===0)&&(f=i.lastRenderedReducer,f!==null))try{var _=i.lastRenderedState,v=f(_,a);if(u.hasEagerState=!0,u.eagerState=v,zs(v,_)){var w=i.interleaved;w===null?(u.next=u,vN(i)):(u.next=w.next,w.next=u),i.interleaved=u;return}}catch{}finally{}a=D8(r,i,u,l),a!==null&&(u=Fi(),Gs(a,r,l,u),Z8(a,i,l))}}function J8(r){var i=r.alternate;return r===fr||i!==null&&i===fr}function Q8(r,i){Jm=iS=!0;var a=r.pending;a===null?i.next=i:(i.next=a.next,a.next=i),r.pending=i}function Z8(r,i,a){if(a&4194240){var l=i.lanes;l&=r.pendingLanes,a|=l,i.lanes=a,oN(r,a)}}var oS={readContext:ps,useCallback:wi,useContext:wi,useEffect:wi,useImperativeHandle:wi,useInsertionEffect:wi,useLayoutEffect:wi,useMemo:wi,useReducer:wi,useRef:wi,useState:wi,useDebugValue:wi,useDeferredValue:wi,useTransition:wi,useMutableSource:wi,useSyncExternalStore:wi,useId:wi,unstable_isNewReconciler:!1},Cde={readContext:ps,useCallback:function(r,i){return Ca().memoizedState=[r,i===void 0?null:i],r},useContext:ps,useEffect:vB,useImperativeHandle:function(r,i,a){return a=a!=null?a.concat([r]):null,Ry(4194308,4,z8.bind(null,i,r),a)},useLayoutEffect:function(r,i){return Ry(4194308,4,r,i)},useInsertionEffect:function(r,i){return Ry(4,2,r,i)},useMemo:function(r,i){var a=Ca();return i=i===void 0?null:i,r=r(),a.memoizedState=[r,i],r},useReducer:function(r,i,a){var l=Ca();return i=a!==void 0?a(i):i,l.memoizedState=l.baseState=i,r={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:r,lastRenderedState:i},l.queue=r,r=r.dispatch=wde.bind(null,fr,r),[l.memoizedState,r]},useRef:function(r){var i=Ca();return r={current:r},i.memoizedState=r},useState:EB,useDebugValue:AN,useDeferredValue:function(r){return Ca().memoizedState=r},useTransition:function(){var r=EB(!1),i=r[0];return r=Tde.bind(null,r[1]),Ca().memoizedState=r,[i,r]},useMutableSource:function(){},useSyncExternalStore:function(r,i,a){var l=fr,u=Ca();if(or){if(a===void 0)throw Error(Ue(407));a=a()}else{if(a=i(),ii===null)throw Error(Ue(349));Xd&30||U8(l,i,a)}u.memoizedState=a;var f={value:a,getSnapshot:i};return u.queue=f,vB(V8.bind(null,l,f,r),[r]),l.flags|=2048,Eg(9,j8.bind(null,l,f,a,i),void 0,null),a},useId:function(){var r=Ca(),i=ii.identifierPrefix;if(or){var a=uc,l=dc;a=(l&~(1<<32-Hs(l)-1)).toString(32)+a,i=":"+i+"R"+a,a=gg++,0<a&&(i+="H"+a.toString(32)),i+=":"}else a=Sde++,i=":"+i+"r"+a.toString(32)+":";return r.memoizedState=i},unstable_isNewReconciler:!1},bde={readContext:ps,useCallback:Y8,useContext:ps,useEffect:IN,useImperativeHandle:K8,useInsertionEffect:H8,useLayoutEffect:G8,useMemo:q8,useReducer:Jb,useRef:W8,useState:function(){return Jb(_g)},useDebugValue:AN,useDeferredValue:function(r){var i=fs();return X8(i,Yr.memoizedState,r)},useTransition:function(){var r=Jb(_g)[0],i=fs().memoizedState;return[r,i]},useMutableSource:L8,useSyncExternalStore:M8,useId:$8,unstable_isNewReconciler:!1},Ide={readContext:ps,useCallback:Y8,useContext:ps,useEffect:IN,useImperativeHandle:K8,useInsertionEffect:H8,useLayoutEffect:G8,useMemo:q8,useReducer:Qb,useRef:W8,useState:function(){return Qb(_g)},useDebugValue:AN,useDeferredValue:function(r){var i=fs();return Yr===null?i.memoizedState=r:X8(i,Yr.memoizedState,r)},useTransition:function(){var r=Qb(_g)[0],i=fs().memoizedState;return[r,i]},useMutableSource:L8,useSyncExternalStore:M8,useId:$8,unstable_isNewReconciler:!1};function Ms(r,i){if(r&&r.defaultProps){i=mr({},i),r=r.defaultProps;for(var a in r)i[a]===void 0&&(i[a]=r[a]);return i}return i}function eA(r,i,a,l){i=r.memoizedState,a=a(l,i),a=a==null?i:mr({},i,a),r.memoizedState=a,r.lanes===0&&(r.updateQueue.baseState=a)}var US={isMounted:function(r){return(r=r._reactInternals)?au(r)===r:!1},enqueueSetState:function(r,i,a){r=r._reactInternals;var l=Fi(),u=Rl(r),f=hc(l,u);f.payload=i,a!=null&&(f.callback=a),i=Tl(r,f,u),i!==null&&(Gs(i,r,u,l),Ty(i,r,u))},enqueueReplaceState:function(r,i,a){r=r._reactInternals;var l=Fi(),u=Rl(r),f=hc(l,u);f.tag=1,f.payload=i,a!=null&&(f.callback=a),i=Tl(r,f,u),i!==null&&(Gs(i,r,u,l),Ty(i,r,u))},enqueueForceUpdate:function(r,i){r=r._reactInternals;var a=Fi(),l=Rl(r),u=hc(a,l);u.tag=2,i!=null&&(u.callback=i),i=Tl(r,u,l),i!==null&&(Gs(i,r,l,a),Ty(i,r,l))}};function yB(r,i,a,l,u,f,_){return r=r.stateNode,typeof r.shouldComponentUpdate=="function"?r.shouldComponentUpdate(l,f,_):i.prototype&&i.prototype.isPureReactComponent?!dg(a,l)||!dg(u,f):!0}function eW(r,i,a){var l=!1,u=Nl,f=i.contextType;return typeof f=="object"&&f!==null?f=ps(f):(u=ao(i)?Yd:Ni.current,l=i.contextTypes,f=(l=l!=null)?vp(r,u):Nl),i=new i(a,f),r.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,i.updater=US,r.stateNode=i,i._reactInternals=r,l&&(r=r.stateNode,r.__reactInternalMemoizedUnmaskedChildContext=u,r.__reactInternalMemoizedMaskedChildContext=f),i}function SB(r,i,a,l){r=i.state,typeof i.componentWillReceiveProps=="function"&&i.componentWillReceiveProps(a,l),typeof i.UNSAFE_componentWillReceiveProps=="function"&&i.UNSAFE_componentWillReceiveProps(a,l),i.state!==r&&US.enqueueReplaceState(i,i.state,null)}function tA(r,i,a,l){var u=r.stateNode;u.props=a,u.state=r.memoizedState,u.refs={},yN(r);var f=i.contextType;typeof f=="object"&&f!==null?u.context=ps(f):(f=ao(i)?Yd:Ni.current,u.context=vp(r,f)),u.state=r.memoizedState,f=i.getDerivedStateFromProps,typeof f=="function"&&(eA(r,i,f,a),u.state=r.memoizedState),typeof i.getDerivedStateFromProps=="function"||typeof u.getSnapshotBeforeUpdate=="function"||typeof u.UNSAFE_componentWillMount!="function"&&typeof u.componentWillMount!="function"||(i=u.state,typeof u.componentWillMount=="function"&&u.componentWillMount(),typeof u.UNSAFE_componentWillMount=="function"&&u.UNSAFE_componentWillMount(),i!==u.state&&US.enqueueReplaceState(u,u.state,null),nS(r,a,u,l),u.state=r.memoizedState),typeof u.componentDidMount=="function"&&(r.flags|=4194308)}function wp(r,i){try{var a="",l=i;do a+=tle(l),l=l.return;while(l);var u=a}catch(f){u=`
Error generating stack: `+f.message+`
`+f.stack}return{value:r,source:i,stack:u,digest:null}}function Zb(r,i,a){return{value:r,source:null,stack:a??null,digest:i??null}}function nA(r,i){try{console.error(i.value)}catch(a){setTimeout(function(){throw a})}}var Ade=typeof WeakMap=="function"?WeakMap:Map;function tW(r,i,a){a=hc(-1,a),a.tag=3,a.payload={element:null};var l=i.value;return a.callback=function(){aS||(aS=!0,hA=l),nA(r,i)},a}function nW(r,i,a){a=hc(-1,a),a.tag=3;var l=r.type.getDerivedStateFromError;if(typeof l=="function"){var u=i.value;a.payload=function(){return l(u)},a.callback=function(){nA(r,i)}}var f=r.stateNode;return f!==null&&typeof f.componentDidCatch=="function"&&(a.callback=function(){nA(r,i),typeof l!="function"&&(wl===null?wl=new Set([this]):wl.add(this));var _=i.stack;this.componentDidCatch(i.value,{componentStack:_!==null?_:""})}),a}function TB(r,i,a){var l=r.pingCache;if(l===null){l=r.pingCache=new Ade;var u=new Set;l.set(i,u)}else u=l.get(i),u===void 0&&(u=new Set,l.set(i,u));u.has(a)||(u.add(a),r=Wde.bind(null,r,i,a),i.then(r,r))}function wB(r){do{var i;if((i=r.tag===13)&&(i=r.memoizedState,i=i!==null?i.dehydrated!==null:!0),i)return r;r=r.return}while(r!==null);return null}function RB(r,i,a,l,u){return r.mode&1?(r.flags|=65536,r.lanes=u,r):(r===i?r.flags|=65536:(r.flags|=128,a.flags|=131072,a.flags&=-52805,a.tag===1&&(a.alternate===null?a.tag=17:(i=hc(-1,1),i.tag=2,Tl(a,i,1))),a.lanes|=1),r)}var Nde=vc.ReactCurrentOwner,oo=!1;function ji(r,i,a,l){i.child=r===null?P8(i,null,a,l):Sp(i,r.child,a,l)}function CB(r,i,a,l,u){a=a.render;var f=i.ref;return ip(i,u),l=CN(r,i,a,l,f,u),a=bN(),r!==null&&!oo?(i.updateQueue=r.updateQueue,i.flags&=-2053,r.lanes&=~u,gc(r,i,u)):(or&&a&&pN(i),i.flags|=1,ji(r,i,l,u),i.child)}function bB(r,i,a,l,u){if(r===null){var f=a.type;return typeof f=="function"&&!MN(f)&&f.defaultProps===void 0&&a.compare===null&&a.defaultProps===void 0?(i.tag=15,i.type=f,rW(r,i,f,l,u)):(r=Ay(a.type,null,l,i,i.mode,u),r.ref=i.ref,r.return=i,i.child=r)}if(f=r.child,!(r.lanes&u)){var _=f.memoizedProps;if(a=a.compare,a=a!==null?a:dg,a(_,l)&&r.ref===i.ref)return gc(r,i,u)}return i.flags|=1,r=Cl(f,l),r.ref=i.ref,r.return=i,i.child=r}function rW(r,i,a,l,u){if(r!==null){var f=r.memoizedProps;if(dg(f,l)&&r.ref===i.ref)if(oo=!1,i.pendingProps=l=f,(r.lanes&u)!==0)r.flags&131072&&(oo=!0);else return i.lanes=r.lanes,gc(r,i,u)}return rA(r,i,a,l,u)}function iW(r,i,a){var l=i.pendingProps,u=l.children,f=r!==null?r.memoizedState:null;if(l.mode==="hidden")if(!(i.mode&1))i.memoizedState={baseLanes:0,cachePool:null,transitions:null},Yn(Zh,bo),bo|=a;else{if(!(a&1073741824))return r=f!==null?f.baseLanes|a:a,i.lanes=i.childLanes=1073741824,i.memoizedState={baseLanes:r,cachePool:null,transitions:null},i.updateQueue=null,Yn(Zh,bo),bo|=r,null;i.memoizedState={baseLanes:0,cachePool:null,transitions:null},l=f!==null?f.baseLanes:a,Yn(Zh,bo),bo|=l}else f!==null?(l=f.baseLanes|a,i.memoizedState=null):l=a,Yn(Zh,bo),bo|=l;return ji(r,i,u,a),i.child}function oW(r,i){var a=i.ref;(r===null&&a!==null||r!==null&&r.ref!==a)&&(i.flags|=512,i.flags|=2097152)}function rA(r,i,a,l,u){var f=ao(a)?Yd:Ni.current;return f=vp(i,f),ip(i,u),a=CN(r,i,a,l,f,u),l=bN(),r!==null&&!oo?(i.updateQueue=r.updateQueue,i.flags&=-2053,r.lanes&=~u,gc(r,i,u)):(or&&l&&pN(i),i.flags|=1,ji(r,i,a,u),i.child)}function IB(r,i,a,l,u){if(ao(a)){var f=!0;Jy(i)}else f=!1;if(ip(i,u),i.stateNode===null)Cy(r,i),eW(i,a,l),tA(i,a,l,u),l=!0;else if(r===null){var _=i.stateNode,v=i.memoizedProps;_.props=v;var w=_.context,C=a.contextType;typeof C=="object"&&C!==null?C=ps(C):(C=ao(a)?Yd:Ni.current,C=vp(i,C));var N=a.getDerivedStateFromProps,D=typeof N=="function"||typeof _.getSnapshotBeforeUpdate=="function";D||typeof _.UNSAFE_componentWillReceiveProps!="function"&&typeof _.componentWillReceiveProps!="function"||(v!==l||w!==C)&&SB(i,_,l,C),sl=!1;var O=i.memoizedState;_.state=O,nS(i,l,_,u),w=i.memoizedState,v!==l||O!==w||so.current||sl?(typeof N=="function"&&(eA(i,a,N,l),w=i.memoizedState),(v=sl||yB(i,a,v,l,O,w,C))?(D||typeof _.UNSAFE_componentWillMount!="function"&&typeof _.componentWillMount!="function"||(typeof _.componentWillMount=="function"&&_.componentWillMount(),typeof _.UNSAFE_componentWillMount=="function"&&_.UNSAFE_componentWillMount()),typeof _.componentDidMount=="function"&&(i.flags|=4194308)):(typeof _.componentDidMount=="function"&&(i.flags|=4194308),i.memoizedProps=l,i.memoizedState=w),_.props=l,_.state=w,_.context=C,l=v):(typeof _.componentDidMount=="function"&&(i.flags|=4194308),l=!1)}else{_=i.stateNode,k8(r,i),v=i.memoizedProps,C=i.type===i.elementType?v:Ms(i.type,v),_.props=C,D=i.pendingProps,O=_.context,w=a.contextType,typeof w=="object"&&w!==null?w=ps(w):(w=ao(a)?Yd:Ni.current,w=vp(i,w));var G=a.getDerivedStateFromProps;(N=typeof G=="function"||typeof _.getSnapshotBeforeUpdate=="function")||typeof _.UNSAFE_componentWillReceiveProps!="function"&&typeof _.componentWillReceiveProps!="function"||(v!==D||O!==w)&&SB(i,_,l,w),sl=!1,O=i.memoizedState,_.state=O,nS(i,l,_,u);var F=i.memoizedState;v!==D||O!==F||so.current||sl?(typeof G=="function"&&(eA(i,a,G,l),F=i.memoizedState),(C=sl||yB(i,a,C,l,O,F,w)||!1)?(N||typeof _.UNSAFE_componentWillUpdate!="function"&&typeof _.componentWillUpdate!="function"||(typeof _.componentWillUpdate=="function"&&_.componentWillUpdate(l,F,w),typeof _.UNSAFE_componentWillUpdate=="function"&&_.UNSAFE_componentWillUpdate(l,F,w)),typeof _.componentDidUpdate=="function"&&(i.flags|=4),typeof _.getSnapshotBeforeUpdate=="function"&&(i.flags|=1024)):(typeof _.componentDidUpdate!="function"||v===r.memoizedProps&&O===r.memoizedState||(i.flags|=4),typeof _.getSnapshotBeforeUpdate!="function"||v===r.memoizedProps&&O===r.memoizedState||(i.flags|=1024),i.memoizedProps=l,i.memoizedState=F),_.props=l,_.state=F,_.context=w,l=C):(typeof _.componentDidUpdate!="function"||v===r.memoizedProps&&O===r.memoizedState||(i.flags|=4),typeof _.getSnapshotBeforeUpdate!="function"||v===r.memoizedProps&&O===r.memoizedState||(i.flags|=1024),l=!1)}return iA(r,i,a,l,f,u)}function iA(r,i,a,l,u,f){oW(r,i);var _=(i.flags&128)!==0;if(!l&&!_)return u&&hB(i,a,!1),gc(r,i,f);l=i.stateNode,Nde.current=i;var v=_&&typeof a.getDerivedStateFromError!="function"?null:l.render();return i.flags|=1,r!==null&&_?(i.child=Sp(i,r.child,null,f),i.child=Sp(i,null,v,f)):ji(r,i,v,f),i.memoizedState=l.state,u&&hB(i,a,!0),i.child}function sW(r){var i=r.stateNode;i.pendingContext?uB(r,i.pendingContext,i.pendingContext!==i.context):i.context&&uB(r,i.context,!1),SN(r,i.containerInfo)}function AB(r,i,a,l,u){return yp(),mN(u),i.flags|=256,ji(r,i,a,l),i.child}var oA={dehydrated:null,treeContext:null,retryLane:0};function sA(r){return{baseLanes:r,cachePool:null,transitions:null}}function aW(r,i,a){var l=i.pendingProps,u=hr.current,f=!1,_=(i.flags&128)!==0,v;if((v=_)||(v=r!==null&&r.memoizedState===null?!1:(u&2)!==0),v?(f=!0,i.flags&=-129):(r===null||r.memoizedState!==null)&&(u|=1),Yn(hr,u&1),r===null)return QI(i),r=i.memoizedState,r!==null&&(r=r.dehydrated,r!==null)?(i.mode&1?r.data==="$!"?i.lanes=8:i.lanes=1073741824:i.lanes=1,null):(_=l.children,r=l.fallback,f?(l=i.mode,f=i.child,_={mode:"hidden",children:_},!(l&1)&&f!==null?(f.childLanes=0,f.pendingProps=_):f=FS(_,l,0,null),r=Wd(r,l,a,null),f.return=i,r.return=i,f.sibling=r,i.child=f,i.child.memoizedState=sA(a),i.memoizedState=oA,r):NN(i,_));if(u=r.memoizedState,u!==null&&(v=u.dehydrated,v!==null))return Ode(r,i,_,l,v,u,a);if(f){f=l.fallback,_=i.mode,u=r.child,v=u.sibling;var w={mode:"hidden",children:l.children};return!(_&1)&&i.child!==u?(l=i.child,l.childLanes=0,l.pendingProps=w,i.deletions=null):(l=Cl(u,w),l.subtreeFlags=u.subtreeFlags&14680064),v!==null?f=Cl(v,f):(f=Wd(f,_,a,null),f.flags|=2),f.return=i,l.return=i,l.sibling=f,i.child=l,l=f,f=i.child,_=r.child.memoizedState,_=_===null?sA(a):{baseLanes:_.baseLanes|a,cachePool:null,transitions:_.transitions},f.memoizedState=_,f.childLanes=r.childLanes&~a,i.memoizedState=oA,l}return f=r.child,r=f.sibling,l=Cl(f,{mode:"visible",children:l.children}),!(i.mode&1)&&(l.lanes=a),l.return=i,l.sibling=null,r!==null&&(a=i.deletions,a===null?(i.deletions=[r],i.flags|=16):a.push(r)),i.child=l,i.memoizedState=null,l}function NN(r,i){return i=FS({mode:"visible",children:i},r.mode,0,null),i.return=r,r.child=i}function ny(r,i,a,l){return l!==null&&mN(l),Sp(i,r.child,null,a),r=NN(i,i.pendingProps.children),r.flags|=2,i.memoizedState=null,r}function Ode(r,i,a,l,u,f,_){if(a)return i.flags&256?(i.flags&=-257,l=Zb(Error(Ue(422))),ny(r,i,_,l)):i.memoizedState!==null?(i.child=r.child,i.flags|=128,null):(f=l.fallback,u=i.mode,l=FS({mode:"visible",children:l.children},u,0,null),f=Wd(f,u,_,null),f.flags|=2,l.return=i,f.return=i,l.sibling=f,i.child=l,i.mode&1&&Sp(i,r.child,null,_),i.child.memoizedState=sA(_),i.memoizedState=oA,f);if(!(i.mode&1))return ny(r,i,_,null);if(u.data==="$!"){if(l=u.nextSibling&&u.nextSibling.dataset,l)var v=l.dgst;return l=v,f=Error(Ue(419)),l=Zb(f,l,void 0),ny(r,i,_,l)}if(v=(_&r.childLanes)!==0,oo||v){if(l=ii,l!==null){switch(_&-_){case 4:u=2;break;case 16:u=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:u=32;break;case 536870912:u=268435456;break;default:u=0}u=u&(l.suspendedLanes|_)?0:u,u!==0&&u!==f.retryLane&&(f.retryLane=u,mc(r,u),Gs(l,r,u,-1))}return LN(),l=Zb(Error(Ue(421))),ny(r,i,_,l)}return u.data==="$?"?(i.flags|=128,i.child=r.child,i=Hde.bind(null,r),u._reactRetry=i,null):(r=f.treeContext,Ao=Sl(u.nextSibling),Oo=i,or=!0,Bs=null,r!==null&&(ls[ds++]=dc,ls[ds++]=uc,ls[ds++]=qd,dc=r.id,uc=r.overflow,qd=i),i=NN(i,l.children),i.flags|=4096,i)}function NB(r,i,a){r.lanes|=i;var l=r.alternate;l!==null&&(l.lanes|=i),ZI(r.return,i,a)}function eI(r,i,a,l,u){var f=r.memoizedState;f===null?r.memoizedState={isBackwards:i,rendering:null,renderingStartTime:0,last:l,tail:a,tailMode:u}:(f.isBackwards=i,f.rendering=null,f.renderingStartTime=0,f.last=l,f.tail=a,f.tailMode=u)}function cW(r,i,a){var l=i.pendingProps,u=l.revealOrder,f=l.tail;if(ji(r,i,l.children,a),l=hr.current,l&2)l=l&1|2,i.flags|=128;else{if(r!==null&&r.flags&128)e:for(r=i.child;r!==null;){if(r.tag===13)r.memoizedState!==null&&NB(r,a,i);else if(r.tag===19)NB(r,a,i);else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===i)break e;for(;r.sibling===null;){if(r.return===null||r.return===i)break e;r=r.return}r.sibling.return=r.return,r=r.sibling}l&=1}if(Yn(hr,l),!(i.mode&1))i.memoizedState=null;else switch(u){case"forwards":for(a=i.child,u=null;a!==null;)r=a.alternate,r!==null&&rS(r)===null&&(u=a),a=a.sibling;a=u,a===null?(u=i.child,i.child=null):(u=a.sibling,a.sibling=null),eI(i,!1,u,a,f);break;case"backwards":for(a=null,u=i.child,i.child=null;u!==null;){if(r=u.alternate,r!==null&&rS(r)===null){i.child=u;break}r=u.sibling,u.sibling=a,a=u,u=r}eI(i,!0,a,null,f);break;case"together":eI(i,!1,null,null,void 0);break;default:i.memoizedState=null}return i.child}function Cy(r,i){!(i.mode&1)&&r!==null&&(r.alternate=null,i.alternate=null,i.flags|=2)}function gc(r,i,a){if(r!==null&&(i.dependencies=r.dependencies),$d|=i.lanes,!(a&i.childLanes))return null;if(r!==null&&i.child!==r.child)throw Error(Ue(153));if(i.child!==null){for(r=i.child,a=Cl(r,r.pendingProps),i.child=a,a.return=i;r.sibling!==null;)r=r.sibling,a=a.sibling=Cl(r,r.pendingProps),a.return=i;a.sibling=null}return i.child}function Pde(r,i,a){switch(i.tag){case 3:sW(i),yp();break;case 5:x8(i);break;case 1:ao(i.type)&&Jy(i);break;case 4:SN(i,i.stateNode.containerInfo);break;case 10:var l=i.type._context,u=i.memoizedProps.value;Yn(eS,l._currentValue),l._currentValue=u;break;case 13:if(l=i.memoizedState,l!==null)return l.dehydrated!==null?(Yn(hr,hr.current&1),i.flags|=128,null):a&i.child.childLanes?aW(r,i,a):(Yn(hr,hr.current&1),r=gc(r,i,a),r!==null?r.sibling:null);Yn(hr,hr.current&1);break;case 19:if(l=(a&i.childLanes)!==0,r.flags&128){if(l)return cW(r,i,a);i.flags|=128}if(u=i.memoizedState,u!==null&&(u.rendering=null,u.tail=null,u.lastEffect=null),Yn(hr,hr.current),l)break;return null;case 22:case 23:return i.lanes=0,iW(r,i,a)}return gc(r,i,a)}var lW,aA,dW,uW;lW=function(r,i){for(var a=i.child;a!==null;){if(a.tag===5||a.tag===6)r.appendChild(a.stateNode);else if(a.tag!==4&&a.child!==null){a.child.return=a,a=a.child;continue}if(a===i)break;for(;a.sibling===null;){if(a.return===null||a.return===i)return;a=a.return}a.sibling.return=a.return,a=a.sibling}};aA=function(){};dW=function(r,i,a,l){var u=r.memoizedProps;if(u!==l){r=i.stateNode,xd(Da.current);var f=null;switch(a){case"input":u=NI(r,u),l=NI(r,l),f=[];break;case"select":u=mr({},u,{value:void 0}),l=mr({},l,{value:void 0}),f=[];break;case"textarea":u=DI(r,u),l=DI(r,l),f=[];break;default:typeof u.onClick!="function"&&typeof l.onClick=="function"&&(r.onclick=Xy)}xI(a,l);var _;a=null;for(C in u)if(!l.hasOwnProperty(C)&&u.hasOwnProperty(C)&&u[C]!=null)if(C==="style"){var v=u[C];for(_ in v)v.hasOwnProperty(_)&&(a||(a={}),a[_]="")}else C!=="dangerouslySetInnerHTML"&&C!=="children"&&C!=="suppressContentEditableWarning"&&C!=="suppressHydrationWarning"&&C!=="autoFocus"&&(rg.hasOwnProperty(C)?f||(f=[]):(f=f||[]).push(C,null));for(C in l){var w=l[C];if(v=u!=null?u[C]:void 0,l.hasOwnProperty(C)&&w!==v&&(w!=null||v!=null))if(C==="style")if(v){for(_ in v)!v.hasOwnProperty(_)||w&&w.hasOwnProperty(_)||(a||(a={}),a[_]="");for(_ in w)w.hasOwnProperty(_)&&v[_]!==w[_]&&(a||(a={}),a[_]=w[_])}else a||(f||(f=[]),f.push(C,a)),a=w;else C==="dangerouslySetInnerHTML"?(w=w?w.__html:void 0,v=v?v.__html:void 0,w!=null&&v!==w&&(f=f||[]).push(C,w)):C==="children"?typeof w!="string"&&typeof w!="number"||(f=f||[]).push(C,""+w):C!=="suppressContentEditableWarning"&&C!=="suppressHydrationWarning"&&(rg.hasOwnProperty(C)?(w!=null&&C==="onScroll"&&Zn("scroll",r),f||v===w||(f=[])):(f=f||[]).push(C,w))}a&&(f=f||[]).push("style",a);var C=f;(i.updateQueue=C)&&(i.flags|=4)}};uW=function(r,i,a,l){a!==l&&(i.flags|=4)};function Pm(r,i){if(!or)switch(r.tailMode){case"hidden":i=r.tail;for(var a=null;i!==null;)i.alternate!==null&&(a=i),i=i.sibling;a===null?r.tail=null:a.sibling=null;break;case"collapsed":a=r.tail;for(var l=null;a!==null;)a.alternate!==null&&(l=a),a=a.sibling;l===null?i||r.tail===null?r.tail=null:r.tail.sibling=null:l.sibling=null}}function Ri(r){var i=r.alternate!==null&&r.alternate.child===r.child,a=0,l=0;if(i)for(var u=r.child;u!==null;)a|=u.lanes|u.childLanes,l|=u.subtreeFlags&14680064,l|=u.flags&14680064,u.return=r,u=u.sibling;else for(u=r.child;u!==null;)a|=u.lanes|u.childLanes,l|=u.subtreeFlags,l|=u.flags,u.return=r,u=u.sibling;return r.subtreeFlags|=l,r.childLanes=a,i}function Dde(r,i,a){var l=i.pendingProps;switch(fN(i),i.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ri(i),null;case 1:return ao(i.type)&&$y(),Ri(i),null;case 3:return l=i.stateNode,Tp(),tr(so),tr(Ni),wN(),l.pendingContext&&(l.context=l.pendingContext,l.pendingContext=null),(r===null||r.child===null)&&(ey(i)?i.flags|=4:r===null||r.memoizedState.isDehydrated&&!(i.flags&256)||(i.flags|=1024,Bs!==null&&(mA(Bs),Bs=null))),aA(r,i),Ri(i),null;case 5:TN(i);var u=xd(mg.current);if(a=i.type,r!==null&&i.stateNode!=null)dW(r,i,a,l,u),r.ref!==i.ref&&(i.flags|=512,i.flags|=2097152);else{if(!l){if(i.stateNode===null)throw Error(Ue(166));return Ri(i),null}if(r=xd(Da.current),ey(i)){l=i.stateNode,a=i.type;var f=i.memoizedProps;switch(l[Na]=i,l[pg]=f,r=(i.mode&1)!==0,a){case"dialog":Zn("cancel",l),Zn("close",l);break;case"iframe":case"object":case"embed":Zn("load",l);break;case"video":case"audio":for(u=0;u<Hm.length;u++)Zn(Hm[u],l);break;case"source":Zn("error",l);break;case"img":case"image":case"link":Zn("error",l),Zn("load",l);break;case"details":Zn("toggle",l);break;case"input":j3(l,f),Zn("invalid",l);break;case"select":l._wrapperState={wasMultiple:!!f.multiple},Zn("invalid",l);break;case"textarea":F3(l,f),Zn("invalid",l)}xI(a,f),u=null;for(var _ in f)if(f.hasOwnProperty(_)){var v=f[_];_==="children"?typeof v=="string"?l.textContent!==v&&(f.suppressHydrationWarning!==!0&&Zv(l.textContent,v,r),u=["children",v]):typeof v=="number"&&l.textContent!==""+v&&(f.suppressHydrationWarning!==!0&&Zv(l.textContent,v,r),u=["children",""+v]):rg.hasOwnProperty(_)&&v!=null&&_==="onScroll"&&Zn("scroll",l)}switch(a){case"input":zv(l),V3(l,f,!0);break;case"textarea":zv(l),B3(l);break;case"select":case"option":break;default:typeof f.onClick=="function"&&(l.onclick=Xy)}l=u,i.updateQueue=l,l!==null&&(i.flags|=4)}else{_=u.nodeType===9?u:u.ownerDocument,r==="http://www.w3.org/1999/xhtml"&&(r=V6(a)),r==="http://www.w3.org/1999/xhtml"?a==="script"?(r=_.createElement("div"),r.innerHTML="<script><\/script>",r=r.removeChild(r.firstChild)):typeof l.is=="string"?r=_.createElement(a,{is:l.is}):(r=_.createElement(a),a==="select"&&(_=r,l.multiple?_.multiple=!0:l.size&&(_.size=l.size))):r=_.createElementNS(r,a),r[Na]=i,r[pg]=l,lW(r,i,!1,!1),i.stateNode=r;e:{switch(_=LI(a,l),a){case"dialog":Zn("cancel",r),Zn("close",r),u=l;break;case"iframe":case"object":case"embed":Zn("load",r),u=l;break;case"video":case"audio":for(u=0;u<Hm.length;u++)Zn(Hm[u],r);u=l;break;case"source":Zn("error",r),u=l;break;case"img":case"image":case"link":Zn("error",r),Zn("load",r),u=l;break;case"details":Zn("toggle",r),u=l;break;case"input":j3(r,l),u=NI(r,l),Zn("invalid",r);break;case"option":u=l;break;case"select":r._wrapperState={wasMultiple:!!l.multiple},u=mr({},l,{value:void 0}),Zn("invalid",r);break;case"textarea":F3(r,l),u=DI(r,l),Zn("invalid",r);break;default:u=l}xI(a,u),v=u;for(f in v)if(v.hasOwnProperty(f)){var w=v[f];f==="style"?W6(r,w):f==="dangerouslySetInnerHTML"?(w=w?w.__html:void 0,w!=null&&F6(r,w)):f==="children"?typeof w=="string"?(a!=="textarea"||w!=="")&&ig(r,w):typeof w=="number"&&ig(r,""+w):f!=="suppressContentEditableWarning"&&f!=="suppressHydrationWarning"&&f!=="autoFocus"&&(rg.hasOwnProperty(f)?w!=null&&f==="onScroll"&&Zn("scroll",r):w!=null&&ZA(r,f,w,_))}switch(a){case"input":zv(r),V3(r,l,!1);break;case"textarea":zv(r),B3(r);break;case"option":l.value!=null&&r.setAttribute("value",""+Al(l.value));break;case"select":r.multiple=!!l.multiple,f=l.value,f!=null?ep(r,!!l.multiple,f,!1):l.defaultValue!=null&&ep(r,!!l.multiple,l.defaultValue,!0);break;default:typeof u.onClick=="function"&&(r.onclick=Xy)}switch(a){case"button":case"input":case"select":case"textarea":l=!!l.autoFocus;break e;case"img":l=!0;break e;default:l=!1}}l&&(i.flags|=4)}i.ref!==null&&(i.flags|=512,i.flags|=2097152)}return Ri(i),null;case 6:if(r&&i.stateNode!=null)uW(r,i,r.memoizedProps,l);else{if(typeof l!="string"&&i.stateNode===null)throw Error(Ue(166));if(a=xd(mg.current),xd(Da.current),ey(i)){if(l=i.stateNode,a=i.memoizedProps,l[Na]=i,(f=l.nodeValue!==a)&&(r=Oo,r!==null))switch(r.tag){case 3:Zv(l.nodeValue,a,(r.mode&1)!==0);break;case 5:r.memoizedProps.suppressHydrationWarning!==!0&&Zv(l.nodeValue,a,(r.mode&1)!==0)}f&&(i.flags|=4)}else l=(a.nodeType===9?a:a.ownerDocument).createTextNode(l),l[Na]=i,i.stateNode=l}return Ri(i),null;case 13:if(tr(hr),l=i.memoizedState,r===null||r.memoizedState!==null&&r.memoizedState.dehydrated!==null){if(or&&Ao!==null&&i.mode&1&&!(i.flags&128))N8(),yp(),i.flags|=98560,f=!1;else if(f=ey(i),l!==null&&l.dehydrated!==null){if(r===null){if(!f)throw Error(Ue(318));if(f=i.memoizedState,f=f!==null?f.dehydrated:null,!f)throw Error(Ue(317));f[Na]=i}else yp(),!(i.flags&128)&&(i.memoizedState=null),i.flags|=4;Ri(i),f=!1}else Bs!==null&&(mA(Bs),Bs=null),f=!0;if(!f)return i.flags&65536?i:null}return i.flags&128?(i.lanes=a,i):(l=l!==null,l!==(r!==null&&r.memoizedState!==null)&&l&&(i.child.flags|=8192,i.mode&1&&(r===null||hr.current&1?qr===0&&(qr=3):LN())),i.updateQueue!==null&&(i.flags|=4),Ri(i),null);case 4:return Tp(),aA(r,i),r===null&&ug(i.stateNode.containerInfo),Ri(i),null;case 10:return EN(i.type._context),Ri(i),null;case 17:return ao(i.type)&&$y(),Ri(i),null;case 19:if(tr(hr),f=i.memoizedState,f===null)return Ri(i),null;if(l=(i.flags&128)!==0,_=f.rendering,_===null)if(l)Pm(f,!1);else{if(qr!==0||r!==null&&r.flags&128)for(r=i.child;r!==null;){if(_=rS(r),_!==null){for(i.flags|=128,Pm(f,!1),l=_.updateQueue,l!==null&&(i.updateQueue=l,i.flags|=4),i.subtreeFlags=0,l=a,a=i.child;a!==null;)f=a,r=l,f.flags&=14680066,_=f.alternate,_===null?(f.childLanes=0,f.lanes=r,f.child=null,f.subtreeFlags=0,f.memoizedProps=null,f.memoizedState=null,f.updateQueue=null,f.dependencies=null,f.stateNode=null):(f.childLanes=_.childLanes,f.lanes=_.lanes,f.child=_.child,f.subtreeFlags=0,f.deletions=null,f.memoizedProps=_.memoizedProps,f.memoizedState=_.memoizedState,f.updateQueue=_.updateQueue,f.type=_.type,r=_.dependencies,f.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext}),a=a.sibling;return Yn(hr,hr.current&1|2),i.child}r=r.sibling}f.tail!==null&&Pr()>Rp&&(i.flags|=128,l=!0,Pm(f,!1),i.lanes=4194304)}else{if(!l)if(r=rS(_),r!==null){if(i.flags|=128,l=!0,a=r.updateQueue,a!==null&&(i.updateQueue=a,i.flags|=4),Pm(f,!0),f.tail===null&&f.tailMode==="hidden"&&!_.alternate&&!or)return Ri(i),null}else 2*Pr()-f.renderingStartTime>Rp&&a!==1073741824&&(i.flags|=128,l=!0,Pm(f,!1),i.lanes=4194304);f.isBackwards?(_.sibling=i.child,i.child=_):(a=f.last,a!==null?a.sibling=_:i.child=_,f.last=_)}return f.tail!==null?(i=f.tail,f.rendering=i,f.tail=i.sibling,f.renderingStartTime=Pr(),i.sibling=null,a=hr.current,Yn(hr,l?a&1|2:a&1),i):(Ri(i),null);case 22:case 23:return xN(),l=i.memoizedState!==null,r!==null&&r.memoizedState!==null!==l&&(i.flags|=8192),l&&i.mode&1?bo&1073741824&&(Ri(i),i.subtreeFlags&6&&(i.flags|=8192)):Ri(i),null;case 24:return null;case 25:return null}throw Error(Ue(156,i.tag))}function kde(r,i){switch(fN(i),i.tag){case 1:return ao(i.type)&&$y(),r=i.flags,r&65536?(i.flags=r&-65537|128,i):null;case 3:return Tp(),tr(so),tr(Ni),wN(),r=i.flags,r&65536&&!(r&128)?(i.flags=r&-65537|128,i):null;case 5:return TN(i),null;case 13:if(tr(hr),r=i.memoizedState,r!==null&&r.dehydrated!==null){if(i.alternate===null)throw Error(Ue(340));yp()}return r=i.flags,r&65536?(i.flags=r&-65537|128,i):null;case 19:return tr(hr),null;case 4:return Tp(),null;case 10:return EN(i.type._context),null;case 22:case 23:return xN(),null;case 24:return null;default:return null}}var ry=!1,bi=!1,xde=typeof WeakSet=="function"?WeakSet:Set,lt=null;function Qh(r,i){var a=r.ref;if(a!==null)if(typeof a=="function")try{a(null)}catch(l){Tr(r,i,l)}else a.current=null}function cA(r,i,a){try{a()}catch(l){Tr(r,i,l)}}var OB=!1;function Lde(r,i){if(zI=Ky,r=g8(),hN(r)){if("selectionStart"in r)var a={start:r.selectionStart,end:r.selectionEnd};else e:{a=(a=r.ownerDocument)&&a.defaultView||window;var l=a.getSelection&&a.getSelection();if(l&&l.rangeCount!==0){a=l.anchorNode;var u=l.anchorOffset,f=l.focusNode;l=l.focusOffset;try{a.nodeType,f.nodeType}catch{a=null;break e}var _=0,v=-1,w=-1,C=0,N=0,D=r,O=null;t:for(;;){for(var G;D!==a||u!==0&&D.nodeType!==3||(v=_+u),D!==f||l!==0&&D.nodeType!==3||(w=_+l),D.nodeType===3&&(_+=D.nodeValue.length),(G=D.firstChild)!==null;)O=D,D=G;for(;;){if(D===r)break t;if(O===a&&++C===u&&(v=_),O===f&&++N===l&&(w=_),(G=D.nextSibling)!==null)break;D=O,O=D.parentNode}D=G}a=v===-1||w===-1?null:{start:v,end:w}}else a=null}a=a||{start:0,end:0}}else a=null;for(KI={focusedElem:r,selectionRange:a},Ky=!1,lt=i;lt!==null;)if(i=lt,r=i.child,(i.subtreeFlags&1028)!==0&&r!==null)r.return=i,lt=r;else for(;lt!==null;){i=lt;try{var F=i.alternate;if(i.flags&1024)switch(i.tag){case 0:case 11:case 15:break;case 1:if(F!==null){var V=F.memoizedProps,L=F.memoizedState,B=i.stateNode,W=B.getSnapshotBeforeUpdate(i.elementType===i.type?V:Ms(i.type,V),L);B.__reactInternalSnapshotBeforeUpdate=W}break;case 3:var z=i.stateNode.containerInfo;z.nodeType===1?z.textContent="":z.nodeType===9&&z.documentElement&&z.removeChild(z.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Ue(163))}}catch($){Tr(i,i.return,$)}if(r=i.sibling,r!==null){r.return=i.return,lt=r;break}lt=i.return}return F=OB,OB=!1,F}function Qm(r,i,a){var l=i.updateQueue;if(l=l!==null?l.lastEffect:null,l!==null){var u=l=l.next;do{if((u.tag&r)===r){var f=u.destroy;u.destroy=void 0,f!==void 0&&cA(i,a,f)}u=u.next}while(u!==l)}}function jS(r,i){if(i=i.updateQueue,i=i!==null?i.lastEffect:null,i!==null){var a=i=i.next;do{if((a.tag&r)===r){var l=a.create;a.destroy=l()}a=a.next}while(a!==i)}}function lA(r){var i=r.ref;if(i!==null){var a=r.stateNode;switch(r.tag){case 5:r=a;break;default:r=a}typeof i=="function"?i(r):i.current=r}}function hW(r){var i=r.alternate;i!==null&&(r.alternate=null,hW(i)),r.child=null,r.deletions=null,r.sibling=null,r.tag===5&&(i=r.stateNode,i!==null&&(delete i[Na],delete i[pg],delete i[XI],delete i[_de],delete i[Ede])),r.stateNode=null,r.return=null,r.dependencies=null,r.memoizedProps=null,r.memoizedState=null,r.pendingProps=null,r.stateNode=null,r.updateQueue=null}function pW(r){return r.tag===5||r.tag===3||r.tag===4}function PB(r){e:for(;;){for(;r.sibling===null;){if(r.return===null||pW(r.return))return null;r=r.return}for(r.sibling.return=r.return,r=r.sibling;r.tag!==5&&r.tag!==6&&r.tag!==18;){if(r.flags&2||r.child===null||r.tag===4)continue e;r.child.return=r,r=r.child}if(!(r.flags&2))return r.stateNode}}function dA(r,i,a){var l=r.tag;if(l===5||l===6)r=r.stateNode,i?a.nodeType===8?a.parentNode.insertBefore(r,i):a.insertBefore(r,i):(a.nodeType===8?(i=a.parentNode,i.insertBefore(r,a)):(i=a,i.appendChild(r)),a=a._reactRootContainer,a!=null||i.onclick!==null||(i.onclick=Xy));else if(l!==4&&(r=r.child,r!==null))for(dA(r,i,a),r=r.sibling;r!==null;)dA(r,i,a),r=r.sibling}function uA(r,i,a){var l=r.tag;if(l===5||l===6)r=r.stateNode,i?a.insertBefore(r,i):a.appendChild(r);else if(l!==4&&(r=r.child,r!==null))for(uA(r,i,a),r=r.sibling;r!==null;)uA(r,i,a),r=r.sibling}var ui=null,Vs=!1;function Jc(r,i,a){for(a=a.child;a!==null;)fW(r,i,a),a=a.sibling}function fW(r,i,a){if(Pa&&typeof Pa.onCommitFiberUnmount=="function")try{Pa.onCommitFiberUnmount(OS,a)}catch{}switch(a.tag){case 5:bi||Qh(a,i);case 6:var l=ui,u=Vs;ui=null,Jc(r,i,a),ui=l,Vs=u,ui!==null&&(Vs?(r=ui,a=a.stateNode,r.nodeType===8?r.parentNode.removeChild(a):r.removeChild(a)):ui.removeChild(a.stateNode));break;case 18:ui!==null&&(Vs?(r=ui,a=a.stateNode,r.nodeType===8?Yb(r.parentNode,a):r.nodeType===1&&Yb(r,a),cg(r)):Yb(ui,a.stateNode));break;case 4:l=ui,u=Vs,ui=a.stateNode.containerInfo,Vs=!0,Jc(r,i,a),ui=l,Vs=u;break;case 0:case 11:case 14:case 15:if(!bi&&(l=a.updateQueue,l!==null&&(l=l.lastEffect,l!==null))){u=l=l.next;do{var f=u,_=f.destroy;f=f.tag,_!==void 0&&(f&2||f&4)&&cA(a,i,_),u=u.next}while(u!==l)}Jc(r,i,a);break;case 1:if(!bi&&(Qh(a,i),l=a.stateNode,typeof l.componentWillUnmount=="function"))try{l.props=a.memoizedProps,l.state=a.memoizedState,l.componentWillUnmount()}catch(v){Tr(a,i,v)}Jc(r,i,a);break;case 21:Jc(r,i,a);break;case 22:a.mode&1?(bi=(l=bi)||a.memoizedState!==null,Jc(r,i,a),bi=l):Jc(r,i,a);break;default:Jc(r,i,a)}}function DB(r){var i=r.updateQueue;if(i!==null){r.updateQueue=null;var a=r.stateNode;a===null&&(a=r.stateNode=new xde),i.forEach(function(l){var u=Gde.bind(null,r,l);a.has(l)||(a.add(l),l.then(u,u))})}}function xs(r,i){var a=i.deletions;if(a!==null)for(var l=0;l<a.length;l++){var u=a[l];try{var f=r,_=i,v=_;e:for(;v!==null;){switch(v.tag){case 5:ui=v.stateNode,Vs=!1;break e;case 3:ui=v.stateNode.containerInfo,Vs=!0;break e;case 4:ui=v.stateNode.containerInfo,Vs=!0;break e}v=v.return}if(ui===null)throw Error(Ue(160));fW(f,_,u),ui=null,Vs=!1;var w=u.alternate;w!==null&&(w.return=null),u.return=null}catch(C){Tr(u,i,C)}}if(i.subtreeFlags&12854)for(i=i.child;i!==null;)mW(i,r),i=i.sibling}function mW(r,i){var a=r.alternate,l=r.flags;switch(r.tag){case 0:case 11:case 14:case 15:if(xs(i,r),wa(r),l&4){try{Qm(3,r,r.return),jS(3,r)}catch(V){Tr(r,r.return,V)}try{Qm(5,r,r.return)}catch(V){Tr(r,r.return,V)}}break;case 1:xs(i,r),wa(r),l&512&&a!==null&&Qh(a,a.return);break;case 5:if(xs(i,r),wa(r),l&512&&a!==null&&Qh(a,a.return),r.flags&32){var u=r.stateNode;try{ig(u,"")}catch(V){Tr(r,r.return,V)}}if(l&4&&(u=r.stateNode,u!=null)){var f=r.memoizedProps,_=a!==null?a.memoizedProps:f,v=r.type,w=r.updateQueue;if(r.updateQueue=null,w!==null)try{v==="input"&&f.type==="radio"&&f.name!=null&&U6(u,f),LI(v,_);var C=LI(v,f);for(_=0;_<w.length;_+=2){var N=w[_],D=w[_+1];N==="style"?W6(u,D):N==="dangerouslySetInnerHTML"?F6(u,D):N==="children"?ig(u,D):ZA(u,N,D,C)}switch(v){case"input":OI(u,f);break;case"textarea":j6(u,f);break;case"select":var O=u._wrapperState.wasMultiple;u._wrapperState.wasMultiple=!!f.multiple;var G=f.value;G!=null?ep(u,!!f.multiple,G,!1):O!==!!f.multiple&&(f.defaultValue!=null?ep(u,!!f.multiple,f.defaultValue,!0):ep(u,!!f.multiple,f.multiple?[]:"",!1))}u[pg]=f}catch(V){Tr(r,r.return,V)}}break;case 6:if(xs(i,r),wa(r),l&4){if(r.stateNode===null)throw Error(Ue(162));u=r.stateNode,f=r.memoizedProps;try{u.nodeValue=f}catch(V){Tr(r,r.return,V)}}break;case 3:if(xs(i,r),wa(r),l&4&&a!==null&&a.memoizedState.isDehydrated)try{cg(i.containerInfo)}catch(V){Tr(r,r.return,V)}break;case 4:xs(i,r),wa(r);break;case 13:xs(i,r),wa(r),u=r.child,u.flags&8192&&(f=u.memoizedState!==null,u.stateNode.isHidden=f,!f||u.alternate!==null&&u.alternate.memoizedState!==null||(DN=Pr())),l&4&&DB(r);break;case 22:if(N=a!==null&&a.memoizedState!==null,r.mode&1?(bi=(C=bi)||N,xs(i,r),bi=C):xs(i,r),wa(r),l&8192){if(C=r.memoizedState!==null,(r.stateNode.isHidden=C)&&!N&&r.mode&1)for(lt=r,N=r.child;N!==null;){for(D=lt=N;lt!==null;){switch(O=lt,G=O.child,O.tag){case 0:case 11:case 14:case 15:Qm(4,O,O.return);break;case 1:Qh(O,O.return);var F=O.stateNode;if(typeof F.componentWillUnmount=="function"){l=O,a=O.return;try{i=l,F.props=i.memoizedProps,F.state=i.memoizedState,F.componentWillUnmount()}catch(V){Tr(l,a,V)}}break;case 5:Qh(O,O.return);break;case 22:if(O.memoizedState!==null){xB(D);continue}}G!==null?(G.return=O,lt=G):xB(D)}N=N.sibling}e:for(N=null,D=r;;){if(D.tag===5){if(N===null){N=D;try{u=D.stateNode,C?(f=u.style,typeof f.setProperty=="function"?f.setProperty("display","none","important"):f.display="none"):(v=D.stateNode,w=D.memoizedProps.style,_=w!=null&&w.hasOwnProperty("display")?w.display:null,v.style.display=B6("display",_))}catch(V){Tr(r,r.return,V)}}}else if(D.tag===6){if(N===null)try{D.stateNode.nodeValue=C?"":D.memoizedProps}catch(V){Tr(r,r.return,V)}}else if((D.tag!==22&&D.tag!==23||D.memoizedState===null||D===r)&&D.child!==null){D.child.return=D,D=D.child;continue}if(D===r)break e;for(;D.sibling===null;){if(D.return===null||D.return===r)break e;N===D&&(N=null),D=D.return}N===D&&(N=null),D.sibling.return=D.return,D=D.sibling}}break;case 19:xs(i,r),wa(r),l&4&&DB(r);break;case 21:break;default:xs(i,r),wa(r)}}function wa(r){var i=r.flags;if(i&2){try{e:{for(var a=r.return;a!==null;){if(pW(a)){var l=a;break e}a=a.return}throw Error(Ue(160))}switch(l.tag){case 5:var u=l.stateNode;l.flags&32&&(ig(u,""),l.flags&=-33);var f=PB(r);uA(r,f,u);break;case 3:case 4:var _=l.stateNode.containerInfo,v=PB(r);dA(r,v,_);break;default:throw Error(Ue(161))}}catch(w){Tr(r,r.return,w)}r.flags&=-3}i&4096&&(r.flags&=-4097)}function Mde(r,i,a){lt=r,gW(r)}function gW(r,i,a){for(var l=(r.mode&1)!==0;lt!==null;){var u=lt,f=u.child;if(u.tag===22&&l){var _=u.memoizedState!==null||ry;if(!_){var v=u.alternate,w=v!==null&&v.memoizedState!==null||bi;v=ry;var C=bi;if(ry=_,(bi=w)&&!C)for(lt=u;lt!==null;)_=lt,w=_.child,_.tag===22&&_.memoizedState!==null?LB(u):w!==null?(w.return=_,lt=w):LB(u);for(;f!==null;)lt=f,gW(f),f=f.sibling;lt=u,ry=v,bi=C}kB(r)}else u.subtreeFlags&8772&&f!==null?(f.return=u,lt=f):kB(r)}}function kB(r){for(;lt!==null;){var i=lt;if(i.flags&8772){var a=i.alternate;try{if(i.flags&8772)switch(i.tag){case 0:case 11:case 15:bi||jS(5,i);break;case 1:var l=i.stateNode;if(i.flags&4&&!bi)if(a===null)l.componentDidMount();else{var u=i.elementType===i.type?a.memoizedProps:Ms(i.type,a.memoizedProps);l.componentDidUpdate(u,a.memoizedState,l.__reactInternalSnapshotBeforeUpdate)}var f=i.updateQueue;f!==null&&_B(i,f,l);break;case 3:var _=i.updateQueue;if(_!==null){if(a=null,i.child!==null)switch(i.child.tag){case 5:a=i.child.stateNode;break;case 1:a=i.child.stateNode}_B(i,_,a)}break;case 5:var v=i.stateNode;if(a===null&&i.flags&4){a=v;var w=i.memoizedProps;switch(i.type){case"button":case"input":case"select":case"textarea":w.autoFocus&&a.focus();break;case"img":w.src&&(a.src=w.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(i.memoizedState===null){var C=i.alternate;if(C!==null){var N=C.memoizedState;if(N!==null){var D=N.dehydrated;D!==null&&cg(D)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Ue(163))}bi||i.flags&512&&lA(i)}catch(O){Tr(i,i.return,O)}}if(i===r){lt=null;break}if(a=i.sibling,a!==null){a.return=i.return,lt=a;break}lt=i.return}}function xB(r){for(;lt!==null;){var i=lt;if(i===r){lt=null;break}var a=i.sibling;if(a!==null){a.return=i.return,lt=a;break}lt=i.return}}function LB(r){for(;lt!==null;){var i=lt;try{switch(i.tag){case 0:case 11:case 15:var a=i.return;try{jS(4,i)}catch(w){Tr(i,a,w)}break;case 1:var l=i.stateNode;if(typeof l.componentDidMount=="function"){var u=i.return;try{l.componentDidMount()}catch(w){Tr(i,u,w)}}var f=i.return;try{lA(i)}catch(w){Tr(i,f,w)}break;case 5:var _=i.return;try{lA(i)}catch(w){Tr(i,_,w)}}}catch(w){Tr(i,i.return,w)}if(i===r){lt=null;break}var v=i.sibling;if(v!==null){v.return=i.return,lt=v;break}lt=i.return}}var Ude=Math.ceil,sS=vc.ReactCurrentDispatcher,ON=vc.ReactCurrentOwner,hs=vc.ReactCurrentBatchConfig,yn=0,ii=null,Fr=null,hi=0,bo=0,Zh=Ml(0),qr=0,vg=null,$d=0,VS=0,PN=0,Zm=null,io=null,DN=0,Rp=1/0,cc=null,aS=!1,hA=null,wl=null,iy=!1,ml=null,cS=0,eg=0,pA=null,by=-1,Iy=0;function Fi(){return yn&6?Pr():by!==-1?by:by=Pr()}function Rl(r){return r.mode&1?yn&2&&hi!==0?hi&-hi:yde.transition!==null?(Iy===0&&(Iy=e8()),Iy):(r=xn,r!==0||(r=window.event,r=r===void 0?16:a8(r.type)),r):1}function Gs(r,i,a,l){if(50<eg)throw eg=0,pA=null,Error(Ue(185));xg(r,a,l),(!(yn&2)||r!==ii)&&(r===ii&&(!(yn&2)&&(VS|=a),qr===4&&cl(r,hi)),co(r,l),a===1&&yn===0&&!(i.mode&1)&&(Rp=Pr()+500,LS&&Ul()))}function co(r,i){var a=r.callbackNode;yle(r,i);var l=zy(r,r===ii?hi:0);if(l===0)a!==null&&G3(a),r.callbackNode=null,r.callbackPriority=0;else if(i=l&-l,r.callbackPriority!==i){if(a!=null&&G3(a),i===1)r.tag===0?vde(MB.bind(null,r)):b8(MB.bind(null,r)),mde(function(){!(yn&6)&&Ul()}),a=null;else{switch(t8(l)){case 1:a=iN;break;case 4:a=Q6;break;case 16:a=Gy;break;case 536870912:a=Z6;break;default:a=Gy}a=RW(a,_W.bind(null,r))}r.callbackPriority=i,r.callbackNode=a}}function _W(r,i){if(by=-1,Iy=0,yn&6)throw Error(Ue(327));var a=r.callbackNode;if(op()&&r.callbackNode!==a)return null;var l=zy(r,r===ii?hi:0);if(l===0)return null;if(l&30||l&r.expiredLanes||i)i=lS(r,l);else{i=l;var u=yn;yn|=2;var f=vW();(ii!==r||hi!==i)&&(cc=null,Rp=Pr()+500,Bd(r,i));do try{Fde();break}catch(v){EW(r,v)}while(!0);_N(),sS.current=f,yn=u,Fr!==null?i=0:(ii=null,hi=0,i=qr)}if(i!==0){if(i===2&&(u=FI(r),u!==0&&(l=u,i=fA(r,u))),i===1)throw a=vg,Bd(r,0),cl(r,l),co(r,Pr()),a;if(i===6)cl(r,l);else{if(u=r.current.alternate,!(l&30)&&!jde(u)&&(i=lS(r,l),i===2&&(f=FI(r),f!==0&&(l=f,i=fA(r,f))),i===1))throw a=vg,Bd(r,0),cl(r,l),co(r,Pr()),a;switch(r.finishedWork=u,r.finishedLanes=l,i){case 0:case 1:throw Error(Ue(345));case 2:Nd(r,io,cc);break;case 3:if(cl(r,l),(l&130023424)===l&&(i=DN+500-Pr(),10<i)){if(zy(r,0)!==0)break;if(u=r.suspendedLanes,(u&l)!==l){Fi(),r.pingedLanes|=r.suspendedLanes&u;break}r.timeoutHandle=qI(Nd.bind(null,r,io,cc),i);break}Nd(r,io,cc);break;case 4:if(cl(r,l),(l&4194240)===l)break;for(i=r.eventTimes,u=-1;0<l;){var _=31-Hs(l);f=1<<_,_=i[_],_>u&&(u=_),l&=~f}if(l=u,l=Pr()-l,l=(120>l?120:480>l?480:1080>l?1080:1920>l?1920:3e3>l?3e3:4320>l?4320:1960*Ude(l/1960))-l,10<l){r.timeoutHandle=qI(Nd.bind(null,r,io,cc),l);break}Nd(r,io,cc);break;case 5:Nd(r,io,cc);break;default:throw Error(Ue(329))}}}return co(r,Pr()),r.callbackNode===a?_W.bind(null,r):null}function fA(r,i){var a=Zm;return r.current.memoizedState.isDehydrated&&(Bd(r,i).flags|=256),r=lS(r,i),r!==2&&(i=io,io=a,i!==null&&mA(i)),r}function mA(r){io===null?io=r:io.push.apply(io,r)}function jde(r){for(var i=r;;){if(i.flags&16384){var a=i.updateQueue;if(a!==null&&(a=a.stores,a!==null))for(var l=0;l<a.length;l++){var u=a[l],f=u.getSnapshot;u=u.value;try{if(!zs(f(),u))return!1}catch{return!1}}}if(a=i.child,i.subtreeFlags&16384&&a!==null)a.return=i,i=a;else{if(i===r)break;for(;i.sibling===null;){if(i.return===null||i.return===r)return!0;i=i.return}i.sibling.return=i.return,i=i.sibling}}return!0}function cl(r,i){for(i&=~PN,i&=~VS,r.suspendedLanes|=i,r.pingedLanes&=~i,r=r.expirationTimes;0<i;){var a=31-Hs(i),l=1<<a;r[a]=-1,i&=~l}}function MB(r){if(yn&6)throw Error(Ue(327));op();var i=zy(r,0);if(!(i&1))return co(r,Pr()),null;var a=lS(r,i);if(r.tag!==0&&a===2){var l=FI(r);l!==0&&(i=l,a=fA(r,l))}if(a===1)throw a=vg,Bd(r,0),cl(r,i),co(r,Pr()),a;if(a===6)throw Error(Ue(345));return r.finishedWork=r.current.alternate,r.finishedLanes=i,Nd(r,io,cc),co(r,Pr()),null}function kN(r,i){var a=yn;yn|=1;try{return r(i)}finally{yn=a,yn===0&&(Rp=Pr()+500,LS&&Ul())}}function Jd(r){ml!==null&&ml.tag===0&&!(yn&6)&&op();var i=yn;yn|=1;var a=hs.transition,l=xn;try{if(hs.transition=null,xn=1,r)return r()}finally{xn=l,hs.transition=a,yn=i,!(yn&6)&&Ul()}}function xN(){bo=Zh.current,tr(Zh)}function Bd(r,i){r.finishedWork=null,r.finishedLanes=0;var a=r.timeoutHandle;if(a!==-1&&(r.timeoutHandle=-1,fde(a)),Fr!==null)for(a=Fr.return;a!==null;){var l=a;switch(fN(l),l.tag){case 1:l=l.type.childContextTypes,l!=null&&$y();break;case 3:Tp(),tr(so),tr(Ni),wN();break;case 5:TN(l);break;case 4:Tp();break;case 13:tr(hr);break;case 19:tr(hr);break;case 10:EN(l.type._context);break;case 22:case 23:xN()}a=a.return}if(ii=r,Fr=r=Cl(r.current,null),hi=bo=i,qr=0,vg=null,PN=VS=$d=0,io=Zm=null,kd!==null){for(i=0;i<kd.length;i++)if(a=kd[i],l=a.interleaved,l!==null){a.interleaved=null;var u=l.next,f=a.pending;if(f!==null){var _=f.next;f.next=u,l.next=_}a.pending=l}kd=null}return r}function EW(r,i){do{var a=Fr;try{if(_N(),wy.current=oS,iS){for(var l=fr.memoizedState;l!==null;){var u=l.queue;u!==null&&(u.pending=null),l=l.next}iS=!1}if(Xd=0,ri=Yr=fr=null,Jm=!1,gg=0,ON.current=null,a===null||a.return===null){qr=1,vg=i,Fr=null;break}e:{var f=r,_=a.return,v=a,w=i;if(i=hi,v.flags|=32768,w!==null&&typeof w=="object"&&typeof w.then=="function"){var C=w,N=v,D=N.tag;if(!(N.mode&1)&&(D===0||D===11||D===15)){var O=N.alternate;O?(N.updateQueue=O.updateQueue,N.memoizedState=O.memoizedState,N.lanes=O.lanes):(N.updateQueue=null,N.memoizedState=null)}var G=wB(_);if(G!==null){G.flags&=-257,RB(G,_,v,f,i),G.mode&1&&TB(f,C,i),i=G,w=C;var F=i.updateQueue;if(F===null){var V=new Set;V.add(w),i.updateQueue=V}else F.add(w);break e}else{if(!(i&1)){TB(f,C,i),LN();break e}w=Error(Ue(426))}}else if(or&&v.mode&1){var L=wB(_);if(L!==null){!(L.flags&65536)&&(L.flags|=256),RB(L,_,v,f,i),mN(wp(w,v));break e}}f=w=wp(w,v),qr!==4&&(qr=2),Zm===null?Zm=[f]:Zm.push(f),f=_;do{switch(f.tag){case 3:f.flags|=65536,i&=-i,f.lanes|=i;var B=tW(f,w,i);gB(f,B);break e;case 1:v=w;var W=f.type,z=f.stateNode;if(!(f.flags&128)&&(typeof W.getDerivedStateFromError=="function"||z!==null&&typeof z.componentDidCatch=="function"&&(wl===null||!wl.has(z)))){f.flags|=65536,i&=-i,f.lanes|=i;var $=nW(f,v,i);gB(f,$);break e}}f=f.return}while(f!==null)}SW(a)}catch(te){i=te,Fr===a&&a!==null&&(Fr=a=a.return);continue}break}while(!0)}function vW(){var r=sS.current;return sS.current=oS,r===null?oS:r}function LN(){(qr===0||qr===3||qr===2)&&(qr=4),ii===null||!($d&268435455)&&!(VS&268435455)||cl(ii,hi)}function lS(r,i){var a=yn;yn|=2;var l=vW();(ii!==r||hi!==i)&&(cc=null,Bd(r,i));do try{Vde();break}catch(u){EW(r,u)}while(!0);if(_N(),yn=a,sS.current=l,Fr!==null)throw Error(Ue(261));return ii=null,hi=0,qr}function Vde(){for(;Fr!==null;)yW(Fr)}function Fde(){for(;Fr!==null&&!ule();)yW(Fr)}function yW(r){var i=wW(r.alternate,r,bo);r.memoizedProps=r.pendingProps,i===null?SW(r):Fr=i,ON.current=null}function SW(r){var i=r;do{var a=i.alternate;if(r=i.return,i.flags&32768){if(a=kde(a,i),a!==null){a.flags&=32767,Fr=a;return}if(r!==null)r.flags|=32768,r.subtreeFlags=0,r.deletions=null;else{qr=6,Fr=null;return}}else if(a=Dde(a,i,bo),a!==null){Fr=a;return}if(i=i.sibling,i!==null){Fr=i;return}Fr=i=r}while(i!==null);qr===0&&(qr=5)}function Nd(r,i,a){var l=xn,u=hs.transition;try{hs.transition=null,xn=1,Bde(r,i,a,l)}finally{hs.transition=u,xn=l}return null}function Bde(r,i,a,l){do op();while(ml!==null);if(yn&6)throw Error(Ue(327));a=r.finishedWork;var u=r.finishedLanes;if(a===null)return null;if(r.finishedWork=null,r.finishedLanes=0,a===r.current)throw Error(Ue(177));r.callbackNode=null,r.callbackPriority=0;var f=a.lanes|a.childLanes;if(Sle(r,f),r===ii&&(Fr=ii=null,hi=0),!(a.subtreeFlags&2064)&&!(a.flags&2064)||iy||(iy=!0,RW(Gy,function(){return op(),null})),f=(a.flags&15990)!==0,a.subtreeFlags&15990||f){f=hs.transition,hs.transition=null;var _=xn;xn=1;var v=yn;yn|=4,ON.current=null,Lde(r,a),mW(a,r),ade(KI),Ky=!!zI,KI=zI=null,r.current=a,Mde(a),hle(),yn=v,xn=_,hs.transition=f}else r.current=a;if(iy&&(iy=!1,ml=r,cS=u),f=r.pendingLanes,f===0&&(wl=null),mle(a.stateNode),co(r,Pr()),i!==null)for(l=r.onRecoverableError,a=0;a<i.length;a++)u=i[a],l(u.value,{componentStack:u.stack,digest:u.digest});if(aS)throw aS=!1,r=hA,hA=null,r;return cS&1&&r.tag!==0&&op(),f=r.pendingLanes,f&1?r===pA?eg++:(eg=0,pA=r):eg=0,Ul(),null}function op(){if(ml!==null){var r=t8(cS),i=hs.transition,a=xn;try{if(hs.transition=null,xn=16>r?16:r,ml===null)var l=!1;else{if(r=ml,ml=null,cS=0,yn&6)throw Error(Ue(331));var u=yn;for(yn|=4,lt=r.current;lt!==null;){var f=lt,_=f.child;if(lt.flags&16){var v=f.deletions;if(v!==null){for(var w=0;w<v.length;w++){var C=v[w];for(lt=C;lt!==null;){var N=lt;switch(N.tag){case 0:case 11:case 15:Qm(8,N,f)}var D=N.child;if(D!==null)D.return=N,lt=D;else for(;lt!==null;){N=lt;var O=N.sibling,G=N.return;if(hW(N),N===C){lt=null;break}if(O!==null){O.return=G,lt=O;break}lt=G}}}var F=f.alternate;if(F!==null){var V=F.child;if(V!==null){F.child=null;do{var L=V.sibling;V.sibling=null,V=L}while(V!==null)}}lt=f}}if(f.subtreeFlags&2064&&_!==null)_.return=f,lt=_;else e:for(;lt!==null;){if(f=lt,f.flags&2048)switch(f.tag){case 0:case 11:case 15:Qm(9,f,f.return)}var B=f.sibling;if(B!==null){B.return=f.return,lt=B;break e}lt=f.return}}var W=r.current;for(lt=W;lt!==null;){_=lt;var z=_.child;if(_.subtreeFlags&2064&&z!==null)z.return=_,lt=z;else e:for(_=W;lt!==null;){if(v=lt,v.flags&2048)try{switch(v.tag){case 0:case 11:case 15:jS(9,v)}}catch(te){Tr(v,v.return,te)}if(v===_){lt=null;break e}var $=v.sibling;if($!==null){$.return=v.return,lt=$;break e}lt=v.return}}if(yn=u,Ul(),Pa&&typeof Pa.onPostCommitFiberRoot=="function")try{Pa.onPostCommitFiberRoot(OS,r)}catch{}l=!0}return l}finally{xn=a,hs.transition=i}}return!1}function UB(r,i,a){i=wp(a,i),i=tW(r,i,1),r=Tl(r,i,1),i=Fi(),r!==null&&(xg(r,1,i),co(r,i))}function Tr(r,i,a){if(r.tag===3)UB(r,r,a);else for(;i!==null;){if(i.tag===3){UB(i,r,a);break}else if(i.tag===1){var l=i.stateNode;if(typeof i.type.getDerivedStateFromError=="function"||typeof l.componentDidCatch=="function"&&(wl===null||!wl.has(l))){r=wp(a,r),r=nW(i,r,1),i=Tl(i,r,1),r=Fi(),i!==null&&(xg(i,1,r),co(i,r));break}}i=i.return}}function Wde(r,i,a){var l=r.pingCache;l!==null&&l.delete(i),i=Fi(),r.pingedLanes|=r.suspendedLanes&a,ii===r&&(hi&a)===a&&(qr===4||qr===3&&(hi&130023424)===hi&&500>Pr()-DN?Bd(r,0):PN|=a),co(r,i)}function TW(r,i){i===0&&(r.mode&1?(i=qv,qv<<=1,!(qv&130023424)&&(qv=4194304)):i=1);var a=Fi();r=mc(r,i),r!==null&&(xg(r,i,a),co(r,a))}function Hde(r){var i=r.memoizedState,a=0;i!==null&&(a=i.retryLane),TW(r,a)}function Gde(r,i){var a=0;switch(r.tag){case 13:var l=r.stateNode,u=r.memoizedState;u!==null&&(a=u.retryLane);break;case 19:l=r.stateNode;break;default:throw Error(Ue(314))}l!==null&&l.delete(i),TW(r,a)}var wW;wW=function(r,i,a){if(r!==null)if(r.memoizedProps!==i.pendingProps||so.current)oo=!0;else{if(!(r.lanes&a)&&!(i.flags&128))return oo=!1,Pde(r,i,a);oo=!!(r.flags&131072)}else oo=!1,or&&i.flags&1048576&&I8(i,Zy,i.index);switch(i.lanes=0,i.tag){case 2:var l=i.type;Cy(r,i),r=i.pendingProps;var u=vp(i,Ni.current);ip(i,a),u=CN(null,i,l,r,u,a);var f=bN();return i.flags|=1,typeof u=="object"&&u!==null&&typeof u.render=="function"&&u.$$typeof===void 0?(i.tag=1,i.memoizedState=null,i.updateQueue=null,ao(l)?(f=!0,Jy(i)):f=!1,i.memoizedState=u.state!==null&&u.state!==void 0?u.state:null,yN(i),u.updater=US,i.stateNode=u,u._reactInternals=i,tA(i,l,r,a),i=iA(null,i,l,!0,f,a)):(i.tag=0,or&&f&&pN(i),ji(null,i,u,a),i=i.child),i;case 16:l=i.elementType;e:{switch(Cy(r,i),r=i.pendingProps,u=l._init,l=u(l._payload),i.type=l,u=i.tag=Kde(l),r=Ms(l,r),u){case 0:i=rA(null,i,l,r,a);break e;case 1:i=IB(null,i,l,r,a);break e;case 11:i=CB(null,i,l,r,a);break e;case 14:i=bB(null,i,l,Ms(l.type,r),a);break e}throw Error(Ue(306,l,""))}return i;case 0:return l=i.type,u=i.pendingProps,u=i.elementType===l?u:Ms(l,u),rA(r,i,l,u,a);case 1:return l=i.type,u=i.pendingProps,u=i.elementType===l?u:Ms(l,u),IB(r,i,l,u,a);case 3:e:{if(sW(i),r===null)throw Error(Ue(387));l=i.pendingProps,f=i.memoizedState,u=f.element,k8(r,i),nS(i,l,null,a);var _=i.memoizedState;if(l=_.element,f.isDehydrated)if(f={element:l,isDehydrated:!1,cache:_.cache,pendingSuspenseBoundaries:_.pendingSuspenseBoundaries,transitions:_.transitions},i.updateQueue.baseState=f,i.memoizedState=f,i.flags&256){u=wp(Error(Ue(423)),i),i=AB(r,i,l,a,u);break e}else if(l!==u){u=wp(Error(Ue(424)),i),i=AB(r,i,l,a,u);break e}else for(Ao=Sl(i.stateNode.containerInfo.firstChild),Oo=i,or=!0,Bs=null,a=P8(i,null,l,a),i.child=a;a;)a.flags=a.flags&-3|4096,a=a.sibling;else{if(yp(),l===u){i=gc(r,i,a);break e}ji(r,i,l,a)}i=i.child}return i;case 5:return x8(i),r===null&&QI(i),l=i.type,u=i.pendingProps,f=r!==null?r.memoizedProps:null,_=u.children,YI(l,u)?_=null:f!==null&&YI(l,f)&&(i.flags|=32),oW(r,i),ji(r,i,_,a),i.child;case 6:return r===null&&QI(i),null;case 13:return aW(r,i,a);case 4:return SN(i,i.stateNode.containerInfo),l=i.pendingProps,r===null?i.child=Sp(i,null,l,a):ji(r,i,l,a),i.child;case 11:return l=i.type,u=i.pendingProps,u=i.elementType===l?u:Ms(l,u),CB(r,i,l,u,a);case 7:return ji(r,i,i.pendingProps,a),i.child;case 8:return ji(r,i,i.pendingProps.children,a),i.child;case 12:return ji(r,i,i.pendingProps.children,a),i.child;case 10:e:{if(l=i.type._context,u=i.pendingProps,f=i.memoizedProps,_=u.value,Yn(eS,l._currentValue),l._currentValue=_,f!==null)if(zs(f.value,_)){if(f.children===u.children&&!so.current){i=gc(r,i,a);break e}}else for(f=i.child,f!==null&&(f.return=i);f!==null;){var v=f.dependencies;if(v!==null){_=f.child;for(var w=v.firstContext;w!==null;){if(w.context===l){if(f.tag===1){w=hc(-1,a&-a),w.tag=2;var C=f.updateQueue;if(C!==null){C=C.shared;var N=C.pending;N===null?w.next=w:(w.next=N.next,N.next=w),C.pending=w}}f.lanes|=a,w=f.alternate,w!==null&&(w.lanes|=a),ZI(f.return,a,i),v.lanes|=a;break}w=w.next}}else if(f.tag===10)_=f.type===i.type?null:f.child;else if(f.tag===18){if(_=f.return,_===null)throw Error(Ue(341));_.lanes|=a,v=_.alternate,v!==null&&(v.lanes|=a),ZI(_,a,i),_=f.sibling}else _=f.child;if(_!==null)_.return=f;else for(_=f;_!==null;){if(_===i){_=null;break}if(f=_.sibling,f!==null){f.return=_.return,_=f;break}_=_.return}f=_}ji(r,i,u.children,a),i=i.child}return i;case 9:return u=i.type,l=i.pendingProps.children,ip(i,a),u=ps(u),l=l(u),i.flags|=1,ji(r,i,l,a),i.child;case 14:return l=i.type,u=Ms(l,i.pendingProps),u=Ms(l.type,u),bB(r,i,l,u,a);case 15:return rW(r,i,i.type,i.pendingProps,a);case 17:return l=i.type,u=i.pendingProps,u=i.elementType===l?u:Ms(l,u),Cy(r,i),i.tag=1,ao(l)?(r=!0,Jy(i)):r=!1,ip(i,a),eW(i,l,u),tA(i,l,u,a),iA(null,i,l,!0,r,a);case 19:return cW(r,i,a);case 22:return iW(r,i,a)}throw Error(Ue(156,i.tag))};function RW(r,i){return J6(r,i)}function zde(r,i,a,l){this.tag=r,this.key=a,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=i,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=l,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function us(r,i,a,l){return new zde(r,i,a,l)}function MN(r){return r=r.prototype,!(!r||!r.isReactComponent)}function Kde(r){if(typeof r=="function")return MN(r)?1:0;if(r!=null){if(r=r.$$typeof,r===tN)return 11;if(r===nN)return 14}return 2}function Cl(r,i){var a=r.alternate;return a===null?(a=us(r.tag,i,r.key,r.mode),a.elementType=r.elementType,a.type=r.type,a.stateNode=r.stateNode,a.alternate=r,r.alternate=a):(a.pendingProps=i,a.type=r.type,a.flags=0,a.subtreeFlags=0,a.deletions=null),a.flags=r.flags&14680064,a.childLanes=r.childLanes,a.lanes=r.lanes,a.child=r.child,a.memoizedProps=r.memoizedProps,a.memoizedState=r.memoizedState,a.updateQueue=r.updateQueue,i=r.dependencies,a.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext},a.sibling=r.sibling,a.index=r.index,a.ref=r.ref,a}function Ay(r,i,a,l,u,f){var _=2;if(l=r,typeof r=="function")MN(r)&&(_=1);else if(typeof r=="string")_=5;else e:switch(r){case Hh:return Wd(a.children,u,f,i);case eN:_=8,u|=8;break;case CI:return r=us(12,a,i,u|2),r.elementType=CI,r.lanes=f,r;case bI:return r=us(13,a,i,u),r.elementType=bI,r.lanes=f,r;case II:return r=us(19,a,i,u),r.elementType=II,r.lanes=f,r;case x6:return FS(a,u,f,i);default:if(typeof r=="object"&&r!==null)switch(r.$$typeof){case D6:_=10;break e;case k6:_=9;break e;case tN:_=11;break e;case nN:_=14;break e;case ol:_=16,l=null;break e}throw Error(Ue(130,r==null?r:typeof r,""))}return i=us(_,a,i,u),i.elementType=r,i.type=l,i.lanes=f,i}function Wd(r,i,a,l){return r=us(7,r,l,i),r.lanes=a,r}function FS(r,i,a,l){return r=us(22,r,l,i),r.elementType=x6,r.lanes=a,r.stateNode={isHidden:!1},r}function tI(r,i,a){return r=us(6,r,null,i),r.lanes=a,r}function nI(r,i,a){return i=us(4,r.children!==null?r.children:[],r.key,i),i.lanes=a,i.stateNode={containerInfo:r.containerInfo,pendingChildren:null,implementation:r.implementation},i}function Yde(r,i,a,l,u){this.tag=i,this.containerInfo=r,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Mb(0),this.expirationTimes=Mb(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Mb(0),this.identifierPrefix=l,this.onRecoverableError=u,this.mutableSourceEagerHydrationData=null}function UN(r,i,a,l,u,f,_,v,w){return r=new Yde(r,i,a,v,w),i===1?(i=1,f===!0&&(i|=8)):i=0,f=us(3,null,null,i),r.current=f,f.stateNode=r,f.memoizedState={element:l,isDehydrated:a,cache:null,transitions:null,pendingSuspenseBoundaries:null},yN(f),r}function qde(r,i,a){var l=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Wh,key:l==null?null:""+l,children:r,containerInfo:i,implementation:a}}function CW(r){if(!r)return Nl;r=r._reactInternals;e:{if(au(r)!==r||r.tag!==1)throw Error(Ue(170));var i=r;do{switch(i.tag){case 3:i=i.stateNode.context;break e;case 1:if(ao(i.type)){i=i.stateNode.__reactInternalMemoizedMergedChildContext;break e}}i=i.return}while(i!==null);throw Error(Ue(171))}if(r.tag===1){var a=r.type;if(ao(a))return C8(r,a,i)}return i}function bW(r,i,a,l,u,f,_,v,w){return r=UN(a,l,!0,r,u,f,_,v,w),r.context=CW(null),a=r.current,l=Fi(),u=Rl(a),f=hc(l,u),f.callback=i??null,Tl(a,f,u),r.current.lanes=u,xg(r,u,l),co(r,l),r}function BS(r,i,a,l){var u=i.current,f=Fi(),_=Rl(u);return a=CW(a),i.context===null?i.context=a:i.pendingContext=a,i=hc(f,_),i.payload={element:r},l=l===void 0?null:l,l!==null&&(i.callback=l),r=Tl(u,i,_),r!==null&&(Gs(r,u,_,f),Ty(r,u,_)),_}function dS(r){if(r=r.current,!r.child)return null;switch(r.child.tag){case 5:return r.child.stateNode;default:return r.child.stateNode}}function jB(r,i){if(r=r.memoizedState,r!==null&&r.dehydrated!==null){var a=r.retryLane;r.retryLane=a!==0&&a<i?a:i}}function jN(r,i){jB(r,i),(r=r.alternate)&&jB(r,i)}function Xde(){return null}var IW=typeof reportError=="function"?reportError:function(r){console.error(r)};function VN(r){this._internalRoot=r}WS.prototype.render=VN.prototype.render=function(r){var i=this._internalRoot;if(i===null)throw Error(Ue(409));BS(r,i,null,null)};WS.prototype.unmount=VN.prototype.unmount=function(){var r=this._internalRoot;if(r!==null){this._internalRoot=null;var i=r.containerInfo;Jd(function(){BS(null,r,null,null)}),i[fc]=null}};function WS(r){this._internalRoot=r}WS.prototype.unstable_scheduleHydration=function(r){if(r){var i=i8();r={blockedOn:null,target:r,priority:i};for(var a=0;a<al.length&&i!==0&&i<al[a].priority;a++);al.splice(a,0,r),a===0&&s8(r)}};function FN(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11)}function HS(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11&&(r.nodeType!==8||r.nodeValue!==" react-mount-point-unstable "))}function VB(){}function $de(r,i,a,l,u){if(u){if(typeof l=="function"){var f=l;l=function(){var C=dS(_);f.call(C)}}var _=bW(i,l,r,0,null,!1,!1,"",VB);return r._reactRootContainer=_,r[fc]=_.current,ug(r.nodeType===8?r.parentNode:r),Jd(),_}for(;u=r.lastChild;)r.removeChild(u);if(typeof l=="function"){var v=l;l=function(){var C=dS(w);v.call(C)}}var w=UN(r,0,!1,null,null,!1,!1,"",VB);return r._reactRootContainer=w,r[fc]=w.current,ug(r.nodeType===8?r.parentNode:r),Jd(function(){BS(i,w,a,l)}),w}function GS(r,i,a,l,u){var f=a._reactRootContainer;if(f){var _=f;if(typeof u=="function"){var v=u;u=function(){var w=dS(_);v.call(w)}}BS(i,_,r,u)}else _=$de(a,i,r,u,l);return dS(_)}n8=function(r){switch(r.tag){case 3:var i=r.stateNode;if(i.current.memoizedState.isDehydrated){var a=Wm(i.pendingLanes);a!==0&&(oN(i,a|1),co(i,Pr()),!(yn&6)&&(Rp=Pr()+500,Ul()))}break;case 13:Jd(function(){var l=mc(r,1);if(l!==null){var u=Fi();Gs(l,r,1,u)}}),jN(r,1)}};sN=function(r){if(r.tag===13){var i=mc(r,134217728);if(i!==null){var a=Fi();Gs(i,r,134217728,a)}jN(r,134217728)}};r8=function(r){if(r.tag===13){var i=Rl(r),a=mc(r,i);if(a!==null){var l=Fi();Gs(a,r,i,l)}jN(r,i)}};i8=function(){return xn};o8=function(r,i){var a=xn;try{return xn=r,i()}finally{xn=a}};UI=function(r,i,a){switch(i){case"input":if(OI(r,a),i=a.name,a.type==="radio"&&i!=null){for(a=r;a.parentNode;)a=a.parentNode;for(a=a.querySelectorAll("input[name="+JSON.stringify(""+i)+'][type="radio"]'),i=0;i<a.length;i++){var l=a[i];if(l!==r&&l.form===r.form){var u=xS(l);if(!u)throw Error(Ue(90));M6(l),OI(l,u)}}}break;case"textarea":j6(r,a);break;case"select":i=a.value,i!=null&&ep(r,!!a.multiple,i,!1)}};z6=kN;K6=Jd;var Jde={usingClientEntryPoint:!1,Events:[Mg,Yh,xS,H6,G6,kN]},Dm={findFiberByHostInstance:Dd,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Qde={bundleType:Dm.bundleType,version:Dm.version,rendererPackageName:Dm.rendererPackageName,rendererConfig:Dm.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:vc.ReactCurrentDispatcher,findHostInstanceByFiber:function(r){return r=X6(r),r===null?null:r.stateNode},findFiberByHostInstance:Dm.findFiberByHostInstance||Xde,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var oy=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!oy.isDisabled&&oy.supportsFiber)try{OS=oy.inject(Qde),Pa=oy}catch{}}xo.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Jde;xo.createPortal=function(r,i){var a=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!FN(i))throw Error(Ue(200));return qde(r,i,null,a)};xo.createRoot=function(r,i){if(!FN(r))throw Error(Ue(299));var a=!1,l="",u=IW;return i!=null&&(i.unstable_strictMode===!0&&(a=!0),i.identifierPrefix!==void 0&&(l=i.identifierPrefix),i.onRecoverableError!==void 0&&(u=i.onRecoverableError)),i=UN(r,1,!1,null,null,a,!1,l,u),r[fc]=i.current,ug(r.nodeType===8?r.parentNode:r),new VN(i)};xo.findDOMNode=function(r){if(r==null)return null;if(r.nodeType===1)return r;var i=r._reactInternals;if(i===void 0)throw typeof r.render=="function"?Error(Ue(188)):(r=Object.keys(r).join(","),Error(Ue(268,r)));return r=X6(i),r=r===null?null:r.stateNode,r};xo.flushSync=function(r){return Jd(r)};xo.hydrate=function(r,i,a){if(!HS(i))throw Error(Ue(200));return GS(null,r,i,!0,a)};xo.hydrateRoot=function(r,i,a){if(!FN(r))throw Error(Ue(405));var l=a!=null&&a.hydratedSources||null,u=!1,f="",_=IW;if(a!=null&&(a.unstable_strictMode===!0&&(u=!0),a.identifierPrefix!==void 0&&(f=a.identifierPrefix),a.onRecoverableError!==void 0&&(_=a.onRecoverableError)),i=bW(i,null,r,1,a??null,u,!1,f,_),r[fc]=i.current,ug(r),l)for(r=0;r<l.length;r++)a=l[r],u=a._getVersion,u=u(a._source),i.mutableSourceEagerHydrationData==null?i.mutableSourceEagerHydrationData=[a,u]:i.mutableSourceEagerHydrationData.push(a,u);return new WS(i)};xo.render=function(r,i,a){if(!HS(i))throw Error(Ue(200));return GS(null,r,i,!1,a)};xo.unmountComponentAtNode=function(r){if(!HS(r))throw Error(Ue(40));return r._reactRootContainer?(Jd(function(){GS(null,null,r,!1,function(){r._reactRootContainer=null,r[fc]=null})}),!0):!1};xo.unstable_batchedUpdates=kN;xo.unstable_renderSubtreeIntoContainer=function(r,i,a,l){if(!HS(a))throw Error(Ue(200));if(r==null||r._reactInternals===void 0)throw Error(Ue(38));return GS(r,i,a,!1,l)};xo.version="18.3.1-next-f1338f8080-20240426";function AW(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(AW)}catch(r){console.error(r)}}AW(),A6.exports=xo;var cu=A6.exports;const NW=KA(cu);var OW,FB=cu;OW=FB.createRoot,FB.hydrateRoot;const Zde=1,eue=1e6;let rI=0;function tue(){return rI=(rI+1)%Number.MAX_SAFE_INTEGER,rI.toString()}const iI=new Map,BB=r=>{if(iI.has(r))return;const i=setTimeout(()=>{iI.delete(r),tg({type:"REMOVE_TOAST",toastId:r})},eue);iI.set(r,i)},nue=(r,i)=>{switch(i.type){case"ADD_TOAST":return{...r,toasts:[i.toast,...r.toasts].slice(0,Zde)};case"UPDATE_TOAST":return{...r,toasts:r.toasts.map(a=>a.id===i.toast.id?{...a,...i.toast}:a)};case"DISMISS_TOAST":{const{toastId:a}=i;return a?BB(a):r.toasts.forEach(l=>{BB(l.id)}),{...r,toasts:r.toasts.map(l=>l.id===a||a===void 0?{...l,open:!1}:l)}}case"REMOVE_TOAST":return i.toastId===void 0?{...r,toasts:[]}:{...r,toasts:r.toasts.filter(a=>a.id!==i.toastId)}}},Ny=[];let Oy={toasts:[]};function tg(r){Oy=nue(Oy,r),Ny.forEach(i=>{i(Oy)})}function rue({...r}){const i=tue(),a=u=>tg({type:"UPDATE_TOAST",toast:{...u,id:i}}),l=()=>tg({type:"DISMISS_TOAST",toastId:i});return tg({type:"ADD_TOAST",toast:{...r,id:i,open:!0,onOpenChange:u=>{u||l()}}}),{id:i,dismiss:l,update:a}}function iue(){const[r,i]=k.useState(Oy);return k.useEffect(()=>(Ny.push(i),()=>{const a=Ny.indexOf(i);a>-1&&Ny.splice(a,1)}),[r]),{...r,toast:rue,dismiss:a=>tg({type:"DISMISS_TOAST",toastId:a})}}function At(r,i,{checkForDefaultPrevented:a=!0}={}){return function(u){if(r==null||r(u),a===!1||!u.defaultPrevented)return i==null?void 0:i(u)}}function oue(r,i){typeof r=="function"?r(i):r!=null&&(r.current=i)}function PW(...r){return i=>r.forEach(a=>oue(a,i))}function Tn(...r){return k.useCallback(PW(...r),r)}function sue(r,i=[]){let a=[];function l(f,_){const v=k.createContext(_),w=a.length;a=[...a,_];function C(D){const{scope:O,children:G,...F}=D,V=(O==null?void 0:O[r][w])||v,L=k.useMemo(()=>F,Object.values(F));return S.jsx(V.Provider,{value:L,children:G})}function N(D,O){const G=(O==null?void 0:O[r][w])||v,F=k.useContext(G);if(F)return F;if(_!==void 0)return _;throw new Error(`\`${D}\` must be used within \`${f}\``)}return C.displayName=f+"Provider",[C,N]}const u=()=>{const f=a.map(_=>k.createContext(_));return function(v){const w=(v==null?void 0:v[r])||f;return k.useMemo(()=>({[`__scope${r}`]:{...v,[r]:w}}),[v,w])}};return u.scopeName=r,[l,aue(u,...i)]}function aue(...r){const i=r[0];if(r.length===1)return i;const a=()=>{const l=r.map(u=>({useScope:u(),scopeName:u.scopeName}));return function(f){const _=l.reduce((v,{useScope:w,scopeName:C})=>{const D=w(f)[`__scope${C}`];return{...v,...D}},{});return k.useMemo(()=>({[`__scope${i.scopeName}`]:_}),[_])}};return a.scopeName=i.scopeName,a}var Qd=k.forwardRef((r,i)=>{const{children:a,...l}=r,u=k.Children.toArray(a),f=u.find(cue);if(f){const _=f.props.children,v=u.map(w=>w===f?k.Children.count(_)>1?k.Children.only(null):k.isValidElement(_)?_.props.children:null:w);return S.jsx(gA,{...l,ref:i,children:k.isValidElement(_)?k.cloneElement(_,void 0,v):null})}return S.jsx(gA,{...l,ref:i,children:a})});Qd.displayName="Slot";var gA=k.forwardRef((r,i)=>{const{children:a,...l}=r;if(k.isValidElement(a)){const u=due(a);return k.cloneElement(a,{...lue(l,a.props),ref:i?PW(i,u):u})}return k.Children.count(a)>1?k.Children.only(null):null});gA.displayName="SlotClone";var DW=({children:r})=>S.jsx(S.Fragment,{children:r});function cue(r){return k.isValidElement(r)&&r.type===DW}function lue(r,i){const a={...i};for(const l in i){const u=r[l],f=i[l];/^on[A-Z]/.test(l)?u&&f?a[l]=(...v)=>{f(...v),u(...v)}:u&&(a[l]=u):l==="style"?a[l]={...u,...f}:l==="className"&&(a[l]=[u,f].filter(Boolean).join(" "))}return{...r,...a}}function due(r){var l,u;let i=(l=Object.getOwnPropertyDescriptor(r.props,"ref"))==null?void 0:l.get,a=i&&"isReactWarning"in i&&i.isReactWarning;return a?r.ref:(i=(u=Object.getOwnPropertyDescriptor(r,"ref"))==null?void 0:u.get,a=i&&"isReactWarning"in i&&i.isReactWarning,a?r.props.ref:r.props.ref||r.ref)}function kW(r){const i=r+"CollectionProvider",[a,l]=sue(i),[u,f]=a(i,{collectionRef:{current:null},itemMap:new Map}),_=G=>{const{scope:F,children:V}=G,L=Ve.useRef(null),B=Ve.useRef(new Map).current;return S.jsx(u,{scope:F,itemMap:B,collectionRef:L,children:V})};_.displayName=i;const v=r+"CollectionSlot",w=Ve.forwardRef((G,F)=>{const{scope:V,children:L}=G,B=f(v,V),W=Tn(F,B.collectionRef);return S.jsx(Qd,{ref:W,children:L})});w.displayName=v;const C=r+"CollectionItemSlot",N="data-radix-collection-item",D=Ve.forwardRef((G,F)=>{const{scope:V,children:L,...B}=G,W=Ve.useRef(null),z=Tn(F,W),$=f(C,V);return Ve.useEffect(()=>($.itemMap.set(W,{ref:W,...B}),()=>void $.itemMap.delete(W))),S.jsx(Qd,{[N]:"",ref:z,children:L})});D.displayName=C;function O(G){const F=f(r+"CollectionConsumer",G);return Ve.useCallback(()=>{const L=F.collectionRef.current;if(!L)return[];const B=Array.from(L.querySelectorAll(`[${N}]`));return Array.from(F.itemMap.values()).sort(($,te)=>B.indexOf($.ref.current)-B.indexOf(te.ref.current))},[F.collectionRef,F.itemMap])}return[{Provider:_,Slot:w,ItemSlot:D},O,l]}function uue(r,i){const a=k.createContext(i),l=f=>{const{children:_,...v}=f,w=k.useMemo(()=>v,Object.values(v));return S.jsx(a.Provider,{value:w,children:_})};l.displayName=r+"Provider";function u(f){const _=k.useContext(a);if(_)return _;if(i!==void 0)return i;throw new Error(`\`${f}\` must be used within \`${r}\``)}return[l,u]}function lu(r,i=[]){let a=[];function l(f,_){const v=k.createContext(_),w=a.length;a=[...a,_];const C=D=>{var B;const{scope:O,children:G,...F}=D,V=((B=O==null?void 0:O[r])==null?void 0:B[w])||v,L=k.useMemo(()=>F,Object.values(F));return S.jsx(V.Provider,{value:L,children:G})};C.displayName=f+"Provider";function N(D,O){var V;const G=((V=O==null?void 0:O[r])==null?void 0:V[w])||v,F=k.useContext(G);if(F)return F;if(_!==void 0)return _;throw new Error(`\`${D}\` must be used within \`${f}\``)}return[C,N]}const u=()=>{const f=a.map(_=>k.createContext(_));return function(v){const w=(v==null?void 0:v[r])||f;return k.useMemo(()=>({[`__scope${r}`]:{...v,[r]:w}}),[v,w])}};return u.scopeName=r,[l,hue(u,...i)]}function hue(...r){const i=r[0];if(r.length===1)return i;const a=()=>{const l=r.map(u=>({useScope:u(),scopeName:u.scopeName}));return function(f){const _=l.reduce((v,{useScope:w,scopeName:C})=>{const D=w(f)[`__scope${C}`];return{...v,...D}},{});return k.useMemo(()=>({[`__scope${i.scopeName}`]:_}),[_])}};return a.scopeName=i.scopeName,a}var pue=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],Bt=pue.reduce((r,i)=>{const a=k.forwardRef((l,u)=>{const{asChild:f,..._}=l,v=f?Qd:i;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),S.jsx(v,{..._,ref:u})});return a.displayName=`Primitive.${i}`,{...r,[i]:a}},{});function xW(r,i){r&&cu.flushSync(()=>r.dispatchEvent(i))}function Dr(r){const i=k.useRef(r);return k.useEffect(()=>{i.current=r}),k.useMemo(()=>(...a)=>{var l;return(l=i.current)==null?void 0:l.call(i,...a)},[])}function fue(r,i=globalThis==null?void 0:globalThis.document){const a=Dr(r);k.useEffect(()=>{const l=u=>{u.key==="Escape"&&a(u)};return i.addEventListener("keydown",l,{capture:!0}),()=>i.removeEventListener("keydown",l,{capture:!0})},[a,i])}var mue="DismissableLayer",_A="dismissableLayer.update",gue="dismissableLayer.pointerDownOutside",_ue="dismissableLayer.focusOutside",WB,LW=k.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),jg=k.forwardRef((r,i)=>{const{disableOutsidePointerEvents:a=!1,onEscapeKeyDown:l,onPointerDownOutside:u,onFocusOutside:f,onInteractOutside:_,onDismiss:v,...w}=r,C=k.useContext(LW),[N,D]=k.useState(null),O=(N==null?void 0:N.ownerDocument)??(globalThis==null?void 0:globalThis.document),[,G]=k.useState({}),F=Tn(i,ce=>D(ce)),V=Array.from(C.layers),[L]=[...C.layersWithOutsidePointerEventsDisabled].slice(-1),B=V.indexOf(L),W=N?V.indexOf(N):-1,z=C.layersWithOutsidePointerEventsDisabled.size>0,$=W>=B,te=vue(ce=>{const pe=ce.target,Pe=[...C.branches].some(_e=>_e.contains(pe));!$||Pe||(u==null||u(ce),_==null||_(ce),ce.defaultPrevented||v==null||v())},O),ie=yue(ce=>{const pe=ce.target;[...C.branches].some(_e=>_e.contains(pe))||(f==null||f(ce),_==null||_(ce),ce.defaultPrevented||v==null||v())},O);return fue(ce=>{W===C.layers.size-1&&(l==null||l(ce),!ce.defaultPrevented&&v&&(ce.preventDefault(),v()))},O),k.useEffect(()=>{if(N)return a&&(C.layersWithOutsidePointerEventsDisabled.size===0&&(WB=O.body.style.pointerEvents,O.body.style.pointerEvents="none"),C.layersWithOutsidePointerEventsDisabled.add(N)),C.layers.add(N),HB(),()=>{a&&C.layersWithOutsidePointerEventsDisabled.size===1&&(O.body.style.pointerEvents=WB)}},[N,O,a,C]),k.useEffect(()=>()=>{N&&(C.layers.delete(N),C.layersWithOutsidePointerEventsDisabled.delete(N),HB())},[N,C]),k.useEffect(()=>{const ce=()=>G({});return document.addEventListener(_A,ce),()=>document.removeEventListener(_A,ce)},[]),S.jsx(Bt.div,{...w,ref:F,style:{pointerEvents:z?$?"auto":"none":void 0,...r.style},onFocusCapture:At(r.onFocusCapture,ie.onFocusCapture),onBlurCapture:At(r.onBlurCapture,ie.onBlurCapture),onPointerDownCapture:At(r.onPointerDownCapture,te.onPointerDownCapture)})});jg.displayName=mue;var Eue="DismissableLayerBranch",MW=k.forwardRef((r,i)=>{const a=k.useContext(LW),l=k.useRef(null),u=Tn(i,l);return k.useEffect(()=>{const f=l.current;if(f)return a.branches.add(f),()=>{a.branches.delete(f)}},[a.branches]),S.jsx(Bt.div,{...r,ref:u})});MW.displayName=Eue;function vue(r,i=globalThis==null?void 0:globalThis.document){const a=Dr(r),l=k.useRef(!1),u=k.useRef(()=>{});return k.useEffect(()=>{const f=v=>{if(v.target&&!l.current){let w=function(){UW(gue,a,C,{discrete:!0})};const C={originalEvent:v};v.pointerType==="touch"?(i.removeEventListener("click",u.current),u.current=w,i.addEventListener("click",u.current,{once:!0})):w()}else i.removeEventListener("click",u.current);l.current=!1},_=window.setTimeout(()=>{i.addEventListener("pointerdown",f)},0);return()=>{window.clearTimeout(_),i.removeEventListener("pointerdown",f),i.removeEventListener("click",u.current)}},[i,a]),{onPointerDownCapture:()=>l.current=!0}}function yue(r,i=globalThis==null?void 0:globalThis.document){const a=Dr(r),l=k.useRef(!1);return k.useEffect(()=>{const u=f=>{f.target&&!l.current&&UW(_ue,a,{originalEvent:f},{discrete:!1})};return i.addEventListener("focusin",u),()=>i.removeEventListener("focusin",u)},[i,a]),{onFocusCapture:()=>l.current=!0,onBlurCapture:()=>l.current=!1}}function HB(){const r=new CustomEvent(_A);document.dispatchEvent(r)}function UW(r,i,a,{discrete:l}){const u=a.originalEvent.target,f=new CustomEvent(r,{bubbles:!1,cancelable:!0,detail:a});i&&u.addEventListener(r,i,{once:!0}),l?xW(u,f):u.dispatchEvent(f)}var Sue=jg,Tue=MW,Xr=globalThis!=null&&globalThis.document?k.useLayoutEffect:()=>{},wue="Portal",zS=k.forwardRef((r,i)=>{var v;const{container:a,...l}=r,[u,f]=k.useState(!1);Xr(()=>f(!0),[]);const _=a||u&&((v=globalThis==null?void 0:globalThis.document)==null?void 0:v.body);return _?NW.createPortal(S.jsx(Bt.div,{...l,ref:i}),_):null});zS.displayName=wue;function Rue(r,i){return k.useReducer((a,l)=>i[a][l]??a,r)}var qs=r=>{const{present:i,children:a}=r,l=Cue(i),u=typeof a=="function"?a({present:l.isPresent}):k.Children.only(a),f=Tn(l.ref,bue(u));return typeof a=="function"||l.isPresent?k.cloneElement(u,{ref:f}):null};qs.displayName="Presence";function Cue(r){const[i,a]=k.useState(),l=k.useRef({}),u=k.useRef(r),f=k.useRef("none"),_=r?"mounted":"unmounted",[v,w]=Rue(_,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return k.useEffect(()=>{const C=sy(l.current);f.current=v==="mounted"?C:"none"},[v]),Xr(()=>{const C=l.current,N=u.current;if(N!==r){const O=f.current,G=sy(C);r?w("MOUNT"):G==="none"||(C==null?void 0:C.display)==="none"?w("UNMOUNT"):w(N&&O!==G?"ANIMATION_OUT":"UNMOUNT"),u.current=r}},[r,w]),Xr(()=>{if(i){let C;const N=i.ownerDocument.defaultView??window,D=G=>{const V=sy(l.current).includes(G.animationName);if(G.target===i&&V&&(w("ANIMATION_END"),!u.current)){const L=i.style.animationFillMode;i.style.animationFillMode="forwards",C=N.setTimeout(()=>{i.style.animationFillMode==="forwards"&&(i.style.animationFillMode=L)})}},O=G=>{G.target===i&&(f.current=sy(l.current))};return i.addEventListener("animationstart",O),i.addEventListener("animationcancel",D),i.addEventListener("animationend",D),()=>{N.clearTimeout(C),i.removeEventListener("animationstart",O),i.removeEventListener("animationcancel",D),i.removeEventListener("animationend",D)}}else w("ANIMATION_END")},[i,w]),{isPresent:["mounted","unmountSuspended"].includes(v),ref:k.useCallback(C=>{C&&(l.current=getComputedStyle(C)),a(C)},[])}}function sy(r){return(r==null?void 0:r.animationName)||"none"}function bue(r){var l,u;let i=(l=Object.getOwnPropertyDescriptor(r.props,"ref"))==null?void 0:l.get,a=i&&"isReactWarning"in i&&i.isReactWarning;return a?r.ref:(i=(u=Object.getOwnPropertyDescriptor(r,"ref"))==null?void 0:u.get,a=i&&"isReactWarning"in i&&i.isReactWarning,a?r.props.ref:r.props.ref||r.ref)}function Cp({prop:r,defaultProp:i,onChange:a=()=>{}}){const[l,u]=Iue({defaultProp:i,onChange:a}),f=r!==void 0,_=f?r:l,v=Dr(a),w=k.useCallback(C=>{if(f){const D=typeof C=="function"?C(r):C;D!==r&&v(D)}else u(C)},[f,r,u,v]);return[_,w]}function Iue({defaultProp:r,onChange:i}){const a=k.useState(r),[l]=a,u=k.useRef(l),f=Dr(i);return k.useEffect(()=>{u.current!==l&&(f(l),u.current=l)},[l,u,f]),a}var Aue="VisuallyHidden",Vg=k.forwardRef((r,i)=>S.jsx(Bt.span,{...r,ref:i,style:{position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal",...r.style}}));Vg.displayName=Aue;var Nue=Vg,BN="ToastProvider",[WN,Oue,Pue]=kW("Toast"),[jW,H0e]=lu("Toast",[Pue]),[Due,KS]=jW(BN),VW=r=>{const{__scopeToast:i,label:a="Notification",duration:l=5e3,swipeDirection:u="right",swipeThreshold:f=50,children:_}=r,[v,w]=k.useState(null),[C,N]=k.useState(0),D=k.useRef(!1),O=k.useRef(!1);return a.trim()||console.error(`Invalid prop \`label\` supplied to \`${BN}\`. Expected non-empty \`string\`.`),S.jsx(WN.Provider,{scope:i,children:S.jsx(Due,{scope:i,label:a,duration:l,swipeDirection:u,swipeThreshold:f,toastCount:C,viewport:v,onViewportChange:w,onToastAdd:k.useCallback(()=>N(G=>G+1),[]),onToastRemove:k.useCallback(()=>N(G=>G-1),[]),isFocusedToastEscapeKeyDownRef:D,isClosePausedRef:O,children:_})})};VW.displayName=BN;var FW="ToastViewport",kue=["F8"],EA="toast.viewportPause",vA="toast.viewportResume",BW=k.forwardRef((r,i)=>{const{__scopeToast:a,hotkey:l=kue,label:u="Notifications ({hotkey})",...f}=r,_=KS(FW,a),v=Oue(a),w=k.useRef(null),C=k.useRef(null),N=k.useRef(null),D=k.useRef(null),O=Tn(i,D,_.onViewportChange),G=l.join("+").replace(/Key/g,"").replace(/Digit/g,""),F=_.toastCount>0;k.useEffect(()=>{const L=B=>{var z;l.length!==0&&l.every($=>B[$]||B.code===$)&&((z=D.current)==null||z.focus())};return document.addEventListener("keydown",L),()=>document.removeEventListener("keydown",L)},[l]),k.useEffect(()=>{const L=w.current,B=D.current;if(F&&L&&B){const W=()=>{if(!_.isClosePausedRef.current){const ie=new CustomEvent(EA);B.dispatchEvent(ie),_.isClosePausedRef.current=!0}},z=()=>{if(_.isClosePausedRef.current){const ie=new CustomEvent(vA);B.dispatchEvent(ie),_.isClosePausedRef.current=!1}},$=ie=>{!L.contains(ie.relatedTarget)&&z()},te=()=>{L.contains(document.activeElement)||z()};return L.addEventListener("focusin",W),L.addEventListener("focusout",$),L.addEventListener("pointermove",W),L.addEventListener("pointerleave",te),window.addEventListener("blur",W),window.addEventListener("focus",z),()=>{L.removeEventListener("focusin",W),L.removeEventListener("focusout",$),L.removeEventListener("pointermove",W),L.removeEventListener("pointerleave",te),window.removeEventListener("blur",W),window.removeEventListener("focus",z)}}},[F,_.isClosePausedRef]);const V=k.useCallback(({tabbingDirection:L})=>{const W=v().map(z=>{const $=z.ref.current,te=[$,...Kue($)];return L==="forwards"?te:te.reverse()});return(L==="forwards"?W.reverse():W).flat()},[v]);return k.useEffect(()=>{const L=D.current;if(L){const B=W=>{var te,ie,ce;const z=W.altKey||W.ctrlKey||W.metaKey;if(W.key==="Tab"&&!z){const pe=document.activeElement,Pe=W.shiftKey;if(W.target===L&&Pe){(te=C.current)==null||te.focus();return}const fe=V({tabbingDirection:Pe?"backwards":"forwards"}),xe=fe.findIndex(be=>be===pe);oI(fe.slice(xe+1))?W.preventDefault():Pe?(ie=C.current)==null||ie.focus():(ce=N.current)==null||ce.focus()}};return L.addEventListener("keydown",B),()=>L.removeEventListener("keydown",B)}},[v,V]),S.jsxs(Tue,{ref:w,role:"region","aria-label":u.replace("{hotkey}",G),tabIndex:-1,style:{pointerEvents:F?void 0:"none"},children:[F&&S.jsx(yA,{ref:C,onFocusFromOutsideViewport:()=>{const L=V({tabbingDirection:"forwards"});oI(L)}}),S.jsx(WN.Slot,{scope:a,children:S.jsx(Bt.ol,{tabIndex:-1,...f,ref:O})}),F&&S.jsx(yA,{ref:N,onFocusFromOutsideViewport:()=>{const L=V({tabbingDirection:"backwards"});oI(L)}})]})});BW.displayName=FW;var WW="ToastFocusProxy",yA=k.forwardRef((r,i)=>{const{__scopeToast:a,onFocusFromOutsideViewport:l,...u}=r,f=KS(WW,a);return S.jsx(Vg,{"aria-hidden":!0,tabIndex:0,...u,ref:i,style:{position:"fixed"},onFocus:_=>{var C;const v=_.relatedTarget;!((C=f.viewport)!=null&&C.contains(v))&&l()}})});yA.displayName=WW;var YS="Toast",xue="toast.swipeStart",Lue="toast.swipeMove",Mue="toast.swipeCancel",Uue="toast.swipeEnd",HW=k.forwardRef((r,i)=>{const{forceMount:a,open:l,defaultOpen:u,onOpenChange:f,..._}=r,[v=!0,w]=Cp({prop:l,defaultProp:u,onChange:f});return S.jsx(qs,{present:a||v,children:S.jsx(Fue,{open:v,..._,ref:i,onClose:()=>w(!1),onPause:Dr(r.onPause),onResume:Dr(r.onResume),onSwipeStart:At(r.onSwipeStart,C=>{C.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:At(r.onSwipeMove,C=>{const{x:N,y:D}=C.detail.delta;C.currentTarget.setAttribute("data-swipe","move"),C.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${N}px`),C.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${D}px`)}),onSwipeCancel:At(r.onSwipeCancel,C=>{C.currentTarget.setAttribute("data-swipe","cancel"),C.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),C.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),C.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),C.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:At(r.onSwipeEnd,C=>{const{x:N,y:D}=C.detail.delta;C.currentTarget.setAttribute("data-swipe","end"),C.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),C.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),C.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${N}px`),C.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${D}px`),w(!1)})})})});HW.displayName=YS;var[jue,Vue]=jW(YS,{onClose(){}}),Fue=k.forwardRef((r,i)=>{const{__scopeToast:a,type:l="foreground",duration:u,open:f,onClose:_,onEscapeKeyDown:v,onPause:w,onResume:C,onSwipeStart:N,onSwipeMove:D,onSwipeCancel:O,onSwipeEnd:G,...F}=r,V=KS(YS,a),[L,B]=k.useState(null),W=Tn(i,be=>B(be)),z=k.useRef(null),$=k.useRef(null),te=u||V.duration,ie=k.useRef(0),ce=k.useRef(te),pe=k.useRef(0),{onToastAdd:Pe,onToastRemove:_e}=V,ge=Dr(()=>{var ft;(L==null?void 0:L.contains(document.activeElement))&&((ft=V.viewport)==null||ft.focus()),_()}),fe=k.useCallback(be=>{!be||be===1/0||(window.clearTimeout(pe.current),ie.current=new Date().getTime(),pe.current=window.setTimeout(ge,be))},[ge]);k.useEffect(()=>{const be=V.viewport;if(be){const ft=()=>{fe(ce.current),C==null||C()},je=()=>{const Ge=new Date().getTime()-ie.current;ce.current=ce.current-Ge,window.clearTimeout(pe.current),w==null||w()};return be.addEventListener(EA,je),be.addEventListener(vA,ft),()=>{be.removeEventListener(EA,je),be.removeEventListener(vA,ft)}}},[V.viewport,te,w,C,fe]),k.useEffect(()=>{f&&!V.isClosePausedRef.current&&fe(te)},[f,te,V.isClosePausedRef,fe]),k.useEffect(()=>(Pe(),()=>_e()),[Pe,_e]);const xe=k.useMemo(()=>L?$W(L):null,[L]);return V.viewport?S.jsxs(S.Fragment,{children:[xe&&S.jsx(Bue,{__scopeToast:a,role:"status","aria-live":l==="foreground"?"assertive":"polite","aria-atomic":!0,children:xe}),S.jsx(jue,{scope:a,onClose:ge,children:cu.createPortal(S.jsx(WN.ItemSlot,{scope:a,children:S.jsx(Sue,{asChild:!0,onEscapeKeyDown:At(v,()=>{V.isFocusedToastEscapeKeyDownRef.current||ge(),V.isFocusedToastEscapeKeyDownRef.current=!1}),children:S.jsx(Bt.li,{role:"status","aria-live":"off","aria-atomic":!0,tabIndex:0,"data-state":f?"open":"closed","data-swipe-direction":V.swipeDirection,...F,ref:W,style:{userSelect:"none",touchAction:"none",...r.style},onKeyDown:At(r.onKeyDown,be=>{be.key==="Escape"&&(v==null||v(be.nativeEvent),be.nativeEvent.defaultPrevented||(V.isFocusedToastEscapeKeyDownRef.current=!0,ge()))}),onPointerDown:At(r.onPointerDown,be=>{be.button===0&&(z.current={x:be.clientX,y:be.clientY})}),onPointerMove:At(r.onPointerMove,be=>{if(!z.current)return;const ft=be.clientX-z.current.x,je=be.clientY-z.current.y,Ge=!!$.current,le=["left","right"].includes(V.swipeDirection),Le=["left","up"].includes(V.swipeDirection)?Math.min:Math.max,ot=le?Le(0,ft):0,Xe=le?0:Le(0,je),st=be.pointerType==="touch"?10:2,ze={x:ot,y:Xe},ht={originalEvent:be,delta:ze};Ge?($.current=ze,ay(Lue,D,ht,{discrete:!1})):GB(ze,V.swipeDirection,st)?($.current=ze,ay(xue,N,ht,{discrete:!1}),be.target.setPointerCapture(be.pointerId)):(Math.abs(ft)>st||Math.abs(je)>st)&&(z.current=null)}),onPointerUp:At(r.onPointerUp,be=>{const ft=$.current,je=be.target;if(je.hasPointerCapture(be.pointerId)&&je.releasePointerCapture(be.pointerId),$.current=null,z.current=null,ft){const Ge=be.currentTarget,le={originalEvent:be,delta:ft};GB(ft,V.swipeDirection,V.swipeThreshold)?ay(Uue,G,le,{discrete:!0}):ay(Mue,O,le,{discrete:!0}),Ge.addEventListener("click",Le=>Le.preventDefault(),{once:!0})}})})})}),V.viewport)})]}):null}),Bue=r=>{const{__scopeToast:i,children:a,...l}=r,u=KS(YS,i),[f,_]=k.useState(!1),[v,w]=k.useState(!1);return Gue(()=>_(!0)),k.useEffect(()=>{const C=window.setTimeout(()=>w(!0),1e3);return()=>window.clearTimeout(C)},[]),v?null:S.jsx(zS,{asChild:!0,children:S.jsx(Vg,{...l,children:f&&S.jsxs(S.Fragment,{children:[u.label," ",a]})})})},Wue="ToastTitle",GW=k.forwardRef((r,i)=>{const{__scopeToast:a,...l}=r;return S.jsx(Bt.div,{...l,ref:i})});GW.displayName=Wue;var Hue="ToastDescription",zW=k.forwardRef((r,i)=>{const{__scopeToast:a,...l}=r;return S.jsx(Bt.div,{...l,ref:i})});zW.displayName=Hue;var KW="ToastAction",YW=k.forwardRef((r,i)=>{const{altText:a,...l}=r;return a.trim()?S.jsx(XW,{altText:a,asChild:!0,children:S.jsx(HN,{...l,ref:i})}):(console.error(`Invalid prop \`altText\` supplied to \`${KW}\`. Expected non-empty \`string\`.`),null)});YW.displayName=KW;var qW="ToastClose",HN=k.forwardRef((r,i)=>{const{__scopeToast:a,...l}=r,u=Vue(qW,a);return S.jsx(XW,{asChild:!0,children:S.jsx(Bt.button,{type:"button",...l,ref:i,onClick:At(r.onClick,u.onClose)})})});HN.displayName=qW;var XW=k.forwardRef((r,i)=>{const{__scopeToast:a,altText:l,...u}=r;return S.jsx(Bt.div,{"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":l||void 0,...u,ref:i})});function $W(r){const i=[];return Array.from(r.childNodes).forEach(l=>{if(l.nodeType===l.TEXT_NODE&&l.textContent&&i.push(l.textContent),zue(l)){const u=l.ariaHidden||l.hidden||l.style.display==="none",f=l.dataset.radixToastAnnounceExclude==="";if(!u)if(f){const _=l.dataset.radixToastAnnounceAlt;_&&i.push(_)}else i.push(...$W(l))}}),i}function ay(r,i,a,{discrete:l}){const u=a.originalEvent.currentTarget,f=new CustomEvent(r,{bubbles:!0,cancelable:!0,detail:a});i&&u.addEventListener(r,i,{once:!0}),l?xW(u,f):u.dispatchEvent(f)}var GB=(r,i,a=0)=>{const l=Math.abs(r.x),u=Math.abs(r.y),f=l>u;return i==="left"||i==="right"?f&&l>a:!f&&u>a};function Gue(r=()=>{}){const i=Dr(r);Xr(()=>{let a=0,l=0;return a=window.requestAnimationFrame(()=>l=window.requestAnimationFrame(i)),()=>{window.cancelAnimationFrame(a),window.cancelAnimationFrame(l)}},[i])}function zue(r){return r.nodeType===r.ELEMENT_NODE}function Kue(r){const i=[],a=document.createTreeWalker(r,NodeFilter.SHOW_ELEMENT,{acceptNode:l=>{const u=l.tagName==="INPUT"&&l.type==="hidden";return l.disabled||l.hidden||u?NodeFilter.FILTER_SKIP:l.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;a.nextNode();)i.push(a.currentNode);return i}function oI(r){const i=document.activeElement;return r.some(a=>a===i?!0:(a.focus(),document.activeElement!==i))}var Yue=VW,JW=BW,QW=HW,ZW=GW,eH=zW,tH=YW,nH=HN;function rH(r){var i,a,l="";if(typeof r=="string"||typeof r=="number")l+=r;else if(typeof r=="object")if(Array.isArray(r)){var u=r.length;for(i=0;i<u;i++)r[i]&&(a=rH(r[i]))&&(l&&(l+=" "),l+=a)}else for(a in r)r[a]&&(l&&(l+=" "),l+=a);return l}function iH(){for(var r,i,a=0,l="",u=arguments.length;a<u;a++)(r=arguments[a])&&(i=rH(r))&&(l&&(l+=" "),l+=i);return l}const zB=r=>typeof r=="boolean"?`${r}`:r===0?"0":r,KB=iH,GN=(r,i)=>a=>{var l;if((i==null?void 0:i.variants)==null)return KB(r,a==null?void 0:a.class,a==null?void 0:a.className);const{variants:u,defaultVariants:f}=i,_=Object.keys(u).map(C=>{const N=a==null?void 0:a[C],D=f==null?void 0:f[C];if(N===null)return null;const O=zB(N)||zB(D);return u[C][O]}),v=a&&Object.entries(a).reduce((C,N)=>{let[D,O]=N;return O===void 0||(C[D]=O),C},{}),w=i==null||(l=i.compoundVariants)===null||l===void 0?void 0:l.reduce((C,N)=>{let{class:D,className:O,...G}=N;return Object.entries(G).every(F=>{let[V,L]=F;return Array.isArray(L)?L.includes({...f,...v}[V]):{...f,...v}[V]===L})?[...C,D,O]:C},[]);return KB(r,_,w,a==null?void 0:a.class,a==null?void 0:a.className)};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const que=r=>r.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),oH=(...r)=>r.filter((i,a,l)=>!!i&&i.trim()!==""&&l.indexOf(i)===a).join(" ").trim();/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var Xue={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $ue=k.forwardRef(({color:r="currentColor",size:i=24,strokeWidth:a=2,absoluteStrokeWidth:l,className:u="",children:f,iconNode:_,...v},w)=>k.createElement("svg",{ref:w,...Xue,width:i,height:i,stroke:r,strokeWidth:l?Number(a)*24/Number(i):a,className:oH("lucide",u),...v},[..._.map(([C,N])=>k.createElement(C,N)),...Array.isArray(f)?f:[f]]));/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qn=(r,i)=>{const a=k.forwardRef(({className:l,...u},f)=>k.createElement($ue,{ref:f,iconNode:i,className:oH(`lucide-${que(r)}`,l),...u}));return a.displayName=`${r}`,a};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jue=qn("BadgeCheck",[["path",{d:"M3.85 8.62a4 4 0 0 1 4.78-4.77 4 4 0 0 1 6.74 0 4 4 0 0 1 4.78 4.78 4 4 0 0 1 0 6.74 4 4 0 0 1-4.77 4.78 4 4 0 0 1-6.75 0 4 4 0 0 1-4.78-4.77 4 4 0 0 1 0-6.76Z",key:"3c2336"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ng=qn("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sH=qn("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zN=qn("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qS=qn("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aH=qn("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Que=qn("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zue=qn("EllipsisVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zd=qn("EyeOff",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eu=qn("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ehe=qn("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const the=qn("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nhe=qn("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cH=qn("MicOff",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M18.89 13.23A7.12 7.12 0 0 0 19 12v-2",key:"80xlxr"}],["path",{d:"M5 10v2a7 7 0 0 0 12 5",key:"p2k8kg"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lH=qn("Mic",[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rhe=qn("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ihe=qn("PinOff",[["path",{d:"M12 17v5",key:"bb1du9"}],["path",{d:"M15 9.34V7a1 1 0 0 1 1-1 2 2 0 0 0 0-4H7.89",key:"znwnzq"}],["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M9 9v1.76a2 2 0 0 1-1.11 1.79l-1.78.9A2 2 0 0 0 5 15.24V16a1 1 0 0 0 1 1h11",key:"c9qhm2"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const KN=qn("Pin",[["path",{d:"M12 17v5",key:"bb1du9"}],["path",{d:"M9 10.76a2 2 0 0 1-1.11 1.79l-1.78.9A2 2 0 0 0 5 15.24V16a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-.76a2 2 0 0 0-1.11-1.79l-1.78-.9A2 2 0 0 1 15 10.76V7a1 1 0 0 1 1-1 2 2 0 0 0 0-4H8a2 2 0 0 0 0 4 1 1 0 0 1 1 1z",key:"1nkz8b"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ohe=qn("Share",[["path",{d:"M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8",key:"1b2hhj"}],["polyline",{points:"16 6 12 2 8 6",key:"m901s6"}],["line",{x1:"12",x2:"12",y1:"2",y2:"15",key:"1p0rca"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const YB=qn("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const she=qn("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const du=qn("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ahe=qn("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dH=qn("VideoOff",[["path",{d:"M10.66 6H14a2 2 0 0 1 2 2v2.5l5.248-3.062A.5.5 0 0 1 22 7.87v8.196",key:"w8jjjt"}],["path",{d:"M16 16a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h2",key:"1xawa7"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const YN=qn("Video",[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qN=qn("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),XN="-",che=r=>{const i=dhe(r),{conflictingClassGroups:a,conflictingClassGroupModifiers:l}=r;return{getClassGroupId:_=>{const v=_.split(XN);return v[0]===""&&v.length!==1&&v.shift(),uH(v,i)||lhe(_)},getConflictingClassGroupIds:(_,v)=>{const w=a[_]||[];return v&&l[_]?[...w,...l[_]]:w}}},uH=(r,i)=>{var _;if(r.length===0)return i.classGroupId;const a=r[0],l=i.nextPart.get(a),u=l?uH(r.slice(1),l):void 0;if(u)return u;if(i.validators.length===0)return;const f=r.join(XN);return(_=i.validators.find(({validator:v})=>v(f)))==null?void 0:_.classGroupId},qB=/^\[(.+)\]$/,lhe=r=>{if(qB.test(r)){const i=qB.exec(r)[1],a=i==null?void 0:i.substring(0,i.indexOf(":"));if(a)return"arbitrary.."+a}},dhe=r=>{const{theme:i,prefix:a}=r,l={nextPart:new Map,validators:[]};return hhe(Object.entries(r.classGroups),a).forEach(([f,_])=>{SA(_,l,f,i)}),l},SA=(r,i,a,l)=>{r.forEach(u=>{if(typeof u=="string"){const f=u===""?i:XB(i,u);f.classGroupId=a;return}if(typeof u=="function"){if(uhe(u)){SA(u(l),i,a,l);return}i.validators.push({validator:u,classGroupId:a});return}Object.entries(u).forEach(([f,_])=>{SA(_,XB(i,f),a,l)})})},XB=(r,i)=>{let a=r;return i.split(XN).forEach(l=>{a.nextPart.has(l)||a.nextPart.set(l,{nextPart:new Map,validators:[]}),a=a.nextPart.get(l)}),a},uhe=r=>r.isThemeGetter,hhe=(r,i)=>i?r.map(([a,l])=>{const u=l.map(f=>typeof f=="string"?i+f:typeof f=="object"?Object.fromEntries(Object.entries(f).map(([_,v])=>[i+_,v])):f);return[a,u]}):r,phe=r=>{if(r<1)return{get:()=>{},set:()=>{}};let i=0,a=new Map,l=new Map;const u=(f,_)=>{a.set(f,_),i++,i>r&&(i=0,l=a,a=new Map)};return{get(f){let _=a.get(f);if(_!==void 0)return _;if((_=l.get(f))!==void 0)return u(f,_),_},set(f,_){a.has(f)?a.set(f,_):u(f,_)}}},hH="!",fhe=r=>{const{separator:i,experimentalParseClassName:a}=r,l=i.length===1,u=i[0],f=i.length,_=v=>{const w=[];let C=0,N=0,D;for(let L=0;L<v.length;L++){let B=v[L];if(C===0){if(B===u&&(l||v.slice(L,L+f)===i)){w.push(v.slice(N,L)),N=L+f;continue}if(B==="/"){D=L;continue}}B==="["?C++:B==="]"&&C--}const O=w.length===0?v:v.substring(N),G=O.startsWith(hH),F=G?O.substring(1):O,V=D&&D>N?D-N:void 0;return{modifiers:w,hasImportantModifier:G,baseClassName:F,maybePostfixModifierPosition:V}};return a?v=>a({className:v,parseClassName:_}):_},mhe=r=>{if(r.length<=1)return r;const i=[];let a=[];return r.forEach(l=>{l[0]==="["?(i.push(...a.sort(),l),a=[]):a.push(l)}),i.push(...a.sort()),i},ghe=r=>({cache:phe(r.cacheSize),parseClassName:fhe(r),...che(r)}),_he=/\s+/,Ehe=(r,i)=>{const{parseClassName:a,getClassGroupId:l,getConflictingClassGroupIds:u}=i,f=[],_=r.trim().split(_he);let v="";for(let w=_.length-1;w>=0;w-=1){const C=_[w],{modifiers:N,hasImportantModifier:D,baseClassName:O,maybePostfixModifierPosition:G}=a(C);let F=!!G,V=l(F?O.substring(0,G):O);if(!V){if(!F){v=C+(v.length>0?" "+v:v);continue}if(V=l(O),!V){v=C+(v.length>0?" "+v:v);continue}F=!1}const L=mhe(N).join(":"),B=D?L+hH:L,W=B+V;if(f.includes(W))continue;f.push(W);const z=u(V,F);for(let $=0;$<z.length;++$){const te=z[$];f.push(B+te)}v=C+(v.length>0?" "+v:v)}return v};function vhe(){let r=0,i,a,l="";for(;r<arguments.length;)(i=arguments[r++])&&(a=pH(i))&&(l&&(l+=" "),l+=a);return l}const pH=r=>{if(typeof r=="string")return r;let i,a="";for(let l=0;l<r.length;l++)r[l]&&(i=pH(r[l]))&&(a&&(a+=" "),a+=i);return a};function yhe(r,...i){let a,l,u,f=_;function _(w){const C=i.reduce((N,D)=>D(N),r());return a=ghe(C),l=a.cache.get,u=a.cache.set,f=v,v(w)}function v(w){const C=l(w);if(C)return C;const N=Ehe(w,a);return u(w,N),N}return function(){return f(vhe.apply(null,arguments))}}const Qn=r=>{const i=a=>a[r]||[];return i.isThemeGetter=!0,i},fH=/^\[(?:([a-z-]+):)?(.+)\]$/i,She=/^\d+\/\d+$/,The=new Set(["px","full","screen"]),whe=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,Rhe=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,Che=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,bhe=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,Ihe=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,ic=r=>sp(r)||The.has(r)||She.test(r),Qc=r=>kp(r,"length",Lhe),sp=r=>!!r&&!Number.isNaN(Number(r)),sI=r=>kp(r,"number",sp),km=r=>!!r&&Number.isInteger(Number(r)),Ahe=r=>r.endsWith("%")&&sp(r.slice(0,-1)),Xt=r=>fH.test(r),Zc=r=>whe.test(r),Nhe=new Set(["length","size","percentage"]),Ohe=r=>kp(r,Nhe,mH),Phe=r=>kp(r,"position",mH),Dhe=new Set(["image","url"]),khe=r=>kp(r,Dhe,Uhe),xhe=r=>kp(r,"",Mhe),xm=()=>!0,kp=(r,i,a)=>{const l=fH.exec(r);return l?l[1]?typeof i=="string"?l[1]===i:i.has(l[1]):a(l[2]):!1},Lhe=r=>Rhe.test(r)&&!Che.test(r),mH=()=>!1,Mhe=r=>bhe.test(r),Uhe=r=>Ihe.test(r),jhe=()=>{const r=Qn("colors"),i=Qn("spacing"),a=Qn("blur"),l=Qn("brightness"),u=Qn("borderColor"),f=Qn("borderRadius"),_=Qn("borderSpacing"),v=Qn("borderWidth"),w=Qn("contrast"),C=Qn("grayscale"),N=Qn("hueRotate"),D=Qn("invert"),O=Qn("gap"),G=Qn("gradientColorStops"),F=Qn("gradientColorStopPositions"),V=Qn("inset"),L=Qn("margin"),B=Qn("opacity"),W=Qn("padding"),z=Qn("saturate"),$=Qn("scale"),te=Qn("sepia"),ie=Qn("skew"),ce=Qn("space"),pe=Qn("translate"),Pe=()=>["auto","contain","none"],_e=()=>["auto","hidden","clip","visible","scroll"],ge=()=>["auto",Xt,i],fe=()=>[Xt,i],xe=()=>["",ic,Qc],be=()=>["auto",sp,Xt],ft=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],je=()=>["solid","dashed","dotted","double","none"],Ge=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],le=()=>["start","end","center","between","around","evenly","stretch"],Le=()=>["","0",Xt],ot=()=>["auto","avoid","all","avoid-page","page","left","right","column"],Xe=()=>[sp,Xt];return{cacheSize:500,separator:":",theme:{colors:[xm],spacing:[ic,Qc],blur:["none","",Zc,Xt],brightness:Xe(),borderColor:[r],borderRadius:["none","","full",Zc,Xt],borderSpacing:fe(),borderWidth:xe(),contrast:Xe(),grayscale:Le(),hueRotate:Xe(),invert:Le(),gap:fe(),gradientColorStops:[r],gradientColorStopPositions:[Ahe,Qc],inset:ge(),margin:ge(),opacity:Xe(),padding:fe(),saturate:Xe(),scale:Xe(),sepia:Le(),skew:Xe(),space:fe(),translate:fe()},classGroups:{aspect:[{aspect:["auto","square","video",Xt]}],container:["container"],columns:[{columns:[Zc]}],"break-after":[{"break-after":ot()}],"break-before":[{"break-before":ot()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...ft(),Xt]}],overflow:[{overflow:_e()}],"overflow-x":[{"overflow-x":_e()}],"overflow-y":[{"overflow-y":_e()}],overscroll:[{overscroll:Pe()}],"overscroll-x":[{"overscroll-x":Pe()}],"overscroll-y":[{"overscroll-y":Pe()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[V]}],"inset-x":[{"inset-x":[V]}],"inset-y":[{"inset-y":[V]}],start:[{start:[V]}],end:[{end:[V]}],top:[{top:[V]}],right:[{right:[V]}],bottom:[{bottom:[V]}],left:[{left:[V]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",km,Xt]}],basis:[{basis:ge()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",Xt]}],grow:[{grow:Le()}],shrink:[{shrink:Le()}],order:[{order:["first","last","none",km,Xt]}],"grid-cols":[{"grid-cols":[xm]}],"col-start-end":[{col:["auto",{span:["full",km,Xt]},Xt]}],"col-start":[{"col-start":be()}],"col-end":[{"col-end":be()}],"grid-rows":[{"grid-rows":[xm]}],"row-start-end":[{row:["auto",{span:[km,Xt]},Xt]}],"row-start":[{"row-start":be()}],"row-end":[{"row-end":be()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",Xt]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",Xt]}],gap:[{gap:[O]}],"gap-x":[{"gap-x":[O]}],"gap-y":[{"gap-y":[O]}],"justify-content":[{justify:["normal",...le()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...le(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...le(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[W]}],px:[{px:[W]}],py:[{py:[W]}],ps:[{ps:[W]}],pe:[{pe:[W]}],pt:[{pt:[W]}],pr:[{pr:[W]}],pb:[{pb:[W]}],pl:[{pl:[W]}],m:[{m:[L]}],mx:[{mx:[L]}],my:[{my:[L]}],ms:[{ms:[L]}],me:[{me:[L]}],mt:[{mt:[L]}],mr:[{mr:[L]}],mb:[{mb:[L]}],ml:[{ml:[L]}],"space-x":[{"space-x":[ce]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[ce]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",Xt,i]}],"min-w":[{"min-w":[Xt,i,"min","max","fit"]}],"max-w":[{"max-w":[Xt,i,"none","full","min","max","fit","prose",{screen:[Zc]},Zc]}],h:[{h:[Xt,i,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[Xt,i,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[Xt,i,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[Xt,i,"auto","min","max","fit"]}],"font-size":[{text:["base",Zc,Qc]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",sI]}],"font-family":[{font:[xm]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractons"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",Xt]}],"line-clamp":[{"line-clamp":["none",sp,sI]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",ic,Xt]}],"list-image":[{"list-image":["none",Xt]}],"list-style-type":[{list:["none","disc","decimal",Xt]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[r]}],"placeholder-opacity":[{"placeholder-opacity":[B]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[r]}],"text-opacity":[{"text-opacity":[B]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...je(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",ic,Qc]}],"underline-offset":[{"underline-offset":["auto",ic,Xt]}],"text-decoration-color":[{decoration:[r]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:fe()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",Xt]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",Xt]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[B]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...ft(),Phe]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",Ohe]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},khe]}],"bg-color":[{bg:[r]}],"gradient-from-pos":[{from:[F]}],"gradient-via-pos":[{via:[F]}],"gradient-to-pos":[{to:[F]}],"gradient-from":[{from:[G]}],"gradient-via":[{via:[G]}],"gradient-to":[{to:[G]}],rounded:[{rounded:[f]}],"rounded-s":[{"rounded-s":[f]}],"rounded-e":[{"rounded-e":[f]}],"rounded-t":[{"rounded-t":[f]}],"rounded-r":[{"rounded-r":[f]}],"rounded-b":[{"rounded-b":[f]}],"rounded-l":[{"rounded-l":[f]}],"rounded-ss":[{"rounded-ss":[f]}],"rounded-se":[{"rounded-se":[f]}],"rounded-ee":[{"rounded-ee":[f]}],"rounded-es":[{"rounded-es":[f]}],"rounded-tl":[{"rounded-tl":[f]}],"rounded-tr":[{"rounded-tr":[f]}],"rounded-br":[{"rounded-br":[f]}],"rounded-bl":[{"rounded-bl":[f]}],"border-w":[{border:[v]}],"border-w-x":[{"border-x":[v]}],"border-w-y":[{"border-y":[v]}],"border-w-s":[{"border-s":[v]}],"border-w-e":[{"border-e":[v]}],"border-w-t":[{"border-t":[v]}],"border-w-r":[{"border-r":[v]}],"border-w-b":[{"border-b":[v]}],"border-w-l":[{"border-l":[v]}],"border-opacity":[{"border-opacity":[B]}],"border-style":[{border:[...je(),"hidden"]}],"divide-x":[{"divide-x":[v]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[v]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[B]}],"divide-style":[{divide:je()}],"border-color":[{border:[u]}],"border-color-x":[{"border-x":[u]}],"border-color-y":[{"border-y":[u]}],"border-color-s":[{"border-s":[u]}],"border-color-e":[{"border-e":[u]}],"border-color-t":[{"border-t":[u]}],"border-color-r":[{"border-r":[u]}],"border-color-b":[{"border-b":[u]}],"border-color-l":[{"border-l":[u]}],"divide-color":[{divide:[u]}],"outline-style":[{outline:["",...je()]}],"outline-offset":[{"outline-offset":[ic,Xt]}],"outline-w":[{outline:[ic,Qc]}],"outline-color":[{outline:[r]}],"ring-w":[{ring:xe()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[r]}],"ring-opacity":[{"ring-opacity":[B]}],"ring-offset-w":[{"ring-offset":[ic,Qc]}],"ring-offset-color":[{"ring-offset":[r]}],shadow:[{shadow:["","inner","none",Zc,xhe]}],"shadow-color":[{shadow:[xm]}],opacity:[{opacity:[B]}],"mix-blend":[{"mix-blend":[...Ge(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":Ge()}],filter:[{filter:["","none"]}],blur:[{blur:[a]}],brightness:[{brightness:[l]}],contrast:[{contrast:[w]}],"drop-shadow":[{"drop-shadow":["","none",Zc,Xt]}],grayscale:[{grayscale:[C]}],"hue-rotate":[{"hue-rotate":[N]}],invert:[{invert:[D]}],saturate:[{saturate:[z]}],sepia:[{sepia:[te]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[a]}],"backdrop-brightness":[{"backdrop-brightness":[l]}],"backdrop-contrast":[{"backdrop-contrast":[w]}],"backdrop-grayscale":[{"backdrop-grayscale":[C]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[N]}],"backdrop-invert":[{"backdrop-invert":[D]}],"backdrop-opacity":[{"backdrop-opacity":[B]}],"backdrop-saturate":[{"backdrop-saturate":[z]}],"backdrop-sepia":[{"backdrop-sepia":[te]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[_]}],"border-spacing-x":[{"border-spacing-x":[_]}],"border-spacing-y":[{"border-spacing-y":[_]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",Xt]}],duration:[{duration:Xe()}],ease:[{ease:["linear","in","out","in-out",Xt]}],delay:[{delay:Xe()}],animate:[{animate:["none","spin","ping","pulse","bounce",Xt]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[$]}],"scale-x":[{"scale-x":[$]}],"scale-y":[{"scale-y":[$]}],rotate:[{rotate:[km,Xt]}],"translate-x":[{"translate-x":[pe]}],"translate-y":[{"translate-y":[pe]}],"skew-x":[{"skew-x":[ie]}],"skew-y":[{"skew-y":[ie]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",Xt]}],accent:[{accent:["auto",r]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",Xt]}],"caret-color":[{caret:[r]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":fe()}],"scroll-mx":[{"scroll-mx":fe()}],"scroll-my":[{"scroll-my":fe()}],"scroll-ms":[{"scroll-ms":fe()}],"scroll-me":[{"scroll-me":fe()}],"scroll-mt":[{"scroll-mt":fe()}],"scroll-mr":[{"scroll-mr":fe()}],"scroll-mb":[{"scroll-mb":fe()}],"scroll-ml":[{"scroll-ml":fe()}],"scroll-p":[{"scroll-p":fe()}],"scroll-px":[{"scroll-px":fe()}],"scroll-py":[{"scroll-py":fe()}],"scroll-ps":[{"scroll-ps":fe()}],"scroll-pe":[{"scroll-pe":fe()}],"scroll-pt":[{"scroll-pt":fe()}],"scroll-pr":[{"scroll-pr":fe()}],"scroll-pb":[{"scroll-pb":fe()}],"scroll-pl":[{"scroll-pl":fe()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",Xt]}],fill:[{fill:[r,"none"]}],"stroke-w":[{stroke:[ic,Qc,sI]}],stroke:[{stroke:[r,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},Vhe=yhe(jhe);function Lt(...r){return Vhe(iH(r))}const Fhe=Yue,gH=k.forwardRef(({className:r,...i},a)=>S.jsx(JW,{ref:a,className:Lt("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",r),...i}));gH.displayName=JW.displayName;const Bhe=GN("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),_H=k.forwardRef(({className:r,variant:i,...a},l)=>S.jsx(QW,{ref:l,className:Lt(Bhe({variant:i}),r),...a}));_H.displayName=QW.displayName;const Whe=k.forwardRef(({className:r,...i},a)=>S.jsx(tH,{ref:a,className:Lt("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",r),...i}));Whe.displayName=tH.displayName;const EH=k.forwardRef(({className:r,...i},a)=>S.jsx(nH,{ref:a,className:Lt("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",r),"toast-close":"",...i,children:S.jsx(qN,{className:"h-4 w-4"})}));EH.displayName=nH.displayName;const vH=k.forwardRef(({className:r,...i},a)=>S.jsx(ZW,{ref:a,className:Lt("text-sm font-semibold",r),...i}));vH.displayName=ZW.displayName;const yH=k.forwardRef(({className:r,...i},a)=>S.jsx(eH,{ref:a,className:Lt("text-sm opacity-90",r),...i}));yH.displayName=eH.displayName;function Hhe(){const{toasts:r}=iue();return S.jsxs(Fhe,{children:[r.map(function({id:i,title:a,description:l,action:u,...f}){return S.jsxs(_H,{...f,children:[S.jsxs("div",{className:"grid gap-1",children:[a&&S.jsx(vH,{children:a}),l&&S.jsx(yH,{children:l})]}),u,S.jsx(EH,{})]},i)}),S.jsx(gH,{})]})}var $B=["light","dark"],Ghe="(prefers-color-scheme: dark)",zhe=k.createContext(void 0),Khe={setTheme:r=>{},themes:[]},Yhe=()=>{var r;return(r=k.useContext(zhe))!=null?r:Khe};k.memo(({forcedTheme:r,storageKey:i,attribute:a,enableSystem:l,enableColorScheme:u,defaultTheme:f,value:_,attrs:v,nonce:w})=>{let C=f==="system",N=a==="class"?`var d=document.documentElement,c=d.classList;${`c.remove(${v.map(F=>`'${F}'`).join(",")})`};`:`var d=document.documentElement,n='${a}',s='setAttribute';`,D=u?$B.includes(f)&&f?`if(e==='light'||e==='dark'||!e)d.style.colorScheme=e||'${f}'`:"if(e==='light'||e==='dark')d.style.colorScheme=e":"",O=(F,V=!1,L=!0)=>{let B=_?_[F]:F,W=V?F+"|| ''":`'${B}'`,z="";return u&&L&&!V&&$B.includes(F)&&(z+=`d.style.colorScheme = '${F}';`),a==="class"?V||B?z+=`c.add(${W})`:z+="null":B&&(z+=`d[s](n,${W})`),z},G=r?`!function(){${N}${O(r)}}()`:l?`!function(){try{${N}var e=localStorage.getItem('${i}');if('system'===e||(!e&&${C})){var t='${Ghe}',m=window.matchMedia(t);if(m.media!==t||m.matches){${O("dark")}}else{${O("light")}}}else if(e){${_?`var x=${JSON.stringify(_)};`:""}${O(_?"x[e]":"e",!0)}}${C?"":"else{"+O(f,!1,!1)+"}"}${D}}catch(e){}}()`:`!function(){try{${N}var e=localStorage.getItem('${i}');if(e){${_?`var x=${JSON.stringify(_)};`:""}${O(_?"x[e]":"e",!0)}}else{${O(f,!1,!1)};}${D}}catch(t){}}();`;return k.createElement("script",{nonce:w,dangerouslySetInnerHTML:{__html:G}})});var qhe=r=>{switch(r){case"success":return Jhe;case"info":return Zhe;case"warning":return Qhe;case"error":return epe;default:return null}},Xhe=Array(12).fill(0),$he=({visible:r})=>Ve.createElement("div",{className:"sonner-loading-wrapper","data-visible":r},Ve.createElement("div",{className:"sonner-spinner"},Xhe.map((i,a)=>Ve.createElement("div",{className:"sonner-loading-bar",key:`spinner-bar-${a}`})))),Jhe=Ve.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},Ve.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z",clipRule:"evenodd"})),Qhe=Ve.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",height:"20",width:"20"},Ve.createElement("path",{fillRule:"evenodd",d:"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z",clipRule:"evenodd"})),Zhe=Ve.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},Ve.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z",clipRule:"evenodd"})),epe=Ve.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},Ve.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})),tpe=()=>{let[r,i]=Ve.useState(document.hidden);return Ve.useEffect(()=>{let a=()=>{i(document.hidden)};return document.addEventListener("visibilitychange",a),()=>window.removeEventListener("visibilitychange",a)},[]),r},TA=1,npe=class{constructor(){this.subscribe=r=>(this.subscribers.push(r),()=>{let i=this.subscribers.indexOf(r);this.subscribers.splice(i,1)}),this.publish=r=>{this.subscribers.forEach(i=>i(r))},this.addToast=r=>{this.publish(r),this.toasts=[...this.toasts,r]},this.create=r=>{var i;let{message:a,...l}=r,u=typeof(r==null?void 0:r.id)=="number"||((i=r.id)==null?void 0:i.length)>0?r.id:TA++,f=this.toasts.find(v=>v.id===u),_=r.dismissible===void 0?!0:r.dismissible;return f?this.toasts=this.toasts.map(v=>v.id===u?(this.publish({...v,...r,id:u,title:a}),{...v,...r,id:u,dismissible:_,title:a}):v):this.addToast({title:a,...l,dismissible:_,id:u}),u},this.dismiss=r=>(r||this.toasts.forEach(i=>{this.subscribers.forEach(a=>a({id:i.id,dismiss:!0}))}),this.subscribers.forEach(i=>i({id:r,dismiss:!0})),r),this.message=(r,i)=>this.create({...i,message:r}),this.error=(r,i)=>this.create({...i,message:r,type:"error"}),this.success=(r,i)=>this.create({...i,type:"success",message:r}),this.info=(r,i)=>this.create({...i,type:"info",message:r}),this.warning=(r,i)=>this.create({...i,type:"warning",message:r}),this.loading=(r,i)=>this.create({...i,type:"loading",message:r}),this.promise=(r,i)=>{if(!i)return;let a;i.loading!==void 0&&(a=this.create({...i,promise:r,type:"loading",message:i.loading,description:typeof i.description!="function"?i.description:void 0}));let l=r instanceof Promise?r:r(),u=a!==void 0;return l.then(async f=>{if(ipe(f)&&!f.ok){u=!1;let _=typeof i.error=="function"?await i.error(`HTTP error! status: ${f.status}`):i.error,v=typeof i.description=="function"?await i.description(`HTTP error! status: ${f.status}`):i.description;this.create({id:a,type:"error",message:_,description:v})}else if(i.success!==void 0){u=!1;let _=typeof i.success=="function"?await i.success(f):i.success,v=typeof i.description=="function"?await i.description(f):i.description;this.create({id:a,type:"success",message:_,description:v})}}).catch(async f=>{if(i.error!==void 0){u=!1;let _=typeof i.error=="function"?await i.error(f):i.error,v=typeof i.description=="function"?await i.description(f):i.description;this.create({id:a,type:"error",message:_,description:v})}}).finally(()=>{var f;u&&(this.dismiss(a),a=void 0),(f=i.finally)==null||f.call(i)}),a},this.custom=(r,i)=>{let a=(i==null?void 0:i.id)||TA++;return this.create({jsx:r(a),id:a,...i}),a},this.subscribers=[],this.toasts=[]}},Ro=new npe,rpe=(r,i)=>{let a=(i==null?void 0:i.id)||TA++;return Ro.addToast({title:r,...i,id:a}),a},ipe=r=>r&&typeof r=="object"&&"ok"in r&&typeof r.ok=="boolean"&&"status"in r&&typeof r.status=="number",ope=rpe,spe=()=>Ro.toasts,it=Object.assign(ope,{success:Ro.success,info:Ro.info,warning:Ro.warning,error:Ro.error,custom:Ro.custom,message:Ro.message,promise:Ro.promise,dismiss:Ro.dismiss,loading:Ro.loading},{getHistory:spe});function ape(r,{insertAt:i}={}){if(typeof document>"u")return;let a=document.head||document.getElementsByTagName("head")[0],l=document.createElement("style");l.type="text/css",i==="top"&&a.firstChild?a.insertBefore(l,a.firstChild):a.appendChild(l),l.styleSheet?l.styleSheet.cssText=r:l.appendChild(document.createTextNode(r))}ape(`:where(html[dir="ltr"]),:where([data-sonner-toaster][dir="ltr"]){--toast-icon-margin-start: -3px;--toast-icon-margin-end: 4px;--toast-svg-margin-start: -1px;--toast-svg-margin-end: 0px;--toast-button-margin-start: auto;--toast-button-margin-end: 0;--toast-close-button-start: 0;--toast-close-button-end: unset;--toast-close-button-transform: translate(-35%, -35%)}:where(html[dir="rtl"]),:where([data-sonner-toaster][dir="rtl"]){--toast-icon-margin-start: 4px;--toast-icon-margin-end: -3px;--toast-svg-margin-start: 0px;--toast-svg-margin-end: -1px;--toast-button-margin-start: 0;--toast-button-margin-end: auto;--toast-close-button-start: unset;--toast-close-button-end: 0;--toast-close-button-transform: translate(35%, -35%)}:where([data-sonner-toaster]){position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1: hsl(0, 0%, 99%);--gray2: hsl(0, 0%, 97.3%);--gray3: hsl(0, 0%, 95.1%);--gray4: hsl(0, 0%, 93%);--gray5: hsl(0, 0%, 90.9%);--gray6: hsl(0, 0%, 88.7%);--gray7: hsl(0, 0%, 85.8%);--gray8: hsl(0, 0%, 78%);--gray9: hsl(0, 0%, 56.1%);--gray10: hsl(0, 0%, 52.3%);--gray11: hsl(0, 0%, 43.5%);--gray12: hsl(0, 0%, 9%);--border-radius: 8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:none;z-index:999999999}:where([data-sonner-toaster][data-x-position="right"]){right:max(var(--offset),env(safe-area-inset-right))}:where([data-sonner-toaster][data-x-position="left"]){left:max(var(--offset),env(safe-area-inset-left))}:where([data-sonner-toaster][data-x-position="center"]){left:50%;transform:translate(-50%)}:where([data-sonner-toaster][data-y-position="top"]){top:max(var(--offset),env(safe-area-inset-top))}:where([data-sonner-toaster][data-y-position="bottom"]){bottom:max(var(--offset),env(safe-area-inset-bottom))}:where([data-sonner-toast]){--y: translateY(100%);--lift-amount: calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);filter:blur(0);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:none;overflow-wrap:anywhere}:where([data-sonner-toast][data-styled="true"]){padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px #0000001a;width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}:where([data-sonner-toast]:focus-visible){box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast][data-y-position="top"]){top:0;--y: translateY(-100%);--lift: 1;--lift-amount: calc(1 * var(--gap))}:where([data-sonner-toast][data-y-position="bottom"]){bottom:0;--y: translateY(100%);--lift: -1;--lift-amount: calc(var(--lift) * var(--gap))}:where([data-sonner-toast]) :where([data-description]){font-weight:400;line-height:1.4;color:inherit}:where([data-sonner-toast]) :where([data-title]){font-weight:500;line-height:1.5;color:inherit}:where([data-sonner-toast]) :where([data-icon]){display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}:where([data-sonner-toast][data-promise="true"]) :where([data-icon])>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}:where([data-sonner-toast]) :where([data-icon])>*{flex-shrink:0}:where([data-sonner-toast]) :where([data-icon]) svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}:where([data-sonner-toast]) :where([data-content]){display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;cursor:pointer;outline:none;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}:where([data-sonner-toast]) :where([data-button]):focus-visible{box-shadow:0 0 0 2px #0006}:where([data-sonner-toast]) :where([data-button]):first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}:where([data-sonner-toast]) :where([data-cancel]){color:var(--normal-text);background:rgba(0,0,0,.08)}:where([data-sonner-toast][data-theme="dark"]) :where([data-cancel]){background:rgba(255,255,255,.3)}:where([data-sonner-toast]) :where([data-close-button]){position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;background:var(--gray1);color:var(--gray12);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}:where([data-sonner-toast]) :where([data-close-button]):focus-visible{box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast]) :where([data-disabled="true"]){cursor:not-allowed}:where([data-sonner-toast]):hover :where([data-close-button]):hover{background:var(--gray2);border-color:var(--gray5)}:where([data-sonner-toast][data-swiping="true"]):before{content:"";position:absolute;left:0;right:0;height:100%;z-index:-1}:where([data-sonner-toast][data-y-position="top"][data-swiping="true"]):before{bottom:50%;transform:scaleY(3) translateY(50%)}:where([data-sonner-toast][data-y-position="bottom"][data-swiping="true"]):before{top:50%;transform:scaleY(3) translateY(-50%)}:where([data-sonner-toast][data-swiping="false"][data-removed="true"]):before{content:"";position:absolute;inset:0;transform:scaleY(2)}:where([data-sonner-toast]):after{content:"";position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}:where([data-sonner-toast][data-mounted="true"]){--y: translateY(0);opacity:1}:where([data-sonner-toast][data-expanded="false"][data-front="false"]){--scale: var(--toasts-before) * .05 + 1;--y: translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}:where([data-sonner-toast])>*{transition:opacity .4s}:where([data-sonner-toast][data-expanded="false"][data-front="false"][data-styled="true"])>*{opacity:0}:where([data-sonner-toast][data-visible="false"]){opacity:0;pointer-events:none}:where([data-sonner-toast][data-mounted="true"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}:where([data-sonner-toast][data-removed="true"][data-front="true"][data-swipe-out="false"]){--y: translateY(calc(var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="false"]){--y: translateY(40%);opacity:0;transition:transform .5s,opacity .2s}:where([data-sonner-toast][data-removed="true"][data-front="false"]):before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount, 0px));transition:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation:swipe-out .2s ease-out forwards}@keyframes swipe-out{0%{transform:translateY(calc(var(--lift) * var(--offset) + var(--swipe-amount)));opacity:1}to{transform:translateY(calc(var(--lift) * var(--offset) + var(--swipe-amount) + var(--lift) * -100%));opacity:0}}@media (max-width: 600px){[data-sonner-toaster]{position:fixed;--mobile-offset: 16px;right:var(--mobile-offset);left:var(--mobile-offset);width:100%}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset)}[data-sonner-toaster][data-y-position=bottom]{bottom:20px}[data-sonner-toaster][data-y-position=top]{top:20px}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset);right:var(--mobile-offset);transform:none}}[data-sonner-toaster][data-theme=light]{--normal-bg: #fff;--normal-border: var(--gray4);--normal-text: var(--gray12);--success-bg: hsl(143, 85%, 96%);--success-border: hsl(145, 92%, 91%);--success-text: hsl(140, 100%, 27%);--info-bg: hsl(208, 100%, 97%);--info-border: hsl(221, 91%, 91%);--info-text: hsl(210, 92%, 45%);--warning-bg: hsl(49, 100%, 97%);--warning-border: hsl(49, 91%, 91%);--warning-text: hsl(31, 92%, 45%);--error-bg: hsl(359, 100%, 97%);--error-border: hsl(359, 100%, 94%);--error-text: hsl(360, 100%, 45%)}[data-sonner-toaster][data-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg: #fff;--normal-border: var(--gray3);--normal-text: var(--gray12)}[data-sonner-toaster][data-theme=dark]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1);--success-bg: hsl(150, 100%, 6%);--success-border: hsl(147, 100%, 12%);--success-text: hsl(150, 86%, 65%);--info-bg: hsl(215, 100%, 6%);--info-border: hsl(223, 100%, 12%);--info-text: hsl(216, 87%, 65%);--warning-bg: hsl(64, 100%, 6%);--warning-border: hsl(60, 100%, 12%);--warning-text: hsl(46, 87%, 65%);--error-bg: hsl(358, 76%, 10%);--error-border: hsl(357, 89%, 16%);--error-text: hsl(358, 100%, 81%)}[data-rich-colors=true][data-sonner-toast][data-type=success],[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info],[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning],[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error],[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size: 16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:nth-child(1){animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}to{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}to{opacity:.15}}@media (prefers-reduced-motion){[data-sonner-toast],[data-sonner-toast]>*,.sonner-loading-bar{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}
`);function cy(r){return r.label!==void 0}var cpe=3,lpe="32px",dpe=4e3,upe=356,hpe=14,ppe=20,fpe=200;function mpe(...r){return r.filter(Boolean).join(" ")}var gpe=r=>{var i,a,l,u,f,_,v,w,C,N;let{invert:D,toast:O,unstyled:G,interacting:F,setHeights:V,visibleToasts:L,heights:B,index:W,toasts:z,expanded:$,removeToast:te,defaultRichColors:ie,closeButton:ce,style:pe,cancelButtonStyle:Pe,actionButtonStyle:_e,className:ge="",descriptionClassName:fe="",duration:xe,position:be,gap:ft,loadingIcon:je,expandByDefault:Ge,classNames:le,icons:Le,closeButtonAriaLabel:ot="Close toast",pauseWhenPageIsHidden:Xe,cn:st}=r,[ze,ht]=Ve.useState(!1),[dt,at]=Ve.useState(!1),[Fe,Ke]=Ve.useState(!1),[et,nt]=Ve.useState(!1),[bt,It]=Ve.useState(0),[an,kr]=Ve.useState(0),fi=Ve.useRef(null),br=Ve.useRef(null),Ua=W===0,xr=W+1<=L,wn=O.type,Js=O.dismissible!==!1,Hp=O.className||"",b0=O.descriptionClassName||"",Bl=Ve.useMemo(()=>B.findIndex(Nt=>Nt.toastId===O.id)||0,[B,O.id]),Wr=Ve.useMemo(()=>{var Nt;return(Nt=O.closeButton)!=null?Nt:ce},[O.closeButton,ce]),Gp=Ve.useMemo(()=>O.duration||xe||dpe,[O.duration,xe]),gu=Ve.useRef(0),mi=Ve.useRef(0),zp=Ve.useRef(0),Qs=Ve.useRef(null),[Kp,Yg]=be.split("-"),Yp=Ve.useMemo(()=>B.reduce((Nt,Ln,Mn)=>Mn>=Bl?Nt:Nt+Ln.height,0),[B,Bl]),qp=tpe(),ja=O.invert||D,_u=wn==="loading";mi.current=Ve.useMemo(()=>Bl*ft+Yp,[Bl,Yp]),Ve.useEffect(()=>{ht(!0)},[]),Ve.useLayoutEffect(()=>{if(!ze)return;let Nt=br.current,Ln=Nt.style.height;Nt.style.height="auto";let Mn=Nt.getBoundingClientRect().height;Nt.style.height=Ln,kr(Mn),V(Mo=>Mo.find(Uo=>Uo.toastId===O.id)?Mo.map(Uo=>Uo.toastId===O.id?{...Uo,height:Mn}:Uo):[{toastId:O.id,height:Mn,position:O.position},...Mo])},[ze,O.title,O.description,V,O.id]);let Zs=Ve.useCallback(()=>{at(!0),It(mi.current),V(Nt=>Nt.filter(Ln=>Ln.toastId!==O.id)),setTimeout(()=>{te(O)},fpe)},[O,te,V,mi]);Ve.useEffect(()=>{if(O.promise&&wn==="loading"||O.duration===1/0||O.type==="loading")return;let Nt,Ln=Gp;return $||F||Xe&&qp?(()=>{if(zp.current<gu.current){let Mn=new Date().getTime()-gu.current;Ln=Ln-Mn}zp.current=new Date().getTime()})():Ln!==1/0&&(gu.current=new Date().getTime(),Nt=setTimeout(()=>{var Mn;(Mn=O.onAutoClose)==null||Mn.call(O,O),Zs()},Ln)),()=>clearTimeout(Nt)},[$,F,Ge,O,Gp,Zs,O.promise,wn,Xe,qp]),Ve.useEffect(()=>{let Nt=br.current;if(Nt){let Ln=Nt.getBoundingClientRect().height;return kr(Ln),V(Mn=>[{toastId:O.id,height:Ln,position:O.position},...Mn]),()=>V(Mn=>Mn.filter(Mo=>Mo.toastId!==O.id))}},[V,O.id]),Ve.useEffect(()=>{O.delete&&Zs()},[Zs,O.delete]);function I0(){return Le!=null&&Le.loading?Ve.createElement("div",{className:"sonner-loader","data-visible":wn==="loading"},Le.loading):je?Ve.createElement("div",{className:"sonner-loader","data-visible":wn==="loading"},je):Ve.createElement($he,{visible:wn==="loading"})}return Ve.createElement("li",{"aria-live":O.important?"assertive":"polite","aria-atomic":"true",role:"status",tabIndex:0,ref:br,className:st(ge,Hp,le==null?void 0:le.toast,(i=O==null?void 0:O.classNames)==null?void 0:i.toast,le==null?void 0:le.default,le==null?void 0:le[wn],(a=O==null?void 0:O.classNames)==null?void 0:a[wn]),"data-sonner-toast":"","data-rich-colors":(l=O.richColors)!=null?l:ie,"data-styled":!(O.jsx||O.unstyled||G),"data-mounted":ze,"data-promise":!!O.promise,"data-removed":dt,"data-visible":xr,"data-y-position":Kp,"data-x-position":Yg,"data-index":W,"data-front":Ua,"data-swiping":Fe,"data-dismissible":Js,"data-type":wn,"data-invert":ja,"data-swipe-out":et,"data-expanded":!!($||Ge&&ze),style:{"--index":W,"--toasts-before":W,"--z-index":z.length-W,"--offset":`${dt?bt:mi.current}px`,"--initial-height":Ge?"auto":`${an}px`,...pe,...O.style},onPointerDown:Nt=>{_u||!Js||(fi.current=new Date,It(mi.current),Nt.target.setPointerCapture(Nt.pointerId),Nt.target.tagName!=="BUTTON"&&(Ke(!0),Qs.current={x:Nt.clientX,y:Nt.clientY}))},onPointerUp:()=>{var Nt,Ln,Mn,Mo;if(et||!Js)return;Qs.current=null;let Uo=Number(((Nt=br.current)==null?void 0:Nt.style.getPropertyValue("--swipe-amount").replace("px",""))||0),Eu=new Date().getTime()-((Ln=fi.current)==null?void 0:Ln.getTime()),Wl=Math.abs(Uo)/Eu;if(Math.abs(Uo)>=ppe||Wl>.11){It(mi.current),(Mn=O.onDismiss)==null||Mn.call(O,O),Zs(),nt(!0);return}(Mo=br.current)==null||Mo.style.setProperty("--swipe-amount","0px"),Ke(!1)},onPointerMove:Nt=>{var Ln;if(!Qs.current||!Js)return;let Mn=Nt.clientY-Qs.current.y,Mo=Nt.clientX-Qs.current.x,Uo=(Kp==="top"?Math.min:Math.max)(0,Mn),Eu=Nt.pointerType==="touch"?10:2;Math.abs(Uo)>Eu?(Ln=br.current)==null||Ln.style.setProperty("--swipe-amount",`${Mn}px`):Math.abs(Mo)>Eu&&(Qs.current=null)}},Wr&&!O.jsx?Ve.createElement("button",{"aria-label":ot,"data-disabled":_u,"data-close-button":!0,onClick:_u||!Js?()=>{}:()=>{var Nt;Zs(),(Nt=O.onDismiss)==null||Nt.call(O,O)},className:st(le==null?void 0:le.closeButton,(u=O==null?void 0:O.classNames)==null?void 0:u.closeButton)},Ve.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"},Ve.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),Ve.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"}))):null,O.jsx||Ve.isValidElement(O.title)?O.jsx||O.title:Ve.createElement(Ve.Fragment,null,wn||O.icon||O.promise?Ve.createElement("div",{"data-icon":"",className:st(le==null?void 0:le.icon,(f=O==null?void 0:O.classNames)==null?void 0:f.icon)},O.promise||O.type==="loading"&&!O.icon?O.icon||I0():null,O.type!=="loading"?O.icon||(Le==null?void 0:Le[wn])||qhe(wn):null):null,Ve.createElement("div",{"data-content":"",className:st(le==null?void 0:le.content,(_=O==null?void 0:O.classNames)==null?void 0:_.content)},Ve.createElement("div",{"data-title":"",className:st(le==null?void 0:le.title,(v=O==null?void 0:O.classNames)==null?void 0:v.title)},O.title),O.description?Ve.createElement("div",{"data-description":"",className:st(fe,b0,le==null?void 0:le.description,(w=O==null?void 0:O.classNames)==null?void 0:w.description)},O.description):null),Ve.isValidElement(O.cancel)?O.cancel:O.cancel&&cy(O.cancel)?Ve.createElement("button",{"data-button":!0,"data-cancel":!0,style:O.cancelButtonStyle||Pe,onClick:Nt=>{var Ln,Mn;cy(O.cancel)&&Js&&((Mn=(Ln=O.cancel).onClick)==null||Mn.call(Ln,Nt),Zs())},className:st(le==null?void 0:le.cancelButton,(C=O==null?void 0:O.classNames)==null?void 0:C.cancelButton)},O.cancel.label):null,Ve.isValidElement(O.action)?O.action:O.action&&cy(O.action)?Ve.createElement("button",{"data-button":!0,"data-action":!0,style:O.actionButtonStyle||_e,onClick:Nt=>{var Ln,Mn;cy(O.action)&&(Nt.defaultPrevented||((Mn=(Ln=O.action).onClick)==null||Mn.call(Ln,Nt),Zs()))},className:st(le==null?void 0:le.actionButton,(N=O==null?void 0:O.classNames)==null?void 0:N.actionButton)},O.action.label):null))};function JB(){if(typeof window>"u"||typeof document>"u")return"ltr";let r=document.documentElement.getAttribute("dir");return r==="auto"||!r?window.getComputedStyle(document.documentElement).direction:r}var _pe=r=>{let{invert:i,position:a="bottom-right",hotkey:l=["altKey","KeyT"],expand:u,closeButton:f,className:_,offset:v,theme:w="light",richColors:C,duration:N,style:D,visibleToasts:O=cpe,toastOptions:G,dir:F=JB(),gap:V=hpe,loadingIcon:L,icons:B,containerAriaLabel:W="Notifications",pauseWhenPageIsHidden:z,cn:$=mpe}=r,[te,ie]=Ve.useState([]),ce=Ve.useMemo(()=>Array.from(new Set([a].concat(te.filter(Xe=>Xe.position).map(Xe=>Xe.position)))),[te,a]),[pe,Pe]=Ve.useState([]),[_e,ge]=Ve.useState(!1),[fe,xe]=Ve.useState(!1),[be,ft]=Ve.useState(w!=="system"?w:typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),je=Ve.useRef(null),Ge=l.join("+").replace(/Key/g,"").replace(/Digit/g,""),le=Ve.useRef(null),Le=Ve.useRef(!1),ot=Ve.useCallback(Xe=>{var st;(st=te.find(ze=>ze.id===Xe.id))!=null&&st.delete||Ro.dismiss(Xe.id),ie(ze=>ze.filter(({id:ht})=>ht!==Xe.id))},[te]);return Ve.useEffect(()=>Ro.subscribe(Xe=>{if(Xe.dismiss){ie(st=>st.map(ze=>ze.id===Xe.id?{...ze,delete:!0}:ze));return}setTimeout(()=>{NW.flushSync(()=>{ie(st=>{let ze=st.findIndex(ht=>ht.id===Xe.id);return ze!==-1?[...st.slice(0,ze),{...st[ze],...Xe},...st.slice(ze+1)]:[Xe,...st]})})})}),[]),Ve.useEffect(()=>{if(w!=="system"){ft(w);return}w==="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?ft("dark"):ft("light")),typeof window<"u"&&window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",({matches:Xe})=>{ft(Xe?"dark":"light")})},[w]),Ve.useEffect(()=>{te.length<=1&&ge(!1)},[te]),Ve.useEffect(()=>{let Xe=st=>{var ze,ht;l.every(dt=>st[dt]||st.code===dt)&&(ge(!0),(ze=je.current)==null||ze.focus()),st.code==="Escape"&&(document.activeElement===je.current||(ht=je.current)!=null&&ht.contains(document.activeElement))&&ge(!1)};return document.addEventListener("keydown",Xe),()=>document.removeEventListener("keydown",Xe)},[l]),Ve.useEffect(()=>{if(je.current)return()=>{le.current&&(le.current.focus({preventScroll:!0}),le.current=null,Le.current=!1)}},[je.current]),te.length?Ve.createElement("section",{"aria-label":`${W} ${Ge}`,tabIndex:-1},ce.map((Xe,st)=>{var ze;let[ht,dt]=Xe.split("-");return Ve.createElement("ol",{key:Xe,dir:F==="auto"?JB():F,tabIndex:-1,ref:je,className:_,"data-sonner-toaster":!0,"data-theme":be,"data-y-position":ht,"data-x-position":dt,style:{"--front-toast-height":`${((ze=pe[0])==null?void 0:ze.height)||0}px`,"--offset":typeof v=="number"?`${v}px`:v||lpe,"--width":`${upe}px`,"--gap":`${V}px`,...D},onBlur:at=>{Le.current&&!at.currentTarget.contains(at.relatedTarget)&&(Le.current=!1,le.current&&(le.current.focus({preventScroll:!0}),le.current=null))},onFocus:at=>{at.target instanceof HTMLElement&&at.target.dataset.dismissible==="false"||Le.current||(Le.current=!0,le.current=at.relatedTarget)},onMouseEnter:()=>ge(!0),onMouseMove:()=>ge(!0),onMouseLeave:()=>{fe||ge(!1)},onPointerDown:at=>{at.target instanceof HTMLElement&&at.target.dataset.dismissible==="false"||xe(!0)},onPointerUp:()=>xe(!1)},te.filter(at=>!at.position&&st===0||at.position===Xe).map((at,Fe)=>{var Ke,et;return Ve.createElement(gpe,{key:at.id,icons:B,index:Fe,toast:at,defaultRichColors:C,duration:(Ke=G==null?void 0:G.duration)!=null?Ke:N,className:G==null?void 0:G.className,descriptionClassName:G==null?void 0:G.descriptionClassName,invert:i,visibleToasts:O,closeButton:(et=G==null?void 0:G.closeButton)!=null?et:f,interacting:fe,position:Xe,style:G==null?void 0:G.style,unstyled:G==null?void 0:G.unstyled,classNames:G==null?void 0:G.classNames,cancelButtonStyle:G==null?void 0:G.cancelButtonStyle,actionButtonStyle:G==null?void 0:G.actionButtonStyle,removeToast:ot,toasts:te.filter(nt=>nt.position==at.position),heights:pe.filter(nt=>nt.position==at.position),setHeights:Pe,expandByDefault:u,gap:V,loadingIcon:L,expanded:_e,pauseWhenPageIsHidden:z,cn:$})}))})):null};const Epe=({...r})=>{const{theme:i="system"}=Yhe();return S.jsx(_pe,{theme:i,className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"}},...r})};var vpe=b6.useId||(()=>{}),ype=0;function Hd(r){const[i,a]=k.useState(vpe());return Xr(()=>{a(l=>l??String(ype++))},[r]),i?`radix-${i}`:""}const Spe=["top","right","bottom","left"],Ol=Math.min,Io=Math.max,uS=Math.round,ly=Math.floor,Pl=r=>({x:r,y:r}),Tpe={left:"right",right:"left",bottom:"top",top:"bottom"},wpe={start:"end",end:"start"};function wA(r,i,a){return Io(r,Ol(i,a))}function _c(r,i){return typeof r=="function"?r(i):r}function Ec(r){return r.split("-")[0]}function xp(r){return r.split("-")[1]}function $N(r){return r==="x"?"y":"x"}function JN(r){return r==="y"?"height":"width"}function Dl(r){return["top","bottom"].includes(Ec(r))?"y":"x"}function QN(r){return $N(Dl(r))}function Rpe(r,i,a){a===void 0&&(a=!1);const l=xp(r),u=QN(r),f=JN(u);let _=u==="x"?l===(a?"end":"start")?"right":"left":l==="start"?"bottom":"top";return i.reference[f]>i.floating[f]&&(_=hS(_)),[_,hS(_)]}function Cpe(r){const i=hS(r);return[RA(r),i,RA(i)]}function RA(r){return r.replace(/start|end/g,i=>wpe[i])}function bpe(r,i,a){const l=["left","right"],u=["right","left"],f=["top","bottom"],_=["bottom","top"];switch(r){case"top":case"bottom":return a?i?u:l:i?l:u;case"left":case"right":return i?f:_;default:return[]}}function Ipe(r,i,a,l){const u=xp(r);let f=bpe(Ec(r),a==="start",l);return u&&(f=f.map(_=>_+"-"+u),i&&(f=f.concat(f.map(RA)))),f}function hS(r){return r.replace(/left|right|bottom|top/g,i=>Tpe[i])}function Ape(r){return{top:0,right:0,bottom:0,left:0,...r}}function SH(r){return typeof r!="number"?Ape(r):{top:r,right:r,bottom:r,left:r}}function pS(r){const{x:i,y:a,width:l,height:u}=r;return{width:l,height:u,top:a,left:i,right:i+l,bottom:a+u,x:i,y:a}}function QB(r,i,a){let{reference:l,floating:u}=r;const f=Dl(i),_=QN(i),v=JN(_),w=Ec(i),C=f==="y",N=l.x+l.width/2-u.width/2,D=l.y+l.height/2-u.height/2,O=l[v]/2-u[v]/2;let G;switch(w){case"top":G={x:N,y:l.y-u.height};break;case"bottom":G={x:N,y:l.y+l.height};break;case"right":G={x:l.x+l.width,y:D};break;case"left":G={x:l.x-u.width,y:D};break;default:G={x:l.x,y:l.y}}switch(xp(i)){case"start":G[_]-=O*(a&&C?-1:1);break;case"end":G[_]+=O*(a&&C?-1:1);break}return G}const Npe=async(r,i,a)=>{const{placement:l="bottom",strategy:u="absolute",middleware:f=[],platform:_}=a,v=f.filter(Boolean),w=await(_.isRTL==null?void 0:_.isRTL(i));let C=await _.getElementRects({reference:r,floating:i,strategy:u}),{x:N,y:D}=QB(C,l,w),O=l,G={},F=0;for(let V=0;V<v.length;V++){const{name:L,fn:B}=v[V],{x:W,y:z,data:$,reset:te}=await B({x:N,y:D,initialPlacement:l,placement:O,strategy:u,middlewareData:G,rects:C,platform:_,elements:{reference:r,floating:i}});N=W??N,D=z??D,G={...G,[L]:{...G[L],...$}},te&&F<=50&&(F++,typeof te=="object"&&(te.placement&&(O=te.placement),te.rects&&(C=te.rects===!0?await _.getElementRects({reference:r,floating:i,strategy:u}):te.rects),{x:N,y:D}=QB(C,O,w)),V=-1)}return{x:N,y:D,placement:O,strategy:u,middlewareData:G}};async function yg(r,i){var a;i===void 0&&(i={});const{x:l,y:u,platform:f,rects:_,elements:v,strategy:w}=r,{boundary:C="clippingAncestors",rootBoundary:N="viewport",elementContext:D="floating",altBoundary:O=!1,padding:G=0}=_c(i,r),F=SH(G),L=v[O?D==="floating"?"reference":"floating":D],B=pS(await f.getClippingRect({element:(a=await(f.isElement==null?void 0:f.isElement(L)))==null||a?L:L.contextElement||await(f.getDocumentElement==null?void 0:f.getDocumentElement(v.floating)),boundary:C,rootBoundary:N,strategy:w})),W=D==="floating"?{x:l,y:u,width:_.floating.width,height:_.floating.height}:_.reference,z=await(f.getOffsetParent==null?void 0:f.getOffsetParent(v.floating)),$=await(f.isElement==null?void 0:f.isElement(z))?await(f.getScale==null?void 0:f.getScale(z))||{x:1,y:1}:{x:1,y:1},te=pS(f.convertOffsetParentRelativeRectToViewportRelativeRect?await f.convertOffsetParentRelativeRectToViewportRelativeRect({elements:v,rect:W,offsetParent:z,strategy:w}):W);return{top:(B.top-te.top+F.top)/$.y,bottom:(te.bottom-B.bottom+F.bottom)/$.y,left:(B.left-te.left+F.left)/$.x,right:(te.right-B.right+F.right)/$.x}}const Ope=r=>({name:"arrow",options:r,async fn(i){const{x:a,y:l,placement:u,rects:f,platform:_,elements:v,middlewareData:w}=i,{element:C,padding:N=0}=_c(r,i)||{};if(C==null)return{};const D=SH(N),O={x:a,y:l},G=QN(u),F=JN(G),V=await _.getDimensions(C),L=G==="y",B=L?"top":"left",W=L?"bottom":"right",z=L?"clientHeight":"clientWidth",$=f.reference[F]+f.reference[G]-O[G]-f.floating[F],te=O[G]-f.reference[G],ie=await(_.getOffsetParent==null?void 0:_.getOffsetParent(C));let ce=ie?ie[z]:0;(!ce||!await(_.isElement==null?void 0:_.isElement(ie)))&&(ce=v.floating[z]||f.floating[F]);const pe=$/2-te/2,Pe=ce/2-V[F]/2-1,_e=Ol(D[B],Pe),ge=Ol(D[W],Pe),fe=_e,xe=ce-V[F]-ge,be=ce/2-V[F]/2+pe,ft=wA(fe,be,xe),je=!w.arrow&&xp(u)!=null&&be!==ft&&f.reference[F]/2-(be<fe?_e:ge)-V[F]/2<0,Ge=je?be<fe?be-fe:be-xe:0;return{[G]:O[G]+Ge,data:{[G]:ft,centerOffset:be-ft-Ge,...je&&{alignmentOffset:Ge}},reset:je}}}),Ppe=function(r){return r===void 0&&(r={}),{name:"flip",options:r,async fn(i){var a,l;const{placement:u,middlewareData:f,rects:_,initialPlacement:v,platform:w,elements:C}=i,{mainAxis:N=!0,crossAxis:D=!0,fallbackPlacements:O,fallbackStrategy:G="bestFit",fallbackAxisSideDirection:F="none",flipAlignment:V=!0,...L}=_c(r,i);if((a=f.arrow)!=null&&a.alignmentOffset)return{};const B=Ec(u),W=Dl(v),z=Ec(v)===v,$=await(w.isRTL==null?void 0:w.isRTL(C.floating)),te=O||(z||!V?[hS(v)]:Cpe(v)),ie=F!=="none";!O&&ie&&te.push(...Ipe(v,V,F,$));const ce=[v,...te],pe=await yg(i,L),Pe=[];let _e=((l=f.flip)==null?void 0:l.overflows)||[];if(N&&Pe.push(pe[B]),D){const be=Rpe(u,_,$);Pe.push(pe[be[0]],pe[be[1]])}if(_e=[..._e,{placement:u,overflows:Pe}],!Pe.every(be=>be<=0)){var ge,fe;const be=(((ge=f.flip)==null?void 0:ge.index)||0)+1,ft=ce[be];if(ft)return{data:{index:be,overflows:_e},reset:{placement:ft}};let je=(fe=_e.filter(Ge=>Ge.overflows[0]<=0).sort((Ge,le)=>Ge.overflows[1]-le.overflows[1])[0])==null?void 0:fe.placement;if(!je)switch(G){case"bestFit":{var xe;const Ge=(xe=_e.filter(le=>{if(ie){const Le=Dl(le.placement);return Le===W||Le==="y"}return!0}).map(le=>[le.placement,le.overflows.filter(Le=>Le>0).reduce((Le,ot)=>Le+ot,0)]).sort((le,Le)=>le[1]-Le[1])[0])==null?void 0:xe[0];Ge&&(je=Ge);break}case"initialPlacement":je=v;break}if(u!==je)return{reset:{placement:je}}}return{}}}};function ZB(r,i){return{top:r.top-i.height,right:r.right-i.width,bottom:r.bottom-i.height,left:r.left-i.width}}function e5(r){return Spe.some(i=>r[i]>=0)}const Dpe=function(r){return r===void 0&&(r={}),{name:"hide",options:r,async fn(i){const{rects:a}=i,{strategy:l="referenceHidden",...u}=_c(r,i);switch(l){case"referenceHidden":{const f=await yg(i,{...u,elementContext:"reference"}),_=ZB(f,a.reference);return{data:{referenceHiddenOffsets:_,referenceHidden:e5(_)}}}case"escaped":{const f=await yg(i,{...u,altBoundary:!0}),_=ZB(f,a.floating);return{data:{escapedOffsets:_,escaped:e5(_)}}}default:return{}}}}};async function kpe(r,i){const{placement:a,platform:l,elements:u}=r,f=await(l.isRTL==null?void 0:l.isRTL(u.floating)),_=Ec(a),v=xp(a),w=Dl(a)==="y",C=["left","top"].includes(_)?-1:1,N=f&&w?-1:1,D=_c(i,r);let{mainAxis:O,crossAxis:G,alignmentAxis:F}=typeof D=="number"?{mainAxis:D,crossAxis:0,alignmentAxis:null}:{mainAxis:D.mainAxis||0,crossAxis:D.crossAxis||0,alignmentAxis:D.alignmentAxis};return v&&typeof F=="number"&&(G=v==="end"?F*-1:F),w?{x:G*N,y:O*C}:{x:O*C,y:G*N}}const xpe=function(r){return r===void 0&&(r=0),{name:"offset",options:r,async fn(i){var a,l;const{x:u,y:f,placement:_,middlewareData:v}=i,w=await kpe(i,r);return _===((a=v.offset)==null?void 0:a.placement)&&(l=v.arrow)!=null&&l.alignmentOffset?{}:{x:u+w.x,y:f+w.y,data:{...w,placement:_}}}}},Lpe=function(r){return r===void 0&&(r={}),{name:"shift",options:r,async fn(i){const{x:a,y:l,placement:u}=i,{mainAxis:f=!0,crossAxis:_=!1,limiter:v={fn:L=>{let{x:B,y:W}=L;return{x:B,y:W}}},...w}=_c(r,i),C={x:a,y:l},N=await yg(i,w),D=Dl(Ec(u)),O=$N(D);let G=C[O],F=C[D];if(f){const L=O==="y"?"top":"left",B=O==="y"?"bottom":"right",W=G+N[L],z=G-N[B];G=wA(W,G,z)}if(_){const L=D==="y"?"top":"left",B=D==="y"?"bottom":"right",W=F+N[L],z=F-N[B];F=wA(W,F,z)}const V=v.fn({...i,[O]:G,[D]:F});return{...V,data:{x:V.x-a,y:V.y-l,enabled:{[O]:f,[D]:_}}}}}},Mpe=function(r){return r===void 0&&(r={}),{options:r,fn(i){const{x:a,y:l,placement:u,rects:f,middlewareData:_}=i,{offset:v=0,mainAxis:w=!0,crossAxis:C=!0}=_c(r,i),N={x:a,y:l},D=Dl(u),O=$N(D);let G=N[O],F=N[D];const V=_c(v,i),L=typeof V=="number"?{mainAxis:V,crossAxis:0}:{mainAxis:0,crossAxis:0,...V};if(w){const z=O==="y"?"height":"width",$=f.reference[O]-f.floating[z]+L.mainAxis,te=f.reference[O]+f.reference[z]-L.mainAxis;G<$?G=$:G>te&&(G=te)}if(C){var B,W;const z=O==="y"?"width":"height",$=["top","left"].includes(Ec(u)),te=f.reference[D]-f.floating[z]+($&&((B=_.offset)==null?void 0:B[D])||0)+($?0:L.crossAxis),ie=f.reference[D]+f.reference[z]+($?0:((W=_.offset)==null?void 0:W[D])||0)-($?L.crossAxis:0);F<te?F=te:F>ie&&(F=ie)}return{[O]:G,[D]:F}}}},Upe=function(r){return r===void 0&&(r={}),{name:"size",options:r,async fn(i){var a,l;const{placement:u,rects:f,platform:_,elements:v}=i,{apply:w=()=>{},...C}=_c(r,i),N=await yg(i,C),D=Ec(u),O=xp(u),G=Dl(u)==="y",{width:F,height:V}=f.floating;let L,B;D==="top"||D==="bottom"?(L=D,B=O===(await(_.isRTL==null?void 0:_.isRTL(v.floating))?"start":"end")?"left":"right"):(B=D,L=O==="end"?"top":"bottom");const W=V-N.top-N.bottom,z=F-N.left-N.right,$=Ol(V-N[L],W),te=Ol(F-N[B],z),ie=!i.middlewareData.shift;let ce=$,pe=te;if((a=i.middlewareData.shift)!=null&&a.enabled.x&&(pe=z),(l=i.middlewareData.shift)!=null&&l.enabled.y&&(ce=W),ie&&!O){const _e=Io(N.left,0),ge=Io(N.right,0),fe=Io(N.top,0),xe=Io(N.bottom,0);G?pe=F-2*(_e!==0||ge!==0?_e+ge:Io(N.left,N.right)):ce=V-2*(fe!==0||xe!==0?fe+xe:Io(N.top,N.bottom))}await w({...i,availableWidth:pe,availableHeight:ce});const Pe=await _.getDimensions(v.floating);return F!==Pe.width||V!==Pe.height?{reset:{rects:!0}}:{}}}};function XS(){return typeof window<"u"}function Lp(r){return TH(r)?(r.nodeName||"").toLowerCase():"#document"}function Po(r){var i;return(r==null||(i=r.ownerDocument)==null?void 0:i.defaultView)||window}function xa(r){var i;return(i=(TH(r)?r.ownerDocument:r.document)||window.document)==null?void 0:i.documentElement}function TH(r){return XS()?r instanceof Node||r instanceof Po(r).Node:!1}function Ks(r){return XS()?r instanceof Element||r instanceof Po(r).Element:!1}function ka(r){return XS()?r instanceof HTMLElement||r instanceof Po(r).HTMLElement:!1}function t5(r){return!XS()||typeof ShadowRoot>"u"?!1:r instanceof ShadowRoot||r instanceof Po(r).ShadowRoot}function Fg(r){const{overflow:i,overflowX:a,overflowY:l,display:u}=Ys(r);return/auto|scroll|overlay|hidden|clip/.test(i+l+a)&&!["inline","contents"].includes(u)}function jpe(r){return["table","td","th"].includes(Lp(r))}function $S(r){return[":popover-open",":modal"].some(i=>{try{return r.matches(i)}catch{return!1}})}function ZN(r){const i=eO(),a=Ks(r)?Ys(r):r;return a.transform!=="none"||a.perspective!=="none"||(a.containerType?a.containerType!=="normal":!1)||!i&&(a.backdropFilter?a.backdropFilter!=="none":!1)||!i&&(a.filter?a.filter!=="none":!1)||["transform","perspective","filter"].some(l=>(a.willChange||"").includes(l))||["paint","layout","strict","content"].some(l=>(a.contain||"").includes(l))}function Vpe(r){let i=kl(r);for(;ka(i)&&!bp(i);){if(ZN(i))return i;if($S(i))return null;i=kl(i)}return null}function eO(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function bp(r){return["html","body","#document"].includes(Lp(r))}function Ys(r){return Po(r).getComputedStyle(r)}function JS(r){return Ks(r)?{scrollLeft:r.scrollLeft,scrollTop:r.scrollTop}:{scrollLeft:r.scrollX,scrollTop:r.scrollY}}function kl(r){if(Lp(r)==="html")return r;const i=r.assignedSlot||r.parentNode||t5(r)&&r.host||xa(r);return t5(i)?i.host:i}function wH(r){const i=kl(r);return bp(i)?r.ownerDocument?r.ownerDocument.body:r.body:ka(i)&&Fg(i)?i:wH(i)}function Sg(r,i,a){var l;i===void 0&&(i=[]),a===void 0&&(a=!0);const u=wH(r),f=u===((l=r.ownerDocument)==null?void 0:l.body),_=Po(u);if(f){const v=CA(_);return i.concat(_,_.visualViewport||[],Fg(u)?u:[],v&&a?Sg(v):[])}return i.concat(u,Sg(u,[],a))}function CA(r){return r.parent&&Object.getPrototypeOf(r.parent)?r.frameElement:null}function RH(r){const i=Ys(r);let a=parseFloat(i.width)||0,l=parseFloat(i.height)||0;const u=ka(r),f=u?r.offsetWidth:a,_=u?r.offsetHeight:l,v=uS(a)!==f||uS(l)!==_;return v&&(a=f,l=_),{width:a,height:l,$:v}}function tO(r){return Ks(r)?r:r.contextElement}function ap(r){const i=tO(r);if(!ka(i))return Pl(1);const a=i.getBoundingClientRect(),{width:l,height:u,$:f}=RH(i);let _=(f?uS(a.width):a.width)/l,v=(f?uS(a.height):a.height)/u;return(!_||!Number.isFinite(_))&&(_=1),(!v||!Number.isFinite(v))&&(v=1),{x:_,y:v}}const Fpe=Pl(0);function CH(r){const i=Po(r);return!eO()||!i.visualViewport?Fpe:{x:i.visualViewport.offsetLeft,y:i.visualViewport.offsetTop}}function Bpe(r,i,a){return i===void 0&&(i=!1),!a||i&&a!==Po(r)?!1:i}function tu(r,i,a,l){i===void 0&&(i=!1),a===void 0&&(a=!1);const u=r.getBoundingClientRect(),f=tO(r);let _=Pl(1);i&&(l?Ks(l)&&(_=ap(l)):_=ap(r));const v=Bpe(f,a,l)?CH(f):Pl(0);let w=(u.left+v.x)/_.x,C=(u.top+v.y)/_.y,N=u.width/_.x,D=u.height/_.y;if(f){const O=Po(f),G=l&&Ks(l)?Po(l):l;let F=O,V=CA(F);for(;V&&l&&G!==F;){const L=ap(V),B=V.getBoundingClientRect(),W=Ys(V),z=B.left+(V.clientLeft+parseFloat(W.paddingLeft))*L.x,$=B.top+(V.clientTop+parseFloat(W.paddingTop))*L.y;w*=L.x,C*=L.y,N*=L.x,D*=L.y,w+=z,C+=$,F=Po(V),V=CA(F)}}return pS({width:N,height:D,x:w,y:C})}function Wpe(r){let{elements:i,rect:a,offsetParent:l,strategy:u}=r;const f=u==="fixed",_=xa(l),v=i?$S(i.floating):!1;if(l===_||v&&f)return a;let w={scrollLeft:0,scrollTop:0},C=Pl(1);const N=Pl(0),D=ka(l);if((D||!D&&!f)&&((Lp(l)!=="body"||Fg(_))&&(w=JS(l)),ka(l))){const O=tu(l);C=ap(l),N.x=O.x+l.clientLeft,N.y=O.y+l.clientTop}return{width:a.width*C.x,height:a.height*C.y,x:a.x*C.x-w.scrollLeft*C.x+N.x,y:a.y*C.y-w.scrollTop*C.y+N.y}}function Hpe(r){return Array.from(r.getClientRects())}function bA(r,i){const a=JS(r).scrollLeft;return i?i.left+a:tu(xa(r)).left+a}function Gpe(r){const i=xa(r),a=JS(r),l=r.ownerDocument.body,u=Io(i.scrollWidth,i.clientWidth,l.scrollWidth,l.clientWidth),f=Io(i.scrollHeight,i.clientHeight,l.scrollHeight,l.clientHeight);let _=-a.scrollLeft+bA(r);const v=-a.scrollTop;return Ys(l).direction==="rtl"&&(_+=Io(i.clientWidth,l.clientWidth)-u),{width:u,height:f,x:_,y:v}}function zpe(r,i){const a=Po(r),l=xa(r),u=a.visualViewport;let f=l.clientWidth,_=l.clientHeight,v=0,w=0;if(u){f=u.width,_=u.height;const C=eO();(!C||C&&i==="fixed")&&(v=u.offsetLeft,w=u.offsetTop)}return{width:f,height:_,x:v,y:w}}function Kpe(r,i){const a=tu(r,!0,i==="fixed"),l=a.top+r.clientTop,u=a.left+r.clientLeft,f=ka(r)?ap(r):Pl(1),_=r.clientWidth*f.x,v=r.clientHeight*f.y,w=u*f.x,C=l*f.y;return{width:_,height:v,x:w,y:C}}function n5(r,i,a){let l;if(i==="viewport")l=zpe(r,a);else if(i==="document")l=Gpe(xa(r));else if(Ks(i))l=Kpe(i,a);else{const u=CH(r);l={...i,x:i.x-u.x,y:i.y-u.y}}return pS(l)}function bH(r,i){const a=kl(r);return a===i||!Ks(a)||bp(a)?!1:Ys(a).position==="fixed"||bH(a,i)}function Ype(r,i){const a=i.get(r);if(a)return a;let l=Sg(r,[],!1).filter(v=>Ks(v)&&Lp(v)!=="body"),u=null;const f=Ys(r).position==="fixed";let _=f?kl(r):r;for(;Ks(_)&&!bp(_);){const v=Ys(_),w=ZN(_);!w&&v.position==="fixed"&&(u=null),(f?!w&&!u:!w&&v.position==="static"&&!!u&&["absolute","fixed"].includes(u.position)||Fg(_)&&!w&&bH(r,_))?l=l.filter(N=>N!==_):u=v,_=kl(_)}return i.set(r,l),l}function qpe(r){let{element:i,boundary:a,rootBoundary:l,strategy:u}=r;const _=[...a==="clippingAncestors"?$S(i)?[]:Ype(i,this._c):[].concat(a),l],v=_[0],w=_.reduce((C,N)=>{const D=n5(i,N,u);return C.top=Io(D.top,C.top),C.right=Ol(D.right,C.right),C.bottom=Ol(D.bottom,C.bottom),C.left=Io(D.left,C.left),C},n5(i,v,u));return{width:w.right-w.left,height:w.bottom-w.top,x:w.left,y:w.top}}function Xpe(r){const{width:i,height:a}=RH(r);return{width:i,height:a}}function $pe(r,i,a){const l=ka(i),u=xa(i),f=a==="fixed",_=tu(r,!0,f,i);let v={scrollLeft:0,scrollTop:0};const w=Pl(0);if(l||!l&&!f)if((Lp(i)!=="body"||Fg(u))&&(v=JS(i)),l){const G=tu(i,!0,f,i);w.x=G.x+i.clientLeft,w.y=G.y+i.clientTop}else u&&(w.x=bA(u));let C=0,N=0;if(u&&!l&&!f){const G=u.getBoundingClientRect();N=G.top+v.scrollTop,C=G.left+v.scrollLeft-bA(u,G)}const D=_.left+v.scrollLeft-w.x-C,O=_.top+v.scrollTop-w.y-N;return{x:D,y:O,width:_.width,height:_.height}}function aI(r){return Ys(r).position==="static"}function r5(r,i){if(!ka(r)||Ys(r).position==="fixed")return null;if(i)return i(r);let a=r.offsetParent;return xa(r)===a&&(a=a.ownerDocument.body),a}function IH(r,i){const a=Po(r);if($S(r))return a;if(!ka(r)){let u=kl(r);for(;u&&!bp(u);){if(Ks(u)&&!aI(u))return u;u=kl(u)}return a}let l=r5(r,i);for(;l&&jpe(l)&&aI(l);)l=r5(l,i);return l&&bp(l)&&aI(l)&&!ZN(l)?a:l||Vpe(r)||a}const Jpe=async function(r){const i=this.getOffsetParent||IH,a=this.getDimensions,l=await a(r.floating);return{reference:$pe(r.reference,await i(r.floating),r.strategy),floating:{x:0,y:0,width:l.width,height:l.height}}};function Qpe(r){return Ys(r).direction==="rtl"}const Zpe={convertOffsetParentRelativeRectToViewportRelativeRect:Wpe,getDocumentElement:xa,getClippingRect:qpe,getOffsetParent:IH,getElementRects:Jpe,getClientRects:Hpe,getDimensions:Xpe,getScale:ap,isElement:Ks,isRTL:Qpe};function efe(r,i){let a=null,l;const u=xa(r);function f(){var v;clearTimeout(l),(v=a)==null||v.disconnect(),a=null}function _(v,w){v===void 0&&(v=!1),w===void 0&&(w=1),f();const{left:C,top:N,width:D,height:O}=r.getBoundingClientRect();if(v||i(),!D||!O)return;const G=ly(N),F=ly(u.clientWidth-(C+D)),V=ly(u.clientHeight-(N+O)),L=ly(C),W={rootMargin:-G+"px "+-F+"px "+-V+"px "+-L+"px",threshold:Io(0,Ol(1,w))||1};let z=!0;function $(te){const ie=te[0].intersectionRatio;if(ie!==w){if(!z)return _();ie?_(!1,ie):l=setTimeout(()=>{_(!1,1e-7)},1e3)}z=!1}try{a=new IntersectionObserver($,{...W,root:u.ownerDocument})}catch{a=new IntersectionObserver($,W)}a.observe(r)}return _(!0),f}function tfe(r,i,a,l){l===void 0&&(l={});const{ancestorScroll:u=!0,ancestorResize:f=!0,elementResize:_=typeof ResizeObserver=="function",layoutShift:v=typeof IntersectionObserver=="function",animationFrame:w=!1}=l,C=tO(r),N=u||f?[...C?Sg(C):[],...Sg(i)]:[];N.forEach(B=>{u&&B.addEventListener("scroll",a,{passive:!0}),f&&B.addEventListener("resize",a)});const D=C&&v?efe(C,a):null;let O=-1,G=null;_&&(G=new ResizeObserver(B=>{let[W]=B;W&&W.target===C&&G&&(G.unobserve(i),cancelAnimationFrame(O),O=requestAnimationFrame(()=>{var z;(z=G)==null||z.observe(i)})),a()}),C&&!w&&G.observe(C),G.observe(i));let F,V=w?tu(r):null;w&&L();function L(){const B=tu(r);V&&(B.x!==V.x||B.y!==V.y||B.width!==V.width||B.height!==V.height)&&a(),V=B,F=requestAnimationFrame(L)}return a(),()=>{var B;N.forEach(W=>{u&&W.removeEventListener("scroll",a),f&&W.removeEventListener("resize",a)}),D==null||D(),(B=G)==null||B.disconnect(),G=null,w&&cancelAnimationFrame(F)}}const nfe=xpe,rfe=Lpe,ife=Ppe,ofe=Upe,sfe=Dpe,i5=Ope,afe=Mpe,cfe=(r,i,a)=>{const l=new Map,u={platform:Zpe,...a},f={...u.platform,_c:l};return Npe(r,i,{...u,platform:f})};var Py=typeof document<"u"?k.useLayoutEffect:k.useEffect;function fS(r,i){if(r===i)return!0;if(typeof r!=typeof i)return!1;if(typeof r=="function"&&r.toString()===i.toString())return!0;let a,l,u;if(r&&i&&typeof r=="object"){if(Array.isArray(r)){if(a=r.length,a!==i.length)return!1;for(l=a;l--!==0;)if(!fS(r[l],i[l]))return!1;return!0}if(u=Object.keys(r),a=u.length,a!==Object.keys(i).length)return!1;for(l=a;l--!==0;)if(!{}.hasOwnProperty.call(i,u[l]))return!1;for(l=a;l--!==0;){const f=u[l];if(!(f==="_owner"&&r.$$typeof)&&!fS(r[f],i[f]))return!1}return!0}return r!==r&&i!==i}function AH(r){return typeof window>"u"?1:(r.ownerDocument.defaultView||window).devicePixelRatio||1}function o5(r,i){const a=AH(r);return Math.round(i*a)/a}function cI(r){const i=k.useRef(r);return Py(()=>{i.current=r}),i}function lfe(r){r===void 0&&(r={});const{placement:i="bottom",strategy:a="absolute",middleware:l=[],platform:u,elements:{reference:f,floating:_}={},transform:v=!0,whileElementsMounted:w,open:C}=r,[N,D]=k.useState({x:0,y:0,strategy:a,placement:i,middlewareData:{},isPositioned:!1}),[O,G]=k.useState(l);fS(O,l)||G(l);const[F,V]=k.useState(null),[L,B]=k.useState(null),W=k.useCallback(le=>{le!==ie.current&&(ie.current=le,V(le))},[]),z=k.useCallback(le=>{le!==ce.current&&(ce.current=le,B(le))},[]),$=f||F,te=_||L,ie=k.useRef(null),ce=k.useRef(null),pe=k.useRef(N),Pe=w!=null,_e=cI(w),ge=cI(u),fe=cI(C),xe=k.useCallback(()=>{if(!ie.current||!ce.current)return;const le={placement:i,strategy:a,middleware:O};ge.current&&(le.platform=ge.current),cfe(ie.current,ce.current,le).then(Le=>{const ot={...Le,isPositioned:fe.current!==!1};be.current&&!fS(pe.current,ot)&&(pe.current=ot,cu.flushSync(()=>{D(ot)}))})},[O,i,a,ge,fe]);Py(()=>{C===!1&&pe.current.isPositioned&&(pe.current.isPositioned=!1,D(le=>({...le,isPositioned:!1})))},[C]);const be=k.useRef(!1);Py(()=>(be.current=!0,()=>{be.current=!1}),[]),Py(()=>{if($&&(ie.current=$),te&&(ce.current=te),$&&te){if(_e.current)return _e.current($,te,xe);xe()}},[$,te,xe,_e,Pe]);const ft=k.useMemo(()=>({reference:ie,floating:ce,setReference:W,setFloating:z}),[W,z]),je=k.useMemo(()=>({reference:$,floating:te}),[$,te]),Ge=k.useMemo(()=>{const le={position:a,left:0,top:0};if(!je.floating)return le;const Le=o5(je.floating,N.x),ot=o5(je.floating,N.y);return v?{...le,transform:"translate("+Le+"px, "+ot+"px)",...AH(je.floating)>=1.5&&{willChange:"transform"}}:{position:a,left:Le,top:ot}},[a,v,je.floating,N.x,N.y]);return k.useMemo(()=>({...N,update:xe,refs:ft,elements:je,floatingStyles:Ge}),[N,xe,ft,je,Ge])}const dfe=r=>{function i(a){return{}.hasOwnProperty.call(a,"current")}return{name:"arrow",options:r,fn(a){const{element:l,padding:u}=typeof r=="function"?r(a):r;return l&&i(l)?l.current!=null?i5({element:l.current,padding:u}).fn(a):{}:l?i5({element:l,padding:u}).fn(a):{}}}},ufe=(r,i)=>({...nfe(r),options:[r,i]}),hfe=(r,i)=>({...rfe(r),options:[r,i]}),pfe=(r,i)=>({...afe(r),options:[r,i]}),ffe=(r,i)=>({...ife(r),options:[r,i]}),mfe=(r,i)=>({...ofe(r),options:[r,i]}),gfe=(r,i)=>({...sfe(r),options:[r,i]}),_fe=(r,i)=>({...dfe(r),options:[r,i]});var Efe="Arrow",NH=k.forwardRef((r,i)=>{const{children:a,width:l=10,height:u=5,...f}=r;return S.jsx(Bt.svg,{...f,ref:i,width:l,height:u,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:r.asChild?a:S.jsx("polygon",{points:"0,0 30,0 15,10"})})});NH.displayName=Efe;var vfe=NH;function yfe(r,i=[]){let a=[];function l(f,_){const v=k.createContext(_),w=a.length;a=[...a,_];function C(D){const{scope:O,children:G,...F}=D,V=(O==null?void 0:O[r][w])||v,L=k.useMemo(()=>F,Object.values(F));return S.jsx(V.Provider,{value:L,children:G})}function N(D,O){const G=(O==null?void 0:O[r][w])||v,F=k.useContext(G);if(F)return F;if(_!==void 0)return _;throw new Error(`\`${D}\` must be used within \`${f}\``)}return C.displayName=f+"Provider",[C,N]}const u=()=>{const f=a.map(_=>k.createContext(_));return function(v){const w=(v==null?void 0:v[r])||f;return k.useMemo(()=>({[`__scope${r}`]:{...v,[r]:w}}),[v,w])}};return u.scopeName=r,[l,Sfe(u,...i)]}function Sfe(...r){const i=r[0];if(r.length===1)return i;const a=()=>{const l=r.map(u=>({useScope:u(),scopeName:u.scopeName}));return function(f){const _=l.reduce((v,{useScope:w,scopeName:C})=>{const D=w(f)[`__scope${C}`];return{...v,...D}},{});return k.useMemo(()=>({[`__scope${i.scopeName}`]:_}),[_])}};return a.scopeName=i.scopeName,a}function OH(r){const[i,a]=k.useState(void 0);return Xr(()=>{if(r){a({width:r.offsetWidth,height:r.offsetHeight});const l=new ResizeObserver(u=>{if(!Array.isArray(u)||!u.length)return;const f=u[0];let _,v;if("borderBoxSize"in f){const w=f.borderBoxSize,C=Array.isArray(w)?w[0]:w;_=C.inlineSize,v=C.blockSize}else _=r.offsetWidth,v=r.offsetHeight;a({width:_,height:v})});return l.observe(r,{box:"border-box"}),()=>l.unobserve(r)}else a(void 0)},[r]),i}var nO="Popper",[PH,QS]=yfe(nO),[Tfe,DH]=PH(nO),kH=r=>{const{__scopePopper:i,children:a}=r,[l,u]=k.useState(null);return S.jsx(Tfe,{scope:i,anchor:l,onAnchorChange:u,children:a})};kH.displayName=nO;var xH="PopperAnchor",LH=k.forwardRef((r,i)=>{const{__scopePopper:a,virtualRef:l,...u}=r,f=DH(xH,a),_=k.useRef(null),v=Tn(i,_);return k.useEffect(()=>{f.onAnchorChange((l==null?void 0:l.current)||_.current)}),l?null:S.jsx(Bt.div,{...u,ref:v})});LH.displayName=xH;var rO="PopperContent",[wfe,Rfe]=PH(rO),MH=k.forwardRef((r,i)=>{var Fe,Ke,et,nt,bt,It;const{__scopePopper:a,side:l="bottom",sideOffset:u=0,align:f="center",alignOffset:_=0,arrowPadding:v=0,avoidCollisions:w=!0,collisionBoundary:C=[],collisionPadding:N=0,sticky:D="partial",hideWhenDetached:O=!1,updatePositionStrategy:G="optimized",onPlaced:F,...V}=r,L=DH(rO,a),[B,W]=k.useState(null),z=Tn(i,an=>W(an)),[$,te]=k.useState(null),ie=OH($),ce=(ie==null?void 0:ie.width)??0,pe=(ie==null?void 0:ie.height)??0,Pe=l+(f!=="center"?"-"+f:""),_e=typeof N=="number"?N:{top:0,right:0,bottom:0,left:0,...N},ge=Array.isArray(C)?C:[C],fe=ge.length>0,xe={padding:_e,boundary:ge.filter(bfe),altBoundary:fe},{refs:be,floatingStyles:ft,placement:je,isPositioned:Ge,middlewareData:le}=lfe({strategy:"fixed",placement:Pe,whileElementsMounted:(...an)=>tfe(...an,{animationFrame:G==="always"}),elements:{reference:L.anchor},middleware:[ufe({mainAxis:u+pe,alignmentAxis:_}),w&&hfe({mainAxis:!0,crossAxis:!1,limiter:D==="partial"?pfe():void 0,...xe}),w&&ffe({...xe}),mfe({...xe,apply:({elements:an,rects:kr,availableWidth:fi,availableHeight:br})=>{const{width:Ua,height:xr}=kr.reference,wn=an.floating.style;wn.setProperty("--radix-popper-available-width",`${fi}px`),wn.setProperty("--radix-popper-available-height",`${br}px`),wn.setProperty("--radix-popper-anchor-width",`${Ua}px`),wn.setProperty("--radix-popper-anchor-height",`${xr}px`)}}),$&&_fe({element:$,padding:v}),Ife({arrowWidth:ce,arrowHeight:pe}),O&&gfe({strategy:"referenceHidden",...xe})]}),[Le,ot]=VH(je),Xe=Dr(F);Xr(()=>{Ge&&(Xe==null||Xe())},[Ge,Xe]);const st=(Fe=le.arrow)==null?void 0:Fe.x,ze=(Ke=le.arrow)==null?void 0:Ke.y,ht=((et=le.arrow)==null?void 0:et.centerOffset)!==0,[dt,at]=k.useState();return Xr(()=>{B&&at(window.getComputedStyle(B).zIndex)},[B]),S.jsx("div",{ref:be.setFloating,"data-radix-popper-content-wrapper":"",style:{...ft,transform:Ge?ft.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:dt,"--radix-popper-transform-origin":[(nt=le.transformOrigin)==null?void 0:nt.x,(bt=le.transformOrigin)==null?void 0:bt.y].join(" "),...((It=le.hide)==null?void 0:It.referenceHidden)&&{visibility:"hidden",pointerEvents:"none"}},dir:r.dir,children:S.jsx(wfe,{scope:a,placedSide:Le,onArrowChange:te,arrowX:st,arrowY:ze,shouldHideArrow:ht,children:S.jsx(Bt.div,{"data-side":Le,"data-align":ot,...V,ref:z,style:{...V.style,animation:Ge?void 0:"none"}})})})});MH.displayName=rO;var UH="PopperArrow",Cfe={top:"bottom",right:"left",bottom:"top",left:"right"},jH=k.forwardRef(function(i,a){const{__scopePopper:l,...u}=i,f=Rfe(UH,l),_=Cfe[f.placedSide];return S.jsx("span",{ref:f.onArrowChange,style:{position:"absolute",left:f.arrowX,top:f.arrowY,[_]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[f.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[f.placedSide],visibility:f.shouldHideArrow?"hidden":void 0},children:S.jsx(vfe,{...u,ref:a,style:{...u.style,display:"block"}})})});jH.displayName=UH;function bfe(r){return r!==null}var Ife=r=>({name:"transformOrigin",options:r,fn(i){var L,B,W;const{placement:a,rects:l,middlewareData:u}=i,_=((L=u.arrow)==null?void 0:L.centerOffset)!==0,v=_?0:r.arrowWidth,w=_?0:r.arrowHeight,[C,N]=VH(a),D={start:"0%",center:"50%",end:"100%"}[N],O=(((B=u.arrow)==null?void 0:B.x)??0)+v/2,G=(((W=u.arrow)==null?void 0:W.y)??0)+w/2;let F="",V="";return C==="bottom"?(F=_?D:`${O}px`,V=`${-w}px`):C==="top"?(F=_?D:`${O}px`,V=`${l.floating.height+w}px`):C==="right"?(F=`${-w}px`,V=_?D:`${G}px`):C==="left"&&(F=`${l.floating.width+w}px`,V=_?D:`${G}px`),{data:{x:F,y:V}}}});function VH(r){const[i,a="center"]=r.split("-");return[i,a]}var FH=kH,BH=LH,WH=MH,HH=jH,[ZS,G0e]=lu("Tooltip",[QS]),e0=QS(),GH="TooltipProvider",Afe=700,IA="tooltip.open",[Nfe,iO]=ZS(GH),zH=r=>{const{__scopeTooltip:i,delayDuration:a=Afe,skipDelayDuration:l=300,disableHoverableContent:u=!1,children:f}=r,[_,v]=k.useState(!0),w=k.useRef(!1),C=k.useRef(0);return k.useEffect(()=>{const N=C.current;return()=>window.clearTimeout(N)},[]),S.jsx(Nfe,{scope:i,isOpenDelayed:_,delayDuration:a,onOpen:k.useCallback(()=>{window.clearTimeout(C.current),v(!1)},[]),onClose:k.useCallback(()=>{window.clearTimeout(C.current),C.current=window.setTimeout(()=>v(!0),l)},[l]),isPointerInTransitRef:w,onPointerInTransitChange:k.useCallback(N=>{w.current=N},[]),disableHoverableContent:u,children:f})};zH.displayName=GH;var t0="Tooltip",[Ofe,n0]=ZS(t0),KH=r=>{const{__scopeTooltip:i,children:a,open:l,defaultOpen:u=!1,onOpenChange:f,disableHoverableContent:_,delayDuration:v}=r,w=iO(t0,r.__scopeTooltip),C=e0(i),[N,D]=k.useState(null),O=Hd(),G=k.useRef(0),F=_??w.disableHoverableContent,V=v??w.delayDuration,L=k.useRef(!1),[B=!1,W]=Cp({prop:l,defaultProp:u,onChange:ce=>{ce?(w.onOpen(),document.dispatchEvent(new CustomEvent(IA))):w.onClose(),f==null||f(ce)}}),z=k.useMemo(()=>B?L.current?"delayed-open":"instant-open":"closed",[B]),$=k.useCallback(()=>{window.clearTimeout(G.current),G.current=0,L.current=!1,W(!0)},[W]),te=k.useCallback(()=>{window.clearTimeout(G.current),G.current=0,W(!1)},[W]),ie=k.useCallback(()=>{window.clearTimeout(G.current),G.current=window.setTimeout(()=>{L.current=!0,W(!0),G.current=0},V)},[V,W]);return k.useEffect(()=>()=>{G.current&&(window.clearTimeout(G.current),G.current=0)},[]),S.jsx(FH,{...C,children:S.jsx(Ofe,{scope:i,contentId:O,open:B,stateAttribute:z,trigger:N,onTriggerChange:D,onTriggerEnter:k.useCallback(()=>{w.isOpenDelayed?ie():$()},[w.isOpenDelayed,ie,$]),onTriggerLeave:k.useCallback(()=>{F?te():(window.clearTimeout(G.current),G.current=0)},[te,F]),onOpen:$,onClose:te,disableHoverableContent:F,children:a})})};KH.displayName=t0;var AA="TooltipTrigger",YH=k.forwardRef((r,i)=>{const{__scopeTooltip:a,...l}=r,u=n0(AA,a),f=iO(AA,a),_=e0(a),v=k.useRef(null),w=Tn(i,v,u.onTriggerChange),C=k.useRef(!1),N=k.useRef(!1),D=k.useCallback(()=>C.current=!1,[]);return k.useEffect(()=>()=>document.removeEventListener("pointerup",D),[D]),S.jsx(BH,{asChild:!0,..._,children:S.jsx(Bt.button,{"aria-describedby":u.open?u.contentId:void 0,"data-state":u.stateAttribute,...l,ref:w,onPointerMove:At(r.onPointerMove,O=>{O.pointerType!=="touch"&&!N.current&&!f.isPointerInTransitRef.current&&(u.onTriggerEnter(),N.current=!0)}),onPointerLeave:At(r.onPointerLeave,()=>{u.onTriggerLeave(),N.current=!1}),onPointerDown:At(r.onPointerDown,()=>{C.current=!0,document.addEventListener("pointerup",D,{once:!0})}),onFocus:At(r.onFocus,()=>{C.current||u.onOpen()}),onBlur:At(r.onBlur,u.onClose),onClick:At(r.onClick,u.onClose)})})});YH.displayName=AA;var Pfe="TooltipPortal",[z0e,Dfe]=ZS(Pfe,{forceMount:void 0}),Ip="TooltipContent",qH=k.forwardRef((r,i)=>{const a=Dfe(Ip,r.__scopeTooltip),{forceMount:l=a.forceMount,side:u="top",...f}=r,_=n0(Ip,r.__scopeTooltip);return S.jsx(qs,{present:l||_.open,children:_.disableHoverableContent?S.jsx(XH,{side:u,...f,ref:i}):S.jsx(kfe,{side:u,...f,ref:i})})}),kfe=k.forwardRef((r,i)=>{const a=n0(Ip,r.__scopeTooltip),l=iO(Ip,r.__scopeTooltip),u=k.useRef(null),f=Tn(i,u),[_,v]=k.useState(null),{trigger:w,onClose:C}=a,N=u.current,{onPointerInTransitChange:D}=l,O=k.useCallback(()=>{v(null),D(!1)},[D]),G=k.useCallback((F,V)=>{const L=F.currentTarget,B={x:F.clientX,y:F.clientY},W=Ufe(B,L.getBoundingClientRect()),z=jfe(B,W),$=Vfe(V.getBoundingClientRect()),te=Bfe([...z,...$]);v(te),D(!0)},[D]);return k.useEffect(()=>()=>O(),[O]),k.useEffect(()=>{if(w&&N){const F=L=>G(L,N),V=L=>G(L,w);return w.addEventListener("pointerleave",F),N.addEventListener("pointerleave",V),()=>{w.removeEventListener("pointerleave",F),N.removeEventListener("pointerleave",V)}}},[w,N,G,O]),k.useEffect(()=>{if(_){const F=V=>{const L=V.target,B={x:V.clientX,y:V.clientY},W=(w==null?void 0:w.contains(L))||(N==null?void 0:N.contains(L)),z=!Ffe(B,_);W?O():z&&(O(),C())};return document.addEventListener("pointermove",F),()=>document.removeEventListener("pointermove",F)}},[w,N,_,C,O]),S.jsx(XH,{...r,ref:f})}),[xfe,Lfe]=ZS(t0,{isInside:!1}),XH=k.forwardRef((r,i)=>{const{__scopeTooltip:a,children:l,"aria-label":u,onEscapeKeyDown:f,onPointerDownOutside:_,...v}=r,w=n0(Ip,a),C=e0(a),{onClose:N}=w;return k.useEffect(()=>(document.addEventListener(IA,N),()=>document.removeEventListener(IA,N)),[N]),k.useEffect(()=>{if(w.trigger){const D=O=>{const G=O.target;G!=null&&G.contains(w.trigger)&&N()};return window.addEventListener("scroll",D,{capture:!0}),()=>window.removeEventListener("scroll",D,{capture:!0})}},[w.trigger,N]),S.jsx(jg,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:f,onPointerDownOutside:_,onFocusOutside:D=>D.preventDefault(),onDismiss:N,children:S.jsxs(WH,{"data-state":w.stateAttribute,...C,...v,ref:i,style:{...v.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[S.jsx(DW,{children:l}),S.jsx(xfe,{scope:a,isInside:!0,children:S.jsx(Nue,{id:w.contentId,role:"tooltip",children:u||l})})]})})});qH.displayName=Ip;var $H="TooltipArrow",Mfe=k.forwardRef((r,i)=>{const{__scopeTooltip:a,...l}=r,u=e0(a);return Lfe($H,a).isInside?null:S.jsx(HH,{...u,...l,ref:i})});Mfe.displayName=$H;function Ufe(r,i){const a=Math.abs(i.top-r.y),l=Math.abs(i.bottom-r.y),u=Math.abs(i.right-r.x),f=Math.abs(i.left-r.x);switch(Math.min(a,l,u,f)){case f:return"left";case u:return"right";case a:return"top";case l:return"bottom";default:throw new Error("unreachable")}}function jfe(r,i,a=5){const l=[];switch(i){case"top":l.push({x:r.x-a,y:r.y+a},{x:r.x+a,y:r.y+a});break;case"bottom":l.push({x:r.x-a,y:r.y-a},{x:r.x+a,y:r.y-a});break;case"left":l.push({x:r.x+a,y:r.y-a},{x:r.x+a,y:r.y+a});break;case"right":l.push({x:r.x-a,y:r.y-a},{x:r.x-a,y:r.y+a});break}return l}function Vfe(r){const{top:i,right:a,bottom:l,left:u}=r;return[{x:u,y:i},{x:a,y:i},{x:a,y:l},{x:u,y:l}]}function Ffe(r,i){const{x:a,y:l}=r;let u=!1;for(let f=0,_=i.length-1;f<i.length;_=f++){const v=i[f].x,w=i[f].y,C=i[_].x,N=i[_].y;w>l!=N>l&&a<(C-v)*(l-w)/(N-w)+v&&(u=!u)}return u}function Bfe(r){const i=r.slice();return i.sort((a,l)=>a.x<l.x?-1:a.x>l.x?1:a.y<l.y?-1:a.y>l.y?1:0),Wfe(i)}function Wfe(r){if(r.length<=1)return r.slice();const i=[];for(let l=0;l<r.length;l++){const u=r[l];for(;i.length>=2;){const f=i[i.length-1],_=i[i.length-2];if((f.x-_.x)*(u.y-_.y)>=(f.y-_.y)*(u.x-_.x))i.pop();else break}i.push(u)}i.pop();const a=[];for(let l=r.length-1;l>=0;l--){const u=r[l];for(;a.length>=2;){const f=a[a.length-1],_=a[a.length-2];if((f.x-_.x)*(u.y-_.y)>=(f.y-_.y)*(u.x-_.x))a.pop();else break}a.push(u)}return a.pop(),i.length===1&&a.length===1&&i[0].x===a[0].x&&i[0].y===a[0].y?i:i.concat(a)}var Hfe=zH,Gfe=KH,zfe=YH,JH=qH;const oc=Hfe,el=Gfe,tl=zfe,sc=k.forwardRef(({className:r,sideOffset:i=4,...a},l)=>S.jsx(JH,{ref:l,sideOffset:i,className:Lt("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",r),...a}));sc.displayName=JH.displayName;var r0=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(r){return this.listeners.add(r),this.onSubscribe(),()=>{this.listeners.delete(r),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},i0=typeof window>"u"||"Deno"in globalThis;function Us(){}function Kfe(r,i){return typeof r=="function"?r(i):r}function Yfe(r){return typeof r=="number"&&r>=0&&r!==1/0}function qfe(r,i){return Math.max(r+(i||0)-Date.now(),0)}function s5(r,i){return typeof r=="function"?r(i):r}function Xfe(r,i){return typeof r=="function"?r(i):r}function a5(r,i){const{type:a="all",exact:l,fetchStatus:u,predicate:f,queryKey:_,stale:v}=r;if(_){if(l){if(i.queryHash!==oO(_,i.options))return!1}else if(!wg(i.queryKey,_))return!1}if(a!=="all"){const w=i.isActive();if(a==="active"&&!w||a==="inactive"&&w)return!1}return!(typeof v=="boolean"&&i.isStale()!==v||u&&u!==i.state.fetchStatus||f&&!f(i))}function c5(r,i){const{exact:a,status:l,predicate:u,mutationKey:f}=r;if(f){if(!i.options.mutationKey)return!1;if(a){if(Tg(i.options.mutationKey)!==Tg(f))return!1}else if(!wg(i.options.mutationKey,f))return!1}return!(l&&i.state.status!==l||u&&!u(i))}function oO(r,i){return((i==null?void 0:i.queryKeyHashFn)||Tg)(r)}function Tg(r){return JSON.stringify(r,(i,a)=>NA(a)?Object.keys(a).sort().reduce((l,u)=>(l[u]=a[u],l),{}):a)}function wg(r,i){return r===i?!0:typeof r!=typeof i?!1:r&&i&&typeof r=="object"&&typeof i=="object"?!Object.keys(i).some(a=>!wg(r[a],i[a])):!1}function QH(r,i){if(r===i)return r;const a=l5(r)&&l5(i);if(a||NA(r)&&NA(i)){const l=a?r:Object.keys(r),u=l.length,f=a?i:Object.keys(i),_=f.length,v=a?[]:{};let w=0;for(let C=0;C<_;C++){const N=a?C:f[C];(!a&&l.includes(N)||a)&&r[N]===void 0&&i[N]===void 0?(v[N]=void 0,w++):(v[N]=QH(r[N],i[N]),v[N]===r[N]&&r[N]!==void 0&&w++)}return u===_&&w===u?r:v}return i}function l5(r){return Array.isArray(r)&&r.length===Object.keys(r).length}function NA(r){if(!d5(r))return!1;const i=r.constructor;if(i===void 0)return!0;const a=i.prototype;return!(!d5(a)||!a.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(r)!==Object.prototype)}function d5(r){return Object.prototype.toString.call(r)==="[object Object]"}function $fe(r){return new Promise(i=>{setTimeout(i,r)})}function Jfe(r,i,a){return typeof a.structuralSharing=="function"?a.structuralSharing(r,i):a.structuralSharing!==!1?QH(r,i):i}function Qfe(r,i,a=0){const l=[...r,i];return a&&l.length>a?l.slice(1):l}function Zfe(r,i,a=0){const l=[i,...r];return a&&l.length>a?l.slice(0,-1):l}var sO=Symbol();function ZH(r,i){return!r.queryFn&&(i!=null&&i.initialPromise)?()=>i.initialPromise:!r.queryFn||r.queryFn===sO?()=>Promise.reject(new Error(`Missing queryFn: '${r.queryHash}'`)):r.queryFn}var Ud,ll,lp,c6,eme=(c6=class extends r0{constructor(){super();An(this,Ud);An(this,ll);An(this,lp);Zt(this,lp,i=>{if(!i0&&window.addEventListener){const a=()=>i();return window.addEventListener("visibilitychange",a,!1),()=>{window.removeEventListener("visibilitychange",a)}}})}onSubscribe(){De(this,ll)||this.setEventListener(De(this,lp))}onUnsubscribe(){var i;this.hasListeners()||((i=De(this,ll))==null||i.call(this),Zt(this,ll,void 0))}setEventListener(i){var a;Zt(this,lp,i),(a=De(this,ll))==null||a.call(this),Zt(this,ll,i(l=>{typeof l=="boolean"?this.setFocused(l):this.onFocus()}))}setFocused(i){De(this,Ud)!==i&&(Zt(this,Ud,i),this.onFocus())}onFocus(){const i=this.isFocused();this.listeners.forEach(a=>{a(i)})}isFocused(){var i;return typeof De(this,Ud)=="boolean"?De(this,Ud):((i=globalThis.document)==null?void 0:i.visibilityState)!=="hidden"}},Ud=new WeakMap,ll=new WeakMap,lp=new WeakMap,c6),eG=new eme,dp,dl,up,l6,tme=(l6=class extends r0{constructor(){super();An(this,dp,!0);An(this,dl);An(this,up);Zt(this,up,i=>{if(!i0&&window.addEventListener){const a=()=>i(!0),l=()=>i(!1);return window.addEventListener("online",a,!1),window.addEventListener("offline",l,!1),()=>{window.removeEventListener("online",a),window.removeEventListener("offline",l)}}})}onSubscribe(){De(this,dl)||this.setEventListener(De(this,up))}onUnsubscribe(){var i;this.hasListeners()||((i=De(this,dl))==null||i.call(this),Zt(this,dl,void 0))}setEventListener(i){var a;Zt(this,up,i),(a=De(this,dl))==null||a.call(this),Zt(this,dl,i(this.setOnline.bind(this)))}setOnline(i){De(this,dp)!==i&&(Zt(this,dp,i),this.listeners.forEach(l=>{l(i)}))}isOnline(){return De(this,dp)}},dp=new WeakMap,dl=new WeakMap,up=new WeakMap,l6),mS=new tme;function nme(){let r,i;const a=new Promise((u,f)=>{r=u,i=f});a.status="pending",a.catch(()=>{});function l(u){Object.assign(a,u),delete a.resolve,delete a.reject}return a.resolve=u=>{l({status:"fulfilled",value:u}),r(u)},a.reject=u=>{l({status:"rejected",reason:u}),i(u)},a}function rme(r){return Math.min(1e3*2**r,3e4)}function tG(r){return(r??"online")==="online"?mS.isOnline():!0}var nG=class extends Error{constructor(r){super("CancelledError"),this.revert=r==null?void 0:r.revert,this.silent=r==null?void 0:r.silent}};function lI(r){return r instanceof nG}function rG(r){let i=!1,a=0,l=!1,u;const f=nme(),_=V=>{var L;l||(O(new nG(V)),(L=r.abort)==null||L.call(r))},v=()=>{i=!0},w=()=>{i=!1},C=()=>eG.isFocused()&&(r.networkMode==="always"||mS.isOnline())&&r.canRun(),N=()=>tG(r.networkMode)&&r.canRun(),D=V=>{var L;l||(l=!0,(L=r.onSuccess)==null||L.call(r,V),u==null||u(),f.resolve(V))},O=V=>{var L;l||(l=!0,(L=r.onError)==null||L.call(r,V),u==null||u(),f.reject(V))},G=()=>new Promise(V=>{var L;u=B=>{(l||C())&&V(B)},(L=r.onPause)==null||L.call(r)}).then(()=>{var V;u=void 0,l||(V=r.onContinue)==null||V.call(r)}),F=()=>{if(l)return;let V;const L=a===0?r.initialPromise:void 0;try{V=L??r.fn()}catch(B){V=Promise.reject(B)}Promise.resolve(V).then(D).catch(B=>{var ie;if(l)return;const W=r.retry??(i0?0:3),z=r.retryDelay??rme,$=typeof z=="function"?z(a,B):z,te=W===!0||typeof W=="number"&&a<W||typeof W=="function"&&W(a,B);if(i||!te){O(B);return}a++,(ie=r.onFail)==null||ie.call(r,a,B),$fe($).then(()=>C()?void 0:G()).then(()=>{i?O(B):F()})})};return{promise:f,cancel:_,continue:()=>(u==null||u(),f),cancelRetry:v,continueRetry:w,canStart:N,start:()=>(N()?F():G().then(F),f)}}function ime(){let r=[],i=0,a=v=>{v()},l=v=>{v()},u=v=>setTimeout(v,0);const f=v=>{i?r.push(v):u(()=>{a(v)})},_=()=>{const v=r;r=[],v.length&&u(()=>{l(()=>{v.forEach(w=>{a(w)})})})};return{batch:v=>{let w;i++;try{w=v()}finally{i--,i||_()}return w},batchCalls:v=>(...w)=>{f(()=>{v(...w)})},schedule:f,setNotifyFunction:v=>{a=v},setBatchNotifyFunction:v=>{l=v},setScheduler:v=>{u=v}}}var Vi=ime(),jd,d6,iG=(d6=class{constructor(){An(this,jd)}destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),Yfe(this.gcTime)&&Zt(this,jd,setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(r){this.gcTime=Math.max(this.gcTime||0,r??(i0?1/0:5*60*1e3))}clearGcTimeout(){De(this,jd)&&(clearTimeout(De(this,jd)),Zt(this,jd,void 0))}},jd=new WeakMap,d6),hp,pp,cs,Ci,Pg,Vd,js,ac,u6,ome=(u6=class extends iG{constructor(i){super();An(this,js);An(this,hp);An(this,pp);An(this,cs);An(this,Ci);An(this,Pg);An(this,Vd);Zt(this,Vd,!1),Zt(this,Pg,i.defaultOptions),this.setOptions(i.options),this.observers=[],Zt(this,cs,i.cache),this.queryKey=i.queryKey,this.queryHash=i.queryHash,Zt(this,hp,ame(this.options)),this.state=i.state??De(this,hp),this.scheduleGc()}get meta(){return this.options.meta}get promise(){var i;return(i=De(this,Ci))==null?void 0:i.promise}setOptions(i){this.options={...De(this,Pg),...i},this.updateGcTime(this.options.gcTime)}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&De(this,cs).remove(this)}setData(i,a){const l=Jfe(this.state.data,i,this.options);return Ti(this,js,ac).call(this,{data:l,type:"success",dataUpdatedAt:a==null?void 0:a.updatedAt,manual:a==null?void 0:a.manual}),l}setState(i,a){Ti(this,js,ac).call(this,{type:"setState",state:i,setStateOptions:a})}cancel(i){var l,u;const a=(l=De(this,Ci))==null?void 0:l.promise;return(u=De(this,Ci))==null||u.cancel(i),a?a.then(Us).catch(Us):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(De(this,hp))}isActive(){return this.observers.some(i=>Xfe(i.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===sO||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStale(){return this.state.isInvalidated?!0:this.getObserversCount()>0?this.observers.some(i=>i.getCurrentResult().isStale):this.state.data===void 0}isStaleByTime(i=0){return this.state.isInvalidated||this.state.data===void 0||!qfe(this.state.dataUpdatedAt,i)}onFocus(){var a;const i=this.observers.find(l=>l.shouldFetchOnWindowFocus());i==null||i.refetch({cancelRefetch:!1}),(a=De(this,Ci))==null||a.continue()}onOnline(){var a;const i=this.observers.find(l=>l.shouldFetchOnReconnect());i==null||i.refetch({cancelRefetch:!1}),(a=De(this,Ci))==null||a.continue()}addObserver(i){this.observers.includes(i)||(this.observers.push(i),this.clearGcTimeout(),De(this,cs).notify({type:"observerAdded",query:this,observer:i}))}removeObserver(i){this.observers.includes(i)&&(this.observers=this.observers.filter(a=>a!==i),this.observers.length||(De(this,Ci)&&(De(this,Vd)?De(this,Ci).cancel({revert:!0}):De(this,Ci).cancelRetry()),this.scheduleGc()),De(this,cs).notify({type:"observerRemoved",query:this,observer:i}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||Ti(this,js,ac).call(this,{type:"invalidate"})}fetch(i,a){var w,C,N;if(this.state.fetchStatus!=="idle"){if(this.state.data!==void 0&&(a!=null&&a.cancelRefetch))this.cancel({silent:!0});else if(De(this,Ci))return De(this,Ci).continueRetry(),De(this,Ci).promise}if(i&&this.setOptions(i),!this.options.queryFn){const D=this.observers.find(O=>O.options.queryFn);D&&this.setOptions(D.options)}const l=new AbortController,u=D=>{Object.defineProperty(D,"signal",{enumerable:!0,get:()=>(Zt(this,Vd,!0),l.signal)})},f=()=>{const D=ZH(this.options,a),O={queryKey:this.queryKey,meta:this.meta};return u(O),Zt(this,Vd,!1),this.options.persister?this.options.persister(D,O,this):D(O)},_={fetchOptions:a,options:this.options,queryKey:this.queryKey,state:this.state,fetchFn:f};u(_),(w=this.options.behavior)==null||w.onFetch(_,this),Zt(this,pp,this.state),(this.state.fetchStatus==="idle"||this.state.fetchMeta!==((C=_.fetchOptions)==null?void 0:C.meta))&&Ti(this,js,ac).call(this,{type:"fetch",meta:(N=_.fetchOptions)==null?void 0:N.meta});const v=D=>{var O,G,F,V;lI(D)&&D.silent||Ti(this,js,ac).call(this,{type:"error",error:D}),lI(D)||((G=(O=De(this,cs).config).onError)==null||G.call(O,D,this),(V=(F=De(this,cs).config).onSettled)==null||V.call(F,this.state.data,D,this)),this.scheduleGc()};return Zt(this,Ci,rG({initialPromise:a==null?void 0:a.initialPromise,fn:_.fetchFn,abort:l.abort.bind(l),onSuccess:D=>{var O,G,F,V;if(D===void 0){v(new Error(`${this.queryHash} data is undefined`));return}try{this.setData(D)}catch(L){v(L);return}(G=(O=De(this,cs).config).onSuccess)==null||G.call(O,D,this),(V=(F=De(this,cs).config).onSettled)==null||V.call(F,D,this.state.error,this),this.scheduleGc()},onError:v,onFail:(D,O)=>{Ti(this,js,ac).call(this,{type:"failed",failureCount:D,error:O})},onPause:()=>{Ti(this,js,ac).call(this,{type:"pause"})},onContinue:()=>{Ti(this,js,ac).call(this,{type:"continue"})},retry:_.options.retry,retryDelay:_.options.retryDelay,networkMode:_.options.networkMode,canRun:()=>!0})),De(this,Ci).start()}},hp=new WeakMap,pp=new WeakMap,cs=new WeakMap,Ci=new WeakMap,Pg=new WeakMap,Vd=new WeakMap,js=new WeakSet,ac=function(i){const a=l=>{switch(i.type){case"failed":return{...l,fetchFailureCount:i.failureCount,fetchFailureReason:i.error};case"pause":return{...l,fetchStatus:"paused"};case"continue":return{...l,fetchStatus:"fetching"};case"fetch":return{...l,...sme(l.data,this.options),fetchMeta:i.meta??null};case"success":return{...l,data:i.data,dataUpdateCount:l.dataUpdateCount+1,dataUpdatedAt:i.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!i.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};case"error":const u=i.error;return lI(u)&&u.revert&&De(this,pp)?{...De(this,pp),fetchStatus:"idle"}:{...l,error:u,errorUpdateCount:l.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:l.fetchFailureCount+1,fetchFailureReason:u,fetchStatus:"idle",status:"error"};case"invalidate":return{...l,isInvalidated:!0};case"setState":return{...l,...i.state}}};this.state=a(this.state),Vi.batch(()=>{this.observers.forEach(l=>{l.onQueryUpdate()}),De(this,cs).notify({query:this,type:"updated",action:i})})},u6);function sme(r,i){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:tG(i.networkMode)?"fetching":"paused",...r===void 0&&{error:null,status:"pending"}}}function ame(r){const i=typeof r.initialData=="function"?r.initialData():r.initialData,a=i!==void 0,l=a?typeof r.initialDataUpdatedAt=="function"?r.initialDataUpdatedAt():r.initialDataUpdatedAt:0;return{data:i,dataUpdateCount:0,dataUpdatedAt:a?l??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:a?"success":"pending",fetchStatus:"idle"}}var ba,h6,cme=(h6=class extends r0{constructor(i={}){super();An(this,ba);this.config=i,Zt(this,ba,new Map)}build(i,a,l){const u=a.queryKey,f=a.queryHash??oO(u,a);let _=this.get(f);return _||(_=new ome({cache:this,queryKey:u,queryHash:f,options:i.defaultQueryOptions(a),state:l,defaultOptions:i.getQueryDefaults(u)}),this.add(_)),_}add(i){De(this,ba).has(i.queryHash)||(De(this,ba).set(i.queryHash,i),this.notify({type:"added",query:i}))}remove(i){const a=De(this,ba).get(i.queryHash);a&&(i.destroy(),a===i&&De(this,ba).delete(i.queryHash),this.notify({type:"removed",query:i}))}clear(){Vi.batch(()=>{this.getAll().forEach(i=>{this.remove(i)})})}get(i){return De(this,ba).get(i)}getAll(){return[...De(this,ba).values()]}find(i){const a={exact:!0,...i};return this.getAll().find(l=>a5(a,l))}findAll(i={}){const a=this.getAll();return Object.keys(i).length>0?a.filter(l=>a5(i,l)):a}notify(i){Vi.batch(()=>{this.listeners.forEach(a=>{a(i)})})}onFocus(){Vi.batch(()=>{this.getAll().forEach(i=>{i.onFocus()})})}onOnline(){Vi.batch(()=>{this.getAll().forEach(i=>{i.onOnline()})})}},ba=new WeakMap,h6),Ia,Ui,Fd,Aa,rl,p6,lme=(p6=class extends iG{constructor(i){super();An(this,Aa);An(this,Ia);An(this,Ui);An(this,Fd);this.mutationId=i.mutationId,Zt(this,Ui,i.mutationCache),Zt(this,Ia,[]),this.state=i.state||dme(),this.setOptions(i.options),this.scheduleGc()}setOptions(i){this.options=i,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(i){De(this,Ia).includes(i)||(De(this,Ia).push(i),this.clearGcTimeout(),De(this,Ui).notify({type:"observerAdded",mutation:this,observer:i}))}removeObserver(i){Zt(this,Ia,De(this,Ia).filter(a=>a!==i)),this.scheduleGc(),De(this,Ui).notify({type:"observerRemoved",mutation:this,observer:i})}optionalRemove(){De(this,Ia).length||(this.state.status==="pending"?this.scheduleGc():De(this,Ui).remove(this))}continue(){var i;return((i=De(this,Fd))==null?void 0:i.continue())??this.execute(this.state.variables)}async execute(i){var u,f,_,v,w,C,N,D,O,G,F,V,L,B,W,z,$,te,ie,ce;Zt(this,Fd,rG({fn:()=>this.options.mutationFn?this.options.mutationFn(i):Promise.reject(new Error("No mutationFn found")),onFail:(pe,Pe)=>{Ti(this,Aa,rl).call(this,{type:"failed",failureCount:pe,error:Pe})},onPause:()=>{Ti(this,Aa,rl).call(this,{type:"pause"})},onContinue:()=>{Ti(this,Aa,rl).call(this,{type:"continue"})},retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>De(this,Ui).canRun(this)}));const a=this.state.status==="pending",l=!De(this,Fd).canStart();try{if(!a){Ti(this,Aa,rl).call(this,{type:"pending",variables:i,isPaused:l}),await((f=(u=De(this,Ui).config).onMutate)==null?void 0:f.call(u,i,this));const Pe=await((v=(_=this.options).onMutate)==null?void 0:v.call(_,i));Pe!==this.state.context&&Ti(this,Aa,rl).call(this,{type:"pending",context:Pe,variables:i,isPaused:l})}const pe=await De(this,Fd).start();return await((C=(w=De(this,Ui).config).onSuccess)==null?void 0:C.call(w,pe,i,this.state.context,this)),await((D=(N=this.options).onSuccess)==null?void 0:D.call(N,pe,i,this.state.context)),await((G=(O=De(this,Ui).config).onSettled)==null?void 0:G.call(O,pe,null,this.state.variables,this.state.context,this)),await((V=(F=this.options).onSettled)==null?void 0:V.call(F,pe,null,i,this.state.context)),Ti(this,Aa,rl).call(this,{type:"success",data:pe}),pe}catch(pe){try{throw await((B=(L=De(this,Ui).config).onError)==null?void 0:B.call(L,pe,i,this.state.context,this)),await((z=(W=this.options).onError)==null?void 0:z.call(W,pe,i,this.state.context)),await((te=($=De(this,Ui).config).onSettled)==null?void 0:te.call($,void 0,pe,this.state.variables,this.state.context,this)),await((ce=(ie=this.options).onSettled)==null?void 0:ce.call(ie,void 0,pe,i,this.state.context)),pe}finally{Ti(this,Aa,rl).call(this,{type:"error",error:pe})}}finally{De(this,Ui).runNext(this)}}},Ia=new WeakMap,Ui=new WeakMap,Fd=new WeakMap,Aa=new WeakSet,rl=function(i){const a=l=>{switch(i.type){case"failed":return{...l,failureCount:i.failureCount,failureReason:i.error};case"pause":return{...l,isPaused:!0};case"continue":return{...l,isPaused:!1};case"pending":return{...l,context:i.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:i.isPaused,status:"pending",variables:i.variables,submittedAt:Date.now()};case"success":return{...l,data:i.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...l,data:void 0,error:i.error,failureCount:l.failureCount+1,failureReason:i.error,isPaused:!1,status:"error"}}};this.state=a(this.state),Vi.batch(()=>{De(this,Ia).forEach(l=>{l.onMutationUpdate(i)}),De(this,Ui).notify({mutation:this,type:"updated",action:i})})},p6);function dme(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var wo,Dg,f6,ume=(f6=class extends r0{constructor(i={}){super();An(this,wo);An(this,Dg);this.config=i,Zt(this,wo,new Map),Zt(this,Dg,Date.now())}build(i,a,l){const u=new lme({mutationCache:this,mutationId:++Bv(this,Dg)._,options:i.defaultMutationOptions(a),state:l});return this.add(u),u}add(i){const a=dy(i),l=De(this,wo).get(a)??[];l.push(i),De(this,wo).set(a,l),this.notify({type:"added",mutation:i})}remove(i){var l;const a=dy(i);if(De(this,wo).has(a)){const u=(l=De(this,wo).get(a))==null?void 0:l.filter(f=>f!==i);u&&(u.length===0?De(this,wo).delete(a):De(this,wo).set(a,u))}this.notify({type:"removed",mutation:i})}canRun(i){var l;const a=(l=De(this,wo).get(dy(i)))==null?void 0:l.find(u=>u.state.status==="pending");return!a||a===i}runNext(i){var l;const a=(l=De(this,wo).get(dy(i)))==null?void 0:l.find(u=>u!==i&&u.state.isPaused);return(a==null?void 0:a.continue())??Promise.resolve()}clear(){Vi.batch(()=>{this.getAll().forEach(i=>{this.remove(i)})})}getAll(){return[...De(this,wo).values()].flat()}find(i){const a={exact:!0,...i};return this.getAll().find(l=>c5(a,l))}findAll(i={}){return this.getAll().filter(a=>c5(i,a))}notify(i){Vi.batch(()=>{this.listeners.forEach(a=>{a(i)})})}resumePausedMutations(){const i=this.getAll().filter(a=>a.state.isPaused);return Vi.batch(()=>Promise.all(i.map(a=>a.continue().catch(Us))))}},wo=new WeakMap,Dg=new WeakMap,f6);function dy(r){var i;return((i=r.options.scope)==null?void 0:i.id)??String(r.mutationId)}function u5(r){return{onFetch:(i,a)=>{var N,D,O,G,F;const l=i.options,u=(O=(D=(N=i.fetchOptions)==null?void 0:N.meta)==null?void 0:D.fetchMore)==null?void 0:O.direction,f=((G=i.state.data)==null?void 0:G.pages)||[],_=((F=i.state.data)==null?void 0:F.pageParams)||[];let v={pages:[],pageParams:[]},w=0;const C=async()=>{let V=!1;const L=z=>{Object.defineProperty(z,"signal",{enumerable:!0,get:()=>(i.signal.aborted?V=!0:i.signal.addEventListener("abort",()=>{V=!0}),i.signal)})},B=ZH(i.options,i.fetchOptions),W=async(z,$,te)=>{if(V)return Promise.reject();if($==null&&z.pages.length)return Promise.resolve(z);const ie={queryKey:i.queryKey,pageParam:$,direction:te?"backward":"forward",meta:i.options.meta};L(ie);const ce=await B(ie),{maxPages:pe}=i.options,Pe=te?Zfe:Qfe;return{pages:Pe(z.pages,ce,pe),pageParams:Pe(z.pageParams,$,pe)}};if(u&&f.length){const z=u==="backward",$=z?hme:h5,te={pages:f,pageParams:_},ie=$(l,te);v=await W(te,ie,z)}else{const z=r??f.length;do{const $=w===0?_[0]??l.initialPageParam:h5(l,v);if(w>0&&$==null)break;v=await W(v,$),w++}while(w<z)}return v};i.options.persister?i.fetchFn=()=>{var V,L;return(L=(V=i.options).persister)==null?void 0:L.call(V,C,{queryKey:i.queryKey,meta:i.options.meta,signal:i.signal},a)}:i.fetchFn=C}}}function h5(r,{pages:i,pageParams:a}){const l=i.length-1;return i.length>0?r.getNextPageParam(i[l],i,a[l],a):void 0}function hme(r,{pages:i,pageParams:a}){var l;return i.length>0?(l=r.getPreviousPageParam)==null?void 0:l.call(r,i[0],i,a[0],a):void 0}var Sr,ul,hl,fp,mp,pl,gp,_p,m6,pme=(m6=class{constructor(r={}){An(this,Sr);An(this,ul);An(this,hl);An(this,fp);An(this,mp);An(this,pl);An(this,gp);An(this,_p);Zt(this,Sr,r.queryCache||new cme),Zt(this,ul,r.mutationCache||new ume),Zt(this,hl,r.defaultOptions||{}),Zt(this,fp,new Map),Zt(this,mp,new Map),Zt(this,pl,0)}mount(){Bv(this,pl)._++,De(this,pl)===1&&(Zt(this,gp,eG.subscribe(async r=>{r&&(await this.resumePausedMutations(),De(this,Sr).onFocus())})),Zt(this,_p,mS.subscribe(async r=>{r&&(await this.resumePausedMutations(),De(this,Sr).onOnline())})))}unmount(){var r,i;Bv(this,pl)._--,De(this,pl)===0&&((r=De(this,gp))==null||r.call(this),Zt(this,gp,void 0),(i=De(this,_p))==null||i.call(this),Zt(this,_p,void 0))}isFetching(r){return De(this,Sr).findAll({...r,fetchStatus:"fetching"}).length}isMutating(r){return De(this,ul).findAll({...r,status:"pending"}).length}getQueryData(r){var a;const i=this.defaultQueryOptions({queryKey:r});return(a=De(this,Sr).get(i.queryHash))==null?void 0:a.state.data}ensureQueryData(r){const i=this.getQueryData(r.queryKey);if(i===void 0)return this.fetchQuery(r);{const a=this.defaultQueryOptions(r),l=De(this,Sr).build(this,a);return r.revalidateIfStale&&l.isStaleByTime(s5(a.staleTime,l))&&this.prefetchQuery(a),Promise.resolve(i)}}getQueriesData(r){return De(this,Sr).findAll(r).map(({queryKey:i,state:a})=>{const l=a.data;return[i,l]})}setQueryData(r,i,a){const l=this.defaultQueryOptions({queryKey:r}),u=De(this,Sr).get(l.queryHash),f=u==null?void 0:u.state.data,_=Kfe(i,f);if(_!==void 0)return De(this,Sr).build(this,l).setData(_,{...a,manual:!0})}setQueriesData(r,i,a){return Vi.batch(()=>De(this,Sr).findAll(r).map(({queryKey:l})=>[l,this.setQueryData(l,i,a)]))}getQueryState(r){var a;const i=this.defaultQueryOptions({queryKey:r});return(a=De(this,Sr).get(i.queryHash))==null?void 0:a.state}removeQueries(r){const i=De(this,Sr);Vi.batch(()=>{i.findAll(r).forEach(a=>{i.remove(a)})})}resetQueries(r,i){const a=De(this,Sr),l={type:"active",...r};return Vi.batch(()=>(a.findAll(r).forEach(u=>{u.reset()}),this.refetchQueries(l,i)))}cancelQueries(r={},i={}){const a={revert:!0,...i},l=Vi.batch(()=>De(this,Sr).findAll(r).map(u=>u.cancel(a)));return Promise.all(l).then(Us).catch(Us)}invalidateQueries(r={},i={}){return Vi.batch(()=>{if(De(this,Sr).findAll(r).forEach(l=>{l.invalidate()}),r.refetchType==="none")return Promise.resolve();const a={...r,type:r.refetchType??r.type??"active"};return this.refetchQueries(a,i)})}refetchQueries(r={},i){const a={...i,cancelRefetch:(i==null?void 0:i.cancelRefetch)??!0},l=Vi.batch(()=>De(this,Sr).findAll(r).filter(u=>!u.isDisabled()).map(u=>{let f=u.fetch(void 0,a);return a.throwOnError||(f=f.catch(Us)),u.state.fetchStatus==="paused"?Promise.resolve():f}));return Promise.all(l).then(Us)}fetchQuery(r){const i=this.defaultQueryOptions(r);i.retry===void 0&&(i.retry=!1);const a=De(this,Sr).build(this,i);return a.isStaleByTime(s5(i.staleTime,a))?a.fetch(i):Promise.resolve(a.state.data)}prefetchQuery(r){return this.fetchQuery(r).then(Us).catch(Us)}fetchInfiniteQuery(r){return r.behavior=u5(r.pages),this.fetchQuery(r)}prefetchInfiniteQuery(r){return this.fetchInfiniteQuery(r).then(Us).catch(Us)}ensureInfiniteQueryData(r){return r.behavior=u5(r.pages),this.ensureQueryData(r)}resumePausedMutations(){return mS.isOnline()?De(this,ul).resumePausedMutations():Promise.resolve()}getQueryCache(){return De(this,Sr)}getMutationCache(){return De(this,ul)}getDefaultOptions(){return De(this,hl)}setDefaultOptions(r){Zt(this,hl,r)}setQueryDefaults(r,i){De(this,fp).set(Tg(r),{queryKey:r,defaultOptions:i})}getQueryDefaults(r){const i=[...De(this,fp).values()];let a={};return i.forEach(l=>{wg(r,l.queryKey)&&(a={...a,...l.defaultOptions})}),a}setMutationDefaults(r,i){De(this,mp).set(Tg(r),{mutationKey:r,defaultOptions:i})}getMutationDefaults(r){const i=[...De(this,mp).values()];let a={};return i.forEach(l=>{wg(r,l.mutationKey)&&(a={...a,...l.defaultOptions})}),a}defaultQueryOptions(r){if(r._defaulted)return r;const i={...De(this,hl).queries,...this.getQueryDefaults(r.queryKey),...r,_defaulted:!0};return i.queryHash||(i.queryHash=oO(i.queryKey,i)),i.refetchOnReconnect===void 0&&(i.refetchOnReconnect=i.networkMode!=="always"),i.throwOnError===void 0&&(i.throwOnError=!!i.suspense),!i.networkMode&&i.persister&&(i.networkMode="offlineFirst"),i.enabled!==!0&&i.queryFn===sO&&(i.enabled=!1),i}defaultMutationOptions(r){return r!=null&&r._defaulted?r:{...De(this,hl).mutations,...(r==null?void 0:r.mutationKey)&&this.getMutationDefaults(r.mutationKey),...r,_defaulted:!0}}clear(){De(this,Sr).clear(),De(this,ul).clear()}},Sr=new WeakMap,ul=new WeakMap,hl=new WeakMap,fp=new WeakMap,mp=new WeakMap,pl=new WeakMap,gp=new WeakMap,_p=new WeakMap,m6),fme=k.createContext(void 0),mme=({client:r,children:i})=>(k.useEffect(()=>(r.mount(),()=>{r.unmount()}),[r]),S.jsx(fme.Provider,{value:r,children:i}));/**
 * @remix-run/router v1.20.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Rg(){return Rg=Object.assign?Object.assign.bind():function(r){for(var i=1;i<arguments.length;i++){var a=arguments[i];for(var l in a)Object.prototype.hasOwnProperty.call(a,l)&&(r[l]=a[l])}return r},Rg.apply(this,arguments)}var gl;(function(r){r.Pop="POP",r.Push="PUSH",r.Replace="REPLACE"})(gl||(gl={}));const p5="popstate";function gme(r){r===void 0&&(r={});function i(l,u){let{pathname:f,search:_,hash:v}=l.location;return OA("",{pathname:f,search:_,hash:v},u.state&&u.state.usr||null,u.state&&u.state.key||"default")}function a(l,u){return typeof u=="string"?u:gS(u)}return Eme(i,a,null,r)}function Br(r,i){if(r===!1||r===null||typeof r>"u")throw new Error(i)}function oG(r,i){if(!r){typeof console<"u"&&console.warn(i);try{throw new Error(i)}catch{}}}function _me(){return Math.random().toString(36).substr(2,8)}function f5(r,i){return{usr:r.state,key:r.key,idx:i}}function OA(r,i,a,l){return a===void 0&&(a=null),Rg({pathname:typeof r=="string"?r:r.pathname,search:"",hash:""},typeof i=="string"?Mp(i):i,{state:a,key:i&&i.key||l||_me()})}function gS(r){let{pathname:i="/",search:a="",hash:l=""}=r;return a&&a!=="?"&&(i+=a.charAt(0)==="?"?a:"?"+a),l&&l!=="#"&&(i+=l.charAt(0)==="#"?l:"#"+l),i}function Mp(r){let i={};if(r){let a=r.indexOf("#");a>=0&&(i.hash=r.substr(a),r=r.substr(0,a));let l=r.indexOf("?");l>=0&&(i.search=r.substr(l),r=r.substr(0,l)),r&&(i.pathname=r)}return i}function Eme(r,i,a,l){l===void 0&&(l={});let{window:u=document.defaultView,v5Compat:f=!1}=l,_=u.history,v=gl.Pop,w=null,C=N();C==null&&(C=0,_.replaceState(Rg({},_.state,{idx:C}),""));function N(){return(_.state||{idx:null}).idx}function D(){v=gl.Pop;let L=N(),B=L==null?null:L-C;C=L,w&&w({action:v,location:V.location,delta:B})}function O(L,B){v=gl.Push;let W=OA(V.location,L,B);C=N()+1;let z=f5(W,C),$=V.createHref(W);try{_.pushState(z,"",$)}catch(te){if(te instanceof DOMException&&te.name==="DataCloneError")throw te;u.location.assign($)}f&&w&&w({action:v,location:V.location,delta:1})}function G(L,B){v=gl.Replace;let W=OA(V.location,L,B);C=N();let z=f5(W,C),$=V.createHref(W);_.replaceState(z,"",$),f&&w&&w({action:v,location:V.location,delta:0})}function F(L){let B=u.location.origin!=="null"?u.location.origin:u.location.href,W=typeof L=="string"?L:gS(L);return W=W.replace(/ $/,"%20"),Br(B,"No window.location.(origin|href) available to create URL for href: "+W),new URL(W,B)}let V={get action(){return v},get location(){return r(u,_)},listen(L){if(w)throw new Error("A history only accepts one active listener");return u.addEventListener(p5,D),w=L,()=>{u.removeEventListener(p5,D),w=null}},createHref(L){return i(u,L)},createURL:F,encodeLocation(L){let B=F(L);return{pathname:B.pathname,search:B.search,hash:B.hash}},push:O,replace:G,go(L){return _.go(L)}};return V}var m5;(function(r){r.data="data",r.deferred="deferred",r.redirect="redirect",r.error="error"})(m5||(m5={}));function vme(r,i,a){return a===void 0&&(a="/"),yme(r,i,a,!1)}function yme(r,i,a,l){let u=typeof i=="string"?Mp(i):i,f=aO(u.pathname||"/",a);if(f==null)return null;let _=sG(r);Sme(_);let v=null;for(let w=0;v==null&&w<_.length;++w){let C=Dme(f);v=Ome(_[w],C,l)}return v}function sG(r,i,a,l){i===void 0&&(i=[]),a===void 0&&(a=[]),l===void 0&&(l="");let u=(f,_,v)=>{let w={relativePath:v===void 0?f.path||"":v,caseSensitive:f.caseSensitive===!0,childrenIndex:_,route:f};w.relativePath.startsWith("/")&&(Br(w.relativePath.startsWith(l),'Absolute route path "'+w.relativePath+'" nested under path '+('"'+l+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),w.relativePath=w.relativePath.slice(l.length));let C=bl([l,w.relativePath]),N=a.concat(w);f.children&&f.children.length>0&&(Br(f.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+C+'".')),sG(f.children,i,N,C)),!(f.path==null&&!f.index)&&i.push({path:C,score:Ame(C,f.index),routesMeta:N})};return r.forEach((f,_)=>{var v;if(f.path===""||!((v=f.path)!=null&&v.includes("?")))u(f,_);else for(let w of aG(f.path))u(f,_,w)}),i}function aG(r){let i=r.split("/");if(i.length===0)return[];let[a,...l]=i,u=a.endsWith("?"),f=a.replace(/\?$/,"");if(l.length===0)return u?[f,""]:[f];let _=aG(l.join("/")),v=[];return v.push(..._.map(w=>w===""?f:[f,w].join("/"))),u&&v.push(..._),v.map(w=>r.startsWith("/")&&w===""?"/":w)}function Sme(r){r.sort((i,a)=>i.score!==a.score?a.score-i.score:Nme(i.routesMeta.map(l=>l.childrenIndex),a.routesMeta.map(l=>l.childrenIndex)))}const Tme=/^:[\w-]+$/,wme=3,Rme=2,Cme=1,bme=10,Ime=-2,g5=r=>r==="*";function Ame(r,i){let a=r.split("/"),l=a.length;return a.some(g5)&&(l+=Ime),i&&(l+=Rme),a.filter(u=>!g5(u)).reduce((u,f)=>u+(Tme.test(f)?wme:f===""?Cme:bme),l)}function Nme(r,i){return r.length===i.length&&r.slice(0,-1).every((l,u)=>l===i[u])?r[r.length-1]-i[i.length-1]:0}function Ome(r,i,a){let{routesMeta:l}=r,u={},f="/",_=[];for(let v=0;v<l.length;++v){let w=l[v],C=v===l.length-1,N=f==="/"?i:i.slice(f.length)||"/",D=_5({path:w.relativePath,caseSensitive:w.caseSensitive,end:C},N),O=w.route;if(!D&&C&&a&&!l[l.length-1].route.index&&(D=_5({path:w.relativePath,caseSensitive:w.caseSensitive,end:!1},N)),!D)return null;Object.assign(u,D.params),_.push({params:u,pathname:bl([f,D.pathname]),pathnameBase:Mme(bl([f,D.pathnameBase])),route:O}),D.pathnameBase!=="/"&&(f=bl([f,D.pathnameBase]))}return _}function _5(r,i){typeof r=="string"&&(r={path:r,caseSensitive:!1,end:!0});let[a,l]=Pme(r.path,r.caseSensitive,r.end),u=i.match(a);if(!u)return null;let f=u[0],_=f.replace(/(.)\/+$/,"$1"),v=u.slice(1);return{params:l.reduce((C,N,D)=>{let{paramName:O,isOptional:G}=N;if(O==="*"){let V=v[D]||"";_=f.slice(0,f.length-V.length).replace(/(.)\/+$/,"$1")}const F=v[D];return G&&!F?C[O]=void 0:C[O]=(F||"").replace(/%2F/g,"/"),C},{}),pathname:f,pathnameBase:_,pattern:r}}function Pme(r,i,a){i===void 0&&(i=!1),a===void 0&&(a=!0),oG(r==="*"||!r.endsWith("*")||r.endsWith("/*"),'Route path "'+r+'" will be treated as if it were '+('"'+r.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+r.replace(/\*$/,"/*")+'".'));let l=[],u="^"+r.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(_,v,w)=>(l.push({paramName:v,isOptional:w!=null}),w?"/?([^\\/]+)?":"/([^\\/]+)"));return r.endsWith("*")?(l.push({paramName:"*"}),u+=r==="*"||r==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):a?u+="\\/*$":r!==""&&r!=="/"&&(u+="(?:(?=\\/|$))"),[new RegExp(u,i?void 0:"i"),l]}function Dme(r){try{return r.split("/").map(i=>decodeURIComponent(i).replace(/\//g,"%2F")).join("/")}catch(i){return oG(!1,'The URL path "'+r+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+i+").")),r}}function aO(r,i){if(i==="/")return r;if(!r.toLowerCase().startsWith(i.toLowerCase()))return null;let a=i.endsWith("/")?i.length-1:i.length,l=r.charAt(a);return l&&l!=="/"?null:r.slice(a)||"/"}function kme(r,i){i===void 0&&(i="/");let{pathname:a,search:l="",hash:u=""}=typeof r=="string"?Mp(r):r;return{pathname:a?a.startsWith("/")?a:xme(a,i):i,search:Ume(l),hash:jme(u)}}function xme(r,i){let a=i.replace(/\/+$/,"").split("/");return r.split("/").forEach(u=>{u===".."?a.length>1&&a.pop():u!=="."&&a.push(u)}),a.length>1?a.join("/"):"/"}function dI(r,i,a,l){return"Cannot include a '"+r+"' character in a manually specified "+("`to."+i+"` field ["+JSON.stringify(l)+"].  Please separate it out to the ")+("`to."+a+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function Lme(r){return r.filter((i,a)=>a===0||i.route.path&&i.route.path.length>0)}function cG(r,i){let a=Lme(r);return i?a.map((l,u)=>u===a.length-1?l.pathname:l.pathnameBase):a.map(l=>l.pathnameBase)}function lG(r,i,a,l){l===void 0&&(l=!1);let u;typeof r=="string"?u=Mp(r):(u=Rg({},r),Br(!u.pathname||!u.pathname.includes("?"),dI("?","pathname","search",u)),Br(!u.pathname||!u.pathname.includes("#"),dI("#","pathname","hash",u)),Br(!u.search||!u.search.includes("#"),dI("#","search","hash",u)));let f=r===""||u.pathname==="",_=f?"/":u.pathname,v;if(_==null)v=a;else{let D=i.length-1;if(!l&&_.startsWith("..")){let O=_.split("/");for(;O[0]==="..";)O.shift(),D-=1;u.pathname=O.join("/")}v=D>=0?i[D]:"/"}let w=kme(u,v),C=_&&_!=="/"&&_.endsWith("/"),N=(f||_===".")&&a.endsWith("/");return!w.pathname.endsWith("/")&&(C||N)&&(w.pathname+="/"),w}const bl=r=>r.join("/").replace(/\/\/+/g,"/"),Mme=r=>r.replace(/\/+$/,"").replace(/^\/*/,"/"),Ume=r=>!r||r==="?"?"":r.startsWith("?")?r:"?"+r,jme=r=>!r||r==="#"?"":r.startsWith("#")?r:"#"+r;function Vme(r){return r!=null&&typeof r.status=="number"&&typeof r.statusText=="string"&&typeof r.internal=="boolean"&&"data"in r}const dG=["post","put","patch","delete"];new Set(dG);const Fme=["get",...dG];new Set(Fme);/**
 * React Router v6.27.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Cg(){return Cg=Object.assign?Object.assign.bind():function(r){for(var i=1;i<arguments.length;i++){var a=arguments[i];for(var l in a)Object.prototype.hasOwnProperty.call(a,l)&&(r[l]=a[l])}return r},Cg.apply(this,arguments)}const cO=k.createContext(null),Bme=k.createContext(null),uu=k.createContext(null),o0=k.createContext(null),jl=k.createContext({outlet:null,matches:[],isDataRoute:!1}),uG=k.createContext(null);function Wme(r,i){let{relative:a}=i===void 0?{}:i;Bg()||Br(!1);let{basename:l,navigator:u}=k.useContext(uu),{hash:f,pathname:_,search:v}=pG(r,{relative:a}),w=_;return l!=="/"&&(w=_==="/"?l:bl([l,_])),u.createHref({pathname:w,search:v,hash:f})}function Bg(){return k.useContext(o0)!=null}function Up(){return Bg()||Br(!1),k.useContext(o0).location}function hG(r){k.useContext(uu).static||k.useLayoutEffect(r)}function jp(){let{isDataRoute:r}=k.useContext(jl);return r?rge():Hme()}function Hme(){Bg()||Br(!1);let r=k.useContext(cO),{basename:i,future:a,navigator:l}=k.useContext(uu),{matches:u}=k.useContext(jl),{pathname:f}=Up(),_=JSON.stringify(cG(u,a.v7_relativeSplatPath)),v=k.useRef(!1);return hG(()=>{v.current=!0}),k.useCallback(function(C,N){if(N===void 0&&(N={}),!v.current)return;if(typeof C=="number"){l.go(C);return}let D=lG(C,JSON.parse(_),f,N.relative==="path");r==null&&i!=="/"&&(D.pathname=D.pathname==="/"?i:bl([i,D.pathname])),(N.replace?l.replace:l.push)(D,N.state,N)},[i,l,_,f,r])}const Gme=k.createContext(null);function zme(r){let i=k.useContext(jl).outlet;return i&&k.createElement(Gme.Provider,{value:r},i)}function pG(r,i){let{relative:a}=i===void 0?{}:i,{future:l}=k.useContext(uu),{matches:u}=k.useContext(jl),{pathname:f}=Up(),_=JSON.stringify(cG(u,l.v7_relativeSplatPath));return k.useMemo(()=>lG(r,JSON.parse(_),f,a==="path"),[r,_,f,a])}function Kme(r,i){return Yme(r,i)}function Yme(r,i,a,l){Bg()||Br(!1);let{navigator:u}=k.useContext(uu),{matches:f}=k.useContext(jl),_=f[f.length-1],v=_?_.params:{};_&&_.pathname;let w=_?_.pathnameBase:"/";_&&_.route;let C=Up(),N;if(i){var D;let L=typeof i=="string"?Mp(i):i;w==="/"||(D=L.pathname)!=null&&D.startsWith(w)||Br(!1),N=L}else N=C;let O=N.pathname||"/",G=O;if(w!=="/"){let L=w.replace(/^\//,"").split("/");G="/"+O.replace(/^\//,"").split("/").slice(L.length).join("/")}let F=vme(r,{pathname:G}),V=Qme(F&&F.map(L=>Object.assign({},L,{params:Object.assign({},v,L.params),pathname:bl([w,u.encodeLocation?u.encodeLocation(L.pathname).pathname:L.pathname]),pathnameBase:L.pathnameBase==="/"?w:bl([w,u.encodeLocation?u.encodeLocation(L.pathnameBase).pathname:L.pathnameBase])})),f,a,l);return i&&V?k.createElement(o0.Provider,{value:{location:Cg({pathname:"/",search:"",hash:"",state:null,key:"default"},N),navigationType:gl.Pop}},V):V}function qme(){let r=nge(),i=Vme(r)?r.status+" "+r.statusText:r instanceof Error?r.message:JSON.stringify(r),a=r instanceof Error?r.stack:null,u={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return k.createElement(k.Fragment,null,k.createElement("h2",null,"Unexpected Application Error!"),k.createElement("h3",{style:{fontStyle:"italic"}},i),a?k.createElement("pre",{style:u},a):null,null)}const Xme=k.createElement(qme,null);class $me extends k.Component{constructor(i){super(i),this.state={location:i.location,revalidation:i.revalidation,error:i.error}}static getDerivedStateFromError(i){return{error:i}}static getDerivedStateFromProps(i,a){return a.location!==i.location||a.revalidation!=="idle"&&i.revalidation==="idle"?{error:i.error,location:i.location,revalidation:i.revalidation}:{error:i.error!==void 0?i.error:a.error,location:a.location,revalidation:i.revalidation||a.revalidation}}componentDidCatch(i,a){console.error("React Router caught the following error during render",i,a)}render(){return this.state.error!==void 0?k.createElement(jl.Provider,{value:this.props.routeContext},k.createElement(uG.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function Jme(r){let{routeContext:i,match:a,children:l}=r,u=k.useContext(cO);return u&&u.static&&u.staticContext&&(a.route.errorElement||a.route.ErrorBoundary)&&(u.staticContext._deepestRenderedBoundaryId=a.route.id),k.createElement(jl.Provider,{value:i},l)}function Qme(r,i,a,l){var u;if(i===void 0&&(i=[]),a===void 0&&(a=null),l===void 0&&(l=null),r==null){var f;if(!a)return null;if(a.errors)r=a.matches;else if((f=l)!=null&&f.v7_partialHydration&&i.length===0&&!a.initialized&&a.matches.length>0)r=a.matches;else return null}let _=r,v=(u=a)==null?void 0:u.errors;if(v!=null){let N=_.findIndex(D=>D.route.id&&(v==null?void 0:v[D.route.id])!==void 0);N>=0||Br(!1),_=_.slice(0,Math.min(_.length,N+1))}let w=!1,C=-1;if(a&&l&&l.v7_partialHydration)for(let N=0;N<_.length;N++){let D=_[N];if((D.route.HydrateFallback||D.route.hydrateFallbackElement)&&(C=N),D.route.id){let{loaderData:O,errors:G}=a,F=D.route.loader&&O[D.route.id]===void 0&&(!G||G[D.route.id]===void 0);if(D.route.lazy||F){w=!0,C>=0?_=_.slice(0,C+1):_=[_[0]];break}}}return _.reduceRight((N,D,O)=>{let G,F=!1,V=null,L=null;a&&(G=v&&D.route.id?v[D.route.id]:void 0,V=D.route.errorElement||Xme,w&&(C<0&&O===0?(F=!0,L=null):C===O&&(F=!0,L=D.route.hydrateFallbackElement||null)));let B=i.concat(_.slice(0,O+1)),W=()=>{let z;return G?z=V:F?z=L:D.route.Component?z=k.createElement(D.route.Component,null):D.route.element?z=D.route.element:z=N,k.createElement(Jme,{match:D,routeContext:{outlet:N,matches:B,isDataRoute:a!=null},children:z})};return a&&(D.route.ErrorBoundary||D.route.errorElement||O===0)?k.createElement($me,{location:a.location,revalidation:a.revalidation,component:V,error:G,children:W(),routeContext:{outlet:null,matches:B,isDataRoute:!0}}):W()},null)}var fG=function(r){return r.UseBlocker="useBlocker",r.UseRevalidator="useRevalidator",r.UseNavigateStable="useNavigate",r}(fG||{}),_S=function(r){return r.UseBlocker="useBlocker",r.UseLoaderData="useLoaderData",r.UseActionData="useActionData",r.UseRouteError="useRouteError",r.UseNavigation="useNavigation",r.UseRouteLoaderData="useRouteLoaderData",r.UseMatches="useMatches",r.UseRevalidator="useRevalidator",r.UseNavigateStable="useNavigate",r.UseRouteId="useRouteId",r}(_S||{});function Zme(r){let i=k.useContext(cO);return i||Br(!1),i}function ege(r){let i=k.useContext(Bme);return i||Br(!1),i}function tge(r){let i=k.useContext(jl);return i||Br(!1),i}function mG(r){let i=tge(),a=i.matches[i.matches.length-1];return a.route.id||Br(!1),a.route.id}function nge(){var r;let i=k.useContext(uG),a=ege(_S.UseRouteError),l=mG(_S.UseRouteError);return i!==void 0?i:(r=a.errors)==null?void 0:r[l]}function rge(){let{router:r}=Zme(fG.UseNavigateStable),i=mG(_S.UseNavigateStable),a=k.useRef(!1);return hG(()=>{a.current=!0}),k.useCallback(function(u,f){f===void 0&&(f={}),a.current&&(typeof u=="number"?r.navigate(u):r.navigate(u,Cg({fromRouteId:i},f)))},[r,i])}function ige(r){return zme(r.context)}function To(r){Br(!1)}function oge(r){let{basename:i="/",children:a=null,location:l,navigationType:u=gl.Pop,navigator:f,static:_=!1,future:v}=r;Bg()&&Br(!1);let w=i.replace(/^\/*/,"/"),C=k.useMemo(()=>({basename:w,navigator:f,static:_,future:Cg({v7_relativeSplatPath:!1},v)}),[w,v,f,_]);typeof l=="string"&&(l=Mp(l));let{pathname:N="/",search:D="",hash:O="",state:G=null,key:F="default"}=l,V=k.useMemo(()=>{let L=aO(N,w);return L==null?null:{location:{pathname:L,search:D,hash:O,state:G,key:F},navigationType:u}},[w,N,D,O,G,F,u]);return V==null?null:k.createElement(uu.Provider,{value:C},k.createElement(o0.Provider,{children:a,value:V}))}function sge(r){let{children:i,location:a}=r;return Kme(PA(i),a)}new Promise(()=>{});function PA(r,i){i===void 0&&(i=[]);let a=[];return k.Children.forEach(r,(l,u)=>{if(!k.isValidElement(l))return;let f=[...i,u];if(l.type===k.Fragment){a.push.apply(a,PA(l.props.children,f));return}l.type!==To&&Br(!1),!l.props.index||!l.props.children||Br(!1);let _={id:l.props.id||f.join("-"),caseSensitive:l.props.caseSensitive,element:l.props.element,Component:l.props.Component,index:l.props.index,path:l.props.path,loader:l.props.loader,action:l.props.action,errorElement:l.props.errorElement,ErrorBoundary:l.props.ErrorBoundary,hasErrorBoundary:l.props.ErrorBoundary!=null||l.props.errorElement!=null,shouldRevalidate:l.props.shouldRevalidate,handle:l.props.handle,lazy:l.props.lazy};l.props.children&&(_.children=PA(l.props.children,f)),a.push(_)}),a}/**
 * React Router DOM v6.27.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function DA(){return DA=Object.assign?Object.assign.bind():function(r){for(var i=1;i<arguments.length;i++){var a=arguments[i];for(var l in a)Object.prototype.hasOwnProperty.call(a,l)&&(r[l]=a[l])}return r},DA.apply(this,arguments)}function age(r,i){if(r==null)return{};var a={},l=Object.keys(r),u,f;for(f=0;f<l.length;f++)u=l[f],!(i.indexOf(u)>=0)&&(a[u]=r[u]);return a}function cge(r){return!!(r.metaKey||r.altKey||r.ctrlKey||r.shiftKey)}function lge(r,i){return r.button===0&&(!i||i==="_self")&&!cge(r)}const dge=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],uge="6";try{window.__reactRouterVersion=uge}catch{}const hge="startTransition",E5=b6[hge];function pge(r){let{basename:i,children:a,future:l,window:u}=r,f=k.useRef();f.current==null&&(f.current=gme({window:u,v5Compat:!0}));let _=f.current,[v,w]=k.useState({action:_.action,location:_.location}),{v7_startTransition:C}=l||{},N=k.useCallback(D=>{C&&E5?E5(()=>w(D)):w(D)},[w,C]);return k.useLayoutEffect(()=>_.listen(N),[_,N]),k.createElement(oge,{basename:i,children:a,location:v.location,navigationType:v.action,navigator:_,future:l})}const fge=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",mge=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Co=k.forwardRef(function(i,a){let{onClick:l,relative:u,reloadDocument:f,replace:_,state:v,target:w,to:C,preventScrollReset:N,viewTransition:D}=i,O=age(i,dge),{basename:G}=k.useContext(uu),F,V=!1;if(typeof C=="string"&&mge.test(C)&&(F=C,fge))try{let z=new URL(window.location.href),$=C.startsWith("//")?new URL(z.protocol+C):new URL(C),te=aO($.pathname,G);$.origin===z.origin&&te!=null?C=te+$.search+$.hash:V=!0}catch{}let L=Wme(C,{relative:u}),B=gge(C,{replace:_,state:v,target:w,preventScrollReset:N,relative:u,viewTransition:D});function W(z){l&&l(z),z.defaultPrevented||B(z)}return k.createElement("a",DA({},O,{href:F||L,onClick:V||f?l:W,ref:a,target:w}))});var v5;(function(r){r.UseScrollRestoration="useScrollRestoration",r.UseSubmit="useSubmit",r.UseSubmitFetcher="useSubmitFetcher",r.UseFetcher="useFetcher",r.useViewTransitionState="useViewTransitionState"})(v5||(v5={}));var y5;(function(r){r.UseFetcher="useFetcher",r.UseFetchers="useFetchers",r.UseScrollRestoration="useScrollRestoration"})(y5||(y5={}));function gge(r,i){let{target:a,replace:l,state:u,preventScrollReset:f,relative:_,viewTransition:v}=i===void 0?{}:i,w=jp(),C=Up(),N=pG(r,{relative:_});return k.useCallback(D=>{if(lge(D,a)){D.preventDefault();let O=l!==void 0?l:gS(C)===gS(N);w(r,{replace:O,state:u,preventScrollReset:f,relative:_,viewTransition:v})}},[C,w,N,l,u,a,r,f,_,v])}const gG=k.createContext(void 0);function _G(r,i){return function(){return r.apply(i,arguments)}}const{toString:_ge}=Object.prototype,{getPrototypeOf:lO}=Object,s0=(r=>i=>{const a=_ge.call(i);return r[a]||(r[a]=a.slice(8,-1).toLowerCase())})(Object.create(null)),Xs=r=>(r=r.toLowerCase(),i=>s0(i)===r),a0=r=>i=>typeof i===r,{isArray:Vp}=Array,bg=a0("undefined");function Ege(r){return r!==null&&!bg(r)&&r.constructor!==null&&!bg(r.constructor)&&Do(r.constructor.isBuffer)&&r.constructor.isBuffer(r)}const EG=Xs("ArrayBuffer");function vge(r){let i;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?i=ArrayBuffer.isView(r):i=r&&r.buffer&&EG(r.buffer),i}const yge=a0("string"),Do=a0("function"),vG=a0("number"),c0=r=>r!==null&&typeof r=="object",Sge=r=>r===!0||r===!1,Dy=r=>{if(s0(r)!=="object")return!1;const i=lO(r);return(i===null||i===Object.prototype||Object.getPrototypeOf(i)===null)&&!(Symbol.toStringTag in r)&&!(Symbol.iterator in r)},Tge=Xs("Date"),wge=Xs("File"),Rge=Xs("Blob"),Cge=Xs("FileList"),bge=r=>c0(r)&&Do(r.pipe),Ige=r=>{let i;return r&&(typeof FormData=="function"&&r instanceof FormData||Do(r.append)&&((i=s0(r))==="formdata"||i==="object"&&Do(r.toString)&&r.toString()==="[object FormData]"))},Age=Xs("URLSearchParams"),[Nge,Oge,Pge,Dge]=["ReadableStream","Request","Response","Headers"].map(Xs),kge=r=>r.trim?r.trim():r.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Wg(r,i,{allOwnKeys:a=!1}={}){if(r===null||typeof r>"u")return;let l,u;if(typeof r!="object"&&(r=[r]),Vp(r))for(l=0,u=r.length;l<u;l++)i.call(null,r[l],l,r);else{const f=a?Object.getOwnPropertyNames(r):Object.keys(r),_=f.length;let v;for(l=0;l<_;l++)v=f[l],i.call(null,r[v],v,r)}}function yG(r,i){i=i.toLowerCase();const a=Object.keys(r);let l=a.length,u;for(;l-- >0;)if(u=a[l],i===u.toLowerCase())return u;return null}const Ld=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,SG=r=>!bg(r)&&r!==Ld;function kA(){const{caseless:r}=SG(this)&&this||{},i={},a=(l,u)=>{const f=r&&yG(i,u)||u;Dy(i[f])&&Dy(l)?i[f]=kA(i[f],l):Dy(l)?i[f]=kA({},l):Vp(l)?i[f]=l.slice():i[f]=l};for(let l=0,u=arguments.length;l<u;l++)arguments[l]&&Wg(arguments[l],a);return i}const xge=(r,i,a,{allOwnKeys:l}={})=>(Wg(i,(u,f)=>{a&&Do(u)?r[f]=_G(u,a):r[f]=u},{allOwnKeys:l}),r),Lge=r=>(r.charCodeAt(0)===65279&&(r=r.slice(1)),r),Mge=(r,i,a,l)=>{r.prototype=Object.create(i.prototype,l),r.prototype.constructor=r,Object.defineProperty(r,"super",{value:i.prototype}),a&&Object.assign(r.prototype,a)},Uge=(r,i,a,l)=>{let u,f,_;const v={};if(i=i||{},r==null)return i;do{for(u=Object.getOwnPropertyNames(r),f=u.length;f-- >0;)_=u[f],(!l||l(_,r,i))&&!v[_]&&(i[_]=r[_],v[_]=!0);r=a!==!1&&lO(r)}while(r&&(!a||a(r,i))&&r!==Object.prototype);return i},jge=(r,i,a)=>{r=String(r),(a===void 0||a>r.length)&&(a=r.length),a-=i.length;const l=r.indexOf(i,a);return l!==-1&&l===a},Vge=r=>{if(!r)return null;if(Vp(r))return r;let i=r.length;if(!vG(i))return null;const a=new Array(i);for(;i-- >0;)a[i]=r[i];return a},Fge=(r=>i=>r&&i instanceof r)(typeof Uint8Array<"u"&&lO(Uint8Array)),Bge=(r,i)=>{const l=(r&&r[Symbol.iterator]).call(r);let u;for(;(u=l.next())&&!u.done;){const f=u.value;i.call(r,f[0],f[1])}},Wge=(r,i)=>{let a;const l=[];for(;(a=r.exec(i))!==null;)l.push(a);return l},Hge=Xs("HTMLFormElement"),Gge=r=>r.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(a,l,u){return l.toUpperCase()+u}),S5=(({hasOwnProperty:r})=>(i,a)=>r.call(i,a))(Object.prototype),zge=Xs("RegExp"),TG=(r,i)=>{const a=Object.getOwnPropertyDescriptors(r),l={};Wg(a,(u,f)=>{let _;(_=i(u,f,r))!==!1&&(l[f]=_||u)}),Object.defineProperties(r,l)},Kge=r=>{TG(r,(i,a)=>{if(Do(r)&&["arguments","caller","callee"].indexOf(a)!==-1)return!1;const l=r[a];if(Do(l)){if(i.enumerable=!1,"writable"in i){i.writable=!1;return}i.set||(i.set=()=>{throw Error("Can not rewrite read-only method '"+a+"'")})}})},Yge=(r,i)=>{const a={},l=u=>{u.forEach(f=>{a[f]=!0})};return Vp(r)?l(r):l(String(r).split(i)),a},qge=()=>{},Xge=(r,i)=>r!=null&&Number.isFinite(r=+r)?r:i;function $ge(r){return!!(r&&Do(r.append)&&r[Symbol.toStringTag]==="FormData"&&r[Symbol.iterator])}const Jge=r=>{const i=new Array(10),a=(l,u)=>{if(c0(l)){if(i.indexOf(l)>=0)return;if(!("toJSON"in l)){i[u]=l;const f=Vp(l)?[]:{};return Wg(l,(_,v)=>{const w=a(_,u+1);!bg(w)&&(f[v]=w)}),i[u]=void 0,f}}return l};return a(r,0)},Qge=Xs("AsyncFunction"),Zge=r=>r&&(c0(r)||Do(r))&&Do(r.then)&&Do(r.catch),wG=((r,i)=>r?setImmediate:i?((a,l)=>(Ld.addEventListener("message",({source:u,data:f})=>{u===Ld&&f===a&&l.length&&l.shift()()},!1),u=>{l.push(u),Ld.postMessage(a,"*")}))(`axios@${Math.random()}`,[]):a=>setTimeout(a))(typeof setImmediate=="function",Do(Ld.postMessage)),e_e=typeof queueMicrotask<"u"?queueMicrotask.bind(Ld):typeof process<"u"&&process.nextTick||wG,Se={isArray:Vp,isArrayBuffer:EG,isBuffer:Ege,isFormData:Ige,isArrayBufferView:vge,isString:yge,isNumber:vG,isBoolean:Sge,isObject:c0,isPlainObject:Dy,isReadableStream:Nge,isRequest:Oge,isResponse:Pge,isHeaders:Dge,isUndefined:bg,isDate:Tge,isFile:wge,isBlob:Rge,isRegExp:zge,isFunction:Do,isStream:bge,isURLSearchParams:Age,isTypedArray:Fge,isFileList:Cge,forEach:Wg,merge:kA,extend:xge,trim:kge,stripBOM:Lge,inherits:Mge,toFlatObject:Uge,kindOf:s0,kindOfTest:Xs,endsWith:jge,toArray:Vge,forEachEntry:Bge,matchAll:Wge,isHTMLForm:Hge,hasOwnProperty:S5,hasOwnProp:S5,reduceDescriptors:TG,freezeMethods:Kge,toObjectSet:Yge,toCamelCase:Gge,noop:qge,toFiniteNumber:Xge,findKey:yG,global:Ld,isContextDefined:SG,isSpecCompliantForm:$ge,toJSONObject:Jge,isAsyncFn:Qge,isThenable:Zge,setImmediate:wG,asap:e_e};function Kt(r,i,a,l,u){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=r,this.name="AxiosError",i&&(this.code=i),a&&(this.config=a),l&&(this.request=l),u&&(this.response=u,this.status=u.status?u.status:null)}Se.inherits(Kt,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Se.toJSONObject(this.config),code:this.code,status:this.status}}});const RG=Kt.prototype,CG={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(r=>{CG[r]={value:r}});Object.defineProperties(Kt,CG);Object.defineProperty(RG,"isAxiosError",{value:!0});Kt.from=(r,i,a,l,u,f)=>{const _=Object.create(RG);return Se.toFlatObject(r,_,function(w){return w!==Error.prototype},v=>v!=="isAxiosError"),Kt.call(_,r.message,i,a,l,u),_.cause=r,_.name=r.name,f&&Object.assign(_,f),_};const t_e=null;function xA(r){return Se.isPlainObject(r)||Se.isArray(r)}function bG(r){return Se.endsWith(r,"[]")?r.slice(0,-2):r}function T5(r,i,a){return r?r.concat(i).map(function(u,f){return u=bG(u),!a&&f?"["+u+"]":u}).join(a?".":""):i}function n_e(r){return Se.isArray(r)&&!r.some(xA)}const r_e=Se.toFlatObject(Se,{},null,function(i){return/^is[A-Z]/.test(i)});function l0(r,i,a){if(!Se.isObject(r))throw new TypeError("target must be an object");i=i||new FormData,a=Se.toFlatObject(a,{metaTokens:!0,dots:!1,indexes:!1},!1,function(V,L){return!Se.isUndefined(L[V])});const l=a.metaTokens,u=a.visitor||N,f=a.dots,_=a.indexes,w=(a.Blob||typeof Blob<"u"&&Blob)&&Se.isSpecCompliantForm(i);if(!Se.isFunction(u))throw new TypeError("visitor must be a function");function C(F){if(F===null)return"";if(Se.isDate(F))return F.toISOString();if(!w&&Se.isBlob(F))throw new Kt("Blob is not supported. Use a Buffer instead.");return Se.isArrayBuffer(F)||Se.isTypedArray(F)?w&&typeof Blob=="function"?new Blob([F]):Buffer.from(F):F}function N(F,V,L){let B=F;if(F&&!L&&typeof F=="object"){if(Se.endsWith(V,"{}"))V=l?V:V.slice(0,-2),F=JSON.stringify(F);else if(Se.isArray(F)&&n_e(F)||(Se.isFileList(F)||Se.endsWith(V,"[]"))&&(B=Se.toArray(F)))return V=bG(V),B.forEach(function(z,$){!(Se.isUndefined(z)||z===null)&&i.append(_===!0?T5([V],$,f):_===null?V:V+"[]",C(z))}),!1}return xA(F)?!0:(i.append(T5(L,V,f),C(F)),!1)}const D=[],O=Object.assign(r_e,{defaultVisitor:N,convertValue:C,isVisitable:xA});function G(F,V){if(!Se.isUndefined(F)){if(D.indexOf(F)!==-1)throw Error("Circular reference detected in "+V.join("."));D.push(F),Se.forEach(F,function(B,W){(!(Se.isUndefined(B)||B===null)&&u.call(i,B,Se.isString(W)?W.trim():W,V,O))===!0&&G(B,V?V.concat(W):[W])}),D.pop()}}if(!Se.isObject(r))throw new TypeError("data must be an object");return G(r),i}function w5(r){const i={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(r).replace(/[!'()~]|%20|%00/g,function(l){return i[l]})}function dO(r,i){this._pairs=[],r&&l0(r,this,i)}const IG=dO.prototype;IG.append=function(i,a){this._pairs.push([i,a])};IG.toString=function(i){const a=i?function(l){return i.call(this,l,w5)}:w5;return this._pairs.map(function(u){return a(u[0])+"="+a(u[1])},"").join("&")};function i_e(r){return encodeURIComponent(r).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function AG(r,i,a){if(!i)return r;const l=a&&a.encode||i_e;Se.isFunction(a)&&(a={serialize:a});const u=a&&a.serialize;let f;if(u?f=u(i,a):f=Se.isURLSearchParams(i)?i.toString():new dO(i,a).toString(l),f){const _=r.indexOf("#");_!==-1&&(r=r.slice(0,_)),r+=(r.indexOf("?")===-1?"?":"&")+f}return r}class R5{constructor(){this.handlers=[]}use(i,a,l){return this.handlers.push({fulfilled:i,rejected:a,synchronous:l?l.synchronous:!1,runWhen:l?l.runWhen:null}),this.handlers.length-1}eject(i){this.handlers[i]&&(this.handlers[i]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(i){Se.forEach(this.handlers,function(l){l!==null&&i(l)})}}const NG={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},o_e=typeof URLSearchParams<"u"?URLSearchParams:dO,s_e=typeof FormData<"u"?FormData:null,a_e=typeof Blob<"u"?Blob:null,c_e={isBrowser:!0,classes:{URLSearchParams:o_e,FormData:s_e,Blob:a_e},protocols:["http","https","file","blob","url","data"]},uO=typeof window<"u"&&typeof document<"u",LA=typeof navigator=="object"&&navigator||void 0,l_e=uO&&(!LA||["ReactNative","NativeScript","NS"].indexOf(LA.product)<0),d_e=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",u_e=uO&&window.location.href||"http://localhost",h_e=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:uO,hasStandardBrowserEnv:l_e,hasStandardBrowserWebWorkerEnv:d_e,navigator:LA,origin:u_e},Symbol.toStringTag,{value:"Module"})),Ai={...h_e,...c_e};function p_e(r,i){return l0(r,new Ai.classes.URLSearchParams,Object.assign({visitor:function(a,l,u,f){return Ai.isNode&&Se.isBuffer(a)?(this.append(l,a.toString("base64")),!1):f.defaultVisitor.apply(this,arguments)}},i))}function f_e(r){return Se.matchAll(/\w+|\[(\w*)]/g,r).map(i=>i[0]==="[]"?"":i[1]||i[0])}function m_e(r){const i={},a=Object.keys(r);let l;const u=a.length;let f;for(l=0;l<u;l++)f=a[l],i[f]=r[f];return i}function OG(r){function i(a,l,u,f){let _=a[f++];if(_==="__proto__")return!0;const v=Number.isFinite(+_),w=f>=a.length;return _=!_&&Se.isArray(u)?u.length:_,w?(Se.hasOwnProp(u,_)?u[_]=[u[_],l]:u[_]=l,!v):((!u[_]||!Se.isObject(u[_]))&&(u[_]=[]),i(a,l,u[_],f)&&Se.isArray(u[_])&&(u[_]=m_e(u[_])),!v)}if(Se.isFormData(r)&&Se.isFunction(r.entries)){const a={};return Se.forEachEntry(r,(l,u)=>{i(f_e(l),u,a,0)}),a}return null}function g_e(r,i,a){if(Se.isString(r))try{return(i||JSON.parse)(r),Se.trim(r)}catch(l){if(l.name!=="SyntaxError")throw l}return(0,JSON.stringify)(r)}const Hg={transitional:NG,adapter:["xhr","http","fetch"],transformRequest:[function(i,a){const l=a.getContentType()||"",u=l.indexOf("application/json")>-1,f=Se.isObject(i);if(f&&Se.isHTMLForm(i)&&(i=new FormData(i)),Se.isFormData(i))return u?JSON.stringify(OG(i)):i;if(Se.isArrayBuffer(i)||Se.isBuffer(i)||Se.isStream(i)||Se.isFile(i)||Se.isBlob(i)||Se.isReadableStream(i))return i;if(Se.isArrayBufferView(i))return i.buffer;if(Se.isURLSearchParams(i))return a.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),i.toString();let v;if(f){if(l.indexOf("application/x-www-form-urlencoded")>-1)return p_e(i,this.formSerializer).toString();if((v=Se.isFileList(i))||l.indexOf("multipart/form-data")>-1){const w=this.env&&this.env.FormData;return l0(v?{"files[]":i}:i,w&&new w,this.formSerializer)}}return f||u?(a.setContentType("application/json",!1),g_e(i)):i}],transformResponse:[function(i){const a=this.transitional||Hg.transitional,l=a&&a.forcedJSONParsing,u=this.responseType==="json";if(Se.isResponse(i)||Se.isReadableStream(i))return i;if(i&&Se.isString(i)&&(l&&!this.responseType||u)){const _=!(a&&a.silentJSONParsing)&&u;try{return JSON.parse(i)}catch(v){if(_)throw v.name==="SyntaxError"?Kt.from(v,Kt.ERR_BAD_RESPONSE,this,null,this.response):v}}return i}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Ai.classes.FormData,Blob:Ai.classes.Blob},validateStatus:function(i){return i>=200&&i<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Se.forEach(["delete","get","head","post","put","patch"],r=>{Hg.headers[r]={}});const __e=Se.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),E_e=r=>{const i={};let a,l,u;return r&&r.split(`
`).forEach(function(_){u=_.indexOf(":"),a=_.substring(0,u).trim().toLowerCase(),l=_.substring(u+1).trim(),!(!a||i[a]&&__e[a])&&(a==="set-cookie"?i[a]?i[a].push(l):i[a]=[l]:i[a]=i[a]?i[a]+", "+l:l)}),i},C5=Symbol("internals");function Lm(r){return r&&String(r).trim().toLowerCase()}function ky(r){return r===!1||r==null?r:Se.isArray(r)?r.map(ky):String(r)}function v_e(r){const i=Object.create(null),a=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let l;for(;l=a.exec(r);)i[l[1]]=l[2];return i}const y_e=r=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(r.trim());function uI(r,i,a,l,u){if(Se.isFunction(l))return l.call(this,i,a);if(u&&(i=a),!!Se.isString(i)){if(Se.isString(l))return i.indexOf(l)!==-1;if(Se.isRegExp(l))return l.test(i)}}function S_e(r){return r.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(i,a,l)=>a.toUpperCase()+l)}function T_e(r,i){const a=Se.toCamelCase(" "+i);["get","set","has"].forEach(l=>{Object.defineProperty(r,l+a,{value:function(u,f,_){return this[l].call(this,i,u,f,_)},configurable:!0})})}class lo{constructor(i){i&&this.set(i)}set(i,a,l){const u=this;function f(v,w,C){const N=Lm(w);if(!N)throw new Error("header name must be a non-empty string");const D=Se.findKey(u,N);(!D||u[D]===void 0||C===!0||C===void 0&&u[D]!==!1)&&(u[D||w]=ky(v))}const _=(v,w)=>Se.forEach(v,(C,N)=>f(C,N,w));if(Se.isPlainObject(i)||i instanceof this.constructor)_(i,a);else if(Se.isString(i)&&(i=i.trim())&&!y_e(i))_(E_e(i),a);else if(Se.isHeaders(i))for(const[v,w]of i.entries())f(w,v,l);else i!=null&&f(a,i,l);return this}get(i,a){if(i=Lm(i),i){const l=Se.findKey(this,i);if(l){const u=this[l];if(!a)return u;if(a===!0)return v_e(u);if(Se.isFunction(a))return a.call(this,u,l);if(Se.isRegExp(a))return a.exec(u);throw new TypeError("parser must be boolean|regexp|function")}}}has(i,a){if(i=Lm(i),i){const l=Se.findKey(this,i);return!!(l&&this[l]!==void 0&&(!a||uI(this,this[l],l,a)))}return!1}delete(i,a){const l=this;let u=!1;function f(_){if(_=Lm(_),_){const v=Se.findKey(l,_);v&&(!a||uI(l,l[v],v,a))&&(delete l[v],u=!0)}}return Se.isArray(i)?i.forEach(f):f(i),u}clear(i){const a=Object.keys(this);let l=a.length,u=!1;for(;l--;){const f=a[l];(!i||uI(this,this[f],f,i,!0))&&(delete this[f],u=!0)}return u}normalize(i){const a=this,l={};return Se.forEach(this,(u,f)=>{const _=Se.findKey(l,f);if(_){a[_]=ky(u),delete a[f];return}const v=i?S_e(f):String(f).trim();v!==f&&delete a[f],a[v]=ky(u),l[v]=!0}),this}concat(...i){return this.constructor.concat(this,...i)}toJSON(i){const a=Object.create(null);return Se.forEach(this,(l,u)=>{l!=null&&l!==!1&&(a[u]=i&&Se.isArray(l)?l.join(", "):l)}),a}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([i,a])=>i+": "+a).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(i){return i instanceof this?i:new this(i)}static concat(i,...a){const l=new this(i);return a.forEach(u=>l.set(u)),l}static accessor(i){const l=(this[C5]=this[C5]={accessors:{}}).accessors,u=this.prototype;function f(_){const v=Lm(_);l[v]||(T_e(u,_),l[v]=!0)}return Se.isArray(i)?i.forEach(f):f(i),this}}lo.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);Se.reduceDescriptors(lo.prototype,({value:r},i)=>{let a=i[0].toUpperCase()+i.slice(1);return{get:()=>r,set(l){this[a]=l}}});Se.freezeMethods(lo);function hI(r,i){const a=this||Hg,l=i||a,u=lo.from(l.headers);let f=l.data;return Se.forEach(r,function(v){f=v.call(a,f,u.normalize(),i?i.status:void 0)}),u.normalize(),f}function PG(r){return!!(r&&r.__CANCEL__)}function Fp(r,i,a){Kt.call(this,r??"canceled",Kt.ERR_CANCELED,i,a),this.name="CanceledError"}Se.inherits(Fp,Kt,{__CANCEL__:!0});function DG(r,i,a){const l=a.config.validateStatus;!a.status||!l||l(a.status)?r(a):i(new Kt("Request failed with status code "+a.status,[Kt.ERR_BAD_REQUEST,Kt.ERR_BAD_RESPONSE][Math.floor(a.status/100)-4],a.config,a.request,a))}function w_e(r){const i=/^([-+\w]{1,25})(:?\/\/|:)/.exec(r);return i&&i[1]||""}function R_e(r,i){r=r||10;const a=new Array(r),l=new Array(r);let u=0,f=0,_;return i=i!==void 0?i:1e3,function(w){const C=Date.now(),N=l[f];_||(_=C),a[u]=w,l[u]=C;let D=f,O=0;for(;D!==u;)O+=a[D++],D=D%r;if(u=(u+1)%r,u===f&&(f=(f+1)%r),C-_<i)return;const G=N&&C-N;return G?Math.round(O*1e3/G):void 0}}function C_e(r,i){let a=0,l=1e3/i,u,f;const _=(C,N=Date.now())=>{a=N,u=null,f&&(clearTimeout(f),f=null),r.apply(null,C)};return[(...C)=>{const N=Date.now(),D=N-a;D>=l?_(C,N):(u=C,f||(f=setTimeout(()=>{f=null,_(u)},l-D)))},()=>u&&_(u)]}const ES=(r,i,a=3)=>{let l=0;const u=R_e(50,250);return C_e(f=>{const _=f.loaded,v=f.lengthComputable?f.total:void 0,w=_-l,C=u(w),N=_<=v;l=_;const D={loaded:_,total:v,progress:v?_/v:void 0,bytes:w,rate:C||void 0,estimated:C&&v&&N?(v-_)/C:void 0,event:f,lengthComputable:v!=null,[i?"download":"upload"]:!0};r(D)},a)},b5=(r,i)=>{const a=r!=null;return[l=>i[0]({lengthComputable:a,total:r,loaded:l}),i[1]]},I5=r=>(...i)=>Se.asap(()=>r(...i)),b_e=Ai.hasStandardBrowserEnv?((r,i)=>a=>(a=new URL(a,Ai.origin),r.protocol===a.protocol&&r.host===a.host&&(i||r.port===a.port)))(new URL(Ai.origin),Ai.navigator&&/(msie|trident)/i.test(Ai.navigator.userAgent)):()=>!0,I_e=Ai.hasStandardBrowserEnv?{write(r,i,a,l,u,f){const _=[r+"="+encodeURIComponent(i)];Se.isNumber(a)&&_.push("expires="+new Date(a).toGMTString()),Se.isString(l)&&_.push("path="+l),Se.isString(u)&&_.push("domain="+u),f===!0&&_.push("secure"),document.cookie=_.join("; ")},read(r){const i=document.cookie.match(new RegExp("(^|;\\s*)("+r+")=([^;]*)"));return i?decodeURIComponent(i[3]):null},remove(r){this.write(r,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function A_e(r){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(r)}function N_e(r,i){return i?r.replace(/\/?\/$/,"")+"/"+i.replace(/^\/+/,""):r}function kG(r,i,a){let l=!A_e(i);return r&&(l||a==!1)?N_e(r,i):i}const A5=r=>r instanceof lo?{...r}:r;function nu(r,i){i=i||{};const a={};function l(C,N,D,O){return Se.isPlainObject(C)&&Se.isPlainObject(N)?Se.merge.call({caseless:O},C,N):Se.isPlainObject(N)?Se.merge({},N):Se.isArray(N)?N.slice():N}function u(C,N,D,O){if(Se.isUndefined(N)){if(!Se.isUndefined(C))return l(void 0,C,D,O)}else return l(C,N,D,O)}function f(C,N){if(!Se.isUndefined(N))return l(void 0,N)}function _(C,N){if(Se.isUndefined(N)){if(!Se.isUndefined(C))return l(void 0,C)}else return l(void 0,N)}function v(C,N,D){if(D in i)return l(C,N);if(D in r)return l(void 0,C)}const w={url:f,method:f,data:f,baseURL:_,transformRequest:_,transformResponse:_,paramsSerializer:_,timeout:_,timeoutMessage:_,withCredentials:_,withXSRFToken:_,adapter:_,responseType:_,xsrfCookieName:_,xsrfHeaderName:_,onUploadProgress:_,onDownloadProgress:_,decompress:_,maxContentLength:_,maxBodyLength:_,beforeRedirect:_,transport:_,httpAgent:_,httpsAgent:_,cancelToken:_,socketPath:_,responseEncoding:_,validateStatus:v,headers:(C,N,D)=>u(A5(C),A5(N),D,!0)};return Se.forEach(Object.keys(Object.assign({},r,i)),function(N){const D=w[N]||u,O=D(r[N],i[N],N);Se.isUndefined(O)&&D!==v||(a[N]=O)}),a}const xG=r=>{const i=nu({},r);let{data:a,withXSRFToken:l,xsrfHeaderName:u,xsrfCookieName:f,headers:_,auth:v}=i;i.headers=_=lo.from(_),i.url=AG(kG(i.baseURL,i.url,i.allowAbsoluteUrls),r.params,r.paramsSerializer),v&&_.set("Authorization","Basic "+btoa((v.username||"")+":"+(v.password?unescape(encodeURIComponent(v.password)):"")));let w;if(Se.isFormData(a)){if(Ai.hasStandardBrowserEnv||Ai.hasStandardBrowserWebWorkerEnv)_.setContentType(void 0);else if((w=_.getContentType())!==!1){const[C,...N]=w?w.split(";").map(D=>D.trim()).filter(Boolean):[];_.setContentType([C||"multipart/form-data",...N].join("; "))}}if(Ai.hasStandardBrowserEnv&&(l&&Se.isFunction(l)&&(l=l(i)),l||l!==!1&&b_e(i.url))){const C=u&&f&&I_e.read(f);C&&_.set(u,C)}return i},O_e=typeof XMLHttpRequest<"u",P_e=O_e&&function(r){return new Promise(function(a,l){const u=xG(r);let f=u.data;const _=lo.from(u.headers).normalize();let{responseType:v,onUploadProgress:w,onDownloadProgress:C}=u,N,D,O,G,F;function V(){G&&G(),F&&F(),u.cancelToken&&u.cancelToken.unsubscribe(N),u.signal&&u.signal.removeEventListener("abort",N)}let L=new XMLHttpRequest;L.open(u.method.toUpperCase(),u.url,!0),L.timeout=u.timeout;function B(){if(!L)return;const z=lo.from("getAllResponseHeaders"in L&&L.getAllResponseHeaders()),te={data:!v||v==="text"||v==="json"?L.responseText:L.response,status:L.status,statusText:L.statusText,headers:z,config:r,request:L};DG(function(ce){a(ce),V()},function(ce){l(ce),V()},te),L=null}"onloadend"in L?L.onloadend=B:L.onreadystatechange=function(){!L||L.readyState!==4||L.status===0&&!(L.responseURL&&L.responseURL.indexOf("file:")===0)||setTimeout(B)},L.onabort=function(){L&&(l(new Kt("Request aborted",Kt.ECONNABORTED,r,L)),L=null)},L.onerror=function(){l(new Kt("Network Error",Kt.ERR_NETWORK,r,L)),L=null},L.ontimeout=function(){let $=u.timeout?"timeout of "+u.timeout+"ms exceeded":"timeout exceeded";const te=u.transitional||NG;u.timeoutErrorMessage&&($=u.timeoutErrorMessage),l(new Kt($,te.clarifyTimeoutError?Kt.ETIMEDOUT:Kt.ECONNABORTED,r,L)),L=null},f===void 0&&_.setContentType(null),"setRequestHeader"in L&&Se.forEach(_.toJSON(),function($,te){L.setRequestHeader(te,$)}),Se.isUndefined(u.withCredentials)||(L.withCredentials=!!u.withCredentials),v&&v!=="json"&&(L.responseType=u.responseType),C&&([O,F]=ES(C,!0),L.addEventListener("progress",O)),w&&L.upload&&([D,G]=ES(w),L.upload.addEventListener("progress",D),L.upload.addEventListener("loadend",G)),(u.cancelToken||u.signal)&&(N=z=>{L&&(l(!z||z.type?new Fp(null,r,L):z),L.abort(),L=null)},u.cancelToken&&u.cancelToken.subscribe(N),u.signal&&(u.signal.aborted?N():u.signal.addEventListener("abort",N)));const W=w_e(u.url);if(W&&Ai.protocols.indexOf(W)===-1){l(new Kt("Unsupported protocol "+W+":",Kt.ERR_BAD_REQUEST,r));return}L.send(f||null)})},D_e=(r,i)=>{const{length:a}=r=r?r.filter(Boolean):[];if(i||a){let l=new AbortController,u;const f=function(C){if(!u){u=!0,v();const N=C instanceof Error?C:this.reason;l.abort(N instanceof Kt?N:new Fp(N instanceof Error?N.message:N))}};let _=i&&setTimeout(()=>{_=null,f(new Kt(`timeout ${i} of ms exceeded`,Kt.ETIMEDOUT))},i);const v=()=>{r&&(_&&clearTimeout(_),_=null,r.forEach(C=>{C.unsubscribe?C.unsubscribe(f):C.removeEventListener("abort",f)}),r=null)};r.forEach(C=>C.addEventListener("abort",f));const{signal:w}=l;return w.unsubscribe=()=>Se.asap(v),w}},k_e=function*(r,i){let a=r.byteLength;if(a<i){yield r;return}let l=0,u;for(;l<a;)u=l+i,yield r.slice(l,u),l=u},x_e=async function*(r,i){for await(const a of L_e(r))yield*k_e(a,i)},L_e=async function*(r){if(r[Symbol.asyncIterator]){yield*r;return}const i=r.getReader();try{for(;;){const{done:a,value:l}=await i.read();if(a)break;yield l}}finally{await i.cancel()}},N5=(r,i,a,l)=>{const u=x_e(r,i);let f=0,_,v=w=>{_||(_=!0,l&&l(w))};return new ReadableStream({async pull(w){try{const{done:C,value:N}=await u.next();if(C){v(),w.close();return}let D=N.byteLength;if(a){let O=f+=D;a(O)}w.enqueue(new Uint8Array(N))}catch(C){throw v(C),C}},cancel(w){return v(w),u.return()}},{highWaterMark:2})},d0=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",LG=d0&&typeof ReadableStream=="function",M_e=d0&&(typeof TextEncoder=="function"?(r=>i=>r.encode(i))(new TextEncoder):async r=>new Uint8Array(await new Response(r).arrayBuffer())),MG=(r,...i)=>{try{return!!r(...i)}catch{return!1}},U_e=LG&&MG(()=>{let r=!1;const i=new Request(Ai.origin,{body:new ReadableStream,method:"POST",get duplex(){return r=!0,"half"}}).headers.has("Content-Type");return r&&!i}),O5=64*1024,MA=LG&&MG(()=>Se.isReadableStream(new Response("").body)),vS={stream:MA&&(r=>r.body)};d0&&(r=>{["text","arrayBuffer","blob","formData","stream"].forEach(i=>{!vS[i]&&(vS[i]=Se.isFunction(r[i])?a=>a[i]():(a,l)=>{throw new Kt(`Response type '${i}' is not supported`,Kt.ERR_NOT_SUPPORT,l)})})})(new Response);const j_e=async r=>{if(r==null)return 0;if(Se.isBlob(r))return r.size;if(Se.isSpecCompliantForm(r))return(await new Request(Ai.origin,{method:"POST",body:r}).arrayBuffer()).byteLength;if(Se.isArrayBufferView(r)||Se.isArrayBuffer(r))return r.byteLength;if(Se.isURLSearchParams(r)&&(r=r+""),Se.isString(r))return(await M_e(r)).byteLength},V_e=async(r,i)=>{const a=Se.toFiniteNumber(r.getContentLength());return a??j_e(i)},F_e=d0&&(async r=>{let{url:i,method:a,data:l,signal:u,cancelToken:f,timeout:_,onDownloadProgress:v,onUploadProgress:w,responseType:C,headers:N,withCredentials:D="same-origin",fetchOptions:O}=xG(r);C=C?(C+"").toLowerCase():"text";let G=D_e([u,f&&f.toAbortSignal()],_),F;const V=G&&G.unsubscribe&&(()=>{G.unsubscribe()});let L;try{if(w&&U_e&&a!=="get"&&a!=="head"&&(L=await V_e(N,l))!==0){let te=new Request(i,{method:"POST",body:l,duplex:"half"}),ie;if(Se.isFormData(l)&&(ie=te.headers.get("content-type"))&&N.setContentType(ie),te.body){const[ce,pe]=b5(L,ES(I5(w)));l=N5(te.body,O5,ce,pe)}}Se.isString(D)||(D=D?"include":"omit");const B="credentials"in Request.prototype;F=new Request(i,{...O,signal:G,method:a.toUpperCase(),headers:N.normalize().toJSON(),body:l,duplex:"half",credentials:B?D:void 0});let W=await fetch(F);const z=MA&&(C==="stream"||C==="response");if(MA&&(v||z&&V)){const te={};["status","statusText","headers"].forEach(Pe=>{te[Pe]=W[Pe]});const ie=Se.toFiniteNumber(W.headers.get("content-length")),[ce,pe]=v&&b5(ie,ES(I5(v),!0))||[];W=new Response(N5(W.body,O5,ce,()=>{pe&&pe(),V&&V()}),te)}C=C||"text";let $=await vS[Se.findKey(vS,C)||"text"](W,r);return!z&&V&&V(),await new Promise((te,ie)=>{DG(te,ie,{data:$,headers:lo.from(W.headers),status:W.status,statusText:W.statusText,config:r,request:F})})}catch(B){throw V&&V(),B&&B.name==="TypeError"&&/fetch/i.test(B.message)?Object.assign(new Kt("Network Error",Kt.ERR_NETWORK,r,F),{cause:B.cause||B}):Kt.from(B,B&&B.code,r,F)}}),UA={http:t_e,xhr:P_e,fetch:F_e};Se.forEach(UA,(r,i)=>{if(r){try{Object.defineProperty(r,"name",{value:i})}catch{}Object.defineProperty(r,"adapterName",{value:i})}});const P5=r=>`- ${r}`,B_e=r=>Se.isFunction(r)||r===null||r===!1,UG={getAdapter:r=>{r=Se.isArray(r)?r:[r];const{length:i}=r;let a,l;const u={};for(let f=0;f<i;f++){a=r[f];let _;if(l=a,!B_e(a)&&(l=UA[(_=String(a)).toLowerCase()],l===void 0))throw new Kt(`Unknown adapter '${_}'`);if(l)break;u[_||"#"+f]=l}if(!l){const f=Object.entries(u).map(([v,w])=>`adapter ${v} `+(w===!1?"is not supported by the environment":"is not available in the build"));let _=i?f.length>1?`since :
`+f.map(P5).join(`
`):" "+P5(f[0]):"as no adapter specified";throw new Kt("There is no suitable adapter to dispatch the request "+_,"ERR_NOT_SUPPORT")}return l},adapters:UA};function pI(r){if(r.cancelToken&&r.cancelToken.throwIfRequested(),r.signal&&r.signal.aborted)throw new Fp(null,r)}function D5(r){return pI(r),r.headers=lo.from(r.headers),r.data=hI.call(r,r.transformRequest),["post","put","patch"].indexOf(r.method)!==-1&&r.headers.setContentType("application/x-www-form-urlencoded",!1),UG.getAdapter(r.adapter||Hg.adapter)(r).then(function(l){return pI(r),l.data=hI.call(r,r.transformResponse,l),l.headers=lo.from(l.headers),l},function(l){return PG(l)||(pI(r),l&&l.response&&(l.response.data=hI.call(r,r.transformResponse,l.response),l.response.headers=lo.from(l.response.headers))),Promise.reject(l)})}const jG="1.8.4",u0={};["object","boolean","number","function","string","symbol"].forEach((r,i)=>{u0[r]=function(l){return typeof l===r||"a"+(i<1?"n ":" ")+r}});const k5={};u0.transitional=function(i,a,l){function u(f,_){return"[Axios v"+jG+"] Transitional option '"+f+"'"+_+(l?". "+l:"")}return(f,_,v)=>{if(i===!1)throw new Kt(u(_," has been removed"+(a?" in "+a:"")),Kt.ERR_DEPRECATED);return a&&!k5[_]&&(k5[_]=!0,console.warn(u(_," has been deprecated since v"+a+" and will be removed in the near future"))),i?i(f,_,v):!0}};u0.spelling=function(i){return(a,l)=>(console.warn(`${l} is likely a misspelling of ${i}`),!0)};function W_e(r,i,a){if(typeof r!="object")throw new Kt("options must be an object",Kt.ERR_BAD_OPTION_VALUE);const l=Object.keys(r);let u=l.length;for(;u-- >0;){const f=l[u],_=i[f];if(_){const v=r[f],w=v===void 0||_(v,f,r);if(w!==!0)throw new Kt("option "+f+" must be "+w,Kt.ERR_BAD_OPTION_VALUE);continue}if(a!==!0)throw new Kt("Unknown option "+f,Kt.ERR_BAD_OPTION)}}const xy={assertOptions:W_e,validators:u0},Ra=xy.validators;class Gd{constructor(i){this.defaults=i,this.interceptors={request:new R5,response:new R5}}async request(i,a){try{return await this._request(i,a)}catch(l){if(l instanceof Error){let u={};Error.captureStackTrace?Error.captureStackTrace(u):u=new Error;const f=u.stack?u.stack.replace(/^.+\n/,""):"";try{l.stack?f&&!String(l.stack).endsWith(f.replace(/^.+\n.+\n/,""))&&(l.stack+=`
`+f):l.stack=f}catch{}}throw l}}_request(i,a){typeof i=="string"?(a=a||{},a.url=i):a=i||{},a=nu(this.defaults,a);const{transitional:l,paramsSerializer:u,headers:f}=a;l!==void 0&&xy.assertOptions(l,{silentJSONParsing:Ra.transitional(Ra.boolean),forcedJSONParsing:Ra.transitional(Ra.boolean),clarifyTimeoutError:Ra.transitional(Ra.boolean)},!1),u!=null&&(Se.isFunction(u)?a.paramsSerializer={serialize:u}:xy.assertOptions(u,{encode:Ra.function,serialize:Ra.function},!0)),a.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?a.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:a.allowAbsoluteUrls=!0),xy.assertOptions(a,{baseUrl:Ra.spelling("baseURL"),withXsrfToken:Ra.spelling("withXSRFToken")},!0),a.method=(a.method||this.defaults.method||"get").toLowerCase();let _=f&&Se.merge(f.common,f[a.method]);f&&Se.forEach(["delete","get","head","post","put","patch","common"],F=>{delete f[F]}),a.headers=lo.concat(_,f);const v=[];let w=!0;this.interceptors.request.forEach(function(V){typeof V.runWhen=="function"&&V.runWhen(a)===!1||(w=w&&V.synchronous,v.unshift(V.fulfilled,V.rejected))});const C=[];this.interceptors.response.forEach(function(V){C.push(V.fulfilled,V.rejected)});let N,D=0,O;if(!w){const F=[D5.bind(this),void 0];for(F.unshift.apply(F,v),F.push.apply(F,C),O=F.length,N=Promise.resolve(a);D<O;)N=N.then(F[D++],F[D++]);return N}O=v.length;let G=a;for(D=0;D<O;){const F=v[D++],V=v[D++];try{G=F(G)}catch(L){V.call(this,L);break}}try{N=D5.call(this,G)}catch(F){return Promise.reject(F)}for(D=0,O=C.length;D<O;)N=N.then(C[D++],C[D++]);return N}getUri(i){i=nu(this.defaults,i);const a=kG(i.baseURL,i.url,i.allowAbsoluteUrls);return AG(a,i.params,i.paramsSerializer)}}Se.forEach(["delete","get","head","options"],function(i){Gd.prototype[i]=function(a,l){return this.request(nu(l||{},{method:i,url:a,data:(l||{}).data}))}});Se.forEach(["post","put","patch"],function(i){function a(l){return function(f,_,v){return this.request(nu(v||{},{method:i,headers:l?{"Content-Type":"multipart/form-data"}:{},url:f,data:_}))}}Gd.prototype[i]=a(),Gd.prototype[i+"Form"]=a(!0)});class hO{constructor(i){if(typeof i!="function")throw new TypeError("executor must be a function.");let a;this.promise=new Promise(function(f){a=f});const l=this;this.promise.then(u=>{if(!l._listeners)return;let f=l._listeners.length;for(;f-- >0;)l._listeners[f](u);l._listeners=null}),this.promise.then=u=>{let f;const _=new Promise(v=>{l.subscribe(v),f=v}).then(u);return _.cancel=function(){l.unsubscribe(f)},_},i(function(f,_,v){l.reason||(l.reason=new Fp(f,_,v),a(l.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(i){if(this.reason){i(this.reason);return}this._listeners?this._listeners.push(i):this._listeners=[i]}unsubscribe(i){if(!this._listeners)return;const a=this._listeners.indexOf(i);a!==-1&&this._listeners.splice(a,1)}toAbortSignal(){const i=new AbortController,a=l=>{i.abort(l)};return this.subscribe(a),i.signal.unsubscribe=()=>this.unsubscribe(a),i.signal}static source(){let i;return{token:new hO(function(u){i=u}),cancel:i}}}function H_e(r){return function(a){return r.apply(null,a)}}function G_e(r){return Se.isObject(r)&&r.isAxiosError===!0}const jA={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(jA).forEach(([r,i])=>{jA[i]=r});function VG(r){const i=new Gd(r),a=_G(Gd.prototype.request,i);return Se.extend(a,Gd.prototype,i,{allOwnKeys:!0}),Se.extend(a,i,null,{allOwnKeys:!0}),a.create=function(u){return VG(nu(r,u))},a}const $t=VG(Hg);$t.Axios=Gd;$t.CanceledError=Fp;$t.CancelToken=hO;$t.isCancel=PG;$t.VERSION=jG;$t.toFormData=l0;$t.AxiosError=Kt;$t.Cancel=$t.CanceledError;$t.all=function(i){return Promise.all(i)};$t.spread=H_e;$t.isAxiosError=G_e;$t.mergeConfig=nu;$t.AxiosHeaders=lo;$t.formToJSON=r=>OG(Se.isHTMLForm(r)?new FormData(r):r);$t.getAdapter=UG.getAdapter;$t.HttpStatusCode=jA;$t.default=$t;const z_e="https://localhost:1190",Cr=$t.create({baseURL:z_e,headers:{"Content-Type":"application/json"}});Cr.interceptors.request.use(r=>{const i=localStorage.getItem("token")||"";return i&&(r.headers.Authorization=`Bearer ${i}`),r});Cr.interceptors.response.use(r=>r,r=>(r.response&&r.response.status===401&&(it.error("You are not authorized to access this resource."),localStorage.removeItem("token"),localStorage.removeItem("user"),_l.logout(),window.location.href=location.pathname==="/login"?"":"/login"),Promise.reject(r)));const _l={async register(r){var i,a;try{const l=new FormData;return r.ProfileImage&&l.append("ProfileImage",r.ProfileImage),r.fullName&&l.append("fullName",r.fullName),l.append("username",r.username),l.append("email",r.email),l.append("Password",r.password),l.append("confirmPassword",r.confirmPassword),l.append("gender",r.gender),l.append("dateOfBirth",r.dateOfBirth),l.append("role",r.role),(await Cr.post("/api/Account/Register",l,{headers:{"Content-Type":"multipart/form-data"}})).data}catch(l){if($t.isAxiosError(l)){const u=((a=(i=l.response)==null?void 0:i.data)==null?void 0:a.message)||"Registration failed";it.error(u)}throw l}},async login(r){var i,a,l;try{const u=await Cr.post("/api/Account/Login",r);return(i=u.data)!=null&&i.token&&u.data.userId!==null?(localStorage.setItem("token",u.data.token),localStorage.setItem("userId",u.data.userId),it.success("Logged in successfully",{icon:"✅"})):(console.error("Invalid user data structure:",u.data.user),it.error("Received invalid user data from server")),u.data}catch(u){if($t.isAxiosError(u)){const f=((l=(a=u.response)==null?void 0:a.data)==null?void 0:l.message)||"Login failed";it.error(f,{icon:"❌"})}throw u}},logout(){localStorage.removeItem("token"),localStorage.removeItem("userId")},isAuthenticated(){return document.cookie.includes("token=")?!0:!!localStorage.getItem("token")},async sendCode(r){var i,a;try{(await Cr.post("/api/Account/SendCode",{email:r})).status===200&&console.log("Code sent successfully")}catch(l){if($t.isAxiosError(l)){const u=((a=(i=l.response)==null?void 0:i.data)==null?void 0:a.message)||"Failed to send verification code";it.error(u)}throw l}},async verifyResetCode(r,i){var a,l;try{const u=await Cr.post("/api/Account/VerifyCode",{email:r,code:i});if(u.status===200)return console.log("Code verified successfully",u.data.resetToken),u.data.resetToken}catch(u){if($t.isAxiosError(u)){const f=((l=(a=u.response)==null?void 0:a.data)==null?void 0:l.message)||"Invalid verification code";it.error(f)}throw u}},async resetPassword(r,i,a,l){var u,f;try{const _=await Cr.post("/api/Account/ResetPassword",{email:r,Token:i,Password:a,ConfirmPassword:l});return _.status===200&&console.log("Password reset successfully",_.data),_.data}catch(_){if($t.isAxiosError(_)){const v=((f=(u=_.response)==null?void 0:u.data)==null?void 0:f.message)||"Password reset failed";it.error(v)}throw _}}};class zd extends Error{constructor(i,a){const l=new.target.prototype;super(`${i}: Status code '${a}'`),this.statusCode=a,this.__proto__=l}}class pO extends Error{constructor(i="A timeout occurred."){const a=new.target.prototype;super(i),this.__proto__=a}}class Ws extends Error{constructor(i="An abort occurred."){const a=new.target.prototype;super(i),this.__proto__=a}}class K_e extends Error{constructor(i,a){const l=new.target.prototype;super(i),this.transport=a,this.errorType="UnsupportedTransportError",this.__proto__=l}}class Y_e extends Error{constructor(i,a){const l=new.target.prototype;super(i),this.transport=a,this.errorType="DisabledTransportError",this.__proto__=l}}class q_e extends Error{constructor(i,a){const l=new.target.prototype;super(i),this.transport=a,this.errorType="FailedToStartTransportError",this.__proto__=l}}class x5 extends Error{constructor(i){const a=new.target.prototype;super(i),this.errorType="FailedToNegotiateWithServerError",this.__proto__=a}}class X_e extends Error{constructor(i,a){const l=new.target.prototype;super(i),this.innerErrors=a,this.__proto__=l}}class FG{constructor(i,a,l){this.statusCode=i,this.statusText=a,this.content=l}}class h0{get(i,a){return this.send({...a,method:"GET",url:i})}post(i,a){return this.send({...a,method:"POST",url:i})}delete(i,a){return this.send({...a,method:"DELETE",url:i})}getCookieString(i){return""}}var Ae;(function(r){r[r.Trace=0]="Trace",r[r.Debug=1]="Debug",r[r.Information=2]="Information",r[r.Warning=3]="Warning",r[r.Error=4]="Error",r[r.Critical=5]="Critical",r[r.None=6]="None"})(Ae||(Ae={}));class Ig{constructor(){}log(i,a){}}Ig.instance=new Ig;const $_e="8.0.7";class Vr{static isRequired(i,a){if(i==null)throw new Error(`The '${a}' argument is required.`)}static isNotEmpty(i,a){if(!i||i.match(/^\s*$/))throw new Error(`The '${a}' argument should not be empty.`)}static isIn(i,a,l){if(!(i in a))throw new Error(`Unknown ${l} value: ${i}.`)}}class pr{static get isBrowser(){return!pr.isNode&&typeof window=="object"&&typeof window.document=="object"}static get isWebWorker(){return!pr.isNode&&typeof self=="object"&&"importScripts"in self}static get isReactNative(){return!pr.isNode&&typeof window=="object"&&typeof window.document>"u"}static get isNode(){return typeof process<"u"&&process.release&&process.release.name==="node"}}function Ag(r,i){let a="";return ru(r)?(a=`Binary data of length ${r.byteLength}`,i&&(a+=`. Content: '${J_e(r)}'`)):typeof r=="string"&&(a=`String data of length ${r.length}`,i&&(a+=`. Content: '${r}'`)),a}function J_e(r){const i=new Uint8Array(r);let a="";return i.forEach(l=>{const u=l<16?"0":"";a+=`0x${u}${l.toString(16)} `}),a.substr(0,a.length-1)}function ru(r){return r&&typeof ArrayBuffer<"u"&&(r instanceof ArrayBuffer||r.constructor&&r.constructor.name==="ArrayBuffer")}async function BG(r,i,a,l,u,f){const _={},[v,w]=Ap();_[v]=w,r.log(Ae.Trace,`(${i} transport) sending data. ${Ag(u,f.logMessageContent)}.`);const C=ru(u)?"arraybuffer":"text",N=await a.post(l,{content:u,headers:{..._,...f.headers},responseType:C,timeout:f.timeout,withCredentials:f.withCredentials});r.log(Ae.Trace,`(${i} transport) request complete. Response status: ${N.statusCode}.`)}function Q_e(r){return r===void 0?new yS(Ae.Information):r===null?Ig.instance:r.log!==void 0?r:new yS(r)}class Z_e{constructor(i,a){this._subject=i,this._observer=a}dispose(){const i=this._subject.observers.indexOf(this._observer);i>-1&&this._subject.observers.splice(i,1),this._subject.observers.length===0&&this._subject.cancelCallback&&this._subject.cancelCallback().catch(a=>{})}}class yS{constructor(i){this._minLevel=i,this.out=console}log(i,a){if(i>=this._minLevel){const l=`[${new Date().toISOString()}] ${Ae[i]}: ${a}`;switch(i){case Ae.Critical:case Ae.Error:this.out.error(l);break;case Ae.Warning:this.out.warn(l);break;case Ae.Information:this.out.info(l);break;default:this.out.log(l);break}}}}function Ap(){let r="X-SignalR-User-Agent";return pr.isNode&&(r="User-Agent"),[r,eEe($_e,tEe(),rEe(),nEe())]}function eEe(r,i,a,l){let u="Microsoft SignalR/";const f=r.split(".");return u+=`${f[0]}.${f[1]}`,u+=` (${r}; `,i&&i!==""?u+=`${i}; `:u+="Unknown OS; ",u+=`${a}`,l?u+=`; ${l}`:u+="; Unknown Runtime Version",u+=")",u}function tEe(){if(pr.isNode)switch(process.platform){case"win32":return"Windows NT";case"darwin":return"macOS";case"linux":return"Linux";default:return process.platform}else return""}function nEe(){if(pr.isNode)return process.versions.node}function rEe(){return pr.isNode?"NodeJS":"Browser"}function fI(r){return r.stack?r.stack:r.message?r.message:`${r}`}function iEe(){if(typeof globalThis<"u")return globalThis;if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("could not find global")}class oEe extends h0{constructor(i){if(super(),this._logger=i,typeof fetch>"u"||pr.isNode){const a=typeof __webpack_require__=="function"?__non_webpack_require__:require;this._jar=new(a("tough-cookie")).CookieJar,typeof fetch>"u"?this._fetchType=a("node-fetch"):this._fetchType=fetch,this._fetchType=a("fetch-cookie")(this._fetchType,this._jar)}else this._fetchType=fetch.bind(iEe());if(typeof AbortController>"u"){const a=typeof __webpack_require__=="function"?__non_webpack_require__:require;this._abortControllerType=a("abort-controller")}else this._abortControllerType=AbortController}async send(i){if(i.abortSignal&&i.abortSignal.aborted)throw new Ws;if(!i.method)throw new Error("No method defined.");if(!i.url)throw new Error("No url defined.");const a=new this._abortControllerType;let l;i.abortSignal&&(i.abortSignal.onabort=()=>{a.abort(),l=new Ws});let u=null;if(i.timeout){const w=i.timeout;u=setTimeout(()=>{a.abort(),this._logger.log(Ae.Warning,"Timeout from HTTP request."),l=new pO},w)}i.content===""&&(i.content=void 0),i.content&&(i.headers=i.headers||{},ru(i.content)?i.headers["Content-Type"]="application/octet-stream":i.headers["Content-Type"]="text/plain;charset=UTF-8");let f;try{f=await this._fetchType(i.url,{body:i.content,cache:"no-cache",credentials:i.withCredentials===!0?"include":"same-origin",headers:{"X-Requested-With":"XMLHttpRequest",...i.headers},method:i.method,mode:"cors",redirect:"follow",signal:a.signal})}catch(w){throw l||(this._logger.log(Ae.Warning,`Error from HTTP request. ${w}.`),w)}finally{u&&clearTimeout(u),i.abortSignal&&(i.abortSignal.onabort=null)}if(!f.ok){const w=await L5(f,"text");throw new zd(w||f.statusText,f.status)}const v=await L5(f,i.responseType);return new FG(f.status,f.statusText,v)}getCookieString(i){let a="";return pr.isNode&&this._jar&&this._jar.getCookies(i,(l,u)=>a=u.join("; ")),a}}function L5(r,i){let a;switch(i){case"arraybuffer":a=r.arrayBuffer();break;case"text":a=r.text();break;case"blob":case"document":case"json":throw new Error(`${i} is not supported.`);default:a=r.text();break}return a}class sEe extends h0{constructor(i){super(),this._logger=i}send(i){return i.abortSignal&&i.abortSignal.aborted?Promise.reject(new Ws):i.method?i.url?new Promise((a,l)=>{const u=new XMLHttpRequest;u.open(i.method,i.url,!0),u.withCredentials=i.withCredentials===void 0?!0:i.withCredentials,u.setRequestHeader("X-Requested-With","XMLHttpRequest"),i.content===""&&(i.content=void 0),i.content&&(ru(i.content)?u.setRequestHeader("Content-Type","application/octet-stream"):u.setRequestHeader("Content-Type","text/plain;charset=UTF-8"));const f=i.headers;f&&Object.keys(f).forEach(_=>{u.setRequestHeader(_,f[_])}),i.responseType&&(u.responseType=i.responseType),i.abortSignal&&(i.abortSignal.onabort=()=>{u.abort(),l(new Ws)}),i.timeout&&(u.timeout=i.timeout),u.onload=()=>{i.abortSignal&&(i.abortSignal.onabort=null),u.status>=200&&u.status<300?a(new FG(u.status,u.statusText,u.response||u.responseText)):l(new zd(u.response||u.responseText||u.statusText,u.status))},u.onerror=()=>{this._logger.log(Ae.Warning,`Error from HTTP request. ${u.status}: ${u.statusText}.`),l(new zd(u.statusText,u.status))},u.ontimeout=()=>{this._logger.log(Ae.Warning,"Timeout from HTTP request."),l(new pO)},u.send(i.content)}):Promise.reject(new Error("No url defined.")):Promise.reject(new Error("No method defined."))}}class aEe extends h0{constructor(i){if(super(),typeof fetch<"u"||pr.isNode)this._httpClient=new oEe(i);else if(typeof XMLHttpRequest<"u")this._httpClient=new sEe(i);else throw new Error("No usable HttpClient found.")}send(i){return i.abortSignal&&i.abortSignal.aborted?Promise.reject(new Ws):i.method?i.url?this._httpClient.send(i):Promise.reject(new Error("No url defined.")):Promise.reject(new Error("No method defined."))}getCookieString(i){return this._httpClient.getCookieString(i)}}class No{static write(i){return`${i}${No.RecordSeparator}`}static parse(i){if(i[i.length-1]!==No.RecordSeparator)throw new Error("Message is incomplete.");const a=i.split(No.RecordSeparator);return a.pop(),a}}No.RecordSeparatorCode=30;No.RecordSeparator=String.fromCharCode(No.RecordSeparatorCode);class cEe{writeHandshakeRequest(i){return No.write(JSON.stringify(i))}parseHandshakeResponse(i){let a,l;if(ru(i)){const v=new Uint8Array(i),w=v.indexOf(No.RecordSeparatorCode);if(w===-1)throw new Error("Message is incomplete.");const C=w+1;a=String.fromCharCode.apply(null,Array.prototype.slice.call(v.slice(0,C))),l=v.byteLength>C?v.slice(C).buffer:null}else{const v=i,w=v.indexOf(No.RecordSeparator);if(w===-1)throw new Error("Message is incomplete.");const C=w+1;a=v.substring(0,C),l=v.length>C?v.substring(C):null}const u=No.parse(a),f=JSON.parse(u[0]);if(f.type)throw new Error("Expected a handshake response from the server.");return[l,f]}}var Ft;(function(r){r[r.Invocation=1]="Invocation",r[r.StreamItem=2]="StreamItem",r[r.Completion=3]="Completion",r[r.StreamInvocation=4]="StreamInvocation",r[r.CancelInvocation=5]="CancelInvocation",r[r.Ping=6]="Ping",r[r.Close=7]="Close",r[r.Ack=8]="Ack",r[r.Sequence=9]="Sequence"})(Ft||(Ft={}));class lEe{constructor(){this.observers=[]}next(i){for(const a of this.observers)a.next(i)}error(i){for(const a of this.observers)a.error&&a.error(i)}complete(){for(const i of this.observers)i.complete&&i.complete()}subscribe(i){return this.observers.push(i),new Z_e(this,i)}}class dEe{constructor(i,a,l){this._bufferSize=1e5,this._messages=[],this._totalMessageCount=0,this._waitForSequenceMessage=!1,this._nextReceivingSequenceId=1,this._latestReceivedSequenceId=0,this._bufferedByteCount=0,this._reconnectInProgress=!1,this._protocol=i,this._connection=a,this._bufferSize=l}async _send(i){const a=this._protocol.writeMessage(i);let l=Promise.resolve();if(this._isInvocationMessage(i)){this._totalMessageCount++;let u=()=>{},f=()=>{};ru(a)?this._bufferedByteCount+=a.byteLength:this._bufferedByteCount+=a.length,this._bufferedByteCount>=this._bufferSize&&(l=new Promise((_,v)=>{u=_,f=v})),this._messages.push(new uEe(a,this._totalMessageCount,u,f))}try{this._reconnectInProgress||await this._connection.send(a)}catch{this._disconnected()}await l}_ack(i){let a=-1;for(let l=0;l<this._messages.length;l++){const u=this._messages[l];if(u._id<=i.sequenceId)a=l,ru(u._message)?this._bufferedByteCount-=u._message.byteLength:this._bufferedByteCount-=u._message.length,u._resolver();else if(this._bufferedByteCount<this._bufferSize)u._resolver();else break}a!==-1&&(this._messages=this._messages.slice(a+1))}_shouldProcessMessage(i){if(this._waitForSequenceMessage)return i.type!==Ft.Sequence?!1:(this._waitForSequenceMessage=!1,!0);if(!this._isInvocationMessage(i))return!0;const a=this._nextReceivingSequenceId;return this._nextReceivingSequenceId++,a<=this._latestReceivedSequenceId?(a===this._latestReceivedSequenceId&&this._ackTimer(),!1):(this._latestReceivedSequenceId=a,this._ackTimer(),!0)}_resetSequence(i){if(i.sequenceId>this._nextReceivingSequenceId){this._connection.stop(new Error("Sequence ID greater than amount of messages we've received."));return}this._nextReceivingSequenceId=i.sequenceId}_disconnected(){this._reconnectInProgress=!0,this._waitForSequenceMessage=!0}async _resend(){const i=this._messages.length!==0?this._messages[0]._id:this._totalMessageCount+1;await this._connection.send(this._protocol.writeMessage({type:Ft.Sequence,sequenceId:i}));const a=this._messages;for(const l of a)await this._connection.send(l._message);this._reconnectInProgress=!1}_dispose(i){i??(i=new Error("Unable to reconnect to server."));for(const a of this._messages)a._rejector(i)}_isInvocationMessage(i){switch(i.type){case Ft.Invocation:case Ft.StreamItem:case Ft.Completion:case Ft.StreamInvocation:case Ft.CancelInvocation:return!0;case Ft.Close:case Ft.Sequence:case Ft.Ping:case Ft.Ack:return!1}}_ackTimer(){this._ackTimerHandle===void 0&&(this._ackTimerHandle=setTimeout(async()=>{try{this._reconnectInProgress||await this._connection.send(this._protocol.writeMessage({type:Ft.Ack,sequenceId:this._latestReceivedSequenceId}))}catch{}clearTimeout(this._ackTimerHandle),this._ackTimerHandle=void 0},1e3))}}class uEe{constructor(i,a,l,u){this._message=i,this._id=a,this._resolver=l,this._rejector=u}}const hEe=30*1e3,pEe=15*1e3,fEe=1e5;var er;(function(r){r.Disconnected="Disconnected",r.Connecting="Connecting",r.Connected="Connected",r.Disconnecting="Disconnecting",r.Reconnecting="Reconnecting"})(er||(er={}));class fO{static create(i,a,l,u,f,_,v){return new fO(i,a,l,u,f,_,v)}constructor(i,a,l,u,f,_,v){this._nextKeepAlive=0,this._freezeEventListener=()=>{this._logger.log(Ae.Warning,"The page is being frozen, this will likely lead to the connection being closed and messages being lost. For more information see the docs at https://learn.microsoft.com/aspnet/core/signalr/javascript-client#bsleep")},Vr.isRequired(i,"connection"),Vr.isRequired(a,"logger"),Vr.isRequired(l,"protocol"),this.serverTimeoutInMilliseconds=f??hEe,this.keepAliveIntervalInMilliseconds=_??pEe,this._statefulReconnectBufferSize=v??fEe,this._logger=a,this._protocol=l,this.connection=i,this._reconnectPolicy=u,this._handshakeProtocol=new cEe,this.connection.onreceive=w=>this._processIncomingData(w),this.connection.onclose=w=>this._connectionClosed(w),this._callbacks={},this._methods={},this._closedCallbacks=[],this._reconnectingCallbacks=[],this._reconnectedCallbacks=[],this._invocationId=0,this._receivedHandshakeResponse=!1,this._connectionState=er.Disconnected,this._connectionStarted=!1,this._cachedPingMessage=this._protocol.writeMessage({type:Ft.Ping})}get state(){return this._connectionState}get connectionId(){return this.connection&&this.connection.connectionId||null}get baseUrl(){return this.connection.baseUrl||""}set baseUrl(i){if(this._connectionState!==er.Disconnected&&this._connectionState!==er.Reconnecting)throw new Error("The HubConnection must be in the Disconnected or Reconnecting state to change the url.");if(!i)throw new Error("The HubConnection url must be a valid url.");this.connection.baseUrl=i}start(){return this._startPromise=this._startWithStateTransitions(),this._startPromise}async _startWithStateTransitions(){if(this._connectionState!==er.Disconnected)return Promise.reject(new Error("Cannot start a HubConnection that is not in the 'Disconnected' state."));this._connectionState=er.Connecting,this._logger.log(Ae.Debug,"Starting HubConnection.");try{await this._startInternal(),pr.isBrowser&&window.document.addEventListener("freeze",this._freezeEventListener),this._connectionState=er.Connected,this._connectionStarted=!0,this._logger.log(Ae.Debug,"HubConnection connected successfully.")}catch(i){return this._connectionState=er.Disconnected,this._logger.log(Ae.Debug,`HubConnection failed to start successfully because of error '${i}'.`),Promise.reject(i)}}async _startInternal(){this._stopDuringStartError=void 0,this._receivedHandshakeResponse=!1;const i=new Promise((a,l)=>{this._handshakeResolver=a,this._handshakeRejecter=l});await this.connection.start(this._protocol.transferFormat);try{let a=this._protocol.version;this.connection.features.reconnect||(a=1);const l={protocol:this._protocol.name,version:a};if(this._logger.log(Ae.Debug,"Sending handshake request."),await this._sendMessage(this._handshakeProtocol.writeHandshakeRequest(l)),this._logger.log(Ae.Information,`Using HubProtocol '${this._protocol.name}'.`),this._cleanupTimeout(),this._resetTimeoutPeriod(),this._resetKeepAliveInterval(),await i,this._stopDuringStartError)throw this._stopDuringStartError;(this.connection.features.reconnect||!1)&&(this._messageBuffer=new dEe(this._protocol,this.connection,this._statefulReconnectBufferSize),this.connection.features.disconnected=this._messageBuffer._disconnected.bind(this._messageBuffer),this.connection.features.resend=()=>{if(this._messageBuffer)return this._messageBuffer._resend()}),this.connection.features.inherentKeepAlive||await this._sendMessage(this._cachedPingMessage)}catch(a){throw this._logger.log(Ae.Debug,`Hub handshake failed with error '${a}' during start(). Stopping HubConnection.`),this._cleanupTimeout(),this._cleanupPingTimer(),await this.connection.stop(a),a}}async stop(){const i=this._startPromise;this.connection.features.reconnect=!1,this._stopPromise=this._stopInternal(),await this._stopPromise;try{await i}catch{}}_stopInternal(i){if(this._connectionState===er.Disconnected)return this._logger.log(Ae.Debug,`Call to HubConnection.stop(${i}) ignored because it is already in the disconnected state.`),Promise.resolve();if(this._connectionState===er.Disconnecting)return this._logger.log(Ae.Debug,`Call to HttpConnection.stop(${i}) ignored because the connection is already in the disconnecting state.`),this._stopPromise;const a=this._connectionState;return this._connectionState=er.Disconnecting,this._logger.log(Ae.Debug,"Stopping HubConnection."),this._reconnectDelayHandle?(this._logger.log(Ae.Debug,"Connection stopped during reconnect delay. Done reconnecting."),clearTimeout(this._reconnectDelayHandle),this._reconnectDelayHandle=void 0,this._completeClose(),Promise.resolve()):(a===er.Connected&&this._sendCloseMessage(),this._cleanupTimeout(),this._cleanupPingTimer(),this._stopDuringStartError=i||new Ws("The connection was stopped before the hub handshake could complete."),this.connection.stop(i))}async _sendCloseMessage(){try{await this._sendWithProtocol(this._createCloseMessage())}catch{}}stream(i,...a){const[l,u]=this._replaceStreamingParams(a),f=this._createStreamInvocation(i,a,u);let _;const v=new lEe;return v.cancelCallback=()=>{const w=this._createCancelInvocation(f.invocationId);return delete this._callbacks[f.invocationId],_.then(()=>this._sendWithProtocol(w))},this._callbacks[f.invocationId]=(w,C)=>{if(C){v.error(C);return}else w&&(w.type===Ft.Completion?w.error?v.error(new Error(w.error)):v.complete():v.next(w.item))},_=this._sendWithProtocol(f).catch(w=>{v.error(w),delete this._callbacks[f.invocationId]}),this._launchStreams(l,_),v}_sendMessage(i){return this._resetKeepAliveInterval(),this.connection.send(i)}_sendWithProtocol(i){return this._messageBuffer?this._messageBuffer._send(i):this._sendMessage(this._protocol.writeMessage(i))}send(i,...a){const[l,u]=this._replaceStreamingParams(a),f=this._sendWithProtocol(this._createInvocation(i,a,!0,u));return this._launchStreams(l,f),f}invoke(i,...a){const[l,u]=this._replaceStreamingParams(a),f=this._createInvocation(i,a,!1,u);return new Promise((v,w)=>{this._callbacks[f.invocationId]=(N,D)=>{if(D){w(D);return}else N&&(N.type===Ft.Completion?N.error?w(new Error(N.error)):v(N.result):w(new Error(`Unexpected message type: ${N.type}`)))};const C=this._sendWithProtocol(f).catch(N=>{w(N),delete this._callbacks[f.invocationId]});this._launchStreams(l,C)})}on(i,a){!i||!a||(i=i.toLowerCase(),this._methods[i]||(this._methods[i]=[]),this._methods[i].indexOf(a)===-1&&this._methods[i].push(a))}off(i,a){if(!i)return;i=i.toLowerCase();const l=this._methods[i];if(l)if(a){const u=l.indexOf(a);u!==-1&&(l.splice(u,1),l.length===0&&delete this._methods[i])}else delete this._methods[i]}onclose(i){i&&this._closedCallbacks.push(i)}onreconnecting(i){i&&this._reconnectingCallbacks.push(i)}onreconnected(i){i&&this._reconnectedCallbacks.push(i)}_processIncomingData(i){if(this._cleanupTimeout(),this._receivedHandshakeResponse||(i=this._processHandshakeResponse(i),this._receivedHandshakeResponse=!0),i){const a=this._protocol.parseMessages(i,this._logger);for(const l of a)if(!(this._messageBuffer&&!this._messageBuffer._shouldProcessMessage(l)))switch(l.type){case Ft.Invocation:this._invokeClientMethod(l).catch(u=>{this._logger.log(Ae.Error,`Invoke client method threw error: ${fI(u)}`)});break;case Ft.StreamItem:case Ft.Completion:{const u=this._callbacks[l.invocationId];if(u){l.type===Ft.Completion&&delete this._callbacks[l.invocationId];try{u(l)}catch(f){this._logger.log(Ae.Error,`Stream callback threw error: ${fI(f)}`)}}break}case Ft.Ping:break;case Ft.Close:{this._logger.log(Ae.Information,"Close message received from server.");const u=l.error?new Error("Server returned an error on close: "+l.error):void 0;l.allowReconnect===!0?this.connection.stop(u):this._stopPromise=this._stopInternal(u);break}case Ft.Ack:this._messageBuffer&&this._messageBuffer._ack(l);break;case Ft.Sequence:this._messageBuffer&&this._messageBuffer._resetSequence(l);break;default:this._logger.log(Ae.Warning,`Invalid message type: ${l.type}.`);break}}this._resetTimeoutPeriod()}_processHandshakeResponse(i){let a,l;try{[l,a]=this._handshakeProtocol.parseHandshakeResponse(i)}catch(u){const f="Error parsing handshake response: "+u;this._logger.log(Ae.Error,f);const _=new Error(f);throw this._handshakeRejecter(_),_}if(a.error){const u="Server returned handshake error: "+a.error;this._logger.log(Ae.Error,u);const f=new Error(u);throw this._handshakeRejecter(f),f}else this._logger.log(Ae.Debug,"Server handshake complete.");return this._handshakeResolver(),l}_resetKeepAliveInterval(){this.connection.features.inherentKeepAlive||(this._nextKeepAlive=new Date().getTime()+this.keepAliveIntervalInMilliseconds,this._cleanupPingTimer())}_resetTimeoutPeriod(){if((!this.connection.features||!this.connection.features.inherentKeepAlive)&&(this._timeoutHandle=setTimeout(()=>this.serverTimeout(),this.serverTimeoutInMilliseconds),this._pingServerHandle===void 0)){let i=this._nextKeepAlive-new Date().getTime();i<0&&(i=0),this._pingServerHandle=setTimeout(async()=>{if(this._connectionState===er.Connected)try{await this._sendMessage(this._cachedPingMessage)}catch{this._cleanupPingTimer()}},i)}}serverTimeout(){this.connection.stop(new Error("Server timeout elapsed without receiving a message from the server."))}async _invokeClientMethod(i){const a=i.target.toLowerCase(),l=this._methods[a];if(!l){this._logger.log(Ae.Warning,`No client method with the name '${a}' found.`),i.invocationId&&(this._logger.log(Ae.Warning,`No result given for '${a}' method and invocation ID '${i.invocationId}'.`),await this._sendWithProtocol(this._createCompletionMessage(i.invocationId,"Client didn't provide a result.",null)));return}const u=l.slice(),f=!!i.invocationId;let _,v,w;for(const C of u)try{const N=_;_=await C.apply(this,i.arguments),f&&_&&N&&(this._logger.log(Ae.Error,`Multiple results provided for '${a}'. Sending error to server.`),w=this._createCompletionMessage(i.invocationId,"Client provided multiple results.",null)),v=void 0}catch(N){v=N,this._logger.log(Ae.Error,`A callback for the method '${a}' threw error '${N}'.`)}w?await this._sendWithProtocol(w):f?(v?w=this._createCompletionMessage(i.invocationId,`${v}`,null):_!==void 0?w=this._createCompletionMessage(i.invocationId,null,_):(this._logger.log(Ae.Warning,`No result given for '${a}' method and invocation ID '${i.invocationId}'.`),w=this._createCompletionMessage(i.invocationId,"Client didn't provide a result.",null)),await this._sendWithProtocol(w)):_&&this._logger.log(Ae.Error,`Result given for '${a}' method but server is not expecting a result.`)}_connectionClosed(i){this._logger.log(Ae.Debug,`HubConnection.connectionClosed(${i}) called while in state ${this._connectionState}.`),this._stopDuringStartError=this._stopDuringStartError||i||new Ws("The underlying connection was closed before the hub handshake could complete."),this._handshakeResolver&&this._handshakeResolver(),this._cancelCallbacksWithError(i||new Error("Invocation canceled due to the underlying connection being closed.")),this._cleanupTimeout(),this._cleanupPingTimer(),this._connectionState===er.Disconnecting?this._completeClose(i):this._connectionState===er.Connected&&this._reconnectPolicy?this._reconnect(i):this._connectionState===er.Connected&&this._completeClose(i)}_completeClose(i){if(this._connectionStarted){this._connectionState=er.Disconnected,this._connectionStarted=!1,this._messageBuffer&&(this._messageBuffer._dispose(i??new Error("Connection closed.")),this._messageBuffer=void 0),pr.isBrowser&&window.document.removeEventListener("freeze",this._freezeEventListener);try{this._closedCallbacks.forEach(a=>a.apply(this,[i]))}catch(a){this._logger.log(Ae.Error,`An onclose callback called with error '${i}' threw error '${a}'.`)}}}async _reconnect(i){const a=Date.now();let l=0,u=i!==void 0?i:new Error("Attempting to reconnect due to a unknown error."),f=this._getNextRetryDelay(l++,0,u);if(f===null){this._logger.log(Ae.Debug,"Connection not reconnecting because the IRetryPolicy returned null on the first reconnect attempt."),this._completeClose(i);return}if(this._connectionState=er.Reconnecting,i?this._logger.log(Ae.Information,`Connection reconnecting because of error '${i}'.`):this._logger.log(Ae.Information,"Connection reconnecting."),this._reconnectingCallbacks.length!==0){try{this._reconnectingCallbacks.forEach(_=>_.apply(this,[i]))}catch(_){this._logger.log(Ae.Error,`An onreconnecting callback called with error '${i}' threw error '${_}'.`)}if(this._connectionState!==er.Reconnecting){this._logger.log(Ae.Debug,"Connection left the reconnecting state in onreconnecting callback. Done reconnecting.");return}}for(;f!==null;){if(this._logger.log(Ae.Information,`Reconnect attempt number ${l} will start in ${f} ms.`),await new Promise(_=>{this._reconnectDelayHandle=setTimeout(_,f)}),this._reconnectDelayHandle=void 0,this._connectionState!==er.Reconnecting){this._logger.log(Ae.Debug,"Connection left the reconnecting state during reconnect delay. Done reconnecting.");return}try{if(await this._startInternal(),this._connectionState=er.Connected,this._logger.log(Ae.Information,"HubConnection reconnected successfully."),this._reconnectedCallbacks.length!==0)try{this._reconnectedCallbacks.forEach(_=>_.apply(this,[this.connection.connectionId]))}catch(_){this._logger.log(Ae.Error,`An onreconnected callback called with connectionId '${this.connection.connectionId}; threw error '${_}'.`)}return}catch(_){if(this._logger.log(Ae.Information,`Reconnect attempt failed because of error '${_}'.`),this._connectionState!==er.Reconnecting){this._logger.log(Ae.Debug,`Connection moved to the '${this._connectionState}' from the reconnecting state during reconnect attempt. Done reconnecting.`),this._connectionState===er.Disconnecting&&this._completeClose();return}u=_ instanceof Error?_:new Error(_.toString()),f=this._getNextRetryDelay(l++,Date.now()-a,u)}}this._logger.log(Ae.Information,`Reconnect retries have been exhausted after ${Date.now()-a} ms and ${l} failed attempts. Connection disconnecting.`),this._completeClose()}_getNextRetryDelay(i,a,l){try{return this._reconnectPolicy.nextRetryDelayInMilliseconds({elapsedMilliseconds:a,previousRetryCount:i,retryReason:l})}catch(u){return this._logger.log(Ae.Error,`IRetryPolicy.nextRetryDelayInMilliseconds(${i}, ${a}) threw error '${u}'.`),null}}_cancelCallbacksWithError(i){const a=this._callbacks;this._callbacks={},Object.keys(a).forEach(l=>{const u=a[l];try{u(null,i)}catch(f){this._logger.log(Ae.Error,`Stream 'error' callback called with '${i}' threw error: ${fI(f)}`)}})}_cleanupPingTimer(){this._pingServerHandle&&(clearTimeout(this._pingServerHandle),this._pingServerHandle=void 0)}_cleanupTimeout(){this._timeoutHandle&&clearTimeout(this._timeoutHandle)}_createInvocation(i,a,l,u){if(l)return u.length!==0?{arguments:a,streamIds:u,target:i,type:Ft.Invocation}:{arguments:a,target:i,type:Ft.Invocation};{const f=this._invocationId;return this._invocationId++,u.length!==0?{arguments:a,invocationId:f.toString(),streamIds:u,target:i,type:Ft.Invocation}:{arguments:a,invocationId:f.toString(),target:i,type:Ft.Invocation}}}_launchStreams(i,a){if(i.length!==0){a||(a=Promise.resolve());for(const l in i)i[l].subscribe({complete:()=>{a=a.then(()=>this._sendWithProtocol(this._createCompletionMessage(l)))},error:u=>{let f;u instanceof Error?f=u.message:u&&u.toString?f=u.toString():f="Unknown error",a=a.then(()=>this._sendWithProtocol(this._createCompletionMessage(l,f)))},next:u=>{a=a.then(()=>this._sendWithProtocol(this._createStreamItemMessage(l,u)))}})}}_replaceStreamingParams(i){const a=[],l=[];for(let u=0;u<i.length;u++){const f=i[u];if(this._isObservable(f)){const _=this._invocationId;this._invocationId++,a[_]=f,l.push(_.toString()),i.splice(u,1)}}return[a,l]}_isObservable(i){return i&&i.subscribe&&typeof i.subscribe=="function"}_createStreamInvocation(i,a,l){const u=this._invocationId;return this._invocationId++,l.length!==0?{arguments:a,invocationId:u.toString(),streamIds:l,target:i,type:Ft.StreamInvocation}:{arguments:a,invocationId:u.toString(),target:i,type:Ft.StreamInvocation}}_createCancelInvocation(i){return{invocationId:i,type:Ft.CancelInvocation}}_createStreamItemMessage(i,a){return{invocationId:i,item:a,type:Ft.StreamItem}}_createCompletionMessage(i,a,l){return a?{error:a,invocationId:i,type:Ft.Completion}:{invocationId:i,result:l,type:Ft.Completion}}_createCloseMessage(){return{type:Ft.Close}}}const mEe=[0,2e3,1e4,3e4,null];class M5{constructor(i){this._retryDelays=i!==void 0?[...i,null]:mEe}nextRetryDelayInMilliseconds(i){return this._retryDelays[i.previousRetryCount]}}class Kd{}Kd.Authorization="Authorization";Kd.Cookie="Cookie";class gEe extends h0{constructor(i,a){super(),this._innerClient=i,this._accessTokenFactory=a}async send(i){let a=!0;this._accessTokenFactory&&(!this._accessToken||i.url&&i.url.indexOf("/negotiate?")>0)&&(a=!1,this._accessToken=await this._accessTokenFactory()),this._setAuthorizationHeader(i);const l=await this._innerClient.send(i);return a&&l.statusCode===401&&this._accessTokenFactory?(this._accessToken=await this._accessTokenFactory(),this._setAuthorizationHeader(i),await this._innerClient.send(i)):l}_setAuthorizationHeader(i){i.headers||(i.headers={}),this._accessToken?i.headers[Kd.Authorization]=`Bearer ${this._accessToken}`:this._accessTokenFactory&&i.headers[Kd.Authorization]&&delete i.headers[Kd.Authorization]}getCookieString(i){return this._innerClient.getCookieString(i)}}var jr;(function(r){r[r.None=0]="None",r[r.WebSockets=1]="WebSockets",r[r.ServerSentEvents=2]="ServerSentEvents",r[r.LongPolling=4]="LongPolling"})(jr||(jr={}));var Ii;(function(r){r[r.Text=1]="Text",r[r.Binary=2]="Binary"})(Ii||(Ii={}));let _Ee=class{constructor(){this._isAborted=!1,this.onabort=null}abort(){this._isAborted||(this._isAborted=!0,this.onabort&&this.onabort())}get signal(){return this}get aborted(){return this._isAborted}};class U5{get pollAborted(){return this._pollAbort.aborted}constructor(i,a,l){this._httpClient=i,this._logger=a,this._pollAbort=new _Ee,this._options=l,this._running=!1,this.onreceive=null,this.onclose=null}async connect(i,a){if(Vr.isRequired(i,"url"),Vr.isRequired(a,"transferFormat"),Vr.isIn(a,Ii,"transferFormat"),this._url=i,this._logger.log(Ae.Trace,"(LongPolling transport) Connecting."),a===Ii.Binary&&typeof XMLHttpRequest<"u"&&typeof new XMLHttpRequest().responseType!="string")throw new Error("Binary protocols over XmlHttpRequest not implementing advanced features are not supported.");const[l,u]=Ap(),f={[l]:u,...this._options.headers},_={abortSignal:this._pollAbort.signal,headers:f,timeout:1e5,withCredentials:this._options.withCredentials};a===Ii.Binary&&(_.responseType="arraybuffer");const v=`${i}&_=${Date.now()}`;this._logger.log(Ae.Trace,`(LongPolling transport) polling: ${v}.`);const w=await this._httpClient.get(v,_);w.statusCode!==200?(this._logger.log(Ae.Error,`(LongPolling transport) Unexpected response code: ${w.statusCode}.`),this._closeError=new zd(w.statusText||"",w.statusCode),this._running=!1):this._running=!0,this._receiving=this._poll(this._url,_)}async _poll(i,a){try{for(;this._running;)try{const l=`${i}&_=${Date.now()}`;this._logger.log(Ae.Trace,`(LongPolling transport) polling: ${l}.`);const u=await this._httpClient.get(l,a);u.statusCode===204?(this._logger.log(Ae.Information,"(LongPolling transport) Poll terminated by server."),this._running=!1):u.statusCode!==200?(this._logger.log(Ae.Error,`(LongPolling transport) Unexpected response code: ${u.statusCode}.`),this._closeError=new zd(u.statusText||"",u.statusCode),this._running=!1):u.content?(this._logger.log(Ae.Trace,`(LongPolling transport) data received. ${Ag(u.content,this._options.logMessageContent)}.`),this.onreceive&&this.onreceive(u.content)):this._logger.log(Ae.Trace,"(LongPolling transport) Poll timed out, reissuing.")}catch(l){this._running?l instanceof pO?this._logger.log(Ae.Trace,"(LongPolling transport) Poll timed out, reissuing."):(this._closeError=l,this._running=!1):this._logger.log(Ae.Trace,`(LongPolling transport) Poll errored after shutdown: ${l.message}`)}}finally{this._logger.log(Ae.Trace,"(LongPolling transport) Polling complete."),this.pollAborted||this._raiseOnClose()}}async send(i){return this._running?BG(this._logger,"LongPolling",this._httpClient,this._url,i,this._options):Promise.reject(new Error("Cannot send until the transport is connected"))}async stop(){this._logger.log(Ae.Trace,"(LongPolling transport) Stopping polling."),this._running=!1,this._pollAbort.abort();try{await this._receiving,this._logger.log(Ae.Trace,`(LongPolling transport) sending DELETE request to ${this._url}.`);const i={},[a,l]=Ap();i[a]=l;const u={headers:{...i,...this._options.headers},timeout:this._options.timeout,withCredentials:this._options.withCredentials};let f;try{await this._httpClient.delete(this._url,u)}catch(_){f=_}f?f instanceof zd&&(f.statusCode===404?this._logger.log(Ae.Trace,"(LongPolling transport) A 404 response was returned from sending a DELETE request."):this._logger.log(Ae.Trace,`(LongPolling transport) Error sending a DELETE request: ${f}`)):this._logger.log(Ae.Trace,"(LongPolling transport) DELETE request accepted.")}finally{this._logger.log(Ae.Trace,"(LongPolling transport) Stop finished."),this._raiseOnClose()}}_raiseOnClose(){if(this.onclose){let i="(LongPolling transport) Firing onclose event.";this._closeError&&(i+=" Error: "+this._closeError),this._logger.log(Ae.Trace,i),this.onclose(this._closeError)}}}class EEe{constructor(i,a,l,u){this._httpClient=i,this._accessToken=a,this._logger=l,this._options=u,this.onreceive=null,this.onclose=null}async connect(i,a){return Vr.isRequired(i,"url"),Vr.isRequired(a,"transferFormat"),Vr.isIn(a,Ii,"transferFormat"),this._logger.log(Ae.Trace,"(SSE transport) Connecting."),this._url=i,this._accessToken&&(i+=(i.indexOf("?")<0?"?":"&")+`access_token=${encodeURIComponent(this._accessToken)}`),new Promise((l,u)=>{let f=!1;if(a!==Ii.Text){u(new Error("The Server-Sent Events transport only supports the 'Text' transfer format"));return}let _;if(pr.isBrowser||pr.isWebWorker)_=new this._options.EventSource(i,{withCredentials:this._options.withCredentials});else{const v=this._httpClient.getCookieString(i),w={};w.Cookie=v;const[C,N]=Ap();w[C]=N,_=new this._options.EventSource(i,{withCredentials:this._options.withCredentials,headers:{...w,...this._options.headers}})}try{_.onmessage=v=>{if(this.onreceive)try{this._logger.log(Ae.Trace,`(SSE transport) data received. ${Ag(v.data,this._options.logMessageContent)}.`),this.onreceive(v.data)}catch(w){this._close(w);return}},_.onerror=v=>{f?this._close():u(new Error("EventSource failed to connect. The connection could not be found on the server, either the connection ID is not present on the server, or a proxy is refusing/buffering the connection. If you have multiple servers check that sticky sessions are enabled."))},_.onopen=()=>{this._logger.log(Ae.Information,`SSE connected to ${this._url}`),this._eventSource=_,f=!0,l()}}catch(v){u(v);return}})}async send(i){return this._eventSource?BG(this._logger,"SSE",this._httpClient,this._url,i,this._options):Promise.reject(new Error("Cannot send until the transport is connected"))}stop(){return this._close(),Promise.resolve()}_close(i){this._eventSource&&(this._eventSource.close(),this._eventSource=void 0,this.onclose&&this.onclose(i))}}class vEe{constructor(i,a,l,u,f,_){this._logger=l,this._accessTokenFactory=a,this._logMessageContent=u,this._webSocketConstructor=f,this._httpClient=i,this.onreceive=null,this.onclose=null,this._headers=_}async connect(i,a){Vr.isRequired(i,"url"),Vr.isRequired(a,"transferFormat"),Vr.isIn(a,Ii,"transferFormat"),this._logger.log(Ae.Trace,"(WebSockets transport) Connecting.");let l;return this._accessTokenFactory&&(l=await this._accessTokenFactory()),new Promise((u,f)=>{i=i.replace(/^http/,"ws");let _;const v=this._httpClient.getCookieString(i);let w=!1;if(pr.isNode||pr.isReactNative){const C={},[N,D]=Ap();C[N]=D,l&&(C[Kd.Authorization]=`Bearer ${l}`),v&&(C[Kd.Cookie]=v),_=new this._webSocketConstructor(i,void 0,{headers:{...C,...this._headers}})}else l&&(i+=(i.indexOf("?")<0?"?":"&")+`access_token=${encodeURIComponent(l)}`);_||(_=new this._webSocketConstructor(i)),a===Ii.Binary&&(_.binaryType="arraybuffer"),_.onopen=C=>{this._logger.log(Ae.Information,`WebSocket connected to ${i}.`),this._webSocket=_,w=!0,u()},_.onerror=C=>{let N=null;typeof ErrorEvent<"u"&&C instanceof ErrorEvent?N=C.error:N="There was an error with the transport",this._logger.log(Ae.Information,`(WebSockets transport) ${N}.`)},_.onmessage=C=>{if(this._logger.log(Ae.Trace,`(WebSockets transport) data received. ${Ag(C.data,this._logMessageContent)}.`),this.onreceive)try{this.onreceive(C.data)}catch(N){this._close(N);return}},_.onclose=C=>{if(w)this._close(C);else{let N=null;typeof ErrorEvent<"u"&&C instanceof ErrorEvent?N=C.error:N="WebSocket failed to connect. The connection could not be found on the server, either the endpoint may not be a SignalR endpoint, the connection ID is not present on the server, or there is a proxy blocking WebSockets. If you have multiple servers check that sticky sessions are enabled.",f(new Error(N))}}})}send(i){return this._webSocket&&this._webSocket.readyState===this._webSocketConstructor.OPEN?(this._logger.log(Ae.Trace,`(WebSockets transport) sending data. ${Ag(i,this._logMessageContent)}.`),this._webSocket.send(i),Promise.resolve()):Promise.reject("WebSocket is not in the OPEN state")}stop(){return this._webSocket&&this._close(void 0),Promise.resolve()}_close(i){this._webSocket&&(this._webSocket.onclose=()=>{},this._webSocket.onmessage=()=>{},this._webSocket.onerror=()=>{},this._webSocket.close(),this._webSocket=void 0),this._logger.log(Ae.Trace,"(WebSockets transport) socket closed."),this.onclose&&(this._isCloseEvent(i)&&(i.wasClean===!1||i.code!==1e3)?this.onclose(new Error(`WebSocket closed with status code: ${i.code} (${i.reason||"no reason given"}).`)):i instanceof Error?this.onclose(i):this.onclose())}_isCloseEvent(i){return i&&typeof i.wasClean=="boolean"&&typeof i.code=="number"}}const j5=100;class yEe{constructor(i,a={}){if(this._stopPromiseResolver=()=>{},this.features={},this._negotiateVersion=1,Vr.isRequired(i,"url"),this._logger=Q_e(a.logger),this.baseUrl=this._resolveUrl(i),a=a||{},a.logMessageContent=a.logMessageContent===void 0?!1:a.logMessageContent,typeof a.withCredentials=="boolean"||a.withCredentials===void 0)a.withCredentials=a.withCredentials===void 0?!0:a.withCredentials;else throw new Error("withCredentials option was not a 'boolean' or 'undefined' value");a.timeout=a.timeout===void 0?100*1e3:a.timeout;let l=null,u=null;if(pr.isNode&&typeof require<"u"){const f=typeof __webpack_require__=="function"?__non_webpack_require__:require;l=f("ws"),u=f("eventsource")}!pr.isNode&&typeof WebSocket<"u"&&!a.WebSocket?a.WebSocket=WebSocket:pr.isNode&&!a.WebSocket&&l&&(a.WebSocket=l),!pr.isNode&&typeof EventSource<"u"&&!a.EventSource?a.EventSource=EventSource:pr.isNode&&!a.EventSource&&typeof u<"u"&&(a.EventSource=u),this._httpClient=new gEe(a.httpClient||new aEe(this._logger),a.accessTokenFactory),this._connectionState="Disconnected",this._connectionStarted=!1,this._options=a,this.onreceive=null,this.onclose=null}async start(i){if(i=i||Ii.Binary,Vr.isIn(i,Ii,"transferFormat"),this._logger.log(Ae.Debug,`Starting connection with transfer format '${Ii[i]}'.`),this._connectionState!=="Disconnected")return Promise.reject(new Error("Cannot start an HttpConnection that is not in the 'Disconnected' state."));if(this._connectionState="Connecting",this._startInternalPromise=this._startInternal(i),await this._startInternalPromise,this._connectionState==="Disconnecting"){const a="Failed to start the HttpConnection before stop() was called.";return this._logger.log(Ae.Error,a),await this._stopPromise,Promise.reject(new Ws(a))}else if(this._connectionState!=="Connected"){const a="HttpConnection.startInternal completed gracefully but didn't enter the connection into the connected state!";return this._logger.log(Ae.Error,a),Promise.reject(new Ws(a))}this._connectionStarted=!0}send(i){return this._connectionState!=="Connected"?Promise.reject(new Error("Cannot send data if the connection is not in the 'Connected' State.")):(this._sendQueue||(this._sendQueue=new mO(this.transport)),this._sendQueue.send(i))}async stop(i){if(this._connectionState==="Disconnected")return this._logger.log(Ae.Debug,`Call to HttpConnection.stop(${i}) ignored because the connection is already in the disconnected state.`),Promise.resolve();if(this._connectionState==="Disconnecting")return this._logger.log(Ae.Debug,`Call to HttpConnection.stop(${i}) ignored because the connection is already in the disconnecting state.`),this._stopPromise;this._connectionState="Disconnecting",this._stopPromise=new Promise(a=>{this._stopPromiseResolver=a}),await this._stopInternal(i),await this._stopPromise}async _stopInternal(i){this._stopError=i;try{await this._startInternalPromise}catch{}if(this.transport){try{await this.transport.stop()}catch(a){this._logger.log(Ae.Error,`HttpConnection.transport.stop() threw error '${a}'.`),this._stopConnection()}this.transport=void 0}else this._logger.log(Ae.Debug,"HttpConnection.transport is undefined in HttpConnection.stop() because start() failed.")}async _startInternal(i){let a=this.baseUrl;this._accessTokenFactory=this._options.accessTokenFactory,this._httpClient._accessTokenFactory=this._accessTokenFactory;try{if(this._options.skipNegotiation)if(this._options.transport===jr.WebSockets)this.transport=this._constructTransport(jr.WebSockets),await this._startTransport(a,i);else throw new Error("Negotiation can only be skipped when using the WebSocket transport directly.");else{let l=null,u=0;do{if(l=await this._getNegotiationResponse(a),this._connectionState==="Disconnecting"||this._connectionState==="Disconnected")throw new Ws("The connection was stopped during negotiation.");if(l.error)throw new Error(l.error);if(l.ProtocolVersion)throw new Error("Detected a connection attempt to an ASP.NET SignalR Server. This client only supports connecting to an ASP.NET Core SignalR Server. See https://aka.ms/signalr-core-differences for details.");if(l.url&&(a=l.url),l.accessToken){const f=l.accessToken;this._accessTokenFactory=()=>f,this._httpClient._accessToken=f,this._httpClient._accessTokenFactory=void 0}u++}while(l.url&&u<j5);if(u===j5&&l.url)throw new Error("Negotiate redirection limit exceeded.");await this._createTransport(a,this._options.transport,l,i)}this.transport instanceof U5&&(this.features.inherentKeepAlive=!0),this._connectionState==="Connecting"&&(this._logger.log(Ae.Debug,"The HttpConnection connected successfully."),this._connectionState="Connected")}catch(l){return this._logger.log(Ae.Error,"Failed to start the connection: "+l),this._connectionState="Disconnected",this.transport=void 0,this._stopPromiseResolver(),Promise.reject(l)}}async _getNegotiationResponse(i){const a={},[l,u]=Ap();a[l]=u;const f=this._resolveNegotiateUrl(i);this._logger.log(Ae.Debug,`Sending negotiation request: ${f}.`);try{const _=await this._httpClient.post(f,{content:"",headers:{...a,...this._options.headers},timeout:this._options.timeout,withCredentials:this._options.withCredentials});if(_.statusCode!==200)return Promise.reject(new Error(`Unexpected status code returned from negotiate '${_.statusCode}'`));const v=JSON.parse(_.content);return(!v.negotiateVersion||v.negotiateVersion<1)&&(v.connectionToken=v.connectionId),v.useStatefulReconnect&&this._options._useStatefulReconnect!==!0?Promise.reject(new x5("Client didn't negotiate Stateful Reconnect but the server did.")):v}catch(_){let v="Failed to complete negotiation with the server: "+_;return _ instanceof zd&&_.statusCode===404&&(v=v+" Either this is not a SignalR endpoint or there is a proxy blocking the connection."),this._logger.log(Ae.Error,v),Promise.reject(new x5(v))}}_createConnectUrl(i,a){return a?i+(i.indexOf("?")===-1?"?":"&")+`id=${a}`:i}async _createTransport(i,a,l,u){let f=this._createConnectUrl(i,l.connectionToken);if(this._isITransport(a)){this._logger.log(Ae.Debug,"Connection was provided an instance of ITransport, using that directly."),this.transport=a,await this._startTransport(f,u),this.connectionId=l.connectionId;return}const _=[],v=l.availableTransports||[];let w=l;for(const C of v){const N=this._resolveTransportOrError(C,a,u,(w==null?void 0:w.useStatefulReconnect)===!0);if(N instanceof Error)_.push(`${C.transport} failed:`),_.push(N);else if(this._isITransport(N)){if(this.transport=N,!w){try{w=await this._getNegotiationResponse(i)}catch(D){return Promise.reject(D)}f=this._createConnectUrl(i,w.connectionToken)}try{await this._startTransport(f,u),this.connectionId=w.connectionId;return}catch(D){if(this._logger.log(Ae.Error,`Failed to start the transport '${C.transport}': ${D}`),w=void 0,_.push(new q_e(`${C.transport} failed: ${D}`,jr[C.transport])),this._connectionState!=="Connecting"){const O="Failed to select transport before stop() was called.";return this._logger.log(Ae.Debug,O),Promise.reject(new Ws(O))}}}}return _.length>0?Promise.reject(new X_e(`Unable to connect to the server with any of the available transports. ${_.join(" ")}`,_)):Promise.reject(new Error("None of the transports supported by the client are supported by the server."))}_constructTransport(i){switch(i){case jr.WebSockets:if(!this._options.WebSocket)throw new Error("'WebSocket' is not supported in your environment.");return new vEe(this._httpClient,this._accessTokenFactory,this._logger,this._options.logMessageContent,this._options.WebSocket,this._options.headers||{});case jr.ServerSentEvents:if(!this._options.EventSource)throw new Error("'EventSource' is not supported in your environment.");return new EEe(this._httpClient,this._httpClient._accessToken,this._logger,this._options);case jr.LongPolling:return new U5(this._httpClient,this._logger,this._options);default:throw new Error(`Unknown transport: ${i}.`)}}_startTransport(i,a){return this.transport.onreceive=this.onreceive,this.features.reconnect?this.transport.onclose=async l=>{let u=!1;if(this.features.reconnect)try{this.features.disconnected(),await this.transport.connect(i,a),await this.features.resend()}catch{u=!0}else{this._stopConnection(l);return}u&&this._stopConnection(l)}:this.transport.onclose=l=>this._stopConnection(l),this.transport.connect(i,a)}_resolveTransportOrError(i,a,l,u){const f=jr[i.transport];if(f==null)return this._logger.log(Ae.Debug,`Skipping transport '${i.transport}' because it is not supported by this client.`),new Error(`Skipping transport '${i.transport}' because it is not supported by this client.`);if(SEe(a,f))if(i.transferFormats.map(v=>Ii[v]).indexOf(l)>=0){if(f===jr.WebSockets&&!this._options.WebSocket||f===jr.ServerSentEvents&&!this._options.EventSource)return this._logger.log(Ae.Debug,`Skipping transport '${jr[f]}' because it is not supported in your environment.'`),new K_e(`'${jr[f]}' is not supported in your environment.`,f);this._logger.log(Ae.Debug,`Selecting transport '${jr[f]}'.`);try{return this.features.reconnect=f===jr.WebSockets?u:void 0,this._constructTransport(f)}catch(v){return v}}else return this._logger.log(Ae.Debug,`Skipping transport '${jr[f]}' because it does not support the requested transfer format '${Ii[l]}'.`),new Error(`'${jr[f]}' does not support ${Ii[l]}.`);else return this._logger.log(Ae.Debug,`Skipping transport '${jr[f]}' because it was disabled by the client.`),new Y_e(`'${jr[f]}' is disabled by the client.`,f)}_isITransport(i){return i&&typeof i=="object"&&"connect"in i}_stopConnection(i){if(this._logger.log(Ae.Debug,`HttpConnection.stopConnection(${i}) called while in state ${this._connectionState}.`),this.transport=void 0,i=this._stopError||i,this._stopError=void 0,this._connectionState==="Disconnected"){this._logger.log(Ae.Debug,`Call to HttpConnection.stopConnection(${i}) was ignored because the connection is already in the disconnected state.`);return}if(this._connectionState==="Connecting")throw this._logger.log(Ae.Warning,`Call to HttpConnection.stopConnection(${i}) was ignored because the connection is still in the connecting state.`),new Error(`HttpConnection.stopConnection(${i}) was called while the connection is still in the connecting state.`);if(this._connectionState==="Disconnecting"&&this._stopPromiseResolver(),i?this._logger.log(Ae.Error,`Connection disconnected with error '${i}'.`):this._logger.log(Ae.Information,"Connection disconnected."),this._sendQueue&&(this._sendQueue.stop().catch(a=>{this._logger.log(Ae.Error,`TransportSendQueue.stop() threw error '${a}'.`)}),this._sendQueue=void 0),this.connectionId=void 0,this._connectionState="Disconnected",this._connectionStarted){this._connectionStarted=!1;try{this.onclose&&this.onclose(i)}catch(a){this._logger.log(Ae.Error,`HttpConnection.onclose(${i}) threw error '${a}'.`)}}}_resolveUrl(i){if(i.lastIndexOf("https://",0)===0||i.lastIndexOf("http://",0)===0)return i;if(!pr.isBrowser)throw new Error(`Cannot resolve '${i}'.`);const a=window.document.createElement("a");return a.href=i,this._logger.log(Ae.Information,`Normalizing '${i}' to '${a.href}'.`),a.href}_resolveNegotiateUrl(i){const a=new URL(i);a.pathname.endsWith("/")?a.pathname+="negotiate":a.pathname+="/negotiate";const l=new URLSearchParams(a.searchParams);return l.has("negotiateVersion")||l.append("negotiateVersion",this._negotiateVersion.toString()),l.has("useStatefulReconnect")?l.get("useStatefulReconnect")==="true"&&(this._options._useStatefulReconnect=!0):this._options._useStatefulReconnect===!0&&l.append("useStatefulReconnect","true"),a.search=l.toString(),a.toString()}}function SEe(r,i){return!r||(i&r)!==0}class mO{constructor(i){this._transport=i,this._buffer=[],this._executing=!0,this._sendBufferedData=new uy,this._transportResult=new uy,this._sendLoopPromise=this._sendLoop()}send(i){return this._bufferData(i),this._transportResult||(this._transportResult=new uy),this._transportResult.promise}stop(){return this._executing=!1,this._sendBufferedData.resolve(),this._sendLoopPromise}_bufferData(i){if(this._buffer.length&&typeof this._buffer[0]!=typeof i)throw new Error(`Expected data to be of type ${typeof this._buffer} but was of type ${typeof i}`);this._buffer.push(i),this._sendBufferedData.resolve()}async _sendLoop(){for(;;){if(await this._sendBufferedData.promise,!this._executing){this._transportResult&&this._transportResult.reject("Connection stopped.");break}this._sendBufferedData=new uy;const i=this._transportResult;this._transportResult=void 0;const a=typeof this._buffer[0]=="string"?this._buffer.join(""):mO._concatBuffers(this._buffer);this._buffer.length=0;try{await this._transport.send(a),i.resolve()}catch(l){i.reject(l)}}}static _concatBuffers(i){const a=i.map(f=>f.byteLength).reduce((f,_)=>f+_),l=new Uint8Array(a);let u=0;for(const f of i)l.set(new Uint8Array(f),u),u+=f.byteLength;return l.buffer}}class uy{constructor(){this.promise=new Promise((i,a)=>[this._resolver,this._rejecter]=[i,a])}resolve(){this._resolver()}reject(i){this._rejecter(i)}}const TEe="json";class wEe{constructor(){this.name=TEe,this.version=2,this.transferFormat=Ii.Text}parseMessages(i,a){if(typeof i!="string")throw new Error("Invalid input for JSON hub protocol. Expected a string.");if(!i)return[];a===null&&(a=Ig.instance);const l=No.parse(i),u=[];for(const f of l){const _=JSON.parse(f);if(typeof _.type!="number")throw new Error("Invalid payload.");switch(_.type){case Ft.Invocation:this._isInvocationMessage(_);break;case Ft.StreamItem:this._isStreamItemMessage(_);break;case Ft.Completion:this._isCompletionMessage(_);break;case Ft.Ping:break;case Ft.Close:break;case Ft.Ack:this._isAckMessage(_);break;case Ft.Sequence:this._isSequenceMessage(_);break;default:a.log(Ae.Information,"Unknown message type '"+_.type+"' ignored.");continue}u.push(_)}return u}writeMessage(i){return No.write(JSON.stringify(i))}_isInvocationMessage(i){this._assertNotEmptyString(i.target,"Invalid payload for Invocation message."),i.invocationId!==void 0&&this._assertNotEmptyString(i.invocationId,"Invalid payload for Invocation message.")}_isStreamItemMessage(i){if(this._assertNotEmptyString(i.invocationId,"Invalid payload for StreamItem message."),i.item===void 0)throw new Error("Invalid payload for StreamItem message.")}_isCompletionMessage(i){if(i.result&&i.error)throw new Error("Invalid payload for Completion message.");!i.result&&i.error&&this._assertNotEmptyString(i.error,"Invalid payload for Completion message."),this._assertNotEmptyString(i.invocationId,"Invalid payload for Completion message.")}_isAckMessage(i){if(typeof i.sequenceId!="number")throw new Error("Invalid SequenceId for Ack message.")}_isSequenceMessage(i){if(typeof i.sequenceId!="number")throw new Error("Invalid SequenceId for Sequence message.")}_assertNotEmptyString(i,a){if(typeof i!="string"||i==="")throw new Error(a)}}const REe={trace:Ae.Trace,debug:Ae.Debug,info:Ae.Information,information:Ae.Information,warn:Ae.Warning,warning:Ae.Warning,error:Ae.Error,critical:Ae.Critical,none:Ae.None};function CEe(r){const i=REe[r.toLowerCase()];if(typeof i<"u")return i;throw new Error(`Unknown log level: ${r}`)}class bEe{configureLogging(i){if(Vr.isRequired(i,"logging"),IEe(i))this.logger=i;else if(typeof i=="string"){const a=CEe(i);this.logger=new yS(a)}else this.logger=new yS(i);return this}withUrl(i,a){return Vr.isRequired(i,"url"),Vr.isNotEmpty(i,"url"),this.url=i,typeof a=="object"?this.httpConnectionOptions={...this.httpConnectionOptions,...a}:this.httpConnectionOptions={...this.httpConnectionOptions,transport:a},this}withHubProtocol(i){return Vr.isRequired(i,"protocol"),this.protocol=i,this}withAutomaticReconnect(i){if(this.reconnectPolicy)throw new Error("A reconnectPolicy has already been set.");return i?Array.isArray(i)?this.reconnectPolicy=new M5(i):this.reconnectPolicy=i:this.reconnectPolicy=new M5,this}withServerTimeout(i){return Vr.isRequired(i,"milliseconds"),this._serverTimeoutInMilliseconds=i,this}withKeepAliveInterval(i){return Vr.isRequired(i,"milliseconds"),this._keepAliveIntervalInMilliseconds=i,this}withStatefulReconnect(i){return this.httpConnectionOptions===void 0&&(this.httpConnectionOptions={}),this.httpConnectionOptions._useStatefulReconnect=!0,this._statefulReconnectBufferSize=i==null?void 0:i.bufferSize,this}build(){const i=this.httpConnectionOptions||{};if(i.logger===void 0&&(i.logger=this.logger),!this.url)throw new Error("The 'HubConnectionBuilder.withUrl' method must be called before building the connection.");const a=new yEe(this.url,i);return fO.create(a,this.logger||Ig.instance,this.protocol||new wEe,this.reconnectPolicy,this._serverTimeoutInMilliseconds,this._keepAliveIntervalInMilliseconds,this._statefulReconnectBufferSize)}}function IEe(r){return r.log!==void 0}const La={baseUrl:"https://localhost:1190/"},AEe=La.baseUrl,Fs={connection:null,async startConnection(){const r=localStorage.getItem("token");this.connection=new bEe().withUrl(`${AEe}notificationHub`,{accessTokenFactory:()=>r||"",transport:jr.WebSockets,headers:{Authorization:`Bearer ${r}`}}).configureLogging(Ae.Information).withAutomaticReconnect().build(),await this.connection.start()},isConnected(){var r;return((r=this.connection)==null?void 0:r.state)===er.Connected},async stopConnection(){var r;(r=this.connection)!=null&&r.connectionId&&await this.connection.stop()},getConnection(){return this.connection},async joinOnlineHelpersGroup(){var r;(r=this.connection)!=null&&r.connectionId&&(await this.connection.invoke("JoinOnlineHelpersGroup"),console.log(`User${localStorage.getItem("userId")} joined to the "OnlineGroup"`))},async subscribetoIncomingCall(r){var i;(i=this.connection)!=null&&i.connectionId?this.connection.on("IncomingCall",r):console.error("SignalR Service: No SignalR connection available")},async unsubscribeFromIncomingCall(){var r;(r=this.connection)!=null&&r.connectionId?(console.log("SignalR Service: Unsubscribing from IncomingCall"),this.connection.off("IncomingCall")):console.error("SignalR Service: No SignalR connection available")},async subscribeToNewPostCreated(r){var i;(i=this.connection)!=null&&i.connectionId?(console.log("SignalR Service: Subscribing to NewPostCreated"),this.connection.on("NewPostCreated",a=>{console.log("SignalR Service: NewPostCreated event received:",a),r(a)})):console.error("SignalR Service: No SignalR connection available")},async unsubscribeFromNewPostCreated(r){var i;(i=this.connection)!=null&&i.connectionId&&(this.connection.off("NewPostCreated",r),console.log("SignalR Service: Unsubscribed from NewPostCreated"))},async leaveOnlineHelpersGroup(){var r;(r=this.connection)!=null&&r.connectionId&&(await this.connection.invoke("LeaveOnlineHelpersGroup"),console.log(`User${localStorage.getItem("userId")} Left OnlineHelpersGroup"`))}},Md={async getProfileData(){var r,i;try{const a=await Cr.get("/api/Profile");if(!a.data||typeof a.data!="object")throw new Error("Invalid profile data received from the server");if(!a.data.fullName||!a.data.email)throw new Error("Profile data is incomplete");return a.data.profileImageUrl&&localStorage.setItem("profileImageUrl",JSON.stringify(a.data.profileImageUrl)),localStorage.setItem("user",JSON.stringify(a.data)),a.data}catch(a){if($t.isAxiosError(a)){const l=((i=(r=a.response)==null?void 0:r.data)==null?void 0:i.message)||"Failed to fetch profile data";it.error(l)}throw a}},getCurrentUser(){const r=localStorage.getItem("user");if(!r||r==="undefined")return console.error("User data not found in local storage"),localStorage.removeItem("user"),null;try{if(!/^\s*\{.*\}\s*$/.test(r))throw new Error("Invalid JSON format");const i=JSON.parse(r);return console.log("ProfileService.jsx: getCurrentUser",i),i}catch(i){return console.error("Error parsing user data:",i),localStorage.removeItem("user"),null}},async updateUserProfile(r){var i,a;try{const l=new FormData;r.fullName&&l.append("fullName",r.fullName),r.gender&&l.append("gender",r.gender),r.dateOfBirth&&(r.dateOfBirth instanceof Date?l.append("dateOfBirth",r.dateOfBirth.toISOString()):l.append("dateOfBirth",r.dateOfBirth)),r.languagePreference&&l.append("languagePreference",r.languagePreference),r.profileImage&&l.append("profileImage",r.profileImage),r.password&&l.append("password",r.password),r.confirmPassword&&l.append("confirmPassword",r.confirmPassword);const u=await Cr.put("/api/Profile",l,{headers:{"Content-Type":"multipart/form-data"}});if(u.data){const f=this.getCurrentUser();if(f){const _={...f,...u.data};console.log("ProfileService.jsx: currentUser",f),console.log("ProfileService.jsx: updatedUser",_),localStorage.setItem("user",JSON.stringify(_))}}return u.data}catch(l){if($t.isAxiosError(l)){const u=((a=(i=l.response)==null?void 0:i.data)==null?void 0:a.message)||"Profile update failed";it.error(u,{icon:"❌"})}else it.error("An unexpected error occurred");throw l}}};function NEe({children:r}){const[i,a]=k.useState(null),[l,u]=k.useState(null),[f,_]=k.useState(!1),v=jp();k.useEffect(()=>{(async()=>{try{_(!0);const G=localStorage.getItem("token"),F=localStorage.getItem("user");if(!_l.isAuthenticated()){console.log("checkAuthStatus: Not Authenticated"),a(null),u(null);return}if(console.log("checkAuthStatus: Authenticated"),a(G),F)try{const L=JSON.parse(F);u(L),console.log("checkAuthStatus: Using stored user data",L),localStorage.setItem("imageURL",L.profileImageUrl),localStorage.setItem("fullName",L.fullName)}catch(L){console.error("Error parsing stored user data:",L);try{const B=await Md.getProfileData();B&&(u(B),localStorage.setItem("user",JSON.stringify(B)),console.log("checkAuthStatus: Using fresh user data",B),localStorage.setItem("imageURL",B.profileImageUrl),localStorage.setItem("fullName",B.fullName))}catch(B){console.error("Error fetching fresh user data:",B),localStorage.removeItem("token"),localStorage.removeItem("userId"),localStorage.removeItem("user"),a(null),u(null),v("/login")}}else try{const L=await Md.getProfileData();L&&(u(L),localStorage.setItem("user",JSON.stringify(L)),console.log("checkAuthStatus: Using fresh user data",L),localStorage.setItem("imageURL",L.profileImageUrl),localStorage.setItem("fullName",L.fullName))}catch(L){console.error("Error fetching user data:",L),localStorage.removeItem("token"),localStorage.removeItem("userId"),a(null),u(null),v("/login")}}catch(G){console.error("Authentication status check failed:",G),it.error("Session initialization failed"),a(null),u(null)}finally{_(!1)}})()},[v]);const D={user:l,isAuthenticated:!!l,isLoading:f,login:async O=>{try{_(!0);const G=await _l.login(O);if(G.token&&G.userId){a(G.token),localStorage.setItem("token",G.token),localStorage.setItem("userId",G.userId);const F=await Md.getProfileData();F&&(u(F),localStorage.setItem("user",JSON.stringify(F))),v("/home")}}catch(G){console.error("Login error:",G),it.error("Login failed. Please try again.")}finally{_(!1)}},register:async O=>{try{_(!0),await _l.register(O),it.success("Registration successful! Please login.",{icon:"✅"}),v("/login")}catch(G){console.error("Registration error:",G)}finally{_(!1)}},logout:async()=>{var O;try{(O=Fs.getConnection())!=null&&O.connectionId&&(await Fs.unsubscribeFromNewPostCreated(()=>{console.log("SignalRProvider: Unsubscribed from notifications")}),await Fs.leaveOnlineHelpersGroup(),await Fs.stopConnection()),_l.logout(),a(null),u(null),localStorage.removeItem("token"),localStorage.removeItem("userId"),localStorage.removeItem("user"),v("/"),it.info("You have been logged out",{icon:"👋"})}catch(G){console.error("Logout error:",G)}}};return S.jsx(gG.Provider,{value:D,children:r})}function hu(){const r=k.useContext(gG);if(r===void 0)throw new Error("useAuth must be used within an AuthProvider");return r}const OEe=GN("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),sn=k.forwardRef(({className:r,variant:i,size:a,asChild:l=!1,...u},f)=>{const _=l?Qd:"button";return S.jsx(_,{className:Lt(OEe({variant:i,size:a,className:r})),ref:f,...u})});sn.displayName="Button";const WG=k.createContext(void 0);function Gg(){const r=k.useContext(WG);if(r===void 0)throw new Error("useSignalR must be used within a SignalRProvider");return r}var gO="Avatar",[PEe,Y0e]=lu(gO),[DEe,HG]=PEe(gO),GG=k.forwardRef((r,i)=>{const{__scopeAvatar:a,...l}=r,[u,f]=k.useState("idle");return S.jsx(DEe,{scope:a,imageLoadingStatus:u,onImageLoadingStatusChange:f,children:S.jsx(Bt.span,{...l,ref:i})})});GG.displayName=gO;var zG="AvatarImage",KG=k.forwardRef((r,i)=>{const{__scopeAvatar:a,src:l,onLoadingStatusChange:u=()=>{},...f}=r,_=HG(zG,a),v=kEe(l,f.referrerPolicy),w=Dr(C=>{u(C),_.onImageLoadingStatusChange(C)});return Xr(()=>{v!=="idle"&&w(v)},[v,w]),v==="loaded"?S.jsx(Bt.img,{...f,ref:i,src:l}):null});KG.displayName=zG;var YG="AvatarFallback",qG=k.forwardRef((r,i)=>{const{__scopeAvatar:a,delayMs:l,...u}=r,f=HG(YG,a),[_,v]=k.useState(l===void 0);return k.useEffect(()=>{if(l!==void 0){const w=window.setTimeout(()=>v(!0),l);return()=>window.clearTimeout(w)}},[l]),_&&f.imageLoadingStatus!=="loaded"?S.jsx(Bt.span,{...u,ref:i}):null});qG.displayName=YG;function kEe(r,i){const[a,l]=k.useState("idle");return Xr(()=>{if(!r){l("error");return}let u=!0;const f=new window.Image,_=v=>()=>{u&&l(v)};return l("loading"),f.onload=_("loaded"),f.onerror=_("error"),f.src=r,i&&(f.referrerPolicy=i),()=>{u=!1}},[r,i]),a}var XG=GG,$G=KG,JG=qG;const pu=k.forwardRef(({className:r,...i},a)=>S.jsx(XG,{ref:a,className:Lt("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",r),...i}));pu.displayName=XG.displayName;const fu=k.forwardRef(({className:r,...i},a)=>S.jsx($G,{ref:a,className:Lt("aspect-square h-full w-full",r),...i}));fu.displayName=$G.displayName;const mu=k.forwardRef(({className:r,...i},a)=>S.jsx(JG,{ref:a,className:Lt("flex h-full w-full items-center justify-center rounded-full bg-muted",r),...i}));mu.displayName=JG.displayName;const mI=La.baseUrl,xEe=()=>{const{isAuthenticated:r,user:i,logout:a}=hu(),{hasUnreadNotifications:l}=Gg(),u=jp(),f=Up();return S.jsx("nav",{className:"bg-white shadow-sm fixed w-full z-50 top-0",children:S.jsx("div",{className:"container mx-auto px-4 py-2",children:S.jsxs("div",{className:"flex justify-between items-center",children:[S.jsx("div",{className:"flex items-center",children:S.jsx(Co,{to:"/",className:"flex items-center",children:S.jsx("img",{src:`${mI+"uploads/imgs/logo.png"}`,alt:"App Logo",className:"h-10 transform scale-125"})})}),S.jsx("div",{className:"hidden md:flex items-center space-x-6",children:r?S.jsxs(S.Fragment,{children:[S.jsxs(Co,{to:"/translation",className:`nav-link ${f.pathname==="/translation"?"active":""}`,children:[S.jsx(ehe,{className:"h-4 w-4 inline-block mr-1"}),"Translate"]}),S.jsx(Co,{to:"/home",className:`nav-link ${f.pathname==="/home"?"active":""}`,children:"Home"}),S.jsx(Co,{to:"/Brother",className:`nav-link ${f.pathname==="/Brother"?"active":""}`,children:"Brothers"}),S.jsx(Co,{to:"/history",className:`nav-link ${f.pathname==="/history"?"active":""}`,children:"History"}),S.jsx(Co,{to:"/Profile",className:`nav-link ${f.pathname==="/Profile"?"active":""}`,children:"Profile"})]}):S.jsx(Co,{to:"/",className:`nav-link ${f.pathname==="/"?"active":""}`,children:"Home"})}),S.jsx("div",{className:"flex items-center space-x-4",children:r?S.jsxs(S.Fragment,{children:[S.jsx("div",{className:"relative",children:S.jsxs(sn,{variant:"ghost",size:"icon",onClick:()=>u("/notifications"),className:"relative",children:[S.jsx(ng,{className:"h-5 w-5"}),l&&S.jsx("span",{className:"absolute top-0 right-0 h-2 w-2 bg-red-500 rounded-full"})]})}),S.jsx("div",{className:"relative group",children:S.jsxs(pu,{className:"h-8 w-8 cursor-pointer",children:[S.jsx(fu,{onClick:()=>u("/profile"),src:i!=null&&i.profileImageUrl?`${mI}${i.profileImageUrl}`:`${mI}uploads/imgs/default.png`,alt:(i==null?void 0:i.fullName)||"User"}),S.jsx(mu,{children:S.jsx(du,{className:"h-5 w-5"})})]})}),S.jsx(sn,{variant:"ghost",className:"text-red-700 hover:text-red-500",onClick:a,children:"Logout"})]}):S.jsxs("div",{className:"flex items-center space-x-4",children:[S.jsx(Co,{to:"/login",children:S.jsx(sn,{variant:"ghost",children:"Log in"})}),S.jsx(Co,{to:"/signup",children:S.jsx(sn,{children:"Sign up"})})]})})]})})})},wr=k.forwardRef(({className:r,type:i,...a},l)=>S.jsx("input",{type:i,className:Lt("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2  text-black focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",r),ref:l,...a}));wr.displayName="Input";const LEe=()=>S.jsxs("div",{className:"app-container",children:[S.jsx("section",{className:"hero-section",children:S.jsx("div",{className:"container mx-auto max-w-5xl",children:S.jsxs("div",{className:"flex flex-col md:flex-row items-center",children:[S.jsxs("div",{className:"md:w-1/2 mb-10 md:mb-0",children:[S.jsxs("h1",{className:"text-5xl md:text-6xl font-bold mb-6 animate-fade-in",children:["Be heard.",S.jsx("br",{}),"Be seen.",S.jsx("br",{}),S.jsx("span",{className:"text-white",children:"be with me"})]}),S.jsx("p",{className:"text-lg md:text-xl mb-8 max-w-lg opacity-90",children:"Connect with people around the world, share your thoughts, and build meaningful relationships in a safe and friendly environment."}),S.jsxs("div",{className:"flex flex-wrap gap-4",children:[S.jsx(Co,{to:"/signup",children:S.jsx(sn,{className:"bg-white text-blue-500 hover:bg-gray-100 font-bold py-3 px-8 rounded-md text-lg shadow-lg",children:"Get Started"})}),S.jsx(sn,{variant:"outline",className:"bg-transparent border-2 border-white text-white hover:bg-white/10 font-bold py-3 px-8 rounded-md text-lg",children:"Learn More"})]})]}),S.jsx("div",{className:"md:w-1/2 flex justify-center",children:S.jsx("img",{src:"/lovable-uploads/e1752e3a-5228-4aee-84a2-44186418dd24.png",alt:"People connecting illustration",className:"max-w-full h-auto rounded-lg shadow-xl"})})]})})}),S.jsx("section",{className:"app-section bg-gray-50",children:S.jsxs("div",{className:"container mx-auto max-w-6xl",children:[S.jsx("h2",{className:"section-title",children:"Why This App Matters?"}),S.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-8",children:[S.jsx("div",{className:"relative",children:S.jsxs("div",{className:"feature-card",children:[S.jsx("div",{className:"feature-icon bg-blue-500",children:S.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[S.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),S.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v.01M8.781 7.782l.01-.01M7 12h.01M8.781 16.218l.01.01M12 19.99V20M15.219 16.218l.01.01M17 12h.01M15.219 7.782l.01-.01"})]})}),S.jsx("div",{className:"absolute -top-2 -right-2 flex items-center justify-center w-8 h-8 bg-orange-500 text-white font-bold rounded-full",children:"1"}),S.jsx("h3",{className:"text-xl font-semibold mb-2 text-gray-900",children:"Helping the Blind"}),S.jsx("p",{className:"text-gray-600",children:"The smart assistant helps the blind while walking by using the phone camera and warns them of obstacles such as walls or poles."})]})}),S.jsx("div",{className:"relative",children:S.jsxs("div",{className:"feature-card",children:[S.jsx("div",{className:"feature-icon bg-blue-500",children:S.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:S.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"})})}),S.jsx("div",{className:"absolute -top-2 -right-2 flex items-center justify-center w-8 h-8 bg-orange-500 text-white font-bold rounded-full",children:"2"}),S.jsx("h3",{className:"text-xl font-semibold mb-2 text-gray-900",children:"Assist Hearing-Impaired in Calls"}),S.jsx("p",{className:"text-gray-600",children:"Converts phone calls into readable text instantly to help hearing-impaired users understand the conversation."})]})}),S.jsx("div",{className:"relative",children:S.jsxs("div",{className:"feature-card",children:[S.jsx("div",{className:"feature-icon bg-blue-500",children:S.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:S.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"})})}),S.jsx("div",{className:"absolute -top-2 -right-2 flex items-center justify-center w-8 h-8 bg-orange-500 text-white font-bold rounded-full",children:"3"}),S.jsx("h3",{className:"text-xl font-semibold mb-2 text-gray-900",children:"Improve Pronunciation"}),S.jsx("p",{className:"text-gray-600",children:"Supports hearing-impaired users in pronouncing words correctly by simulating lip movement and speaking the word aloud."})]})}),S.jsx("div",{className:"relative",children:S.jsxs("div",{className:"feature-card",children:[S.jsx("div",{className:"feature-icon bg-blue-500",children:S.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:S.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})})}),S.jsx("div",{className:"absolute -top-2 -right-2 flex items-center justify-center w-8 h-8 bg-orange-500 text-white font-bold rounded-full",children:"4"}),S.jsx("h3",{className:"text-xl font-semibold mb-2 text-gray-900",children:"Privacy & Security"}),S.jsx("p",{className:"text-gray-600",children:"We respect user privacy and use the latest security technologies to protect data and personal information."})]})})]})]})}),S.jsx("section",{className:"app-section bg-blue-50",children:S.jsxs("div",{className:"container mx-auto max-w-6xl",children:[S.jsx("h2",{className:"section-title",children:"About the Service"}),S.jsx("div",{className:"text-center mb-12",children:S.jsx("p",{className:"text-gray-700 max-w-3xl mx-auto text-lg",children:"A smart assistive platform that helps the blind with voice-guided camera use and supports the hearing impaired by converting calls to text and improving pronunciation through visual-audio feedback."})}),S.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-8",children:[S.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-md flex flex-col items-center",children:[S.jsx("div",{className:"bg-blue-100 rounded-lg w-full aspect-square mb-6 flex items-center justify-center p-4",children:S.jsx("img",{src:"/lovable-uploads/b36a283a-1ea8-4d31-b9f6-749978bf0517.png",alt:"App Screenshot",className:"max-w-full h-auto"})}),S.jsx("h3",{className:"text-xl font-semibold mb-2 text-gray-900",children:"Helping the Blind"}),S.jsx("p",{className:"text-gray-600 text-center",children:"Use the phone camera with voice guidance to identify objects and navigate surroundings"})]}),S.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-md flex flex-col items-center",children:[S.jsx("div",{className:"bg-blue-100 rounded-lg w-full aspect-square mb-6 flex items-center justify-center p-4",children:S.jsx("img",{src:"/lovable-uploads/c29ccb87-008f-49cb-a2bd-c7b1d4b1e95f.png",alt:"App Screenshot",className:"max-w-full h-auto"})}),S.jsx("h3",{className:"text-xl font-semibold mb-2 text-gray-900",children:"Call-to-Text Conversion"}),S.jsx("p",{className:"text-gray-600 text-center",children:"Convert phone calls into live text to help the hearing impaired follow conversations easily"})]}),S.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-md flex flex-col items-center",children:[S.jsx("div",{className:"bg-blue-100 rounded-lg w-full aspect-square mb-6 flex items-center justify-center p-4",children:S.jsx("img",{src:"/lovable-uploads/b36a283a-1ea8-4d31-b9f6-749978bf0517.png",alt:"App Screenshot",className:"max-w-full h-auto"})}),S.jsx("h3",{className:"text-xl font-semibold mb-2 text-gray-900",children:"Word Translation"}),S.jsx("p",{className:"text-gray-600 text-center",children:"Translate spoken words and teach correct lip-synced pronunciation using visual-audio aids"})]}),S.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-md flex flex-col items-center",children:[S.jsx("div",{className:"bg-blue-100 rounded-lg w-full aspect-square mb-6 flex items-center justify-center p-4",children:S.jsx("img",{src:"/lovable-uploads/abaaa508-74e9-4f09-b6e9-cd6198c6ef4f.png",alt:"App Screenshot",className:"max-w-full h-auto"})}),S.jsx("h3",{className:"text-xl font-semibold mb-2 text-gray-900",children:"App Security Features"}),S.jsx("p",{className:"text-gray-600 text-center",children:"Ensure data protection and secure access with advanced app-level security protocols"})]})]})]})}),S.jsx("section",{className:"py-20 px-4 bg-white",children:S.jsxs("div",{className:"container mx-auto text-center max-w-3xl",children:[S.jsx("h2",{className:"text-3xl md:text-4xl font-bold mb-6 text-gray-900",children:"Ready to connect?"}),S.jsx("p",{className:"text-xl text-gray-600 mb-10",children:"Join thousands of users already connecting and sharing on our platform"}),S.jsx(Co,{to:"/signup",children:S.jsx(sn,{className:"btn-primary text-lg py-3 px-10",children:"Create your account"})})]})}),S.jsx("footer",{className:"bg-gray-50 py-12 px-4",children:S.jsxs("div",{className:"container mx-auto max-w-6xl",children:[S.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-12",children:[S.jsxs("div",{children:[S.jsxs("h3",{className:"text-xl font-bold mb-4 flex items-center",children:[S.jsx("img",{src:"/lovable-uploads/c29ccb87-008f-49cb-a2bd-c7b1d4b1e95f.png",alt:"Logo",className:"w-10 h-10 mr-2"}),"Be With Me"]}),S.jsx("p",{className:"text-gray-600 mb-6",children:"is a smart assistive app that supports the blind and hearing impaired through AI-powered features like voice-guided camera assistance"}),S.jsx("h4",{className:"font-semibold mb-3",children:"Social Media"}),S.jsxs("div",{className:"flex space-x-4",children:[S.jsx("a",{href:"#",className:"w-10 h-10 rounded-full bg-blue-100 text-blue-500 flex items-center justify-center hover:bg-blue-500 hover:text-white transition-colors",children:S.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24",children:S.jsx("path",{d:"M8.29 20.251c7.547 0 11.675-6.253 11.675-11.675 0-.178 0-.355-.012-.53A8.348 8.348 0 0022 5.92a8.19 8.19 0 01-2.357.646 4.118 4.118 0 001.804-2.27 8.224 8.224 0 01-2.605.996 4.107 4.107 0 00-6.993 3.743 11.65 11.65 0 01-8.457-4.287 4.106 4.106 0 001.27 5.477A4.072 4.072 0 012.8 9.713v.052a4.105 4.105 0 003.292 4.022 4.095 4.095 0 01-1.853.07 4.108 4.108 0 003.834 2.85A8.233 8.233 0 012 18.407a11.616 11.616 0 006.29 1.84"})})}),S.jsx("a",{href:"#",className:"w-10 h-10 rounded-full bg-blue-100 text-blue-500 flex items-center justify-center hover:bg-blue-500 hover:text-white transition-colors",children:S.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24",children:S.jsx("path",{d:"M9.045 23.0327H13.4951V12.9658H16.9636L17.334 8.93986H13.4951V6.49372C13.4951 5.35278 13.7879 4.6904 15.3522 4.6904H17.4233V1.08551C17.0826 1.0404 15.8179 0.941895 14.2949 0.941895C11.1134 0.941895 8.94462 2.89243 8.94462 6.16186V8.93986H5.57666V12.9658H8.94462V23.0327H9.045Z"})})}),S.jsx("a",{href:"#",className:"w-10 h-10 rounded-full bg-blue-100 text-blue-500 flex items-center justify-center hover:bg-blue-500 hover:text-white transition-colors",children:S.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24",children:S.jsx("path",{d:"M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zM12 0C8.741 0 8.333.014 7.053.072 2.695.272.273 2.69.073 7.052.014 8.333 0 8.741 0 12c0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98C8.333 23.986 8.741 24 12 24c3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98C15.668.014 15.259 0 12 0zm0 5.838a6.162 6.162 0 100 12.324 6.162 6.162 0 000-12.324zM12 16a4 4 0 110-8 4 4 0 010 8zm6.406-11.845a1.44 1.44 0 100 2.881 1.44 1.44 0 000-2.881z"})})}),S.jsx("a",{href:"#",className:"w-10 h-10 rounded-full bg-blue-100 text-blue-500 flex items-center justify-center hover:bg-blue-500 hover:text-white transition-colors",children:S.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24",children:S.jsx("path",{d:"M6.94 5a2 2 0 1 1-4-.002 2 2 0 0 1 4 .002zM7 8.48H3V21h4V8.48zm6.32 0H9.34V21h3.94v-6.57c0-3.66 4.77-4 4.77 0V21H22v-7.93c0-6.17-7.06-5.94-8.72-2.91l.04-1.68z"})})})]})]}),S.jsxs("div",{children:[S.jsx("h3",{className:"text-xl font-bold mb-4",children:"Subscribe our Newsletter"}),S.jsx("p",{className:"text-gray-600 mb-6",children:'Subscribe to our newsletter to stay updated on "Be With Me" — a smart project designed to empower people with disabilities, especially the blind and hearing impaired, through innovative assistive solutions.'}),S.jsxs("div",{className:"flex",children:[S.jsx(wr,{type:"email",placeholder:"Enter Your Email Address",className:"rounded-r-none"}),S.jsx(sn,{className:"btn-primary rounded-l-none",children:"Subscribe"})]})]}),S.jsxs("div",{children:[S.jsx("h3",{className:"text-xl font-bold mb-4",children:"Get in Touch"}),S.jsxs("div",{className:"space-y-4",children:[S.jsxs("div",{className:"flex items-center",children:[S.jsx("div",{className:"w-10 h-10 rounded-full bg-blue-100 text-blue-500 flex items-center justify-center mr-3",children:S.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:S.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})})}),S.jsx("span",{className:"text-gray-700",children:"bewithme.team@gmail.com"})]}),S.jsxs("div",{className:"flex items-center",children:[S.jsx("div",{className:"w-10 h-10 rounded-full bg-blue-100 text-blue-500 flex items-center justify-center mr-3",children:S.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:S.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"})})}),S.jsx("span",{className:"text-gray-700",children:"01120276417"})]})]})]})]}),S.jsx("div",{className:"border-t border-gray-200 mt-12 pt-8 text-center text-gray-500",children:S.jsxs("p",{children:["© ",new Date().getFullYear()," BeWithMe. All rights reserved."]})})]})})]});var MEe="Label",QG=k.forwardRef((r,i)=>S.jsx(Bt.label,{...r,ref:i,onMouseDown:a=>{var u;a.target.closest("button, input, select, textarea")||((u=r.onMouseDown)==null||u.call(r,a),!a.defaultPrevented&&a.detail>1&&a.preventDefault())}}));QG.displayName=MEe;var ZG=QG;const UEe=GN("text-sm text-black font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),Rr=k.forwardRef(({className:r,...i},a)=>S.jsx(ZG,{ref:a,className:Lt(UEe(),r),...i}));Rr.displayName=ZG.displayName;function VA(r,[i,a]){return Math.min(a,Math.max(i,r))}var jEe=k.createContext(void 0);function e9(r){const i=k.useContext(jEe);return r||i||"ltr"}var gI=0;function t9(){k.useEffect(()=>{const r=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",r[0]??V5()),document.body.insertAdjacentElement("beforeend",r[1]??V5()),gI++,()=>{gI===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(i=>i.remove()),gI--}},[])}function V5(){const r=document.createElement("span");return r.setAttribute("data-radix-focus-guard",""),r.tabIndex=0,r.style.outline="none",r.style.opacity="0",r.style.position="fixed",r.style.pointerEvents="none",r}var _I="focusScope.autoFocusOnMount",EI="focusScope.autoFocusOnUnmount",F5={bubbles:!1,cancelable:!0},VEe="FocusScope",_O=k.forwardRef((r,i)=>{const{loop:a=!1,trapped:l=!1,onMountAutoFocus:u,onUnmountAutoFocus:f,..._}=r,[v,w]=k.useState(null),C=Dr(u),N=Dr(f),D=k.useRef(null),O=Tn(i,V=>w(V)),G=k.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;k.useEffect(()=>{if(l){let V=function(z){if(G.paused||!v)return;const $=z.target;v.contains($)?D.current=$:il(D.current,{select:!0})},L=function(z){if(G.paused||!v)return;const $=z.relatedTarget;$!==null&&(v.contains($)||il(D.current,{select:!0}))},B=function(z){if(document.activeElement===document.body)for(const te of z)te.removedNodes.length>0&&il(v)};document.addEventListener("focusin",V),document.addEventListener("focusout",L);const W=new MutationObserver(B);return v&&W.observe(v,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",V),document.removeEventListener("focusout",L),W.disconnect()}}},[l,v,G.paused]),k.useEffect(()=>{if(v){W5.add(G);const V=document.activeElement;if(!v.contains(V)){const B=new CustomEvent(_I,F5);v.addEventListener(_I,C),v.dispatchEvent(B),B.defaultPrevented||(FEe(zEe(n9(v)),{select:!0}),document.activeElement===V&&il(v))}return()=>{v.removeEventListener(_I,C),setTimeout(()=>{const B=new CustomEvent(EI,F5);v.addEventListener(EI,N),v.dispatchEvent(B),B.defaultPrevented||il(V??document.body,{select:!0}),v.removeEventListener(EI,N),W5.remove(G)},0)}}},[v,C,N,G]);const F=k.useCallback(V=>{if(!a&&!l||G.paused)return;const L=V.key==="Tab"&&!V.altKey&&!V.ctrlKey&&!V.metaKey,B=document.activeElement;if(L&&B){const W=V.currentTarget,[z,$]=BEe(W);z&&$?!V.shiftKey&&B===$?(V.preventDefault(),a&&il(z,{select:!0})):V.shiftKey&&B===z&&(V.preventDefault(),a&&il($,{select:!0})):B===W&&V.preventDefault()}},[a,l,G.paused]);return S.jsx(Bt.div,{tabIndex:-1,..._,ref:O,onKeyDown:F})});_O.displayName=VEe;function FEe(r,{select:i=!1}={}){const a=document.activeElement;for(const l of r)if(il(l,{select:i}),document.activeElement!==a)return}function BEe(r){const i=n9(r),a=B5(i,r),l=B5(i.reverse(),r);return[a,l]}function n9(r){const i=[],a=document.createTreeWalker(r,NodeFilter.SHOW_ELEMENT,{acceptNode:l=>{const u=l.tagName==="INPUT"&&l.type==="hidden";return l.disabled||l.hidden||u?NodeFilter.FILTER_SKIP:l.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;a.nextNode();)i.push(a.currentNode);return i}function B5(r,i){for(const a of r)if(!WEe(a,{upTo:i}))return a}function WEe(r,{upTo:i}){if(getComputedStyle(r).visibility==="hidden")return!0;for(;r;){if(i!==void 0&&r===i)return!1;if(getComputedStyle(r).display==="none")return!0;r=r.parentElement}return!1}function HEe(r){return r instanceof HTMLInputElement&&"select"in r}function il(r,{select:i=!1}={}){if(r&&r.focus){const a=document.activeElement;r.focus({preventScroll:!0}),r!==a&&HEe(r)&&i&&r.select()}}var W5=GEe();function GEe(){let r=[];return{add(i){const a=r[0];i!==a&&(a==null||a.pause()),r=H5(r,i),r.unshift(i)},remove(i){var a;r=H5(r,i),(a=r[0])==null||a.resume()}}}function H5(r,i){const a=[...r],l=a.indexOf(i);return l!==-1&&a.splice(l,1),a}function zEe(r){return r.filter(i=>i.tagName!=="A")}function r9(r){const i=k.useRef({value:r,previous:r});return k.useMemo(()=>(i.current.value!==r&&(i.current.previous=i.current.value,i.current.value=r),i.current.previous),[r])}var KEe=function(r){if(typeof document>"u")return null;var i=Array.isArray(r)?r[0]:r;return i.ownerDocument.body},Uh=new WeakMap,hy=new WeakMap,py={},vI=0,i9=function(r){return r&&(r.host||i9(r.parentNode))},YEe=function(r,i){return i.map(function(a){if(r.contains(a))return a;var l=i9(a);return l&&r.contains(l)?l:(console.error("aria-hidden",a,"in not contained inside",r,". Doing nothing"),null)}).filter(function(a){return!!a})},qEe=function(r,i,a,l){var u=YEe(i,Array.isArray(r)?r:[r]);py[a]||(py[a]=new WeakMap);var f=py[a],_=[],v=new Set,w=new Set(u),C=function(D){!D||v.has(D)||(v.add(D),C(D.parentNode))};u.forEach(C);var N=function(D){!D||w.has(D)||Array.prototype.forEach.call(D.children,function(O){if(v.has(O))N(O);else try{var G=O.getAttribute(l),F=G!==null&&G!=="false",V=(Uh.get(O)||0)+1,L=(f.get(O)||0)+1;Uh.set(O,V),f.set(O,L),_.push(O),V===1&&F&&hy.set(O,!0),L===1&&O.setAttribute(a,"true"),F||O.setAttribute(l,"true")}catch(B){console.error("aria-hidden: cannot operate on ",O,B)}})};return N(i),v.clear(),vI++,function(){_.forEach(function(D){var O=Uh.get(D)-1,G=f.get(D)-1;Uh.set(D,O),f.set(D,G),O||(hy.has(D)||D.removeAttribute(l),hy.delete(D)),G||D.removeAttribute(a)}),vI--,vI||(Uh=new WeakMap,Uh=new WeakMap,hy=new WeakMap,py={})}},o9=function(r,i,a){a===void 0&&(a="data-aria-hidden");var l=Array.from(Array.isArray(r)?r:[r]),u=KEe(r);return u?(l.push.apply(l,Array.from(u.querySelectorAll("[aria-live]"))),qEe(l,u,a,"aria-hidden")):function(){return null}},Oa=function(){return Oa=Object.assign||function(i){for(var a,l=1,u=arguments.length;l<u;l++){a=arguments[l];for(var f in a)Object.prototype.hasOwnProperty.call(a,f)&&(i[f]=a[f])}return i},Oa.apply(this,arguments)};function s9(r,i){var a={};for(var l in r)Object.prototype.hasOwnProperty.call(r,l)&&i.indexOf(l)<0&&(a[l]=r[l]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var u=0,l=Object.getOwnPropertySymbols(r);u<l.length;u++)i.indexOf(l[u])<0&&Object.prototype.propertyIsEnumerable.call(r,l[u])&&(a[l[u]]=r[l[u]]);return a}function XEe(r,i,a){if(a||arguments.length===2)for(var l=0,u=i.length,f;l<u;l++)(f||!(l in i))&&(f||(f=Array.prototype.slice.call(i,0,l)),f[l]=i[l]);return r.concat(f||Array.prototype.slice.call(i))}var Ly="right-scroll-bar-position",My="width-before-scroll-bar",$Ee="with-scroll-bars-hidden",JEe="--removed-body-scroll-bar-size";function yI(r,i){return typeof r=="function"?r(i):r&&(r.current=i),r}function QEe(r,i){var a=k.useState(function(){return{value:r,callback:i,facade:{get current(){return a.value},set current(l){var u=a.value;u!==l&&(a.value=l,a.callback(l,u))}}}})[0];return a.callback=i,a.facade}var ZEe=typeof window<"u"?k.useLayoutEffect:k.useEffect,G5=new WeakMap;function eve(r,i){var a=QEe(null,function(l){return r.forEach(function(u){return yI(u,l)})});return ZEe(function(){var l=G5.get(a);if(l){var u=new Set(l),f=new Set(r),_=a.current;u.forEach(function(v){f.has(v)||yI(v,null)}),f.forEach(function(v){u.has(v)||yI(v,_)})}G5.set(a,r)},[r]),a}function tve(r){return r}function nve(r,i){i===void 0&&(i=tve);var a=[],l=!1,u={read:function(){if(l)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return a.length?a[a.length-1]:r},useMedium:function(f){var _=i(f,l);return a.push(_),function(){a=a.filter(function(v){return v!==_})}},assignSyncMedium:function(f){for(l=!0;a.length;){var _=a;a=[],_.forEach(f)}a={push:function(v){return f(v)},filter:function(){return a}}},assignMedium:function(f){l=!0;var _=[];if(a.length){var v=a;a=[],v.forEach(f),_=a}var w=function(){var N=_;_=[],N.forEach(f)},C=function(){return Promise.resolve().then(w)};C(),a={push:function(N){_.push(N),C()},filter:function(N){return _=_.filter(N),a}}}};return u}function rve(r){r===void 0&&(r={});var i=nve(null);return i.options=Oa({async:!0,ssr:!1},r),i}var a9=function(r){var i=r.sideCar,a=s9(r,["sideCar"]);if(!i)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var l=i.read();if(!l)throw new Error("Sidecar medium not found");return k.createElement(l,Oa({},a))};a9.isSideCarExport=!0;function ive(r,i){return r.useMedium(i),a9}var c9=rve(),SI=function(){},p0=k.forwardRef(function(r,i){var a=k.useRef(null),l=k.useState({onScrollCapture:SI,onWheelCapture:SI,onTouchMoveCapture:SI}),u=l[0],f=l[1],_=r.forwardProps,v=r.children,w=r.className,C=r.removeScrollBar,N=r.enabled,D=r.shards,O=r.sideCar,G=r.noIsolation,F=r.inert,V=r.allowPinchZoom,L=r.as,B=L===void 0?"div":L,W=r.gapMode,z=s9(r,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),$=O,te=eve([a,i]),ie=Oa(Oa({},z),u);return k.createElement(k.Fragment,null,N&&k.createElement($,{sideCar:c9,removeScrollBar:C,shards:D,noIsolation:G,inert:F,setCallbacks:f,allowPinchZoom:!!V,lockRef:a,gapMode:W}),_?k.cloneElement(k.Children.only(v),Oa(Oa({},ie),{ref:te})):k.createElement(B,Oa({},ie,{className:w,ref:te}),v))});p0.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};p0.classNames={fullWidth:My,zeroRight:Ly};var ove=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function sve(){if(!document)return null;var r=document.createElement("style");r.type="text/css";var i=ove();return i&&r.setAttribute("nonce",i),r}function ave(r,i){r.styleSheet?r.styleSheet.cssText=i:r.appendChild(document.createTextNode(i))}function cve(r){var i=document.head||document.getElementsByTagName("head")[0];i.appendChild(r)}var lve=function(){var r=0,i=null;return{add:function(a){r==0&&(i=sve())&&(ave(i,a),cve(i)),r++},remove:function(){r--,!r&&i&&(i.parentNode&&i.parentNode.removeChild(i),i=null)}}},dve=function(){var r=lve();return function(i,a){k.useEffect(function(){return r.add(i),function(){r.remove()}},[i&&a])}},l9=function(){var r=dve(),i=function(a){var l=a.styles,u=a.dynamic;return r(l,u),null};return i},uve={left:0,top:0,right:0,gap:0},TI=function(r){return parseInt(r||"",10)||0},hve=function(r){var i=window.getComputedStyle(document.body),a=i[r==="padding"?"paddingLeft":"marginLeft"],l=i[r==="padding"?"paddingTop":"marginTop"],u=i[r==="padding"?"paddingRight":"marginRight"];return[TI(a),TI(l),TI(u)]},pve=function(r){if(r===void 0&&(r="margin"),typeof window>"u")return uve;var i=hve(r),a=document.documentElement.clientWidth,l=window.innerWidth;return{left:i[0],top:i[1],right:i[2],gap:Math.max(0,l-a+i[2]-i[0])}},fve=l9(),cp="data-scroll-locked",mve=function(r,i,a,l){var u=r.left,f=r.top,_=r.right,v=r.gap;return a===void 0&&(a="margin"),`
  .`.concat($Ee,` {
   overflow: hidden `).concat(l,`;
   padding-right: `).concat(v,"px ").concat(l,`;
  }
  body[`).concat(cp,`] {
    overflow: hidden `).concat(l,`;
    overscroll-behavior: contain;
    `).concat([i&&"position: relative ".concat(l,";"),a==="margin"&&`
    padding-left: `.concat(u,`px;
    padding-top: `).concat(f,`px;
    padding-right: `).concat(_,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(v,"px ").concat(l,`;
    `),a==="padding"&&"padding-right: ".concat(v,"px ").concat(l,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(Ly,` {
    right: `).concat(v,"px ").concat(l,`;
  }
  
  .`).concat(My,` {
    margin-right: `).concat(v,"px ").concat(l,`;
  }
  
  .`).concat(Ly," .").concat(Ly,` {
    right: 0 `).concat(l,`;
  }
  
  .`).concat(My," .").concat(My,` {
    margin-right: 0 `).concat(l,`;
  }
  
  body[`).concat(cp,`] {
    `).concat(JEe,": ").concat(v,`px;
  }
`)},z5=function(){var r=parseInt(document.body.getAttribute(cp)||"0",10);return isFinite(r)?r:0},gve=function(){k.useEffect(function(){return document.body.setAttribute(cp,(z5()+1).toString()),function(){var r=z5()-1;r<=0?document.body.removeAttribute(cp):document.body.setAttribute(cp,r.toString())}},[])},_ve=function(r){var i=r.noRelative,a=r.noImportant,l=r.gapMode,u=l===void 0?"margin":l;gve();var f=k.useMemo(function(){return pve(u)},[u]);return k.createElement(fve,{styles:mve(f,!i,u,a?"":"!important")})},FA=!1;if(typeof window<"u")try{var fy=Object.defineProperty({},"passive",{get:function(){return FA=!0,!0}});window.addEventListener("test",fy,fy),window.removeEventListener("test",fy,fy)}catch{FA=!1}var jh=FA?{passive:!1}:!1,Eve=function(r){return r.tagName==="TEXTAREA"},d9=function(r,i){if(!(r instanceof Element))return!1;var a=window.getComputedStyle(r);return a[i]!=="hidden"&&!(a.overflowY===a.overflowX&&!Eve(r)&&a[i]==="visible")},vve=function(r){return d9(r,"overflowY")},yve=function(r){return d9(r,"overflowX")},K5=function(r,i){var a=i.ownerDocument,l=i;do{typeof ShadowRoot<"u"&&l instanceof ShadowRoot&&(l=l.host);var u=u9(r,l);if(u){var f=h9(r,l),_=f[1],v=f[2];if(_>v)return!0}l=l.parentNode}while(l&&l!==a.body);return!1},Sve=function(r){var i=r.scrollTop,a=r.scrollHeight,l=r.clientHeight;return[i,a,l]},Tve=function(r){var i=r.scrollLeft,a=r.scrollWidth,l=r.clientWidth;return[i,a,l]},u9=function(r,i){return r==="v"?vve(i):yve(i)},h9=function(r,i){return r==="v"?Sve(i):Tve(i)},wve=function(r,i){return r==="h"&&i==="rtl"?-1:1},Rve=function(r,i,a,l,u){var f=wve(r,window.getComputedStyle(i).direction),_=f*l,v=a.target,w=i.contains(v),C=!1,N=_>0,D=0,O=0;do{var G=h9(r,v),F=G[0],V=G[1],L=G[2],B=V-L-f*F;(F||B)&&u9(r,v)&&(D+=B,O+=F),v instanceof ShadowRoot?v=v.host:v=v.parentNode}while(!w&&v!==document.body||w&&(i.contains(v)||i===v));return(N&&(Math.abs(D)<1||!u)||!N&&(Math.abs(O)<1||!u))&&(C=!0),C},my=function(r){return"changedTouches"in r?[r.changedTouches[0].clientX,r.changedTouches[0].clientY]:[0,0]},Y5=function(r){return[r.deltaX,r.deltaY]},q5=function(r){return r&&"current"in r?r.current:r},Cve=function(r,i){return r[0]===i[0]&&r[1]===i[1]},bve=function(r){return`
  .block-interactivity-`.concat(r,` {pointer-events: none;}
  .allow-interactivity-`).concat(r,` {pointer-events: all;}
`)},Ive=0,Vh=[];function Ave(r){var i=k.useRef([]),a=k.useRef([0,0]),l=k.useRef(),u=k.useState(Ive++)[0],f=k.useState(l9)[0],_=k.useRef(r);k.useEffect(function(){_.current=r},[r]),k.useEffect(function(){if(r.inert){document.body.classList.add("block-interactivity-".concat(u));var V=XEe([r.lockRef.current],(r.shards||[]).map(q5),!0).filter(Boolean);return V.forEach(function(L){return L.classList.add("allow-interactivity-".concat(u))}),function(){document.body.classList.remove("block-interactivity-".concat(u)),V.forEach(function(L){return L.classList.remove("allow-interactivity-".concat(u))})}}},[r.inert,r.lockRef.current,r.shards]);var v=k.useCallback(function(V,L){if("touches"in V&&V.touches.length===2||V.type==="wheel"&&V.ctrlKey)return!_.current.allowPinchZoom;var B=my(V),W=a.current,z="deltaX"in V?V.deltaX:W[0]-B[0],$="deltaY"in V?V.deltaY:W[1]-B[1],te,ie=V.target,ce=Math.abs(z)>Math.abs($)?"h":"v";if("touches"in V&&ce==="h"&&ie.type==="range")return!1;var pe=K5(ce,ie);if(!pe)return!0;if(pe?te=ce:(te=ce==="v"?"h":"v",pe=K5(ce,ie)),!pe)return!1;if(!l.current&&"changedTouches"in V&&(z||$)&&(l.current=te),!te)return!0;var Pe=l.current||te;return Rve(Pe,L,V,Pe==="h"?z:$,!0)},[]),w=k.useCallback(function(V){var L=V;if(!(!Vh.length||Vh[Vh.length-1]!==f)){var B="deltaY"in L?Y5(L):my(L),W=i.current.filter(function(te){return te.name===L.type&&(te.target===L.target||L.target===te.shadowParent)&&Cve(te.delta,B)})[0];if(W&&W.should){L.cancelable&&L.preventDefault();return}if(!W){var z=(_.current.shards||[]).map(q5).filter(Boolean).filter(function(te){return te.contains(L.target)}),$=z.length>0?v(L,z[0]):!_.current.noIsolation;$&&L.cancelable&&L.preventDefault()}}},[]),C=k.useCallback(function(V,L,B,W){var z={name:V,delta:L,target:B,should:W,shadowParent:Nve(B)};i.current.push(z),setTimeout(function(){i.current=i.current.filter(function($){return $!==z})},1)},[]),N=k.useCallback(function(V){a.current=my(V),l.current=void 0},[]),D=k.useCallback(function(V){C(V.type,Y5(V),V.target,v(V,r.lockRef.current))},[]),O=k.useCallback(function(V){C(V.type,my(V),V.target,v(V,r.lockRef.current))},[]);k.useEffect(function(){return Vh.push(f),r.setCallbacks({onScrollCapture:D,onWheelCapture:D,onTouchMoveCapture:O}),document.addEventListener("wheel",w,jh),document.addEventListener("touchmove",w,jh),document.addEventListener("touchstart",N,jh),function(){Vh=Vh.filter(function(V){return V!==f}),document.removeEventListener("wheel",w,jh),document.removeEventListener("touchmove",w,jh),document.removeEventListener("touchstart",N,jh)}},[]);var G=r.removeScrollBar,F=r.inert;return k.createElement(k.Fragment,null,F?k.createElement(f,{styles:bve(u)}):null,G?k.createElement(_ve,{gapMode:r.gapMode}):null)}function Nve(r){for(var i=null;r!==null;)r instanceof ShadowRoot&&(i=r.host,r=r.host),r=r.parentNode;return i}const Ove=ive(c9,Ave);var EO=k.forwardRef(function(r,i){return k.createElement(p0,Oa({},r,{ref:i,sideCar:Ove}))});EO.classNames=p0.classNames;var Pve=[" ","Enter","ArrowUp","ArrowDown"],Dve=[" ","Enter"],zg="Select",[f0,m0,kve]=kW(zg),[Bp,q0e]=lu(zg,[kve,QS]),g0=QS(),[xve,Vl]=Bp(zg),[Lve,Mve]=Bp(zg),p9=r=>{const{__scopeSelect:i,children:a,open:l,defaultOpen:u,onOpenChange:f,value:_,defaultValue:v,onValueChange:w,dir:C,name:N,autoComplete:D,disabled:O,required:G,form:F}=r,V=g0(i),[L,B]=k.useState(null),[W,z]=k.useState(null),[$,te]=k.useState(!1),ie=e9(C),[ce=!1,pe]=Cp({prop:l,defaultProp:u,onChange:f}),[Pe,_e]=Cp({prop:_,defaultProp:v,onChange:w}),ge=k.useRef(null),fe=L?F||!!L.closest("form"):!0,[xe,be]=k.useState(new Set),ft=Array.from(xe).map(je=>je.props.value).join(";");return S.jsx(FH,{...V,children:S.jsxs(xve,{required:G,scope:i,trigger:L,onTriggerChange:B,valueNode:W,onValueNodeChange:z,valueNodeHasChildren:$,onValueNodeHasChildrenChange:te,contentId:Hd(),value:Pe,onValueChange:_e,open:ce,onOpenChange:pe,dir:ie,triggerPointerDownPosRef:ge,disabled:O,children:[S.jsx(f0.Provider,{scope:i,children:S.jsx(Lve,{scope:r.__scopeSelect,onNativeOptionAdd:k.useCallback(je=>{be(Ge=>new Set(Ge).add(je))},[]),onNativeOptionRemove:k.useCallback(je=>{be(Ge=>{const le=new Set(Ge);return le.delete(je),le})},[]),children:a})}),fe?S.jsxs(j9,{"aria-hidden":!0,required:G,tabIndex:-1,name:N,autoComplete:D,value:Pe,onChange:je=>_e(je.target.value),disabled:O,form:F,children:[Pe===void 0?S.jsx("option",{value:""}):null,Array.from(xe)]},ft):null]})})};p9.displayName=zg;var f9="SelectTrigger",m9=k.forwardRef((r,i)=>{const{__scopeSelect:a,disabled:l=!1,...u}=r,f=g0(a),_=Vl(f9,a),v=_.disabled||l,w=Tn(i,_.onTriggerChange),C=m0(a),N=k.useRef("touch"),[D,O,G]=V9(V=>{const L=C().filter(z=>!z.disabled),B=L.find(z=>z.value===_.value),W=F9(L,V,B);W!==void 0&&_.onValueChange(W.value)}),F=V=>{v||(_.onOpenChange(!0),G()),V&&(_.triggerPointerDownPosRef.current={x:Math.round(V.pageX),y:Math.round(V.pageY)})};return S.jsx(BH,{asChild:!0,...f,children:S.jsx(Bt.button,{type:"button",role:"combobox","aria-controls":_.contentId,"aria-expanded":_.open,"aria-required":_.required,"aria-autocomplete":"none",dir:_.dir,"data-state":_.open?"open":"closed",disabled:v,"data-disabled":v?"":void 0,"data-placeholder":U9(_.value)?"":void 0,...u,ref:w,onClick:At(u.onClick,V=>{V.currentTarget.focus(),N.current!=="mouse"&&F(V)}),onPointerDown:At(u.onPointerDown,V=>{N.current=V.pointerType;const L=V.target;L.hasPointerCapture(V.pointerId)&&L.releasePointerCapture(V.pointerId),V.button===0&&V.ctrlKey===!1&&V.pointerType==="mouse"&&(F(V),V.preventDefault())}),onKeyDown:At(u.onKeyDown,V=>{const L=D.current!=="";!(V.ctrlKey||V.altKey||V.metaKey)&&V.key.length===1&&O(V.key),!(L&&V.key===" ")&&Pve.includes(V.key)&&(F(),V.preventDefault())})})})});m9.displayName=f9;var g9="SelectValue",_9=k.forwardRef((r,i)=>{const{__scopeSelect:a,className:l,style:u,children:f,placeholder:_="",...v}=r,w=Vl(g9,a),{onValueNodeHasChildrenChange:C}=w,N=f!==void 0,D=Tn(i,w.onValueNodeChange);return Xr(()=>{C(N)},[C,N]),S.jsx(Bt.span,{...v,ref:D,style:{pointerEvents:"none"},children:U9(w.value)?S.jsx(S.Fragment,{children:_}):f})});_9.displayName=g9;var Uve="SelectIcon",E9=k.forwardRef((r,i)=>{const{__scopeSelect:a,children:l,...u}=r;return S.jsx(Bt.span,{"aria-hidden":!0,...u,ref:i,children:l||"▼"})});E9.displayName=Uve;var jve="SelectPortal",v9=r=>S.jsx(zS,{asChild:!0,...r});v9.displayName=jve;var iu="SelectContent",y9=k.forwardRef((r,i)=>{const a=Vl(iu,r.__scopeSelect),[l,u]=k.useState();if(Xr(()=>{u(new DocumentFragment)},[]),!a.open){const f=l;return f?cu.createPortal(S.jsx(S9,{scope:r.__scopeSelect,children:S.jsx(f0.Slot,{scope:r.__scopeSelect,children:S.jsx("div",{children:r.children})})}),f):null}return S.jsx(T9,{...r,ref:i})});y9.displayName=iu;var Ls=10,[S9,Fl]=Bp(iu),Vve="SelectContentImpl",T9=k.forwardRef((r,i)=>{const{__scopeSelect:a,position:l="item-aligned",onCloseAutoFocus:u,onEscapeKeyDown:f,onPointerDownOutside:_,side:v,sideOffset:w,align:C,alignOffset:N,arrowPadding:D,collisionBoundary:O,collisionPadding:G,sticky:F,hideWhenDetached:V,avoidCollisions:L,...B}=r,W=Vl(iu,a),[z,$]=k.useState(null),[te,ie]=k.useState(null),ce=Tn(i,Fe=>$(Fe)),[pe,Pe]=k.useState(null),[_e,ge]=k.useState(null),fe=m0(a),[xe,be]=k.useState(!1),ft=k.useRef(!1);k.useEffect(()=>{if(z)return o9(z)},[z]),t9();const je=k.useCallback(Fe=>{const[Ke,...et]=fe().map(It=>It.ref.current),[nt]=et.slice(-1),bt=document.activeElement;for(const It of Fe)if(It===bt||(It==null||It.scrollIntoView({block:"nearest"}),It===Ke&&te&&(te.scrollTop=0),It===nt&&te&&(te.scrollTop=te.scrollHeight),It==null||It.focus(),document.activeElement!==bt))return},[fe,te]),Ge=k.useCallback(()=>je([pe,z]),[je,pe,z]);k.useEffect(()=>{xe&&Ge()},[xe,Ge]);const{onOpenChange:le,triggerPointerDownPosRef:Le}=W;k.useEffect(()=>{if(z){let Fe={x:0,y:0};const Ke=nt=>{var bt,It;Fe={x:Math.abs(Math.round(nt.pageX)-(((bt=Le.current)==null?void 0:bt.x)??0)),y:Math.abs(Math.round(nt.pageY)-(((It=Le.current)==null?void 0:It.y)??0))}},et=nt=>{Fe.x<=10&&Fe.y<=10?nt.preventDefault():z.contains(nt.target)||le(!1),document.removeEventListener("pointermove",Ke),Le.current=null};return Le.current!==null&&(document.addEventListener("pointermove",Ke),document.addEventListener("pointerup",et,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",Ke),document.removeEventListener("pointerup",et,{capture:!0})}}},[z,le,Le]),k.useEffect(()=>{const Fe=()=>le(!1);return window.addEventListener("blur",Fe),window.addEventListener("resize",Fe),()=>{window.removeEventListener("blur",Fe),window.removeEventListener("resize",Fe)}},[le]);const[ot,Xe]=V9(Fe=>{const Ke=fe().filter(bt=>!bt.disabled),et=Ke.find(bt=>bt.ref.current===document.activeElement),nt=F9(Ke,Fe,et);nt&&setTimeout(()=>nt.ref.current.focus())}),st=k.useCallback((Fe,Ke,et)=>{const nt=!ft.current&&!et;(W.value!==void 0&&W.value===Ke||nt)&&(Pe(Fe),nt&&(ft.current=!0))},[W.value]),ze=k.useCallback(()=>z==null?void 0:z.focus(),[z]),ht=k.useCallback((Fe,Ke,et)=>{const nt=!ft.current&&!et;(W.value!==void 0&&W.value===Ke||nt)&&ge(Fe)},[W.value]),dt=l==="popper"?BA:w9,at=dt===BA?{side:v,sideOffset:w,align:C,alignOffset:N,arrowPadding:D,collisionBoundary:O,collisionPadding:G,sticky:F,hideWhenDetached:V,avoidCollisions:L}:{};return S.jsx(S9,{scope:a,content:z,viewport:te,onViewportChange:ie,itemRefCallback:st,selectedItem:pe,onItemLeave:ze,itemTextRefCallback:ht,focusSelectedItem:Ge,selectedItemText:_e,position:l,isPositioned:xe,searchRef:ot,children:S.jsx(EO,{as:Qd,allowPinchZoom:!0,children:S.jsx(_O,{asChild:!0,trapped:W.open,onMountAutoFocus:Fe=>{Fe.preventDefault()},onUnmountAutoFocus:At(u,Fe=>{var Ke;(Ke=W.trigger)==null||Ke.focus({preventScroll:!0}),Fe.preventDefault()}),children:S.jsx(jg,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:f,onPointerDownOutside:_,onFocusOutside:Fe=>Fe.preventDefault(),onDismiss:()=>W.onOpenChange(!1),children:S.jsx(dt,{role:"listbox",id:W.contentId,"data-state":W.open?"open":"closed",dir:W.dir,onContextMenu:Fe=>Fe.preventDefault(),...B,...at,onPlaced:()=>be(!0),ref:ce,style:{display:"flex",flexDirection:"column",outline:"none",...B.style},onKeyDown:At(B.onKeyDown,Fe=>{const Ke=Fe.ctrlKey||Fe.altKey||Fe.metaKey;if(Fe.key==="Tab"&&Fe.preventDefault(),!Ke&&Fe.key.length===1&&Xe(Fe.key),["ArrowUp","ArrowDown","Home","End"].includes(Fe.key)){let nt=fe().filter(bt=>!bt.disabled).map(bt=>bt.ref.current);if(["ArrowUp","End"].includes(Fe.key)&&(nt=nt.slice().reverse()),["ArrowUp","ArrowDown"].includes(Fe.key)){const bt=Fe.target,It=nt.indexOf(bt);nt=nt.slice(It+1)}setTimeout(()=>je(nt)),Fe.preventDefault()}})})})})})})});T9.displayName=Vve;var Fve="SelectItemAlignedPosition",w9=k.forwardRef((r,i)=>{const{__scopeSelect:a,onPlaced:l,...u}=r,f=Vl(iu,a),_=Fl(iu,a),[v,w]=k.useState(null),[C,N]=k.useState(null),D=Tn(i,ce=>N(ce)),O=m0(a),G=k.useRef(!1),F=k.useRef(!0),{viewport:V,selectedItem:L,selectedItemText:B,focusSelectedItem:W}=_,z=k.useCallback(()=>{if(f.trigger&&f.valueNode&&v&&C&&V&&L&&B){const ce=f.trigger.getBoundingClientRect(),pe=C.getBoundingClientRect(),Pe=f.valueNode.getBoundingClientRect(),_e=B.getBoundingClientRect();if(f.dir!=="rtl"){const bt=_e.left-pe.left,It=Pe.left-bt,an=ce.left-It,kr=ce.width+an,fi=Math.max(kr,pe.width),br=window.innerWidth-Ls,Ua=VA(It,[Ls,Math.max(Ls,br-fi)]);v.style.minWidth=kr+"px",v.style.left=Ua+"px"}else{const bt=pe.right-_e.right,It=window.innerWidth-Pe.right-bt,an=window.innerWidth-ce.right-It,kr=ce.width+an,fi=Math.max(kr,pe.width),br=window.innerWidth-Ls,Ua=VA(It,[Ls,Math.max(Ls,br-fi)]);v.style.minWidth=kr+"px",v.style.right=Ua+"px"}const ge=O(),fe=window.innerHeight-Ls*2,xe=V.scrollHeight,be=window.getComputedStyle(C),ft=parseInt(be.borderTopWidth,10),je=parseInt(be.paddingTop,10),Ge=parseInt(be.borderBottomWidth,10),le=parseInt(be.paddingBottom,10),Le=ft+je+xe+le+Ge,ot=Math.min(L.offsetHeight*5,Le),Xe=window.getComputedStyle(V),st=parseInt(Xe.paddingTop,10),ze=parseInt(Xe.paddingBottom,10),ht=ce.top+ce.height/2-Ls,dt=fe-ht,at=L.offsetHeight/2,Fe=L.offsetTop+at,Ke=ft+je+Fe,et=Le-Ke;if(Ke<=ht){const bt=ge.length>0&&L===ge[ge.length-1].ref.current;v.style.bottom="0px";const It=C.clientHeight-V.offsetTop-V.offsetHeight,an=Math.max(dt,at+(bt?ze:0)+It+Ge),kr=Ke+an;v.style.height=kr+"px"}else{const bt=ge.length>0&&L===ge[0].ref.current;v.style.top="0px";const an=Math.max(ht,ft+V.offsetTop+(bt?st:0)+at)+et;v.style.height=an+"px",V.scrollTop=Ke-ht+V.offsetTop}v.style.margin=`${Ls}px 0`,v.style.minHeight=ot+"px",v.style.maxHeight=fe+"px",l==null||l(),requestAnimationFrame(()=>G.current=!0)}},[O,f.trigger,f.valueNode,v,C,V,L,B,f.dir,l]);Xr(()=>z(),[z]);const[$,te]=k.useState();Xr(()=>{C&&te(window.getComputedStyle(C).zIndex)},[C]);const ie=k.useCallback(ce=>{ce&&F.current===!0&&(z(),W==null||W(),F.current=!1)},[z,W]);return S.jsx(Wve,{scope:a,contentWrapper:v,shouldExpandOnScrollRef:G,onScrollButtonChange:ie,children:S.jsx("div",{ref:w,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:$},children:S.jsx(Bt.div,{...u,ref:D,style:{boxSizing:"border-box",maxHeight:"100%",...u.style}})})})});w9.displayName=Fve;var Bve="SelectPopperPosition",BA=k.forwardRef((r,i)=>{const{__scopeSelect:a,align:l="start",collisionPadding:u=Ls,...f}=r,_=g0(a);return S.jsx(WH,{..._,...f,ref:i,align:l,collisionPadding:u,style:{boxSizing:"border-box",...f.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});BA.displayName=Bve;var[Wve,vO]=Bp(iu,{}),WA="SelectViewport",R9=k.forwardRef((r,i)=>{const{__scopeSelect:a,nonce:l,...u}=r,f=Fl(WA,a),_=vO(WA,a),v=Tn(i,f.onViewportChange),w=k.useRef(0);return S.jsxs(S.Fragment,{children:[S.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:l}),S.jsx(f0.Slot,{scope:a,children:S.jsx(Bt.div,{"data-radix-select-viewport":"",role:"presentation",...u,ref:v,style:{position:"relative",flex:1,overflow:"hidden auto",...u.style},onScroll:At(u.onScroll,C=>{const N=C.currentTarget,{contentWrapper:D,shouldExpandOnScrollRef:O}=_;if(O!=null&&O.current&&D){const G=Math.abs(w.current-N.scrollTop);if(G>0){const F=window.innerHeight-Ls*2,V=parseFloat(D.style.minHeight),L=parseFloat(D.style.height),B=Math.max(V,L);if(B<F){const W=B+G,z=Math.min(F,W),$=W-z;D.style.height=z+"px",D.style.bottom==="0px"&&(N.scrollTop=$>0?$:0,D.style.justifyContent="flex-end")}}}w.current=N.scrollTop})})})]})});R9.displayName=WA;var C9="SelectGroup",[Hve,Gve]=Bp(C9),zve=k.forwardRef((r,i)=>{const{__scopeSelect:a,...l}=r,u=Hd();return S.jsx(Hve,{scope:a,id:u,children:S.jsx(Bt.div,{role:"group","aria-labelledby":u,...l,ref:i})})});zve.displayName=C9;var b9="SelectLabel",I9=k.forwardRef((r,i)=>{const{__scopeSelect:a,...l}=r,u=Gve(b9,a);return S.jsx(Bt.div,{id:u.id,...l,ref:i})});I9.displayName=b9;var SS="SelectItem",[Kve,A9]=Bp(SS),N9=k.forwardRef((r,i)=>{const{__scopeSelect:a,value:l,disabled:u=!1,textValue:f,..._}=r,v=Vl(SS,a),w=Fl(SS,a),C=v.value===l,[N,D]=k.useState(f??""),[O,G]=k.useState(!1),F=Tn(i,W=>{var z;return(z=w.itemRefCallback)==null?void 0:z.call(w,W,l,u)}),V=Hd(),L=k.useRef("touch"),B=()=>{u||(v.onValueChange(l),v.onOpenChange(!1))};if(l==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return S.jsx(Kve,{scope:a,value:l,disabled:u,textId:V,isSelected:C,onItemTextChange:k.useCallback(W=>{D(z=>z||((W==null?void 0:W.textContent)??"").trim())},[]),children:S.jsx(f0.ItemSlot,{scope:a,value:l,disabled:u,textValue:N,children:S.jsx(Bt.div,{role:"option","aria-labelledby":V,"data-highlighted":O?"":void 0,"aria-selected":C&&O,"data-state":C?"checked":"unchecked","aria-disabled":u||void 0,"data-disabled":u?"":void 0,tabIndex:u?void 0:-1,..._,ref:F,onFocus:At(_.onFocus,()=>G(!0)),onBlur:At(_.onBlur,()=>G(!1)),onClick:At(_.onClick,()=>{L.current!=="mouse"&&B()}),onPointerUp:At(_.onPointerUp,()=>{L.current==="mouse"&&B()}),onPointerDown:At(_.onPointerDown,W=>{L.current=W.pointerType}),onPointerMove:At(_.onPointerMove,W=>{var z;L.current=W.pointerType,u?(z=w.onItemLeave)==null||z.call(w):L.current==="mouse"&&W.currentTarget.focus({preventScroll:!0})}),onPointerLeave:At(_.onPointerLeave,W=>{var z;W.currentTarget===document.activeElement&&((z=w.onItemLeave)==null||z.call(w))}),onKeyDown:At(_.onKeyDown,W=>{var $;(($=w.searchRef)==null?void 0:$.current)!==""&&W.key===" "||(Dve.includes(W.key)&&B(),W.key===" "&&W.preventDefault())})})})})});N9.displayName=SS;var Gm="SelectItemText",O9=k.forwardRef((r,i)=>{const{__scopeSelect:a,className:l,style:u,...f}=r,_=Vl(Gm,a),v=Fl(Gm,a),w=A9(Gm,a),C=Mve(Gm,a),[N,D]=k.useState(null),O=Tn(i,B=>D(B),w.onItemTextChange,B=>{var W;return(W=v.itemTextRefCallback)==null?void 0:W.call(v,B,w.value,w.disabled)}),G=N==null?void 0:N.textContent,F=k.useMemo(()=>S.jsx("option",{value:w.value,disabled:w.disabled,children:G},w.value),[w.disabled,w.value,G]),{onNativeOptionAdd:V,onNativeOptionRemove:L}=C;return Xr(()=>(V(F),()=>L(F)),[V,L,F]),S.jsxs(S.Fragment,{children:[S.jsx(Bt.span,{id:w.textId,...f,ref:O}),w.isSelected&&_.valueNode&&!_.valueNodeHasChildren?cu.createPortal(f.children,_.valueNode):null]})});O9.displayName=Gm;var P9="SelectItemIndicator",D9=k.forwardRef((r,i)=>{const{__scopeSelect:a,...l}=r;return A9(P9,a).isSelected?S.jsx(Bt.span,{"aria-hidden":!0,...l,ref:i}):null});D9.displayName=P9;var HA="SelectScrollUpButton",k9=k.forwardRef((r,i)=>{const a=Fl(HA,r.__scopeSelect),l=vO(HA,r.__scopeSelect),[u,f]=k.useState(!1),_=Tn(i,l.onScrollButtonChange);return Xr(()=>{if(a.viewport&&a.isPositioned){let v=function(){const C=w.scrollTop>0;f(C)};const w=a.viewport;return v(),w.addEventListener("scroll",v),()=>w.removeEventListener("scroll",v)}},[a.viewport,a.isPositioned]),u?S.jsx(L9,{...r,ref:_,onAutoScroll:()=>{const{viewport:v,selectedItem:w}=a;v&&w&&(v.scrollTop=v.scrollTop-w.offsetHeight)}}):null});k9.displayName=HA;var GA="SelectScrollDownButton",x9=k.forwardRef((r,i)=>{const a=Fl(GA,r.__scopeSelect),l=vO(GA,r.__scopeSelect),[u,f]=k.useState(!1),_=Tn(i,l.onScrollButtonChange);return Xr(()=>{if(a.viewport&&a.isPositioned){let v=function(){const C=w.scrollHeight-w.clientHeight,N=Math.ceil(w.scrollTop)<C;f(N)};const w=a.viewport;return v(),w.addEventListener("scroll",v),()=>w.removeEventListener("scroll",v)}},[a.viewport,a.isPositioned]),u?S.jsx(L9,{...r,ref:_,onAutoScroll:()=>{const{viewport:v,selectedItem:w}=a;v&&w&&(v.scrollTop=v.scrollTop+w.offsetHeight)}}):null});x9.displayName=GA;var L9=k.forwardRef((r,i)=>{const{__scopeSelect:a,onAutoScroll:l,...u}=r,f=Fl("SelectScrollButton",a),_=k.useRef(null),v=m0(a),w=k.useCallback(()=>{_.current!==null&&(window.clearInterval(_.current),_.current=null)},[]);return k.useEffect(()=>()=>w(),[w]),Xr(()=>{var N;const C=v().find(D=>D.ref.current===document.activeElement);(N=C==null?void 0:C.ref.current)==null||N.scrollIntoView({block:"nearest"})},[v]),S.jsx(Bt.div,{"aria-hidden":!0,...u,ref:i,style:{flexShrink:0,...u.style},onPointerDown:At(u.onPointerDown,()=>{_.current===null&&(_.current=window.setInterval(l,50))}),onPointerMove:At(u.onPointerMove,()=>{var C;(C=f.onItemLeave)==null||C.call(f),_.current===null&&(_.current=window.setInterval(l,50))}),onPointerLeave:At(u.onPointerLeave,()=>{w()})})}),Yve="SelectSeparator",M9=k.forwardRef((r,i)=>{const{__scopeSelect:a,...l}=r;return S.jsx(Bt.div,{"aria-hidden":!0,...l,ref:i})});M9.displayName=Yve;var zA="SelectArrow",qve=k.forwardRef((r,i)=>{const{__scopeSelect:a,...l}=r,u=g0(a),f=Vl(zA,a),_=Fl(zA,a);return f.open&&_.position==="popper"?S.jsx(HH,{...u,...l,ref:i}):null});qve.displayName=zA;function U9(r){return r===""||r===void 0}var j9=k.forwardRef((r,i)=>{const{value:a,...l}=r,u=k.useRef(null),f=Tn(i,u),_=r9(a);return k.useEffect(()=>{const v=u.current,w=window.HTMLSelectElement.prototype,N=Object.getOwnPropertyDescriptor(w,"value").set;if(_!==a&&N){const D=new Event("change",{bubbles:!0});N.call(v,a),v.dispatchEvent(D)}},[_,a]),S.jsx(Vg,{asChild:!0,children:S.jsx("select",{...l,ref:f,defaultValue:a})})});j9.displayName="BubbleSelect";function V9(r){const i=Dr(r),a=k.useRef(""),l=k.useRef(0),u=k.useCallback(_=>{const v=a.current+_;i(v),function w(C){a.current=C,window.clearTimeout(l.current),C!==""&&(l.current=window.setTimeout(()=>w(""),1e3))}(v)},[i]),f=k.useCallback(()=>{a.current="",window.clearTimeout(l.current)},[]);return k.useEffect(()=>()=>window.clearTimeout(l.current),[]),[a,u,f]}function F9(r,i,a){const u=i.length>1&&Array.from(i).every(C=>C===i[0])?i[0]:i,f=a?r.indexOf(a):-1;let _=Xve(r,Math.max(f,0));u.length===1&&(_=_.filter(C=>C!==a));const w=_.find(C=>C.textValue.toLowerCase().startsWith(u.toLowerCase()));return w!==a?w:void 0}function Xve(r,i){return r.map((a,l)=>r[(i+l)%r.length])}var $ve=p9,_0=m9,B9=_9,W9=E9,H9=v9,E0=y9,G9=R9,v0=I9,y0=N9,z9=O9,K9=D9,S0=k9,T0=x9,w0=M9;const Y9=$ve,Jve=B9,yO=k.forwardRef(({className:r,children:i,...a},l)=>S.jsxs(_0,{ref:l,className:Lt("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",r),...a,children:[i,S.jsx(W9,{asChild:!0,children:S.jsx(qS,{className:"h-4 w-4 opacity-50"})})]}));yO.displayName=_0.displayName;const q9=k.forwardRef(({className:r,...i},a)=>S.jsx(S0,{ref:a,className:Lt("flex cursor-default items-center justify-center py-1",r),...i,children:S.jsx(aH,{className:"h-4 w-4"})}));q9.displayName=S0.displayName;const X9=k.forwardRef(({className:r,...i},a)=>S.jsx(T0,{ref:a,className:Lt("flex cursor-default items-center justify-center py-1",r),...i,children:S.jsx(qS,{className:"h-4 w-4"})}));X9.displayName=T0.displayName;const SO=k.forwardRef(({className:r,children:i,position:a="popper",...l},u)=>S.jsx(H9,{children:S.jsxs(E0,{ref:u,className:Lt("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",r),position:a,...l,children:[S.jsx(q9,{}),S.jsx(G9,{className:Lt("p-1",a==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:i}),S.jsx(X9,{})]})}));SO.displayName=E0.displayName;const Qve=k.forwardRef(({className:r,...i},a)=>S.jsx(v0,{ref:a,className:Lt("py-1.5 pl-8 pr-2 text-sm font-semibold",r),...i}));Qve.displayName=v0.displayName;const Ng=k.forwardRef(({className:r,children:i,...a},l)=>S.jsxs(y0,{ref:l,className:Lt("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",r),...a,children:[S.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:S.jsx(K9,{children:S.jsx(zN,{className:"h-4 w-4"})})}),S.jsx(z9,{children:i})]}));Ng.displayName=y0.displayName;const Zve=k.forwardRef(({className:r,...i},a)=>S.jsx(w0,{ref:a,className:Lt("-mx-1 my-1 h-px bg-muted",r),...i}));Zve.displayName=w0.displayName;const eye={ProfileImage:null,fullName:"",username:"",email:"",password:"",confirmPassword:"",gender:"",dateOfBirth:"",role:"helper"},tye=()=>{const{register:r,isLoading:i}=hu(),[a,l]=k.useState(eye),[u,f]=k.useState(""),[_,v]=k.useState(""),[w,C]=k.useState(!1),[N,D]=k.useState(!1),[O,G]=k.useState(null),[F,V]=k.useState({}),[L,B]=k.useState(""),[W,z]=k.useState(""),[$,te]=k.useState(""),ie=ge=>{const{name:fe,value:xe}=ge.target;l(be=>({...be,[fe]:xe})),F[fe]&&V(be=>({...be,[fe]:""}))},ce=(ge,fe)=>{l(xe=>({...xe,[ge]:fe})),F[ge]&&V(xe=>({...xe,[ge]:""}))},pe=ge=>{if(ge.target.files&&ge.target.files[0]){const fe=ge.target.files[0];l(be=>({...be,ProfileImage:fe}));const xe=new FileReader;xe.onloadend=()=>{G(xe.result)},xe.readAsDataURL(fe)}},Pe=()=>{const ge={};if(u||(ge.firstName="First name is required"),_||(ge.lastName="Last name is required"),a.username||(ge.username="Username is required"),a.email?/\S+@\S+\.\S+/.test(a.email)||(ge.email="Email is invalid"):ge.email="Email is required",a.password||(ge.password="Password is required"),a.password!==a.confirmPassword&&(ge.confirmPassword="Passwords do not match"),a.gender||(ge.gender="Gender is required"),!L||!W||!$)ge.dateOfBirth="Date of birth is required";else{const fe=parseInt($);(fe<1900||fe>new Date().getFullYear())&&(ge.dateOfBirth="Please enter a valid year between 1900 and "+new Date().getFullYear());const xe=parseInt(W);(xe<1||xe>12)&&(ge.dateOfBirth="Please enter a valid month (1-12)");const be=parseInt(L);(be<1||be>31)&&(ge.dateOfBirth="Please enter a valid day (1-31)")}return V(ge),Object.keys(ge).length===0},_e=async ge=>{if(ge.preventDefault(),!!Pe())try{const fe={...a,fullName:`${u} ${_}`,dateOfBirth:`${$}-${W.padStart(2,"0")}-${L.padStart(2,"0")}`};await r(fe)}catch(fe){console.error("Sign up error:",fe),it.error("Failed to sign up",{icon:"⚠️"})}};return S.jsx("div",{className:"app-container",children:S.jsx("section",{className:"hero-section min-h-screen flex items-center justify-center",children:S.jsx("div",{className:"container mx-auto py-8",children:S.jsxs("div",{className:"auth-card max-w-xl animate-fade-in",children:[S.jsxs("div",{className:"text-center mb-8",children:[S.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Join BeWithMe"}),S.jsx("p",{className:"text-gray-600 mt-2",children:"Create your account and start connecting"})]}),S.jsxs("form",{onSubmit:_e,className:"space-y-6",children:[S.jsx("div",{className:"flex justify-center mb-6",children:S.jsxs("div",{className:"relative w-32 h-32 rounded-full bg-gray-100 overflow-hidden border-2 border-blue-500",children:[O?S.jsx("img",{src:O,alt:"Profile",className:"w-full h-full object-cover"}):S.jsx("div",{className:"flex items-center justify-center w-full h-full",children:S.jsx(du,{className:"w-16 h-16 text-gray-400"})}),S.jsxs("label",{htmlFor:"picture",className:"absolute inset-0 flex items-center justify-center bg-black bg-opacity-50 opacity-0 hover:opacity-100 cursor-pointer transition",children:[S.jsx("span",{className:"text-white font-medium",children:"Upload"}),S.jsx("input",{id:"picture",type:"file",name:"picture",accept:"image/*",className:"hidden",onChange:pe})]})]})}),S.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[S.jsxs("div",{className:"space-y-2",children:[S.jsx(Rr,{className:"text-black block mb-1",htmlFor:"firstName",children:"First Name"}),S.jsx(wr,{id:"firstName",name:"firstName",value:u,onChange:ge=>f(ge.target.value),placeholder:"First Name",className:"border-red-500",style:{borderColor:F.firstName?"red":"gray"}}),F.firstName&&S.jsx("p",{className:"input-error",children:F.firstName})]}),S.jsxs("div",{className:"space-y-2",children:[S.jsx(Rr,{htmlFor:"lastName",className:"text-black block mb-1",children:"Last Name"}),S.jsx(wr,{id:"lastName",name:"lastName",value:_,onChange:ge=>v(ge.target.value),placeholder:"Last Name",className:F.lastName?"border-red-500":""}),F.lastName&&S.jsx("p",{className:"input-error",children:F.lastName})]})]}),S.jsxs("div",{className:"space-y-2",children:[S.jsx(Rr,{htmlFor:"username",children:"Username"}),S.jsx(wr,{id:"username",name:"username",value:a.username,onChange:ie,placeholder:"Username",className:F.username?"border-red-500":""}),F.username&&S.jsx("p",{className:"input-error",children:F.username})]}),S.jsxs("div",{className:"space-y-2",children:[S.jsx(Rr,{htmlFor:"email",children:"Email"}),S.jsx(wr,{id:"email",name:"email",type:"email",value:a.email,onChange:ie,placeholder:"your@email.com",className:F.email?"border-red-500":""}),F.email&&S.jsx("p",{className:"input-error",children:F.email})]}),S.jsxs("div",{className:"space-y-2",children:[S.jsx(Rr,{htmlFor:"password",children:"Password"}),S.jsxs("div",{className:"relative",children:[S.jsx(wr,{id:"password",name:"password",type:w?"text":"password",value:a.password,onChange:ie,placeholder:"Create a secure password",className:F.password?"border-red-500":""}),S.jsx("button",{type:"button",className:"absolute right-3 top-1/2 -translate-y-1/2",onClick:()=>C(!w),children:w?S.jsx(Zd,{className:"h-5 w-5 text-gray-500"}):S.jsx(eu,{className:"h-5 w-5 text-gray-500"})})]}),F.password&&S.jsx("p",{className:"input-error",children:F.password})]}),S.jsxs("div",{className:"space-y-2",children:[S.jsx(Rr,{htmlFor:"confirmPassword",children:"Confirm Password"}),S.jsxs("div",{className:"relative",children:[S.jsx(wr,{id:"confirmPassword",name:"confirmPassword",type:N?"text":"password",value:a.confirmPassword,onChange:ie,placeholder:"Confirm your password",className:F.confirmPassword?"border-red-500":""}),S.jsx("button",{type:"button",className:"absolute right-3 top-1/2 -translate-y-1/2",onClick:()=>D(!N),children:N?S.jsx(Zd,{className:"h-5 w-5 text-gray-500"}):S.jsx(eu,{className:"h-5 w-5 text-gray-500"})})]}),F.confirmPassword&&S.jsx("p",{className:"input-error",children:F.confirmPassword})]}),S.jsxs("div",{className:"grid grid-cols-1 text-black md:grid-cols-2 gap-6",children:[S.jsxs("div",{className:"space-y-2",children:[S.jsx(Rr,{htmlFor:"gender",children:"Gender"}),S.jsxs(Y9,{name:"gender",onValueChange:ge=>ce("gender",ge),children:[S.jsx(yO,{className:F.gender?"border-red-500":"",children:S.jsx(Jve,{placeholder:"Select gender"})}),S.jsxs(SO,{children:[S.jsx(Ng,{value:"male",children:"Male"}),S.jsx(Ng,{value:"female",children:"Female"})]})]}),F.gender&&S.jsx("p",{className:"input-error",children:F.gender})]}),S.jsxs("div",{className:"space-y-2",children:[S.jsxs(Rr,{className:"flex items-center",children:[S.jsx(sH,{className:"h-4 w-4 mr-2"}),"Date of Birth"]}),S.jsxs("div",{className:"flex gap-2",children:[S.jsx(wr,{id:"day",placeholder:"DD",maxLength:2,value:L,onChange:ge=>{const fe=ge.target.value.replace(/\D/g,"");(fe===""||parseInt(fe)>0&&parseInt(fe)<=31)&&(B(fe),F.dateOfBirth&&V(xe=>({...xe,dateOfBirth:""})))},className:F.dateOfBirth?"border-red-500":""}),S.jsx(wr,{id:"month",placeholder:"MM",maxLength:2,value:W,onChange:ge=>{const fe=ge.target.value.replace(/\D/g,"");(fe===""||parseInt(fe)>0&&parseInt(fe)<=12)&&(z(fe),F.dateOfBirth&&V(xe=>({...xe,dateOfBirth:""})))},className:F.dateOfBirth?"border-red-500":""}),S.jsx(wr,{id:"year",placeholder:"YYYY",maxLength:4,value:$,onChange:ge=>{const fe=ge.target.value.replace(/\D/g,"");te(fe),F.dateOfBirth&&V(xe=>({...xe,dateOfBirth:""}))},className:F.dateOfBirth?"border-red-500":""})]}),F.dateOfBirth&&S.jsx("p",{className:"input-error",children:F.dateOfBirth})]})]}),S.jsx("input",{type:"hidden",name:"role",value:a.role}),S.jsx(sn,{type:"submit",className:"w-full btn-primary py-6 text-lg",disabled:i,children:i?"Creating account...":"Create Account"})]}),S.jsx("div",{className:"mt-6 text-center",children:S.jsxs("p",{className:"text-gray-600",children:["Already have an account?"," ",S.jsx(Co,{to:"/login",className:"text-blue-500 hover:underline font-medium",children:"Log in"})]})})]})})})})};var TO="Checkbox",[nye,X0e]=lu(TO),[rye,iye]=nye(TO),$9=k.forwardRef((r,i)=>{const{__scopeCheckbox:a,name:l,checked:u,defaultChecked:f,required:_,disabled:v,value:w="on",onCheckedChange:C,form:N,...D}=r,[O,G]=k.useState(null),F=Tn(i,$=>G($)),V=k.useRef(!1),L=O?N||!!O.closest("form"):!0,[B=!1,W]=Cp({prop:u,defaultProp:f,onChange:C}),z=k.useRef(B);return k.useEffect(()=>{const $=O==null?void 0:O.form;if($){const te=()=>W(z.current);return $.addEventListener("reset",te),()=>$.removeEventListener("reset",te)}},[O,W]),S.jsxs(rye,{scope:a,state:B,disabled:v,children:[S.jsx(Bt.button,{type:"button",role:"checkbox","aria-checked":Il(B)?"mixed":B,"aria-required":_,"data-state":Z9(B),"data-disabled":v?"":void 0,disabled:v,value:w,...D,ref:F,onKeyDown:At(r.onKeyDown,$=>{$.key==="Enter"&&$.preventDefault()}),onClick:At(r.onClick,$=>{W(te=>Il(te)?!0:!te),L&&(V.current=$.isPropagationStopped(),V.current||$.stopPropagation())})}),L&&S.jsx(oye,{control:O,bubbles:!V.current,name:l,value:w,checked:B,required:_,disabled:v,form:N,style:{transform:"translateX(-100%)"},defaultChecked:Il(f)?!1:f})]})});$9.displayName=TO;var J9="CheckboxIndicator",Q9=k.forwardRef((r,i)=>{const{__scopeCheckbox:a,forceMount:l,...u}=r,f=iye(J9,a);return S.jsx(qs,{present:l||Il(f.state)||f.state===!0,children:S.jsx(Bt.span,{"data-state":Z9(f.state),"data-disabled":f.disabled?"":void 0,...u,ref:i,style:{pointerEvents:"none",...r.style}})})});Q9.displayName=J9;var oye=r=>{const{control:i,checked:a,bubbles:l=!0,defaultChecked:u,...f}=r,_=k.useRef(null),v=r9(a),w=OH(i);k.useEffect(()=>{const N=_.current,D=window.HTMLInputElement.prototype,G=Object.getOwnPropertyDescriptor(D,"checked").set;if(v!==a&&G){const F=new Event("click",{bubbles:l});N.indeterminate=Il(a),G.call(N,Il(a)?!1:a),N.dispatchEvent(F)}},[v,a,l]);const C=k.useRef(Il(a)?!1:a);return S.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:u??C.current,...f,tabIndex:-1,ref:_,style:{...r.style,...w,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function Il(r){return r==="indeterminate"}function Z9(r){return Il(r)?"indeterminate":r?"checked":"unchecked"}var e7=$9,sye=Q9;const t7=k.forwardRef(({className:r,...i},a)=>S.jsx(e7,{ref:a,className:Lt("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",r),...i,children:S.jsx(sye,{className:Lt("flex items-center justify-center text-current"),children:S.jsx(zN,{className:"h-4 w-4"})})}));t7.displayName=e7.displayName;var wO="Dialog",[n7,$0e]=lu(wO),[aye,$s]=n7(wO),r7=r=>{const{__scopeDialog:i,children:a,open:l,defaultOpen:u,onOpenChange:f,modal:_=!0}=r,v=k.useRef(null),w=k.useRef(null),[C=!1,N]=Cp({prop:l,defaultProp:u,onChange:f});return S.jsx(aye,{scope:i,triggerRef:v,contentRef:w,contentId:Hd(),titleId:Hd(),descriptionId:Hd(),open:C,onOpenChange:N,onOpenToggle:k.useCallback(()=>N(D=>!D),[N]),modal:_,children:a})};r7.displayName=wO;var i7="DialogTrigger",cye=k.forwardRef((r,i)=>{const{__scopeDialog:a,...l}=r,u=$s(i7,a),f=Tn(i,u.triggerRef);return S.jsx(Bt.button,{type:"button","aria-haspopup":"dialog","aria-expanded":u.open,"aria-controls":u.contentId,"data-state":bO(u.open),...l,ref:f,onClick:At(r.onClick,u.onOpenToggle)})});cye.displayName=i7;var RO="DialogPortal",[lye,o7]=n7(RO,{forceMount:void 0}),s7=r=>{const{__scopeDialog:i,forceMount:a,children:l,container:u}=r,f=$s(RO,i);return S.jsx(lye,{scope:i,forceMount:a,children:k.Children.map(l,_=>S.jsx(qs,{present:a||f.open,children:S.jsx(zS,{asChild:!0,container:u,children:_})}))})};s7.displayName=RO;var TS="DialogOverlay",a7=k.forwardRef((r,i)=>{const a=o7(TS,r.__scopeDialog),{forceMount:l=a.forceMount,...u}=r,f=$s(TS,r.__scopeDialog);return f.modal?S.jsx(qs,{present:l||f.open,children:S.jsx(dye,{...u,ref:i})}):null});a7.displayName=TS;var dye=k.forwardRef((r,i)=>{const{__scopeDialog:a,...l}=r,u=$s(TS,a);return S.jsx(EO,{as:Qd,allowPinchZoom:!0,shards:[u.contentRef],children:S.jsx(Bt.div,{"data-state":bO(u.open),...l,ref:i,style:{pointerEvents:"auto",...l.style}})})}),ou="DialogContent",c7=k.forwardRef((r,i)=>{const a=o7(ou,r.__scopeDialog),{forceMount:l=a.forceMount,...u}=r,f=$s(ou,r.__scopeDialog);return S.jsx(qs,{present:l||f.open,children:f.modal?S.jsx(uye,{...u,ref:i}):S.jsx(hye,{...u,ref:i})})});c7.displayName=ou;var uye=k.forwardRef((r,i)=>{const a=$s(ou,r.__scopeDialog),l=k.useRef(null),u=Tn(i,a.contentRef,l);return k.useEffect(()=>{const f=l.current;if(f)return o9(f)},[]),S.jsx(l7,{...r,ref:u,trapFocus:a.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:At(r.onCloseAutoFocus,f=>{var _;f.preventDefault(),(_=a.triggerRef.current)==null||_.focus()}),onPointerDownOutside:At(r.onPointerDownOutside,f=>{const _=f.detail.originalEvent,v=_.button===0&&_.ctrlKey===!0;(_.button===2||v)&&f.preventDefault()}),onFocusOutside:At(r.onFocusOutside,f=>f.preventDefault())})}),hye=k.forwardRef((r,i)=>{const a=$s(ou,r.__scopeDialog),l=k.useRef(!1),u=k.useRef(!1);return S.jsx(l7,{...r,ref:i,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:f=>{var _,v;(_=r.onCloseAutoFocus)==null||_.call(r,f),f.defaultPrevented||(l.current||(v=a.triggerRef.current)==null||v.focus(),f.preventDefault()),l.current=!1,u.current=!1},onInteractOutside:f=>{var w,C;(w=r.onInteractOutside)==null||w.call(r,f),f.defaultPrevented||(l.current=!0,f.detail.originalEvent.type==="pointerdown"&&(u.current=!0));const _=f.target;((C=a.triggerRef.current)==null?void 0:C.contains(_))&&f.preventDefault(),f.detail.originalEvent.type==="focusin"&&u.current&&f.preventDefault()}})}),l7=k.forwardRef((r,i)=>{const{__scopeDialog:a,trapFocus:l,onOpenAutoFocus:u,onCloseAutoFocus:f,..._}=r,v=$s(ou,a),w=k.useRef(null),C=Tn(i,w);return t9(),S.jsxs(S.Fragment,{children:[S.jsx(_O,{asChild:!0,loop:!0,trapped:l,onMountAutoFocus:u,onUnmountAutoFocus:f,children:S.jsx(jg,{role:"dialog",id:v.contentId,"aria-describedby":v.descriptionId,"aria-labelledby":v.titleId,"data-state":bO(v.open),..._,ref:C,onDismiss:()=>v.onOpenChange(!1)})}),S.jsxs(S.Fragment,{children:[S.jsx(pye,{titleId:v.titleId}),S.jsx(mye,{contentRef:w,descriptionId:v.descriptionId})]})]})}),CO="DialogTitle",d7=k.forwardRef((r,i)=>{const{__scopeDialog:a,...l}=r,u=$s(CO,a);return S.jsx(Bt.h2,{id:u.titleId,...l,ref:i})});d7.displayName=CO;var u7="DialogDescription",h7=k.forwardRef((r,i)=>{const{__scopeDialog:a,...l}=r,u=$s(u7,a);return S.jsx(Bt.p,{id:u.descriptionId,...l,ref:i})});h7.displayName=u7;var p7="DialogClose",f7=k.forwardRef((r,i)=>{const{__scopeDialog:a,...l}=r,u=$s(p7,a);return S.jsx(Bt.button,{type:"button",...l,ref:i,onClick:At(r.onClick,()=>u.onOpenChange(!1))})});f7.displayName=p7;function bO(r){return r?"open":"closed"}var m7="DialogTitleWarning",[J0e,g7]=uue(m7,{contentName:ou,titleName:CO,docsSlug:"dialog"}),pye=({titleId:r})=>{const i=g7(m7),a=`\`${i.contentName}\` requires a \`${i.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${i.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${i.docsSlug}`;return k.useEffect(()=>{r&&(document.getElementById(r)||console.error(a))},[a,r]),null},fye="DialogDescriptionWarning",mye=({contentRef:r,descriptionId:i})=>{const l=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${g7(fye).contentName}}.`;return k.useEffect(()=>{var f;const u=(f=r.current)==null?void 0:f.getAttribute("aria-describedby");i&&u&&(document.getElementById(i)||console.warn(l))},[l,r,i]),null},gye=r7,_ye=s7,_7=a7,E7=c7,v7=d7,y7=h7,Eye=f7;const vye=gye,yye=_ye,S7=k.forwardRef(({className:r,...i},a)=>S.jsx(_7,{ref:a,className:Lt("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",r),...i}));S7.displayName=_7.displayName;const T7=k.forwardRef(({className:r,children:i,...a},l)=>S.jsxs(yye,{children:[S.jsx(S7,{}),S.jsxs(E7,{ref:l,className:Lt("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",r),...a,children:[i,S.jsxs(Eye,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[S.jsx(qN,{className:"h-4 w-4"}),S.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));T7.displayName=E7.displayName;const Uy=({className:r,...i})=>S.jsx("div",{className:Lt("flex flex-col space-y-1.5 text-center sm:text-left",r),...i});Uy.displayName="DialogHeader";const jy=k.forwardRef(({className:r,...i},a)=>S.jsx(v7,{ref:a,className:Lt("text-lg font-semibold leading-none tracking-tight",r),...i}));jy.displayName=v7.displayName;const Vy=k.forwardRef(({className:r,...i},a)=>S.jsx(y7,{ref:a,className:Lt("text-sm text-muted-foreground",r),...i}));Vy.displayName=y7.displayName;const Sye=({isOpen:r,onClose:i})=>{const[a,l]=k.useState(0),[u,f]=k.useState(""),[_,v]=k.useState(["","","","","",""]),[w,C]=k.useState(""),[N,D]=k.useState(""),[O,G]=k.useState(!1),[F,V]=k.useState(!1),[L,B]=k.useState(""),[W,z]=k.useState(""),$=()=>{i(),setTimeout(()=>{l(0),f(""),v(["","","","","",""]),C(""),D(""),B("")},300)},te=async()=>{var _e,ge;if(!u){B("Please enter your email address");return}if(!/\S+@\S+\.\S+/.test(u)){B("Please enter a valid email address");return}try{await _l.sendCode(u),it.success("code sent to your email"),l(1)}catch(fe){if($t.isAxiosError(fe)){const xe=((ge=(_e=fe.response)==null?void 0:_e.data)==null?void 0:ge.message)||"Failed to send verification code";it.error(xe)}throw fe}},ie=async()=>{var ge,fe;const _e=_.join("");if(_e.length!==6){it.error("Please enter the complete verification code");return}try{const xe=await _l.verifyResetCode(u,_e);xe&&(console.log("Response: ",xe),z(xe)),it.success("Code verified successfully"),l(2)}catch(xe){if($t.isAxiosError(xe)){const be=((fe=(ge=xe.response)==null?void 0:ge.data)==null?void 0:fe.message)||"Failed to verify verification code";it.error(be)}throw xe}},ce=async()=>{var _e,ge;if(!w){it.error("Please enter a new password");return}if(w!==N){it.error("Passwords do not match");return}try{await _l.resetPassword(u,W,w,N)&&(it.success("Password reset successfully"),$())}catch(fe){if($t.isAxiosError(fe)){const xe=((ge=(_e=fe.response)==null?void 0:_e.data)==null?void 0:ge.message)||"Failed to reset password";it.error(xe)}throw fe}},pe=(_e,ge)=>{ge.length>1&&(ge=ge.charAt(0));const fe=[..._];if(fe[_e]=ge,v(fe),ge&&_e<5){const xe=document.getElementById(`code-${_e+1}`);xe&&xe.focus()}},Pe=()=>{it.info("New verification code sent")};return S.jsx(vye,{open:r,onOpenChange:_e=>!_e&&$(),children:S.jsxs(T7,{className:"sm:max-w-md",children:[S.jsx("div",{className:"absolute right-4 top-4",children:S.jsx("button",{onClick:$,className:"rounded-full p-1 hover:bg-gray-100",children:S.jsx(qN,{className:"h-4 w-4"})})}),a===0&&S.jsxs(S.Fragment,{children:[S.jsxs(Uy,{children:[S.jsx(jy,{className:"text-center text-xl",children:"Forgot Password?"}),S.jsx(Vy,{className:"text-center",children:"No worries, we got you."})]}),S.jsx("div",{className:"flex justify-center py-6",children:S.jsx("img",{src:"/lovable-uploads/8dda62a0-0775-4011-9499-0346362168c6.png",alt:"Forgot Password",className:"h-40"})}),S.jsxs("div",{className:"space-y-4",children:[S.jsxs("div",{className:"space-y-2",children:[S.jsx(Rr,{htmlFor:"email",children:"Email"}),S.jsx(wr,{id:"email",type:"email",placeholder:"Enter your email",value:u,onChange:_e=>{f(_e.target.value),B("")},className:L?"border-red-500":""}),L&&S.jsx("p",{className:"text-red-500 text-sm",children:L})]}),S.jsx(sn,{className:"w-full btn-primary",onClick:te,children:"Send Code"})]})]}),a===1&&S.jsxs(S.Fragment,{children:[S.jsxs(Uy,{children:[S.jsx(jy,{className:"text-center text-xl",children:"Verification"}),S.jsx(Vy,{className:"text-center",children:"Enter the code to continue."})]}),S.jsx("div",{className:"flex justify-center py-6",children:S.jsx("img",{src:"/lovable-uploads/52a5f0ea-b476-4edd-934d-56e597634c0a.png",alt:"Verification",className:"h-40"})}),S.jsxs("p",{className:"text-center text-sm mb-2",children:["We sent a code to",S.jsx("br",{}),S.jsx("span",{className:"font-medium",children:u})]}),S.jsx("div",{className:"flex justify-center gap-2 my-6",children:_.map((_e,ge)=>S.jsx(wr,{id:`code-${ge}`,value:_e,onChange:fe=>pe(ge,fe.target.value),className:"h-12 w-12 text-center text-xl",maxLength:1,autoFocus:ge===0},ge))}),S.jsx(sn,{className:"w-full btn-primary",onClick:ie,children:"Continue"}),S.jsx("div",{className:"text-center mt-4",children:S.jsxs("p",{className:"text-sm text-gray-500",children:["Didn't receive the code? "," ",S.jsx("button",{className:"text-blue-500 hover:underline",onClick:Pe,children:"Send Again"})]})})]}),a===2&&S.jsxs(S.Fragment,{children:[S.jsxs(Uy,{children:[S.jsx(jy,{className:"text-center text-xl",children:"Set New Password"}),S.jsx(Vy,{className:"text-center",children:"Create a password."})]}),S.jsx("div",{className:"flex justify-center py-6",children:S.jsx("img",{src:"/lovable-uploads/4ae0a1c4-2b23-42c8-97f8-46079ac76a97.png",alt:"Reset Password",className:"h-40"})}),S.jsxs("div",{className:"space-y-4",children:[S.jsxs("div",{className:"space-y-2",children:[S.jsx(Rr,{htmlFor:"new-password",children:"New Password"}),S.jsxs("div",{className:"relative",children:[S.jsx(wr,{id:"new-password",type:O?"text":"password",placeholder:"Create new password",value:w,onChange:_e=>C(_e.target.value)}),S.jsx("button",{type:"button",className:"absolute right-3 top-1/2 -translate-y-1/2",onClick:()=>G(!O),children:O?S.jsx(Zd,{className:"h-4 w-4 text-gray-500"}):S.jsx(eu,{className:"h-4 w-4 text-gray-500"})})]})]}),S.jsxs("div",{className:"space-y-2",children:[S.jsx(Rr,{htmlFor:"confirm-password",children:"Confirm Password"}),S.jsxs("div",{className:"relative",children:[S.jsx(wr,{id:"confirm-password",type:F?"text":"password",placeholder:"Re-enter password",value:N,onChange:_e=>D(_e.target.value)}),S.jsx("button",{type:"button",className:"absolute right-3 top-1/2 -translate-y-1/2",onClick:()=>V(!F),children:F?S.jsx(Zd,{className:"h-4 w-4 text-gray-500"}):S.jsx(eu,{className:"h-4 w-4 text-gray-500"})})]})]}),S.jsx(sn,{className:"w-full btn-primary",onClick:ce,children:"Reset Password"}),S.jsx("div",{className:"text-center",children:S.jsx("button",{className:"text-sm text-blue-500 hover:underline",onClick:$,children:"Reset password later?"})})]})]})]})})},Tye={usernameOrEmail:"",password:"",rememberMe:!1},wye=()=>{const{login:r,isLoading:i}=hu(),[a,l]=k.useState(Tye),[u,f]=k.useState(!1),[_,v]=k.useState({}),[w,C]=k.useState(!1),N=F=>{const{name:V,value:L}=F.target;l(B=>({...B,[V]:L})),_[V]&&v(B=>({...B,[V]:""}))},D=F=>{l(V=>({...V,rememberMe:F}))},O=()=>{const F={};return a.usernameOrEmail||(F.usernameOrEmail="Username or email is required"),a.password||(F.password="Password is required"),v(F),Object.keys(F).length===0},G=async F=>{if(F.preventDefault(),!!O())try{await r(a)}catch(V){console.error("Login error:",V)}};return S.jsxs("div",{className:"app-container",children:[S.jsx("section",{className:"hero-section min-h-screen flex items-center justify-center",children:S.jsx("div",{className:"container mx-auto py-8",children:S.jsxs("div",{className:"auth-card animate-fade-in",children:[S.jsxs("div",{className:"text-center mb-8",children:[S.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Welcome Back"}),S.jsx("p",{className:"text-gray-600 mt-2",children:"Log in to your account"})]}),S.jsxs("form",{onSubmit:G,children:[S.jsxs("div",{className:"space-y-4",children:[S.jsxs("div",{className:"space-y-2",children:[S.jsx(Rr,{htmlFor:"usernameOrEmail",children:"Email or Username"}),S.jsx(wr,{id:"usernameOrEmail",name:"usernameOrEmail",value:a.usernameOrEmail,onChange:N,placeholder:"Enter your email or username",className:_.usernameOrEmail?"border-red-500":""}),_.usernameOrEmail&&S.jsx("p",{className:"input-error",children:_.usernameOrEmail})]}),S.jsxs("div",{className:"space-y-2",children:[S.jsxs("div",{className:"flex justify-between items-center",children:[S.jsx(Rr,{htmlFor:"password",children:"Password"}),S.jsx("button",{type:"button",onClick:()=>C(!0),className:"text-sm font-medium text-blue-500 hover:underline",children:"Forgot password?"})]}),S.jsxs("div",{className:"relative",children:[S.jsx(wr,{id:"password",name:"password",type:u?"text":"password",value:a.password,onChange:N,placeholder:"Enter your password",className:_.password?"border-red-500":""}),S.jsx("button",{type:"button",className:"absolute right-3 top-1/2 -translate-y-1/2",onClick:()=>f(!u),children:u?S.jsx(Zd,{className:"h-5 w-5 text-gray-500"}):S.jsx(eu,{className:"h-5 w-5 text-gray-500"})})]}),_.password&&S.jsx("p",{className:"input-error",children:_.password})]}),S.jsxs("div",{className:"flex items-center space-x-2",children:[S.jsx(t7,{id:"rememberMe",checked:a.rememberMe,onCheckedChange:D}),S.jsx(Rr,{htmlFor:"rememberMe",className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:"Remember me"})]}),S.jsx(sn,{type:"submit",className:"w-full btn-primary py-6 text-lg",disabled:i,children:i?"Logging in...":"Log In"})]}),S.jsxs("div",{className:"relative flex items-center justify-center mt-6",children:[S.jsx("div",{className:"border-t border-gray-300 flex-grow"}),S.jsx("span",{className:"mx-4 text-gray-500 text-sm",children:"or continue with"}),S.jsx("div",{className:"border-t border-gray-300 flex-grow"})]}),S.jsxs("div",{className:"grid grid-cols-3 gap-3 mt-6",children:[S.jsx(sn,{type:"button",variant:"outline",className:"flex items-center justify-center space-x-2 border hover:bg-gray-50",children:S.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",children:[S.jsx("path",{d:"M20.283 10.356h-8.327v3.451h4.792c-.446 2.193-2.313 3.453-4.792 3.453a5.27 5.27 0 0 1-5.279-5.28 5.27 5.27 0 0 1 5.279-5.279c1.259 0 2.397.447 3.29 1.178l2.6-2.599c-1.584-1.381-3.615-2.233-5.89-2.233a8.908 8.908 0 0 0-8.934 8.934 8.907 8.907 0 0 0 8.934 8.934c4.467 0 8.529-3.249 8.529-8.934 0-.528-.081-1.097-.202-1.625z",fill:"#4285F4"}),S.jsx("path",{d:"M12.956 16.26c-1.553 0-2.884-.926-3.55-2.237l-2.919 1.208c1.268 2.693 3.964 4.548 6.469 4.548 1.743 0 3.397-.561 4.8-1.619l-2.532-1.963c-.874.58-1.879.896-2.893.896",fill:"#34A853"}),S.jsx("path",{d:"M15.95 5.102l-3.191 2.73c.971 1.022 1.516 2.383 1.516 3.818 0 1.118-.341 2.158-.932 3.033l2.566 1.982c1.288-1.443 2.074-3.34 2.074-5.421 0-.302-.022-.6-.065-.896z",fill:"#FBBC05"}),S.jsx("path",{d:"M5.192 13.025l2.897-1.205c-.471-1.396-1.76-2.394-3.233-2.394-1.862 0-3.483 1.278-4.004 3.053-.136.466-.214.957-.214 1.47 0 .511.078.999.213 1.464.52 1.775 2.142 3.054 4.005 3.054 1.093 0 2.027-.406 2.73-1.096z",fill:"#EA4335"})]})}),S.jsx(sn,{type:"button",variant:"outline",className:"flex items-center justify-center space-x-2 border hover:bg-gray-50",children:S.jsx("svg",{className:"w-5 h-5 text-[#1877F2]",fill:"currentColor",viewBox:"0 0 24 24",children:S.jsx("path",{d:"M9.045 23.0327H13.4951V12.9658H16.9636L17.334 8.93986H13.4951V6.49372C13.4951 5.35278 13.7879 4.6904 15.3522 4.6904H17.4233V1.08551C17.0826 1.0404 15.8179 0.941895 14.2949 0.941895C11.1134 0.941895 8.94462 2.89243 8.94462 6.16186V8.93986H5.57666V12.9658H8.94462V23.0327H9.045Z"})})}),S.jsx(sn,{type:"button",variant:"outline",className:"flex items-center justify-center space-x-2 border hover:bg-gray-50",children:S.jsx("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",children:S.jsx("path",{d:"M17.5557 12.4556C17.5557 10.5673 16.348 8.86355 14.4645 8.12054C14.7737 7.27872 15.6193 6.69323 16.5976 6.69323C18.0057 6.69323 19.1508 7.83833 19.1508 9.24647C19.1508 10.4342 18.3052 11.4449 17.2227 11.7197C17.4693 11.9519 17.5557 12.2267 17.5557 12.4556ZM12.9713 6.18042C12.9713 4.29207 11.4152 2.73596 9.52679 2.73596C7.63843 2.73596 6.08232 4.29207 6.08232 6.18042C6.08232 7.68108 7.03691 8.94311 8.36226 9.41233V6.80949C8.36226 6.2664 8.79789 5.83077 9.34098 5.83077C9.88407 5.83077 10.3197 6.2664 10.3197 6.80949V9.41233C11.645 8.94311 12.9713 7.68108 12.9713 6.18042ZM21.1078 16.7124V13.5102C21.1078 12.9671 20.6722 12.5315 20.129 12.5315H19.7145C19.5305 11.213 18.3854 10.2584 17.0392 10.2584C15.1508 10.2584 13.6163 11.7929 13.6163 13.6813C13.6163 15.5697 15.1508 17.1042 17.0392 17.1042C17.9962 17.1042 18.8418 16.6994 19.4273 16.0514H20.129C20.6722 16.0514 21.1078 15.6158 21.1078 15.0727V15.0456C21.1078 14.5296 21.1078 14.5296 21.1078 14.5025C21.1078 14.4755 21.1078 14.4755 21.1078 14.4484V16.7124H21.2642C21.8073 16.7124 22.2429 17.148 22.2429 17.6911C22.2429 18.2342 21.8073 18.6698 21.2642 18.6698H13.3415C13.136 18.6698 12.9497 18.6698 12.7635 18.6698H9.34098H5.91846H2.49593C1.95285 18.6698 1.51722 18.2342 1.51722 17.6911C1.51722 17.148 1.95285 16.7124 2.49593 16.7124H2.65234V11.2391H2.49593C1.95285 11.2391 1.51722 10.8035 1.51722 10.2604C1.51722 9.71733 1.95285 9.2817 2.49593 9.2817H9.34098C9.88407 9.2817 10.3197 9.71733 10.3197 10.2604C10.3197 10.8035 9.88407 11.2391 9.34098 11.2391H9.18457V16.7124H12.9713V14.1079C12.9713 13.0972 12.1257 12.2516 11.115 12.2516H11.0671C10.524 12.2516 10.0883 11.816 10.0883 11.2729C10.0883 10.7298 10.524 10.2942 11.0671 10.2942H11.115C13.2269 10.2942 14.9306 11.998 14.9306 14.1079V16.7124H16.0757V14.977C16.0757 14.4339 16.5114 13.9983 17.0545 13.9983C17.5976 13.9983 18.0332 14.4339 18.0332 14.977V16.7124H21.1078ZM6.6254 11.2391H6.46899V16.7124H6.6254C7.1685 16.7124 7.60412 17.148 7.60412 17.6911C7.60412 18.2342 7.1685 18.6698 6.6254 18.6698C6.08232 18.6698 5.64669 18.2342 5.64669 17.6911V16.7124H4.81411V17.6911C4.81411 18.2342 4.37848 18.6698 3.83539 18.6698C3.29231 18.6698 2.85668 18.2342 2.85668 17.6911C2.85668 17.148 3.29231 16.7124 3.83539 16.7124H3.99181V11.2391H3.83539C3.29231 11.2391 2.85668 10.8035 2.85668 10.2604C2.85668 9.71733 3.29231 9.2817 3.83539 9.2817H6.6254C7.1685 9.2817 7.60412 9.71733 7.60412 10.2604C7.60412 10.8035 7.1685 11.2391 6.6254 11.2391Z",fill:"black"})})})]})]}),S.jsx("div",{className:"mt-6 text-center",children:S.jsxs("p",{className:"text-gray-600",children:["Don't have an account?"," ",S.jsx(Co,{to:"/signup",className:"text-blue-500 hover:underline font-medium",children:"Sign up"})]})})]})})}),S.jsx(Sye,{isOpen:w,onClose:()=>C(!1)})]})},Wp=k.forwardRef(({className:r,...i},a)=>S.jsx("div",{ref:a,className:Lt("rounded-lg border bg-card text-card-foreground shadow-sm",r),...i}));Wp.displayName="Card";const w7=k.forwardRef(({className:r,...i},a)=>S.jsx("div",{ref:a,className:Lt("flex flex-col space-y-1.5 p-6",r),...i}));w7.displayName="CardHeader";const R7=k.forwardRef(({className:r,...i},a)=>S.jsx("h3",{ref:a,className:Lt("text-2xl font-semibold leading-none tracking-tight",r),...i}));R7.displayName="CardTitle";const C7=k.forwardRef(({className:r,...i},a)=>S.jsx("p",{ref:a,className:Lt("text-sm text-muted-foreground",r),...i}));C7.displayName="CardDescription";const b7=k.forwardRef(({className:r,...i},a)=>S.jsx("div",{ref:a,className:Lt("p-6 pt-0",r),...i}));b7.displayName="CardContent";const I7=k.forwardRef(({className:r,...i},a)=>S.jsx("div",{ref:a,className:Lt("flex items-center p-6 pt-0",r),...i}));I7.displayName="CardFooter";function zn(r){const i=Object.prototype.toString.call(r);return r instanceof Date||typeof r=="object"&&i==="[object Date]"?new r.constructor(+r):typeof r=="number"||i==="[object Number]"||typeof r=="string"||i==="[object String]"?new Date(r):new Date(NaN)}function xl(r,i){return r instanceof Date?new r.constructor(i):new Date(i)}const A7=6048e5,Rye=864e5,gy=43200,X5=1440;let Cye={};function Kg(){return Cye}function Og(r,i){var v,w,C,N;const a=Kg(),l=(i==null?void 0:i.weekStartsOn)??((w=(v=i==null?void 0:i.locale)==null?void 0:v.options)==null?void 0:w.weekStartsOn)??a.weekStartsOn??((N=(C=a.locale)==null?void 0:C.options)==null?void 0:N.weekStartsOn)??0,u=zn(r),f=u.getDay(),_=(f<l?7:0)+f-l;return u.setDate(u.getDate()-_),u.setHours(0,0,0,0),u}function wS(r){return Og(r,{weekStartsOn:1})}function N7(r){const i=zn(r),a=i.getFullYear(),l=xl(r,0);l.setFullYear(a+1,0,4),l.setHours(0,0,0,0);const u=wS(l),f=xl(r,0);f.setFullYear(a,0,4),f.setHours(0,0,0,0);const _=wS(f);return i.getTime()>=u.getTime()?a+1:i.getTime()>=_.getTime()?a:a-1}function $5(r){const i=zn(r);return i.setHours(0,0,0,0),i}function RS(r){const i=zn(r),a=new Date(Date.UTC(i.getFullYear(),i.getMonth(),i.getDate(),i.getHours(),i.getMinutes(),i.getSeconds(),i.getMilliseconds()));return a.setUTCFullYear(i.getFullYear()),+r-+a}function bye(r,i){const a=$5(r),l=$5(i),u=+a-RS(a),f=+l-RS(l);return Math.round((u-f)/Rye)}function Iye(r){const i=N7(r),a=xl(r,0);return a.setFullYear(i,0,4),a.setHours(0,0,0,0),wS(a)}function Fy(r,i){const a=zn(r),l=zn(i),u=a.getTime()-l.getTime();return u<0?-1:u>0?1:u}function Aye(r){return xl(r,Date.now())}function Nye(r){return r instanceof Date||typeof r=="object"&&Object.prototype.toString.call(r)==="[object Date]"}function Oye(r){if(!Nye(r)&&typeof r!="number")return!1;const i=zn(r);return!isNaN(Number(i))}function Pye(r,i){const a=zn(r),l=zn(i),u=a.getFullYear()-l.getFullYear(),f=a.getMonth()-l.getMonth();return u*12+f}function Dye(r){return i=>{const l=(r?Math[r]:Math.trunc)(i);return l===0?0:l}}function kye(r,i){return+zn(r)-+zn(i)}function xye(r){const i=zn(r);return i.setHours(23,59,59,999),i}function Lye(r){const i=zn(r),a=i.getMonth();return i.setFullYear(i.getFullYear(),a+1,0),i.setHours(23,59,59,999),i}function Mye(r){const i=zn(r);return+xye(i)==+Lye(i)}function Uye(r,i){const a=zn(r),l=zn(i),u=Fy(a,l),f=Math.abs(Pye(a,l));let _;if(f<1)_=0;else{a.getMonth()===1&&a.getDate()>27&&a.setDate(30),a.setMonth(a.getMonth()-u*f);let v=Fy(a,l)===-u;Mye(zn(r))&&f===1&&Fy(r,l)===1&&(v=!1),_=u*(f-Number(v))}return _===0?0:_}function jye(r,i,a){const l=kye(r,i)/1e3;return Dye(a==null?void 0:a.roundingMethod)(l)}function Vye(r){const i=zn(r),a=xl(r,0);return a.setFullYear(i.getFullYear(),0,1),a.setHours(0,0,0,0),a}const Fye={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},Bye=(r,i,a)=>{let l;const u=Fye[r];return typeof u=="string"?l=u:i===1?l=u.one:l=u.other.replace("{{count}}",i.toString()),a!=null&&a.addSuffix?a.comparison&&a.comparison>0?"in "+l:l+" ago":l};function wI(r){return(i={})=>{const a=i.width?String(i.width):r.defaultWidth;return r.formats[a]||r.formats[r.defaultWidth]}}const Wye={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},Hye={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},Gye={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},zye={date:wI({formats:Wye,defaultWidth:"full"}),time:wI({formats:Hye,defaultWidth:"full"}),dateTime:wI({formats:Gye,defaultWidth:"full"})},Kye={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},Yye=(r,i,a,l)=>Kye[r];function Mm(r){return(i,a)=>{const l=a!=null&&a.context?String(a.context):"standalone";let u;if(l==="formatting"&&r.formattingValues){const _=r.defaultFormattingWidth||r.defaultWidth,v=a!=null&&a.width?String(a.width):_;u=r.formattingValues[v]||r.formattingValues[_]}else{const _=r.defaultWidth,v=a!=null&&a.width?String(a.width):r.defaultWidth;u=r.values[v]||r.values[_]}const f=r.argumentCallback?r.argumentCallback(i):i;return u[f]}}const qye={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},Xye={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},$ye={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},Jye={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},Qye={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},Zye={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},eSe=(r,i)=>{const a=Number(r),l=a%100;if(l>20||l<10)switch(l%10){case 1:return a+"st";case 2:return a+"nd";case 3:return a+"rd"}return a+"th"},tSe={ordinalNumber:eSe,era:Mm({values:qye,defaultWidth:"wide"}),quarter:Mm({values:Xye,defaultWidth:"wide",argumentCallback:r=>r-1}),month:Mm({values:$ye,defaultWidth:"wide"}),day:Mm({values:Jye,defaultWidth:"wide"}),dayPeriod:Mm({values:Qye,defaultWidth:"wide",formattingValues:Zye,defaultFormattingWidth:"wide"})};function Um(r){return(i,a={})=>{const l=a.width,u=l&&r.matchPatterns[l]||r.matchPatterns[r.defaultMatchWidth],f=i.match(u);if(!f)return null;const _=f[0],v=l&&r.parsePatterns[l]||r.parsePatterns[r.defaultParseWidth],w=Array.isArray(v)?rSe(v,D=>D.test(_)):nSe(v,D=>D.test(_));let C;C=r.valueCallback?r.valueCallback(w):w,C=a.valueCallback?a.valueCallback(C):C;const N=i.slice(_.length);return{value:C,rest:N}}}function nSe(r,i){for(const a in r)if(Object.prototype.hasOwnProperty.call(r,a)&&i(r[a]))return a}function rSe(r,i){for(let a=0;a<r.length;a++)if(i(r[a]))return a}function iSe(r){return(i,a={})=>{const l=i.match(r.matchPattern);if(!l)return null;const u=l[0],f=i.match(r.parsePattern);if(!f)return null;let _=r.valueCallback?r.valueCallback(f[0]):f[0];_=a.valueCallback?a.valueCallback(_):_;const v=i.slice(u.length);return{value:_,rest:v}}}const oSe=/^(\d+)(th|st|nd|rd)?/i,sSe=/\d+/i,aSe={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},cSe={any:[/^b/i,/^(a|c)/i]},lSe={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},dSe={any:[/1/i,/2/i,/3/i,/4/i]},uSe={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},hSe={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},pSe={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},fSe={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},mSe={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},gSe={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},_Se={ordinalNumber:iSe({matchPattern:oSe,parsePattern:sSe,valueCallback:r=>parseInt(r,10)}),era:Um({matchPatterns:aSe,defaultMatchWidth:"wide",parsePatterns:cSe,defaultParseWidth:"any"}),quarter:Um({matchPatterns:lSe,defaultMatchWidth:"wide",parsePatterns:dSe,defaultParseWidth:"any",valueCallback:r=>r+1}),month:Um({matchPatterns:uSe,defaultMatchWidth:"wide",parsePatterns:hSe,defaultParseWidth:"any"}),day:Um({matchPatterns:pSe,defaultMatchWidth:"wide",parsePatterns:fSe,defaultParseWidth:"any"}),dayPeriod:Um({matchPatterns:mSe,defaultMatchWidth:"any",parsePatterns:gSe,defaultParseWidth:"any"})},O7={code:"en-US",formatDistance:Bye,formatLong:zye,formatRelative:Yye,localize:tSe,match:_Se,options:{weekStartsOn:0,firstWeekContainsDate:1}};function ESe(r){const i=zn(r);return bye(i,Vye(i))+1}function vSe(r){const i=zn(r),a=+wS(i)-+Iye(i);return Math.round(a/A7)+1}function P7(r,i){var N,D,O,G;const a=zn(r),l=a.getFullYear(),u=Kg(),f=(i==null?void 0:i.firstWeekContainsDate)??((D=(N=i==null?void 0:i.locale)==null?void 0:N.options)==null?void 0:D.firstWeekContainsDate)??u.firstWeekContainsDate??((G=(O=u.locale)==null?void 0:O.options)==null?void 0:G.firstWeekContainsDate)??1,_=xl(r,0);_.setFullYear(l+1,0,f),_.setHours(0,0,0,0);const v=Og(_,i),w=xl(r,0);w.setFullYear(l,0,f),w.setHours(0,0,0,0);const C=Og(w,i);return a.getTime()>=v.getTime()?l+1:a.getTime()>=C.getTime()?l:l-1}function ySe(r,i){var v,w,C,N;const a=Kg(),l=(i==null?void 0:i.firstWeekContainsDate)??((w=(v=i==null?void 0:i.locale)==null?void 0:v.options)==null?void 0:w.firstWeekContainsDate)??a.firstWeekContainsDate??((N=(C=a.locale)==null?void 0:C.options)==null?void 0:N.firstWeekContainsDate)??1,u=P7(r,i),f=xl(r,0);return f.setFullYear(u,0,l),f.setHours(0,0,0,0),Og(f,i)}function SSe(r,i){const a=zn(r),l=+Og(a,i)-+ySe(a,i);return Math.round(l/A7)+1}function kn(r,i){const a=r<0?"-":"",l=Math.abs(r).toString().padStart(i,"0");return a+l}const nl={y(r,i){const a=r.getFullYear(),l=a>0?a:1-a;return kn(i==="yy"?l%100:l,i.length)},M(r,i){const a=r.getMonth();return i==="M"?String(a+1):kn(a+1,2)},d(r,i){return kn(r.getDate(),i.length)},a(r,i){const a=r.getHours()/12>=1?"pm":"am";switch(i){case"a":case"aa":return a.toUpperCase();case"aaa":return a;case"aaaaa":return a[0];case"aaaa":default:return a==="am"?"a.m.":"p.m."}},h(r,i){return kn(r.getHours()%12||12,i.length)},H(r,i){return kn(r.getHours(),i.length)},m(r,i){return kn(r.getMinutes(),i.length)},s(r,i){return kn(r.getSeconds(),i.length)},S(r,i){const a=i.length,l=r.getMilliseconds(),u=Math.trunc(l*Math.pow(10,a-3));return kn(u,i.length)}},Fh={am:"am",pm:"pm",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},J5={G:function(r,i,a){const l=r.getFullYear()>0?1:0;switch(i){case"G":case"GG":case"GGG":return a.era(l,{width:"abbreviated"});case"GGGGG":return a.era(l,{width:"narrow"});case"GGGG":default:return a.era(l,{width:"wide"})}},y:function(r,i,a){if(i==="yo"){const l=r.getFullYear(),u=l>0?l:1-l;return a.ordinalNumber(u,{unit:"year"})}return nl.y(r,i)},Y:function(r,i,a,l){const u=P7(r,l),f=u>0?u:1-u;if(i==="YY"){const _=f%100;return kn(_,2)}return i==="Yo"?a.ordinalNumber(f,{unit:"year"}):kn(f,i.length)},R:function(r,i){const a=N7(r);return kn(a,i.length)},u:function(r,i){const a=r.getFullYear();return kn(a,i.length)},Q:function(r,i,a){const l=Math.ceil((r.getMonth()+1)/3);switch(i){case"Q":return String(l);case"QQ":return kn(l,2);case"Qo":return a.ordinalNumber(l,{unit:"quarter"});case"QQQ":return a.quarter(l,{width:"abbreviated",context:"formatting"});case"QQQQQ":return a.quarter(l,{width:"narrow",context:"formatting"});case"QQQQ":default:return a.quarter(l,{width:"wide",context:"formatting"})}},q:function(r,i,a){const l=Math.ceil((r.getMonth()+1)/3);switch(i){case"q":return String(l);case"qq":return kn(l,2);case"qo":return a.ordinalNumber(l,{unit:"quarter"});case"qqq":return a.quarter(l,{width:"abbreviated",context:"standalone"});case"qqqqq":return a.quarter(l,{width:"narrow",context:"standalone"});case"qqqq":default:return a.quarter(l,{width:"wide",context:"standalone"})}},M:function(r,i,a){const l=r.getMonth();switch(i){case"M":case"MM":return nl.M(r,i);case"Mo":return a.ordinalNumber(l+1,{unit:"month"});case"MMM":return a.month(l,{width:"abbreviated",context:"formatting"});case"MMMMM":return a.month(l,{width:"narrow",context:"formatting"});case"MMMM":default:return a.month(l,{width:"wide",context:"formatting"})}},L:function(r,i,a){const l=r.getMonth();switch(i){case"L":return String(l+1);case"LL":return kn(l+1,2);case"Lo":return a.ordinalNumber(l+1,{unit:"month"});case"LLL":return a.month(l,{width:"abbreviated",context:"standalone"});case"LLLLL":return a.month(l,{width:"narrow",context:"standalone"});case"LLLL":default:return a.month(l,{width:"wide",context:"standalone"})}},w:function(r,i,a,l){const u=SSe(r,l);return i==="wo"?a.ordinalNumber(u,{unit:"week"}):kn(u,i.length)},I:function(r,i,a){const l=vSe(r);return i==="Io"?a.ordinalNumber(l,{unit:"week"}):kn(l,i.length)},d:function(r,i,a){return i==="do"?a.ordinalNumber(r.getDate(),{unit:"date"}):nl.d(r,i)},D:function(r,i,a){const l=ESe(r);return i==="Do"?a.ordinalNumber(l,{unit:"dayOfYear"}):kn(l,i.length)},E:function(r,i,a){const l=r.getDay();switch(i){case"E":case"EE":case"EEE":return a.day(l,{width:"abbreviated",context:"formatting"});case"EEEEE":return a.day(l,{width:"narrow",context:"formatting"});case"EEEEEE":return a.day(l,{width:"short",context:"formatting"});case"EEEE":default:return a.day(l,{width:"wide",context:"formatting"})}},e:function(r,i,a,l){const u=r.getDay(),f=(u-l.weekStartsOn+8)%7||7;switch(i){case"e":return String(f);case"ee":return kn(f,2);case"eo":return a.ordinalNumber(f,{unit:"day"});case"eee":return a.day(u,{width:"abbreviated",context:"formatting"});case"eeeee":return a.day(u,{width:"narrow",context:"formatting"});case"eeeeee":return a.day(u,{width:"short",context:"formatting"});case"eeee":default:return a.day(u,{width:"wide",context:"formatting"})}},c:function(r,i,a,l){const u=r.getDay(),f=(u-l.weekStartsOn+8)%7||7;switch(i){case"c":return String(f);case"cc":return kn(f,i.length);case"co":return a.ordinalNumber(f,{unit:"day"});case"ccc":return a.day(u,{width:"abbreviated",context:"standalone"});case"ccccc":return a.day(u,{width:"narrow",context:"standalone"});case"cccccc":return a.day(u,{width:"short",context:"standalone"});case"cccc":default:return a.day(u,{width:"wide",context:"standalone"})}},i:function(r,i,a){const l=r.getDay(),u=l===0?7:l;switch(i){case"i":return String(u);case"ii":return kn(u,i.length);case"io":return a.ordinalNumber(u,{unit:"day"});case"iii":return a.day(l,{width:"abbreviated",context:"formatting"});case"iiiii":return a.day(l,{width:"narrow",context:"formatting"});case"iiiiii":return a.day(l,{width:"short",context:"formatting"});case"iiii":default:return a.day(l,{width:"wide",context:"formatting"})}},a:function(r,i,a){const u=r.getHours()/12>=1?"pm":"am";switch(i){case"a":case"aa":return a.dayPeriod(u,{width:"abbreviated",context:"formatting"});case"aaa":return a.dayPeriod(u,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return a.dayPeriod(u,{width:"narrow",context:"formatting"});case"aaaa":default:return a.dayPeriod(u,{width:"wide",context:"formatting"})}},b:function(r,i,a){const l=r.getHours();let u;switch(l===12?u=Fh.noon:l===0?u=Fh.midnight:u=l/12>=1?"pm":"am",i){case"b":case"bb":return a.dayPeriod(u,{width:"abbreviated",context:"formatting"});case"bbb":return a.dayPeriod(u,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return a.dayPeriod(u,{width:"narrow",context:"formatting"});case"bbbb":default:return a.dayPeriod(u,{width:"wide",context:"formatting"})}},B:function(r,i,a){const l=r.getHours();let u;switch(l>=17?u=Fh.evening:l>=12?u=Fh.afternoon:l>=4?u=Fh.morning:u=Fh.night,i){case"B":case"BB":case"BBB":return a.dayPeriod(u,{width:"abbreviated",context:"formatting"});case"BBBBB":return a.dayPeriod(u,{width:"narrow",context:"formatting"});case"BBBB":default:return a.dayPeriod(u,{width:"wide",context:"formatting"})}},h:function(r,i,a){if(i==="ho"){let l=r.getHours()%12;return l===0&&(l=12),a.ordinalNumber(l,{unit:"hour"})}return nl.h(r,i)},H:function(r,i,a){return i==="Ho"?a.ordinalNumber(r.getHours(),{unit:"hour"}):nl.H(r,i)},K:function(r,i,a){const l=r.getHours()%12;return i==="Ko"?a.ordinalNumber(l,{unit:"hour"}):kn(l,i.length)},k:function(r,i,a){let l=r.getHours();return l===0&&(l=24),i==="ko"?a.ordinalNumber(l,{unit:"hour"}):kn(l,i.length)},m:function(r,i,a){return i==="mo"?a.ordinalNumber(r.getMinutes(),{unit:"minute"}):nl.m(r,i)},s:function(r,i,a){return i==="so"?a.ordinalNumber(r.getSeconds(),{unit:"second"}):nl.s(r,i)},S:function(r,i){return nl.S(r,i)},X:function(r,i,a){const l=r.getTimezoneOffset();if(l===0)return"Z";switch(i){case"X":return Z5(l);case"XXXX":case"XX":return Od(l);case"XXXXX":case"XXX":default:return Od(l,":")}},x:function(r,i,a){const l=r.getTimezoneOffset();switch(i){case"x":return Z5(l);case"xxxx":case"xx":return Od(l);case"xxxxx":case"xxx":default:return Od(l,":")}},O:function(r,i,a){const l=r.getTimezoneOffset();switch(i){case"O":case"OO":case"OOO":return"GMT"+Q5(l,":");case"OOOO":default:return"GMT"+Od(l,":")}},z:function(r,i,a){const l=r.getTimezoneOffset();switch(i){case"z":case"zz":case"zzz":return"GMT"+Q5(l,":");case"zzzz":default:return"GMT"+Od(l,":")}},t:function(r,i,a){const l=Math.trunc(r.getTime()/1e3);return kn(l,i.length)},T:function(r,i,a){const l=r.getTime();return kn(l,i.length)}};function Q5(r,i=""){const a=r>0?"-":"+",l=Math.abs(r),u=Math.trunc(l/60),f=l%60;return f===0?a+String(u):a+String(u)+i+kn(f,2)}function Z5(r,i){return r%60===0?(r>0?"-":"+")+kn(Math.abs(r)/60,2):Od(r,i)}function Od(r,i=""){const a=r>0?"-":"+",l=Math.abs(r),u=kn(Math.trunc(l/60),2),f=kn(l%60,2);return a+u+i+f}const e6=(r,i)=>{switch(r){case"P":return i.date({width:"short"});case"PP":return i.date({width:"medium"});case"PPP":return i.date({width:"long"});case"PPPP":default:return i.date({width:"full"})}},D7=(r,i)=>{switch(r){case"p":return i.time({width:"short"});case"pp":return i.time({width:"medium"});case"ppp":return i.time({width:"long"});case"pppp":default:return i.time({width:"full"})}},TSe=(r,i)=>{const a=r.match(/(P+)(p+)?/)||[],l=a[1],u=a[2];if(!u)return e6(r,i);let f;switch(l){case"P":f=i.dateTime({width:"short"});break;case"PP":f=i.dateTime({width:"medium"});break;case"PPP":f=i.dateTime({width:"long"});break;case"PPPP":default:f=i.dateTime({width:"full"});break}return f.replace("{{date}}",e6(l,i)).replace("{{time}}",D7(u,i))},wSe={p:D7,P:TSe},RSe=/^D+$/,CSe=/^Y+$/,bSe=["D","DD","YY","YYYY"];function ISe(r){return RSe.test(r)}function ASe(r){return CSe.test(r)}function NSe(r,i,a){const l=OSe(r,i,a);if(console.warn(l),bSe.includes(r))throw new RangeError(l)}function OSe(r,i,a){const l=r[0]==="Y"?"years":"days of the month";return`Use \`${r.toLowerCase()}\` instead of \`${r}\` (in \`${i}\`) for formatting ${l} to the input \`${a}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const PSe=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,DSe=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,kSe=/^'([^]*?)'?$/,xSe=/''/g,LSe=/[a-zA-Z]/;function t6(r,i,a){var N,D,O,G;const l=Kg(),u=l.locale??O7,f=l.firstWeekContainsDate??((D=(N=l.locale)==null?void 0:N.options)==null?void 0:D.firstWeekContainsDate)??1,_=l.weekStartsOn??((G=(O=l.locale)==null?void 0:O.options)==null?void 0:G.weekStartsOn)??0,v=zn(r);if(!Oye(v))throw new RangeError("Invalid time value");let w=i.match(DSe).map(F=>{const V=F[0];if(V==="p"||V==="P"){const L=wSe[V];return L(F,u.formatLong)}return F}).join("").match(PSe).map(F=>{if(F==="''")return{isToken:!1,value:"'"};const V=F[0];if(V==="'")return{isToken:!1,value:MSe(F)};if(J5[V])return{isToken:!0,value:F};if(V.match(LSe))throw new RangeError("Format string contains an unescaped latin alphabet character `"+V+"`");return{isToken:!1,value:F}});u.localize.preprocessor&&(w=u.localize.preprocessor(v,w));const C={firstWeekContainsDate:f,weekStartsOn:_,locale:u};return w.map(F=>{if(!F.isToken)return F.value;const V=F.value;(ASe(V)||ISe(V))&&NSe(V,i,String(r));const L=J5[V[0]];return L(v,V,u.localize,C)}).join("")}function MSe(r){const i=r.match(kSe);return i?i[1].replace(xSe,"'"):r}function USe(r,i,a){const l=Kg(),u=(a==null?void 0:a.locale)??l.locale??O7,f=2520,_=Fy(r,i);if(isNaN(_))throw new RangeError("Invalid time value");const v=Object.assign({},a,{addSuffix:a==null?void 0:a.addSuffix,comparison:_});let w,C;_>0?(w=zn(i),C=zn(r)):(w=zn(r),C=zn(i));const N=jye(C,w),D=(RS(C)-RS(w))/1e3,O=Math.round((N-D)/60);let G;if(O<2)return a!=null&&a.includeSeconds?N<5?u.formatDistance("lessThanXSeconds",5,v):N<10?u.formatDistance("lessThanXSeconds",10,v):N<20?u.formatDistance("lessThanXSeconds",20,v):N<40?u.formatDistance("halfAMinute",0,v):N<60?u.formatDistance("lessThanXMinutes",1,v):u.formatDistance("xMinutes",1,v):O===0?u.formatDistance("lessThanXMinutes",1,v):u.formatDistance("xMinutes",O,v);if(O<45)return u.formatDistance("xMinutes",O,v);if(O<90)return u.formatDistance("aboutXHours",1,v);if(O<X5){const F=Math.round(O/60);return u.formatDistance("aboutXHours",F,v)}else{if(O<f)return u.formatDistance("xDays",1,v);if(O<gy){const F=Math.round(O/X5);return u.formatDistance("xDays",F,v)}else if(O<gy*2)return G=Math.round(O/gy),u.formatDistance("aboutXMonths",G,v)}if(G=Uye(C,w),G<12){const F=Math.round(O/gy);return u.formatDistance("xMonths",F,v)}else{const F=G%12,V=Math.trunc(G/12);return F<3?u.formatDistance("aboutXYears",V,v):F<9?u.formatDistance("overXYears",V,v):u.formatDistance("almostXYears",V+1,v)}}function jSe(r,i){return USe(r,Aye(r),i)}const k7=r=>{try{const i=typeof r=="string"?new Date(r):r;return jSe(i,{addSuffix:!0}).replace("about ","").replace("less than a minute ago","now").replace("minute","m").replace("hour","h").replace(" day","d").replace(" week","w").replace(" month","mo").replace(" year","y")}catch{return"now"}},VSe=La.baseUrl,FSe=()=>{const{isAuthenticated:r}=hu(),{hasUnreadNotifications:i,isConnected:a}=Gg(),l=jp(),[u,f]=k.useState([]),[_,v]=k.useState(!0),[w,C]=k.useState(""),[N,D]=k.useState("desc"),O=Ve.useMemo(()=>[...u].sort((L,B)=>{const W=new Date(L.createdAt).getTime(),z=new Date(B.createdAt).getTime();return N==="asc"?W-z:z-W}),[u,N]);k.useEffect(()=>{let L=!0;return console.log("Home Component mounted"),console.log("IsAuthenticated: ",r),(async()=>{try{v(!0);const W=await Cr.get("/api/post");if(W.status!==200)throw new Error("Failed to fetch");L&&f(W.data.sort((z,$)=>new Date($.createdAt).getTime()-new Date(z.createdAt).getTime()))}catch(W){C(W instanceof Error?W.message:"Failed to load posts"),it.error("Failed to fetch posts")}finally{v(!1)}})(),()=>{console.log("end fetch posts"),L=!1}},[]);const G=async L=>{try{const B=localStorage.getItem("userId");if(!B)throw new Error("User ID not found");if((await Cr.post(`/api/Helper/${L}/Accept-Post`,{requestAcceptorId:B})).status!==200)throw new Error("Accept failed");f(u.map(z=>z.id===L?{...z,reactionsCount:z.reactionsCount+1,isAccepted:!0}:z)),it.success("Post accepted")}catch(B){console.error("Accept error:",B),it.error("Failed to accept post",{icon:"😥"})}},F=async L=>{try{const B=localStorage.getItem("userId");if(!B)throw new Error("User ID not found");if((await Cr.delete(`/api/Helper/Remove-Reaction/${L}`,{data:{requestAcceptorId:B}})).status!==200)throw new Error("Ignore failed");f(u.map(z=>z.id===L?{...z,reactionsCount:z.reactionsCount-(z.isAccepted?1:0),isAccepted:!1}:z)),it.info("Post ignored")}catch(B){console.error("Ignore error:",B),it.error("Failed to ignore post",{icon:"😥"})}},V=async()=>{C("");try{v(!0);const L=await Cr.get("/api/post");if(L.status!==200)throw new Error("Failed to fetch");f(L.data)}catch(L){C(L instanceof Error?L.message:"Failed to load posts"),it.error("Failed to fetch posts")}finally{v(!1)}};return _?S.jsx("div",{className:"text-center py-8",children:"Loading posts..."}):w?S.jsxs("div",{className:"text-center py-8",children:[S.jsx("p",{className:"text-red-500 mb-4",children:w}),S.jsx(sn,{onClick:V,children:"Retry Loading"})]}):S.jsx("div",{className:"app-container bg-gray-50 min-h-screen pb-20 pt-16",children:S.jsxs("div",{className:"container mx-auto max-w-4xl px-4 py-8",children:[S.jsxs("div",{className:"flex justify-between items-center mb-6",children:[S.jsxs("div",{className:"flex items-center gap-4",children:[S.jsx("h2",{className:"text-2xl font-bold",children:"Posts"}),S.jsxs("div",{className:"relative cursor-pointer",onClick:()=>l("/notifications"),children:[S.jsx(ng,{className:"h-6 w-6"}),i&&S.jsx("div",{className:"absolute -top-1 -right-1 h-3 w-3 rounded-full bg-red-500"})]})]}),S.jsxs("select",{value:N,onChange:L=>D(L.target.value),className:"px-4 py-2 border rounded-md",children:[S.jsx("option",{value:"desc",children:"Newest First"}),S.jsx("option",{value:"asc",children:"Oldest First"})]})]}),S.jsx("div",{className:"space-y-6",children:O.map(L=>S.jsxs(Wp,{className:"p-6 shadow-sm",children:[S.jsx("div",{className:"flex justify-between items-start mb-4",children:S.jsxs("div",{className:"flex items-center space-x-3",children:[S.jsxs(pu,{className:"h-10 w-10",children:[S.jsx(fu,{src:VSe+L.author.pictureUrl,alt:L.author.fullName}),S.jsx(mu,{children:S.jsx(du,{className:"h-5 w-5"})})]}),S.jsxs("div",{children:[S.jsx("h3",{className:"font-semibold",children:L.author.fullName}),S.jsxs("p",{className:"text-sm text-gray-500",children:["@",L.author.userName," · ",k7(L.createdAt)]})]})]})}),S.jsx("div",{className:"mb-4",children:S.jsx("p",{className:"text-gray-800",children:L.content})}),S.jsxs("div",{className:"flex justify-between items-center",children:[S.jsxs("div",{className:"text-sm text-gray-500 flex items-center",children:[S.jsx("span",{className:"font-medium text-blue-500",children:L.reactionsCount}),S.jsx("span",{className:"ml-1",children:"Acceptances"})]}),S.jsxs("div",{className:"flex gap-4",children:[S.jsx(sn,{className:`${L.isAccepted?"bg-green-600 hover:bg-green-700 text-white":"btn-primary"}`,onClick:()=>G(L.id),disabled:L.isAccepted,children:L.isAccepted?"Accepted":"Accept"}),S.jsx(sn,{variant:"outline",className:"btn-outline",onClick:()=>F(L.id),children:"Ignore"})]}),L.isAccepted&&S.jsx("div",{children:S.jsx("span",{className:"text-green-600 font-medium",children:"Accepted"})})]})]},L.id))})]})})},BSe=B9,WSe=k.forwardRef(({className:r,children:i,...a},l)=>S.jsxs(_0,{ref:l,className:Lt("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",r),...a,children:[i,S.jsx(W9,{asChild:!0,children:S.jsx(qS,{className:"h-4 w-4 opacity-50"})})]}));WSe.displayName=_0.displayName;const x7=k.forwardRef(({className:r,...i},a)=>S.jsx(S0,{ref:a,className:Lt("flex cursor-default items-center justify-center py-1",r),...i,children:S.jsx(aH,{className:"h-4 w-4"})}));x7.displayName=S0.displayName;const L7=k.forwardRef(({className:r,...i},a)=>S.jsx(T0,{ref:a,className:Lt("flex cursor-default items-center justify-center py-1",r),...i,children:S.jsx(qS,{className:"h-4 w-4"})}));L7.displayName=T0.displayName;const HSe=k.forwardRef(({className:r,children:i,position:a="popper",...l},u)=>S.jsx(H9,{children:S.jsxs(E0,{ref:u,className:Lt("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",r),position:a,...l,children:[S.jsx(x7,{}),S.jsx(G9,{className:Lt("p-1",a==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:i}),S.jsx(L7,{})]})}));HSe.displayName=E0.displayName;const GSe=k.forwardRef(({className:r,...i},a)=>S.jsx(v0,{ref:a,className:Lt("py-1.5 pl-8 pr-2 text-sm font-semibold",r),...i}));GSe.displayName=v0.displayName;const zSe=k.forwardRef(({className:r,children:i,...a},l)=>S.jsxs(y0,{ref:l,className:Lt("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",r),...a,children:[S.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:S.jsx(K9,{children:S.jsx(zN,{className:"h-4 w-4"})})}),S.jsx(z9,{children:i})]}));zSe.displayName=y0.displayName;const KSe=k.forwardRef(({className:r,...i},a)=>S.jsx(w0,{ref:a,className:Lt("-mx-1 my-1 h-px bg-muted",r),...i}));KSe.displayName=w0.displayName;const YSe=()=>{const{logout:r,user:i}=hu(),[a,l]=k.useState(!1),[u,f]=k.useState({}),[_,v]=k.useState(!1),[w,C]=k.useState(!1),[N,D]=k.useState(""),[O,G]=k.useState(""),[F,V]=k.useState(null),[L,B]=k.useState(null),[W,z]=k.useState(!0),[$,te]=k.useState({fullName:"",gender:"",dateOfBirth:"",languagePreference:"",profileImage:null,password:"",confirmPassword:""}),ie=La.baseUrl;if(k.useEffect(()=>{let je=!0;return console.log(i),i?(async()=>{try{z(!0);const[le,Le]=await Promise.all([Md.getProfileData(),Md.getCurrentUser()]);console.log("Fetched profile data:",le),console.log("Current user:",Le),je&&(B(le),le!=null&&le.profileImageUrl&&V(le.profileImageUrl))}catch(le){console.error("Error initializing user data:",le),je&&it.error("Failed to load user data")}finally{je&&z(!1)}})():z(!1),()=>{je=!1}},[i]),W)return S.jsx("div",{className:"flex items-center justify-center h-screen",children:S.jsx("p",{children:"Loading profile..."})});if(!i)return S.jsx("div",{className:"flex items-center justify-center h-screen",children:S.jsx("p",{children:"Please log in to view your profile."})});const ce=je=>{const{name:Ge,value:le}=je.target;te(Le=>({...Le,[Ge]:le}))},pe=je=>{if(je.target.files&&je.target.files[0]){const Ge=je.target.files[0];te(Le=>({...Le,profileImage:Ge}));const le=new FileReader;le.onloadend=()=>{V(le.result)},le.readAsDataURL(Ge)}},Pe=async()=>{if($.password&&$.password!==$.confirmPassword){it.error("Passwords do not match",{icon:"❌",position:"bottom-center"});return}try{it.loading("Updating profile..."),await Md.updateUserProfile($);const je=await Md.getProfileData();B(je),localStorage.setItem("user",JSON.stringify(je)),window.dispatchEvent(new Event("userProfileUpdated")),l(!1),V(null),it.dismiss(),it.success("Profile updated successfully",{icon:"✅"})}catch{it.dismiss(),it.error("Failed to update profile",{icon:"❌"})}},_e=(L==null?void 0:L.fullName)||(i==null?void 0:i.fullName)||"",ge=(L==null?void 0:L.email)||(i==null?void 0:i.email)||"",fe=(L==null?void 0:L.gender)||(i==null?void 0:i.gender)||"",xe=(L==null?void 0:L.dateOfBirth)||(i==null?void 0:i.dateOfBirth)||"",be=(L==null?void 0:L.rate)||0,ft=(L==null?void 0:L.profileImageUrl)||(i==null?void 0:i.profileImageUrl)||"";return console.log("Display Picture:",ft),console.log("Image Preview:",F),W?S.jsx("div",{className:"flex items-center justify-center h-screen",children:S.jsx("p",{children:"Loading profile..."})}):S.jsx("div",{className:"app-container min-h-screen bg-gradient-to-b from-gray-50 to-gray-100",children:S.jsx("div",{className:"container mx-auto max-w-4xl px-4 py-10",children:S.jsxs(Wp,{className:"overflow-hidden shadow-xl rounded-xl",children:[S.jsx("div",{className:"bg-gradient-to-r from-blue-500 via-blue-600 to-indigo-600 h-48 w-full relative",children:S.jsx("div",{className:"absolute inset-0 bg-black opacity-10"})}),S.jsxs("div",{className:"px-6 sm:px-8 relative",children:[S.jsx("div",{className:"relative -mt-20 mb-6",children:S.jsxs("div",{className:"relative inline-block",children:[S.jsxs(pu,{className:"h-40 w-40 border-4 border-white shadow-2xl ring-4 ring-blue-50",children:[S.jsx(fu,{src:F&&F.startsWith("data:image/jpeg;base64")?F:ie+ft,alt:_e,className:"object-cover"}),S.jsx(mu,{children:S.jsx(du,{className:"h-20 w-20 text-gray-400"})})]}),a&&S.jsxs("label",{className:"absolute bottom-2 right-2 bg-blue-600 text-white p-3 rounded-full cursor-pointer hover:bg-blue-700 transition-all duration-200 shadow-lg hover:shadow-xl transform hover:scale-105",children:[S.jsx(YB,{className:"h-5 w-5"}),S.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:pe})]})]})}),S.jsxs("div",{className:"flex flex-col",children:[S.jsx(w7,{className:"px-0",children:S.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start gap-4",children:[S.jsxs("div",{className:"space-y-2",children:[S.jsx(R7,{className:"text-3xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-blue-600 to-indigo-600",children:_e}),S.jsxs(C7,{className:"text-gray-600 text-lg",children:["@",(i==null?void 0:i.userName)||"N/A"]}),S.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[S.jsxs("span",{className:"inline-flex items-center px-3 py-1 rounded-full bg-blue-50 text-blue-700 font-medium",children:[S.jsx(sH,{className:"h-4 w-4 mr-1"}),"Joined ",t6(new Date,"MMMM yyyy")]}),be>0&&S.jsxs("span",{className:"inline-flex items-center px-3 py-1 rounded-full bg-yellow-50 text-yellow-700 font-medium",children:["★ ",be.toFixed(1)," Rating"]})]})]}),a?S.jsxs("div",{className:"flex gap-3",children:[S.jsx(sn,{variant:"outline",onClick:()=>{l(!1),f({}),V(null),D(""),G("")},className:"text-gray-600 hover:bg-gray-50 transition-all duration-200 px-6 py-2 rounded-full",children:"Cancel"}),S.jsx(sn,{onClick:Pe,className:"bg-blue-600 hover:bg-blue-700 text-white transition-all duration-200 px-6 py-2 rounded-full shadow-lg hover:shadow-xl transform hover:scale-105",children:"Save Changes"})]}):S.jsxs(sn,{onClick:()=>l(!0),variant:"outline",className:"flex items-center gap-2 border-2 border-blue-600 text-blue-600 hover:bg-blue-50 transition-all duration-200 px-6 py-2 rounded-full",children:[S.jsx(YB,{className:"h-4 w-4"}),"Edit Profile"]})]})}),S.jsx(b7,{className:"px-0 py-6",children:S.jsxs("div",{className:"space-y-8",children:[S.jsxs("div",{children:[S.jsx("h3",{className:"text-lg font-semibold mb-6",children:"Personal Information"}),S.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[S.jsxs("div",{className:"space-y-3",children:[S.jsx(Rr,{className:"text-sm font-semibold text-gray-700",children:"Full Name"}),a?S.jsx(wr,{name:"fullName",value:$.fullName||"",onChange:ce,className:"w-full px-4 py-3 rounded-lg border-2 border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all duration-200",placeholder:"Enter your full name"}):S.jsx("p",{className:"text-lg font-medium text-gray-900",children:_e})]}),S.jsxs("div",{className:"space-y-3",children:[S.jsx(Rr,{className:"text-md font-semibold text-gray-700",children:"Email"}),S.jsx("p",{className:"text-lg font-medium text-gray-900",children:ge})]}),S.jsxs("div",{className:"space-y-3",children:[S.jsx(Rr,{className:"text-sm font-semibold text-gray-700",children:"Gender"}),a?S.jsxs(Y9,{value:$.gender,onValueChange:je=>te(Ge=>({...Ge,gender:je})),children:[S.jsx(yO,{className:"w-full px-4 py-3 rounded-lg border-2 border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all duration-200",children:S.jsx(BSe,{placeholder:"Select your gender"})}),S.jsxs(SO,{children:[S.jsx(Ng,{value:"male",className:"py-2 px-4 hover:bg-blue-50",children:"Male"}),S.jsx(Ng,{value:"female",className:"py-2 px-4 hover:bg-blue-50",children:"Female"})]})]}):S.jsx("p",{className:"text-lg font-medium text-gray-900 capitalize",children:fe})]}),S.jsxs("div",{className:"space-y-3",children:[S.jsx(Rr,{className:"text-xl font-semibold text-gray-700",children:"Date of Birth"}),a?S.jsx(wr,{type:"date",name:"dateOfBirth",value:$.dateOfBirth?new Date($.dateOfBirth).toISOString().split("T")[0]:"",onChange:ce,className:"w-full px-4 py-3 rounded-lg border-2 border-gray-300 text-gray-900 focus:ring-blue-500"}):S.jsx("p",{className:"text-lg border-3 border-gray-300 focus:ring-blue-500 font-medium text-gray-900",children:xe?t6(new Date(xe),"PPP"):"Not provided"})]}),S.jsxs("div",{className:"space-y-2",children:[S.jsx(Rr,{className:"text-gray-700",children:"Rating"}),S.jsxs("div",{className:"flex items-center",children:[S.jsx("div",{className:"flex",children:[1,2,3,4,5].map(je=>S.jsx("svg",{className:`w-5 h-5 ${je<=be?"text-yellow-400":"text-gray-300"}`,fill:"currentColor",viewBox:"0 0 20 20",children:S.jsx("path",{d:"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"})},je))}),S.jsxs("span",{className:"ml-2 font-semibold",children:[be,"/5"]})]})]})]})]}),a&&S.jsxs("div",{children:[S.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Update Password"}),S.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[S.jsxs("div",{className:"relative",children:[S.jsx(Rr,{htmlFor:"newPassword",children:"New Password"}),S.jsx(wr,{id:"newPassword",name:"password",type:_?"text":"password",value:$.password||"",onChange:ce,placeholder:"Enter new password"}),S.jsx("button",{type:"button",className:"absolute right-3 bottom-3 text-gray-500",onClick:()=>v(!_),children:_?S.jsx(Zd,{className:"h-4 w-4"}):S.jsx(eu,{className:"h-4 w-4"})})]}),S.jsxs("div",{className:"relative",children:[S.jsx(Rr,{htmlFor:"confirmPassword",children:"Confirm New Password"}),S.jsx(wr,{id:"confirmPassword",name:"confirmPassword",type:w?"text":"password",value:$.confirmPassword||"",onChange:ce,placeholder:"Confirm new password"}),S.jsx("button",{type:"button",className:"absolute right-3 bottom-3 text-gray-500",onClick:()=>C(!w),children:w?S.jsx(Zd,{className:"h-4 w-4"}):S.jsx(eu,{className:"h-4 w-4"})})]})]})]})]})}),S.jsx(I7,{className:"px-0 pt-4 flex justify-end",children:S.jsxs(sn,{variant:"outline",className:"flex items-center gap-2 text-red-500 hover:text-red-700 hover:bg-red-50",onClick:r,children:[S.jsx(the,{className:"h-4 w-4"}),"Sign Out"]})})]})]})]})})})},qSe={async getCallHistory(){var r,i;try{const a=await Cr.get(`/api/calls/${localStorage.getItem("userId")}/call-history`);if(a.data!=null||a.data!=null)return a.data}catch(a){if($t.isAxiosError(a)){const l=((i=(r=a.response)==null?void 0:r.data)==null?void 0:i.message)||"Failed to fetch call history";it.error(l,{icon:"❌"})}}}},XSe=La.baseUrl,$Se=()=>{const[r,i]=k.useState(""),[a,l]=k.useState([]),[u,f]=k.useState(!0);if(k.useEffect(()=>{f(!0),console.log("Fetching call history..."),console.log("userid",localStorage.getItem("userId")),qSe.getCallHistory().then(w=>{w&&l(w),f(!1)}).catch(w=>{console.error("Error fetching call history:",w),it.error("Failed to fetch call history",{icon:"⚠️"}),f(!1)})},[]),u)return S.jsx("div",{className:"text-center py-8",children:"Loading call history..."});const v=a.reduce((w,C)=>w.find(D=>D.caller.id===C.caller.id)?w:[...w,C],[]).filter(w=>w.caller.fullName.toLowerCase().includes(r.toLowerCase()));return S.jsx("div",{className:"app-container bg-gray-50 min-h-screen pb-20 pt-16",children:S.jsxs("div",{className:"container mx-auto max-w-6xl px-4 py-10",children:[S.jsxs("div",{className:"mb-10",children:[S.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-6",children:"People"}),S.jsxs("div",{className:"relative max-w-xl",children:[S.jsx(wr,{type:"text",placeholder:"Search for people...",className:"pl-10 pr-4 py-3",value:r,onChange:w=>i(w.target.value)}),S.jsx("svg",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",width:"20",height:"20",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:S.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})]})]}),S.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6",children:v.map(w=>S.jsxs(Wp,{className:"p-6 flex flex-col items-center hover:shadow-md transition-shadow",children:[S.jsxs(pu,{className:"h-24 w-24 mb-4",children:[S.jsx(fu,{src:XSe+w.caller.pictureUrl,alt:w.caller.fullName}),S.jsx(mu,{children:S.jsx(du,{className:"h-10 w-10"})})]}),S.jsx("h3",{className:"text-xl font-semibold text-center mb-2",children:w.caller.fullName}),S.jsxs("div",{className:`px-3 py-1 rounded-full text-sm font-medium mb-4 ${w.caller.status===!0?"bg-green-100 text-green-800":w.caller.status===!1?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}`,children:[S.jsx("span",{className:`inline-block w-2 h-2 rounded-full mr-2 ${w.caller.status===!0?"bg-green-500":w.caller.status===!1?"bg-yellow-500":"bg-gray-500"}`}),w.caller.status===!0?"Active":w.caller.status===!1?"Away":"Offline"]})]},w.id))})]})})},JSe={getHistory:async()=>{var r,i;try{return(await Cr.get(`/api/calls/${localStorage.getItem("userId")}/call-history`)).data}catch(a){if($t.isAxiosError(a)){const l=((i=(r=a.response)==null?void 0:r.data)==null?void 0:i.message)||"Failed to fetch call history";it.error(l,{icon:"❌"})}}}},QSe=La.baseUrl,ZSe=()=>{const[r,i]=k.useState([]),[a,l]=k.useState(!0);return k.useEffect(()=>{l(!0),JSe.getHistory().then(u=>{console.log(u),u&&i(u),l(!1)}).catch(u=>{console.error("Error fetching call history:",u),it.error("Failed to fetch call history",{icon:"❌"})})},[]),S.jsx("div",{className:"app-container min-h-screen bg-gray-50 pt-16",children:S.jsxs("div",{className:"container mx-auto max-w-4xl px-4 py-10",children:[S.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-6",children:"Activity History"}),S.jsx("div",{className:"space-y-4",children:r.map(u=>{var f;return S.jsx(Wp,{className:"p-4 border-l-4 border-l-brand-blue",children:S.jsxs("div",{className:"flex items-start",children:[S.jsxs(pu,{className:"h-12 w-12 mr-4",children:[S.jsx(fu,{src:QSe+u.caller.pictureUrl,alt:u.caller.fullName}),S.jsx(mu,{children:S.jsx(du,{className:"h-5 w-5"})})]}),S.jsx("div",{className:"flex-1",children:S.jsxs("div",{className:"flex justify-between items-start",children:[S.jsxs("div",{children:[S.jsxs("h3",{className:"font-semibold text-gray-900",children:[u.caller.fullName," ",S.jsx("span",{className:"text-sm text-gray-500",children:new Date(u.startTime).toLocaleString()})]}),S.jsx("p",{className:"text-sm text-gray-500",children:S.jsxs("span",{className:"font-medium",children:["@",u.caller.username]})}),S.jsxs("p",{className:"text-sm text-gray-500",children:[S.jsx("span",{className:"text-gray-900",children:"Duration:"})," ",((f=u.duration)==null?void 0:f.toFixed(1))||"-"," minutes"]})]}),S.jsx("div",{className:`px-2 py-1 rounded text-xs font-medium ${u.status==="Connected"?"bg-green-100 text-green-800":u.status==="Initiated"?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:u.status})]})})]})},u.id)})})]})})},e0e=()=>{const r=Up();return k.useEffect(()=>{console.error("404 Error: User attempted to access non-existent route:",r.pathname)},[r.pathname]),S.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-100",children:S.jsxs("div",{className:"text-center",children:[S.jsx("h1",{className:"text-4xl font-bold mb-4",children:"404"}),S.jsx("p",{className:"text-xl text-gray-600 mb-4",children:"Oops! Page not found"}),S.jsx("a",{href:"/",className:"text-blue-500 hover:text-blue-700 underline",children:"Return to Home"})]})})},jm={async getNotificaitons(){var r,i;try{const a=await Cr.get("/api/notification");return console.log(a.data),a.data}catch(a){if(console.log("Catch"),$t.isAxiosError(a)){const l=((i=(r=a.response)==null?void 0:r.data)==null?void 0:i.message)||"Failed to fetch notification data";it.error(l,{icon:"❌",position:"bottom-center"})}throw a}},async markNotificationAsRead(r){var i,a;try{await Cr.put(`/api/notification/${r}/mark-as-read`)}catch(l){if($t.isAxiosError(l)){const u=((a=(i=l.response)==null?void 0:i.data)==null?void 0:a.message)||"Failed to mark notification as read";it.error(u,{icon:"❌",position:"bottom-center"})}}},async markAllNotificationsAsRead(){var r,i;try{const a=await Cr.put("/api/notification/mark-all-as-read");console.log(a.data)}catch(a){if($t.isAxiosError(a)){const l=((i=(r=a.response)==null?void 0:r.data)==null?void 0:i.message)||"Failed to mark all notifications as read";it.error(l,{icon:"❌",position:"bottom-center"})}}},async deleteNotification(r){var i,a;try{await Cr.delete(`/api/notification/${r}`)}catch(l){if($t.isAxiosError(l)){const u=((a=(i=l.response)==null?void 0:i.data)==null?void 0:a.message)||"Failed to delete notification";it.error(u,{icon:"❌",position:"bottom-center"})}}},async deleteAllNotifications(){var r,i;try{await Cr.delete("/api/notification/delete-all")}catch(a){if($t.isAxiosError(a)){const l=((i=(r=a.response)==null?void 0:r.data)==null?void 0:i.message)||"Failed to delete all notifications";it.error(l,{icon:"❌",position:"bottom-center"})}}}};function t0e(r,i){return k.useReducer((a,l)=>i[a][l]??a,r)}var IO="ScrollArea",[M7,Q0e]=lu(IO),[n0e,ms]=M7(IO),U7=k.forwardRef((r,i)=>{const{__scopeScrollArea:a,type:l="hover",dir:u,scrollHideDelay:f=600,..._}=r,[v,w]=k.useState(null),[C,N]=k.useState(null),[D,O]=k.useState(null),[G,F]=k.useState(null),[V,L]=k.useState(null),[B,W]=k.useState(0),[z,$]=k.useState(0),[te,ie]=k.useState(!1),[ce,pe]=k.useState(!1),Pe=Tn(i,ge=>w(ge)),_e=e9(u);return S.jsx(n0e,{scope:a,type:l,dir:_e,scrollHideDelay:f,scrollArea:v,viewport:C,onViewportChange:N,content:D,onContentChange:O,scrollbarX:G,onScrollbarXChange:F,scrollbarXEnabled:te,onScrollbarXEnabledChange:ie,scrollbarY:V,onScrollbarYChange:L,scrollbarYEnabled:ce,onScrollbarYEnabledChange:pe,onCornerWidthChange:W,onCornerHeightChange:$,children:S.jsx(Bt.div,{dir:_e,..._,ref:Pe,style:{position:"relative","--radix-scroll-area-corner-width":B+"px","--radix-scroll-area-corner-height":z+"px",...r.style}})})});U7.displayName=IO;var j7="ScrollAreaViewport",V7=k.forwardRef((r,i)=>{const{__scopeScrollArea:a,children:l,asChild:u,nonce:f,..._}=r,v=ms(j7,a),w=k.useRef(null),C=Tn(i,w,v.onViewportChange);return S.jsxs(S.Fragment,{children:[S.jsx("style",{dangerouslySetInnerHTML:{__html:`
[data-radix-scroll-area-viewport] {
  scrollbar-width: none;
  -ms-overflow-style: none;
  -webkit-overflow-scrolling: touch;
}
[data-radix-scroll-area-viewport]::-webkit-scrollbar {
  display: none;
}
:where([data-radix-scroll-area-viewport]) {
  display: flex;
  flex-direction: column;
  align-items: stretch;
}
:where([data-radix-scroll-area-content]) {
  flex-grow: 1;
}
`},nonce:f}),S.jsx(Bt.div,{"data-radix-scroll-area-viewport":"",..._,asChild:u,ref:C,style:{overflowX:v.scrollbarXEnabled?"scroll":"hidden",overflowY:v.scrollbarYEnabled?"scroll":"hidden",...r.style},children:h0e({asChild:u,children:l},N=>S.jsx("div",{"data-radix-scroll-area-content":"",ref:v.onContentChange,style:{minWidth:v.scrollbarXEnabled?"fit-content":void 0},children:N}))})]})});V7.displayName=j7;var Ma="ScrollAreaScrollbar",AO=k.forwardRef((r,i)=>{const{forceMount:a,...l}=r,u=ms(Ma,r.__scopeScrollArea),{onScrollbarXEnabledChange:f,onScrollbarYEnabledChange:_}=u,v=r.orientation==="horizontal";return k.useEffect(()=>(v?f(!0):_(!0),()=>{v?f(!1):_(!1)}),[v,f,_]),u.type==="hover"?S.jsx(r0e,{...l,ref:i,forceMount:a}):u.type==="scroll"?S.jsx(i0e,{...l,ref:i,forceMount:a}):u.type==="auto"?S.jsx(F7,{...l,ref:i,forceMount:a}):u.type==="always"?S.jsx(NO,{...l,ref:i}):null});AO.displayName=Ma;var r0e=k.forwardRef((r,i)=>{const{forceMount:a,...l}=r,u=ms(Ma,r.__scopeScrollArea),[f,_]=k.useState(!1);return k.useEffect(()=>{const v=u.scrollArea;let w=0;if(v){const C=()=>{window.clearTimeout(w),_(!0)},N=()=>{w=window.setTimeout(()=>_(!1),u.scrollHideDelay)};return v.addEventListener("pointerenter",C),v.addEventListener("pointerleave",N),()=>{window.clearTimeout(w),v.removeEventListener("pointerenter",C),v.removeEventListener("pointerleave",N)}}},[u.scrollArea,u.scrollHideDelay]),S.jsx(qs,{present:a||f,children:S.jsx(F7,{"data-state":f?"visible":"hidden",...l,ref:i})})}),i0e=k.forwardRef((r,i)=>{const{forceMount:a,...l}=r,u=ms(Ma,r.__scopeScrollArea),f=r.orientation==="horizontal",_=C0(()=>w("SCROLL_END"),100),[v,w]=t0e("hidden",{hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}});return k.useEffect(()=>{if(v==="idle"){const C=window.setTimeout(()=>w("HIDE"),u.scrollHideDelay);return()=>window.clearTimeout(C)}},[v,u.scrollHideDelay,w]),k.useEffect(()=>{const C=u.viewport,N=f?"scrollLeft":"scrollTop";if(C){let D=C[N];const O=()=>{const G=C[N];D!==G&&(w("SCROLL"),_()),D=G};return C.addEventListener("scroll",O),()=>C.removeEventListener("scroll",O)}},[u.viewport,f,w,_]),S.jsx(qs,{present:a||v!=="hidden",children:S.jsx(NO,{"data-state":v==="hidden"?"hidden":"visible",...l,ref:i,onPointerEnter:At(r.onPointerEnter,()=>w("POINTER_ENTER")),onPointerLeave:At(r.onPointerLeave,()=>w("POINTER_LEAVE"))})})}),F7=k.forwardRef((r,i)=>{const a=ms(Ma,r.__scopeScrollArea),{forceMount:l,...u}=r,[f,_]=k.useState(!1),v=r.orientation==="horizontal",w=C0(()=>{if(a.viewport){const C=a.viewport.offsetWidth<a.viewport.scrollWidth,N=a.viewport.offsetHeight<a.viewport.scrollHeight;_(v?C:N)}},10);return Np(a.viewport,w),Np(a.content,w),S.jsx(qs,{present:l||f,children:S.jsx(NO,{"data-state":f?"visible":"hidden",...u,ref:i})})}),NO=k.forwardRef((r,i)=>{const{orientation:a="vertical",...l}=r,u=ms(Ma,r.__scopeScrollArea),f=k.useRef(null),_=k.useRef(0),[v,w]=k.useState({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),C=z7(v.viewport,v.content),N={...l,sizes:v,onSizesChange:w,hasThumb:C>0&&C<1,onThumbChange:O=>f.current=O,onThumbPointerUp:()=>_.current=0,onThumbPointerDown:O=>_.current=O};function D(O,G){return d0e(O,_.current,v,G)}return a==="horizontal"?S.jsx(o0e,{...N,ref:i,onThumbPositionChange:()=>{if(u.viewport&&f.current){const O=u.viewport.scrollLeft,G=n6(O,v,u.dir);f.current.style.transform=`translate3d(${G}px, 0, 0)`}},onWheelScroll:O=>{u.viewport&&(u.viewport.scrollLeft=O)},onDragScroll:O=>{u.viewport&&(u.viewport.scrollLeft=D(O,u.dir))}}):a==="vertical"?S.jsx(s0e,{...N,ref:i,onThumbPositionChange:()=>{if(u.viewport&&f.current){const O=u.viewport.scrollTop,G=n6(O,v);f.current.style.transform=`translate3d(0, ${G}px, 0)`}},onWheelScroll:O=>{u.viewport&&(u.viewport.scrollTop=O)},onDragScroll:O=>{u.viewport&&(u.viewport.scrollTop=D(O))}}):null}),o0e=k.forwardRef((r,i)=>{const{sizes:a,onSizesChange:l,...u}=r,f=ms(Ma,r.__scopeScrollArea),[_,v]=k.useState(),w=k.useRef(null),C=Tn(i,w,f.onScrollbarXChange);return k.useEffect(()=>{w.current&&v(getComputedStyle(w.current))},[w]),S.jsx(W7,{"data-orientation":"horizontal",...u,ref:C,sizes:a,style:{bottom:0,left:f.dir==="rtl"?"var(--radix-scroll-area-corner-width)":0,right:f.dir==="ltr"?"var(--radix-scroll-area-corner-width)":0,"--radix-scroll-area-thumb-width":R0(a)+"px",...r.style},onThumbPointerDown:N=>r.onThumbPointerDown(N.x),onDragScroll:N=>r.onDragScroll(N.x),onWheelScroll:(N,D)=>{if(f.viewport){const O=f.viewport.scrollLeft+N.deltaX;r.onWheelScroll(O),Y7(O,D)&&N.preventDefault()}},onResize:()=>{w.current&&f.viewport&&_&&l({content:f.viewport.scrollWidth,viewport:f.viewport.offsetWidth,scrollbar:{size:w.current.clientWidth,paddingStart:bS(_.paddingLeft),paddingEnd:bS(_.paddingRight)}})}})}),s0e=k.forwardRef((r,i)=>{const{sizes:a,onSizesChange:l,...u}=r,f=ms(Ma,r.__scopeScrollArea),[_,v]=k.useState(),w=k.useRef(null),C=Tn(i,w,f.onScrollbarYChange);return k.useEffect(()=>{w.current&&v(getComputedStyle(w.current))},[w]),S.jsx(W7,{"data-orientation":"vertical",...u,ref:C,sizes:a,style:{top:0,right:f.dir==="ltr"?0:void 0,left:f.dir==="rtl"?0:void 0,bottom:"var(--radix-scroll-area-corner-height)","--radix-scroll-area-thumb-height":R0(a)+"px",...r.style},onThumbPointerDown:N=>r.onThumbPointerDown(N.y),onDragScroll:N=>r.onDragScroll(N.y),onWheelScroll:(N,D)=>{if(f.viewport){const O=f.viewport.scrollTop+N.deltaY;r.onWheelScroll(O),Y7(O,D)&&N.preventDefault()}},onResize:()=>{w.current&&f.viewport&&_&&l({content:f.viewport.scrollHeight,viewport:f.viewport.offsetHeight,scrollbar:{size:w.current.clientHeight,paddingStart:bS(_.paddingTop),paddingEnd:bS(_.paddingBottom)}})}})}),[a0e,B7]=M7(Ma),W7=k.forwardRef((r,i)=>{const{__scopeScrollArea:a,sizes:l,hasThumb:u,onThumbChange:f,onThumbPointerUp:_,onThumbPointerDown:v,onThumbPositionChange:w,onDragScroll:C,onWheelScroll:N,onResize:D,...O}=r,G=ms(Ma,a),[F,V]=k.useState(null),L=Tn(i,Pe=>V(Pe)),B=k.useRef(null),W=k.useRef(""),z=G.viewport,$=l.content-l.viewport,te=Dr(N),ie=Dr(w),ce=C0(D,10);function pe(Pe){if(B.current){const _e=Pe.clientX-B.current.left,ge=Pe.clientY-B.current.top;C({x:_e,y:ge})}}return k.useEffect(()=>{const Pe=_e=>{const ge=_e.target;(F==null?void 0:F.contains(ge))&&te(_e,$)};return document.addEventListener("wheel",Pe,{passive:!1}),()=>document.removeEventListener("wheel",Pe,{passive:!1})},[z,F,$,te]),k.useEffect(ie,[l,ie]),Np(F,ce),Np(G.content,ce),S.jsx(a0e,{scope:a,scrollbar:F,hasThumb:u,onThumbChange:Dr(f),onThumbPointerUp:Dr(_),onThumbPositionChange:ie,onThumbPointerDown:Dr(v),children:S.jsx(Bt.div,{...O,ref:L,style:{position:"absolute",...O.style},onPointerDown:At(r.onPointerDown,Pe=>{Pe.button===0&&(Pe.target.setPointerCapture(Pe.pointerId),B.current=F.getBoundingClientRect(),W.current=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",G.viewport&&(G.viewport.style.scrollBehavior="auto"),pe(Pe))}),onPointerMove:At(r.onPointerMove,pe),onPointerUp:At(r.onPointerUp,Pe=>{const _e=Pe.target;_e.hasPointerCapture(Pe.pointerId)&&_e.releasePointerCapture(Pe.pointerId),document.body.style.webkitUserSelect=W.current,G.viewport&&(G.viewport.style.scrollBehavior=""),B.current=null})})})}),CS="ScrollAreaThumb",H7=k.forwardRef((r,i)=>{const{forceMount:a,...l}=r,u=B7(CS,r.__scopeScrollArea);return S.jsx(qs,{present:a||u.hasThumb,children:S.jsx(c0e,{ref:i,...l})})}),c0e=k.forwardRef((r,i)=>{const{__scopeScrollArea:a,style:l,...u}=r,f=ms(CS,a),_=B7(CS,a),{onThumbPositionChange:v}=_,w=Tn(i,D=>_.onThumbChange(D)),C=k.useRef(),N=C0(()=>{C.current&&(C.current(),C.current=void 0)},100);return k.useEffect(()=>{const D=f.viewport;if(D){const O=()=>{if(N(),!C.current){const G=u0e(D,v);C.current=G,v()}};return v(),D.addEventListener("scroll",O),()=>D.removeEventListener("scroll",O)}},[f.viewport,N,v]),S.jsx(Bt.div,{"data-state":_.hasThumb?"visible":"hidden",...u,ref:w,style:{width:"var(--radix-scroll-area-thumb-width)",height:"var(--radix-scroll-area-thumb-height)",...l},onPointerDownCapture:At(r.onPointerDownCapture,D=>{const G=D.target.getBoundingClientRect(),F=D.clientX-G.left,V=D.clientY-G.top;_.onThumbPointerDown({x:F,y:V})}),onPointerUp:At(r.onPointerUp,_.onThumbPointerUp)})});H7.displayName=CS;var OO="ScrollAreaCorner",G7=k.forwardRef((r,i)=>{const a=ms(OO,r.__scopeScrollArea),l=!!(a.scrollbarX&&a.scrollbarY);return a.type!=="scroll"&&l?S.jsx(l0e,{...r,ref:i}):null});G7.displayName=OO;var l0e=k.forwardRef((r,i)=>{const{__scopeScrollArea:a,...l}=r,u=ms(OO,a),[f,_]=k.useState(0),[v,w]=k.useState(0),C=!!(f&&v);return Np(u.scrollbarX,()=>{var D;const N=((D=u.scrollbarX)==null?void 0:D.offsetHeight)||0;u.onCornerHeightChange(N),w(N)}),Np(u.scrollbarY,()=>{var D;const N=((D=u.scrollbarY)==null?void 0:D.offsetWidth)||0;u.onCornerWidthChange(N),_(N)}),C?S.jsx(Bt.div,{...l,ref:i,style:{width:f,height:v,position:"absolute",right:u.dir==="ltr"?0:void 0,left:u.dir==="rtl"?0:void 0,bottom:0,...r.style}}):null});function bS(r){return r?parseInt(r,10):0}function z7(r,i){const a=r/i;return isNaN(a)?0:a}function R0(r){const i=z7(r.viewport,r.content),a=r.scrollbar.paddingStart+r.scrollbar.paddingEnd,l=(r.scrollbar.size-a)*i;return Math.max(l,18)}function d0e(r,i,a,l="ltr"){const u=R0(a),f=u/2,_=i||f,v=u-_,w=a.scrollbar.paddingStart+_,C=a.scrollbar.size-a.scrollbar.paddingEnd-v,N=a.content-a.viewport,D=l==="ltr"?[0,N]:[N*-1,0];return K7([w,C],D)(r)}function n6(r,i,a="ltr"){const l=R0(i),u=i.scrollbar.paddingStart+i.scrollbar.paddingEnd,f=i.scrollbar.size-u,_=i.content-i.viewport,v=f-l,w=a==="ltr"?[0,_]:[_*-1,0],C=VA(r,w);return K7([0,_],[0,v])(C)}function K7(r,i){return a=>{if(r[0]===r[1]||i[0]===i[1])return i[0];const l=(i[1]-i[0])/(r[1]-r[0]);return i[0]+l*(a-r[0])}}function Y7(r,i){return r>0&&r<i}var u0e=(r,i=()=>{})=>{let a={left:r.scrollLeft,top:r.scrollTop},l=0;return function u(){const f={left:r.scrollLeft,top:r.scrollTop},_=a.left!==f.left,v=a.top!==f.top;(_||v)&&i(),a=f,l=window.requestAnimationFrame(u)}(),()=>window.cancelAnimationFrame(l)};function C0(r,i){const a=Dr(r),l=k.useRef(0);return k.useEffect(()=>()=>window.clearTimeout(l.current),[]),k.useCallback(()=>{window.clearTimeout(l.current),l.current=window.setTimeout(a,i)},[a,i])}function Np(r,i){const a=Dr(i);Xr(()=>{let l=0;if(r){const u=new ResizeObserver(()=>{cancelAnimationFrame(l),l=window.requestAnimationFrame(a)});return u.observe(r),()=>{window.cancelAnimationFrame(l),u.unobserve(r)}}},[r,a])}function h0e(r,i){const{asChild:a,children:l}=r;if(!a)return typeof i=="function"?i(l):i;const u=k.Children.only(l);return k.cloneElement(u,{children:typeof i=="function"?i(u.props.children):i})}var q7=U7,p0e=V7,f0e=G7;const X7=k.forwardRef(({className:r,children:i,...a},l)=>S.jsxs(q7,{ref:l,className:Lt("relative overflow-hidden",r),...a,children:[S.jsx(p0e,{className:"h-full w-full rounded-[inherit]",children:i}),S.jsx($7,{}),S.jsx(f0e,{})]}));X7.displayName=q7.displayName;const $7=k.forwardRef(({className:r,orientation:i="vertical",...a},l)=>S.jsx(AO,{ref:l,orientation:i,className:Lt("flex touch-none select-none transition-colors",i==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-[1px]",i==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",r),...a,children:S.jsx(H7,{className:"relative flex-1 rounded-full bg-border"})}));$7.displayName=AO.displayName;const m0e=()=>{const[r,i]=k.useState(!1),[a,l]=k.useState(null);hu();const{hasUnreadNotifications:u,setHasUnreadNotifications:f}=Gg(),_=La.baseUrl;k.useEffect(()=>{(async()=>{try{i(!0);const O=await jm.getNotificaitons();if(O.length===void 0)return;console.log("dataLeght is ",O.length),l(O),console.log(O.map(G=>G.id))}catch(O){console.error("Error fetching Notification data:",O)}finally{i(!1)}})()},[]);const v=async D=>{try{await jm.markNotificationAsRead(D);const O=a==null?void 0:a.map(G=>G.id===D?{...G,isRead:!0}:G);l(O),it.success("Notification marked as read")}catch(O){console.error("Error marking notification as read:",O),it.error("Failed to mark notification as read")}},w=async()=>{try{await jm.markAllNotificationsAsRead();const D=a==null?void 0:a.map(O=>({...O,isRead:!0}));l(D),f(!1),it.success("All notifications marked as read")}catch(D){console.error("Error marking all notifications as read:",D),it.error("Failed to mark all notifications as read")}},C=async D=>{try{await jm.deleteNotification(D);const O=a==null?void 0:a.filter(G=>G.id!==D);l(O),f(!1),it.success("Notification deleted")}catch(O){console.error("Error clearing notification:",O),it.error("Failed to delete notification")}},N=async()=>{try{await jm.deleteAllNotifications(),l([]),f(!1),it.success("All notifications cleared")}catch(D){console.error("Error clearing all notifications:",D),it.error("Failed to clear all notifications")}};return S.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-4xl pt-16",children:[S.jsxs("div",{className:"flex items-center justify-between mb-6",children:[S.jsxs("div",{className:"flex items-center gap-2",children:[S.jsx(ng,{className:"h-6 w-6 text-blue-500"}),S.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Notifications"})]}),a&&a.length>0&&S.jsxs("div",{className:"flex gap-2",children:[S.jsxs(sn,{variant:"outline",size:"sm",onClick:w,className:"flex items-center gap-2",children:[S.jsx(ng,{className:"h-4 w-4"}),"Mark All as Read"]}),S.jsxs(sn,{variant:"destructive",size:"sm",onClick:N,className:"flex items-center gap-2",children:[S.jsx(she,{className:"h-4 w-4"}),"Clear All"]})]})]}),S.jsx(X7,{className:"h-[600px] rounded-lg border",children:(a==null?void 0:a.length)===void 0?S.jsxs("div",{className:"flex flex-col items-center justify-center h-[400px] text-gray-500",children:[S.jsx(ng,{className:"h-12 w-12 mb-4"}),S.jsx("p",{className:"text-lg",children:"No notifications yet"})]}):S.jsx("div",{className:"p-4 space-y-4",children:a==null?void 0:a.map(D=>S.jsx(Wp,{className:`p-4 ${D.isRead?"bg-gray-50":"bg-white border-blue-200"}`,children:S.jsxs("div",{className:"flex justify-between items-start",children:[S.jsxs("div",{className:"flex gap-3",children:[S.jsxs(pu,{className:"h-10 w-10",children:[S.jsx(fu,{src:`${_+D.profileImageUrl}`,alt:"User"}),S.jsx(mu,{children:S.jsx(du,{className:"h-5 w-5"})})]}),S.jsxs("div",{className:"space-y-1",children:[S.jsx("p",{className:"font-medium text-sm",children:D.patientName}),S.jsx("p",{className:`text-sm ${D.isRead?"text-gray-600":"text-gray-900"}`,children:D.content}),S.jsx("p",{className:"text-xs text-gray-500",children:k7(D.createdAt)})]})]}),S.jsxs("div",{className:"flex gap-2",children:[!D.isRead&&S.jsx(sn,{variant:"ghost",size:"sm",onClick:()=>v(D.id),className:"text-blue-600 hover:text-blue-700",children:"Mark as read"}),S.jsx(sn,{variant:"ghost",size:"sm",onClick:()=>C(D.id),className:"text-gray-600 hover:text-gray-700",children:"Delete"})]})]})},D.id))})})]})};var J7={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},r6=Ve.createContext&&Ve.createContext(J7),g0e=["attr","size","title"];function _0e(r,i){if(r==null)return{};var a=E0e(r,i),l,u;if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(r);for(u=0;u<f.length;u++)l=f[u],!(i.indexOf(l)>=0)&&Object.prototype.propertyIsEnumerable.call(r,l)&&(a[l]=r[l])}return a}function E0e(r,i){if(r==null)return{};var a={};for(var l in r)if(Object.prototype.hasOwnProperty.call(r,l)){if(i.indexOf(l)>=0)continue;a[l]=r[l]}return a}function IS(){return IS=Object.assign?Object.assign.bind():function(r){for(var i=1;i<arguments.length;i++){var a=arguments[i];for(var l in a)Object.prototype.hasOwnProperty.call(a,l)&&(r[l]=a[l])}return r},IS.apply(this,arguments)}function i6(r,i){var a=Object.keys(r);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(r);i&&(l=l.filter(function(u){return Object.getOwnPropertyDescriptor(r,u).enumerable})),a.push.apply(a,l)}return a}function AS(r){for(var i=1;i<arguments.length;i++){var a=arguments[i]!=null?arguments[i]:{};i%2?i6(Object(a),!0).forEach(function(l){v0e(r,l,a[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(a)):i6(Object(a)).forEach(function(l){Object.defineProperty(r,l,Object.getOwnPropertyDescriptor(a,l))})}return r}function v0e(r,i,a){return i=y0e(i),i in r?Object.defineProperty(r,i,{value:a,enumerable:!0,configurable:!0,writable:!0}):r[i]=a,r}function y0e(r){var i=S0e(r,"string");return typeof i=="symbol"?i:i+""}function S0e(r,i){if(typeof r!="object"||!r)return r;var a=r[Symbol.toPrimitive];if(a!==void 0){var l=a.call(r,i||"default");if(typeof l!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(r)}function Q7(r){return r&&r.map((i,a)=>Ve.createElement(i.tag,AS({key:a},i.attr),Q7(i.child)))}function PO(r){return i=>Ve.createElement(T0e,IS({attr:AS({},r.attr)},i),Q7(r.child))}function T0e(r){var i=a=>{var{attr:l,size:u,title:f}=r,_=_0e(r,g0e),v=u||a.size||"1em",w;return a.className&&(w=a.className),r.className&&(w=(w?w+" ":"")+r.className),Ve.createElement("svg",IS({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},a.attr,l,_,{className:w,style:AS(AS({color:r.color||a.color},a.style),r.style),height:v,width:v,xmlns:"http://www.w3.org/2000/svg"}),f&&Ve.createElement("title",null,f),r.children)};return r6!==void 0?Ve.createElement(r6.Consumer,null,a=>i(a)):i(J7)}function o6(r){return PO({tag:"svg",attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M144 479H48c-26.5 0-48-21.5-48-48V79c0-26.5 21.5-48 48-48h96c26.5 0 48 21.5 48 48v352c0 26.5-21.5 48-48 48zm304-48V79c0-26.5-21.5-48-48-48h-96c-26.5 0-48 21.5-48 48v352c0 26.5 21.5 48 48 48h96c26.5 0 48-21.5 48-48z"},child:[]}]})(r)}function s6(r){return PO({tag:"svg",attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M424.4 214.7L72.4 6.6C43.8-10.3 0 6.1 0 47.9V464c0 37.5 40.7 60.1 72.4 41.3l352-208c31.4-18.5 31.5-64.1 0-82.6z"},child:[]}]})(r)}function w0e(r){return PO({tag:"svg",attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M215.03 71.05L126.06 160H24c-13.26 0-24 10.74-24 24v144c0 13.25 10.74 24 24 24h102.06l88.97 88.95c15.03 15.03 40.97 4.47 40.97-16.97V88.02c0-21.46-25.96-31.98-40.97-16.97zm233.32-51.08c-11.17-7.33-26.18-4.24-33.51 6.95-7.34 11.17-4.22 26.18 6.95 33.51 66.27 43.49 105.82 116.6 105.82 195.58 0 78.98-39.55 152.09-105.82 195.58-11.17 7.32-14.29 22.34-6.95 33.5 7.04 10.71 21.93 14.56 33.51 6.95C528.27 439.58 576 351.33 576 256S528.27 72.43 448.35 19.97zM480 256c0-63.53-32.06-121.94-85.77-156.24-11.19-7.14-26.03-3.82-33.12 7.46s-3.78 26.21 7.41 33.36C408.27 165.97 432 209.11 432 256s-23.73 90.03-63.48 115.42c-11.19 7.14-14.5 22.07-7.41 33.36 6.51 10.36 21.12 15.14 33.12 7.46C447.94 377.94 480 319.54 480 256zm-141.77-76.87c-11.58-6.33-26.19-2.16-32.61 9.45-6.39 11.61-2.16 26.2 9.45 32.61C327.98 228.28 336 241.63 336 256c0 14.38-8.02 27.72-20.92 34.81-11.61 6.41-15.84 21-9.45 32.61 6.43 11.66 21.05 15.8 32.61 9.45 28.23-15.55 45.77-45 45.77-76.88s-17.54-61.32-45.78-76.86z"},child:[]}]})(r)}const R0e=()=>{const[r,i]=k.useState(""),[a,l]=k.useState(!1),[u,f]=k.useState(!1),[_,v]=k.useState(""),[w,C]=k.useState(!1),[N,D]=k.useState("IDLE"),[O,G]=k.useState(null),[F,V]=k.useState([]),[L,B]=k.useState("en-US"),[W,z]=k.useState(null),[$,te]=k.useState(!1),ie="sk_e5d11a8fa447e997b36dd4d2fcfdf7c3b78e60defecadfd7",ce="https://bewtihme-001-site1.jtempurl.com/uploads/videos/ManFace.mp4",pe="https://bewtihme-001-site1.jtempurl.com/api/Audio/upload",Pe="https://bewtihme-001-site1.jtempurl.com/api/sync/generate",_e=k.useRef(null),ge=k.useRef(null),fe={"en-US":"LXrTqFIgiubkrMkwvOUr","ar-SA":"LXrTqFIgiubkrMkwvOUr"},xe=(dt,at=!1)=>{const Ke=`[${new Date().toISOString()}] ${at?"ERROR: ":""}${dt}`;V(et=>[...et,Ke]),console.log(Ke)},be=(dt,at=!1)=>{const Fe=document.createElement("div");Fe.className=`fixed bottom-4 right-4 px-4 py-2 rounded-md shadow-lg z-50 ${at?"bg-red-500 text-white":"bg-green-500 text-white"}`,Fe.textContent=dt,document.body.appendChild(Fe),setTimeout(()=>Fe.remove(),3e3)},ft=()=>{const dt=L==="en-US"?"ar-SA":"en-US";B(dt),be(dt==="en-US"?"Language set to English":"تم تغيير اللغة إلى العربية"),xe(`Language changed to: ${dt}`)},je=async(dt,at)=>{const Fe=fe[at];try{xe("Generating audio with ElevenLabs...");const Ke=await $t.post(`https://api.elevenlabs.io/v1/text-to-speech/${Fe}`,{text:dt,model_id:"eleven_multilingual_v2",voice_settings:{stability:.5,similarity_boost:.75},format:"wav"},{headers:{"xi-api-key":ie,"Content-Type":"application/json"},responseType:"blob"});return xe("Audio generated successfully."),new Blob([Ke.data],{type:"audio/wav"})}catch(Ke){throw xe("Failed to generate audio: "+Ke.message,!0),Ke}},Ge=async dt=>{var Fe,Ke;if(!dt||dt.size<1e3)throw new Error("Invalid audio blob");f(!0);const at=new FormData;at.append("File",dt,`audio_${Date.now()}.wav`);try{xe("Uploading audio...");const et=await $t.post(pe,at,{headers:{Accept:"*/*"},withCredentials:!0,timeout:3e4}),nt=typeof et.data=="string"?et.data:et.data.url;return z(nt),xe(`Audio uploaded: ${nt}`),nt}catch(et){const nt=((Ke=(Fe=et.response)==null?void 0:Fe.data)==null?void 0:Ke.message)||et.message;throw xe(`Upload failed: ${nt}`,!0),new Error(nt)}finally{f(!1)}},le=async dt=>{var at,Fe;C(!0),D("PROCESSING");try{const Ke={model:"lipsync-1.7.1",input:[{url:ce,type:"video"},{url:dt,type:"audio"}],options:{sync_mode:"loop",output_format:"mp4",output_resolution:[1280,720]}};xe("Sending request to Sync Labs...");const et=await $t.post(Pe,Ke,{headers:{"Content-Type":"application/json"},timeout:6e4});xe(`Sync request started: ${et.data.id}`),await Le(et.data.id)}catch(Ke){const et=((Fe=(at=Ke.response)==null?void 0:at.data)==null?void 0:Fe.message)||Ke.message;throw xe("Merge error: "+et,!0),G(et),D("ERROR"),Ke}finally{C(!1)}},Le=async dt=>{var Ke,et;const Fe=Date.now();try{for(;;){if(Date.now()-Fe>3e5)throw new Error("Processing timed out");const nt=await $t.get(`${Pe}/${dt}`,{headers:{"Content-Type":"application/json"}}),{status:bt,outputUrl:It,error:an}=nt.data;if(D(bt),bt==="COMPLETED"&&It){v(It),xe("Video generation completed: "+It);break}else if(bt==="FAILED"||an)throw new Error(an||"Video generation failed");await new Promise(kr=>setTimeout(kr,5e3))}}catch(nt){const bt=((et=(Ke=nt.response)==null?void 0:Ke.data)==null?void 0:et.message)||nt.message;throw xe("Status check error: "+bt,!0),G(bt),D("ERROR"),nt}},ot=async()=>{if(!r.trim()){be(L==="en-US"?"Please enter text first":"الرجاء إدخال نص أولاً",!0);return}l(!0),D("PROCESSING"),G(null),v(""),z(null);try{const dt=await je(r,L),at=await Ge(dt);_e.current&&(_e.current.src=at),await le(at),be(L==="en-US"?"Video generated successfully!":"تم إنشاء الفيديو بنجاح!")}catch(dt){G(dt.message),D("ERROR"),be(L==="en-US"?`Error: ${dt.message}`:`خطأ: ${dt.message}`,!0)}finally{l(!1),D(N!=="ERROR"?"COMPLETED":"ERROR")}},Xe=()=>{const dt=window.open("","_blank","width=800,height=600");dt.document.write(`
      <html>
        <head>
          <title>Application Logs</title>
          <style>
            body { font-family: monospace; padding: 20px; white-space: pre-wrap; }
            .error { color: red; }
            .info { color: black; }
          </style>
        </head>
        <body>
          <h2>Application Logs</h2>
          ${F.map(at=>`
            <div class="${at.includes("ERROR")?"error":"info"}">
              ${at}
            </div>
          `).join("")}
        </body>
      </html>
    `),dt.document.close()},st=()=>{_e.current&&(_e.current.paused?_e.current.play().then(()=>te(!0)):(_e.current.pause(),te(!1)))},ze=()=>{ge.current&&(ge.current.paused?ge.current.play():ge.current.pause())},ht=()=>{switch(N){case"PROCESSING":return"bg-blue-100 text-blue-800";case"COMPLETED":return"bg-green-100 text-green-800";case"ERROR":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}};return S.jsxs("div",{className:"min-h-screen bg-gray-100 pt-16",children:[(a||u||w)&&S.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:S.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-xl max-w-md w-full",children:[S.jsxs("div",{className:"flex items-center space-x-4",children:[S.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-t-2 border-b-2 border-blue-500"}),S.jsxs("div",{children:[S.jsx("h3",{className:"font-medium text-lg",children:L==="en-US"?"Processing":"جاري المعالجة"}),S.jsxs("p",{className:"text-gray-600",children:[u&&(L==="en-US"?"Uploading audio...":"جاري رفع الصوت..."),w&&(L==="en-US"?"Generating video...":"جاري إنشاء الفيديو...")]})]})]}),S.jsx("div",{className:"mt-4 w-full bg-gray-200 rounded-full h-2",children:S.jsx("div",{className:"bg-blue-600 h-2 rounded-full animate-pulse",style:{width:`${u?"40%":w?"80%":"20%"}`}})})]})}),S.jsx("div",{className:"container mx-auto px-4 py-8",children:S.jsxs("div",{className:"max-w-4xl mx-auto bg-white rounded-xl shadow-md overflow-hidden",children:[S.jsxs("div",{className:"bg-blue-600 px-6 py-4 flex justify-between items-center",children:[S.jsx("h1",{className:"text-2xl font-bold text-white",children:L==="en-US"?"VoiceSync Pro":"مزامنة الصوت"}),S.jsx("button",{onClick:ft,className:"px-3 py-1 bg-white text-blue-600 rounded-md hover:bg-blue-50 transition-colors",children:L==="en-US"?"العربية":"English"})]}),S.jsxs("div",{className:"p-6",children:[S.jsxs("div",{className:"mb-8",children:[S.jsx("label",{className:"block text-lg font-medium text-gray-700 mb-2",children:L==="en-US"?"Enter your text":"أدخل النص الخاص بك"}),S.jsx("textarea",{value:r,onChange:dt=>i(dt.target.value),placeholder:L==="en-US"?"Type or paste your text here...":"اكتب أو الصق النص هنا...",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",rows:5})]}),S.jsxs("div",{className:"flex flex-col space-y-4 mb-8",children:[S.jsx("button",{onClick:ot,disabled:a||!r.trim(),className:`px-6 py-3 rounded-lg font-medium flex items-center justify-center space-x-2 transition-colors ${a||!r.trim()?"bg-gray-300 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 text-white"}`,children:a?S.jsxs(S.Fragment,{children:[S.jsx("span",{className:"inline-block w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),S.jsx("span",{children:L==="en-US"?"Processing...":"جاري المعالجة..."})]}):S.jsxs(S.Fragment,{children:[S.jsx(w0e,{}),S.jsx("span",{children:L==="en-US"?"Generate Video":"إنشاء فيديو"})]})}),W&&S.jsxs("button",{onClick:st,className:"px-6 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium flex items-center justify-center space-x-2",children:[$?S.jsx(o6,{}):S.jsx(s6,{}),S.jsx("span",{children:L==="en-US"?$?"Pause Audio":"Play Audio":$?"إيقاف الصوت":"تشغيل الصوت"})]})]}),_?S.jsxs("div",{className:"mb-8",children:[S.jsx("h2",{className:"text-lg font-medium text-gray-700 mb-2",children:L==="en-US"?"Generated Video":"الفيديو الناتج"}),S.jsxs("div",{className:"relative bg-black rounded-lg overflow-hidden",children:[S.jsx("video",{ref:ge,src:_,controls:!0,className:"w-full h-auto max-h-96",onClick:ze}),S.jsx("button",{onClick:ze,className:"absolute inset-0 flex items-center justify-center w-full h-full opacity-0 hover:opacity-100 transition-opacity",children:S.jsx("div",{className:"bg-black bg-opacity-50 rounded-full p-4",children:ge.current&&!ge.current.paused?S.jsx(o6,{className:"text-white text-2xl"}):S.jsx(s6,{className:"text-white text-2xl"})})})]})]}):S.jsx("div",{className:"mb-8 bg-gray-100 rounded-lg p-8 text-center",children:S.jsx("p",{className:"text-gray-500",children:L==="en-US"?"Your generated video will appear here":"سيظهر الفيديو الناتج هنا"})}),S.jsxs("div",{className:`p-4 rounded-lg ${ht()} mb-4`,children:[S.jsxs("div",{className:"flex items-center space-x-2",children:[S.jsx("div",{className:`w-3 h-3 rounded-full ${N==="PROCESSING"?"bg-blue-500 animate-pulse":N==="COMPLETED"?"bg-green-500":N==="ERROR"?"bg-red-500":"bg-gray-500"}`}),S.jsxs("h3",{className:"font-medium",children:[L==="en-US"?"Status:":"الحالة:"," ",N]})]}),O&&S.jsxs("div",{className:"mt-2 text-sm",children:[S.jsx("p",{className:"font-medium",children:L==="en-US"?"Error:":"خطأ:"}),S.jsx("p",{children:O})]})]}),S.jsxs("button",{onClick:Xe,className:"text-sm text-blue-600 hover:text-blue-800 flex items-center",children:[S.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:S.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),L==="en-US"?"Show Logs":"عرض السجلات"]})]})]})}),S.jsx("audio",{ref:_e,onEnded:()=>te(!1)})]})},C0e=La.baseUrl,a6=()=>{const[r,i]=k.useState(!1);k.useState(null);const{hasAcall:a,PatientName:l,setHasAcall:u,ChannelName:f,AppId:_,Uid:v,PatientImage:w}=Gg(),C=jp(),N=k.useRef(new Audio("/assets/google_meet_Ring.mp3"));if(k.useEffect(()=>(a&&N.current&&(N.current.loop=!0,N.current.play().catch(G=>console.error("Error playing ringtone:",G))),()=>{N.current&&(N.current.pause(),N.current.currentTime=0)}),[a]),k.useEffect(()=>{r&&(u(!1),C("/VideoCallScreen"))},[r,C,u]),!a)return null;const D=async()=>{try{const G=f,F=_,V=v,L=await Cr.post("/api/calls/join-call",{roomName:G,appId:F,uid:V});if(L.status===200)console.log("Successfully joined call on backend",L.data),N.current&&(N.current.pause(),N.current.currentTime=0),await new Promise(B=>setTimeout(B,1e3)),i(!0),u(!0);else throw console.error("Failed to join call on backend:",L.data),new Error("Failed to join call")}catch(G){console.error("Error joining call:",G),u(!1),i(!1)}},O=()=>{N.current&&(N.current.pause(),N.current.currentTime=0),u(!1),C("/home")};return S.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:S.jsxs("div",{className:"max-w-md w-full mx-4 p-8 bg-white/90 backdrop-blur-lg rounded-xl shadow-lg text-center",children:[S.jsxs("div",{className:"mb-8",children:[S.jsx("div",{className:"relative h-24 w-24 rounded-full bg-blue-100 flex items-center justify-center mx-auto mb-6 animate-vibrate",children:w?S.jsx("img",{src:C0e+w,alt:l,className:"h-full w-full rounded-full object-cover animate-vibrate"}):S.jsx(YN,{className:"h-12 w-12 text-blue-500"})}),S.jsx("h1",{className:"text-3xl font-bold text-gray-800 mb-2",children:"Incoming Call"}),S.jsxs("p",{className:"text-gray-600",children:[l||"Someone"," is calling you..."]})]}),S.jsxs("div",{className:"flex gap-4",children:[S.jsx(sn,{onClick:D,variant:"default",className:"flex-1 py-6 text-lg bg-blue-500 hover:bg-blue-600 text-white transition-all duration-300",children:"Accept"}),S.jsx(sn,{onClick:O,variant:"destructive",className:"flex-1 py-6 text-lg bg-red-500 hover:bg-red-600 text-white transition-all duration-300",children:"Reject"})]})]})})},b0e=["/VideoCallScreen","/Translation"];function I0e({children:r}){const[i,a]=k.useState(!1),[l,u]=k.useState(!1),[f,_]=k.useState(!1),v=jp(),{isAuthenticated:w}=hu(),[C,N]=k.useState(""),[D,O]=k.useState(""),[G,F]=k.useState(""),[V,L]=k.useState(0),[B,W]=k.useState("");k.useState("");const z=b0e.includes(location.pathname);return k.useEffect(()=>{z&&l&&u(!1)},[location.pathname,z,l]),k.useEffect(()=>{let $=!0;return w?(async()=>{if(!w){console.log("SignalRProvider: Not authenticated, skipping initialization");return}try{if(console.log("SignalRProvider: Starting SignalR initialization"),await Fs.startConnection(),!$||(a(!0),await Fs.joinOnlineHelpersGroup(),!$))return;await Fs.subscribeToNewPostCreated(ie=>{$&&(console.log("SignalRProvider: New post notification received:",ie),_(!0),it.info("New post available!",{position:"top-center",style:{top:"20px",left:"50%",transform:"translateX(-50%)"},icon:"📢",duration:5e3,className:"custom-toast",description:(ie==null?void 0:ie.content)||"Click to view new posts",action:{label:"View Notifications",onClick:()=>{v("/notifications")}}}))}),await Fs.subscribetoIncomingCall(ie=>{if($){if(z){console.log("SignalRProvider: Ignoring incoming call - on disabled route:",location.pathname);return}if(console.log("SignalRProvider: Incoming call notification received:",ie),u(!0),N(ie.patientName),O(ie.channelName),F(ie.appId),L(ie.uid),W(ie.imageURL),console.log(ie.appId),console.log(ie.channelName),console.log(ie.uid),console.log("hasAcall",l),l)return console.log("receive a call"),S.jsx(a6,{})}}),console.log("SignalRProvider: SignalR initialization complete")}catch(ie){if(console.error("SignalR Provider: SignalR connection error:",ie),!$)return;a(!1),u(!1)}})():console.log("SignalRProvider: Not authenticated, skipping initialization"),()=>{var ie;$=!1,console.log("SignalR Provider: Cleaning up connection"),(ie=Fs.getConnection())!=null&&ie.connectionId&&(Fs.unsubscribeFromNewPostCreated(()=>{console.log("SignalR Provider: Unsubscribed from notifications")}),Fs.stopConnection(),a(!1))}},[w,v,z,location.pathname]),S.jsxs(WG.Provider,{value:{isConnected:i,PatientName:C,ChannelName:D,AppId:G,Uid:V,PatientImage:B,setHasAcall:u,hasAcall:l,hasUnreadNotifications:f,setHasUnreadNotifications:_},children:[r,l&&!z&&S.jsx(a6,{})]})}const A0e=({participants:r,activeSpeakerId:i,isScreenSharing:a,selfVideoEnabled:l,pinnedParticipantId:u,onTogglePin:f,className:_})=>{k.useEffect(()=>()=>{r.forEach(L=>{L.videoTrack&&!L.isSelf&&(L.videoTrack.stop(),L.videoTrack.close())})},[r]);const v=La.baseUrl,w=r.find(L=>L.isSelf),C=u?r.find(L=>L.id===u):null,N=r.filter(L=>!L.isSelf&&(!u||L.id!==u)),D=()=>{if(u)return"main";const L=r.length;return L<=1?'"main"':L<=4?'"main main" "secondary1 secondary2"':'"main main secondary1" "main main secondary2" "secondary3 secondary4 secondary5"'},O=()=>{if(u)return"1fr";const L=r.length;return L<=1?"1fr":L<=4?"1fr 1fr":"1fr 1fr 1fr"},G=()=>{if(u)return"1fr";const L=r.length;return L<=1?"1fr":L<=4?"2fr 1fr":"1.5fr 1.5fr 1fr"},F=u?[C]:r,V=L=>L?L.isVideoOn&&L.videoTrack?S.jsx("video",{ref:B=>{B&&L.videoTrack&&L.videoTrack.play(B)},className:"h-full w-full object-cover",autoPlay:!0,playsInline:!0}):S.jsx("div",{className:"h-full w-full flex items-center justify-center bg-gray-900",children:S.jsx("div",{className:"h-24 w-24 rounded-full bg-blue-600 flex items-center justify-center text-white text-4xl font-semibold",children:S.jsx("img",{src:v+L.imageURL,alt:"",className:"w-full h-full object-cover"})})}):null;return S.jsxs("div",{className:Lt("p-4 bg-gray-900 flex flex-col",_),children:[a?S.jsxs("div",{className:"flex flex-1 flex-col",children:[S.jsxs("div",{className:"relative flex-1 bg-gray-800 rounded-lg mb-2 overflow-hidden animate-scale-in",children:[S.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-blue-900/20 to-transparent"}),S.jsxs("div",{className:"absolute top-4 left-4 bg-gray-900/90 px-3 py-1 rounded-full text-[#93C5FD] text-sm shadow-md",children:["Screen Share • ",w==null?void 0:w.name]}),S.jsx("div",{className:"w-full h-full bg-black",children:(w==null?void 0:w.videoTrack)&&S.jsx("video",{ref:L=>{L&&(w!=null&&w.videoTrack)&&w.videoTrack.play(L)},className:"w-full h-full object-cover",autoPlay:!0,playsInline:!0})})]}),S.jsx("div",{className:"h-32 w-48 bg-gray-800 rounded-lg overflow-hidden animate-slide-up self-end shadow-lg",children:w&&S.jsxs("div",{className:"relative h-full w-full",children:[V(w),S.jsxs("div",{className:"absolute bottom-2 left-2 right-2 flex items-center",children:[S.jsxs("div",{className:"text-white text-xs bg-gray-900/90 px-2 py-1 rounded-full shadow-sm",children:[w.name," (You)"]}),S.jsx("div",{className:"ml-auto flex space-x-1",children:w.isMuted&&S.jsx("div",{className:"bg-red-500/90 p-1 rounded-full",children:S.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"text-white",children:[S.jsx("path",{d:"m2 2 20 20"}),S.jsx("path",{d:"M18.89 13.23A7.12 7.12 0 0 0 19 12v-2a7 7 0 0 0-14 0v2a7 7 0 0 0 .68 3"}),S.jsx("path",{d:"M8 22h8"}),S.jsx("path",{d:"M12 19v3"})]})})})]})]})})]}):S.jsx("div",{className:"grid flex-1 gap-2 overflow-hidden",style:{gridTemplateAreas:D(),gridTemplateColumns:O(),gridTemplateRows:G()},children:F.map((L,B)=>{const W=L.id===i,z=L.id===u,$=z||B===0?"main":`secondary${B}`,te=B*.15;return S.jsxs("div",{className:"relative bg-gray-800 rounded-lg overflow-hidden transition-all duration-300",style:{gridArea:$,animation:`scale-in 0.5s ease-out ${te}s forwards`,opacity:0},id:`container-${L.id}`,children:[S.jsx("div",{className:`absolute inset-0 ${W?"ring-2 ring-[#93C5FD]":""} ${z?"ring-2 ring-[#93C5FD]":""} rounded-lg`,children:V(L)}),W&&!z&&S.jsx("div",{className:"absolute inset-0 border-2 border-[#93C5FD] rounded-lg animate-pulse"}),S.jsx("button",{onClick:()=>f(L.id),className:"absolute top-2 right-2 p-2 bg-gray-900/80 hover:bg-gray-800 rounded-full shadow-md z-10",children:S.jsx(KN,{size:16,className:z?"text-[#93C5FD]":"text-gray-400",fill:z?"#93C5FD":"none"})}),S.jsxs("div",{className:"absolute bottom-2 left-2 right-2 flex items-center",children:[S.jsxs("div",{className:"text-white text-sm bg-gray-900/90 px-2 py-1 rounded-full shadow-sm flex items-center gap-1",children:[L.isHost&&S.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"text-[#93C5FD]",children:S.jsx("polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"})}),L.name," ",L.isSelf&&"(You)"]}),S.jsxs("div",{className:"ml-auto flex space-x-1",children:[L.isMuted&&S.jsx("div",{className:"bg-red-500/90 p-1 rounded-full shadow-sm",children:S.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"text-white",children:[S.jsx("path",{d:"m2 2 20 20"}),S.jsx("path",{d:"M18.89 13.23A7.12 7.12 0 0 0 19 12v-2a7 7 0 0 0-14 0v2a7 7 0 0 0 .68 3"}),S.jsx("path",{d:"M8 22h8"}),S.jsx("path",{d:"M12 19v3"})]})}),!L.isVideoOn&&S.jsx("div",{className:"bg-red-500/90 p-1 rounded-full shadow-sm ml-1",children:S.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"text-white",children:[S.jsx("path",{d:"M10.66 6H14c2.21 0 4 1.79 4 4v7"}),S.jsx("path",{d:"m2 2 20 20"}),S.jsx("path",{d:"M6.26 6.26A3 3 0 0 0 6 7v10c0 1.66 1.34 3 3 3h7c.38 0 .73-.09 1.05-.24"}),S.jsx("path",{d:"M22 9l-4 4V7l4-4v6z"})]})})]})]})]},L.id)})}),u&&N.length>0&&S.jsx("div",{className:"flex gap-2 mt-2 overflow-x-auto pb-2",children:N.map(L=>S.jsxs("div",{className:"relative h-20 w-32 flex-shrink-0 bg-gray-800 rounded-lg overflow-hidden shadow-md cursor-pointer",onClick:()=>f(L.id),id:`thumbnail-${L.id}`,children:[V(L),S.jsx("div",{className:"absolute bottom-1 left-1 right-1",children:S.jsx("div",{className:"text-xs text-white bg-gray-900/90 px-1 py-0.5 rounded truncate text-center",children:L.name})}),L.id===i&&S.jsx("div",{className:"absolute inset-0 border border-[#93C5FD] rounded-lg"})]},L.id))})]})},N0e=({isMuted:r,isVideoOn:i,isScreenSharing:a,isPinned:l,onToggleMute:u,onToggleVideo:f,onToggleScreenShare:_,onTogglePin:v,onLeaveCall:w})=>S.jsx("div",{className:"bg-gray-900 border-t border-gray-800 py-4 px-6 flex items-center justify-center animate-slide-up shadow-sm",style:{animationDelay:"0.3s",opacity:0},children:S.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[S.jsx(oc,{children:S.jsxs(el,{children:[S.jsx(tl,{asChild:!0,children:S.jsx(sn,{variant:"ghost",size:"icon",className:`rounded-full p-3 ${r?"bg-red-500 text-white hover:bg-red-600":"bg-gray-800 text-[#93C5FD] hover:bg-gray-700"}`,onClick:u,children:r?S.jsx(cH,{size:24}):S.jsx(lH,{size:24})})}),S.jsx(sc,{children:S.jsx("p",{children:r?"Unmute":"Mute"})})]})}),S.jsx(oc,{children:S.jsxs(el,{children:[S.jsx(tl,{asChild:!0,children:S.jsx(sn,{variant:"ghost",size:"icon",className:`rounded-full p-3 ${i?"bg-gray-800 text-[#93C5FD] hover:bg-gray-700":"bg-red-500 text-white hover:bg-red-600"}`,onClick:f,children:i?S.jsx(YN,{size:24}):S.jsx(dH,{size:24})})}),S.jsx(sc,{children:S.jsx("p",{children:i?"Turn off camera":"Turn on camera"})})]})}),S.jsx(oc,{children:S.jsxs(el,{children:[S.jsx(tl,{asChild:!0,children:S.jsx(sn,{variant:"ghost",size:"icon",className:`rounded-full p-3 ${a?"bg-[#3B82F6] text-white hover:bg-[#2563EB]":"bg-gray-800 text-[#93C5FD] hover:bg-gray-700"}`,onClick:_,children:S.jsx(ohe,{size:24})})}),S.jsx(sc,{children:S.jsx("p",{children:a?"Stop screen sharing":"Share screen"})})]})}),S.jsx(oc,{children:S.jsxs(el,{children:[S.jsx(tl,{asChild:!0,children:S.jsx(sn,{variant:"ghost",size:"icon",className:`rounded-full p-3 ${l?"bg-[#3B82F6] text-white hover:bg-[#2563EB]":"bg-gray-800 text-[#93C5FD] hover:bg-gray-700"}`,onClick:v,children:S.jsx(KN,{size:24})})}),S.jsx(sc,{children:S.jsx("p",{children:l?"Unpin":"Pin your video"})})]})}),S.jsx(oc,{children:S.jsxs(el,{children:[S.jsx(tl,{asChild:!0,children:S.jsx(sn,{variant:"ghost",size:"icon",className:"rounded-full p-3 bg-gray-800 text-[#93C5FD] hover:bg-gray-700",children:S.jsx(ahe,{size:24})})}),S.jsx(sc,{children:S.jsx("p",{children:"Participants 'Soon'"})})]})}),S.jsx(oc,{children:S.jsxs(el,{children:[S.jsx(tl,{asChild:!0,children:S.jsx(sn,{variant:"ghost",size:"icon",className:"rounded-full p-3 bg-gray-800 text-[#93C5FD] hover:bg-gray-700",children:S.jsx(nhe,{size:24})})}),S.jsx(sc,{children:S.jsx("p",{children:"Chat 'Soon'"})})]})}),S.jsx(oc,{children:S.jsxs(el,{children:[S.jsx(tl,{asChild:!0,children:S.jsx(sn,{variant:"ghost",size:"icon",className:"rounded-full p-3 bg-gray-800 text-[#93C5FD] hover:bg-gray-700",children:S.jsx(Zue,{size:24})})}),S.jsx(sc,{children:S.jsx("p",{children:"More options 'Soon'"})})]})}),S.jsx("div",{className:"h-10 border-l border-gray-700 mx-2"}),S.jsx(oc,{children:S.jsxs(el,{children:[S.jsx(tl,{asChild:!0,children:S.jsx(sn,{variant:"ghost",size:"icon",className:"rounded-full p-3 bg-red-500 text-white hover:bg-red-600",onClick:w,children:S.jsx(rhe,{size:24,className:"rotate-[135deg]"})})}),S.jsx(sc,{children:S.jsx("p",{children:"Leave call"})})]})})]})}),O0e=({participants:r,activeSpeakerId:i,pinnedParticipantId:a,onTogglePin:l})=>{const u=La.baseUrl;return S.jsxs("div",{className:"w-72 bg-gray-900 shadow-lg border-l border-gray-800 hidden lg:block overflow-hidden animate-slide-up",style:{animationDelay:"0.4s",opacity:0},children:[S.jsx("div",{className:"px-4 py-3 border-b border-gray-800",children:S.jsxs("h3",{className:"text-[#93C5FD] font-medium",children:["Participants (",r.length,")"]})}),S.jsx("div",{className:"px-2 py-2 overflow-y-auto h-full max-h-[calc(100vh-10rem)]",children:r.map((f,_)=>{const v=String(f.id),w=i?String(i):null,C=v===w,N=v===a,D=.5+_*.1;return S.jsxs("div",{className:`flex items-center gap-3 p-2 rounded-md mb-1 transition-colors ${C?"bg-blue-900/30":"hover:bg-gray-800"} ${N?"ring-1 ring-[#93C5FD]":""}`,style:{animation:`slide-up 0.3s ease-out ${D}s forwards`,opacity:0},children:[S.jsxs("div",{className:"relative",children:[f.isVideoOn?S.jsx("div",{className:"h-10 w-10 rounded-full overflow-hidden bg-gray-800",children:S.jsx("div",{className:"h-full w-full flex items-center justify-center bg-blue-600 text-white font-semibold",children:S.jsx("img",{src:u+f.imageURL,alt:"",className:"h-10 w-10 rounded-full object-cover"})})}):S.jsx("div",{className:"h-10 w-10 rounded-full bg-blue-600 flex items-center justify-center text-white font-semibold",children:S.jsx("img",{src:u+f.imageURL,alt:"",className:"h-10 w-10 rounded-full object-cover"})}),C&&S.jsxs(S.Fragment,{children:[S.jsx("span",{className:"absolute inset-0 rounded-full animate-pulse-ring border-2 border-[#93C5FD]"}),S.jsx("span",{className:"absolute bottom-0 right-0 h-3 w-3 rounded-full bg-green-500 border-2 border-gray-900"})]})]}),S.jsxs("div",{className:"flex-1 min-w-0",children:[S.jsxs("div",{className:"flex items-center",children:[S.jsxs("span",{className:"text-[#EFF6FF] text-sm font-medium truncate",children:[f.name," ",f.isSelf&&"(You)"]}),f.isHost&&S.jsx(Jue,{size:14,className:"ml-1 text-[#93C5FD]"})]}),S.jsx("div",{className:"text-[#93C5FD] text-opacity-70 text-xs",children:C?"Speaking":"Not speaking"})]}),S.jsxs("div",{className:"flex items-center gap-1",children:[f.isMuted?S.jsx("div",{className:"p-1 rounded-full bg-gray-800 text-red-500",children:S.jsx(cH,{size:14})}):S.jsx("div",{className:"p-1 rounded-full bg-gray-800 text-green-500",children:S.jsx(lH,{size:14})}),f.isVideoOn?S.jsx("div",{className:"p-1 rounded-full bg-gray-800 text-green-500",children:S.jsx(YN,{size:14})}):S.jsx("div",{className:"p-1 rounded-full bg-gray-800 text-red-500",children:S.jsx(dH,{size:14})}),S.jsx("button",{onClick:()=>l(f.id),className:"p-1 rounded-full hover:bg-gray-700",children:N?S.jsx(ihe,{size:14,className:"text-[#93C5FD]"}):S.jsx(KN,{size:14,className:"text-gray-400"})})]})]},f.id)})})]})},P0e=({callTitle:r,participantCount:i,duration:a})=>S.jsxs("div",{className:"bg-gray-900 border-b border-gray-800 py-3 px-6 flex items-center animate-slide-down shadow-md",children:[S.jsxs("div",{className:"flex items-center",children:[S.jsx("h1",{className:"text-[#93C5FD] text-lg font-medium",children:r}),S.jsx("div",{className:"h-6 border-l border-gray-700 mx-4"}),S.jsxs("div",{className:"bg-gray-800 rounded-full px-3 py-1 text-[#93C5FD] text-sm",children:[i," ",i===1?"participant":"participants"]})]}),S.jsx("div",{className:"ml-auto flex items-center",children:S.jsxs("div",{className:"bg-gray-800 rounded-full px-3 py-1 flex items-center gap-1 text-[#93C5FD] text-sm",children:[S.jsx(Que,{size:14,strokeWidth:2.5,className:"text-[#93C5FD]"}),S.jsx("span",{children:a})]})})]});var Z7={exports:{}};(function(r,i){(function(a,l){r.exports=l()})(Wv,function(){function a(e,t){return t.forEach(function(n){n&&typeof n!="string"&&!Array.isArray(n)&&Object.keys(n).forEach(function(o){if(o!=="default"&&!(o in e)){var s=Object.getOwnPropertyDescriptor(n,o);Object.defineProperty(e,o,s.get?s:{enumerable:!0,get:function(){return n[o]}})}})}),Object.freeze(e)}var l=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof Wv<"u"?Wv:typeof self<"u"?self:{};function u(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var f=function(e){try{return!!e()}catch{return!0}},_=!f(function(){var e=(function(){}).bind();return typeof e!="function"||e.hasOwnProperty("prototype")}),v=_,w=Function.prototype,C=w.call,N=v&&w.bind.bind(C,C),D=v?N:function(e){return function(){return C.apply(e,arguments)}},O=D({}.isPrototypeOf),G=function(e){return e&&e.Math===Math&&e},F=G(typeof globalThis=="object"&&globalThis)||G(typeof window=="object"&&window)||G(typeof self=="object"&&self)||G(typeof l=="object"&&l)||G(typeof l=="object"&&l)||function(){return this}()||Function("return this")(),V=_,L=Function.prototype,B=L.apply,W=L.call,z=typeof Reflect=="object"&&Reflect.apply||(V?W.bind(B):function(){return W.apply(B,arguments)}),$=D,te=$({}.toString),ie=$("".slice),ce=function(e){return ie(te(e),8,-1)},pe=ce,Pe=D,_e=function(e){if(pe(e)==="Function")return Pe(e)},ge=typeof document=="object"&&document.all,fe=ge===void 0&&ge!==void 0?function(e){return typeof e=="function"||e===ge}:function(e){return typeof e=="function"},xe={},be=!f(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!==7}),ft=_,je=Function.prototype.call,Ge=ft?je.bind(je):function(){return je.apply(je,arguments)},le={},Le={}.propertyIsEnumerable,ot=Object.getOwnPropertyDescriptor,Xe=ot&&!Le.call({1:2},1);le.f=Xe?function(e){var t=ot(this,e);return!!t&&t.enumerable}:Le;var st,ze,ht=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},dt=f,at=ce,Fe=Object,Ke=D("".split),et=dt(function(){return!Fe("z").propertyIsEnumerable(0)})?function(e){return at(e)==="String"?Ke(e,""):Fe(e)}:Fe,nt=function(e){return e==null},bt=nt,It=TypeError,an=function(e){if(bt(e))throw new It("Can't call method on "+e);return e},kr=et,fi=an,br=function(e){return kr(fi(e))},Ua=fe,xr=function(e){return typeof e=="object"?e!==null:Ua(e)},wn={},Js=wn,Hp=F,b0=fe,Bl=function(e){return b0(e)?e:void 0},Wr=function(e,t){return arguments.length<2?Bl(Js[e])||Bl(Hp[e]):Js[e]&&Js[e][t]||Hp[e]&&Hp[e][t]},Gp=F.navigator,gu=Gp&&Gp.userAgent,mi=gu?String(gu):"",zp=F,Qs=mi,Kp=zp.process,Yg=zp.Deno,Yp=Kp&&Kp.versions||Yg&&Yg.version,qp=Yp&&Yp.v8;qp&&(ze=(st=qp.split("."))[0]>0&&st[0]<4?1:+(st[0]+st[1])),!ze&&Qs&&(!(st=Qs.match(/Edge\/(\d+)/))||st[1]>=74)&&(st=Qs.match(/Chrome\/(\d+)/))&&(ze=+st[1]);var ja=ze,_u=ja,Zs=f,I0=F.String,Nt=!!Object.getOwnPropertySymbols&&!Zs(function(){var e=Symbol("symbol detection");return!I0(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&_u&&_u<41}),Ln=Nt&&!Symbol.sham&&typeof Symbol.iterator=="symbol",Mn=Wr,Mo=fe,Uo=O,Eu=Object,Wl=Ln?function(e){return typeof e=="symbol"}:function(e){var t=Mn("Symbol");return Mo(t)&&Uo(t.prototype,Eu(e))},nz=String,vu=function(e){try{return nz(e)}catch{return"Object"}},rz=fe,iz=vu,oz=TypeError,Hi=function(e){if(rz(e))return e;throw new oz(iz(e)+" is not a function")},sz=Hi,az=nt,qg=function(e,t){var n=e[t];return az(n)?void 0:sz(n)},DO=Ge,kO=fe,xO=xr,cz=TypeError,LO={exports:{}},MO=F,lz=Object.defineProperty,dz=F,uz=function(e,t){try{lz(MO,e,{value:t,configurable:!0,writable:!0})}catch{MO[e]=t}return t},UO="__core-js_shared__",jO=LO.exports=dz[UO]||uz(UO,{});(jO.versions||(jO.versions=[])).push({version:"3.41.0",mode:"pure",copyright:"© 2014-2025 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.41.0/LICENSE",source:"https://github.com/zloirock/core-js"});var A0=LO.exports,VO=A0,yu=function(e,t){return VO[e]||(VO[e]=t||{})},hz=an,pz=Object,ea=function(e){return pz(hz(e))},fz=ea,mz=D({}.hasOwnProperty),Lr=Object.hasOwn||function(e,t){return mz(fz(e),t)},gz=D,_z=0,Ez=Math.random(),vz=gz(1 .toString),N0=function(e){return"Symbol("+(e===void 0?"":e)+")_"+vz(++_z+Ez,36)},yz=yu,FO=Lr,Sz=N0,Tz=Nt,wz=Ln,Su=F.Symbol,O0=yz("wks"),Rz=wz?Su.for||Su:Su&&Su.withoutSetter||Sz,Fn=function(e){return FO(O0,e)||(O0[e]=Tz&&FO(Su,e)?Su[e]:Rz("Symbol."+e)),O0[e]},Cz=Ge,BO=xr,WO=Wl,bz=qg,Iz=function(e,t){var n,o;if(kO(n=e.toString)&&!xO(o=DO(n,e))||kO(n=e.valueOf)&&!xO(o=DO(n,e)))return o;throw new cz("Can't convert object to primitive value")},Az=TypeError,Nz=Fn("toPrimitive"),Oz=function(e,t){if(!BO(e)||WO(e))return e;var n,o=bz(e,Nz);if(o){if(n=Cz(o,e,t),!BO(n)||WO(n))return n;throw new Az("Can't convert object to primitive value")}return Iz(e)},Pz=Wl,P0=function(e){var t=Oz(e,"string");return Pz(t)?t:t+""},HO=xr,D0=F.document,Dz=HO(D0)&&HO(D0.createElement),k0=function(e){return Dz?D0.createElement(e):{}},kz=k0,GO=!be&&!f(function(){return Object.defineProperty(kz("div"),"a",{get:function(){return 7}}).a!==7}),xz=be,Lz=Ge,Mz=le,Uz=ht,jz=br,Vz=P0,Fz=Lr,Bz=GO,zO=Object.getOwnPropertyDescriptor;xe.f=xz?zO:function(e,t){if(e=jz(e),t=Vz(t),Bz)try{return zO(e,t)}catch{}if(Fz(e,t))return Uz(!Lz(Mz.f,e,t),e[t])};var Wz=f,Hz=fe,Gz=/#|\.prototype\./,Xp=function(e,t){var n=Kz[zz(e)];return n===qz||n!==Yz&&(Hz(t)?Wz(t):!!t)},zz=Xp.normalize=function(e){return String(e).replace(Gz,".").toLowerCase()},Kz=Xp.data={},Yz=Xp.NATIVE="N",qz=Xp.POLYFILL="P",KO=Xp,Xz=Hi,$z=_,Jz=_e(_e.bind),yc=function(e,t){return Xz(e),t===void 0?e:$z?Jz(e,t):function(){return e.apply(t,arguments)}},jo={},YO=be&&f(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!==42}),Qz=xr,Zz=String,eK=TypeError,Oi=function(e){if(Qz(e))return e;throw new eK(Zz(e)+" is not an object")},tK=be,nK=GO,rK=YO,Xg=Oi,qO=P0,iK=TypeError,x0=Object.defineProperty,oK=Object.getOwnPropertyDescriptor,L0="enumerable",M0="configurable",U0="writable";jo.f=tK?rK?function(e,t,n){if(Xg(e),t=qO(t),Xg(n),typeof e=="function"&&t==="prototype"&&"value"in n&&U0 in n&&!n[U0]){var o=oK(e,t);o&&o[U0]&&(e[t]=n.value,n={configurable:M0 in n?n[M0]:o[M0],enumerable:L0 in n?n[L0]:o[L0],writable:!1})}return x0(e,t,n)}:x0:function(e,t,n){if(Xg(e),t=qO(t),Xg(n),nK)try{return x0(e,t,n)}catch{}if("get"in n||"set"in n)throw new iK("Accessors not supported");return"value"in n&&(e[t]=n.value),e};var sK=jo,aK=ht,Hl=be?function(e,t,n){return sK.f(e,t,aK(1,n))}:function(e,t,n){return e[t]=n,e},$p=F,cK=z,lK=_e,dK=fe,uK=xe.f,hK=KO,Tu=wn,pK=yc,wu=Hl,XO=Lr,fK=function(e){var t=function(n,o,s){if(this instanceof t){switch(arguments.length){case 0:return new e;case 1:return new e(n);case 2:return new e(n,o)}return new e(n,o,s)}return cK(e,this,arguments)};return t.prototype=e.prototype,t},Mt=function(e,t){var n,o,s,c,d,h,p,m,g,E=e.target,y=e.global,T=e.stat,P=e.proto,I=y?$p:T?$p[E]:$p[E]&&$p[E].prototype,A=y?Tu:Tu[E]||wu(Tu,E,{})[E],M=A.prototype;for(c in t)o=!(n=hK(y?c:E+(T?".":"#")+c,e.forced))&&I&&XO(I,c),h=A[c],o&&(p=e.dontCallGetSet?(g=uK(I,c))&&g.value:I[c]),d=o&&p?p:t[c],(n||P||typeof h!=typeof d)&&(m=e.bind&&o?pK(d,$p):e.wrap&&o?fK(d):P&&dK(d)?lK(d):d,(e.sham||d&&d.sham||h&&h.sham)&&wu(m,"sham",!0),wu(A,c,m),P&&(XO(Tu,s=E+"Prototype")||wu(Tu,s,{}),wu(Tu[s],c,d),e.real&&M&&(n||!M[c])&&wu(M,c,d)))},mK=Math.ceil,gK=Math.floor,_K=Math.trunc||function(e){var t=+e;return(t>0?gK:mK)(t)},EK=_K,j0=function(e){var t=+e;return t!=t||t===0?0:EK(t)},vK=j0,yK=Math.max,SK=Math.min,V0=function(e,t){var n=vK(e);return n<0?yK(n+t,0):SK(n,t)},TK=j0,wK=Math.min,$O=function(e){var t=TK(e);return t>0?wK(t,9007199254740991):0},RK=$O,Sc=function(e){return RK(e.length)},CK=br,bK=V0,IK=Sc,JO=function(e){return function(t,n,o){var s=CK(t),c=IK(s);if(c===0)return!e&&-1;var d,h=bK(o,c);if(e&&n!=n){for(;c>h;)if((d=s[h++])!=d)return!0}else for(;c>h;h++)if((e||h in s)&&s[h]===n)return e||h||0;return!e&&-1}},F0={includes:JO(!0),indexOf:JO(!1)},AK=F0.includes;Mt({target:"Array",proto:!0,forced:f(function(){return!Array(1).includes()})},{includes:function(e){return AK(this,e,arguments.length>1?arguments[1]:void 0)}});var NK=F,OK=wn,Vo=function(e,t){var n=OK[e+"Prototype"],o=n&&n[t];if(o)return o;var s=NK[e],c=s&&s.prototype;return c&&c[t]},PK=Vo("Array","includes"),DK=xr,kK=ce,xK=Fn("match"),QO=function(e){var t;return DK(e)&&((t=e[xK])!==void 0?!!t:kK(e)==="RegExp")},LK=QO,MK=TypeError,ZO={};ZO[Fn("toStringTag")]="z";var B0=String(ZO)==="[object z]",UK=B0,jK=fe,$g=ce,VK=Fn("toStringTag"),FK=Object,BK=$g(function(){return arguments}())==="Arguments",Tc=UK?$g:function(e){var t,n,o;return e===void 0?"Undefined":e===null?"Null":typeof(n=function(s,c){try{return s[c]}catch{}}(t=FK(e),VK))=="string"?n:BK?$g(t):(o=$g(t))==="Object"&&jK(t.callee)?"Arguments":o},WK=Tc,HK=String,Gi=function(e){if(WK(e)==="Symbol")throw new TypeError("Cannot convert a Symbol value to a string");return HK(e)},GK=Fn("match"),zK=Mt,KK=function(e){if(LK(e))throw new MK("The method doesn't accept regular expressions");return e},YK=an,e1=Gi,qK=function(e){var t=/./;try{"/./"[e](t)}catch{try{return t[GK]=!1,"/./"[e](t)}catch{}}return!1},XK=D("".indexOf);zK({target:"String",proto:!0,forced:!qK("includes")},{includes:function(e){return!!~XK(e1(YK(this)),e1(KK(e)),arguments.length>1?arguments[1]:void 0)}});var $K=Vo("String","includes"),t1=O,JK=PK,QK=$K,W0=Array.prototype,H0=String.prototype,ZK=function(e){var t=e.includes;return e===W0||t1(W0,e)&&t===W0.includes?JK:typeof e=="string"||e===H0||t1(H0,e)&&t===H0.includes?QK:t},Ee=u(ZK),eY=Hi,tY=ea,nY=et,rY=Sc,n1=TypeError,r1="Reduce of empty array with no initial value",i1=function(e){return function(t,n,o,s){var c=tY(t),d=nY(c),h=rY(c);if(eY(n),h===0&&o<2)throw new n1(r1);var p=e?h-1:0,m=e?-1:1;if(o<2)for(;;){if(p in d){s=d[p],p+=m;break}if(p+=m,e?p<0:h<=p)throw new n1(r1)}for(;e?p>=0:h>p;p+=m)p in d&&(s=n(s,d[p],p,c));return s}},iY={left:i1(!1),right:i1(!0)},oY=f,Jg=function(e,t){var n=[][e];return!!n&&oY(function(){n.call(null,t||function(){return 1},1)})},Jp=F,sY=mi,aY=ce,Qg=function(e){return sY.slice(0,e.length)===e},G0=Qg("Bun/")?"BUN":Qg("Cloudflare-Workers")?"CLOUDFLARE":Qg("Deno/")?"DENO":Qg("Node.js/")?"NODE":Jp.Bun&&typeof Bun.version=="string"?"BUN":Jp.Deno&&typeof Deno.version=="object"?"DENO":aY(Jp.process)==="process"?"NODE":Jp.window&&Jp.document?"BROWSER":"REST",Zg=G0==="NODE",cY=iY.left;Mt({target:"Array",proto:!0,forced:!Zg&&ja>79&&ja<83||!Jg("reduce")},{reduce:function(e){var t=arguments.length;return cY(this,e,t,t>1?arguments[1]:void 0)}});var lY=Vo("Array","reduce"),dY=O,uY=lY,z0=Array.prototype,hY=function(e){var t=e.reduce;return e===z0||dY(z0,e)&&t===z0.reduce?uY:t},o1=hY,Fo=u(o1),pY=ce,Qp=Array.isArray||function(e){return pY(e)==="Array"},fY=Mt,mY=Qp,gY=D([].reverse),s1=[1,2];fY({target:"Array",proto:!0,forced:String(s1)===String(s1.reverse())},{reverse:function(){return mY(this)&&(this.length=this.length),gY(this)}});var _Y=Vo("Array","reverse"),EY=O,vY=_Y,K0=Array.prototype,yY=function(e){var t=e.reverse;return e===K0||EY(K0,e)&&t===K0.reverse?vY:t},a1=yY,c1=u(a1),SY=N0,l1=yu("keys"),e_=function(e){return l1[e]||(l1[e]=SY(e))},TY=!f(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}),wY=Lr,RY=fe,CY=ea,bY=TY,d1=e_("IE_PROTO"),Y0=Object,IY=Y0.prototype,q0=bY?Y0.getPrototypeOf:function(e){var t=CY(e);if(wY(t,d1))return t[d1];var n=t.constructor;return RY(n)&&t instanceof n?n.prototype:t instanceof Y0?IY:null},AY=D,NY=Hi,OY=xr,PY=function(e){return OY(e)||e===null},DY=String,kY=TypeError,xY=function(e,t,n){try{return AY(NY(Object.getOwnPropertyDescriptor(e,t)[n]))}catch{}},LY=xr,MY=an,UY=function(e){if(PY(e))return e;throw new kY("Can't set "+DY(e)+" as a prototype")},jY=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,n={};try{(e=xY(Object.prototype,"__proto__","set"))(n,[]),t=n instanceof Array}catch{}return function(o,s){return MY(o),UY(s),LY(o)&&(t?e(o,s):o.__proto__=s),o}}():void 0),t_={},n_={},X0=Lr,VY=br,FY=F0.indexOf,BY=n_,u1=D([].push),h1=function(e,t){var n,o=VY(e),s=0,c=[];for(n in o)!X0(BY,n)&&X0(o,n)&&u1(c,n);for(;t.length>s;)X0(o,n=t[s++])&&(~FY(c,n)||u1(c,n));return c},$0=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],WY=h1,HY=$0.concat("length","prototype");t_.f=Object.getOwnPropertyNames||function(e){return WY(e,HY)};var Zp={};Zp.f=Object.getOwnPropertySymbols;var GY=Wr,zY=t_,KY=Zp,YY=Oi,qY=D([].concat),XY=GY("Reflect","ownKeys")||function(e){var t=zY.f(YY(e)),n=KY.f;return n?qY(t,n(e)):t},p1=Lr,$Y=XY,JY=xe,QY=jo,J0={},ZY=h1,eq=$0,r_=Object.keys||function(e){return ZY(e,eq)},tq=be,nq=YO,rq=jo,iq=Oi,oq=br,sq=r_;J0.f=tq&&!nq?Object.defineProperties:function(e,t){iq(e);for(var n,o=oq(t),s=sq(t),c=s.length,d=0;c>d;)rq.f(e,n=s[d++],o[n]);return e};var i_,f1=Wr("document","documentElement"),aq=Oi,cq=J0,m1=$0,lq=n_,dq=f1,uq=k0,Q0="prototype",Z0="script",g1=e_("IE_PROTO"),eT=function(){},_1=function(e){return"<"+Z0+">"+e+"</"+Z0+">"},E1=function(e){e.write(_1("")),e.close();var t=e.parentWindow.Object;return e=null,t},o_=function(){try{i_=new ActiveXObject("htmlfile")}catch{}var e,t,n;o_=typeof document<"u"?document.domain&&i_?E1(i_):(t=uq("iframe"),n="java"+Z0+":",t.style.display="none",dq.appendChild(t),t.src=String(n),(e=t.contentWindow.document).open(),e.write(_1("document.F=Object")),e.close(),e.F):E1(i_);for(var o=m1.length;o--;)delete o_[Q0][m1[o]];return o_()};lq[g1]=!0;var ef=Object.create||function(e,t){var n;return e!==null?(eT[Q0]=aq(e),n=new eT,eT[Q0]=null,n[g1]=e):n=o_(),t===void 0?n:cq.f(n,t)},hq=xr,pq=Hl,v1=Error,fq=D("".replace),mq=String(new v1("zxcasd").stack),y1=/\n\s*at [^:]*:[^\n]*/,gq=y1.test(mq),_q=ht,Eq=!f(function(){var e=new Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",_q(1,7)),e.stack!==7)}),vq=Hl,yq=function(e,t){if(gq&&typeof e=="string"&&!v1.prepareStackTrace)for(;t--;)e=fq(e,y1,"");return e},Sq=Eq,S1=Error.captureStackTrace,Ru={},Tq=Ru,wq=Fn("iterator"),Rq=Array.prototype,T1=function(e){return e!==void 0&&(Tq.Array===e||Rq[wq]===e)},Cq=Tc,w1=qg,bq=nt,Iq=Ru,Aq=Fn("iterator"),s_=function(e){if(!bq(e))return w1(e,Aq)||w1(e,"@@iterator")||Iq[Cq(e)]},Nq=Ge,Oq=Hi,Pq=Oi,Dq=vu,kq=s_,xq=TypeError,tT=function(e,t){var n=arguments.length<2?kq(e):t;if(Oq(n))return Pq(Nq(n,e));throw new xq(Dq(e)+" is not iterable")},Lq=Ge,R1=Oi,Mq=qg,C1=function(e,t,n){var o,s;R1(e);try{if(!(o=Mq(e,"return"))){if(t==="throw")throw n;return n}o=Lq(o,e)}catch(c){s=!0,o=c}if(t==="throw")throw n;if(s)throw o;return R1(o),n},Uq=yc,jq=Ge,Vq=Oi,Fq=vu,Bq=T1,Wq=Sc,b1=O,Hq=tT,Gq=s_,I1=C1,zq=TypeError,a_=function(e,t){this.stopped=e,this.result=t},A1=a_.prototype,tf=function(e,t,n){var o,s,c,d,h,p,m,g=n&&n.that,E=!(!n||!n.AS_ENTRIES),y=!(!n||!n.IS_RECORD),T=!(!n||!n.IS_ITERATOR),P=!(!n||!n.INTERRUPTED),I=Uq(t,g),A=function(U){return o&&I1(o,"normal",U),new a_(!0,U)},M=function(U){return E?(Vq(U),P?I(U[0],U[1],A):I(U[0],U[1])):P?I(U,A):I(U)};if(y)o=e.iterator;else if(T)o=e;else{if(!(s=Gq(e)))throw new zq(Fq(e)+" is not iterable");if(Bq(s)){for(c=0,d=Wq(e);d>c;c++)if((h=M(e[c]))&&b1(A1,h))return h;return new a_(!1)}o=Hq(e,s)}for(p=y?e.next:o.next;!(m=jq(p,o)).done;){try{h=M(m.value)}catch(U){I1(o,"throw",U)}if(typeof h=="object"&&h&&b1(A1,h))return h}return new a_(!1)},Kq=Gi,Yq=Mt,qq=O,Xq=q0,c_=jY,$q=function(e,t,n){for(var o=$Y(t),s=QY.f,c=JY.f,d=0;d<o.length;d++){var h=o[d];p1(e,h)||n&&p1(n,h)||s(e,h,c(t,h))}},N1=ef,nT=Hl,rT=ht,Jq=function(e,t){hq(t)&&"cause"in t&&pq(e,"cause",t.cause)},Qq=function(e,t,n,o){Sq&&(S1?S1(e,t):vq(e,"stack",yq(n,o)))},Zq=tf,eX=function(e,t){return e===void 0?arguments.length<2?"":t:Kq(e)},tX=Fn("toStringTag"),l_=Error,nX=[].push,Cu=function(e,t){var n,o=qq(iT,this);c_?n=c_(new l_,o?Xq(this):iT):(n=o?this:N1(iT),nT(n,tX,"Error")),t!==void 0&&nT(n,"message",eX(t)),Qq(n,Cu,n.stack,1),arguments.length>2&&Jq(n,arguments[2]);var s=[];return Zq(e,nX,{that:s}),nT(n,"errors",s),n};c_?c_(Cu,l_):$q(Cu,l_,{name:!0});var iT=Cu.prototype=N1(l_.prototype,{constructor:rT(1,Cu),message:rT(1,""),name:rT(1,"AggregateError")});Yq({global:!0,constructor:!0,arity:2},{AggregateError:Cu});var d_,nf,u_,rX=fe,O1=F.WeakMap,iX=rX(O1)&&/native code/.test(String(O1)),P1=F,oX=xr,sX=Hl,oT=Lr,sT=A0,aX=e_,cX=n_,D1="Object already initialized",aT=P1.TypeError,lX=P1.WeakMap;if(iX||sT.state){var ta=sT.state||(sT.state=new lX);ta.get=ta.get,ta.has=ta.has,ta.set=ta.set,d_=function(e,t){if(ta.has(e))throw new aT(D1);return t.facade=e,ta.set(e,t),t},nf=function(e){return ta.get(e)||{}},u_=function(e){return ta.has(e)}}else{var bu=aX("state");cX[bu]=!0,d_=function(e,t){if(oT(e,bu))throw new aT(D1);return t.facade=e,sX(e,bu,t),t},nf=function(e){return oT(e,bu)?e[bu]:{}},u_=function(e){return oT(e,bu)}}var Gl,k1,x1,zl={set:d_,get:nf,has:u_,enforce:function(e){return u_(e)?nf(e):d_(e,{})},getterFor:function(e){return function(t){var n;if(!oX(t)||(n=nf(t)).type!==e)throw new aT("Incompatible receiver, "+e+" required");return n}}},cT=be,dX=Lr,L1=Function.prototype,uX=cT&&Object.getOwnPropertyDescriptor,lT=dX(L1,"name"),M1={EXISTS:lT,PROPER:lT&&(function(){}).name==="something",CONFIGURABLE:lT&&(!cT||cT&&uX(L1,"name").configurable)},hX=Hl,wc=function(e,t,n,o){return o&&o.enumerable?e[t]=n:hX(e,t,n),e},pX=f,fX=fe,mX=xr,gX=ef,U1=q0,_X=wc,dT=Fn("iterator"),j1=!1;[].keys&&("next"in(x1=[].keys())?(k1=U1(U1(x1)))!==Object.prototype&&(Gl=k1):j1=!0);var EX=!mX(Gl)||pX(function(){var e={};return Gl[dT].call(e)!==e});fX((Gl=EX?{}:gX(Gl))[dT])||_X(Gl,dT,function(){return this});var V1={IteratorPrototype:Gl,BUGGY_SAFARI_ITERATORS:j1},vX=Tc,yX=B0?{}.toString:function(){return"[object "+vX(this)+"]"},SX=B0,TX=jo.f,wX=Hl,RX=Lr,CX=yX,F1=Fn("toStringTag"),Va=function(e,t,n,o){var s=n?e:e&&e.prototype;s&&(RX(s,F1)||TX(s,F1,{configurable:!0,value:t}),o&&!SX&&wX(s,"toString",CX))},bX=V1.IteratorPrototype,IX=ef,AX=ht,NX=Va,OX=Ru,PX=function(){return this},uT=function(e,t,n,o){var s=t+" Iterator";return e.prototype=IX(bX,{next:AX(+!o,n)}),NX(e,s,!1,!0),OX[s]=PX,e},DX=Mt,kX=Ge,xX=M1,LX=uT,MX=q0,UX=Va,B1=wc,W1=Ru,jX=V1,VX=xX.PROPER,h_=jX.BUGGY_SAFARI_ITERATORS,hT=Fn("iterator"),H1="keys",p_="values",G1="entries",FX=function(){return this},z1=function(e,t,n,o,s,c,d){LX(n,t,o);var h,p,m,g=function(M){if(M===s&&I)return I;if(!h_&&M&&M in T)return T[M];switch(M){case H1:case p_:case G1:return function(){return new n(this,M)}}return function(){return new n(this)}},E=t+" Iterator",y=!1,T=e.prototype,P=T[hT]||T["@@iterator"]||s&&T[s],I=!h_&&P||g(s),A=t==="Array"&&T.entries||P;if(A&&(h=MX(A.call(new e)))!==Object.prototype&&h.next&&(UX(h,E,!0,!0),W1[E]=FX),VX&&s===p_&&P&&P.name!==p_&&(y=!0,I=function(){return kX(P,this)}),s)if(p={values:g(p_),keys:c?I:g(H1),entries:g(G1)},d)for(m in p)(h_||y||!(m in T))&&B1(T,m,p[m]);else DX({target:t,proto:!0,forced:h_||y},p);return d&&T[hT]!==I&&B1(T,hT,I,{name:s}),W1[t]=I,p},f_=function(e,t){return{value:e,done:t}},BX=br,K1=Ru,Y1=zl;jo.f;var WX=z1,m_=f_,q1="Array Iterator",HX=Y1.set,GX=Y1.getterFor(q1);WX(Array,"Array",function(e,t){HX(this,{type:q1,target:BX(e),index:0,kind:t})},function(){var e=GX(this),t=e.target,n=e.index++;if(!t||n>=t.length)return e.target=null,m_(void 0,!0);switch(e.kind){case"keys":return m_(n,!1);case"values":return m_(t[n],!1)}return m_([n,t[n]],!1)},"values"),K1.Arguments=K1.Array;var zX=jo,g_=function(e,t,n){return zX.f(e,t,n)},KX=Wr,YX=g_,qX=be,X1=Fn("species"),XX=O,$X=TypeError,pT=function(e,t){if(XX(t,e))return e;throw new $X("Incorrect invocation")},JX=fe,fT=A0,QX=D(Function.toString);JX(fT.inspectSource)||(fT.inspectSource=function(e){return QX(e)});var $1=fT.inspectSource,ZX=D,e$=f,J1=fe,t$=Tc,n$=$1,Q1=function(){},Z1=Wr("Reflect","construct"),mT=/^\s*(?:class|function)\b/,r$=ZX(mT.exec),i$=!mT.test(Q1),rf=function(e){if(!J1(e))return!1;try{return Z1(Q1,[],e),!0}catch{return!1}},eP=function(e){if(!J1(e))return!1;switch(t$(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return i$||!!r$(mT,n$(e))}catch{return!0}};eP.sham=!0;var of,Iu,tP,gT,__=!Z1||e$(function(){var e;return rf(rf.call)||!rf(Object)||!rf(function(){e=!0})||e})?eP:rf,o$=__,s$=vu,a$=TypeError,nP=Oi,c$=function(e){if(o$(e))return e;throw new a$(s$(e)+" is not a constructor")},l$=nt,d$=Fn("species"),_T=function(e,t){var n,o=nP(e).constructor;return o===void 0||l$(n=nP(o)[d$])?t:c$(n)},Rc=D([].slice),u$=TypeError,Kl=function(e,t){if(e<t)throw new u$("Not enough arguments");return e},rP=/(?:ipad|iphone|ipod).*applewebkit/i.test(mi),uo=F,h$=z,p$=yc,iP=fe,f$=Lr,oP=f,sP=f1,m$=Rc,aP=k0,g$=Kl,_$=rP,E$=Zg,ET=uo.setImmediate,vT=uo.clearImmediate,v$=uo.process,yT=uo.Dispatch,y$=uo.Function,cP=uo.MessageChannel,S$=uo.String,ST=0,sf={},lP="onreadystatechange";oP(function(){of=uo.location});var TT=function(e){if(f$(sf,e)){var t=sf[e];delete sf[e],t()}},wT=function(e){return function(){TT(e)}},dP=function(e){TT(e.data)},uP=function(e){uo.postMessage(S$(e),of.protocol+"//"+of.host)};ET&&vT||(ET=function(e){g$(arguments.length,1);var t=iP(e)?e:y$(e),n=m$(arguments,1);return sf[++ST]=function(){h$(t,void 0,n)},Iu(ST),ST},vT=function(e){delete sf[e]},E$?Iu=function(e){v$.nextTick(wT(e))}:yT&&yT.now?Iu=function(e){yT.now(wT(e))}:cP&&!_$?(gT=(tP=new cP).port2,tP.port1.onmessage=dP,Iu=p$(gT.postMessage,gT)):uo.addEventListener&&iP(uo.postMessage)&&!uo.importScripts&&of&&of.protocol!=="file:"&&!oP(uP)?(Iu=uP,uo.addEventListener("message",dP,!1)):Iu=lP in aP("script")?function(e){sP.appendChild(aP("script"))[lP]=function(){sP.removeChild(this),TT(e)}}:function(e){setTimeout(wT(e),0)});var E_={set:ET,clear:vT},hP=F,T$=be,w$=Object.getOwnPropertyDescriptor,pP=function(e){if(!T$)return hP[e];var t=w$(hP,e);return t&&t.value},fP=function(){this.head=null,this.tail=null};fP.prototype={add:function(e){var t={item:e,next:null},n=this.tail;n?n.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return(this.head=e.next)===null&&(this.tail=null),e.item}};var Au,RT,CT,bT,mP,gP=fP,R$=/ipad|iphone|ipod/i.test(mi)&&typeof Pebble<"u",C$=/web0s(?!.*chrome)/i.test(mi),Nu=F,b$=pP,_P=yc,IT=E_.set,I$=gP,A$=rP,N$=R$,O$=C$,AT=Zg,EP=Nu.MutationObserver||Nu.WebKitMutationObserver,vP=Nu.document,yP=Nu.process,v_=Nu.Promise,NT=b$("queueMicrotask");if(!NT){var y_=new I$,S_=function(){var e,t;for(AT&&(e=yP.domain)&&e.exit();t=y_.get();)try{t()}catch(n){throw y_.head&&Au(),n}e&&e.enter()};A$||AT||O$||!EP||!vP?!N$&&v_&&v_.resolve?((bT=v_.resolve(void 0)).constructor=v_,mP=_P(bT.then,bT),Au=function(){mP(S_)}):AT?Au=function(){yP.nextTick(S_)}:(IT=_P(IT,Nu),Au=function(){IT(S_)}):(RT=!0,CT=vP.createTextNode(""),new EP(S_).observe(CT,{characterData:!0}),Au=function(){CT.data=RT=!RT}),NT=function(e){y_.head||Au(),y_.add(e)}}var SP=NT,Ou=function(e){try{return{error:!1,value:e()}}catch(t){return{error:!0,value:t}}},Yl=F.Promise,P$=F,af=Yl,D$=fe,k$=KO,x$=$1,L$=Fn,TP=G0,OT=ja,wP=af&&af.prototype,M$=L$("species"),RP=!1,CP=D$(P$.PromiseRejectionEvent),U$=k$("Promise",function(){var e=x$(af),t=e!==String(af);if(!t&&OT===66||!wP.catch||!wP.finally)return!0;if(!OT||OT<51||!/native code/.test(e)){var n=new af(function(s){s(1)}),o=function(s){s(function(){},function(){})};if((n.constructor={})[M$]=o,!(RP=n.then(function(){})instanceof o))return!0}return!(t||TP!=="BROWSER"&&TP!=="DENO"||CP)}),cf={CONSTRUCTOR:U$,REJECTION_EVENT:CP,SUBCLASSING:RP},na={},bP=Hi,j$=TypeError,V$=function(e){var t,n;this.promise=new e(function(o,s){if(t!==void 0||n!==void 0)throw new j$("Bad Promise constructor");t=o,n=s}),this.resolve=bP(t),this.reject=bP(n)};na.f=function(e){return new V$(e)};var PT,IP,F$=Mt,T_=Zg,Cc=F,lf=Ge,B$=wc,W$=Va,H$=function(e){var t=KX(e);qX&&t&&!t[X1]&&YX(t,X1,{configurable:!0,get:function(){return this}})},G$=Hi,DT=fe,z$=xr,K$=pT,Y$=_T,AP=E_.set,kT=SP,q$=function(e,t){try{arguments.length===1?console.error(e):console.error(e,t)}catch{}},X$=Ou,$$=gP,NP=zl,xT=Yl,OP=cf,PP=na,w_="Promise",DP=OP.CONSTRUCTOR,J$=OP.REJECTION_EVENT,LT=NP.getterFor(w_),Q$=NP.set,Z$=xT&&xT.prototype,df=xT,MT=Z$,kP=Cc.TypeError,UT=Cc.document,jT=Cc.process,VT=PP.f,eJ=VT,tJ=!!(UT&&UT.createEvent&&Cc.dispatchEvent),xP="unhandledrejection",LP=function(e){var t;return!(!z$(e)||!DT(t=e.then))&&t},MP=function(e,t){var n,o,s,c=t.value,d=t.state===1,h=d?e.ok:e.fail,p=e.resolve,m=e.reject,g=e.domain;try{h?(d||(t.rejection===2&&rJ(t),t.rejection=1),h===!0?n=c:(g&&g.enter(),n=h(c),g&&(g.exit(),s=!0)),n===e.promise?m(new kP("Promise-chain cycle")):(o=LP(n))?lf(o,n,p,m):p(n)):m(c)}catch(E){g&&!s&&g.exit(),m(E)}},UP=function(e,t){e.notified||(e.notified=!0,kT(function(){for(var n,o=e.reactions;n=o.get();)MP(n,e);e.notified=!1,t&&!e.rejection&&nJ(e)}))},jP=function(e,t,n){var o,s;tJ?((o=UT.createEvent("Event")).promise=t,o.reason=n,o.initEvent(e,!1,!0),Cc.dispatchEvent(o)):o={promise:t,reason:n},!J$&&(s=Cc["on"+e])?s(o):e===xP&&q$("Unhandled promise rejection",n)},nJ=function(e){lf(AP,Cc,function(){var t,n=e.facade,o=e.value;if(VP(e)&&(t=X$(function(){T_?jT.emit("unhandledRejection",o,n):jP(xP,n,o)}),e.rejection=T_||VP(e)?2:1,t.error))throw t.value})},VP=function(e){return e.rejection!==1&&!e.parent},rJ=function(e){lf(AP,Cc,function(){var t=e.facade;T_?jT.emit("rejectionHandled",t):jP("rejectionhandled",t,e.value)})},Pu=function(e,t,n){return function(o){e(t,o,n)}},Du=function(e,t,n){e.done||(e.done=!0,n&&(e=n),e.value=t,e.state=2,UP(e,!0))},FT=function(e,t,n){if(!e.done){e.done=!0,n&&(e=n);try{if(e.facade===t)throw new kP("Promise can't be resolved itself");var o=LP(t);o?kT(function(){var s={done:!1};try{lf(o,t,Pu(FT,s,e),Pu(Du,s,e))}catch(c){Du(s,c,e)}}):(e.value=t,e.state=1,UP(e,!1))}catch(s){Du({done:!1},s,e)}}};DP&&(MT=(df=function(e){K$(this,MT),G$(e),lf(PT,this);var t=LT(this);try{e(Pu(FT,t),Pu(Du,t))}catch(n){Du(t,n)}}).prototype,(PT=function(e){Q$(this,{type:w_,done:!1,notified:!1,parent:!1,reactions:new $$,rejection:!1,state:0,value:null})}).prototype=B$(MT,"then",function(e,t){var n=LT(this),o=VT(Y$(this,df));return n.parent=!0,o.ok=!DT(e)||e,o.fail=DT(t)&&t,o.domain=T_?jT.domain:void 0,n.state===0?n.reactions.add(o):kT(function(){MP(o,n)}),o.promise}),IP=function(){var e=new PT,t=LT(e);this.promise=e,this.resolve=Pu(FT,t),this.reject=Pu(Du,t)},PP.f=VT=function(e){return e===df||e===void 0?new IP(e):eJ(e)}),F$({global:!0,constructor:!0,wrap:!0,forced:DP},{Promise:df}),W$(df,w_,!1,!0),H$(w_);var FP=Fn("iterator"),BP=!1;try{var iJ=0,WP={next:function(){return{done:!!iJ++}},return:function(){BP=!0}};WP[FP]=function(){return this},Array.from(WP,function(){throw 2})}catch{}var oJ=Yl,sJ=function(e,t){try{if(!t&&!BP)return!1}catch{return!1}var n=!1;try{var o={};o[FP]=function(){return{next:function(){return{done:n=!0}}}},e(o)}catch{}return n},R_=cf.CONSTRUCTOR||!sJ(function(e){oJ.all(e).then(void 0,function(){})}),aJ=Ge,cJ=Hi,lJ=na,dJ=Ou,uJ=tf;Mt({target:"Promise",stat:!0,forced:R_},{all:function(e){var t=this,n=lJ.f(t),o=n.resolve,s=n.reject,c=dJ(function(){var d=cJ(t.resolve),h=[],p=0,m=1;uJ(e,function(g){var E=p++,y=!1;m++,aJ(d,t,g).then(function(T){y||(y=!0,h[E]=T,--m||o(h))},s)}),--m||o(h)});return c.error&&s(c.value),n.promise}});var hJ=Mt,pJ=cf.CONSTRUCTOR;Yl&&Yl.prototype,hJ({target:"Promise",proto:!0,forced:pJ,real:!0},{catch:function(e){return this.then(void 0,e)}});var fJ=Ge,mJ=Hi,gJ=na,_J=Ou,EJ=tf;Mt({target:"Promise",stat:!0,forced:R_},{race:function(e){var t=this,n=gJ.f(t),o=n.reject,s=_J(function(){var c=mJ(t.resolve);EJ(e,function(d){fJ(c,t,d).then(n.resolve,o)})});return s.error&&o(s.value),n.promise}});var vJ=na;Mt({target:"Promise",stat:!0,forced:cf.CONSTRUCTOR},{reject:function(e){var t=vJ.f(this);return(0,t.reject)(e),t.promise}});var yJ=Oi,SJ=xr,TJ=na,HP=function(e,t){if(yJ(e),SJ(t)&&t.constructor===e)return t;var n=TJ.f(e);return(0,n.resolve)(t),n.promise},wJ=Mt,RJ=Yl,CJ=cf.CONSTRUCTOR,bJ=HP,IJ=Wr("Promise"),AJ=!CJ;wJ({target:"Promise",stat:!0,forced:!0},{resolve:function(e){return bJ(AJ&&this===IJ?RJ:this,e)}});var NJ=Ge,OJ=Hi,PJ=na,DJ=Ou,kJ=tf;Mt({target:"Promise",stat:!0,forced:R_},{allSettled:function(e){var t=this,n=PJ.f(t),o=n.resolve,s=n.reject,c=DJ(function(){var d=OJ(t.resolve),h=[],p=0,m=1;kJ(e,function(g){var E=p++,y=!1;m++,NJ(d,t,g).then(function(T){y||(y=!0,h[E]={status:"fulfilled",value:T},--m||o(h))},function(T){y||(y=!0,h[E]={status:"rejected",reason:T},--m||o(h))})}),--m||o(h)});return c.error&&s(c.value),n.promise}});var xJ=Ge,LJ=Hi,MJ=Wr,UJ=na,jJ=Ou,VJ=tf,GP="No one promise resolved";Mt({target:"Promise",stat:!0,forced:R_},{any:function(e){var t=this,n=MJ("AggregateError"),o=UJ.f(t),s=o.resolve,c=o.reject,d=jJ(function(){var h=LJ(t.resolve),p=[],m=0,g=1,E=!1;VJ(e,function(y){var T=m++,P=!1;g++,xJ(h,t,y).then(function(I){P||E||(E=!0,s(I))},function(I){P||E||(P=!0,p[T]=I,--g||c(new n(p,GP)))})}),--g||c(new n(p,GP))});return d.error&&c(d.value),o.promise}});var FJ=Mt,BJ=z,WJ=Rc,HJ=na,GJ=Hi,zP=Ou,BT=F.Promise,KP=!1;FJ({target:"Promise",stat:!0,forced:!BT||!BT.try||zP(function(){BT.try(function(e){KP=e===8},8)}).error||!KP},{try:function(e){var t=arguments.length>1?WJ(arguments,1):[],n=HJ.f(this),o=zP(function(){return BJ(GJ(e),void 0,t)});return(o.error?n.reject:n.resolve)(o.value),n.promise}});var zJ=na;Mt({target:"Promise",stat:!0},{withResolvers:function(){var e=zJ.f(this);return{promise:e.promise,resolve:e.resolve,reject:e.reject}}});var KJ=Mt,WT=Yl,YJ=f,qJ=Wr,XJ=fe,$J=_T,YP=HP,JJ=WT&&WT.prototype;KJ({target:"Promise",proto:!0,real:!0,forced:!!WT&&YJ(function(){JJ.finally.call({then:function(){}},function(){})})},{finally:function(e){var t=$J(this,qJ("Promise")),n=XJ(e);return this.then(n?function(o){return YP(t,e()).then(function(){return o})}:e,n?function(o){return YP(t,e()).then(function(){throw o})}:e)}});var HT=D,QJ=j0,ZJ=Gi,eQ=an,tQ=HT("".charAt),qP=HT("".charCodeAt),nQ=HT("".slice),XP=function(e){return function(t,n){var o,s,c=ZJ(eQ(t)),d=QJ(n),h=c.length;return d<0||d>=h?e?"":void 0:(o=qP(c,d))<55296||o>56319||d+1===h||(s=qP(c,d+1))<56320||s>57343?e?tQ(c,d):o:e?nQ(c,d,d+2):s-56320+(o-55296<<10)+65536}},GT={codeAt:XP(!1),charAt:XP(!0)},rQ=GT.charAt,iQ=Gi,$P=zl,oQ=z1,JP=f_,QP="String Iterator",sQ=$P.set,aQ=$P.getterFor(QP);oQ(String,"String",function(e){sQ(this,{type:QP,string:iQ(e),index:0})},function(){var e,t=aQ(this),n=t.string,o=t.index;return o>=n.length?JP(void 0,!0):(e=rQ(n,o),t.index+=e.length,JP(e,!1))});var cQ=wn.Promise,lQ={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},dQ=F,uQ=Va,ZP=Ru;for(var zT in lQ)uQ(dQ[zT],zT),ZP[zT]=ZP.Array;var eD=cQ,ye=u(eD),hQ=Vo("Array","values"),pQ=Tc,fQ=Lr,mQ=O,gQ=hQ,KT=Array.prototype,_Q={DOMTokenList:!0,NodeList:!0},EQ=function(e){var t=e.values;return e===KT||mQ(KT,e)&&t===KT.values||fQ(_Q,pQ(e))?gQ:t},Pi=u(EQ),tD=vu,vQ=TypeError,nD=Rc,yQ=Math.floor,YT=function(e,t){var n=e.length;if(n<8)for(var o,s,c=1;c<n;){for(s=c,o=e[c];s&&t(e[s-1],o)>0;)e[s]=e[--s];s!==c++&&(e[s]=o)}else for(var d=yQ(n/2),h=YT(nD(e,0,d),t),p=YT(nD(e,d),t),m=h.length,g=p.length,E=0,y=0;E<m||y<g;)e[E+y]=E<m&&y<g?t(h[E],p[y])<=0?h[E++]:p[y++]:E<m?h[E++]:p[y++];return e},rD=YT,iD=mi.match(/firefox\/(\d+)/i),SQ=!!iD&&+iD[1],TQ=/MSIE|Trident/.test(mi),oD=mi.match(/AppleWebKit\/(\d+)\./),wQ=!!oD&&+oD[1],RQ=Mt,sD=D,CQ=Hi,bQ=ea,aD=Sc,IQ=function(e,t){if(!delete e[t])throw new vQ("Cannot delete property "+tD(t)+" of "+tD(e))},cD=Gi,qT=f,AQ=rD,NQ=Jg,lD=SQ,OQ=TQ,dD=ja,uD=wQ,bc=[],hD=sD(bc.sort),PQ=sD(bc.push),DQ=qT(function(){bc.sort(void 0)}),kQ=qT(function(){bc.sort(null)}),xQ=NQ("sort"),pD=!qT(function(){if(dD)return dD<70;if(!(lD&&lD>3)){if(OQ)return!0;if(uD)return uD<603;var e,t,n,o,s="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:n=3;break;case 68:case 71:n=4;break;default:n=2}for(o=0;o<47;o++)bc.push({k:t+o,v:n})}for(bc.sort(function(c,d){return d.v-c.v}),o=0;o<bc.length;o++)t=bc[o].k.charAt(0),s.charAt(s.length-1)!==t&&(s+=t);return s!=="DGBEFHACIJK"}});RQ({target:"Array",proto:!0,forced:DQ||!kQ||!xQ||!pD},{sort:function(e){e!==void 0&&CQ(e);var t=bQ(this);if(pD)return e===void 0?hD(t):hD(t,e);var n,o,s=[],c=aD(t);for(o=0;o<c;o++)o in t&&PQ(s,t[o]);for(AQ(s,function(d){return function(h,p){return p===void 0?-1:h===void 0?1:d!==void 0?+d(h,p)||0:cD(h)>cD(p)?1:-1}}(e)),n=aD(s),o=0;o<n;)t[o]=s[o++];for(;o<c;)IQ(t,o++);return t}});var LQ=Vo("Array","sort"),MQ=O,UQ=LQ,XT=Array.prototype,jQ=function(e){var t=e.sort;return e===XT||MQ(XT,e)&&t===XT.sort?UQ:t},ql=u(jQ),VQ=Mt,FQ=D,BQ=V0,WQ=RangeError,fD=String.fromCharCode,mD=String.fromCodePoint,HQ=FQ([].join);VQ({target:"String",stat:!0,arity:1,forced:!!mD&&mD.length!==1},{fromCodePoint:function(e){for(var t,n=[],o=arguments.length,s=0;o>s;){if(t=+arguments[s++],BQ(t,1114111)!==t)throw new WQ(t+" is not a valid code point");n[s]=t<65536?fD(t):fD(55296+((t-=65536)>>10),t%1024+56320)}return HQ(n,"")}});var GQ=f,zQ=Fn("iterator"),C_=!GQ(function(){var e=new URL("b?a=1&b=2&c=3","https://a"),t=e.searchParams,n=new URLSearchParams("a=1&a=2&b=3"),o="";return e.pathname="c%20d",t.forEach(function(s,c){t.delete("b"),o+=c+s}),n.delete("a",2),n.delete("b",void 0),!e.toJSON||!n.has("a",1)||n.has("a",2)||!n.has("a",void 0)||n.has("b")||!t.size&&!0||!t.sort||e.href!=="https://a/c%20d?a=1&c=3"||t.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!t[zQ]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("https://тест").host!=="xn--e1aybc"||new URL("https://a#б").hash!=="#%D0%B1"||o!=="a1c3"||new URL("https://x",void 0).host!=="x"}),KQ=wc,$T=Mt,gD=F,JT=pP,YQ=Wr,b_=Ge,gs=D,uf=be,_D=C_,ED=wc,qQ=g_,XQ=function(e,t,n){for(var o in t)n&&n.unsafe&&e[o]?e[o]=t[o]:KQ(e,o,t[o],n);return e},$Q=Va,JQ=uT,QT=zl,vD=pT,ZT=fe,QQ=Lr,ZQ=yc,eZ=Tc,tZ=Oi,yD=xr,Di=Gi,nZ=ef,SD=ht,TD=tT,rZ=s_,I_=f_,ku=Kl,iZ=rD,oZ=Fn("iterator"),xu="URLSearchParams",wD=xu+"Iterator",RD=QT.set,Bo=QT.getterFor(xu),sZ=QT.getterFor(wD),CD=JT("fetch"),A_=JT("Request"),hf=JT("Headers"),ew=A_&&A_.prototype,bD=hf&&hf.prototype,aZ=gD.TypeError,cZ=gD.encodeURIComponent,lZ=String.fromCharCode,dZ=YQ("String","fromCodePoint"),uZ=parseInt,N_=gs("".charAt),ID=gs([].join),Ic=gs([].push),AD=gs("".replace),hZ=gs([].shift),ND=gs([].splice),OD=gs("".split),PD=gs("".slice),pZ=gs(/./.exec),fZ=/\+/g,mZ=/^[0-9a-f]+$/i,DD=function(e,t){var n=PD(e,t,t+2);return pZ(mZ,n)?uZ(n,16):NaN},gZ=function(e){for(var t=0,n=128;n>0&&e&n;n>>=1)t++;return t},_Z=function(e){var t=null;switch(e.length){case 1:t=e[0];break;case 2:t=(31&e[0])<<6|63&e[1];break;case 3:t=(15&e[0])<<12|(63&e[1])<<6|63&e[2];break;case 4:t=(7&e[0])<<18|(63&e[1])<<12|(63&e[2])<<6|63&e[3]}return t>1114111?null:t},kD=function(e){for(var t=(e=AD(e,fZ," ")).length,n="",o=0;o<t;){var s=N_(e,o);if(s==="%"){if(N_(e,o+1)==="%"||o+3>t){n+="%",o++;continue}var c=DD(e,o+1);if(c!=c){n+=s,o++;continue}o+=2;var d=gZ(c);if(d===0)s=lZ(c);else{if(d===1||d>4){n+="�",o++;continue}for(var h=[c],p=1;p<d&&!(++o+3>t||N_(e,o)!=="%");){var m=DD(e,o+1);if(m!=m){o+=3;break}if(m>191||m<128)break;Ic(h,m),o+=2,p++}if(h.length!==d){n+="�";continue}var g=_Z(h);g===null?n+="�":s=dZ(g)}}n+=s,o++}return n},EZ=/[!'()~]|%20/g,vZ={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},yZ=function(e){return vZ[e]},xD=function(e){return AD(cZ(e),EZ,yZ)},tw=JQ(function(e,t){RD(this,{type:wD,target:Bo(e).entries,index:0,kind:t})},xu,function(){var e=sZ(this),t=e.target,n=e.index++;if(!t||n>=t.length)return e.target=null,I_(void 0,!0);var o=t[n];switch(e.kind){case"keys":return I_(o.key,!1);case"values":return I_(o.value,!1)}return I_([o.key,o.value],!1)},!0),LD=function(e){this.entries=[],this.url=null,e!==void 0&&(yD(e)?this.parseObject(e):this.parseQuery(typeof e=="string"?N_(e,0)==="?"?PD(e,1):e:Di(e)))};LD.prototype={type:xu,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var t,n,o,s,c,d,h,p=this.entries,m=rZ(e);if(m)for(n=(t=TD(e,m)).next;!(o=b_(n,t)).done;){if(c=(s=TD(tZ(o.value))).next,(d=b_(c,s)).done||(h=b_(c,s)).done||!b_(c,s).done)throw new aZ("Expected sequence with length 2");Ic(p,{key:Di(d.value),value:Di(h.value)})}else for(var g in e)QQ(e,g)&&Ic(p,{key:g,value:Di(e[g])})},parseQuery:function(e){if(e)for(var t,n,o=this.entries,s=OD(e,"&"),c=0;c<s.length;)(t=s[c++]).length&&(n=OD(t,"="),Ic(o,{key:kD(hZ(n)),value:kD(ID(n,"="))}))},serialize:function(){for(var e,t=this.entries,n=[],o=0;o<t.length;)e=t[o++],Ic(n,xD(e.key)+"="+xD(e.value));return ID(n,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var O_=function(){vD(this,Lu);var e=RD(this,new LD(arguments.length>0?arguments[0]:void 0));uf||(this.size=e.entries.length)},Lu=O_.prototype;if(XQ(Lu,{append:function(e,t){var n=Bo(this);ku(arguments.length,2),Ic(n.entries,{key:Di(e),value:Di(t)}),uf||this.length++,n.updateURL()},delete:function(e){for(var t=Bo(this),n=ku(arguments.length,1),o=t.entries,s=Di(e),c=n<2?void 0:arguments[1],d=c===void 0?c:Di(c),h=0;h<o.length;){var p=o[h];if(p.key!==s||d!==void 0&&p.value!==d)h++;else if(ND(o,h,1),d!==void 0)break}uf||(this.size=o.length),t.updateURL()},get:function(e){var t=Bo(this).entries;ku(arguments.length,1);for(var n=Di(e),o=0;o<t.length;o++)if(t[o].key===n)return t[o].value;return null},getAll:function(e){var t=Bo(this).entries;ku(arguments.length,1);for(var n=Di(e),o=[],s=0;s<t.length;s++)t[s].key===n&&Ic(o,t[s].value);return o},has:function(e){for(var t=Bo(this).entries,n=ku(arguments.length,1),o=Di(e),s=n<2?void 0:arguments[1],c=s===void 0?s:Di(s),d=0;d<t.length;){var h=t[d++];if(h.key===o&&(c===void 0||h.value===c))return!0}return!1},set:function(e,t){var n=Bo(this);ku(arguments.length,1);for(var o,s=n.entries,c=!1,d=Di(e),h=Di(t),p=0;p<s.length;p++)(o=s[p]).key===d&&(c?ND(s,p--,1):(c=!0,o.value=h));c||Ic(s,{key:d,value:h}),uf||(this.size=s.length),n.updateURL()},sort:function(){var e=Bo(this);iZ(e.entries,function(t,n){return t.key>n.key?1:-1}),e.updateURL()},forEach:function(e){for(var t,n=Bo(this).entries,o=ZQ(e,arguments.length>1?arguments[1]:void 0),s=0;s<n.length;)o((t=n[s++]).value,t.key,this)},keys:function(){return new tw(this,"keys")},values:function(){return new tw(this,"values")},entries:function(){return new tw(this,"entries")}},{enumerable:!0}),ED(Lu,oZ,Lu.entries,{name:"entries"}),ED(Lu,"toString",function(){return Bo(this).serialize()},{enumerable:!0}),uf&&qQ(Lu,"size",{get:function(){return Bo(this).entries.length},configurable:!0,enumerable:!0}),$Q(O_,xu),$T({global:!0,constructor:!0,forced:!_D},{URLSearchParams:O_}),!_D&&ZT(hf)){var SZ=gs(bD.has),TZ=gs(bD.set),MD=function(e){if(yD(e)){var t,n=e.body;if(eZ(n)===xu)return t=e.headers?new hf(e.headers):new hf,SZ(t,"content-type")||TZ(t,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),nZ(e,{body:SD(0,Di(n)),headers:SD(0,t)})}return e};if(ZT(CD)&&$T({global:!0,enumerable:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e){return CD(e,arguments.length>1?MD(arguments[1]):{})}}),ZT(A_)){var nw=function(e){return vD(this,ew),new A_(e,arguments.length>1?MD(arguments[1]):{})};ew.constructor=nw,nw.prototype=ew,$T({global:!0,constructor:!0,dontCallGetSet:!0,forced:!0},{Request:nw})}}var Wo,wZ={URLSearchParams:O_,getState:Bo},RZ=wn.URLSearchParams,UD=be,CZ=D,bZ=Ge,IZ=f,rw=r_,AZ=Zp,NZ=le,OZ=ea,PZ=et,Mu=Object.assign,jD=Object.defineProperty,DZ=CZ([].concat),kZ=!Mu||IZ(function(){if(UD&&Mu({b:1},Mu(jD({},"a",{enumerable:!0,get:function(){jD(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var e={},t={},n=Symbol("assign detection"),o="abcdefghijklmnopqrst";return e[n]=7,o.split("").forEach(function(s){t[s]=s}),Mu({},e)[n]!==7||rw(Mu({},t)).join("")!==o})?function(e,t){for(var n=OZ(e),o=arguments.length,s=1,c=AZ.f,d=NZ.f;o>s;)for(var h,p=PZ(arguments[s++]),m=c?DZ(rw(p),c(p)):rw(p),g=m.length,E=0;g>E;)h=m[E++],UD&&!bZ(d,p,h)||(n[h]=p[h]);return n}:Mu,xZ=Oi,LZ=C1,MZ=be,UZ=jo,jZ=ht,iw=function(e,t,n){MZ?UZ.f(e,t,jZ(0,n)):e[t]=n},VZ=yc,FZ=Ge,BZ=ea,WZ=function(e,t,n,o){try{return o?t(xZ(n)[0],n[1]):t(n)}catch(s){LZ(e,"throw",s)}},HZ=T1,GZ=__,zZ=Sc,VD=iw,KZ=tT,YZ=s_,FD=Array,Xl=D,ow=2147483647,qZ=/[^\0-\u007E]/,BD=/[.\u3002\uFF0E\uFF61]/g,WD="Overflow: input needs wider integers to process",HD=RangeError,XZ=Xl(BD.exec),Uu=Math.floor,sw=String.fromCharCode,GD=Xl("".charCodeAt),zD=Xl([].join),Ac=Xl([].push),$Z=Xl("".replace),JZ=Xl("".split),QZ=Xl("".toLowerCase),KD=function(e){return e+22+75*(e<26)},ZZ=function(e,t,n){var o=0;for(e=n?Uu(e/700):e>>1,e+=Uu(e/t);e>455;)e=Uu(e/35),o+=36;return Uu(o+36*e/(e+38))},eee=function(e){var t=[];e=function(M){for(var U=[],Y=0,Q=M.length;Y<Q;){var J=GD(M,Y++);if(J>=55296&&J<=56319&&Y<Q){var X=GD(M,Y++);(64512&X)==56320?Ac(U,((1023&J)<<10)+(1023&X)+65536):(Ac(U,J),Y--)}else Ac(U,J)}return U}(e);var n,o,s=e.length,c=128,d=0,h=72;for(n=0;n<e.length;n++)(o=e[n])<128&&Ac(t,sw(o));var p=t.length,m=p;for(p&&Ac(t,"-");m<s;){var g=ow;for(n=0;n<e.length;n++)(o=e[n])>=c&&o<g&&(g=o);var E=m+1;if(g-c>Uu((ow-d)/E))throw new HD(WD);for(d+=(g-c)*E,c=g,n=0;n<e.length;n++){if((o=e[n])<c&&++d>ow)throw new HD(WD);if(o===c){for(var y=d,T=36;;){var P=T<=h?1:T>=h+26?26:T-h;if(y<P)break;var I=y-P,A=36-P;Ac(t,sw(KD(P+I%A))),y=Uu(I/A),T+=36}Ac(t,sw(KD(y))),h=ZZ(d,E,m===p),d=0,m++}}d++,c++}return zD(t,"")},tee=Mt,aw=be,nee=C_,cw=F,YD=yc,Ho=D,P_=wc,Go=g_,ree=pT,lw=Lr,dw=kZ,ju=function(e){var t=BZ(e),n=GZ(this),o=arguments.length,s=o>1?arguments[1]:void 0,c=s!==void 0;c&&(s=VZ(s,o>2?arguments[2]:void 0));var d,h,p,m,g,E,y=YZ(t),T=0;if(!y||this===FD&&HZ(y))for(d=zZ(t),h=n?new this(d):FD(d);d>T;T++)E=c?s(t[T],T):t[T],VD(h,T,E);else for(h=n?new this:[],g=(m=KZ(t,y)).next;!(p=FZ(g,m)).done;T++)E=c?WZ(m,s,[p.value,T],!0):p.value,VD(h,T,E);return h.length=T,h},_s=Rc,iee=GT.codeAt,oee=function(e){var t,n,o=[],s=JZ($Z(QZ(e),BD,"."),".");for(t=0;t<s.length;t++)n=s[t],Ac(o,XZ(qZ,n)?"xn--"+eee(n):n);return zD(o,".")},Fa=Gi,see=Va,aee=Kl,qD=wZ,XD=zl,cee=XD.set,D_=XD.getterFor("URL"),lee=qD.URLSearchParams,dee=qD.getState,pf=cw.URL,uw=cw.TypeError,k_=cw.parseInt,uee=Math.floor,$D=Math.pow,zo=Ho("".charAt),Es=Ho(/./.exec),ff=Ho([].join),hee=Ho(1 .toString),pee=Ho([].pop),Vu=Ho([].push),hw=Ho("".replace),fee=Ho([].shift),mee=Ho("".split),mf=Ho("".slice),x_=Ho("".toLowerCase),gee=Ho([].unshift),pw="Invalid scheme",$l="Invalid host",JD="Invalid port",QD=/[a-z]/i,_ee=/[\d+-.a-z]/i,fw=/\d/,Eee=/^0x/i,vee=/^[0-7]+$/,yee=/^\d+$/,ZD=/^[\da-f]+$/i,See=/[\0\t\n\r #%/:<>?@[\\\]^|]/,Tee=/[\0\t\n\r #/:<>?@[\\\]^|]/,wee=/^[\u0000-\u0020]+/,Ree=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,Cee=/[\t\n\r]/g,gf=function(e){var t,n,o,s;if(typeof e=="number"){for(t=[],n=0;n<4;n++)gee(t,e%256),e=uee(e/256);return ff(t,".")}if(typeof e=="object"){for(t="",o=function(c){for(var d=null,h=1,p=null,m=0,g=0;g<8;g++)c[g]!==0?(m>h&&(d=p,h=m),p=null,m=0):(p===null&&(p=g),++m);return m>h?p:d}(e),n=0;n<8;n++)s&&e[n]===0||(s&&(s=!1),o===n?(t+=n?":":"::",s=!0):(t+=hee(e[n],16),n<7&&(t+=":")));return"["+t+"]"}return e},L_={},ek=dw({},L_,{" ":1,'"':1,"<":1,">":1,"`":1}),tk=dw({},ek,{"#":1,"?":1,"{":1,"}":1}),mw=dw({},tk,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),Nc=function(e,t){var n=iee(e,0);return n>32&&n<127&&!lw(t,e)?e:encodeURIComponent(e)},M_={ftp:21,file:null,http:80,https:443,ws:80,wss:443},_f=function(e,t){var n;return e.length===2&&Es(QD,zo(e,0))&&((n=zo(e,1))===":"||!t&&n==="|")},nk=function(e){var t;return e.length>1&&_f(mf(e,0,2))&&(e.length===2||(t=zo(e,2))==="/"||t==="\\"||t==="?"||t==="#")},bee=function(e){return e==="."||x_(e)==="%2e"},gw={},rk={},_w={},ik={},ok={},Ew={},sk={},ak={},U_={},j_={},vw={},yw={},Sw={},Tw={},ck={},ww={},Fu={},ra={},lk={},Jl={},Ba={},Rw=function(e,t,n){var o,s,c,d=Fa(e);if(t){if(s=this.parse(d))throw new uw(s);this.searchParams=null}else{if(n!==void 0&&(o=new Rw(n,!0)),s=this.parse(d,null,o))throw new uw(s);(c=dee(new lee)).bindURL(this),this.searchParams=c}};Rw.prototype={type:"URL",parse:function(e,t,n){var o,s,c,d,h,p=this,m=t||gw,g=0,E="",y=!1,T=!1,P=!1;for(e=Fa(e),t||(p.scheme="",p.username="",p.password="",p.host=null,p.port=null,p.path=[],p.query=null,p.fragment=null,p.cannotBeABaseURL=!1,e=hw(e,wee,""),e=hw(e,Ree,"$1")),e=hw(e,Cee,""),o=ju(e);g<=o.length;){switch(s=o[g],m){case gw:if(!s||!Es(QD,s)){if(t)return pw;m=_w;continue}E+=x_(s),m=rk;break;case rk:if(s&&(Es(_ee,s)||s==="+"||s==="-"||s==="."))E+=x_(s);else{if(s!==":"){if(t)return pw;E="",m=_w,g=0;continue}if(t&&(p.isSpecial()!==lw(M_,E)||E==="file"&&(p.includesCredentials()||p.port!==null)||p.scheme==="file"&&!p.host))return;if(p.scheme=E,t)return void(p.isSpecial()&&M_[p.scheme]===p.port&&(p.port=null));E="",p.scheme==="file"?m=Tw:p.isSpecial()&&n&&n.scheme===p.scheme?m=ik:p.isSpecial()?m=ak:o[g+1]==="/"?(m=ok,g++):(p.cannotBeABaseURL=!0,Vu(p.path,""),m=lk)}break;case _w:if(!n||n.cannotBeABaseURL&&s!=="#")return pw;if(n.cannotBeABaseURL&&s==="#"){p.scheme=n.scheme,p.path=_s(n.path),p.query=n.query,p.fragment="",p.cannotBeABaseURL=!0,m=Ba;break}m=n.scheme==="file"?Tw:Ew;continue;case ik:if(s!=="/"||o[g+1]!=="/"){m=Ew;continue}m=U_,g++;break;case ok:if(s==="/"){m=j_;break}m=ra;continue;case Ew:if(p.scheme=n.scheme,s===Wo)p.username=n.username,p.password=n.password,p.host=n.host,p.port=n.port,p.path=_s(n.path),p.query=n.query;else if(s==="/"||s==="\\"&&p.isSpecial())m=sk;else if(s==="?")p.username=n.username,p.password=n.password,p.host=n.host,p.port=n.port,p.path=_s(n.path),p.query="",m=Jl;else{if(s!=="#"){p.username=n.username,p.password=n.password,p.host=n.host,p.port=n.port,p.path=_s(n.path),p.path.length--,m=ra;continue}p.username=n.username,p.password=n.password,p.host=n.host,p.port=n.port,p.path=_s(n.path),p.query=n.query,p.fragment="",m=Ba}break;case sk:if(!p.isSpecial()||s!=="/"&&s!=="\\"){if(s!=="/"){p.username=n.username,p.password=n.password,p.host=n.host,p.port=n.port,m=ra;continue}m=j_}else m=U_;break;case ak:if(m=U_,s!=="/"||zo(E,g+1)!=="/")continue;g++;break;case U_:if(s!=="/"&&s!=="\\"){m=j_;continue}break;case j_:if(s==="@"){y&&(E="%40"+E),y=!0,c=ju(E);for(var I=0;I<c.length;I++){var A=c[I];if(A!==":"||P){var M=Nc(A,mw);P?p.password+=M:p.username+=M}else P=!0}E=""}else if(s===Wo||s==="/"||s==="?"||s==="#"||s==="\\"&&p.isSpecial()){if(y&&E==="")return"Invalid authority";g-=ju(E).length+1,E="",m=vw}else E+=s;break;case vw:case yw:if(t&&p.scheme==="file"){m=ww;continue}if(s!==":"||T){if(s===Wo||s==="/"||s==="?"||s==="#"||s==="\\"&&p.isSpecial()){if(p.isSpecial()&&E==="")return $l;if(t&&E===""&&(p.includesCredentials()||p.port!==null))return;if(d=p.parseHost(E))return d;if(E="",m=Fu,t)return;continue}s==="["?T=!0:s==="]"&&(T=!1),E+=s}else{if(E==="")return $l;if(d=p.parseHost(E))return d;if(E="",m=Sw,t===yw)return}break;case Sw:if(!Es(fw,s)){if(s===Wo||s==="/"||s==="?"||s==="#"||s==="\\"&&p.isSpecial()||t){if(E!==""){var U=k_(E,10);if(U>65535)return JD;p.port=p.isSpecial()&&U===M_[p.scheme]?null:U,E=""}if(t)return;m=Fu;continue}return JD}E+=s;break;case Tw:if(p.scheme="file",s==="/"||s==="\\")m=ck;else{if(!n||n.scheme!=="file"){m=ra;continue}switch(s){case Wo:p.host=n.host,p.path=_s(n.path),p.query=n.query;break;case"?":p.host=n.host,p.path=_s(n.path),p.query="",m=Jl;break;case"#":p.host=n.host,p.path=_s(n.path),p.query=n.query,p.fragment="",m=Ba;break;default:nk(ff(_s(o,g),""))||(p.host=n.host,p.path=_s(n.path),p.shortenPath()),m=ra;continue}}break;case ck:if(s==="/"||s==="\\"){m=ww;break}n&&n.scheme==="file"&&!nk(ff(_s(o,g),""))&&(_f(n.path[0],!0)?Vu(p.path,n.path[0]):p.host=n.host),m=ra;continue;case ww:if(s===Wo||s==="/"||s==="\\"||s==="?"||s==="#"){if(!t&&_f(E))m=ra;else if(E===""){if(p.host="",t)return;m=Fu}else{if(d=p.parseHost(E))return d;if(p.host==="localhost"&&(p.host=""),t)return;E="",m=Fu}continue}E+=s;break;case Fu:if(p.isSpecial()){if(m=ra,s!=="/"&&s!=="\\")continue}else if(t||s!=="?")if(t||s!=="#"){if(s!==Wo&&(m=ra,s!=="/"))continue}else p.fragment="",m=Ba;else p.query="",m=Jl;break;case ra:if(s===Wo||s==="/"||s==="\\"&&p.isSpecial()||!t&&(s==="?"||s==="#")){if((h=x_(h=E))===".."||h==="%2e."||h===".%2e"||h==="%2e%2e"?(p.shortenPath(),s==="/"||s==="\\"&&p.isSpecial()||Vu(p.path,"")):bee(E)?s==="/"||s==="\\"&&p.isSpecial()||Vu(p.path,""):(p.scheme==="file"&&!p.path.length&&_f(E)&&(p.host&&(p.host=""),E=zo(E,0)+":"),Vu(p.path,E)),E="",p.scheme==="file"&&(s===Wo||s==="?"||s==="#"))for(;p.path.length>1&&p.path[0]==="";)fee(p.path);s==="?"?(p.query="",m=Jl):s==="#"&&(p.fragment="",m=Ba)}else E+=Nc(s,tk);break;case lk:s==="?"?(p.query="",m=Jl):s==="#"?(p.fragment="",m=Ba):s!==Wo&&(p.path[0]+=Nc(s,L_));break;case Jl:t||s!=="#"?s!==Wo&&(s==="'"&&p.isSpecial()?p.query+="%27":p.query+=s==="#"?"%23":Nc(s,L_)):(p.fragment="",m=Ba);break;case Ba:s!==Wo&&(p.fragment+=Nc(s,ek))}g++}},parseHost:function(e){var t,n,o;if(zo(e,0)==="["){if(zo(e,e.length-1)!=="]"||(t=function(s){var c,d,h,p,m,g,E,y=[0,0,0,0,0,0,0,0],T=0,P=null,I=0,A=function(){return zo(s,I)};if(A()===":"){if(zo(s,1)!==":")return;I+=2,P=++T}for(;A();){if(T===8)return;if(A()!==":"){for(c=d=0;d<4&&Es(ZD,A());)c=16*c+k_(A(),16),I++,d++;if(A()==="."){if(d===0||(I-=d,T>6))return;for(h=0;A();){if(p=null,h>0){if(!(A()==="."&&h<4))return;I++}if(!Es(fw,A()))return;for(;Es(fw,A());){if(m=k_(A(),10),p===null)p=m;else{if(p===0)return;p=10*p+m}if(p>255)return;I++}y[T]=256*y[T]+p,++h!=2&&h!==4||T++}if(h!==4)return;break}if(A()===":"){if(I++,!A())return}else if(A())return;y[T++]=c}else{if(P!==null)return;I++,P=++T}}if(P!==null)for(g=T-P,T=7;T!==0&&g>0;)E=y[T],y[T--]=y[P+g-1],y[P+--g]=E;else if(T!==8)return;return y}(mf(e,1,-1)),!t))return $l;this.host=t}else if(this.isSpecial()){if(e=oee(e),Es(See,e)||(t=function(s){var c,d,h,p,m,g,E,y=mee(s,".");if(y.length&&y[y.length-1]===""&&y.length--,(c=y.length)>4)return s;for(d=[],h=0;h<c;h++){if((p=y[h])==="")return s;if(m=10,p.length>1&&zo(p,0)==="0"&&(m=Es(Eee,p)?16:8,p=mf(p,m===8?1:2)),p==="")g=0;else{if(!Es(m===10?yee:m===8?vee:ZD,p))return s;g=k_(p,m)}Vu(d,g)}for(h=0;h<c;h++)if(g=d[h],h===c-1){if(g>=$D(256,5-c))return null}else if(g>255)return null;for(E=pee(d),h=0;h<d.length;h++)E+=d[h]*$D(256,3-h);return E}(e),t===null))return $l;this.host=t}else{if(Es(Tee,e))return $l;for(t="",n=ju(e),o=0;o<n.length;o++)t+=Nc(n[o],L_);this.host=t}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme==="file"},includesCredentials:function(){return this.username!==""||this.password!==""},isSpecial:function(){return lw(M_,this.scheme)},shortenPath:function(){var e=this.path,t=e.length;!t||this.scheme==="file"&&t===1&&_f(e[0],!0)||e.length--},serialize:function(){var e=this,t=e.scheme,n=e.username,o=e.password,s=e.host,c=e.port,d=e.path,h=e.query,p=e.fragment,m=t+":";return s!==null?(m+="//",e.includesCredentials()&&(m+=n+(o?":"+o:"")+"@"),m+=gf(s),c!==null&&(m+=":"+c)):t==="file"&&(m+="//"),m+=e.cannotBeABaseURL?d[0]:d.length?"/"+ff(d,"/"):"",h!==null&&(m+="?"+h),p!==null&&(m+="#"+p),m},setHref:function(e){var t=this.parse(e);if(t)throw new uw(t);this.searchParams.update()},getOrigin:function(){var e=this.scheme,t=this.port;if(e==="blob")try{return new Bu(e.path[0]).origin}catch{return"null"}return e!=="file"&&this.isSpecial()?e+"://"+gf(this.host)+(t!==null?":"+t:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(Fa(e)+":",gw)},getUsername:function(){return this.username},setUsername:function(e){var t=ju(Fa(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var n=0;n<t.length;n++)this.username+=Nc(t[n],mw)}},getPassword:function(){return this.password},setPassword:function(e){var t=ju(Fa(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var n=0;n<t.length;n++)this.password+=Nc(t[n],mw)}},getHost:function(){var e=this.host,t=this.port;return e===null?"":t===null?gf(e):gf(e)+":"+t},setHost:function(e){this.cannotBeABaseURL||this.parse(e,vw)},getHostname:function(){var e=this.host;return e===null?"":gf(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,yw)},getPort:function(){var e=this.port;return e===null?"":Fa(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||((e=Fa(e))===""?this.port=null:this.parse(e,Sw))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+ff(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,Fu))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){(e=Fa(e))===""?this.query=null:(zo(e,0)==="?"&&(e=mf(e,1)),this.query="",this.parse(e,Jl)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){(e=Fa(e))!==""?(zo(e,0)==="#"&&(e=mf(e,1)),this.fragment="",this.parse(e,Ba)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var Bu=function(e){var t=ree(this,ki),n=aee(arguments.length,1)>1?arguments[1]:void 0,o=cee(t,new Rw(e,!1,n));aw||(t.href=o.serialize(),t.origin=o.getOrigin(),t.protocol=o.getProtocol(),t.username=o.getUsername(),t.password=o.getPassword(),t.host=o.getHost(),t.hostname=o.getHostname(),t.port=o.getPort(),t.pathname=o.getPathname(),t.search=o.getSearch(),t.searchParams=o.getSearchParams(),t.hash=o.getHash())},ki=Bu.prototype,Ko=function(e,t){return{get:function(){return D_(this)[e]()},set:t&&function(n){return D_(this)[t](n)},configurable:!0,enumerable:!0}};if(aw&&(Go(ki,"href",Ko("serialize","setHref")),Go(ki,"origin",Ko("getOrigin")),Go(ki,"protocol",Ko("getProtocol","setProtocol")),Go(ki,"username",Ko("getUsername","setUsername")),Go(ki,"password",Ko("getPassword","setPassword")),Go(ki,"host",Ko("getHost","setHost")),Go(ki,"hostname",Ko("getHostname","setHostname")),Go(ki,"port",Ko("getPort","setPort")),Go(ki,"pathname",Ko("getPathname","setPathname")),Go(ki,"search",Ko("getSearch","setSearch")),Go(ki,"searchParams",Ko("getSearchParams")),Go(ki,"hash",Ko("getHash","setHash"))),P_(ki,"toJSON",function(){return D_(this).serialize()},{enumerable:!0}),P_(ki,"toString",function(){return D_(this).serialize()},{enumerable:!0}),pf){var dk=pf.createObjectURL,uk=pf.revokeObjectURL;dk&&P_(Bu,"createObjectURL",YD(dk,pf)),uk&&P_(Bu,"revokeObjectURL",YD(uk,pf))}see(Bu,"URL"),tee({global:!0,constructor:!0,forced:!nee,sham:!aw},{URL:Bu});var Iee=Mt,hk=f,Aee=Kl,pk=Gi,Nee=C_,Cw=Wr("URL"),Oee=Nee&&hk(function(){Cw.canParse()}),Pee=hk(function(){return Cw.canParse.length!==1});Iee({target:"URL",stat:!0,forced:!Oee||Pee},{canParse:function(e){var t=Aee(arguments.length,1),n=pk(e),o=t<2||arguments[1]===void 0?void 0:pk(arguments[1]);try{return!!new Cw(n,o)}catch{return!1}}});var Dee=Mt,kee=Kl,fk=Gi,xee=C_,Lee=Wr("URL");Dee({target:"URL",stat:!0,forced:!xee},{parse:function(e){var t=kee(arguments.length,1),n=fk(e),o=t<2||arguments[1]===void 0?void 0:fk(arguments[1]);try{return new Lee(n,o)}catch{return null}}});var V_=u(wn.URL);let mk=!0,gk=!0;function F_(e,t,n){const o=e.match(t);return o&&o.length>=n&&parseInt(o[n],10)}function Ql(e,t,n){if(!e.RTCPeerConnection)return;const o=e.RTCPeerConnection.prototype,s=o.addEventListener;o.addEventListener=function(d,h){if(d!==t)return s.apply(this,arguments);const p=m=>{const g=n(m);g&&(h.handleEvent?h.handleEvent(g):h(g))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(h,p),s.apply(this,[d,p])};const c=o.removeEventListener;o.removeEventListener=function(d,h){if(d!==t||!this._eventMap||!this._eventMap[t])return c.apply(this,arguments);if(!this._eventMap[t].has(h))return c.apply(this,arguments);const p=this._eventMap[t].get(h);return this._eventMap[t].delete(h),this._eventMap[t].size===0&&delete this._eventMap[t],Object.keys(this._eventMap).length===0&&delete this._eventMap,c.apply(this,[d,p])},Object.defineProperty(o,"on"+t,{get(){return this["_on"+t]},set(d){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),d&&this.addEventListener(t,this["_on"+t]=d)},enumerable:!0,configurable:!0})}function Mee(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(mk=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function Uee(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(gk=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function _k(){if(typeof window=="object"){if(mk)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function bw(e,t){gk&&console.warn(e+" is deprecated, please use "+t+" instead.")}function Ek(e){return Object.prototype.toString.call(e)==="[object Object]"}function vk(e){var t;return Ek(e)?Fo(t=Object.keys(e)).call(t,function(n,o){const s=Ek(e[o]),c=s?vk(e[o]):e[o],d=s&&!Object.keys(c).length;return c===void 0||d?n:Object.assign(n,{[o]:c})},{}):e}function Iw(e,t,n){t&&!n.has(t.id)&&(n.set(t.id,t),Object.keys(t).forEach(o=>{o.endsWith("Id")?Iw(e,e.get(t[o]),n):o.endsWith("Ids")&&t[o].forEach(s=>{Iw(e,e.get(s),n)})}))}function yk(e,t,n){const o=n?"outbound-rtp":"inbound-rtp",s=new Map;if(t===null)return s;const c=[];return e.forEach(d=>{d.type==="track"&&d.trackIdentifier===t.id&&c.push(d)}),c.forEach(d=>{e.forEach(h=>{h.type===o&&h.trackId===d.id&&Iw(e,h,s)})}),s}const Sk=_k;function Tk(e,t){const n=e&&e.navigator;if(!n.mediaDevices)return;const o=function(d){if(typeof d!="object"||d.mandatory||d.optional)return d;const h={};return Object.keys(d).forEach(p=>{if(p==="require"||p==="advanced"||p==="mediaSource")return;const m=typeof d[p]=="object"?d[p]:{ideal:d[p]};m.exact!==void 0&&typeof m.exact=="number"&&(m.min=m.max=m.exact);const g=function(E,y){return E?E+y.charAt(0).toUpperCase()+y.slice(1):y==="deviceId"?"sourceId":y};if(m.ideal!==void 0){h.optional=h.optional||[];let E={};typeof m.ideal=="number"?(E[g("min",p)]=m.ideal,h.optional.push(E),E={},E[g("max",p)]=m.ideal,h.optional.push(E)):(E[g("",p)]=m.ideal,h.optional.push(E))}m.exact!==void 0&&typeof m.exact!="number"?(h.mandatory=h.mandatory||{},h.mandatory[g("",p)]=m.exact):["min","max"].forEach(E=>{m[E]!==void 0&&(h.mandatory=h.mandatory||{},h.mandatory[g(E,p)]=m[E])})}),d.advanced&&(h.optional=(h.optional||[]).concat(d.advanced)),h},s=function(d,h){if(t.version>=61)return h(d);if((d=JSON.parse(JSON.stringify(d)))&&typeof d.audio=="object"){const p=function(m,g,E){g in m&&!(E in m)&&(m[E]=m[g],delete m[g])};p((d=JSON.parse(JSON.stringify(d))).audio,"autoGainControl","googAutoGainControl"),p(d.audio,"noiseSuppression","googNoiseSuppression"),d.audio=o(d.audio)}if(d&&typeof d.video=="object"){let p=d.video.facingMode;p=p&&(typeof p=="object"?p:{ideal:p});const m=t.version<66;if(p&&(p.exact==="user"||p.exact==="environment"||p.ideal==="user"||p.ideal==="environment")&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||m)){let g;if(delete d.video.facingMode,p.exact==="environment"||p.ideal==="environment"?g=["back","rear"]:p.exact!=="user"&&p.ideal!=="user"||(g=["front"]),g)return n.mediaDevices.enumerateDevices().then(E=>{let y=(E=E.filter(T=>T.kind==="videoinput")).find(T=>g.some(P=>{var I;return Ee(I=T.label.toLowerCase()).call(I,P)}));return!y&&E.length&&Ee(g).call(g,"back")&&(y=E[E.length-1]),y&&(d.video.deviceId=p.exact?{exact:y.deviceId}:{ideal:y.deviceId}),d.video=o(d.video),Sk("chrome: "+JSON.stringify(d)),h(d)})}d.video=o(d.video)}return Sk("chrome: "+JSON.stringify(d)),h(d)},c=function(d){return t.version>=64?d:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[d.name]||d.name,message:d.message,constraint:d.constraint||d.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(n.getUserMedia=(function(d,h,p){s(d,m=>{n.webkitGetUserMedia(m,h,g=>{p&&p(c(g))})})}).bind(n),n.mediaDevices.getUserMedia){const d=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(h){return s(h,p=>d(p).then(m=>{if(p.audio&&!m.getAudioTracks().length||p.video&&!m.getVideoTracks().length)throw m.getTracks().forEach(g=>{g.stop()}),new DOMException("","NotFoundError");return m},m=>ye.reject(c(m))))}}}function wk(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function Rk(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=n=>{n.stream.addEventListener("addtrack",o=>{let s;s=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(d=>d.track&&d.track.id===o.track.id):{track:o.track};const c=new Event("track");c.track=o.track,c.receiver=s,c.transceiver={receiver:s},c.streams=[n.stream],this.dispatchEvent(c)}),n.stream.getTracks().forEach(o=>{let s;s=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(d=>d.track&&d.track.id===o.id):{track:o};const c=new Event("track");c.track=o,c.receiver=s,c.transceiver={receiver:s},c.streams=[n.stream],this.dispatchEvent(c)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else Ql(e,"track",t=>(t.transceiver||Object.defineProperty(t,"transceiver",{value:{receiver:t.receiver}}),t))}function Ck(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(s,c){return{track:c,get dtmf(){return this._dtmf===void 0&&(c.kind==="audio"?this._dtmf=s.createDTMFSender(c):this._dtmf=null),this._dtmf},_pc:s}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const s=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(d,h){let p=s.apply(this,arguments);return p||(p=t(this,d),this._senders.push(p)),p};const c=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(d){c.apply(this,arguments);const h=this._senders.indexOf(d);h!==-1&&this._senders.splice(h,1)}}const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(s){this._senders=this._senders||[],n.apply(this,[s]),s.getTracks().forEach(c=>{this._senders.push(t(this,c))})};const o=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(s){this._senders=this._senders||[],o.apply(this,[s]),s.getTracks().forEach(c=>{const d=this._senders.find(h=>h.track===c);d&&this._senders.splice(this._senders.indexOf(d),1)})}}else if(typeof e=="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const n=t.apply(this,[]);return n.forEach(o=>o._pc=this),n},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function bk(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[n,o,s]=arguments;if(arguments.length>0&&typeof n=="function")return t.apply(this,arguments);if(t.length===0&&(arguments.length===0||typeof n!="function"))return t.apply(this,[]);const c=function(h){const p={};return h.result().forEach(m=>{const g={id:m.id,timestamp:m.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[m.type]||m.type};m.names().forEach(E=>{g[E]=m.stat(E)}),p[g.id]=g}),p},d=function(h){return new Map(Object.keys(h).map(p=>[p,h[p]]))};if(arguments.length>=2){const h=function(p){o(d(c(p)))};return t.apply(this,[h,n])}return new ye((h,p)=>{t.apply(this,[function(m){h(d(c(m)))},p])}).then(o,s)}}function Ik(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const n=e.RTCPeerConnection.prototype.getSenders;n&&(e.RTCPeerConnection.prototype.getSenders=function(){const s=n.apply(this,[]);return s.forEach(c=>c._pc=this),s});const o=e.RTCPeerConnection.prototype.addTrack;o&&(e.RTCPeerConnection.prototype.addTrack=function(){const s=o.apply(this,arguments);return s._pc=this,s}),e.RTCRtpSender.prototype.getStats=function(){const s=this;return this._pc.getStats().then(c=>yk(c,s.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const n=e.RTCPeerConnection.prototype.getReceivers;n&&(e.RTCPeerConnection.prototype.getReceivers=function(){const o=n.apply(this,[]);return o.forEach(s=>s._pc=this),o}),Ql(e,"track",o=>(o.receiver._pc=o.srcElement,o)),e.RTCRtpReceiver.prototype.getStats=function(){const o=this;return this._pc.getStats().then(s=>yk(s,o.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const n=arguments[0];let o,s,c;return this.getSenders().forEach(d=>{d.track===n&&(o?c=!0:o=d)}),this.getReceivers().forEach(d=>(d.track===n&&(s?c=!0:s=d),d.track===n)),c||o&&s?ye.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):o?o.getStats():s?s.getStats():ye.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function Ak(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(c=>this._shimmedLocalStreams[c][0])};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(c,d){if(!d)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const h=t.apply(this,arguments);return this._shimmedLocalStreams[d.id]?this._shimmedLocalStreams[d.id].indexOf(h)===-1&&this._shimmedLocalStreams[d.id].push(h):this._shimmedLocalStreams[d.id]=[d,h],h};const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(c){this._shimmedLocalStreams=this._shimmedLocalStreams||{},c.getTracks().forEach(p=>{if(this.getSenders().find(g=>g.track===p))throw new DOMException("Track already exists.","InvalidAccessError")});const d=this.getSenders();n.apply(this,arguments);const h=this.getSenders().filter(p=>d.indexOf(p)===-1);this._shimmedLocalStreams[c.id]=[c].concat(h)};const o=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(c){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[c.id],o.apply(this,arguments)};const s=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(c){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},c&&Object.keys(this._shimmedLocalStreams).forEach(d=>{const h=this._shimmedLocalStreams[d].indexOf(c);h!==-1&&this._shimmedLocalStreams[d].splice(h,1),this._shimmedLocalStreams[d].length===1&&delete this._shimmedLocalStreams[d]}),s.apply(this,arguments)}}function Nk(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return Ak(e);const n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const p=n.apply(this);return this._reverseStreams=this._reverseStreams||{},p.map(m=>this._reverseStreams[m.id])};const o=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(p){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},p.getTracks().forEach(m=>{if(this.getSenders().find(E=>E.track===m))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[p.id]){const m=new e.MediaStream(p.getTracks());this._streams[p.id]=m,this._reverseStreams[m.id]=p,p=m}o.apply(this,[p])};const s=e.RTCPeerConnection.prototype.removeStream;function c(p,m){let g=m.sdp;return Object.keys(p._reverseStreams||[]).forEach(E=>{const y=p._reverseStreams[E],T=p._streams[y.id];g=g.replace(new RegExp(T.id,"g"),y.id)}),new RTCSessionDescription({type:m.type,sdp:g})}e.RTCPeerConnection.prototype.removeStream=function(p){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},s.apply(this,[this._streams[p.id]||p]),delete this._reverseStreams[this._streams[p.id]?this._streams[p.id].id:p.id],delete this._streams[p.id]},e.RTCPeerConnection.prototype.addTrack=function(p,m){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const g=[].slice.call(arguments,1);if(g.length!==1||!g[0].getTracks().find(T=>T===p))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(T=>T.track===p))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const y=this._streams[m.id];if(y)y.addTrack(p),ye.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const T=new e.MediaStream([p]);this._streams[m.id]=T,this._reverseStreams[T.id]=m,this.addStream(T)}return this.getSenders().find(T=>T.track===p)},["createOffer","createAnswer"].forEach(function(p){const m=e.RTCPeerConnection.prototype[p],g={[p](){const E=arguments;return arguments.length&&typeof arguments[0]=="function"?m.apply(this,[y=>{const T=c(this,y);E[0].apply(null,[T])},y=>{E[1]&&E[1].apply(null,y)},arguments[2]]):m.apply(this,arguments).then(y=>c(this,y))}};e.RTCPeerConnection.prototype[p]=g[p]});const d=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(p,m){let g=m.sdp;return Object.keys(p._reverseStreams||[]).forEach(E=>{const y=p._reverseStreams[E],T=p._streams[y.id];g=g.replace(new RegExp(y.id,"g"),T.id)}),new RTCSessionDescription({type:m.type,sdp:g})}(this,arguments[0]),d.apply(this,arguments)):d.apply(this,arguments)};const h=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const p=h.get.apply(this);return p.type===""?p:c(this,p)}}),e.RTCPeerConnection.prototype.removeTrack=function(p){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!p._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(p._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let m;this._streams=this._streams||{},Object.keys(this._streams).forEach(g=>{this._streams[g].getTracks().find(E=>p.track===E)&&(m=this._streams[g])}),m&&(m.getTracks().length===1?this.removeStream(this._reverseStreams[m.id]):m.removeTrack(p.track),this.dispatchEvent(new Event("negotiationneeded")))}}function Aw(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const o=e.RTCPeerConnection.prototype[n],s={[n](){return arguments[0]=new(n==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),o.apply(this,arguments)}};e.RTCPeerConnection.prototype[n]=s[n]})}function Ok(e,t){Ql(e,"negotiationneeded",n=>{const o=n.target;if(!(t.version<72||o.getConfiguration&&o.getConfiguration().sdpSemantics==="plan-b")||o.signalingState==="stable")return n})}var Pk=Object.freeze({__proto__:null,fixNegotiationNeeded:Ok,shimAddTrackRemoveTrack:Nk,shimAddTrackRemoveTrackWithNative:Ak,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(typeof t=="function"?e.navigator.mediaDevices.getDisplayMedia=function(n){return t(n).then(o=>{const s=n.video&&n.video.width,c=n.video&&n.video.height,d=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:o,maxFrameRate:d||3}},s&&(n.video.mandatory.maxWidth=s),c&&(n.video.mandatory.maxHeight=c),e.navigator.mediaDevices.getUserMedia(n)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:Ck,shimGetStats:bk,shimGetUserMedia:Tk,shimMediaStream:wk,shimOnTrack:Rk,shimPeerConnection:Aw,shimSenderReceiverGetStats:Ik});function Dk(e,t){const n=e&&e.navigator,o=e&&e.MediaStreamTrack;if(n.getUserMedia=function(s,c,d){bw("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(s).then(c,d)},!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const s=function(d,h,p){h in d&&!(p in d)&&(d[p]=d[h],delete d[h])},c=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(d){return typeof d=="object"&&typeof d.audio=="object"&&(d=JSON.parse(JSON.stringify(d)),s(d.audio,"autoGainControl","mozAutoGainControl"),s(d.audio,"noiseSuppression","mozNoiseSuppression")),c(d)},o&&o.prototype.getSettings){const d=o.prototype.getSettings;o.prototype.getSettings=function(){const h=d.apply(this,arguments);return s(h,"mozAutoGainControl","autoGainControl"),s(h,"mozNoiseSuppression","noiseSuppression"),h}}if(o&&o.prototype.applyConstraints){const d=o.prototype.applyConstraints;o.prototype.applyConstraints=function(h){return this.kind==="audio"&&typeof h=="object"&&(h=JSON.parse(JSON.stringify(h)),s(h,"autoGainControl","mozAutoGainControl"),s(h,"noiseSuppression","mozNoiseSuppression")),d.apply(this,[h])}}}}function kk(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Nw(e,t){if(typeof e!="object"||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(s){const c=e.RTCPeerConnection.prototype[s],d={[s](){return arguments[0]=new(s==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),c.apply(this,arguments)}};e.RTCPeerConnection.prototype[s]=d[s]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},o=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[s,c,d]=arguments;return o.apply(this,[s||null]).then(h=>{if(t.version<53&&!c)try{h.forEach(p=>{p.type=n[p.type]||p.type})}catch(p){if(p.name!=="TypeError")throw p;h.forEach((m,g)=>{h.set(g,Object.assign({},m,{type:n[m.type]||m.type}))})}return h}).then(c,d)}}function xk(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const o=t.apply(this,[]);return o.forEach(s=>s._pc=this),o});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const o=n.apply(this,arguments);return o._pc=this,o}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):ye.resolve(new Map)}}function Lk(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const n=t.apply(this,[]);return n.forEach(o=>o._pc=this),n}),Ql(e,"track",n=>(n.receiver._pc=n.srcElement,n)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function Mk(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(t){bw("removeStream","removeTrack"),this.getSenders().forEach(n=>{var o;n.track&&Ee(o=t.getTracks()).call(o,n.track)&&this.removeTrack(n)})})}function Uk(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function jk(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let n=arguments[1]&&arguments[1].sendEncodings;n===void 0&&(n=[]),n=[...n];const o=n.length>0;o&&n.forEach(c=>{if("rid"in c&&!/^[a-z0-9]{0,16}$/i.test(c.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in c&&!(parseFloat(c.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in c&&!(parseFloat(c.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const s=t.apply(this,arguments);if(o){const{sender:c}=s,d=c.getParameters();(!("encodings"in d)||d.encodings.length===1&&Object.keys(d.encodings[0]).length===0)&&(d.encodings=n,c.sendEncodings=n,this.setParametersPromises.push(c.setParameters(d).then(()=>{delete c.sendEncodings}).catch(()=>{delete c.sendEncodings})))}return s})}function Vk(e){if(typeof e!="object"||!e.RTCRtpSender)return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const n=t.apply(this,arguments);return"encodings"in n||(n.encodings=[].concat(this.sendEncodings||[{}])),n})}function Fk(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?ye.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function Bk(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?ye.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}var Wk=Object.freeze({__proto__:null,shimAddTransceiver:jk,shimCreateAnswer:Bk,shimCreateOffer:Fk,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){const o=new DOMException("getDisplayMedia without video constraints is undefined");return o.name="NotFoundError",o.code=8,ye.reject(o)}return n.video===!0?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n)})},shimGetParameters:Vk,shimGetUserMedia:Dk,shimOnTrack:kk,shimPeerConnection:Nw,shimRTCDataChannel:Uk,shimReceiverGetStats:Lk,shimRemoveStream:Mk,shimSenderGetStats:xk});function Hk(e){if(typeof e=="object"&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(n){var o;this._localStreams||(this._localStreams=[]),Ee(o=this._localStreams).call(o,n)||this._localStreams.push(n),n.getAudioTracks().forEach(s=>t.call(this,s,n)),n.getVideoTracks().forEach(s=>t.call(this,s,n))},e.RTCPeerConnection.prototype.addTrack=function(n){for(var o=arguments.length,s=new Array(o>1?o-1:0),c=1;c<o;c++)s[c-1]=arguments[c];return s&&s.forEach(d=>{var h;this._localStreams?Ee(h=this._localStreams).call(h,d)||this._localStreams.push(d):this._localStreams=[d]}),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(t){this._localStreams||(this._localStreams=[]);const n=this._localStreams.indexOf(t);if(n===-1)return;this._localStreams.splice(n,1);const o=t.getTracks();this.getSenders().forEach(s=>{Ee(o).call(o,s.track)&&this.removeTrack(s)})})}}function Gk(e){if(typeof e=="object"&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=o=>{o.streams.forEach(s=>{var c;if(this._remoteStreams||(this._remoteStreams=[]),Ee(c=this._remoteStreams).call(c,s))return;this._remoteStreams.push(s);const d=new Event("addstream");d.stream=s,this.dispatchEvent(d)})})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const n=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(o){o.streams.forEach(s=>{if(n._remoteStreams||(n._remoteStreams=[]),n._remoteStreams.indexOf(s)>=0)return;n._remoteStreams.push(s);const c=new Event("addstream");c.stream=s,n.dispatchEvent(c)})}),t.apply(n,arguments)}}}function zk(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,n=t.createOffer,o=t.createAnswer,s=t.setLocalDescription,c=t.setRemoteDescription,d=t.addIceCandidate;t.createOffer=function(p,m){const g=arguments.length>=2?arguments[2]:arguments[0],E=n.apply(this,[g]);return m?(E.then(p,m),ye.resolve()):E},t.createAnswer=function(p,m){const g=arguments.length>=2?arguments[2]:arguments[0],E=o.apply(this,[g]);return m?(E.then(p,m),ye.resolve()):E};let h=function(p,m,g){const E=s.apply(this,[p]);return g?(E.then(m,g),ye.resolve()):E};t.setLocalDescription=h,h=function(p,m,g){const E=c.apply(this,[p]);return g?(E.then(m,g),ye.resolve()):E},t.setRemoteDescription=h,h=function(p,m,g){const E=d.apply(this,[p]);return g?(E.then(m,g),ye.resolve()):E},t.addIceCandidate=h}function Kk(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const n=t.mediaDevices,o=n.getUserMedia.bind(n);t.mediaDevices.getUserMedia=s=>o(Yk(s))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=(function(n,o,s){t.mediaDevices.getUserMedia(n).then(o,s)}).bind(t))}function Yk(e){return e&&e.video!==void 0?Object.assign({},e,{video:vk(e.video)}):e}function qk(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(n,o){if(n&&n.iceServers){const s=[];for(let c=0;c<n.iceServers.length;c++){let d=n.iceServers[c];!d.hasOwnProperty("urls")&&d.hasOwnProperty("url")?(bw("RTCIceServer.url","RTCIceServer.urls"),d=JSON.parse(JSON.stringify(d)),d.urls=d.url,delete d.url,s.push(d)):s.push(n.iceServers[c])}n.iceServers=s}return new t(n,o)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function Xk(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function $k(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(n){if(n){n.offerToReceiveAudio!==void 0&&(n.offerToReceiveAudio=!!n.offerToReceiveAudio);const o=this.getTransceivers().find(c=>c.receiver.track.kind==="audio");n.offerToReceiveAudio===!1&&o?o.direction==="sendrecv"?o.setDirection?o.setDirection("sendonly"):o.direction="sendonly":o.direction==="recvonly"&&(o.setDirection?o.setDirection("inactive"):o.direction="inactive"):n.offerToReceiveAudio!==!0||o||this.addTransceiver("audio",{direction:"recvonly"}),n.offerToReceiveVideo!==void 0&&(n.offerToReceiveVideo=!!n.offerToReceiveVideo);const s=this.getTransceivers().find(c=>c.receiver.track.kind==="video");n.offerToReceiveVideo===!1&&s?s.direction==="sendrecv"?s.setDirection?s.setDirection("sendonly"):s.direction="sendonly":s.direction==="recvonly"&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive"):n.offerToReceiveVideo!==!0||s||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function Jk(e){typeof e!="object"||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var Qk=Object.freeze({__proto__:null,shimAudioContext:Jk,shimCallbacksAPI:zk,shimConstraints:Yk,shimCreateOfferLegacy:$k,shimGetUserMedia:Kk,shimLocalStreamsAPI:Hk,shimRTCIceServerUrls:qk,shimRemoteStreamsAPI:Gk,shimTrackEventTransceiver:Xk}),Zk=`	
\v\f\r                　\u2028\u2029\uFEFF`,jee=an,Vee=Gi,Ow=Zk,ex=D("".replace),Fee=RegExp("^["+Ow+"]+"),Bee=RegExp("(^|[^"+Ow+"])["+Ow+"]+$"),Pw=function(e){return function(t){var n=Vee(jee(t));return 1&e&&(n=ex(n,Fee,"")),2&e&&(n=ex(n,Bee,"$1")),n}},Wee={start:Pw(1),end:Pw(2),trim:Pw(3)},Hee=M1.PROPER,Gee=f,tx=Zk,zee=Wee.trim;Mt({target:"String",proto:!0,forced:function(e){return Gee(function(){return!!tx[e]()||"​᠎"[e]()!=="​᠎"||Hee&&tx[e].name!==e})}("trim")},{trim:function(){return zee(this)}});var Kee=Vo("String","trim"),Yee=O,qee=Kee,Dw=String.prototype,Xee=function(e){var t=e.trim;return typeof e=="string"||e===Dw||Yee(Dw,e)&&t===Dw.trim?qee:t},Hr=u(Xee),nx={exports:{}};(function(e){const t={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};t.localCName=t.generateIdentifier(),t.splitLines=function(n){return n.trim().split(`
`).map(o=>o.trim())},t.splitSections=function(n){return n.split(`
m=`).map((o,s)=>(s>0?"m="+o:o).trim()+`\r
`)},t.getDescription=function(n){const o=t.splitSections(n);return o&&o[0]},t.getMediaSections=function(n){const o=t.splitSections(n);return o.shift(),o},t.matchPrefix=function(n,o){return t.splitLines(n).filter(s=>s.indexOf(o)===0)},t.parseCandidate=function(n){let o;o=n.indexOf("a=candidate:")===0?n.substring(12).split(" "):n.substring(10).split(" ");const s={foundation:o[0],component:{1:"rtp",2:"rtcp"}[o[1]]||o[1],protocol:o[2].toLowerCase(),priority:parseInt(o[3],10),ip:o[4],address:o[4],port:parseInt(o[5],10),type:o[7]};for(let c=8;c<o.length;c+=2)switch(o[c]){case"raddr":s.relatedAddress=o[c+1];break;case"rport":s.relatedPort=parseInt(o[c+1],10);break;case"tcptype":s.tcpType=o[c+1];break;case"ufrag":s.ufrag=o[c+1],s.usernameFragment=o[c+1];break;default:s[o[c]]===void 0&&(s[o[c]]=o[c+1])}return s},t.writeCandidate=function(n){const o=[];o.push(n.foundation);const s=n.component;s==="rtp"?o.push(1):s==="rtcp"?o.push(2):o.push(s),o.push(n.protocol.toUpperCase()),o.push(n.priority),o.push(n.address||n.ip),o.push(n.port);const c=n.type;return o.push("typ"),o.push(c),c!=="host"&&n.relatedAddress&&n.relatedPort&&(o.push("raddr"),o.push(n.relatedAddress),o.push("rport"),o.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(o.push("tcptype"),o.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(o.push("ufrag"),o.push(n.usernameFragment||n.ufrag)),"candidate:"+o.join(" ")},t.parseIceOptions=function(n){return n.substring(14).split(" ")},t.parseRtpMap=function(n){let o=n.substring(9).split(" ");const s={payloadType:parseInt(o.shift(),10)};return o=o[0].split("/"),s.name=o[0],s.clockRate=parseInt(o[1],10),s.channels=o.length===3?parseInt(o[2],10):1,s.numChannels=s.channels,s},t.writeRtpMap=function(n){let o=n.payloadType;n.preferredPayloadType!==void 0&&(o=n.preferredPayloadType);const s=n.channels||n.numChannels||1;return"a=rtpmap:"+o+" "+n.name+"/"+n.clockRate+(s!==1?"/"+s:"")+`\r
`},t.parseExtmap=function(n){const o=n.substring(9).split(" ");return{id:parseInt(o[0],10),direction:o[0].indexOf("/")>0?o[0].split("/")[1]:"sendrecv",uri:o[1],attributes:o.slice(2).join(" ")}},t.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+(n.attributes?" "+n.attributes:"")+`\r
`},t.parseFmtp=function(n){const o={};let s;const c=n.substring(n.indexOf(" ")+1).split(";");for(let d=0;d<c.length;d++)s=c[d].trim().split("="),o[s[0].trim()]=s[1];return o},t.writeFmtp=function(n){let o="",s=n.payloadType;if(n.preferredPayloadType!==void 0&&(s=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){const c=[];Object.keys(n.parameters).forEach(d=>{n.parameters[d]!==void 0?c.push(d+"="+n.parameters[d]):c.push(d)}),o+="a=fmtp:"+s+" "+c.join(";")+`\r
`}return o},t.parseRtcpFb=function(n){const o=n.substring(n.indexOf(" ")+1).split(" ");return{type:o.shift(),parameter:o.join(" ")}},t.writeRtcpFb=function(n){let o="",s=n.payloadType;return n.preferredPayloadType!==void 0&&(s=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(c=>{o+="a=rtcp-fb:"+s+" "+c.type+(c.parameter&&c.parameter.length?" "+c.parameter:"")+`\r
`}),o},t.parseSsrcMedia=function(n){const o=n.indexOf(" "),s={ssrc:parseInt(n.substring(7,o),10)},c=n.indexOf(":",o);return c>-1?(s.attribute=n.substring(o+1,c),s.value=n.substring(c+1)):s.attribute=n.substring(o+1),s},t.parseSsrcGroup=function(n){const o=n.substring(13).split(" ");return{semantics:o.shift(),ssrcs:o.map(s=>parseInt(s,10))}},t.getMid=function(n){const o=t.matchPrefix(n,"a=mid:")[0];if(o)return o.substring(6)},t.parseFingerprint=function(n){const o=n.substring(14).split(" ");return{algorithm:o[0].toLowerCase(),value:o[1].toUpperCase()}},t.getDtlsParameters=function(n,o){return{role:"auto",fingerprints:t.matchPrefix(n+o,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(n,o){let s="a=setup:"+o+`\r
`;return n.fingerprints.forEach(c=>{s+="a=fingerprint:"+c.algorithm+" "+c.value+`\r
`}),s},t.parseCryptoLine=function(n){const o=n.substring(9).split(" ");return{tag:parseInt(o[0],10),cryptoSuite:o[1],keyParams:o[2],sessionParams:o.slice(3)}},t.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?t.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},t.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;const o=n.substring(7).split("|");return{keyMethod:"inline",keySalt:o[0],lifeTime:o[1],mkiValue:o[2]?o[2].split(":")[0]:void 0,mkiLength:o[2]?o[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},t.getCryptoParameters=function(n,o){return t.matchPrefix(n+o,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(n,o){const s=t.matchPrefix(n+o,"a=ice-ufrag:")[0],c=t.matchPrefix(n+o,"a=ice-pwd:")[0];return s&&c?{usernameFragment:s.substring(12),password:c.substring(10)}:null},t.writeIceParameters=function(n){let o="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(o+=`a=ice-lite\r
`),o},t.parseRtpParameters=function(n){const o={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},s=t.splitLines(n)[0].split(" ");o.profile=s[2];for(let d=3;d<s.length;d++){const h=s[d],p=t.matchPrefix(n,"a=rtpmap:"+h+" ")[0];if(p){const m=t.parseRtpMap(p),g=t.matchPrefix(n,"a=fmtp:"+h+" ");switch(m.parameters=g.length?t.parseFmtp(g[0]):{},m.rtcpFeedback=t.matchPrefix(n,"a=rtcp-fb:"+h+" ").map(t.parseRtcpFb),o.codecs.push(m),m.name.toUpperCase()){case"RED":case"ULPFEC":o.fecMechanisms.push(m.name.toUpperCase())}}}t.matchPrefix(n,"a=extmap:").forEach(d=>{o.headerExtensions.push(t.parseExtmap(d))});const c=t.matchPrefix(n,"a=rtcp-fb:* ").map(t.parseRtcpFb);return o.codecs.forEach(d=>{c.forEach(h=>{d.rtcpFeedback.find(p=>p.type===h.type&&p.parameter===h.parameter)||d.rtcpFeedback.push(h)})}),o},t.writeRtpDescription=function(n,o){let s="";s+="m="+n+" ",s+=o.codecs.length>0?"9":"0",s+=" "+(o.profile||"UDP/TLS/RTP/SAVPF")+" ",s+=o.codecs.map(d=>d.preferredPayloadType!==void 0?d.preferredPayloadType:d.payloadType).join(" ")+`\r
`,s+=`c=IN IP4 0.0.0.0\r
`,s+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,o.codecs.forEach(d=>{s+=t.writeRtpMap(d),s+=t.writeFmtp(d),s+=t.writeRtcpFb(d)});let c=0;return o.codecs.forEach(d=>{d.maxptime>c&&(c=d.maxptime)}),c>0&&(s+="a=maxptime:"+c+`\r
`),o.headerExtensions&&o.headerExtensions.forEach(d=>{s+=t.writeExtmap(d)}),s},t.parseRtpEncodingParameters=function(n){const o=[],s=t.parseRtpParameters(n),c=s.fecMechanisms.indexOf("RED")!==-1,d=s.fecMechanisms.indexOf("ULPFEC")!==-1,h=t.matchPrefix(n,"a=ssrc:").map(y=>t.parseSsrcMedia(y)).filter(y=>y.attribute==="cname"),p=h.length>0&&h[0].ssrc;let m;const g=t.matchPrefix(n,"a=ssrc-group:FID").map(y=>y.substring(17).split(" ").map(T=>parseInt(T,10)));g.length>0&&g[0].length>1&&g[0][0]===p&&(m=g[0][1]),s.codecs.forEach(y=>{if(y.name.toUpperCase()==="RTX"&&y.parameters.apt){let T={ssrc:p,codecPayloadType:parseInt(y.parameters.apt,10)};p&&m&&(T.rtx={ssrc:m}),o.push(T),c&&(T=JSON.parse(JSON.stringify(T)),T.fec={ssrc:p,mechanism:d?"red+ulpfec":"red"},o.push(T))}}),o.length===0&&p&&o.push({ssrc:p});let E=t.matchPrefix(n,"b=");return E.length&&(E=E[0].indexOf("b=TIAS:")===0?parseInt(E[0].substring(7),10):E[0].indexOf("b=AS:")===0?1e3*parseInt(E[0].substring(5),10)*.95-16e3:void 0,o.forEach(y=>{y.maxBitrate=E})),o},t.parseRtcpParameters=function(n){const o={},s=t.matchPrefix(n,"a=ssrc:").map(h=>t.parseSsrcMedia(h)).filter(h=>h.attribute==="cname")[0];s&&(o.cname=s.value,o.ssrc=s.ssrc);const c=t.matchPrefix(n,"a=rtcp-rsize");o.reducedSize=c.length>0,o.compound=c.length===0;const d=t.matchPrefix(n,"a=rtcp-mux");return o.mux=d.length>0,o},t.writeRtcpParameters=function(n){let o="";return n.reducedSize&&(o+=`a=rtcp-rsize\r
`),n.mux&&(o+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(o+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),o},t.parseMsid=function(n){let o;const s=t.matchPrefix(n,"a=msid:");if(s.length===1)return o=s[0].substring(7).split(" "),{stream:o[0],track:o[1]};const c=t.matchPrefix(n,"a=ssrc:").map(d=>t.parseSsrcMedia(d)).filter(d=>d.attribute==="msid");return c.length>0?(o=c[0].value.split(" "),{stream:o[0],track:o[1]}):void 0},t.parseSctpDescription=function(n){const o=t.parseMLine(n),s=t.matchPrefix(n,"a=max-message-size:");let c;s.length>0&&(c=parseInt(s[0].substring(19),10)),isNaN(c)&&(c=65536);const d=t.matchPrefix(n,"a=sctp-port:");if(d.length>0)return{port:parseInt(d[0].substring(12),10),protocol:o.fmt,maxMessageSize:c};const h=t.matchPrefix(n,"a=sctpmap:");if(h.length>0){const p=h[0].substring(10).split(" ");return{port:parseInt(p[0],10),protocol:p[1],maxMessageSize:c}}},t.writeSctpDescription=function(n,o){let s=[];return s=n.protocol!=="DTLS/SCTP"?["m="+n.kind+" 9 "+n.protocol+" "+o.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+o.port+`\r
`]:["m="+n.kind+" 9 "+n.protocol+" "+o.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+o.port+" "+o.protocol+` 65535\r
`],o.maxMessageSize!==void 0&&s.push("a=max-message-size:"+o.maxMessageSize+`\r
`),s.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(n,o,s){let c;const d=o!==void 0?o:2;return c=n||t.generateSessionId(),`v=0\r
o=`+(s||"thisisadapterortc")+" "+c+" "+d+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},t.getDirection=function(n,o){const s=t.splitLines(n);for(let c=0;c<s.length;c++)switch(s[c]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return s[c].substring(2)}return o?t.getDirection(o):"sendrecv"},t.getKind=function(n){return t.splitLines(n)[0].split(" ")[0].substring(2)},t.isRejected=function(n){return n.split(" ",2)[1]==="0"},t.parseMLine=function(n){const o=t.splitLines(n)[0].substring(2).split(" ");return{kind:o[0],port:parseInt(o[1],10),protocol:o[2],fmt:o.slice(3).join(" ")}},t.parseOLine=function(n){const o=t.matchPrefix(n,"o=")[0].substring(2).split(" ");return{username:o[0],sessionId:o[1],sessionVersion:parseInt(o[2],10),netType:o[3],addressType:o[4],address:o[5]}},t.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;const o=t.splitLines(n);for(let s=0;s<o.length;s++)if(o[s].length<2||o[s].charAt(1)!=="=")return!1;return!0},e.exports=t})(nx);var rx=nx.exports,Wu=u(rx),$ee=a({__proto__:null,default:Wu},[rx]);function B_(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(n){if(typeof n=="object"&&n.candidate&&n.candidate.indexOf("a=")===0&&((n=JSON.parse(JSON.stringify(n))).candidate=n.candidate.substr(2)),n.candidate&&n.candidate.length){const o=new t(n),s=Wu.parseCandidate(n.candidate),c=Object.assign(o,s);return c.toJSON=function(){return{candidate:c.candidate,sdpMid:c.sdpMid,sdpMLineIndex:c.sdpMLineIndex,usernameFragment:c.usernameFragment}},c}return new t(n)},e.RTCIceCandidate.prototype=t.prototype,Ql(e,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new e.RTCIceCandidate(n.candidate),writable:"false"}),n))}function kw(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||Ql(e,"icecandidate",t=>{if(t.candidate){const n=Wu.parseCandidate(t.candidate.candidate);n.type==="relay"&&(t.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return t})}function W_(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const n=function(h){if(!h||!h.sdp)return!1;const p=Wu.splitSections(h.sdp);return p.shift(),p.some(m=>{const g=Wu.parseMLine(m);return g&&g.kind==="application"&&g.protocol.indexOf("SCTP")!==-1})},o=function(h){const p=h.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(p===null||p.length<2)return-1;const m=parseInt(p[1],10);return m!=m?-1:m},s=function(h){let p=65536;return t.browser==="firefox"&&(p=t.version<57?h===-1?16384:2147483637:t.version<60?t.version===57?65535:65536:2147483637),p},c=function(h,p){let m=65536;t.browser==="firefox"&&t.version===57&&(m=65535);const g=Wu.matchPrefix(h.sdp,"a=max-message-size:");return g.length>0?m=parseInt(g[0].substr(19),10):t.browser==="firefox"&&p!==-1&&(m=2147483637),m},d=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,t.browser==="chrome"&&t.version>=76){const{sdpSemantics:h}=this.getConfiguration();h==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const h=o(arguments[0]),p=s(h),m=c(arguments[0],h);let g;g=p===0&&m===0?Number.POSITIVE_INFINITY:p===0||m===0?Math.max(p,m):Math.min(p,m);const E={};Object.defineProperty(E,"maxMessageSize",{get:()=>g}),this._sctp=E}return d.apply(this,arguments)}}function H_(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(o,s){const c=o.send;o.send=function(){const d=arguments[0],h=d.length||d.size||d.byteLength;if(o.readyState==="open"&&s.sctp&&h>s.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+s.sctp.maxMessageSize+" bytes)");return c.apply(o,arguments)}}const n=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const o=n.apply(this,arguments);return t(o,this),o},Ql(e,"datachannel",o=>(t(o.channel,o.target),o))}function xw(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{const o=t[n];t[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=s=>{const c=s.target;if(c._lastConnectionState!==c.connectionState){c._lastConnectionState=c.connectionState;const d=new Event("connectionstatechange",s);c.dispatchEvent(d)}return s},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),o.apply(this,arguments)}})}function Lw(e,t){if(!e.RTCPeerConnection||t.browser==="chrome"&&t.version>=71||t.browser==="safari"&&t.version>=605)return;const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(o){if(o&&o.sdp&&o.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const s=o.sdp.split(`
`).filter(c=>Hr(c).call(c)!=="a=extmap-allow-mixed").join(`
`);e.RTCSessionDescription&&o instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:o.type,sdp:s}):o.sdp=s}return n.apply(this,arguments)}}function G_(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.addIceCandidate;n&&n.length!==0&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(t.browser==="chrome"&&t.version<78||t.browser==="firefox"&&t.version<68||t.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?ye.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),ye.resolve())})}function z_(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.setLocalDescription;n&&n.length!==0&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let o=arguments[0]||{};if(typeof o!="object"||o.type&&o.sdp)return n.apply(this,arguments);if(o={type:o.type,sdp:o.sdp},!o.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":o.type="offer";break;default:o.type="answer"}return o.sdp||o.type!=="offer"&&o.type!=="answer"?n.apply(this,[o]):(o.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(s=>n.apply(this,[s]))})}var Jee=Object.freeze({__proto__:null,removeExtmapAllowMixed:Lw,shimAddIceCandidateNullOrEmpty:G_,shimConnectionState:xw,shimMaxMessageSize:W_,shimParameterlessSetLocalDescription:z_,shimRTCIceCandidate:B_,shimRTCIceCandidateRelayProtocol:kw,shimSendThrowTypeError:H_});(function(){let{window:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const n=_k,o=function(c){const d={browser:null,version:null};if(c===void 0||!c.navigator)return d.browser="Not a browser.",d;const{navigator:h}=c;if(h.mozGetUserMedia)d.browser="firefox",d.version=F_(h.userAgent,/Firefox\/(\d+)\./,1);else if(h.webkitGetUserMedia||c.isSecureContext===!1&&c.webkitRTCPeerConnection)d.browser="chrome",d.version=F_(h.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!c.RTCPeerConnection||!h.userAgent.match(/AppleWebKit\/(\d+)\./))return d.browser="Not a supported browser.",d;d.browser="safari",d.version=F_(h.userAgent,/AppleWebKit\/(\d+)\./,1),d.supportsUnifiedPlan=c.RTCRtpTransceiver&&"currentDirection"in c.RTCRtpTransceiver.prototype}return d}(e),s={browserDetails:o,commonShim:Jee,extractVersion:F_,disableLog:Mee,disableWarnings:Uee,sdp:$ee};switch(o.browser){case"chrome":if(!Pk||!Aw||!t.shimChrome)return n("Chrome shim is not included in this adapter release."),s;if(o.version===null)return n("Chrome shim can not determine version, not shimming."),s;n("adapter.js shimming chrome."),s.browserShim=Pk,G_(e,o),z_(e),Tk(e,o),wk(e),Aw(e,o),Rk(e),Nk(e,o),Ck(e),bk(e),Ik(e),Ok(e,o),B_(e),kw(e),xw(e),W_(e,o),H_(e),Lw(e,o);break;case"firefox":if(!Wk||!Nw||!t.shimFirefox)return n("Firefox shim is not included in this adapter release."),s;n("adapter.js shimming firefox."),s.browserShim=Wk,G_(e,o),z_(e),Dk(e,o),Nw(e,o),kk(e),Mk(e),xk(e),Lk(e),Uk(e),jk(e),Vk(e),Fk(e),Bk(e),B_(e),xw(e),W_(e,o),H_(e);break;case"safari":if(!Qk||!t.shimSafari)return n("Safari shim is not included in this adapter release."),s;n("adapter.js shimming safari."),s.browserShim=Qk,G_(e,o),z_(e),qk(e),$k(e),zk(e),Hk(e),Gk(e),Xk(e),Kk(e),Jk(e),B_(e),kw(e),W_(e,o),H_(e),Lw(e,o);break;default:n("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var Mw=F;Mt({global:!0,forced:Mw.globalThis!==Mw},{globalThis:Mw});var ix=u(F),Uw={exports:{}};(function(e,t){(function(n,o){var s="function",c="undefined",d="object",h="string",p="major",m="model",g="name",E="type",y="vendor",T="version",P="architecture",I="console",A="mobile",M="tablet",U="smarttv",Y="wearable",Q="embedded",J="Amazon",X="Apple",ne="ASUS",oe="BlackBerry",me="Browser",we="Chrome",ut="Firefox",rt="Google",qe="Huawei",tn="LG",zt="Microsoft",di="Motorola",se="Opera",he="Samsung",Ie="Sharp",ae="Sony",b="Xiaomi",K="Zebra",q="Facebook",ue="Chromium OS",Ze="Mac OS",Qt=" Browser",Hn=function(Vn){for(var Gn={},on=0;on<Vn.length;on++)Gn[Vn[on].toUpperCase()]=Vn[on];return Gn},yo=function(Vn,Gn){return typeof Vn===h&&as(Gn).indexOf(as(Vn))!==-1},as=function(Vn){return Vn.toLowerCase()},Rm=function(Vn,Gn){if(typeof Vn===h)return Vn=Vn.replace(/^\s\s*/,""),typeof Gn===c?Vn:Vn.substring(0,500)},bd=function(Vn,Gn){for(var on,Si,Ds,In,rc,St,ks=0;ks<Gn.length&&!rc;){var Id=Gn[ks],Ta=Gn[ks+1];for(on=Si=0;on<Id.length&&!rc&&Id[on];)if(rc=Id[on++].exec(Vn))for(Ds=0;Ds<Ta.length;Ds++)St=rc[++Si],typeof(In=Ta[Ds])===d&&In.length>0?In.length===2?typeof In[1]==s?this[In[0]]=In[1].call(this,St):this[In[0]]=In[1]:In.length===3?typeof In[1]!==s||In[1].exec&&In[1].test?this[In[0]]=St?St.replace(In[1],In[2]):o:this[In[0]]=St?In[1].call(this,St,In[2]):o:In.length===4&&(this[In[0]]=St?In[3].call(this,St.replace(In[1],In[2])):o):this[In]=St||o;ks+=2}},Lh=function(Vn,Gn){for(var on in Gn)if(typeof Gn[on]===d&&Gn[on].length>0){for(var Si=0;Si<Gn[on].length;Si++)if(yo(Gn[on][Si],Vn))return on==="?"?o:on}else if(yo(Gn[on],Vn))return on==="?"?o:on;return Gn.hasOwnProperty("*")?Gn["*"]:Vn},jv={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},Vv={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[T,[g,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[T,[g,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[g,T],[/opios[\/ ]+([\w\.]+)/i],[T,[g,se+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[T,[g,se+" GX"]],[/\bopr\/([\w\.]+)/i],[T,[g,se]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[T,[g,"Baidu"]],[/\b(?:mxbrowser|mxios|myie2)\/?([-\w\.]*)\b/i],[T,[g,"Maxthon"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim(?:browser|boat|jet))[\/ ]?([\d\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio|(?=comodo_)?dragon)\/([-\w\.]+)/i,/(heytap|ovi|115)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[g,T],[/quark(?:pc)?\/([-\w\.]+)/i],[T,[g,"Quark"]],[/\bddg\/([\w\.]+)/i],[T,[g,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[T,[g,"UC"+me]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[T,[g,"WeChat"]],[/konqueror\/([\w\.]+)/i],[T,[g,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[T,[g,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[T,[g,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[T,[g,"Smart Lenovo "+me]],[/(avast|avg)\/([\w\.]+)/i],[[g,/(.+)/,"$1 Secure "+me],T],[/\bfocus\/([\w\.]+)/i],[T,[g,ut+" Focus"]],[/\bopt\/([\w\.]+)/i],[T,[g,se+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[T,[g,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[T,[g,"Dolphin"]],[/coast\/([\w\.]+)/i],[T,[g,se+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[T,[g,"MIUI"+Qt]],[/fxios\/([\w\.-]+)/i],[T,[g,ut]],[/\bqihoobrowser\/?([\w\.]*)/i],[T,[g,"360"]],[/\b(qq)\/([\w\.]+)/i],[[g,/(.+)/,"$1Browser"],T],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[g,/(.+)/,"$1"+Qt],T],[/samsungbrowser\/([\w\.]+)/i],[T,[g,he+" Internet"]],[/metasr[\/ ]?([\d\.]+)/i],[T,[g,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[g,"Sogou Mobile"],T],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345(?=browser|chrome|explorer))\w*[\/ ]?v?([\w\.]+)/i],[g,T],[/(lbbrowser|rekonq)/i,/\[(linkedin)app\]/i],[g],[/ome\/([\w\.]+) \w* ?(iron) saf/i,/ome\/([\w\.]+).+qihu (360)[es]e/i],[T,g],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[g,q],T],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[g,T],[/\bgsa\/([\w\.]+) .*safari\//i],[T,[g,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[T,[g,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[T,[g,we+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[g,we+" WebView"],T],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[T,[g,"Android "+me]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[g,T],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[T,[g,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[T,g],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[g,[T,Lh,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[g,T],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[g,"Netscape"],T],[/(wolvic|librewolf)\/([\w\.]+)/i],[g,T],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[T,[g,ut+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[g,[T,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[g,[T,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[P,"amd64"]],[/(ia32(?=;))/i],[[P,as]],[/((?:i[346]|x)86)[;\)]/i],[[P,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[P,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[P,"armhf"]],[/windows (ce|mobile); ppc;/i],[[P,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[P,/ower/,"",as]],[/(sun4\w)[;\)]/i],[[P,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[P,as]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[m,[y,he],[E,M]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[m,[y,he],[E,A]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[m,[y,X],[E,A]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[m,[y,X],[E,M]],[/(macintosh);/i],[m,[y,X]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[m,[y,Ie],[E,A]],[/(?:honor)([-\w ]+)[;\)]/i],[m,[y,"Honor"],[E,A]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[m,[y,qe],[E,M]],[/(?:huawei)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[m,[y,qe],[E,A]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i],[[m,/_/g," "],[y,b],[E,A]],[/oid[^\)]+; (2\d{4}(283|rpbf)[cgl])( bui|\))/i,/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[m,/_/g," "],[y,b],[E,M]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[m,[y,"OPPO"],[E,A]],[/\b(opd2\d{3}a?) bui/i],[m,[y,"OPPO"],[E,M]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[m,[y,"Vivo"],[E,A]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[m,[y,"Realme"],[E,A]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[m,[y,di],[E,A]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[m,[y,di],[E,M]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[m,[y,tn],[E,M]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[m,[y,tn],[E,A]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[m,[y,"Lenovo"],[E,M]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[m,/_/g," "],[y,"Nokia"],[E,A]],[/(pixel c)\b/i],[m,[y,rt],[E,M]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[m,[y,rt],[E,A]],[/droid.+; (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[m,[y,ae],[E,A]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[m,"Xperia Tablet"],[y,ae],[E,M]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[m,[y,"OnePlus"],[E,A]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[m,[y,J],[E,M]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[m,/(.+)/g,"Fire Phone $1"],[y,J],[E,A]],[/(playbook);[-\w\),; ]+(rim)/i],[m,y,[E,M]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[m,[y,oe],[E,A]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[m,[y,ne],[E,M]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[m,[y,ne],[E,A]],[/(nexus 9)/i],[m,[y,"HTC"],[E,M]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[y,[m,/_/g," "],[E,A]],[/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])\w*(\)| bui)/i],[m,[y,"TCL"],[E,M]],[/(itel) ((\w+))/i],[[y,as],m,[E,Lh,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[m,[y,"Acer"],[E,M]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[m,[y,"Meizu"],[E,A]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[m,[y,"Ulefone"],[E,A]],[/; (energy ?\w+)(?: bui|\))/i,/; energizer ([\w ]+)(?: bui|\))/i],[m,[y,"Energizer"],[E,A]],[/; cat (b35);/i,/; (b15q?|s22 flip|s48c|s62 pro)(?: bui|\))/i],[m,[y,"Cat"],[E,A]],[/((?:new )?andromax[\w- ]+)(?: bui|\))/i],[m,[y,"Smartfren"],[E,A]],[/droid.+; (a(?:015|06[35]|142p?))/i],[m,[y,"Nothing"],[E,A]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron|infinix|tecno|micromax|advan)[-_ ]?([-\w]*)/i,/; (imo) ((?!tab)[\w ]+?)(?: bui|\))/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[y,m,[E,A]],[/(imo) (tab \w+)/i,/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[y,m,[E,M]],[/(surface duo)/i],[m,[y,zt],[E,M]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[m,[y,"Fairphone"],[E,A]],[/(u304aa)/i],[m,[y,"AT&T"],[E,A]],[/\bsie-(\w*)/i],[m,[y,"Siemens"],[E,A]],[/\b(rct\w+) b/i],[m,[y,"RCA"],[E,M]],[/\b(venue[\d ]{2,7}) b/i],[m,[y,"Dell"],[E,M]],[/\b(q(?:mv|ta)\w+) b/i],[m,[y,"Verizon"],[E,M]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[m,[y,"Barnes & Noble"],[E,M]],[/\b(tm\d{3}\w+) b/i],[m,[y,"NuVision"],[E,M]],[/\b(k88) b/i],[m,[y,"ZTE"],[E,M]],[/\b(nx\d{3}j) b/i],[m,[y,"ZTE"],[E,A]],[/\b(gen\d{3}) b.+49h/i],[m,[y,"Swiss"],[E,A]],[/\b(zur\d{3}) b/i],[m,[y,"Swiss"],[E,M]],[/\b((zeki)?tb.*\b) b/i],[m,[y,"Zeki"],[E,M]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[y,"Dragon Touch"],m,[E,M]],[/\b(ns-?\w{0,9}) b/i],[m,[y,"Insignia"],[E,M]],[/\b((nxa|next)-?\w{0,9}) b/i],[m,[y,"NextBook"],[E,M]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[y,"Voice"],m,[E,A]],[/\b(lvtel\-)?(v1[12]) b/i],[[y,"LvTel"],m,[E,A]],[/\b(ph-1) /i],[m,[y,"Essential"],[E,A]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[m,[y,"Envizen"],[E,M]],[/\b(trio[-\w\. ]+) b/i],[m,[y,"MachSpeed"],[E,M]],[/\btu_(1491) b/i],[m,[y,"Rotor"],[E,M]],[/(shield[\w ]+) b/i],[m,[y,"Nvidia"],[E,M]],[/(sprint) (\w+)/i],[y,m,[E,A]],[/(kin\.[onetw]{3})/i],[[m,/\./g," "],[y,zt],[E,A]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[m,[y,K],[E,M]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[m,[y,K],[E,A]],[/smart-tv.+(samsung)/i],[y,[E,U]],[/hbbtv.+maple;(\d+)/i],[[m,/^/,"SmartTV"],[y,he],[E,U]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[y,tn],[E,U]],[/(apple) ?tv/i],[y,[m,X+" TV"],[E,U]],[/crkey/i],[[m,we+"cast"],[y,rt],[E,U]],[/droid.+aft(\w+)( bui|\))/i],[m,[y,J],[E,U]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[m,[y,Ie],[E,U]],[/(bravia[\w ]+)( bui|\))/i],[m,[y,ae],[E,U]],[/(mitv-\w{5}) bui/i],[m,[y,b],[E,U]],[/Hbbtv.*(technisat) (.*);/i],[y,m,[E,U]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[y,Rm],[m,Rm],[E,U]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[E,U]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[y,m,[E,I]],[/droid.+; (shield) bui/i],[m,[y,"Nvidia"],[E,I]],[/(playstation [345portablevi]+)/i],[m,[y,ae],[E,I]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[m,[y,zt],[E,I]],[/\b(sm-[lr]\d\d[05][fnuw]?s?)\b/i],[m,[y,he],[E,Y]],[/((pebble))app/i],[y,m,[E,Y]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[m,[y,X],[E,Y]],[/droid.+; (glass) \d/i],[m,[y,rt],[E,Y]],[/droid.+; (wt63?0{2,3})\)/i],[m,[y,K],[E,Y]],[/droid.+; (glass) \d/i],[m,[y,rt],[E,Y]],[/(pico) (4|neo3(?: link|pro)?)/i],[y,m,[E,Y]],[/; (quest( \d| pro)?)/i],[m,[y,q],[E,Y]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[y,[E,Q]],[/(aeobc)\b/i],[m,[y,J],[E,Q]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[m,[E,A]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[m,[E,M]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[E,M]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[E,A]],[/(android[-\w\. ]{0,9});.+buil/i],[m,[y,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[T,[g,"EdgeHTML"]],[/(arkweb)\/([\w\.]+)/i],[g,T],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[T,[g,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna|servo)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[g,T],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[T,g]],os:[[/microsoft (windows) (vista|xp)/i],[g,T],[/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i],[g,[T,Lh,jv]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[T,Lh,jv],[g,"Windows"]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[T,/_/g,"."],[g,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[g,Ze],[T,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[T,g],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish|openharmony)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[g,T],[/\(bb(10);/i],[T,[g,oe]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[T,[g,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[T,[g,ut+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[T,[g,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[T,[g,"watchOS"]],[/crkey\/([\d\.]+)/i],[T,[g,we+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[g,ue],T],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[g,T],[/(sunos) ?([\w\.\d]*)/i],[[g,"Solaris"],T],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[g,T]]},So=function(Vn,Gn){if(typeof Vn===d&&(Gn=Vn,Vn=o),!(this instanceof So))return new So(Vn,Gn).getResult();var on=typeof n!==c&&n.navigator?n.navigator:o,Si=Vn||(on&&on.userAgent?on.userAgent:""),Ds=on&&on.userAgentData?on.userAgentData:o,In=Gn?function(St,ks){var Id={};for(var Ta in St)ks[Ta]&&ks[Ta].length%2==0?Id[Ta]=ks[Ta].concat(St[Ta]):Id[Ta]=St[Ta];return Id}(Vv,Gn):Vv,rc=on&&on.userAgent==Si;return this.getBrowser=function(){var St={};return St[g]=o,St[T]=o,bd.call(St,Si,In.browser),St[p]=function(ks){return typeof ks===h?ks.replace(/[^\d\.]/g,"").split(".")[0]:o}(St[T]),rc&&on&&on.brave&&typeof on.brave.isBrave==s&&(St[g]="Brave"),St},this.getCPU=function(){var St={};return St[P]=o,bd.call(St,Si,In.cpu),St},this.getDevice=function(){var St={};return St[y]=o,St[m]=o,St[E]=o,bd.call(St,Si,In.device),rc&&!St[E]&&Ds&&Ds.mobile&&(St[E]=A),rc&&St[m]=="Macintosh"&&on&&typeof on.standalone!==c&&on.maxTouchPoints&&on.maxTouchPoints>2&&(St[m]="iPad",St[E]=M),St},this.getEngine=function(){var St={};return St[g]=o,St[T]=o,bd.call(St,Si,In.engine),St},this.getOS=function(){var St={};return St[g]=o,St[T]=o,bd.call(St,Si,In.os),rc&&!St[g]&&Ds&&Ds.platform&&Ds.platform!="Unknown"&&(St[g]=Ds.platform.replace(/chrome os/i,ue).replace(/macos/i,Ze)),St},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return Si},this.setUA=function(St){return Si=typeof St===h&&St.length>500?Rm(St,500):St,this},this.setUA(Si),this};So.VERSION="0.7.40",So.BROWSER=Hn([g,T,p]),So.CPU=Hn([P]),So.DEVICE=Hn([m,y,E,I,A,U,M,Y,Q]),So.ENGINE=So.OS=Hn([g,T]),e.exports&&(t=e.exports=So),t.UAParser=So;var nc=typeof n!==c&&(n.jQuery||n.Zepto);if(nc&&!nc.ua){var Fv=new So;nc.ua=Fv.getResult(),nc.ua.get=function(){return Fv.getUA()},nc.ua.set=function(Vn){Fv.setUA(Vn);var Gn=Fv.getResult();for(var on in Gn)nc.ua[on]=Gn[on]}}})(typeof window=="object"?window:l)})(Uw,Uw.exports);var Qee=u(Uw.exports),ox=E_.clear;Mt({global:!0,bind:!0,enumerable:!0,forced:F.clearImmediate!==ox},{clearImmediate:ox});var sx=F,Zee=z,ete=fe,tte=G0,nte=mi,rte=Rc,ite=Kl,ote=sx.Function,ste=/MSIE .\./.test(nte)||tte==="BUN"&&function(){var e=sx.Bun.version.split(".");return e.length<3||e[0]==="0"&&(e[1]<3||e[1]==="3"&&e[2]==="0")}(),ate=Mt,ax=F,cx=E_.set,cte=function(e,t){var n=1;return ste?function(o,s){var c=ite(arguments.length,1)>n,d=ete(o)?o:ote(o),h=c?rte(arguments,n):[],p=c?function(){Zee(d,this,h)}:d;return e(p)}:e},lx=ax.setImmediate?cte(cx):cx;ate({global:!0,bind:!0,enumerable:!0,forced:ax.setImmediate!==lx},{setImmediate:lx});var dx=u(wn.setImmediate),lte=F,dte=SP,ute=Hi,hte=Kl,pte=be;Mt({global:!0,enumerable:!0,dontCallGetSet:!0,forced:f(function(){return pte&&Object.getOwnPropertyDescriptor(lte,"queueMicrotask").value.length!==1})},{queueMicrotask:function(e){hte(arguments.length,1),dte(ute(e))}});var ux=u(wn.queueMicrotask);function hx(e,t){return function(){return e.apply(t,arguments)}}const{toString:fte}=Object.prototype,{getPrototypeOf:jw}=Object,{iterator:K_,toStringTag:px}=Symbol,Y_=(Vw=Object.create(null),e=>{const t=fte.call(e);return Vw[t]||(Vw[t]=t.slice(8,-1).toLowerCase())});var Vw;const vs=e=>(e=e.toLowerCase(),t=>Y_(t)===e),q_=e=>t=>typeof t===e,{isArray:Hu}=Array,Ef=q_("undefined"),fx=vs("ArrayBuffer"),mte=q_("string"),zi=q_("function"),mx=q_("number"),X_=e=>e!==null&&typeof e=="object",$_=e=>{if(Y_(e)!=="object")return!1;const t=jw(e);return!(t!==null&&t!==Object.prototype&&Object.getPrototypeOf(t)!==null||px in e||K_ in e)},gte=vs("Date"),_te=vs("File"),Ete=vs("Blob"),vte=vs("FileList"),yte=vs("URLSearchParams"),[Ste,Tte,wte,Rte]=["ReadableStream","Request","Response","Headers"].map(vs);function vf(e,t){let n,o,{allOwnKeys:s=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(e!=null)if(typeof e!="object"&&(e=[e]),Hu(e))for(n=0,o=e.length;n<o;n++)t.call(null,e[n],n,e);else{const c=s?Object.getOwnPropertyNames(e):Object.keys(e),d=c.length;let h;for(n=0;n<d;n++)h=c[n],t.call(null,e[h],h,e)}}function gx(e,t){t=t.toLowerCase();const n=Object.keys(e);let o,s=n.length;for(;s-- >0;)if(o=n[s],t===o.toLowerCase())return o;return null}const Zl=ix!==void 0?ix:typeof self<"u"?self:typeof window<"u"?window:Wv,_x=e=>!Ef(e)&&e!==Zl,Cte=(Fw=typeof Uint8Array<"u"&&jw(Uint8Array),e=>Fw&&e instanceof Fw);var Fw;const bte=vs("HTMLFormElement"),Ex=(e=>{let{hasOwnProperty:t}=e;return(n,o)=>t.call(n,o)})(Object.prototype),Ite=vs("RegExp"),vx=(e,t)=>{const n=Object.getOwnPropertyDescriptors(e),o={};vf(n,(s,c)=>{let d;(d=t(s,c,e))!==!1&&(o[c]=d||s)}),Object.defineProperties(e,o)},Ate=vs("AsyncFunction"),yx=(Sx=typeof dx=="function",Tx=zi(Zl.postMessage),Sx?dx:Tx?(Bw="axios@".concat(Math.random()),J_=[],Zl.addEventListener("message",e=>{let{source:t,data:n}=e;t===Zl&&n===Bw&&J_.length&&J_.shift()()},!1),e=>{J_.push(e),Zl.postMessage(Bw,"*")}):e=>setTimeout(e));var Sx,Tx,Bw,J_;const Nte=ux!==void 0?ux.bind(Zl):typeof process<"u"&&process.nextTick||yx;var ve={isArray:Hu,isArrayBuffer:fx,isBuffer:function(e){return e!==null&&!Ef(e)&&e.constructor!==null&&!Ef(e.constructor)&&zi(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>{let t;return e&&(typeof FormData=="function"&&e instanceof FormData||zi(e.append)&&((t=Y_(e))==="formdata"||t==="object"&&zi(e.toString)&&e.toString()==="[object FormData]"))},isArrayBufferView:function(e){let t;return t=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&fx(e.buffer),t},isString:mte,isNumber:mx,isBoolean:e=>e===!0||e===!1,isObject:X_,isPlainObject:$_,isReadableStream:Ste,isRequest:Tte,isResponse:wte,isHeaders:Rte,isUndefined:Ef,isDate:gte,isFile:_te,isBlob:Ete,isRegExp:Ite,isFunction:zi,isStream:e=>X_(e)&&zi(e.pipe),isURLSearchParams:yte,isTypedArray:Cte,isFileList:vte,forEach:vf,merge:function e(){const{caseless:t}=_x(this)&&this||{},n={},o=(s,c)=>{const d=t&&gx(n,c)||c;$_(n[d])&&$_(s)?n[d]=e(n[d],s):$_(s)?n[d]=e({},s):Hu(s)?n[d]=s.slice():n[d]=s};for(let s=0,c=arguments.length;s<c;s++)arguments[s]&&vf(arguments[s],o);return n},extend:function(e,t,n){let{allOwnKeys:o}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return vf(t,(s,c)=>{n&&zi(s)?e[c]=hx(s,n):e[c]=s},{allOwnKeys:o}),e},trim:e=>Hr(e)?Hr(e).call(e):e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),inherits:(e,t,n,o)=>{e.prototype=Object.create(t.prototype,o),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),n&&Object.assign(e.prototype,n)},toFlatObject:(e,t,n,o)=>{let s,c,d;const h={};if(t=t||{},e==null)return t;do{for(s=Object.getOwnPropertyNames(e),c=s.length;c-- >0;)d=s[c],o&&!o(d,e,t)||h[d]||(t[d]=e[d],h[d]=!0);e=n!==!1&&jw(e)}while(e&&(!n||n(e,t))&&e!==Object.prototype);return t},kindOf:Y_,kindOfTest:vs,endsWith:(e,t,n)=>{e=String(e),(n===void 0||n>e.length)&&(n=e.length),n-=t.length;const o=e.indexOf(t,n);return o!==-1&&o===n},toArray:e=>{if(!e)return null;if(Hu(e))return e;let t=e.length;if(!mx(t))return null;const n=new Array(t);for(;t-- >0;)n[t]=e[t];return n},forEachEntry:(e,t)=>{const n=(e&&e[K_]).call(e);let o;for(;(o=n.next())&&!o.done;){const s=o.value;t.call(e,s[0],s[1])}},matchAll:(e,t)=>{let n;const o=[];for(;(n=e.exec(t))!==null;)o.push(n);return o},isHTMLForm:bte,hasOwnProperty:Ex,hasOwnProp:Ex,reduceDescriptors:vx,freezeMethods:e=>{vx(e,(t,n)=>{if(zi(e)&&["arguments","caller","callee"].indexOf(n)!==-1)return!1;const o=e[n];zi(o)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")}))})},toObjectSet:(e,t)=>{const n={},o=s=>{s.forEach(c=>{n[c]=!0})};return Hu(e)?o(e):o(String(e).split(t)),n},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,n,o){return n.toUpperCase()+o}),noop:()=>{},toFiniteNumber:(e,t)=>e!=null&&Number.isFinite(e=+e)?e:t,findKey:gx,global:Zl,isContextDefined:_x,isSpecCompliantForm:function(e){return!!(e&&zi(e.append)&&e[px]==="FormData"&&e[K_])},toJSONObject:e=>{const t=new Array(10),n=(o,s)=>{if(X_(o)){if(t.indexOf(o)>=0)return;if(!("toJSON"in o)){t[s]=o;const c=Hu(o)?[]:{};return vf(o,(d,h)=>{const p=n(d,s+1);!Ef(p)&&(c[h]=p)}),t[s]=void 0,c}}return o};return n(e,0)},isAsyncFn:Ate,isThenable:e=>e&&(X_(e)||zi(e))&&zi(e.then)&&zi(e.catch),setImmediate:yx,asap:Nte,isIterable:e=>e!=null&&zi(e[K_])};function Wt(e,t,n,o,s){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",t&&(this.code=t),n&&(this.config=n),o&&(this.request=o),s&&(this.response=s,this.status=s.status?s.status:null)}ve.inherits(Wt,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:ve.toJSONObject(this.config),code:this.code,status:this.status}}});const wx=Wt.prototype,Rx={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{Rx[e]={value:e}}),Object.defineProperties(Wt,Rx),Object.defineProperty(wx,"isAxiosError",{value:!0}),Wt.from=(e,t,n,o,s,c)=>{const d=Object.create(wx);return ve.toFlatObject(e,d,function(h){return h!==Error.prototype},h=>h!=="isAxiosError"),Wt.call(d,e.message,t,n,o,s),d.cause=e,d.name=e.name,c&&Object.assign(d,c),d};function Ww(e){return ve.isPlainObject(e)||ve.isArray(e)}function Cx(e){return ve.endsWith(e,"[]")?e.slice(0,-2):e}function bx(e,t,n){return e?e.concat(t).map(function(o,s){return o=Cx(o),!n&&s?"["+o+"]":o}).join(n?".":""):t}const Ote=ve.toFlatObject(ve,{},null,function(e){return/^is[A-Z]/.test(e)});function Q_(e,t,n){if(!ve.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;const o=(n=ve.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(y,T){return!ve.isUndefined(T[y])})).metaTokens,s=n.visitor||m,c=n.dots,d=n.indexes,h=(n.Blob||typeof Blob<"u"&&Blob)&&ve.isSpecCompliantForm(t);if(!ve.isFunction(s))throw new TypeError("visitor must be a function");function p(y){if(y===null)return"";if(ve.isDate(y))return y.toISOString();if(!h&&ve.isBlob(y))throw new Wt("Blob is not supported. Use a Buffer instead.");return ve.isArrayBuffer(y)||ve.isTypedArray(y)?h&&typeof Blob=="function"?new Blob([y]):Buffer.from(y):y}function m(y,T,P){let I=y;if(y&&!P&&typeof y=="object"){if(ve.endsWith(T,"{}"))T=o?T:T.slice(0,-2),y=JSON.stringify(y);else if(ve.isArray(y)&&function(A){return ve.isArray(A)&&!A.some(Ww)}(y)||(ve.isFileList(y)||ve.endsWith(T,"[]"))&&(I=ve.toArray(y)))return T=Cx(T),I.forEach(function(A,M){!ve.isUndefined(A)&&A!==null&&t.append(d===!0?bx([T],M,c):d===null?T:T+"[]",p(A))}),!1}return!!Ww(y)||(t.append(bx(P,T,c),p(y)),!1)}const g=[],E=Object.assign(Ote,{defaultVisitor:m,convertValue:p,isVisitable:Ww});if(!ve.isObject(e))throw new TypeError("data must be an object");return function y(T,P){if(!ve.isUndefined(T)){if(g.indexOf(T)!==-1)throw Error("Circular reference detected in "+P.join("."));g.push(T),ve.forEach(T,function(I,A){(!(ve.isUndefined(I)||I===null)&&s.call(t,I,ve.isString(A)?Hr(A).call(A):A,P,E))===!0&&y(I,P?P.concat(A):[A])}),g.pop()}}(e),t}function Ix(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(n){return t[n]})}function Hw(e,t){this._pairs=[],e&&Q_(e,this,t)}const Ax=Hw.prototype;function Pte(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Nx(e,t,n){if(!t)return e;const o=n&&n.encode||Pte;ve.isFunction(n)&&(n={serialize:n});const s=n&&n.serialize;let c;if(c=s?s(t,n):ve.isURLSearchParams(t)?t.toString():new Hw(t,n).toString(o),c){const d=e.indexOf("#");d!==-1&&(e=e.slice(0,d)),e+=(e.indexOf("?")===-1?"?":"&")+c}return e}Ax.append=function(e,t){this._pairs.push([e,t])},Ax.toString=function(e){const t=e?function(n){return e.call(this,n,Ix)}:Ix;return this._pairs.map(function(n){return t(n[0])+"="+t(n[1])},"").join("&")};var Ox=class{constructor(){this.handlers=[]}use(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){ve.forEach(this.handlers,function(t){t!==null&&e(t)})}},Px={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Dx={exports:{}},Dte=Mt,kte=be,kx=jo.f;Dte({target:"Object",stat:!0,forced:Object.defineProperty!==kx,sham:!kte},{defineProperty:kx});var xx=wn.Object,xte=Dx.exports=function(e,t,n){return xx.defineProperty(e,t,n)};xx.defineProperty.sham&&(xte.sham=!0);var Lx=u(Dx.exports),Lte=TypeError,Mx=Qp,Mte=__,Ute=xr,jte=Fn("species"),Ux=Array,Vte=function(e){var t;return Mx(e)&&(t=e.constructor,(Mte(t)&&(t===Ux||Mx(t.prototype))||Ute(t)&&(t=t[jte])===null)&&(t=void 0)),t===void 0?Ux:t},jx=function(e,t){return new(Vte(e))(t===0?0:t)},Fte=f,Bte=ja,Wte=Fn("species"),Vx=function(e){return Bte>=51||!Fte(function(){var t=[];return(t.constructor={})[Wte]=function(){return{foo:1}},t[e](Boolean).foo!==1})},Hte=Mt,Gte=f,zte=Qp,Kte=xr,Yte=ea,qte=Sc,Fx=function(e){if(e>9007199254740991)throw Lte("Maximum allowed index exceeded");return e},Bx=iw,Xte=jx,$te=Vx,Jte=ja,Wx=Fn("isConcatSpreadable"),Qte=Jte>=51||!Gte(function(){var e=[];return e[Wx]=!1,e.concat()[0]!==e}),Zte=function(e){if(!Kte(e))return!1;var t=e[Wx];return t!==void 0?!!t:zte(e)};Hte({target:"Array",proto:!0,arity:1,forced:!Qte||!$te("concat")},{concat:function(e){var t,n,o,s,c,d=Yte(this),h=Xte(d,0),p=0;for(t=-1,o=arguments.length;t<o;t++)if(Zte(c=t===-1?d:arguments[t]))for(s=qte(c),Fx(p+s),n=0;n<s;n++,p++)n in c&&Bx(h,p,c[n]);else Fx(p+1),Bx(h,p++,c);return h.length=p,h}});var Hx={},ene=ce,tne=br,Gx=t_.f,nne=Rc,zx=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];Hx.f=function(e){return zx&&ene(e)==="Window"?function(t){try{return Gx(t)}catch{return nne(zx)}}(e):Gx(tne(e))};var Gu={},rne=Fn;Gu.f=rne;var Kx=wn,ine=Lr,one=Gu,sne=jo.f,sr=function(e){var t=Kx.Symbol||(Kx.Symbol={});ine(t,e)||sne(t,e,{value:one.f(e)})},ane=Ge,cne=Wr,lne=Fn,dne=wc,Yx=function(){var e=cne("Symbol"),t=e&&e.prototype,n=t&&t.valueOf,o=lne("toPrimitive");t&&!t[o]&&dne(t,o,function(s){return ane(n,this)},{arity:1})},une=yc,hne=et,pne=ea,fne=Sc,mne=jx,qx=D([].push),Oc=function(e){var t=e===1,n=e===2,o=e===3,s=e===4,c=e===6,d=e===7,h=e===5||c;return function(p,m,g,E){for(var y,T,P=pne(p),I=hne(P),A=fne(I),M=une(m,g),U=0,Y=E||mne,Q=t?Y(p,A):n||d?Y(p,0):void 0;A>U;U++)if((h||U in I)&&(T=M(y=I[U],U,P),e))if(t)Q[U]=T;else if(T)switch(e){case 3:return!0;case 5:return y;case 6:return U;case 2:qx(Q,y)}else switch(e){case 4:return!1;case 7:qx(Q,y)}return c?-1:o||s?s:Q}},Xx={forEach:Oc(0),map:Oc(1),filter:Oc(2),some:Oc(3),every:Oc(4),find:Oc(5),findIndex:Oc(6),filterReject:Oc(7)},Z_=Mt,yf=F,Gw=Ge,gne=D,zu=be,Ku=Nt,_ne=f,$r=Lr,Ene=O,zw=Oi,eE=br,Kw=P0,vne=Gi,Yw=ht,Yu=ef,$x=r_,yne=t_,Jx=Hx,Sne=Zp,Qx=xe,Zx=jo,Tne=J0,eL=le,tL=wc,wne=g_,qw=yu,nL=n_,rL=N0,Rne=Fn,Cne=Gu,bne=sr,Ine=Yx,Ane=Va,iL=zl,tE=Xx.forEach,Ki=e_("hidden"),nE="Symbol",Sf="prototype",Nne=iL.set,oL=iL.getterFor(nE),ys=Object[Sf],ed=yf.Symbol,rE=ed&&ed[Sf],One=yf.RangeError,Pne=yf.TypeError,Xw=yf.QObject,sL=Qx.f,td=Zx.f,aL=Jx.f,Dne=eL.f,cL=gne([].push),Wa=qw("symbols"),Tf=qw("op-symbols"),kne=qw("wks"),$w=!Xw||!Xw[Sf]||!Xw[Sf].findChild,lL=function(e,t,n){var o=sL(ys,t);o&&delete ys[t],td(e,t,n),o&&e!==ys&&td(ys,t,o)},Jw=zu&&_ne(function(){return Yu(td({},"a",{get:function(){return td(this,"a",{value:7}).a}})).a!==7})?lL:td,Qw=function(e,t){var n=Wa[e]=Yu(rE);return Nne(n,{type:nE,tag:e,description:t}),zu||(n.description=t),n},iE=function(e,t,n){e===ys&&iE(Tf,t,n),zw(e);var o=Kw(t);return zw(n),$r(Wa,o)?(n.enumerable?($r(e,Ki)&&e[Ki][o]&&(e[Ki][o]=!1),n=Yu(n,{enumerable:Yw(0,!1)})):($r(e,Ki)||td(e,Ki,Yw(1,Yu(null))),e[Ki][o]=!0),Jw(e,o,n)):td(e,o,n)},Zw=function(e,t){zw(e);var n=eE(t),o=$x(n).concat(pL(n));return tE(o,function(s){zu&&!Gw(dL,n,s)||iE(e,s,n[s])}),e},dL=function(e){var t=Kw(e),n=Gw(Dne,this,t);return!(this===ys&&$r(Wa,t)&&!$r(Tf,t))&&(!(n||!$r(this,t)||!$r(Wa,t)||$r(this,Ki)&&this[Ki][t])||n)},uL=function(e,t){var n=eE(e),o=Kw(t);if(n!==ys||!$r(Wa,o)||$r(Tf,o)){var s=sL(n,o);return!s||!$r(Wa,o)||$r(n,Ki)&&n[Ki][o]||(s.enumerable=!0),s}},hL=function(e){var t=aL(eE(e)),n=[];return tE(t,function(o){$r(Wa,o)||$r(nL,o)||cL(n,o)}),n},pL=function(e){var t=e===ys,n=aL(t?Tf:eE(e)),o=[];return tE(n,function(s){!$r(Wa,s)||t&&!$r(ys,s)||cL(o,Wa[s])}),o};Ku||(ed=function(){if(Ene(rE,this))throw new Pne("Symbol is not a constructor");var e=arguments.length&&arguments[0]!==void 0?vne(arguments[0]):void 0,t=rL(e),n=function(o){var s=this===void 0?yf:this;s===ys&&Gw(n,Tf,o),$r(s,Ki)&&$r(s[Ki],t)&&(s[Ki][t]=!1);var c=Yw(1,o);try{Jw(s,t,c)}catch(d){if(!(d instanceof One))throw d;lL(s,t,c)}};return zu&&$w&&Jw(ys,t,{configurable:!0,set:n}),Qw(t,e)},tL(rE=ed[Sf],"toString",function(){return oL(this).tag}),tL(ed,"withoutSetter",function(e){return Qw(rL(e),e)}),eL.f=dL,Zx.f=iE,Tne.f=Zw,Qx.f=uL,yne.f=Jx.f=hL,Sne.f=pL,Cne.f=function(e){return Qw(Rne(e),e)},zu&&wne(rE,"description",{configurable:!0,get:function(){return oL(this).description}})),Z_({global:!0,constructor:!0,wrap:!0,forced:!Ku,sham:!Ku},{Symbol:ed}),tE($x(kne),function(e){bne(e)}),Z_({target:nE,stat:!0,forced:!Ku},{useSetter:function(){$w=!0},useSimple:function(){$w=!1}}),Z_({target:"Object",stat:!0,forced:!Ku,sham:!zu},{create:function(e,t){return t===void 0?Yu(e):Zw(Yu(e),t)},defineProperty:iE,defineProperties:Zw,getOwnPropertyDescriptor:uL}),Z_({target:"Object",stat:!0,forced:!Ku},{getOwnPropertyNames:hL}),Ine(),Ane(ed,nE),nL[Ki]=!0;var fL=Nt&&!!Symbol.for&&!!Symbol.keyFor,xne=Mt,Lne=Wr,Mne=Lr,Une=Gi,mL=yu,jne=fL,eR=mL("string-to-symbol-registry"),Vne=mL("symbol-to-string-registry");xne({target:"Symbol",stat:!0,forced:!jne},{for:function(e){var t=Une(e);if(Mne(eR,t))return eR[t];var n=Lne("Symbol")(t);return eR[t]=n,Vne[n]=t,n}});var Fne=Mt,Bne=Lr,Wne=Wl,Hne=vu,Gne=fL,gL=yu("symbol-to-string-registry");Fne({target:"Symbol",stat:!0,forced:!Gne},{keyFor:function(e){if(!Wne(e))throw new TypeError(Hne(e)+" is not a symbol");if(Bne(gL,e))return gL[e]}});var _L=Qp,zne=fe,EL=ce,Kne=Gi,vL=D([].push),Yne=Mt,yL=Wr,SL=z,qne=Ge,wf=D,TL=f,wL=fe,RL=Wl,CL=Rc,Xne=function(e){if(zne(e))return e;if(_L(e)){for(var t=e.length,n=[],o=0;o<t;o++){var s=e[o];typeof s=="string"?vL(n,s):typeof s!="number"&&EL(s)!=="Number"&&EL(s)!=="String"||vL(n,Kne(s))}var c=n.length,d=!0;return function(h,p){if(d)return d=!1,p;if(_L(this))return p;for(var m=0;m<c;m++)if(n[m]===h)return p}}},$ne=Nt,Jne=String,Pc=yL("JSON","stringify"),oE=wf(/./.exec),bL=wf("".charAt),Qne=wf("".charCodeAt),Zne=wf("".replace),ere=wf(1 .toString),tre=/[\uD800-\uDFFF]/g,IL=/^[\uD800-\uDBFF]$/,AL=/^[\uDC00-\uDFFF]$/,NL=!$ne||TL(function(){var e=yL("Symbol")("stringify detection");return Pc([e])!=="[null]"||Pc({a:e})!=="{}"||Pc(Object(e))!=="{}"}),OL=TL(function(){return Pc("\uDF06\uD834")!=='"\\udf06\\ud834"'||Pc("\uDEAD")!=='"\\udead"'}),nre=function(e,t){var n=CL(arguments),o=Xne(t);if(wL(o)||e!==void 0&&!RL(e))return n[1]=function(s,c){if(wL(o)&&(c=qne(o,this,Jne(s),c)),!RL(c))return c},SL(Pc,null,n)},rre=function(e,t,n){var o=bL(n,t-1),s=bL(n,t+1);return oE(IL,e)&&!oE(AL,s)||oE(AL,e)&&!oE(IL,o)?"\\u"+ere(Qne(e,0),16):e};Pc&&Yne({target:"JSON",stat:!0,arity:3,forced:NL||OL},{stringify:function(e,t,n){var o=CL(arguments),s=SL(NL?nre:Pc,null,o);return OL&&typeof s=="string"?Zne(s,tre,rre):s}});var PL=Zp,ire=ea;Mt({target:"Object",stat:!0,forced:!Nt||f(function(){PL.f(1)})},{getOwnPropertySymbols:function(e){var t=PL.f;return t?t(ire(e)):[]}}),sr("asyncIterator"),sr("hasInstance"),sr("isConcatSpreadable"),sr("iterator"),sr("match"),sr("matchAll"),sr("replace"),sr("search"),sr("species"),sr("split");var ore=Yx;sr("toPrimitive"),ore();var sre=Wr,are=Va;sr("toStringTag"),are(sre("Symbol"),"Symbol"),sr("unscopables"),Va(F.JSON,"JSON",!0);var cre=wn.Symbol,lre=Fn,dre=jo.f,DL=lre("metadata"),kL=Function.prototype;kL[DL]===void 0&&dre(kL,DL,{value:null}),sr("asyncDispose"),sr("dispose"),sr("metadata");var ure=cre,hre=D,tR=Wr("Symbol"),pre=tR.keyFor,fre=hre(tR.prototype.valueOf),xL=tR.isRegisteredSymbol||function(e){try{return pre(fre(e))!==void 0}catch{return!1}};Mt({target:"Symbol",stat:!0},{isRegisteredSymbol:xL});for(var mre=yu,LL=Wr,gre=D,_re=Wl,Ere=Fn,sE=LL("Symbol"),ML=sE.isWellKnownSymbol,UL=LL("Object","getOwnPropertyNames"),vre=gre(sE.prototype.valueOf),jL=mre("wks"),nR=0,VL=UL(sE),yre=VL.length;nR<yre;nR++)try{var FL=VL[nR];_re(sE[FL])&&Ere(FL)}catch{}var BL=function(e){if(ML&&ML(e))return!0;try{for(var t=vre(e),n=0,o=UL(jL),s=o.length;n<s;n++)if(jL[o[n]]==t)return!0}catch{}return!1};Mt({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:BL}),sr("customMatcher"),sr("observable"),Mt({target:"Symbol",stat:!0,name:"isRegisteredSymbol"},{isRegistered:xL}),Mt({target:"Symbol",stat:!0,name:"isWellKnownSymbol",forced:!0},{isWellKnown:BL}),sr("matcher"),sr("metadataKey"),sr("patternMatch"),sr("replaceAll");var qu=u(ure),WL=u(Gu.f("iterator"));function Rf(e){return Rf=typeof qu=="function"&&typeof WL=="symbol"?function(t){return typeof t}:function(t){return t&&typeof qu=="function"&&t.constructor===qu&&t!==qu.prototype?"symbol":typeof t},Rf(e)}var Sre=u(Gu.f("toPrimitive"));function Tre(e){var t=function(n,o){if(Rf(n)!="object"||!n)return n;var s=n[Sre];if(s!==void 0){var c=s.call(n,o||"default");if(Rf(c)!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(o==="string"?String:Number)(n)}(e,"string");return Rf(t)=="symbol"?t:t+""}function x(e,t,n){return(t=Tre(t))in e?Lx(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var HL=u(RZ),wre={isBrowser:!0,classes:{URLSearchParams:HL!==void 0?HL:Hw,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};const rR=typeof window<"u"&&typeof document<"u",iR=typeof navigator=="object"&&navigator||void 0,Rre=rR&&(!iR||["ReactNative","NativeScript","NS"].indexOf(iR.product)<0),Cre=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",bre=rR&&window.location.href||"http://localhost";function GL(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,o)}return n}function zL(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?GL(Object(n),!0).forEach(function(o){x(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):GL(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}var gi=zL(zL({},Object.freeze({__proto__:null,hasBrowserEnv:rR,hasStandardBrowserEnv:Rre,hasStandardBrowserWebWorkerEnv:Cre,navigator:iR,origin:bre})),wre),Ire=Oi,Are=Ge,Nre=Lr,Ore=O,Pre=function(){var e=Ire(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t},KL=RegExp.prototype,YL=function(e){var t=e.flags;return t!==void 0||"flags"in KL||Nre(e,"flags")||!Ore(KL,e)?t:Are(Pre,e)},Dre=GT.charAt,qL=Ge,kre=Oi,xre=fe,Lre=ce,Mre=/./.exec,Ure=TypeError,jre=Mt,XL=Ge,$L=_e,Vre=uT,aE=f_,JL=an,QL=$O,Cf=Gi,Fre=Oi,Bre=nt,Wre=ce,Hre=QO,ZL=YL,Gre=qg,zre=f,Kre=_T,Yre=function(e,t,n){return t+(n?Dre(e,t).length:1)},qre=function(e,t){var n=e.exec;if(xre(n)){var o=qL(n,e,t);return o!==null&&kre(o),o}if(Lre(e)==="RegExp")return qL(Mre,e,t);throw new Ure("RegExp#exec called on incompatible receiver")},e2=zl,Xre=Fn("matchAll"),t2="RegExp String",n2=t2+" Iterator",$re=e2.set,Jre=e2.getterFor(n2),Qre=TypeError,oR=$L("".indexOf),cE=$L("".matchAll),sR=!!cE&&!zre(function(){cE("a",/./)}),Zre=Vre(function(e,t,n,o){$re(this,{type:n2,regexp:e,string:t,global:n,unicode:o,done:!1})},t2,function(){var e=Jre(this);if(e.done)return aE(void 0,!0);var t=e.regexp,n=e.string,o=qre(t,n);return o===null?(e.done=!0,aE(void 0,!0)):e.global?(Cf(o[0])===""&&(t.lastIndex=Yre(n,QL(t.lastIndex),e.unicode)),aE(o,!1)):(e.done=!0,aE(o,!1))}),r2=function(e){var t,n,o,s=Fre(this),c=Cf(e),d=Kre(s,RegExp),h=Cf(ZL(s));return t=new d(d===RegExp?s.source:s,h),n=!!~oR(h,"g"),o=!!~oR(h,"u"),t.lastIndex=QL(s.lastIndex),new Zre(t,c,n,o)};jre({target:"String",proto:!0,forced:sR},{matchAll:function(e){var t,n,o,s,c=JL(this);if(Bre(e)){if(sR)return cE(c,e)}else{if(Hre(e)&&(t=Cf(JL(ZL(e))),!~oR(t,"g")))throw new Qre("`.matchAll` does not allow non-global regexes");if(sR)return cE(c,e);if((o=Gre(e,Xre))===void 0&&Wre(e)==="RegExp"&&(o=r2),o)return XL(o,e,c)}return n=Cf(c),s=new RegExp(e,"g"),XL(r2,s,n)}});var eie=Vo("String","matchAll"),tie=O,nie=eie,aR=String.prototype,rie=function(e){var t=e.matchAll;return typeof e=="string"||e===aR||tie(aR,e)&&t===aR.matchAll?nie:t},iie=u(rie);function i2(e){function t(n,o,s,c){let d=n[c++];if(d==="__proto__")return!0;const h=Number.isFinite(+d),p=c>=n.length;return d=!d&&ve.isArray(s)?s.length:d,p?(ve.hasOwnProp(s,d)?s[d]=[s[d],o]:s[d]=o,!h):(s[d]&&ve.isObject(s[d])||(s[d]=[]),t(n,o,s[d],c)&&ve.isArray(s[d])&&(s[d]=function(m){const g={},E=Object.keys(m);let y;const T=E.length;let P;for(y=0;y<T;y++)P=E[y],g[P]=m[P];return g}(s[d])),!h)}if(ve.isFormData(e)&&ve.isFunction(e.entries)){const n={};return ve.forEachEntry(e,(o,s)=>{t(function(c){return iie(ve).call(ve,/\w+|\[(\w*)]/g,c).map(d=>d[0]==="[]"?"":d[1]||d[0])}(o),s,n,0)}),n}return null}const cR={transitional:Px,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const n=t.getContentType()||"",o=n.indexOf("application/json")>-1,s=ve.isObject(e);if(s&&ve.isHTMLForm(e)&&(e=new FormData(e)),ve.isFormData(e))return o?JSON.stringify(i2(e)):e;if(ve.isArrayBuffer(e)||ve.isBuffer(e)||ve.isStream(e)||ve.isFile(e)||ve.isBlob(e)||ve.isReadableStream(e))return e;if(ve.isArrayBufferView(e))return e.buffer;if(ve.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let c;if(s){if(n.indexOf("application/x-www-form-urlencoded")>-1)return function(d,h){return Q_(d,new gi.classes.URLSearchParams,Object.assign({visitor:function(p,m,g,E){return gi.isNode&&ve.isBuffer(p)?(this.append(m,p.toString("base64")),!1):E.defaultVisitor.apply(this,arguments)}},h))}(e,this.formSerializer).toString();if((c=ve.isFileList(e))||n.indexOf("multipart/form-data")>-1){const d=this.env&&this.env.FormData;return Q_(c?{"files[]":e}:e,d&&new d,this.formSerializer)}}return s||o?(t.setContentType("application/json",!1),function(d,h,p){if(ve.isString(d))try{return(h||JSON.parse)(d),Hr(ve).call(ve,d)}catch(m){if(m.name!=="SyntaxError")throw m}return(0,JSON.stringify)(d)}(e)):e}],transformResponse:[function(e){const t=this.transitional||cR.transitional,n=t&&t.forcedJSONParsing,o=this.responseType==="json";if(ve.isResponse(e)||ve.isReadableStream(e))return e;if(e&&ve.isString(e)&&(n&&!this.responseType||o)){const s=!(t&&t.silentJSONParsing)&&o;try{return JSON.parse(e)}catch(c){if(s)throw c.name==="SyntaxError"?Wt.from(c,Wt.ERR_BAD_RESPONSE,this,null,this.response):c}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:gi.classes.FormData,Blob:gi.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};ve.forEach(["delete","get","head","post","put","patch"],e=>{cR.headers[e]={}});var lR=cR;const oie=ve.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),o2=Symbol("internals");function bf(e){var t;return e&&Hr(t=String(e)).call(t).toLowerCase()}function lE(e){return e===!1||e==null?e:ve.isArray(e)?e.map(lE):String(e)}function dR(e,t,n,o,s){return ve.isFunction(o)?o.call(this,t,n):(s&&(t=n),ve.isString(t)?ve.isString(o)?t.indexOf(o)!==-1:ve.isRegExp(o)?o.test(t):void 0:void 0)}class dE{constructor(t){t&&this.set(t)}set(t,n,o){const s=this;function c(p,m,g){const E=bf(m);if(!E)throw new Error("header name must be a non-empty string");const y=ve.findKey(s,E);(!y||s[y]===void 0||g===!0||g===void 0&&s[y]!==!1)&&(s[y||m]=lE(p))}const d=(p,m)=>ve.forEach(p,(g,E)=>c(g,E,m));if(ve.isPlainObject(t)||t instanceof this.constructor)d(t,n);else if(ve.isString(t)&&(t=Hr(t).call(t))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(Hr(h=t).call(h)))d((p=>{const m={};let g,E,y;return p&&p.split(`
`).forEach(function(T){var P,I;y=T.indexOf(":"),g=Hr(P=T.substring(0,y)).call(P).toLowerCase(),E=Hr(I=T.substring(y+1)).call(I),!g||m[g]&&oie[g]||(g==="set-cookie"?m[g]?m[g].push(E):m[g]=[E]:m[g]=m[g]?m[g]+", "+E:E)}),m})(t),n);else if(ve.isObject(t)&&ve.isIterable(t)){let p,m,g={};for(const E of t){if(!ve.isArray(E))throw TypeError("Object iterator must return a key-value pair");g[m=E[0]]=(p=g[m])?ve.isArray(p)?[...p,E[1]]:[p,E[1]]:E[1]}d(g,n)}else t!=null&&c(n,t,o);var h;return this}get(t,n){if(t=bf(t)){const o=ve.findKey(this,t);if(o){const s=this[o];if(!n)return s;if(n===!0)return function(c){const d=Object.create(null),h=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let p;for(;p=h.exec(c);)d[p[1]]=p[2];return d}(s);if(ve.isFunction(n))return n.call(this,s,o);if(ve.isRegExp(n))return n.exec(s);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,n){if(t=bf(t)){const o=ve.findKey(this,t);return!(!o||this[o]===void 0||n&&!dR(0,this[o],o,n))}return!1}delete(t,n){const o=this;let s=!1;function c(d){if(d=bf(d)){const h=ve.findKey(o,d);!h||n&&!dR(0,o[h],h,n)||(delete o[h],s=!0)}}return ve.isArray(t)?t.forEach(c):c(t),s}clear(t){const n=Object.keys(this);let o=n.length,s=!1;for(;o--;){const c=n[o];t&&!dR(0,this[c],c,t,!0)||(delete this[c],s=!0)}return s}normalize(t){const n=this,o={};return ve.forEach(this,(s,c)=>{var d;const h=ve.findKey(o,c);if(h)return n[h]=lE(s),void delete n[c];const p=t?function(m){return Hr(m).call(m).toLowerCase().replace(/([a-z\d])(\w*)/g,(g,E,y)=>E.toUpperCase()+y)}(c):Hr(d=String(c)).call(d);p!==c&&delete n[c],n[p]=lE(s),o[p]=!0}),this}concat(){for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return this.constructor.concat(this,...n)}toJSON(t){const n=Object.create(null);return ve.forEach(this,(o,s)=>{o!=null&&o!==!1&&(n[s]=t&&ve.isArray(o)?o.join(", "):o)}),n}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(t=>{let[n,o]=t;return n+": "+o}).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t){const n=new this(t);for(var o=arguments.length,s=new Array(o>1?o-1:0),c=1;c<o;c++)s[c-1]=arguments[c];return s.forEach(d=>n.set(d)),n}static accessor(t){const n=(this[o2]=this[o2]={accessors:{}}).accessors,o=this.prototype;function s(c){const d=bf(c);n[d]||(function(h,p){const m=ve.toCamelCase(" "+p);["get","set","has"].forEach(g=>{Object.defineProperty(h,g+m,{value:function(E,y,T){return this[g].call(this,p,E,y,T)},configurable:!0})})}(o,c),n[d]=!0)}return ve.isArray(t)?t.forEach(s):s(t),this}}dE.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),ve.reduceDescriptors(dE.prototype,(e,t)=>{let{value:n}=e,o=t[0].toUpperCase()+t.slice(1);return{get:()=>n,set(s){this[o]=s}}}),ve.freezeMethods(dE);var Ss=dE;function uR(e,t){const n=this||lR,o=t||n,s=Ss.from(o.headers);let c=o.data;return ve.forEach(e,function(d){c=d.call(n,c,s.normalize(),t?t.status:void 0)}),s.normalize(),c}function s2(e){return!(!e||!e.__CANCEL__)}function Xu(e,t,n){Wt.call(this,e??"canceled",Wt.ERR_CANCELED,t,n),this.name="CanceledError"}function a2(e,t,n){const o=n.config.validateStatus;n.status&&o&&!o(n.status)?t(new Wt("Request failed with status code "+n.status,[Wt.ERR_BAD_REQUEST,Wt.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n)):e(n)}ve.inherits(Xu,Wt,{__CANCEL__:!0});const uE=function(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,o=0;const s=function(c,d){c=c||10;const h=new Array(c),p=new Array(c);let m,g=0,E=0;return d=d!==void 0?d:1e3,function(y){const T=Date.now(),P=p[E];m||(m=T),h[g]=y,p[g]=T;let I=E,A=0;for(;I!==g;)A+=h[I++],I%=c;if(g=(g+1)%c,g===E&&(E=(E+1)%c),T-m<d)return;const M=P&&T-P;return M?Math.round(1e3*A/M):void 0}}(50,250);return function(c,d){let h,p,m=0,g=1e3/d;const E=function(y){m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Date.now(),h=null,p&&(clearTimeout(p),p=null),c.apply(null,y)};return[function(){const y=Date.now(),T=y-m;for(var P=arguments.length,I=new Array(P),A=0;A<P;A++)I[A]=arguments[A];T>=g?E(I,y):(h=I,p||(p=setTimeout(()=>{p=null,E(h)},g-T)))},()=>h&&E(h)]}(c=>{const d=c.loaded,h=c.lengthComputable?c.total:void 0,p=d-o,m=s(p);o=d,e({loaded:d,total:h,progress:h?d/h:void 0,bytes:p,rate:m||void 0,estimated:m&&h&&d<=h?(h-d)/m:void 0,event:c,lengthComputable:h!=null,[t?"download":"upload"]:!0})},n)},c2=(e,t)=>{const n=e!=null;return[o=>t[0]({lengthComputable:n,total:e,loaded:o}),t[1]]},l2=e=>function(){for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return ve.asap(()=>e(...n))};var sie=gi.hasStandardBrowserEnv?((e,t)=>n=>(n=new V_(n,gi.origin),e.protocol===n.protocol&&e.host===n.host&&(t||e.port===n.port)))(new V_(gi.origin),gi.navigator&&/(msie|trident)/i.test(gi.navigator.userAgent)):()=>!0,aie=gi.hasStandardBrowserEnv?{write(e,t,n,o,s,c){const d=[e+"="+encodeURIComponent(t)];ve.isNumber(n)&&d.push("expires="+new Date(n).toGMTString()),ve.isString(o)&&d.push("path="+o),ve.isString(s)&&d.push("domain="+s),c===!0&&d.push("secure"),document.cookie=d.join("; ")},read(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function d2(e,t,n){let o=!function(s){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(s)}(t);return e&&(o||n==0)?function(s,c){return c?s.replace(/\/?\/$/,"")+"/"+c.replace(/^\/+/,""):s}(e,t):t}function u2(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,o)}return n}const h2=e=>e instanceof Ss?function(t){for(var n=1;n<arguments.length;n++){var o=arguments[n]!=null?arguments[n]:{};n%2?u2(Object(o),!0).forEach(function(s){x(t,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):u2(Object(o)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(o,s))})}return t}({},e):e;function nd(e,t){t=t||{};const n={};function o(m,g,E,y){return ve.isPlainObject(m)&&ve.isPlainObject(g)?ve.merge.call({caseless:y},m,g):ve.isPlainObject(g)?ve.merge({},g):ve.isArray(g)?g.slice():g}function s(m,g,E,y){return ve.isUndefined(g)?ve.isUndefined(m)?void 0:o(void 0,m,0,y):o(m,g,0,y)}function c(m,g){if(!ve.isUndefined(g))return o(void 0,g)}function d(m,g){return ve.isUndefined(g)?ve.isUndefined(m)?void 0:o(void 0,m):o(void 0,g)}function h(m,g,E){return E in t?o(m,g):E in e?o(void 0,m):void 0}const p={url:c,method:c,data:c,baseURL:d,transformRequest:d,transformResponse:d,paramsSerializer:d,timeout:d,timeoutMessage:d,withCredentials:d,withXSRFToken:d,adapter:d,responseType:d,xsrfCookieName:d,xsrfHeaderName:d,onUploadProgress:d,onDownloadProgress:d,decompress:d,maxContentLength:d,maxBodyLength:d,beforeRedirect:d,transport:d,httpAgent:d,httpsAgent:d,cancelToken:d,socketPath:d,responseEncoding:d,validateStatus:h,headers:(m,g,E)=>s(h2(m),h2(g),0,!0)};return ve.forEach(Object.keys(Object.assign({},e,t)),function(m){const g=p[m]||s,E=g(e[m],t[m],m);ve.isUndefined(E)&&g!==h||(n[m]=E)}),n}var p2=e=>{const t=nd({},e);let n,{data:o,withXSRFToken:s,xsrfHeaderName:c,xsrfCookieName:d,headers:h,auth:p}=t;if(t.headers=h=Ss.from(h),t.url=Nx(d2(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),p&&h.set("Authorization","Basic "+btoa((p.username||"")+":"+(p.password?unescape(encodeURIComponent(p.password)):""))),ve.isFormData(o)){if(gi.hasStandardBrowserEnv||gi.hasStandardBrowserWebWorkerEnv)h.setContentType(void 0);else if((n=h.getContentType())!==!1){const[m,...g]=n?n.split(";").map(E=>Hr(E).call(E)).filter(Boolean):[];h.setContentType([m||"multipart/form-data",...g].join("; "))}}if(gi.hasStandardBrowserEnv&&(s&&ve.isFunction(s)&&(s=s(t)),s||s!==!1&&sie(t.url))){const m=c&&d&&aie.read(d);m&&h.set(c,m)}return t},cie=typeof XMLHttpRequest<"u"&&function(e){return new ye(function(t,n){const o=p2(e);let s=o.data;const c=Ss.from(o.headers).normalize();let d,h,p,m,g,{responseType:E,onUploadProgress:y,onDownloadProgress:T}=o;function P(){m&&m(),g&&g(),o.cancelToken&&o.cancelToken.unsubscribe(d),o.signal&&o.signal.removeEventListener("abort",d)}let I=new XMLHttpRequest;function A(){if(!I)return;const U=Ss.from("getAllResponseHeaders"in I&&I.getAllResponseHeaders());a2(function(Y){t(Y),P()},function(Y){n(Y),P()},{data:E&&E!=="text"&&E!=="json"?I.response:I.responseText,status:I.status,statusText:I.statusText,headers:U,config:e,request:I}),I=null}I.open(o.method.toUpperCase(),o.url,!0),I.timeout=o.timeout,"onloadend"in I?I.onloadend=A:I.onreadystatechange=function(){I&&I.readyState===4&&(I.status!==0||I.responseURL&&I.responseURL.indexOf("file:")===0)&&setTimeout(A)},I.onabort=function(){I&&(n(new Wt("Request aborted",Wt.ECONNABORTED,e,I)),I=null)},I.onerror=function(){n(new Wt("Network Error",Wt.ERR_NETWORK,e,I)),I=null},I.ontimeout=function(){let U=o.timeout?"timeout of "+o.timeout+"ms exceeded":"timeout exceeded";const Y=o.transitional||Px;o.timeoutErrorMessage&&(U=o.timeoutErrorMessage),n(new Wt(U,Y.clarifyTimeoutError?Wt.ETIMEDOUT:Wt.ECONNABORTED,e,I)),I=null},s===void 0&&c.setContentType(null),"setRequestHeader"in I&&ve.forEach(c.toJSON(),function(U,Y){I.setRequestHeader(Y,U)}),ve.isUndefined(o.withCredentials)||(I.withCredentials=!!o.withCredentials),E&&E!=="json"&&(I.responseType=o.responseType),T&&([p,g]=uE(T,!0),I.addEventListener("progress",p)),y&&I.upload&&([h,m]=uE(y),I.upload.addEventListener("progress",h),I.upload.addEventListener("loadend",m)),(o.cancelToken||o.signal)&&(d=U=>{I&&(n(!U||U.type?new Xu(null,e,I):U),I.abort(),I=null)},o.cancelToken&&o.cancelToken.subscribe(d),o.signal&&(o.signal.aborted?d():o.signal.addEventListener("abort",d)));const M=function(U){const Y=/^([-+\w]{1,25})(:?\/\/|:)/.exec(U);return Y&&Y[1]||""}(o.url);M&&gi.protocols.indexOf(M)===-1?n(new Wt("Unsupported protocol "+M+":",Wt.ERR_BAD_REQUEST,e)):I.send(s||null)})},lie=(e,t)=>{const{length:n}=e=e?e.filter(Boolean):[];if(t||n){let o,s=new AbortController;const c=function(m){if(!o){o=!0,h();const g=m instanceof Error?m:this.reason;s.abort(g instanceof Wt?g:new Xu(g instanceof Error?g.message:g))}};let d=t&&setTimeout(()=>{d=null,c(new Wt("timeout ".concat(t," of ms exceeded"),Wt.ETIMEDOUT))},t);const h=()=>{e&&(d&&clearTimeout(d),d=null,e.forEach(m=>{m.unsubscribe?m.unsubscribe(c):m.removeEventListener("abort",c)}),e=null)};e.forEach(m=>m.addEventListener("abort",c));const{signal:p}=s;return p.unsubscribe=()=>ve.asap(h),p}},hR=u(eD),f2=Gu.f("asyncIterator"),die=u(f2);function pR(e,t){this.v=e,this.k=t}function ho(e){return function(){return new If(e.apply(this,arguments))}}function If(e){var t,n;function o(c,d){try{var h=e[c](d),p=h.value,m=p instanceof pR;hR.resolve(m?p.v:p).then(function(g){if(m){var E=c==="return"?"return":"next";if(!p.k||g.done)return o(E,g);g=e[E](g).value}s(h.done?"return":"normal",g)},function(g){o("throw",g)})}catch(g){s("throw",g)}}function s(c,d){switch(c){case"return":t.resolve({value:d,done:!0});break;case"throw":t.reject(d);break;default:t.resolve({value:d,done:!1})}(t=t.next)?o(t.key,t.arg):n=null}this._invoke=function(c,d){return new hR(function(h,p){var m={key:c,arg:d,resolve:h,reject:p,next:null};n?n=n.next=m:(t=n=m,o(c,d))})},typeof e.return!="function"&&(this.return=void 0)}function Tt(e){return new pR(e,0)}function hE(e){var t={},n=!1;function o(s,c){return n=!0,c=new hR(function(d){d(e[s](c))}),{done:!1,value:new pR(c,1)}}return t[qu!==void 0&&WL||"@@iterator"]=function(){return this},t.next=function(s){return n?(n=!1,s):o("next",s)},typeof e.throw=="function"&&(t.throw=function(s){if(n)throw n=!1,s;return o("throw",s)}),typeof e.return=="function"&&(t.return=function(s){return n?(n=!1,s):o("return",s)}),t}If.prototype[typeof qu=="function"&&die||"@@asyncIterator"]=function(){return this},If.prototype.next=function(e){return this._invoke("next",e)},If.prototype.throw=function(e){return this._invoke("throw",e)},If.prototype.return=function(e){return this._invoke("return",e)};var fR=u(f2);function mR(e){var t,n,o,s=2;for(typeof Symbol<"u"&&(n=fR,o=Symbol.iterator);s--;){if(n&&(t=e[n])!=null)return t.call(e);if(o&&(t=e[o])!=null)return new pE(t.call(e));n="@@asyncIterator",o="@@iterator"}throw new TypeError("Object is not async iterable")}function pE(e){function t(n){if(Object(n)!==n)return ye.reject(new TypeError(n+" is not an object."));var o=n.done;return ye.resolve(n.value).then(function(s){return{value:s,done:o}})}return pE=function(n){this.s=n,this.n=n.next},pE.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(n){var o=this.s.return;return o===void 0?ye.resolve({value:n,done:!0}):t(o.apply(this.s,arguments))},throw:function(n){var o=this.s.return;return o===void 0?ye.reject(n):t(o.apply(this.s,arguments))}},new pE(e)}const uie=function*(e,t){let n=e.byteLength;if(!t||n<t)return void(yield e);let o,s=0;for(;s<n;)o=s+t,yield e.slice(s,o),s=o},hie=function(){var e=ho(function*(t,n){var o,s=!1,c=!1;try{for(var d,h=mR(pie(t));s=!(d=yield Tt(h.next())).done;s=!1){const p=d.value;yield*hE(mR(uie(p,n)))}}catch(p){c=!0,o=p}finally{try{s&&h.return!=null&&(yield Tt(h.return()))}finally{if(c)throw o}}});return function(t,n){return e.apply(this,arguments)}}(),pie=function(){var e=ho(function*(t){if(t[fR])return void(yield*hE(mR(t)));const n=t.getReader();try{for(;;){const{done:o,value:s}=yield Tt(n.read());if(o)break;yield s}}finally{yield Tt(n.cancel())}});return function(t){return e.apply(this,arguments)}}(),m2=(e,t,n,o)=>{const s=hie(e,t);let c,d=0,h=p=>{c||(c=!0,o&&o(p))};return new ReadableStream({async pull(p){try{const{done:m,value:g}=await s.next();if(m)return h(),void p.close();let E=g.byteLength;if(n){let y=d+=E;n(y)}p.enqueue(new Uint8Array(g))}catch(m){throw h(m),m}},cancel:p=>(h(p),s.return())},{highWaterMark:2})};function g2(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,o)}return n}function _2(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?g2(Object(n),!0).forEach(function(o){x(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):g2(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}const fE=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",E2=fE&&typeof ReadableStream=="function",fie=fE&&(typeof TextEncoder=="function"?(v2=new TextEncoder,e=>v2.encode(e)):async e=>new Uint8Array(await new Response(e).arrayBuffer()));var v2;const y2=function(e){try{for(var t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];return!!e(...n)}catch{return!1}},mie=E2&&y2(()=>{let e=!1;const t=new Request(gi.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t}),gR=E2&&y2(()=>ve.isReadableStream(new Response("").body)),mE={stream:gR&&(e=>e.body)};var S2;fE&&(S2=new Response,["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!mE[e]&&(mE[e]=ve.isFunction(S2[e])?t=>t[e]():(t,n)=>{throw new Wt("Response type '".concat(e,"' is not supported"),Wt.ERR_NOT_SUPPORT,n)})}));const gie=async(e,t)=>{const n=ve.toFiniteNumber(e.getContentLength());return n??(async o=>o==null?0:ve.isBlob(o)?o.size:ve.isSpecCompliantForm(o)?(await new Request(gi.origin,{method:"POST",body:o}).arrayBuffer()).byteLength:ve.isArrayBufferView(o)||ve.isArrayBuffer(o)?o.byteLength:(ve.isURLSearchParams(o)&&(o+=""),ve.isString(o)?(await fie(o)).byteLength:void 0))(t)};var _ie=fE&&(async e=>{let{url:t,method:n,data:o,signal:s,cancelToken:c,timeout:d,onDownloadProgress:h,onUploadProgress:p,responseType:m,headers:g,withCredentials:E="same-origin",fetchOptions:y}=p2(e);m=m?(m+"").toLowerCase():"text";let T,P=lie([s,c&&c.toAbortSignal()],d);const I=P&&P.unsubscribe&&(()=>{P.unsubscribe()});let A;try{if(p&&mie&&n!=="get"&&n!=="head"&&(A=await gie(g,o))!==0){let J,X=new Request(t,{method:"POST",body:o,duplex:"half"});if(ve.isFormData(o)&&(J=X.headers.get("content-type"))&&g.setContentType(J),X.body){const[ne,oe]=c2(A,uE(l2(p)));o=m2(X.body,65536,ne,oe)}}ve.isString(E)||(E=E?"include":"omit");const M="credentials"in Request.prototype;T=new Request(t,_2(_2({},y),{},{signal:P,method:n.toUpperCase(),headers:g.normalize().toJSON(),body:o,duplex:"half",credentials:M?E:void 0}));let U=await fetch(T);const Y=gR&&(m==="stream"||m==="response");if(gR&&(h||Y&&I)){const J={};["status","statusText","headers"].forEach(me=>{J[me]=U[me]});const X=ve.toFiniteNumber(U.headers.get("content-length")),[ne,oe]=h&&c2(X,uE(l2(h),!0))||[];U=new Response(m2(U.body,65536,ne,()=>{oe&&oe(),I&&I()}),J)}m=m||"text";let Q=await mE[ve.findKey(mE,m)||"text"](U,e);return!Y&&I&&I(),await new ye((J,X)=>{a2(J,X,{data:Q,headers:Ss.from(U.headers),status:U.status,statusText:U.statusText,config:e,request:T})})}catch(M){throw I&&I(),M&&M.name==="TypeError"&&/Load failed|fetch/i.test(M.message)?Object.assign(new Wt("Network Error",Wt.ERR_NETWORK,e,T),{cause:M.cause||M}):Wt.from(M,M&&M.code,e,T)}});const _R={http:null,xhr:cie,fetch:_ie};ve.forEach(_R,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch{}Object.defineProperty(e,"adapterName",{value:t})}});const T2=e=>"- ".concat(e),Eie=e=>ve.isFunction(e)||e===null||e===!1;var w2={getAdapter:e=>{e=ve.isArray(e)?e:[e];const{length:t}=e;let n,o;const s={};for(let c=0;c<t;c++){let d;if(n=e[c],o=n,!Eie(n)&&(o=_R[(d=String(n)).toLowerCase()],o===void 0))throw new Wt("Unknown adapter '".concat(d,"'"));if(o)break;s[d||"#"+c]=o}if(!o){const c=Object.entries(s).map(d=>{let[h,p]=d;return"adapter ".concat(h," ")+(p===!1?"is not supported by the environment":"is not available in the build")});throw new Wt("There is no suitable adapter to dispatch the request "+(t?c.length>1?`since :
`+c.map(T2).join(`
`):" "+T2(c[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return o},adapters:_R};function ER(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new Xu(null,e)}function R2(e){return ER(e),e.headers=Ss.from(e.headers),e.data=uR.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),w2.getAdapter(e.adapter||lR.adapter)(e).then(function(t){return ER(e),t.data=uR.call(e,e.transformResponse,t),t.headers=Ss.from(t.headers),t},function(t){return s2(t)||(ER(e),t&&t.response&&(t.response.data=uR.call(e,e.transformResponse,t.response),t.response.headers=Ss.from(t.response.headers))),ye.reject(t)})}const C2="1.9.0",gE={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{gE[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}});const b2={};gE.transitional=function(e,t,n){function o(s,c){return"[Axios v"+C2+"] Transitional option '"+s+"'"+c+(n?". "+n:"")}return(s,c,d)=>{if(e===!1)throw new Wt(o(c," has been removed"+(t?" in "+t:"")),Wt.ERR_DEPRECATED);return t&&!b2[c]&&(b2[c]=!0,console.warn(o(c," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(s,c,d)}},gE.spelling=function(e){return(t,n)=>(console.warn("".concat(n," is likely a misspelling of ").concat(e)),!0)};var _E={assertOptions:function(e,t,n){if(typeof e!="object")throw new Wt("options must be an object",Wt.ERR_BAD_OPTION_VALUE);const o=Object.keys(e);let s=o.length;for(;s-- >0;){const c=o[s],d=t[c];if(d){const h=e[c],p=h===void 0||d(h,c,e);if(p!==!0)throw new Wt("option "+c+" must be "+p,Wt.ERR_BAD_OPTION_VALUE)}else if(n!==!0)throw new Wt("Unknown option "+c,Wt.ERR_BAD_OPTION)}},validators:gE};const ia=_E.validators;let EE=class{constructor(e){this.defaults=e||{},this.interceptors={request:new Ox,response:new Ox}}async request(e,t){try{return await this._request(e,t)}catch(n){if(n instanceof Error){let o={};Error.captureStackTrace?Error.captureStackTrace(o):o=new Error;const s=o.stack?o.stack.replace(/^.+\n/,""):"";try{n.stack?s&&!String(n.stack).endsWith(s.replace(/^.+\n.+\n/,""))&&(n.stack+=`
`+s):n.stack=s}catch{}}throw n}}_request(e,t){typeof e=="string"?(t=t||{}).url=e:t=e||{},t=nd(this.defaults,t);const{transitional:n,paramsSerializer:o,headers:s}=t;n!==void 0&&_E.assertOptions(n,{silentJSONParsing:ia.transitional(ia.boolean),forcedJSONParsing:ia.transitional(ia.boolean),clarifyTimeoutError:ia.transitional(ia.boolean)},!1),o!=null&&(ve.isFunction(o)?t.paramsSerializer={serialize:o}:_E.assertOptions(o,{encode:ia.function,serialize:ia.function},!0)),t.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),_E.assertOptions(t,{baseUrl:ia.spelling("baseURL"),withXsrfToken:ia.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let c=s&&ve.merge(s.common,s[t.method]);s&&ve.forEach(["delete","get","head","post","put","patch","common"],T=>{delete s[T]}),t.headers=Ss.concat(c,s);const d=[];let h=!0;this.interceptors.request.forEach(function(T){typeof T.runWhen=="function"&&T.runWhen(t)===!1||(h=h&&T.synchronous,d.unshift(T.fulfilled,T.rejected))});const p=[];let m;this.interceptors.response.forEach(function(T){p.push(T.fulfilled,T.rejected)});let g,E=0;if(!h){const T=[R2.bind(this),void 0];for(T.unshift.apply(T,d),T.push.apply(T,p),g=T.length,m=ye.resolve(t);E<g;)m=m.then(T[E++],T[E++]);return m}g=d.length;let y=t;for(E=0;E<g;){const T=d[E++],P=d[E++];try{y=T(y)}catch(I){P.call(this,I);break}}try{m=R2.call(this,y)}catch(T){return ye.reject(T)}for(E=0,g=p.length;E<g;)m=m.then(p[E++],p[E++]);return m}getUri(e){return Nx(d2((e=nd(this.defaults,e)).baseURL,e.url,e.allowAbsoluteUrls),e.params,e.paramsSerializer)}};ve.forEach(["delete","get","head","options"],function(e){EE.prototype[e]=function(t,n){return this.request(nd(n||{},{method:e,url:t,data:(n||{}).data}))}}),ve.forEach(["post","put","patch"],function(e){function t(n){return function(o,s,c){return this.request(nd(c||{},{method:e,headers:n?{"Content-Type":"multipart/form-data"}:{},url:o,data:s}))}}EE.prototype[e]=t(),EE.prototype[e+"Form"]=t(!0)});var vE=EE;class vR{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let n;this.promise=new ye(function(s){n=s});const o=this;this.promise.then(s=>{if(!o._listeners)return;let c=o._listeners.length;for(;c-- >0;)o._listeners[c](s);o._listeners=null}),this.promise.then=s=>{let c;const d=new ye(h=>{o.subscribe(h),c=h}).then(s);return d.cancel=function(){o.unsubscribe(c)},d},t(function(s,c,d){o.reason||(o.reason=new Xu(s,c,d),n(o.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){this.reason?t(this.reason):this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const n=this._listeners.indexOf(t);n!==-1&&this._listeners.splice(n,1)}toAbortSignal(){const t=new AbortController,n=o=>{t.abort(o)};return this.subscribe(n),t.signal.unsubscribe=()=>this.unsubscribe(n),t.signal}static source(){let t;return{token:new vR(function(o){t=o}),cancel:t}}}var vie=vR;const yR={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(yR).forEach(e=>{let[t,n]=e;yR[n]=t});var yie=yR;const Mr=function e(t){const n=new vE(t),o=hx(vE.prototype.request,n);return ve.extend(o,vE.prototype,n,{allOwnKeys:!0}),ve.extend(o,n,null,{allOwnKeys:!0}),o.create=function(s){return e(nd(t,s))},o}(lR);Mr.Axios=vE,Mr.CanceledError=Xu,Mr.CancelToken=vie,Mr.isCancel=s2,Mr.VERSION=C2,Mr.toFormData=Q_,Mr.AxiosError=Wt,Mr.Cancel=Mr.CanceledError,Mr.all=function(e){return ye.all(e)},Mr.spread=function(e){return function(t){return e.apply(null,t)}},Mr.isAxiosError=function(e){return ve.isObject(e)&&e.isAxiosError===!0},Mr.mergeConfig=nd,Mr.AxiosHeaders=Ss,Mr.formToJSON=e=>i2(ve.isHTMLForm(e)?new FormData(e):e),Mr.getAdapter=w2.getAdapter,Mr.HttpStatusCode=yie,Mr.default=Mr;var oi=Mr;const Sie=()=>{};function Af(){const e={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:Sie};return e.promise=new ye((t,n)=>{e.resolve=o=>{e.isFinished||(e.isResolved=!0,e.isFinished=!0,t(o),e.value=o)},e.reject=o=>{e.isFinished||(e.isRejected=!0,e.isFinished=!0,n(o))}}),e}const yE=new Map,SE=new Map,oa=new Map;let Xn=function(e){return e.WIN_10="Windows 10",e.WIN_81="Windows 8.1",e.WIN_8="Windows 8",e.WIN_7="Windows 7",e.WIN_VISTA="Windows Vista",e.WIN_SERVER_2003="Windows Server 2003",e.WIN_XP="Windows XP",e.WIN_2000="Windows 2000",e.ANDROID="Android",e.HARMONY_OS="HarmonyOS",e.OPEN_BSD="Open BSD",e.SUN_OS="Sun OS",e.LINUX="Linux",e.IOS="iOS",e.MAC_OS="Mac OS",e.CHROMIUM_OS="Chromium OS",e.QNX="QNX",e.UNIX="UNIX",e.BEOS="BeOS",e.OS_2="OS/2",e.SEARCH_BOT="Search Bot",e}({}),Ot=function(e){return e.CHROME="Chrome",e.SAFARI="Safari",e.EDGE="Edge",e.FIREFOX="Firefox",e.OPERA="OPR",e.QQ="QQBrowser",e.WECHAT="MicroMessenger",e}({});const I2=new Qee;let Ts=I2.getResult(),SR=null;function wt(e){if(!SR){Ts=I2.getResult();const t=function(h){if(h.engine.name==="Blink"&&h.browser.name!=="WeChat")return Ot.CHROME;switch(h.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return Ot.CHROME;case"Safari":case"Mobile Safari":return Ot.SAFARI;case"Edge":return Ot.EDGE;case"Firefox":return Ot.FIREFOX;case"QQ":case"QQBrowser":return Ot.QQ;case"Opera":return Ot.OPERA;case"WeChat":return Ot.WECHAT;default:return h.browser.name||""}}(Ts),n=A2(Ts),o=function(h){return h.os.name==="Windows"?h.os.version?h.os.name+" "+h.os.version:h.os.name:h.os.name||""}(Ts),s=Ts.os.version,c=A2(Ts,!1),d=Ts.device.type;if(!(t&&n&&o&&s))return{name:t,version:n,os:o,osVersion:s,browserVersion:c,deviceType:d};SR={name:t,version:n,os:o,osVersion:s,browserVersion:c,deviceType:d}}return SR}function A2(e){let t,n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return t=e.engine.name==="Blink"?e.engine.version||"":e.browser.version||"",n?t.split(".")[0]:t}function TE(){return wt().os}function N2(){const e=wt();return"".concat(e.os," ").concat(e.osVersion)}function wE(){const e=wt();return!!(Ts.engine.name==="WebKit"&&e.os===Xn.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&e.name!==Ot.SAFARI||Jr()&&e.name!==Ot.SAFARI)}function Ha(){return wt().name===Ot.CHROME}function gr(){return wt().name===Ot.SAFARI}function O2(){return wt().name===Ot.EDGE}function gn(){return wt().name===Ot.FIREFOX}function Jr(){return wt().os===Xn.IOS}function Nf(e){const t=wt();return!(t.name!==Ot.CHROME||!t.osVersion)&&Number(t.version)>=e}function P2(e){const t=wt();return!(t.name!==Ot.CHROME||!t.osVersion)&&Number(t.version)<e}function TR(e,t,n){const o=wt();return!(o.name!==e||!o.osVersion)&&(n?Number(o.version)>=t&&Number(o.version)<=n:Number(o.version)===t)}function wR(e){const t=wt();return!(t.name!==Ot.EDGE||!t.osVersion)&&Number(t.version)>=e}function D2(e){const t=wt();return!(t.name!==Ot.SAFARI||!t.osVersion)&&Number(t.version)>=e}function k2(e,t,n){const o=wt();if(o.os!==Xn.IOS||!o.osVersion)return!1;const s=o.osVersion.split(".");return t&&Number(s[0])===e&&Number(s[1])<t||Number(s[0])<e}function x2(e,t,n){const o=wt();if(o.name!==Ot.SAFARI||!o.osVersion||!o.browserVersion)return!1;const s=o.browserVersion.split(".");return t&&Number(s[0])===e&&Number(s[1])<t||Number(s[0])<e}function RR(e){const t=wt();return!(t.name!==Ot.OPERA||!t.osVersion)&&Number(t.version)>=e}function L2(){const e=wt();if(e.os!==Xn.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])<14||Number(t[0])===14&&Number(t[1])<=6}function $u(){const e=wt();if(e.os!==Xn.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===15}function CR(){const e=wt();if(e.os!==Xn.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===16}function M2(){const e=wt();if(e.os!==Xn.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===15&&Number(t[1])>=1}function Yo(){return gr()&&navigator.maxTouchPoints>0}function U2(){return wt().name===Ot.WECHAT}function j2(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function bR(){const e=TE();return function(){const{deviceType:t}=wt();return t==="mobile"||t==="tablet"}()||e===Xn.ANDROID||e===Xn.IOS||e===Xn.HARMONY_OS}function Ga(){const e=wt();return e.name!==Ot.EDGE&&e.name!==Ot.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function RE(){return TE()===Xn.ANDROID}function Of(){const e=wt();return RE()&&(e.name===Ot.CHROME||e.name===Ot.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function Je(e,t,n){return(t=function(o){var s=function(c,d){if(typeof c!="object"||!c)return c;var h=c[Symbol.toPrimitive];if(h!==void 0){var p=h.call(c,"string");if(typeof p!="object")return p;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(c)}(o);return typeof s=="symbol"?s:s+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function V2(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,o)}return n}function Ce(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?V2(Object(n),!0).forEach(function(o){Je(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):V2(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}let j=function(e){return e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e.TIMEOUT="TIMEOUT",e.INVALID_PARAMS="INVALID_PARAMS",e.NOT_READABLE="NOT_READABLE",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INVALID_OPERATION="INVALID_OPERATION",e.OPERATION_ABORTED="OPERATION_ABORTED",e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",e.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",e.DATACHANNEL_FAILED="DATACHANNEL_FAILED",e.NETWORK_ERROR="NETWORK_ERROR",e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",e.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",e.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",e.UID_CONFLICT="UID_CONFLICT",e.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",e.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e.INVALID_TRACK="INVALID_TRACK",e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e.ICE_FAILED="ICE_FAILED",e.PC_CLOSED="PC_CLOSED",e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",e.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",e.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",e.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e.WS_ABORT="WS_ABORT",e.WS_DISCONNECT="WS_DISCONNECT",e.WS_ERR="WS_ERR",e.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",e.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",e.INVALID_PLUGIN="INVALID_PLUGIN",e.DISCONNECT_P2P="DISCONNECT_P2P",e.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",e.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",e.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",e.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",e.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",e.PROHIBITED_OPERATION="PROHIBITED_OPERATION",e.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",e.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",e}({}),re=class extends Error{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0;super(t),Je(this,"code",void 0),Je(this,"message",void 0),Je(this,"data",void 0),Je(this,"name","AgoraRTCException"),this.code=e,this.message="AgoraRTCError ".concat(this.code,": ").concat(t),this.data=n}toString(){return this.data?"".concat(this.message,`
data: `).concat(JSON.stringify(this.data)):this.message}print(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",t=arguments.length>1?arguments[1]:void 0;return e==="error"&&(t||console).error(this.toString()),e==="warning"&&(t||console).warn(this.toString()),this}throw(e){throw this.print("error",e),this}};function za(e,t){if(typeof e!="boolean")throw new re(j.INVALID_PARAMS,"Invalid ".concat(t,": The value is of the boolean type."))}function Kn(e,t,n){if(!Ee(n).call(n,e))throw new re(j.INVALID_PARAMS,"".concat(t," can only be set as ").concat(JSON.stringify(n)))}function Ht(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(e<n||e>o||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!function(s){return typeof s=="number"&&s%1==0}(e))throw new re(j.INVALID_PARAMS,"invalid ".concat(t,": the value range is [").concat(n,", ").concat(o,"]. integer only"))}function IR(e,t){if(typeof e!="number"){if(!(e.min||e.max||e.ideal||e.exact))throw new re(j.INVALID_PARAMS,"".concat(t," is not a valid ConstrainLong"));e.min!==void 0&&Ht(e.min,"".concat(t,".min"),0,1/0),e.max!==void 0&&Ht(e.max,"".concat(t,".max"),1,1/0),e.exact!==void 0&&Ht(e.exact,"".concat(t,".exact"),1,1/0),e.ideal!==void 0&&Ht(e.ideal,"".concat(t,".ideal"),1,1/0)}else Ht(e,t,1,1/0)}function ar(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,s=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(e==null)throw new re(j.INVALID_PARAMS,"".concat(t||"param"," cannot be empty"));if(!F2(e,n,o,s))throw new re(j.INVALID_PARAMS,"Invalid ".concat(t||"string param",": Length of the string: [").concat(n,",").concat(o,"].").concat(s?" ASCII characters only.":""))}function Ka(e,t){if(!Array.isArray(e))throw new re(j.INVALID_PARAMS,"".concat(t," should be an array"))}function _n(e){return e==null}function F2(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,o=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof e=="string"&&e.length<=n&&e.length>=t&&(!o||function(s){if(typeof s!="string")return!1;for(let c=0;c<s.length;c+=1){const d=s.charCodeAt(c);if(d<0||d>255)return!1}return!0}(e))}var Pf=function(e){return e.COVERED="COVERED",e.POSITION="POSITION",e.SIZE="SIZE",e.STYLE="STYLE",e}(Pf||{}),AR=function(e){return e.UNMOUNTED="UNMOUNTED",e.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",e}(AR||{});const B2=new class{constructor(){Je(this,"_clientSize",null),Je(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),Je(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),Je(this,"getStyle",e=>window.getComputedStyle(e,null)),Je(this,"checkCssVisibleProperty",e=>{var t;let n=!0;const o=this.getStyle(e),{display:s,visibility:c,opacity:d,filter:h}=o;return(s==="none"||Ee(t=["hidden","collapse"]).call(t,c)||Number(d)<.1)&&(n=!1),!!n&&(h&&h.split(" ").filter(p=>{var m;const g=p.split("(")[0];return Ee(m=["brightness","blur","opacity"]).call(m,g)}).map(p=>{const[m,g]=p.split(/\(|\)/);return[m,Number(g.match(/^[0-9\.]+/))]}).forEach(p=>{const[m,g]=p;switch(m){case"brightness":(g<.1||g>3)&&(n=!1);break;case"blur":g>3&&(n=!1);break;case"opacity":g<.1&&(n=!1)}}),n)}),Je(this,"checkPropertyUpToAllParentNodes",(e,t)=>{let n=!0,o=!0;const s=d=>t(d);let c=e;for(;c&&o;)s(c)||(n=!1,o=!1),c=c.parentElement,c||(o=!1);return n}),Je(this,"checkActualCssVisibleIncludeInherit",e=>this.checkPropertyUpToAllParentNodes(e,this.checkCssVisibleProperty)),Je(this,"getSizeAboutClient",e=>{const{width:t,height:n,left:o,right:s,top:c,bottom:d}=e.getBoundingClientRect(),h=this.getClientWidth(),p=this.getClientHeight();return{width:t,height:n,left:o,right:s,top:c,bottom:d,clientWidth:h,clientHeight:p,clientMin:Math.min(h,p)}}),Je(this,"checkActualSize",()=>{const{width:e,height:t,clientMin:n}=this._clientSize;return this.checkSizeIsVisible(e,t,n)}),Je(this,"elementFromPoint",(e,t)=>document.elementFromPoint?document.elementFromPoint(e,t):null),Je(this,"checkCoverForAPoint",(e,t,n)=>{const o=this.elementFromPoint(e,t);return o!==null&&o!==n}),Je(this,"getPointPositionList",()=>{const{width:e,height:t,left:n,top:o}=this._clientSize,s=e/6,c=t/6,d=[],h=10**6;for(let p=0;p<5;p++)for(let m=0;m<5;m++){const g=(n*h+(p===0?.1:p===4?(s*p*h-1e5)/h:s*p)*h)/h,E=(o*h+(m===0?.1:m===4?(c*m*h-1e5)/h:c*m)*h)/h;d.push({x:g,y:E})}return[...d]}),Je(this,"checkElementCover",e=>this.getPointPositionList().map(t=>this.checkCoverForAPoint(t.x,t.y,e)).filter(t=>!!t).length>6),Je(this,"checkSizeIsVisible",(e,t,n)=>(e>50||n/e<=10)&&(t>50||n/t<=10)),Je(this,"checkSizeOfPartInClient",()=>{const{left:e,right:t,top:n,bottom:o,clientHeight:s,clientWidth:c,clientMin:d}=this._clientSize;let h,p,m,g;if(e<0)h=0;else{if(!(e<c))return!1;h=e}if(t<0)return!1;if(p=t<c?t:c,n<0)m=0;else{if(!(n<s))return!1;m=n}if(o<0)return!1;g=o<s?o:s;const E=p-h,y=g-m;return this.checkSizeIsVisible(E,y,d)}),Je(this,"returnHiddenResult",e=>(this._clientSize=null,{visible:!1,reason:e})),Je(this,"checkOneElementVisible",e=>{if(e instanceof HTMLElement){if(this.checkElementIsMountedOnDom(e)){if(this.checkActualCssVisibleIncludeInherit(e)){if(this._clientSize=this.getSizeAboutClient(e),this.checkElementCover(e))return this.returnHiddenResult(Pf.COVERED);{const t=this.checkActualSize(),n=this.checkSizeOfPartInClient();return t&&!n?this.returnHiddenResult(Pf.POSITION):t?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(Pf.SIZE)}}return this.returnHiddenResult(Pf.STYLE)}return this.returnHiddenResult(AR.UNMOUNTED)}return this.returnHiddenResult(AR.INVALID_HTML_ELEMENT)}),Je(this,"checkElementIsMountedOnDom",e=>this.checkPropertyUpToAllParentNodes(e,t=>t.nodeName.toUpperCase()!=="HTML"?t.parentElement!==null:!!document.documentElement))}};function NR(e){return new TextEncoder().encode(e)}const W2=function(e,t){const n=new Uint8Array(e.byteLength+t.byteLength);return n.set(new Uint8Array(e),0),n.set(new Uint8Array(t),e.byteLength),n},OR=async e=>function(t,n){let o="";return new Uint8Array(t).forEach(s=>{o+=s.toString(n).padStart(2,"0")}),o}(await crypto.subtle.digest("SHA-256",NR(e)),16);let pn=class{constructor(){Je(this,"_events",{}),Je(this,"addListener",this.on)}getListeners(e){return this._events[e]?this._events[e].map(t=>t.listener):[]}on(e,t){this._events[e]||(this._events[e]=[]);const n=this._events[e];this._indexOfListener(n,t)===-1&&n.push({listener:t,once:!1})}once(e,t){this._events[e]||(this._events[e]=[]);const n=this._events[e];this._indexOfListener(n,t)===-1&&n.push({listener:t,once:!0})}off(e,t){if(!this._events[e])return;const n=this._events[e],o=this._indexOfListener(n,t);o!==-1&&n.splice(o,1),this._events[e].length===0&&delete this._events[e]}removeAllListeners(e){e?delete this._events[e]:this._events={}}emit(e){this._events[e]||(this._events[e]=[]);const t=this._events[e].map(c=>c);for(var n=arguments.length,o=new Array(n>1?n-1:0),s=1;s<n;s++)o[s-1]=arguments[s];for(let c=0;c<t.length;c+=1){const d=t[c];d.once&&this.off(e,d.listener),d.listener.apply(this,o||[])}}safeEmit(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];[...this._events[e]||[]].forEach(s=>{s.once&&this.off(e,s.listener);try{s.listener.apply(this,n)}catch(c){console.error("safeEmit event:".concat(e," error ").concat(c==null?void 0:c.toString()))}})}_indexOfListener(e,t){let n=e.length;for(;n--;)if(e[n].listener===t)return n;return-1}},Df=null;function H2(){if(Df)return Df;if(window.electron)return Df=window.electron;if(!window.require)return null;try{return Df=window.require("electron"),Df}catch{return null}}let Nn=function(e){return e.CREATE_CLIENT="createClient",e.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",e.SET_AREA="setArea",e.PRELOAD="PRELOAD",e.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",e.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",e.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",e.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",e.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",e.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",e.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",e.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",e.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",e.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",e.START_PROXY_SERVER="Client.startProxyServer",e.STOP_PROXY_SERVER="Client.stopProxyServer",e.SET_PROXY_SERVER="Client.setProxyServer",e.SET_TURN_SERVER="Client.setTurnServer",e.SET_CLIENT_ROLE="Client.setClientRole",e.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",e.ENABLE_DUAL_STREAM="Client.enableDualStream",e.DISABLE_DUAL_STREAM="Client.disableDualStream",e.JOIN="Client.join",e.LEAVE="Client.leave",e.PUBLISH="Client.publish",e.UNPUBLISH="Client.unpublish",e.SUBSCRIBE="Client.subscribe",e.MASS_SUBSCRIBE="Client.massSubscribe",e.MASS_UNSUBSCRIBE="Client.massUnsubscribe",e.UNSUBSCRIBE="Client.unsubscribe",e.RENEW_TOKEN="Client.renewToken",e.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",e.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",e.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",e.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",e.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",e.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",e.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",e.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",e.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",e.START_LIVE_STREAMING="Client.startLiveStreaming",e.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",e.STOP_LIVE_STREAMING="Client.stopLiveStreaming",e.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",e.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",e.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",e.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",e.SET_CONFIG_DISTRIBUTE="_configDistribute",e.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",e.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",e.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",e.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",e.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",e.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",e.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",e.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",e.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",e.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",e.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",e.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",e.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",e.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",e.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",e.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",e.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",e.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",e.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",e.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",e.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",e.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",e.STREAM_TYPE_CHANGE="streamTypeChange",e.CONNECTION_STATE_CHANGE="connectionStateChange",e.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",e.IMAGE_MODERATION_UPLOAD="imageModerationUpload",e.REPUB_AFTER_PC_CONNECTED="repubAfterPCConnected",e}({}),En=function(e){return e.TRACER="tracer",e}({});function G2(e){return Ht(e.timeout,"config.timeout",0,1e5),Ht(e.timeoutFactor,"config.timeoutFactor",0,100,!1),Ht(e.maxRetryCount,"config.maxRetryConfig",0,1/0),Ht(e.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let Tie=function(e){return e[e.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",e[e.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",e[e.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",e}({}),Dt=function(e){return e.LEAVE="LEAVE",e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.UID_BANNED="UID_BANNED",e.FALLBACK="FALLBACK",e.IP_BANNED="IP_BANNED",e.CHANNEL_BANNED="CHANNEL_BANNED",e.LICENSE_MISSING="LICENSE_MISSING",e.LICENSE_EXPIRED="LICENSE_EXPIRED",e.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",e.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",e.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",e.LICENSE_ILLEGAL="LICENSE_ILLEGAL",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e}({});function kf(e){if(!Array.isArray(e)||e.length<1)return!1;try{e.forEach(t=>{if(!t.urls)throw Error()})}catch{return!1}return!0}function z2(e){return ar(e.turnServerURL,"turnServerURL"),ar(e.username,"username"),ar(e.password,"password"),e.udpport&&Ht(e.udpport,"udpport",1,99999,!0),e.forceturn&&za(e.forceturn,"forceturn"),e.security&&za(e.security,"security"),e.tcpport&&Ht(e.tcpport,"tcpport",1,99999,!0),!0}function PR(e){return e.level!==void 0&&Kn(e.level,"level",[1,2,3]),e.delay!==void 0&&Ht(e.delay,"delay",0,3e3,!0),!0}let mt=function(e){return e.PEERCONNECTION_STATE_CHANGE="peerconnection-state-change",e.AUDIO_METADATA="audio-metadata",e.CONNECTION_STATE_CHANGE="connection-state-change",e.MEDIA_RECONNECT_START="media-reconnect-start",e.MEDIA_RECONNECT_END="media-reconnect-end",e.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",e.USER_JOINED="user-joined",e.USER_LEAVED="user-left",e.USER_PUBLISHED="user-published",e.USER_UNPUBLISHED="user-unpublished",e.USER_INFO_UPDATED="user-info-updated",e.CLIENT_BANNED="client-banned",e.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",e.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",e.VOLUME_INDICATOR="volume-indicator",e.CRYPT_ERROR="crypt-error",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGED="stream-type-changed",e.STREAM_FALLBACK="stream-fallback",e.RECEIVE_METADATA="receive-metadata",e.STREAM_MESSAGE="stream-message",e.LIVE_STREAMING_ERROR="live-streaming-error",e.LIVE_STREAMING_WARNING="live-streaming-warning",e.EXCEPTION="exception",e.ERROR="error",e.P2P_LOST="p2p_lost",e.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",e.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",e.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",e.PUBLISHED_USER_LIST="published-user-list",e.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",e.CONTENT_INSPECT_ERROR="content-inspect-error",e.CONTENT_INSPECT_RESULT="content-inspect-result",e.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",e}({}),_r=function(e){return e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK",e.REGIONAL_DISTRIBUTION="REGIONAL_DISTRIBUTION",e}({}),xi=function(e){return e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({}),Ju=function(e){return e.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({});function Er(e,t){for(var n=arguments.length,o=new Array(n>2?n-2:0),s=2;s<n;s++)o[s-2]=arguments[s];return e.getListeners(t).length===0?ye.reject(new re(j.UNEXPECTED_ERROR,"can not emit promise")):new ye((c,d)=>{e.emit(t,...o,c,d)})}function Yt(e,t){if(e.getListeners(t).length===0)return ye.resolve();for(var n=arguments.length,o=new Array(n>2?n-2:0),s=2;s<n;s++)o[s-2]=arguments[s];return Er(e,t,...o)}function Yi(e,t){if(e.getListeners(t).length===0)return null;for(var n=arguments.length,o=new Array(n>2?n-2:0),s=2;s<n;s++)o[s-2]=arguments[s];return xf(e,t,...o)}function xf(e,t){let n=null,o=null;for(var s=arguments.length,c=new Array(s>2?s-2:0),d=2;d<s;d++)c[d-2]=arguments[d];if(e.emit(t,...c,h=>{n=h},h=>{o=h}),o!==null)throw o;if(n===null)throw new re(j.UNEXPECTED_ERROR,"handler is not sync");return n}const On=new class extends pn{set networkState(e){this.emit(Ju.NETWORK_STATE_CHANGE,e,this._networkState),e===xi.ONLINE?this.emit(Ju.ONLINE):e===xi.OFFLINE&&(this.onlineWaiter=new ye(t=>{this.once(Ju.ONLINE,()=>{this.onlineWaiter=void 0,t(xi.ONLINE)})}),this.emit(Ju.OFFLINE)),this._networkState=e}get networkState(){return this._networkState}get isOnline(){return this._networkState===xi.ONLINE}constructor(){super(),Je(this,"_moduleName","network-indicator"),Je(this,"_networkState",xi.ONLINE),Je(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=xi.ONLINE}),window.addEventListener("offline",()=>{this.networkState=xi.OFFLINE})}};function CE(e,t){const n=e.indexOf(t);n!==-1&&e.splice(n,1)}function Qu(e){const t=[];return e.forEach(n=>{t.indexOf(n)===-1&&t.push(n)}),t}function bE(e){ye!==void 0?ye.resolve().then(e):setTimeout(e,0)}function fn(e){return JSON.parse(JSON.stringify(e))}function rd(e){try{return fn(e)}catch{return e}}const K2={};function Dc(e,t){K2[t]||(K2[t]=!0,e())}function id(e){const t=window.atob(e),n=new Uint8Array(new ArrayBuffer(t.length));for(let o=0;o<t.length;o+=1)n[o]=t.charCodeAt(o);return n}function kc(e){let t="";for(let n=0;n<e.length;n+=1)t+=String.fromCharCode(e[n]);return window.btoa(t)}function Y2(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,n=new TextEncoder().encode(e);if(n.length>t)n=n.slice(0,t);else if(n.length<t){const o=new Uint8Array(t);o.set(n),n=o}return n}function q2(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const o=Fo(t).call(t,(d,h)=>d+h.length,0),s=new Uint8Array(new ArrayBuffer(o));let c=0;return t.forEach(d=>{s.set(d,c),c+=d.length}),s}function sa(e){return window.TextEncoder?new TextEncoder().encode(e).length:e.length}function X2(e){let t=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&e.realFormData&&(e=e.realFormData),e.forEach(n=>{t+=typeof n=="string"?sa(n):n.size}),t+138}function wie(e){const t=new re(j.TIMEOUT,"timeout");return new ye((n,o)=>{window.setTimeout(()=>o(t),e)})}function cr(e){return new ye(t=>{window.setTimeout(t,e)})}function Jt(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,t=arguments.length>1?arguments[1]:void 0;const n=Math.random().toString(16).substr(2,e).toLowerCase();return n.length===e?"".concat(t).concat(n):"".concat(t).concat(n)+Jt(e-n.length,"")}function od(){return Jt(32,"").toUpperCase()}const IE=()=>{},$2=new class{constructor(){Je(this,"fnMap",new Map)}throttleByKey(e,t,n,o){for(var s=arguments.length,c=new Array(s>4?s-4:0),d=4;d<s;d++)c[d-4]=arguments[d];if(this.fnMap.has(t)){const h=this.fnMap.get(t);if(h.threshold!==n){h.fn(...h.args),clearTimeout(h.timer);const p=window.setTimeout(()=>{const m=this.fnMap.get(t);m&&m.fn(...m.args),this.fnMap.delete(t)},n);this.fnMap.set(t,{fn:e,threshold:n,timer:p,args:c,skipFn:o})}else h.skipFn&&h.skipFn(...h.args),this.fnMap.set(t,Ce(Ce({},h),{},{fn:e,args:c,skipFn:o}))}else{const h=window.setTimeout(()=>{const p=this.fnMap.get(t);p&&p.fn(...p.args),this.fnMap.delete(t)},n);this.fnMap.set(t,{fn:e,threshold:n,timer:h,args:c,skipFn:o})}}},J2=$2.throttleByKey.bind($2);function Q2(e){return typeof e=="object"&&e!==null&&!(e instanceof RegExp)}function DR(e,t){if(!Q2(e)||!Q2(t)||Array.isArray(e)&&!Array.isArray(t)||!Array.isArray(e)&&Array.isArray(t))return t;if(Array.isArray(t)&&Array.isArray(e)){const n=[...e];for(let o=0;o<t.length;o++)n[o]=DR(e[o],t[o]);return n}{const n=Ce({},e);for(const o in t)Object.prototype.hasOwnProperty.call(t,o)&&(Object.prototype.hasOwnProperty.call(e,o)?n[o]=DR(e[o],t[o]):n[o]=t[o]);return n}}function Z2(e,t){let n=[0];if(n=new Array(t).fill(0),e===0)return n;let o=0;for(;e>0&&(n[o]=255&e,e>>=8,o++,o!==t););return n}function kR(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function xR(e){return Fo(e).call(e,(t,n)=>t+n,0)}function eM(e){const t="0123456789abcdef";function n(Y){let Q,J="";for(Q=0;Q<=3;Q++)J+=t.charAt(Y>>8*Q+4&15)+t.charAt(Y>>8*Q&15);return J}function o(Y,Q){const J=(65535&Y)+(65535&Q);return(Y>>16)+(Q>>16)+(J>>16)<<16|65535&J}function s(Y,Q,J,X,ne,oe){return o(function(me,we){return me<<we|me>>>32-we}(o(o(Q,Y),o(X,oe)),ne),J)}function c(Y,Q,J,X,ne,oe,me){return s(Q&J|~Q&X,Y,Q,ne,oe,me)}function d(Y,Q,J,X,ne,oe,me){return s(Q&X|J&~X,Y,Q,ne,oe,me)}function h(Y,Q,J,X,ne,oe,me){return s(Q^J^X,Y,Q,ne,oe,me)}function p(Y,Q,J,X,ne,oe,me){return s(J^(Q|~X),Y,Q,ne,oe,me)}const m=function(Y){let Q;const J=1+(Y.length+8>>6),X=new Array(16*J);for(Q=0;Q<16*J;Q++)X[Q]=0;for(Q=0;Q<Y.length;Q++)X[Q>>2]|=Y.charCodeAt(Q)<<Q%4*8;return X[Q>>2]|=128<<Q%4*8,X[16*J-2]=8*Y.length,X}(e);let g,E,y,T,P,I=1732584193,A=-271733879,M=-1732584194,U=271733878;for(g=0;g<m.length;g+=16)E=I,y=A,T=M,P=U,I=c(I,A,M,U,m[g+0],7,-680876936),U=c(U,I,A,M,m[g+1],12,-389564586),M=c(M,U,I,A,m[g+2],17,606105819),A=c(A,M,U,I,m[g+3],22,-1044525330),I=c(I,A,M,U,m[g+4],7,-176418897),U=c(U,I,A,M,m[g+5],12,1200080426),M=c(M,U,I,A,m[g+6],17,-1473231341),A=c(A,M,U,I,m[g+7],22,-45705983),I=c(I,A,M,U,m[g+8],7,1770035416),U=c(U,I,A,M,m[g+9],12,-1958414417),M=c(M,U,I,A,m[g+10],17,-42063),A=c(A,M,U,I,m[g+11],22,-1990404162),I=c(I,A,M,U,m[g+12],7,1804603682),U=c(U,I,A,M,m[g+13],12,-40341101),M=c(M,U,I,A,m[g+14],17,-1502002290),A=c(A,M,U,I,m[g+15],22,1236535329),I=d(I,A,M,U,m[g+1],5,-165796510),U=d(U,I,A,M,m[g+6],9,-1069501632),M=d(M,U,I,A,m[g+11],14,643717713),A=d(A,M,U,I,m[g+0],20,-373897302),I=d(I,A,M,U,m[g+5],5,-701558691),U=d(U,I,A,M,m[g+10],9,38016083),M=d(M,U,I,A,m[g+15],14,-660478335),A=d(A,M,U,I,m[g+4],20,-405537848),I=d(I,A,M,U,m[g+9],5,568446438),U=d(U,I,A,M,m[g+14],9,-1019803690),M=d(M,U,I,A,m[g+3],14,-187363961),A=d(A,M,U,I,m[g+8],20,1163531501),I=d(I,A,M,U,m[g+13],5,-1444681467),U=d(U,I,A,M,m[g+2],9,-51403784),M=d(M,U,I,A,m[g+7],14,1735328473),A=d(A,M,U,I,m[g+12],20,-1926607734),I=h(I,A,M,U,m[g+5],4,-378558),U=h(U,I,A,M,m[g+8],11,-2022574463),M=h(M,U,I,A,m[g+11],16,1839030562),A=h(A,M,U,I,m[g+14],23,-35309556),I=h(I,A,M,U,m[g+1],4,-1530992060),U=h(U,I,A,M,m[g+4],11,1272893353),M=h(M,U,I,A,m[g+7],16,-155497632),A=h(A,M,U,I,m[g+10],23,-1094730640),I=h(I,A,M,U,m[g+13],4,681279174),U=h(U,I,A,M,m[g+0],11,-358537222),M=h(M,U,I,A,m[g+3],16,-722521979),A=h(A,M,U,I,m[g+6],23,76029189),I=h(I,A,M,U,m[g+9],4,-640364487),U=h(U,I,A,M,m[g+12],11,-421815835),M=h(M,U,I,A,m[g+15],16,530742520),A=h(A,M,U,I,m[g+2],23,-995338651),I=p(I,A,M,U,m[g+0],6,-198630844),U=p(U,I,A,M,m[g+7],10,1126891415),M=p(M,U,I,A,m[g+14],15,-1416354905),A=p(A,M,U,I,m[g+5],21,-57434055),I=p(I,A,M,U,m[g+12],6,1700485571),U=p(U,I,A,M,m[g+3],10,-1894986606),M=p(M,U,I,A,m[g+10],15,-1051523),A=p(A,M,U,I,m[g+1],21,-2054922799),I=p(I,A,M,U,m[g+8],6,1873313359),U=p(U,I,A,M,m[g+15],10,-30611744),M=p(M,U,I,A,m[g+6],15,-1560198380),A=p(A,M,U,I,m[g+13],21,1309151649),I=p(I,A,M,U,m[g+4],6,-145523070),U=p(U,I,A,M,m[g+11],10,-1120210379),M=p(M,U,I,A,m[g+2],15,718787259),A=p(A,M,U,I,m[g+9],21,-343485551),I=o(I,E),A=o(A,y),M=o(M,T),U=o(U,P);return n(I)+n(A)+n(M)+n(U)}let Rie=1,tM=console,Ir=class{static setLogger(e){tM=e}constructor(e,t){Je(this,"id",void 0),Je(this,"lockingPromise",ye.resolve()),Je(this,"locks",0),Je(this,"name",""),Je(this,"lockId",void 0),this.lockId=Rie++,e&&(this.name=e),t&&(this.id=t),this.logger("created")}logger(e,t){const n=(this.id?"[".concat(this.id,"]"):"")+"[lock-".concat(this.name,"-").concat(this.lockId,"]"),o=e==="created"?"is ".concat(e,"."):"is ".concat(e,", current queue ").concat(this.locks,". ").concat(t??"");tM.debug("".concat(n," ").concat(o))}setId(e){this.id=e}get isLocked(){return this.locks>0}lock(e){let t;this.locks+=1,this.logger("locked",e);const n=new ye(s=>{t=()=>{this.locks-=1,this.logger("unlocked",e),s()}}),o=this.lockingPromise.then(()=>t);return this.lockingPromise=this.lockingPromise.then(()=>n),o}};function Zu(e,t){return function(n,o,s){const c=s.value;if(typeof c!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){const d=this[t];if(!d)throw new Error("mutex property key ".concat(t," doesn't exist on ").concat(e));const h=await d.lock("From ".concat(e,".").concat(o));try{for(var p=arguments.length,m=new Array(p),g=0;g<p;g++)m[g]=arguments[g];return await c.apply(this,m)}finally{h()}},s}}const Un={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function LR(e,t){const n=Math.floor(t.timeout*Math.pow(t.timeoutFactor,e));return Math.min(t.maxRetryTimeout,n)}function ws(e,t,n,o){const s=Object.assign({},Un,o);let c=s.timeout;const d=async()=>{await function(m){return new ye(g=>{window.setTimeout(g,m)})}(c),c*=s.timeoutFactor,c=Math.min(s.maxRetryTimeout,c)};let h=!1;const p=new ye(async(m,g)=>{t=t||(()=>!1),n=n||(()=>!0);for(let E=0;E<s.maxRetryCount;E+=1){if(h)return g(new re(j.OPERATION_ABORTED));try{const y=await e();if(!t(y,E)||E+1===s.maxRetryCount)return m(y);await d()}catch(y){if(!n(y,E)||E+1===s.maxRetryCount)return g(y);await d()}}});return p.cancel=()=>h=!0,p}let AE,nM=class{constructor(e){Je(this,"input",[]),Je(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}mean(){var e;return this.input.length===0?0:Fo(e=this.input).call(e,(t,n)=>t+n)/this.input.length}},NE=0,MR=0;function UR(e,t,n,o){return new ye((s,c)=>{t.responseType=t.responseType||"json",t.data&&!n?(t.data=JSON.stringify(t.data),NE+=sa(t.data)):n&&(t.data.size?NE+=t.data.size:t.data instanceof FormData?NE+=X2(t.data):NE+=sa(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,oi.request(t).then(d=>{typeof d.data=="string"?MR+=sa(d.data):d.data instanceof ArrayBuffer||d.data instanceof Uint8Array?MR+=d.data.byteLength:MR+=sa(JSON.stringify(d.data)),s(d.data)}).catch(d=>{oi.isCancel(d)?c(new re(j.OPERATION_ABORTED,"cancel token canceled")):d.code==="ECONNABORTED"?c(new re(j.NETWORK_TIMEOUT,d.message)):d.response?c(new re(j.NETWORK_RESPONSE_ERROR,d.response.status)):c(new re(j.NETWORK_ERROR,d.message))})})}async function Cie(e,t){const n=new Blob([t.data],{type:"buffer"});return await UR(e,Ce(Ce({},t),{},{data:n,headers:{"Content-Type":"application/octet-stream"}}),!0)}const rM=()=>window.isSecureContext!==void 0;function qo(e){if(Array.isArray(e))return e.map(n=>n);if(!iM(e))return e;const t={};for(const n in e){const o=e[n];iM(o)||Array.isArray(o)?t[n]=qo(o):t[n]=o}return t}function iM(e){return!(typeof e!="object"||Array.isArray(e)||!e)}let jR=class{constructor(e){Je(this,"input",[]),Je(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}};const aa={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},Lf={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:aa,remoteCandidate:aa},updateInterval:0},oM={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0,packetsDiscarded:0,framesAssembledFromMultiplePackets:0,totalProcessingDelay:0,avgDecodeMs:0,avgFramesAssembledFromMultiplePacketsMs:0,avgProcessingDelayMs:0,avgInterFrameDelayMs:0,totalAssemblyTime:0},sM={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},aM={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},cM={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0,totalSamplesReceived:0,silentConcealedSamples:0,concealmentEvents:0,freezeMs80:0,freezeMs200:0,freezeSamples80:0,freezeSamples200:0};let VR=class{constructor(e,t){Je(this,"onFirstVideoReceived",void 0),Je(this,"onFirstVideoDecoded",void 0),Je(this,"onFirstAudioReceived",void 0),Je(this,"onFirstVideoDecodedTimeout",void 0),Je(this,"onFirstAudioDecoded",void 0),Je(this,"onSelectedLocalCandidateChanged",void 0),Je(this,"onSelectedRemoteCandidateChanged",void 0),Je(this,"videoIsReady",!1),Je(this,"videoIsReady2",{}),Je(this,"pc",void 0),Je(this,"options",void 0),Je(this,"intervalTimer",void 0),Je(this,"stats",qo(Lf)),Je(this,"isFirstVideoReceived",{}),Je(this,"isFirstVideoDecoded",{}),Je(this,"isFirstAudioReceived",{}),Je(this,"isFirstAudioDecoded",{}),Je(this,"isFirstVideoDecodedTimeout",{}),Je(this,"lossRateWindowStats",[]),this.pc=e,this.options=t,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new ye(e=>{e({local:Ce({},aa),remote:Ce({},aa)})})}setVideoIsReady(e){this.videoIsReady=e}setVideoIsReady2(e,t){this.videoIsReady2[e]=t}getVideoIsReady(e){return this.videoIsReady2[e]||!1}setIsFirstAudioDecoded(e){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(e){this.lossRateWindowStats.push(e),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const t=this.lossRateWindowStats.length,n=["videoSend","audioSend","videoRecv","audioRecv"];let o=0,s=0,c=0,d=0;for(const h of n)e[h].forEach((p,m)=>{if(!this.lossRateWindowStats[t-1][h][m]||!this.lossRateWindowStats[0][h][m])return;const g=this.lossRateWindowStats[t-1][h][m].packets-this.lossRateWindowStats[0][h][m].packets,E=this.lossRateWindowStats[t-1][h][m].packetsLost-this.lossRateWindowStats[0][h][m].packetsLost;h==="videoSend"||h==="audioSend"?(o+=g,c+=E):(s+=g,d+=E),Number.isNaN(g)||Number.isNaN(g)?p.packetLostRate=0:p.packetLostRate=g<=0||E<=0?0:E/(g+E)});e.sendPacketLossRate=o<=0||c<=0?0:c/(o+c),e.recvPacketLossRate=s<=0||d<=0?0:d/(s+d)}},bie=class extends VR{constructor(){super(...arguments),Je(this,"_stats",Lf),Je(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const e=await this._getStats(),t=this.statsResponsesToObjects(e);this._stats=qo(Lf);const n=t.filter(s=>s.type==="ssrc");this.processSSRCStats(n);const o=t.find(s=>s.type==="VideoBwe");o&&this.processBandwidthStats(o),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(e){this._stats.bitrate={actualEncoded:Number(e.googActualEncBitrate),targetEncoded:Number(e.googTargetEncBitrate),retransmit:Number(e.googRetransmitBitrate),transmit:Number(e.googTransmitBitrate)},this._stats.sendBandwidth=Number(e.googAvailableSendBandwidth)}processSSRCStats(e){e.forEach(t=>{var n;const o=Ee(n=t.id).call(n,"send");switch("".concat(t.mediaType,"_").concat(o?"send":"recv")){case"video_send":{const s=qo(sM);s.codec=t.googCodecName,s.adaptionChangeReason="none",t.googCpuLimitedResolution&&(s.adaptionChangeReason="cpu"),t.googBandwidthLimitedResolution&&(s.adaptionChangeReason="bandwidth"),s.avgEncodeMs=Number(t.googAvgEncodeMs),s.inputFrame={width:Number(t.googFrameWidthInput)||Number(t.googFrameWidthSent),height:Number(t.googFrameHeightInput)||Number(t.googFrameHeightSent),frameRate:Number(t.googFrameRateInput)},s.sentFrame={width:Number(t.googFrameWidthSent),height:Number(t.googFrameHeightSent),frameRate:Number(t.googFrameRateInput)},s.firsCount=Number(t.googFirReceived),s.nacksCount=Number(t.googNacksReceived),s.plisCount=Number(t.googPlisReceived),s.frameCount=Number(t.framesEncoded),s.bytes=Number(t.bytesSent),s.packets=Number(t.packetsSent),s.packetsLost=Number(t.packetsLost),s.ssrc=Number(t.ssrc),s.rttMs=Number(t.googRtt||0),this._stats.videoSend.push(s),this._stats.rtt=s.rttMs;break}case"video_recv":{const s=qo(oM),c=this.lastDecodeVideoReceiverStats.get(Number(t.ssrc));if(s.codec=t.googCodecName,s.targetDelayMs=Number(t.googTargetDelayMs),s.renderDelayMs=Number(t.googRenderDelayMs),s.currentDelayMs=Number(t.googCurrentDelayMs),s.minPlayoutDelayMs=Number(t.googMinPlayoutDelayMs),s.decodeMs=Number(t.googDecodeMs),s.maxDecodeMs=Number(t.googMaxDecodeMs),s.receivedFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateReceived)},s.decodedFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateDecoded)},s.decodeFrameRate=Number(t.googFrameRateDecoded),s.outputFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateOutput)},s.jitterBufferMs=Number(t.googJitterBufferMs),s.firsCount=Number(t.googFirsSent),s.nacksCount=Number(t.googNacksSent),s.plisCount=Number(t.googPlisSent),s.framesDecodeCount=Number(t.framesDecoded),s.bytes=Number(t.bytesReceived),s.packets=Number(t.packetsReceived),s.packetsLost=Number(t.packetsLost),s.ssrc=Number(t.ssrc),s.packets>0&&!this.isFirstVideoReceived[s.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(s.ssrc),this.isFirstVideoReceived[s.ssrc]=!0),s.framesDecodeCount>0&&!this.isFirstVideoDecoded[s.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(s.ssrc,s.decodedFrame.width,s.decodedFrame.height),this.isFirstVideoDecoded[s.ssrc]=!0),c){const d=c.stats,h=Date.now()-c.lts;s.framesDecodeFreezeTime=d.framesDecodeFreezeTime,s.framesDecodeInterval=d.framesDecodeInterval,s.framesDecodeCount>d.framesDecodeCount&&this.isFirstVideoDecoded[s.ssrc]?(c.lts=Date.now(),s.framesDecodeInterval=h,s.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(t.ssrc,10))?s.framesDecodeFreezeTime+=s.framesDecodeInterval:this.setVideoIsReady2(parseInt(t.ssrc,10),!0))):s.framesDecodeCount<c.stats.framesDecodeCount&&(s.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(s.ssrc,{stats:Ce({},s),lts:Date.now()}),this._stats.videoRecv.push(s);break}case"audio_recv":{const s=qo(cM);s.codec=t.googCodecName,s.outputLevel=Math.abs(Number(t.audioOutputLevel))/32767,s.decodingCNG=Number(t.googDecodingCNG),s.decodingCTN=Number(t.googDecodingCTN),s.decodingCTSG=Number(t.googDecodingCTSG),s.decodingNormal=Number(t.googDecodingNormal),s.decodingPLC=Number(t.googDecodingPLC),s.decodingPLCCNG=Number(t.googDecodingPLCCNG),s.expandRate=Number(t.googExpandRate),s.accelerateRate=Number(t.googAccelerateRate),s.preemptiveExpandRate=Number(t.googPreemptiveExpandRate),s.secondaryDecodedRate=Number(t.googSecondaryDecodedRate),s.speechExpandRate=Number(t.googSpeechExpandRate),s.preferredJitterBufferMs=Number(t.googPreferredJitterBufferMs),s.jitterBufferMs=Number(t.googJitterBufferMs),s.jitterMs=Number(t.googJitterReceived),s.bytes=Number(t.bytesReceived),s.packets=Number(t.packetsReceived),s.packetsLost=Number(t.packetsLost),s.ssrc=Number(t.ssrc),s.receivedFrames=Number(t.googDecodingCTN)||Number(t.packetsReceived),s.droppedFrames=Number(t.googDecodingPLC)+Number(t.googDecodingPLCCNG)||Number(t.packetsLost),s.receivedFrames>0&&!this.isFirstAudioReceived[s.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(s.ssrc),this.isFirstAudioReceived[s.ssrc]=!0),s.decodingNormal>0&&!this.isFirstAudioDecoded[s.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(s.ssrc),this.isFirstAudioDecoded[s.ssrc]=!0),this._stats.audioRecv.push(s);break}case"audio_send":{const s=qo(aM);s.codec=t.googCodecName,s.inputLevel=Math.abs(Number(t.audioInputLevel))/32767,s.aecReturnLoss=Number(t.googEchoCancellationReturnLoss||0),s.aecReturnLossEnhancement=Number(t.googEchoCancellationReturnLossEnhancement||0),s.residualEchoLikelihood=Number(t.googResidualEchoLikelihood||0),s.residualEchoLikelihoodRecentMax=Number(t.googResidualEchoLikelihoodRecentMax||0),s.bytes=Number(t.bytesSent),s.packets=Number(t.packetsSent),s.packetsLost=Number(t.packetsLost),s.ssrc=Number(t.ssrc),s.rttMs=Number(t.googRtt||0),this._stats.rtt=s.rttMs,this._stats.audioSend.push(s);break}}})}_getStats(){return new ye((e,t)=>{this.pc.getStats(e,t)})}statsResponsesToObjects(e){const t=[];return e.result().forEach(n=>{const o={id:n.id,timestamp:n.timestamp.valueOf().toString(),type:n.type};n.names().forEach(s=>{o[s]=n.stat(s)}),t.push(o)}),t}},Mf=function(e){return e.BANDWIDTH="bandwidth",e.CPU="cpu",e.NONE="none",e.OTHER="other",e}({}),OE=function(e){return e.L1T1="L1T1",e.L1T2="L1T2",e.L1T3="L1T3",e.L1T3_KEY="L1T3_KEY",e.L2T1_KEY="L2T1_KEY",e.L2T2_KEY="L2T2_KEY",e.L2T3_KEY="L2T3_KEY",e.L3T1_KEY="L3T1_KEY",e.L3T2_KEY="L3T2_KEY",e.L3T3_KEY="L3T3_KEY",e}({}),FR=function(e){return e[e.new=0]="new",e[e.connecting=1]="connecting",e[e.connected=2]="connected",e[e.disconnected=3]="disconnected",e[e.failed=4]="failed",e[e.closed=5]="closed",e}({}),qi=function(e){return e.CERTIFICATE="certificate",e.CODEC="codec",e.CANDIDATE_PAIR="candidate-pair",e.LOCAL_CANDIDATE="local-candidate",e.REMOTE_CANDIDATE="remote-candidate",e.INBOUND="inbound-rtp",e.TRACK="track",e.OUTBOUND="outbound-rtp",e.PC="peer-connection",e.REMOTE_INBOUND="remote-inbound-rtp",e.REMOTE_OUTBOUND="remote-outbound-rtp",e.TRANSPORT="transport",e.CSRC="csrc",e.DATA_CHANNEL="data-channel",e.STREAM="stream",e.SENDER="sender",e.RECEIVER="receiver",e}({});var eh=function(e){return e[e.kNone=1]="kNone",e[e.kMillisecondsFromSeconds=1e3]="kMillisecondsFromSeconds",e[e.kBytesToBits=8]="kBytesToBits",e}(eh||{});function Uf(e,t,n,o){let s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:eh.kNone;if(!t)return;const c=Number(t[n]);if(typeof c!="number")return;const d=Number(t[o]);if(typeof d!="number")return;if(!e)return d?c/d*s:void 0;const h=Number(e[n]);if(typeof h!="number")return;const p=Number(e[o]);if(typeof p!="number")return;const m=d-p;return m?(c-h)/m*s:void 0}let lM=class extends VR{constructor(){super(...arguments),Je(this,"_stats",Lf),Je(this,"report",void 0),Je(this,"lastDecodeVideoReceiverStats",new Map),Je(this,"lastVideoFramesRecv",new Map),Je(this,"lastVideoFramesSent",new Map),Je(this,"lastVideoFramesDecode",new Map),Je(this,"lastVideoFramesOutput",new Map),Je(this,"lastVideoJBDelay",new Map),Je(this,"lastAudioJBDelay",new Map),Je(this,"mediaBytesSent",new Map),Je(this,"mediaBytesRetransmit",new Map),Je(this,"mediaBytesTargetEncode",new Map),Je(this,"lastDecodeAudioReceiverStats",new Map),Je(this,"lastAudioConcealment",new Map),Je(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=qo(Lf),this.report.forEach(e=>{switch(e.type){case qi.OUTBOUND:case qi.INBOUND:{const t=e.mediaType||e.kind,n=!t&&"frameWidth"in e,o=!t&&!("frameWidth"in e);e.type===qi.OUTBOUND?t==="audio"||o?this.processAudioOutboundStats(e):(t==="video"||n)&&this.processVideoOutboundStats(e):e.type===qi.INBOUND&&(t==="audio"||o?this.processAudioInboundStats(e):(t==="video"||n)&&this.processVideoInboundStats(e));break}case qi.TRANSPORT:{const t=this.report.get(e.selectedCandidatePairId);t&&this.processCandidatePairStats(t);break}case qi.CANDIDATE_PAIR:e.selected&&this.processCandidatePairStats(e)}}),this.updateSendBitrate(),this._stats.updateInterval=Date.now()-this.stats.timestamp,this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const e=await this.pc.getStats(),t={local:Ce({},aa),remote:Ce({},aa)};return e.forEach(n=>{let o;if(n.type===qi.TRANSPORT&&(o=e.get(n.selectedCandidatePairId)),n.type===qi.CANDIDATE_PAIR&&n.selected&&(o=n),o){const s=(c,d)=>{c.type=d.type,c.id=d.id,d.address&&(c.address=d.address),d.candidateType&&(c.candidateType=d.candidateType),d.port&&(c.port=d.port),d.priority&&(c.priority=d.priority),d.protocol&&(c.protocol=d.protocol),d.relayProtocol&&(c.relayProtocol=d.relayProtocol)};if(o.localCandidateId){const c=e.get(o.localCandidateId);c&&s(t.local,c)}if(o.remoteCandidateId){const c=e.get(o.remoteCandidateId);c&&s(t.remote,c)}}}),t}processCandidatePairStats(e){if(this._stats.sendBandwidth=e.availableOutgoingBitrate||0,e.currentRoundTripTime&&(this._stats.rtt=1e3*e.currentRoundTripTime),this._stats.videoSend.forEach(t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)}),this._stats.audioSend.forEach(t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=e.id,e.localCandidateId){const t=this.report.get(e.localCandidateId);t&&this.processCandidateStats(t)}if(e.remoteCandidateId){const t=this.report.get(e.remoteCandidateId);t&&this.processCandidateStats(t)}}processCandidateStats(e){let t;e.type===qi.LOCAL_CANDIDATE&&(t=this._stats.selectedCandidatePair.localCandidate),e.type===qi.REMOTE_CANDIDATE&&(t=this._stats.selectedCandidatePair.remoteCandidate),t&&(t.type=e.type,t.id=e.id,e.address&&(t.address=e.address),e.candidateType&&(t.candidateType=e.candidateType),e.port&&(t.port=e.port),e.priority&&(t.priority=e.priority),e.protocol&&(t.protocol=e.protocol),e.relayProtocol&&(t.relayProtocol=e.relayProtocol),e.type===qi.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==t.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(Ce({},t),Ce({},this.stats.selectedCandidatePair.localCandidate)),e.type===qi.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==t.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(Ce({},t),Ce({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(e){let t=this._stats.audioRecv.find(o=>o.ssrc===e.ssrc);t||(t=qo(cM),this._stats.audioRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.packetsDiscarded=e.packetsDiscarded,t.bytes=e.bytesReceived,t.jitterMs=1e3*e.jitter,t.retransmittedBytesReceived=e.retransmittedBytesReceived,t.retransmittedPacketsReceived=e.retransmittedPacketsReceived,t.totalProcessingDelay=e.totalProcessingDelay,t.jitterBufferEmittedCount=e.jitterBufferEmittedCount;const n=this.lastDecodeAudioReceiverStats.get(t.ssrc);t.avgProcessingDelayMs=Uf(n,t,"totalProcessingDelay","jitterBufferEmittedCount",eh.kMillisecondsFromSeconds),this.processAudioTrackReceiverStats(e,e.trackId,t),this.calculateAudioFreeze(t,n,e),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),t.receivedFrames||(t.receivedFrames=e.packetsReceived),t.droppedFrames||(t.droppedFrames=e.packetsLost),t.receivedFrames>0&&!this.isFirstAudioReceived[t.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(t.ssrc),this.isFirstAudioReceived[t.ssrc]=!0),t.outputLevel&&t.outputLevel>0&&!this.isFirstAudioDecoded[t.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(t.ssrc),this.isFirstAudioDecoded[t.ssrc]=!0),typeof e.concealedSamples=="number"&&(t.concealedSamples=e.concealedSamples),this.lastDecodeAudioReceiverStats.set(t.ssrc,Ce({},t))}calculateAudioFreeze(e,t,n){const o=this.lastAudioConcealment.get(e.ssrc);if(t!=null&&o!=null){const s=o.lts,c=n.timestamp,d=c-s;if(d<=0)return;const h=e.concealedSamples-t.concealedSamples-0,p=o.nonSilent+h,m=e.totalSamplesReceived-t.totalSamplesReceived;if(m<=0)return;const g=80*m/d,E=200*m/d,y=d/m;let T=0;e.freezeSamples80=t.freezeSamples80,e.freezeMs80=t.freezeMs80,p>g&&(o.plc80>0?(e.freezeSamples80+=h,e.freezeMs80+=Math.round(h*y)):(e.freezeSamples80+=p,e.freezeMs80+=Math.round(p*y)),T=o.plc80+1);let P=0;e.freezeSamples200=t.freezeSamples200,e.freezeMs200=t.freezeMs200,p>E&&(o.plc200>0?(e.freezeSamples200+=h,e.freezeMs200+=Math.round(h*y)):(e.freezeSamples200+=p,e.freezeMs200+=Math.round(p*y)),P=o.plc200+1),this.lastAudioConcealment.set(e.ssrc,{nonSilent:h,lts:c,plc80:T,plc200:P})}else e.freezeSamples80=0,e.freezeSamples200=0,e.freezeMs80=0,e.freezeMs200=0,this.lastAudioConcealment.set(e.ssrc,{nonSilent:0,lts:n.timestamp,plc80:0,plc200:0})}processVideoInboundStats(e){let t=this._stats.videoRecv.find(d=>d.ssrc===e.ssrc);t||(t=qo(oM),this._stats.videoRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.bytes=e.bytesReceived,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.framesDecodeCount=e.framesDecoded,t.framesDroppedCount=e.framesDropped,t.totalInterFrameDelay=e.totalInterFrameDelay,t.totalSquaredInterFrameDelay=e.totalSquaredInterFrameDelay,t.totalFreezesDuration=e.totalFreezesDuration,t.totalProcessingDelay=e.totalProcessingDelay,t.packetsDiscarded=e.packetsDiscarded,t.framesAssembledFromMultiplePackets=e.framesAssembledFromMultiplePackets,t.totalAssemblyTime=e.totalAssemblyTime,t.keyFramesDecoded=e.keyFramesDecoded,t.retransmittedBytesReceived=e.retransmittedBytesReceived,t.retransmittedPacketsReceived=e.retransmittedPacketsReceived;const n=this.lastDecodeVideoReceiverStats.get(t.ssrc),o=this.lastVideoFramesDecode.get(t.ssrc),s=this.lastVideoFramesOutput.get(t.ssrc),c=Date.now();if(t.framesDecodeCount>0&&!this.isFirstVideoDecoded[t.ssrc]){const d=t.decodedFrame?t.decodedFrame.width:0,h=t.decodedFrame?t.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(t.ssrc,d,h),this.isFirstVideoDecoded[t.ssrc]=!0}if(n){const d=n.stats,h=c-n.lts;t.framesDecodeFreezeTime=d.framesDecodeFreezeTime,t.framesDecodeInterval=d.framesDecodeInterval,!this.isFirstVideoDecoded[t.ssrc]&&h>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[t.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(t.ssrc),this.isFirstVideoDecodedTimeout[t.ssrc]=!0),t.framesDecodeCount>d.framesDecodeCount&&this.isFirstVideoDecoded[t.ssrc]?(n.lts=Date.now(),t.framesDecodeInterval=h,t.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc))?t.framesDecodeFreezeTime+=t.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):t.framesDecodeCount<d.framesDecodeCount&&(t.framesDecodeInterval=0),e.framesDecoded&&e.qpSum&&(n.stats.framesDecodeCount>e.framesDecoded?t.qpSumPerFrame=e.qpSum/e.framesDecoded:t.qpSumPerFrame=(e.qpSum-n.qpSum)/(e.framesDecoded-n.stats.framesDecodeCount))}e.totalDecodeTime&&(t.decodeMs=1e3*e.totalDecodeTime,t.avgDecodeMs=Uf(n==null?void 0:n.stats,t,"decodeMs","framesDecodeCount")),t.avgProcessingDelayMs=Uf(n==null?void 0:n.stats,t,"totalProcessingDelay","framesDecodeCount",eh.kMillisecondsFromSeconds),t.avgFramesAssembledFromMultiplePacketsMs=Uf(n==null?void 0:n.stats,t,"totalAssemblyTime","framesAssembledFromMultiplePackets",eh.kMillisecondsFromSeconds),t.avgInterFrameDelayMs=Uf(n==null?void 0:n.stats,t,"totalInterFrameDelay","framesDecodeCount",eh.kMillisecondsFromSeconds),o&&c-o.lts>=800?(t.decodeFrameRate=Math.round((t.framesDecodeCount-o.count)/((c-o.lts)/1e3)),this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:c,rate:t.decodeFrameRate})):o?t.decodeFrameRate=o.rate:this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:c,rate:0}),t.framesDroppedCount&&e.framesReceived&&(s&&c-s.lts>=800?(t.outputFrameRate=Math.round((e.framesReceived-t.framesDroppedCount-s.count)/((c-s.lts)/1e3)),this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:c,rate:Math.max(t.outputFrameRate,0)})):s?t.outputFrameRate=s.rate:this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:c,rate:0})),this.processVideoTrackReceiverStats(e,e.trackId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.framerateMean&&(t.framesRateFirefox=e.framerateMean),t.packets>0&&!this.isFirstVideoReceived[t.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(t.ssrc),this.isFirstVideoReceived[t.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(t.ssrc,{stats:Ce({},t),lts:n?n.lts:Date.now(),qpSum:e.qpSum})}processVideoOutboundStats(e){let t=this._stats.videoSend.find(o=>o.ssrc===e.ssrc);t||(t=qo(sM),this._stats.videoSend.push(t));const n=this.mediaBytesSent.get(e.ssrc);if(n)n.add(e.bytesSent);else{const o=new jR(10);o.add(e.bytesSent),this.mediaBytesSent.set(e.ssrc,o)}if(e.retransmittedBytesSent!==void 0){const o=this.mediaBytesRetransmit.get(e.ssrc);if(o)o.add(e.retransmittedBytesSent);else{const s=new jR(10);s.add(e.retransmittedBytesSent),this.mediaBytesRetransmit.set(e.ssrc,s)}}if(e.totalEncodedBytesTarget){const o=this.mediaBytesTargetEncode.get(e.ssrc);if(o)o.add(e.totalEncodedBytesTarget);else{const s=new jR(10);s.add(e.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(e.ssrc,s)}}if(t.ssrc=e.ssrc,t.bytes=e.bytesSent,t.packets=e.packetsSent,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.frameCount=e.framesEncoded,t.adaptionChangeReason=e.qualityLimitationReason,t.scalabilityMode=e.scalabilityMode,t.retransmittedBytesSent=e.retransmittedBytesSent,t.retransmittedPacketsSent=e.retransmittedPacketsSent,t.hugeFramesSent=e.hugeFramesSent,t.keyFramesEncoded=e.keyFramesEncoded,t.targetBitrate=e.targetBitrate,e.totalEncodeTime&&e.framesEncoded){const o=this.lastEncoderMs.get(e.ssrc);if(!o||o.lastFrameCount>e.framesEncoded)t.avgEncodeMs=1e3*e.totalEncodeTime/e.framesEncoded;else{const s=e.framesEncoded-o.lastFrameCount,c=e.totalEncodeTime-o.lastEncoderTime;t.avgEncodeMs=1e3*c/s}}if(e.framesEncoded&&e.qpSum){const o=this.lastEncoderMs.get(e.ssrc);!o||o.lastFrameCount>e.framesEncoded?t.qpSumPerFrame=e.qpSum/e.framesEncoded:t.qpSumPerFrame=(e.qpSum-o.lastQpSum)/(e.framesEncoded-o.lastFrameCount)}if(this.lastEncoderMs.set(e.ssrc,{lastFrameCount:e.framesEncoded,lastEncoderTime:e.totalEncodeTime,lastQpSum:e.qpSum,lts:Date.now()}),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.mediaSourceId&&this.processVideoMediaSource(e.mediaSourceId,t),this.processVideoTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{const o=this.findRemoteStatsId(e.ssrc,qi.REMOTE_INBOUND);o&&this.processRemoteInboundStats(o,t)}}processAudioOutboundStats(e){let t=this._stats.audioSend.find(n=>n.ssrc===e.ssrc);if(t||(t=qo(aM),this._stats.audioSend.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsSent,t.bytes=e.bytesSent,t.retransmittedBytesSent=e.retransmittedBytesSent,t.retransmittedPacketsSent=e.retransmittedPacketsSent,e.mediaSourceId&&this.processAudioMediaSource(e.mediaSourceId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),this.processAudioTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{const n=this.findRemoteStatsId(e.ssrc,qi.REMOTE_INBOUND);n&&this.processRemoteInboundStats(n,t)}}findRemoteStatsId(e,t){var n;const o=Array.from(Pi(n=this.report).call(n)).find(s=>s.type===t&&s.ssrc===e);return o?o.id:null}processVideoMediaSource(e,t){const n=this.report.get(e);n&&n.width&&n.height&&n.framesPerSecond&&(t.inputFrame={width:n.width,height:n.height,frameRate:n.framesPerSecond})}processAudioMediaSource(e,t){const n=this.report.get(e);n&&(t.inputLevel=n.audioLevel)}processVideoTrackSenderStats(e,t,n){var o,s,c,d;const h=t?this.report.get(t):void 0,p=(o=h==null?void 0:h.framesSent)!==null&&o!==void 0?o:e.framesSent;if(typeof p!="number")return;let m=(s=h==null?void 0:h.frameWidth)!==null&&s!==void 0?s:e.frameWidth,g=(c=h==null?void 0:h.frameHeight)!==null&&c!==void 0?c:e.frameHeight,E=(d=h==null?void 0:h.framesPerSecond)!==null&&d!==void 0?d:e.framesPerSecond;if(typeof m=="number"&&typeof g=="number"||(m=0,g=0),E==null){const y=Date.now(),T=this.lastVideoFramesSent.get(n.ssrc);T&&y-T.lts>=800?(E=Math.round((p-T.count)/((y-T.lts)/1e3)),this.lastVideoFramesSent.set(n.ssrc,{count:p,lts:y,rate:E})):T?E=T.rate:this.lastVideoFramesSent.set(n.ssrc,{count:p,lts:y,rate:0})}n.sentFrame={width:m,height:g,frameRate:Math.max(0,E)}}processVideoTrackReceiverStats(e,t,n){var o,s,c,d,h;const p=t?this.report.get(t):void 0,m=(o=p==null?void 0:p.framesReceived)!==null&&o!==void 0?o:e.framesReceived,g=(s=p==null?void 0:p.frameWidth)!==null&&s!==void 0?s:e.frameWidth,E=(c=p==null?void 0:p.frameHeight)!==null&&c!==void 0?c:e.frameHeight,y=(d=p==null?void 0:p.jitterBufferDelay)!==null&&d!==void 0?d:e.jitterBufferDelay,T=(h=p==null?void 0:p.jitterBufferEmittedCount)!==null&&h!==void 0?h:e.jitterBufferEmittedCount;if(typeof m=="number"){const P=this.lastVideoFramesRecv.get(n.ssrc),I=Date.now();n.framesReceivedCount=m;let A=0;P&&I-P.lts>=800?(A=Math.round((m-P.count)/((I-P.lts)/1e3)),this.lastVideoFramesRecv.set(n.ssrc,{count:m,lts:I,rate:A})):P?A=P.rate:this.lastVideoFramesRecv.set(n.ssrc,{count:m,lts:I,rate:0}),n.receivedFrame={width:g||0,height:E||0,frameRate:A||0},n.decodedFrame={width:g||0,height:E||0,frameRate:n.decodeFrameRate||0},n.outputFrame={width:g||0,height:E||0,frameRate:n.outputFrameRate||n.decodeFrameRate||0}}if(y&&T){const P=this.lastVideoJBDelay.get(n.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let I=P.jitterBufferMs;const A=T-P.jitterBufferEmittedCount;A>0&&(I=1e3*(y-P.jitterBufferDelay)/A),n.jitterBufferMs=I,n.currentDelayMs=Math.round(I),this.lastVideoJBDelay.set(n.ssrc,{jitterBufferDelay:y,jitterBufferEmittedCount:T,jitterBufferMs:n.currentDelayMs})}}processAudioTrackSenderStats(e,t,n){var o,s,c,d;const h=t?this.report.get(t):void 0,p=(o=(s=h==null?void 0:h.echoReturnLoss)!==null&&s!==void 0?s:e.echoReturnLoss)!==null&&o!==void 0?o:0,m=(c=(d=h==null?void 0:h.echoReturnLossEnhancement)!==null&&d!==void 0?d:e.echoReturnLossEnhancement)!==null&&c!==void 0?c:0;n.aecReturnLoss=p,n.aecReturnLossEnhancement=m}processAudioTrackReceiverStats(e,t,n){var o,s,c,d,h,p,m,g,E;const y=t?this.report.get(t):void 0,T=(o=y==null?void 0:y.removedSamplesForAcceleration)!==null&&o!==void 0?o:e.removedSamplesForAcceleration,P=(s=y==null?void 0:y.totalSamplesReceived)!==null&&s!==void 0?s:e.totalSamplesReceived,I=(c=y==null?void 0:y.jitterBufferDelay)!==null&&c!==void 0?c:e.jitterBufferDelay,A=(d=y==null?void 0:y.jitterBufferEmittedCount)!==null&&d!==void 0?d:e.jitterBufferEmittedCount,M=(h=y==null?void 0:y.audioLevel)!==null&&h!==void 0?h:e==null?void 0:e.audioLevel,U=(p=y==null?void 0:y.totalSamplesDuration)!==null&&p!==void 0?p:e==null?void 0:e.totalSamplesDuration,Y=(m=y==null?void 0:y.concealedSamples)!==null&&m!==void 0?m:e.concealedSamples,Q=(g=y==null?void 0:y.silentConcealedSamples)!==null&&g!==void 0?g:e.silentConcealedSamples,J=(E=y==null?void 0:y.concealmentEvents)!==null&&E!==void 0?E:e.concealmentEvents;if(typeof P=="number"&&(n.totalSamplesReceived=P),typeof Q=="number"&&(n.silentConcealedSamples=Q),typeof J=="number"&&(n.concealmentEvents=J),typeof Y=="number"&&(n.concealedSamples=Y),T&&P&&(n.accelerateRate=T/P),I&&A){const ne=this.lastAudioJBDelay.get(n.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let oe=ne.jitterBufferMs;const me=A-ne.jitterBufferEmittedCount;me>0&&(oe=1e3*(I-ne.jitterBufferDelay)/me),n.jitterBufferMs=Math.round(oe),this.lastAudioJBDelay.set(n.ssrc,{jitterBufferDelay:I,jitterBufferEmittedCount:A,jitterBufferMs:n.jitterBufferMs})}n.outputLevel=M;let X=1920;U&&P&&(X=P/U/50,n.receivedFrames=Math.round(P/X)),Y&&(n.droppedFrames=Math.round(Y/X))}processRemoteInboundStats(e,t){const n=this.report.get(e);n&&(t.packetsLost=n.packetsLost,n.roundTripTime&&(t.rttMs=1e3*n.roundTripTime),n.jitter&&(t.jitterMs=1e3*n.jitter),n.timestamp&&(t.timestamp=n.timestamp))}getCodecFromCodecStats(e){const t=this.report.get(e);if(!t)return"";const n=t.mimeType.match(/\/(.*)$/);return n&&n[1]?n[1]:""}updateSendBitrate(){let e=0,t=null,n=null;this.mediaBytesSent.forEach(s=>{e+=s.diffMean()}),this.mediaBytesRetransmit.forEach(s=>{t=t===null?s.diffMean():t+s.diffMean()}),this.mediaBytesTargetEncode.forEach(s=>{n=n===null?s.diffMean():n+s.diffMean()});const o=t!==null?e-t:e;this._stats.bitrate={actualEncoded:8*o/(this.options.updateInterval/1e3),transmit:8*e/(this.options.updateInterval/1e3)},t!==null&&(this._stats.bitrate.retransmit=8*t/(this.options.updateInterval/1e3)),n!==null&&(this._stats.bitrate.targetEncoded=8*n/(this.options.updateInterval/1e3))}},Iie=class extends VR{updateStats(){return ye.resolve()}};function BR(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4;const c=function(){const d=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return d&&d[0]?Number(d[0].split("/")[1]):null}();return c?c<76?new bie(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:o,firstVideoDecodedTimeout:s}):new lM(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:o,firstVideoDecodedTimeout:s}):function(d){if(!window.RTCStatsReport)return!1;const h=d.getStats();return!!(h instanceof ye||function(p){return!!p&&(typeof p=="object"||typeof p=="function")&&typeof p.then=="function"}(h))}(e)?new lM(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:o,firstVideoDecodedTimeout:s}):new Iie(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:o,firstVideoDecodedTimeout:s})}const dM="websdk_ng_install_id";function WR(){try{if(H("INSTALL_ID"))return H("INSTALL_ID");let e=window.localStorage.getItem(dM);return e||(e=od(),window.localStorage.setItem(dM,e)),jt("INSTALL_ID",e),e}catch{return}}const po=function(e){if(e.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return e;const t=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(t&&t[1]&&t[2]){const n=t[1],o=t[2];return"".concat(n,".").concat(o)}return"4.0.0.999"}("4.23.3"),HR=function(){try{return JSON.parse("true")===!0}catch{return!0}}();let sd=function(e){return e.Default="default",e.Auto="auto",e.Relay="relay",e.SdRtn="sd-rtn",e}({});const vr=function(){const e="us".concat("erna","me"),t="pa".concat("sswo","rd"),n=["t","s","t"];n.splice(1,0,"e");const o=n.join(""),s=[];for(let h=0;h<6;h++)s.push("1");const c=s.join(""),d={};return d[e]=o,d[t]=c,Object.assign(d,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=vr;const PE={ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:2,ENABLE_AUT_FEEDBACK:!1,SVC_EXTENDED:["VP9"]},GR={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},zR="v4.23.3-0-g83bb9b5a-dirty(4/29/2025, 5:16:52 PM)",KR={ENABLE_EVENT_REPORT:!0,UPLOAD_LOG:!1,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,ENABLE_PRELOAD:!0,NEW_ICE_RESTART:!1,ICE_RESTART_INTERVAL:1e4,RESTART_SEQUENCE:["udp_tcp_relay","relay"],FIRST_TCP_CANDIDATE:!1,FIRST_TCP_CANDIDATE_INTERVAL:1e3,TURN_DOMAIN:"edge.agora.io",USE_TURN_IP:!1,NEW_TURN_MODE:void 0,NEW_FORCE_TURN:!1,USE_NEW_RENDER_FREEZE_TIME:!1},cn=Ce(Ce(Ce(Ce({},KR),{},{PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,SHOW_REPORT_USER_INVOKER_LOG:!0,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,FIRST_H264_PROFILE_LEVEL_ID:"42001f",FIRST_PACKETIZATION_MODE:"",X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,FINGERPRINT:null,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,ENABLE_AUDIO_TOPN:!1,ENABLE_AUDIO_METADATA:!1,ENABLE_AUDIO_PTS_METADATA:!1,TOPN_SMOOTH_LEVEL:void 0,TOPN_NEW_SPEAKER_DELAY:void 0,TOPN_SWITCH_HOLD_MS:void 0,TOPN_AUDIO_GAIN:void 0,TOPN_SILENCE_THRESHOLD:250,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ENABLE_AUDIO_RED:!1,OPUS_PTIME:void 0,AUDIO_DUPLICATE_NUM:void 0,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:GR,CUSTOM_ADAPTATION_DEFAULT_MODE:"",HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,DISABLE_SCREEN_SHARE_REMB:!1},PE),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0,ENABLE_ROLE_SELECT_EDGE:!1,CLIENT_ROLE_OPTIONS:void 0,COMPATIBLE_SDP_EXTENSION:["gdpr_forbidden"],LIMIT_BITRATE:void 0,EXPERIMENTS:{},USE_PUB_RTX:!0,USE_SUB_RTX:!0,ENABLE_DATASTREAM_2:!1,USE_XR:!0,ENABLE_PREALLOC_PC:!1,ENABLE_PRE_SUB:!1,ENABLE_SVC:!1},{INSTALL_ID:""}),{},{K_MIN_RENDER_DELAY:66,USE_STANDARD_BITRATE_DEFAULT:!1,VIDEO_NEW_BITRATE_RATIO:void 0,VIDEO_STANDARD_BITRATE_VERSION:void 0,BASELINE_MORE_H264_BITRATE_RATIO:1.1});function jt(e,t,n){var o,s,c;Ee(o=Object.keys(cn)).call(o,e)&&(!n&&Ee(s=Object.keys(Rs)).call(s,e)||(cn[e]=t,e!=="ENABLE_VIDEO_SEI"&&e!=="ENABLE_AUDIO_TOPN"&&e!=="ENABLE_AUDIO_METADATA"&&e!=="ENABLE_AUDIO_PTS_METADATA"||t!==!0||(cn.ENABLE_ENCODED_TRANSFORM=!0,e==="ENABLE_AUDIO_PTS_METADATA"&&(cn.ENABLE_AUDIO_METADATA=!0)),e==="USE_NEW_NETWORK_CONFIG"&&t&&(c=!!t,cn.USE_NEW_NETWORK_CONFIG=c,c&&(cn.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],cn.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],cn.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],cn.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],cn.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",cn.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",cn.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),e==="ENABLE_PRE_SUB"&&t&&(cn.ENABLE_INSTANT_VIDEO=!0,cn.ENABLE_PREALLOC_PC=!0),e==="ENABLE_SVC"&&t&&(cn.ENABLE_AUT_CC=!0),e==="NEW_FORCE_TURN"&&t&&(cn.NEW_TURN_MODE||(cn.NEW_TURN_MODE=4))))}function H(e){return cn[e]}HR||(cn.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],cn.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],cn.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],cn.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],cn.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],cn.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],cn.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",cn.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",cn.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",cn.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",cn.AREAS=["NORTH_AMERICA","OVERSEA"]);let uM=function(e){return e[e.REALTIME=1]="REALTIME",e}({});const Rs={};var Et=function(e){return e.SET_SESSION_ID="SET_SESSION_ID",e.SET_P2P_ID="SET_P2P_id",e.SET_DC_ID="SET_DC_id",e.SET_UID="SET_UID",e.SET_INT_UID="SET_INT_UID",e.SET_PUB_ID="SET_PUB_ID",e.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",e.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",e.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",e.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",e.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",e.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",e.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",e.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",e.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",e.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",e.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",e.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",e.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",e.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",e.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",e.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",e.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",e.RESET_KEY_METRICS="RESET_KEY_METRICS",e.SET_USE_P2P="SET_USE_P2P",e.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",e}(Et||{});let DE=function(e){return e.h264="h264",e.h265="h265",e.vp8="vp8",e.vp9="vp9",e.av1="av1",e}({});(function(e){e.opus="opus",e.pcma="pcma",e.pcmu="pcmu",e.g722="g722"})({});const hM=128,Aie=96,pM=1e3,th=10;let Nie=0;var fM=(()=>{var e={8:(o,s,c)=>{c.r(s),c.d(s,{Parser:()=>me,Printer:()=>tn,parse:()=>he,print:()=>Ie});const d=`
`,h="".concat("\r").concat(d),p=" ";let m;function g(ae){return ae>="0"&&ae<="9"}function E(ae){return ae>="!"&&ae<="~"}function y(ae){return E(ae)||ae>=""&&ae<="ÿ"}function T(ae){return ae==="!"||ae>="#"&&ae<="'"||ae>="*"&&ae<="+"||ae>="-"&&ae<="."||ae>="0"&&ae<="9"||ae>="A"&&ae<="Z"||ae>="^"&&ae<="~"}function P(ae){return ae>="1"&&ae<="9"}function I(ae){return ae>="A"&&ae<="Z"||ae>="a"&&ae<="z"}function A(ae){return ae==="d"||ae==="h"||ae==="m"||ae==="s"}function M(ae){return ae>""&&ae<"	"||ae>"\v"&&ae<"\f"||ae>""&&ae<"ÿ"}function U(ae){return I(ae)||g(ae)||ae==="+"||ae==="/"}function Y(ae){return g(ae)||I(ae)||ae==="+"||ae==="/"||ae==="-"||ae==="_"}function Q(ae){return I(ae)||g(ae)||ae==="+"||ae==="/"}function J(ae,b){var K=Object.keys(ae);if(Object.getOwnPropertySymbols){var q=Object.getOwnPropertySymbols(ae);b&&(q=q.filter(function(ue){return Object.getOwnPropertyDescriptor(ae,ue).enumerable})),K.push.apply(K,q)}return K}function X(ae){for(var b=1;b<arguments.length;b++){var K=arguments[b]!=null?arguments[b]:{};b%2?J(Object(K),!0).forEach(function(q){ne(ae,q,K[q])}):Object.getOwnPropertyDescriptors?Object.defineProperties(ae,Object.getOwnPropertyDescriptors(K)):J(Object(K)).forEach(function(q){Object.defineProperty(ae,q,Object.getOwnPropertyDescriptor(K,q))})}return ae}function ne(ae,b,K){return b in ae?Object.defineProperty(ae,b,{value:K,enumerable:!0,configurable:!0,writable:!0}):ae[b]=K,ae}(function(ae){ae.VERSION="v",ae.ORIGIN="o",ae.SESSION_NAME="s",ae.INFORMATION="i",ae.URI="u",ae.EMAIL="e",ae.PHONE="p",ae.CONNECTION="c",ae.BANDWIDTH="b",ae.TIME="t",ae.REPEAT="r",ae.ZONE_ADJUSTMENTS="z",ae.KEY="k",ae.ATTRIBUTE="a",ae.MEDIA="m"})(m||(m={}));class oe{consumeText(b,K){let q=K;for(;q<b.length;){const ue=b[q];if(ue==="\0"||ue==="\r"||ue===d)break;q+=1}if(q-K==0)throw new Error("Invalid text, at ".concat(b));return q}consumeUnicastAddress(b,K,q){return this.consumeTill(b,K,p)}consumeOneOrMore(b,K,q){let ue=K;for(;q(b[ue]);)ue++;if(ue-K==0)throw new Error("Invalid rule at ".concat(K,"."));return ue}consumeSpace(b,K){if(b[K]===p)return K+1;throw new Error("Invalid space at ".concat(K,"."))}consumeIP4Address(b,K){let q=K;for(let ue=0;ue<4;ue++)if(q=this.consumeDecimalUChar(b,q),ue!==3){if(b[q]!==".")throw new Error("Invalid IP4 address.");q++}return q}consumeDecimalUChar(b,K){let q=K;for(let Ze=0;Ze<3&&g(b[q]);Ze++,q++);if(q-K==0)throw new Error("Invalid decimal uchar.");const ue=parseInt(b.slice(K,q));if(ue>=0&&ue<=255)return q;throw new Error("Invalid decimal uchar")}consumeIP6Address(b,K){let q=this.consumeHexpart(b,K);return b[q]===":"&&(q+=1,q=this.consumeIP4Address(b,q)),q}consumeHexpart(b,K){let q=K;if(b[q]===":"&&b[q+1]===":"){q+=2;try{q=this.consumeHexseq(b,q)}catch{}return q}if(q=this.consumeHexseq(b,q),b[q]===":"&&b[q+1]===":"){q+=2;try{q=this.consumeHexseq(b,q)}catch{}return q}return q}consumeHexseq(b,K){let q=K;for(;q=this.consumeHex4(b,q),b[q]===":"&&b[q+1]!==":";)q+=1;return q}consumeHex4(b,K){let q=0;for(;q<4;q++)if(!((ue=b[K+q])>="0"&&ue<="9"||ue>="a"&&ue<="f"||ue>="A"&&ue<="F")){if(q===0)throw new Error("Invalid hex 4");break}var ue;return K+q}consumeFQDN(b,K){let q=K;for(;g(b[q])||I(b[q])||b[q]==="-"||b[q]===".";)q+=1;if(q-K<4)throw new Error("Invalid FQDN");return q}consumeExtnAddr(b,K){return this.consumeOneOrMore(b,K,y)}consumeMulticastAddress(b,K,q){switch(q){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(b,K);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(b,K);default:try{return this.consumeFQDN(b,K)}catch{return this.consumeExtnAddr(b,K)}}}consumeIP6MulticastAddress(b,K){const q=this.consumeHexpart(b,K);return b[q]==="/"?this.consumeInteger(b,q+1):q}consumeIP4MulticastAddress(b,K){let q=K+3;const ue=b.slice(K,q),Ze=parseInt(ue);if(Ze<224||Ze>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let Qt=0;Qt<3;Qt++){if(b[q]!==".")throw new Error("Invalid IP4 multicast address.");q+=1,q=this.consumeDecimalUChar(b,q)}return b[q]==="/"&&(q+=1),q=this.consumeTTL(b,q),b[q]==="/"&&(q=this.consumeInteger(b,q)),q}consumeInteger(b,K){if(!P(b[K]))throw new Error("Invalid integer.");for(K+=1;g(b[K]);)K+=1;return K}consumeTTL(b,K){if(b[K]==="0")return K+1;if(!P(b[K]))throw new Error("Invalid TTL.");K+=1;for(let q=0;q<2&&g(b[K]);q++)K+=1;return K}consumeToken(b,K){return this.consumeOneOrMore(b,K,T)}consumeTime(b,K){let q=K;if(b[q]==="0")return q+1;for(P(b[q])&&(q+=1);g(b[q]);)q++;if(q-K<10)throw new Error("Invalid time");return q}consumeAddress(b,K){return this.consumeTill(b,K,p)}consumeTypedTime(b,K){let q=K;return q=this.consumeOneOrMore(b,q,g),A(b[q])?q+1:q}consumeRepeatInterval(b,K){if(!P(b[K]))throw new Error("Invalid repeat interval");for(K+=1;g(b[K]);)K+=1;return A(b[K])&&(K+=1),K}consumePort(b,K){return this.consumeOneOrMore(b,K,g)}consume(b,K,q){for(let ue=0;ue<q.length;ue++){if(K+ue>=b.length)throw new Error("consume exceeding value length");if(b[K+ue]!==q[ue])throw new Error("consume ".concat(q," failed at ").concat(ue))}return K+q.length}consumeTill(b,K,q){let ue=K;for(;ue<b.length&&(typeof q!="string"||b[ue]!==q)&&(typeof q!="function"||!q(b[ue]));)ue++;return ue}}class me extends oe{constructor(){super(),ne(this,"records",[]),ne(this,"currentLine",0)}parse(b){const K=this.probeEOL(b);this.records=b.split(K).filter(nc=>!!Hr(nc).call(nc)).map(this.parseLine),this.currentLine=0;const q=this.parseVersion(),ue=this.parseOrigin(),Ze=this.parseSessionName(),Qt=this.parseInformation(),Hn=this.parseUri(),yo=this.parseEmail(),as=this.parsePhone(),Rm=this.parseConnection(),bd=this.parseBandWidth(),Lh=this.parseTimeFields(),jv=this.parseKey(),Vv=this.parseSessionAttribute(),So=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:q,origin:ue,sessionName:Ze,information:Qt,uri:Hn,emails:yo,phones:as,connection:Rm,bandwidths:bd,timeFields:Lh,key:jv,attributes:Vv,mediaDescriptions:So}}getCurrentRecord(){const b=this.records[this.currentLine];if(!b)throw new Error("Record doesn't exit.");return b}probeEOL(b){for(let K=0;K<b.length;K++)if(b[K]===d)return b[K-1]==="\r"?h:d;throw new Error("Invalid newline character.")}parseLine(b,K){if(b.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const q=b[0];if(b[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:q,value:b.slice(2),line:K,cur:0}}parseSessionAttribute(){const b=new ut;for(;this.currentLine<this.records.length;){const K=this.getCurrentRecord();if(K.type!==m.ATTRIBUTE)break;const q={attField:this.extractOneOrMore(K,ue=>T(ue)&&ue!==":"),_cur:0};K.value[K.cur]===":"&&(K.cur+=1,q.attValue=this.extractOneOrMore(K,M)),b.parse(q),this.currentLine++}return b.digest()}parseMediaAttributes(b){const K=new rt(b);for(;this.currentLine<this.records.length;){const q=this.getCurrentRecord();if(q.type!==m.ATTRIBUTE)break;const ue={attField:this.extractOneOrMore(q,Ze=>T(Ze)&&Ze!==":"),_cur:0};q.value[q.cur]===":"&&(q.cur+=1,ue.attValue=this.extractOneOrMore(q,M)),K.parse(ue),this.currentLine++}return K.digest()}parseKey(){const b=this.getCurrentRecord();if(b.type===m.KEY){if(b.value==="prompt"||b.value==="clear:"||b.value==="base64:"||b.value==="uri:")return b.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const b=this.getCurrentRecord();if(b.type===m.ZONE_ADJUSTMENTS){const K=[];for(;;)try{const q=this.extract(b,this.consumeTime);this.consumeSpaceForRecord(b);let ue=!1;b.value[b.cur]==="-"&&(ue=!0,b.cur+=1);const Ze=this.extract(b,this.consumeTypedTime);K.push({time:q,typedTime:Ze,back:ue})}catch{break}if(K.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,K}return[]}parseRepeat(){const b=[];for(;;){const K=this.getCurrentRecord();if(K.type!==m.REPEAT)break;{const q=this.extract(K,this.consumeRepeatInterval),ue=this.parseTypedTime(K);b.push({repeatInterval:q,typedTimes:ue}),this.currentLine++}}return b}parseTypedTime(b){const K=[];for(;;)try{this.consumeSpaceForRecord(b),K.push(this.extract(b,this.consumeTypedTime))}catch{break}if(K.length===0)throw new Error("Invalid typed time.");return K}parseTime(){const b=this.getCurrentRecord(),K=this.extract(b,this.consumeTime);this.consumeSpaceForRecord(b);const q=this.extract(b,this.consumeTime);return this.currentLine++,{startTime:K,stopTime:q}}parseBandWidth(){const b=[];for(;this.currentLine<this.records.length;){const K=this.getCurrentRecord();if(K.type!==m.BANDWIDTH)break;{const q=this.extractOneOrMore(K,T);if(K.value[K.cur]!==":")throw new Error("Invalid bandwidth field.");K.cur++;const ue=this.extractOneOrMore(K,g);b.push({bwtype:q,bandwidth:ue}),this.currentLine++}}return b}parseVersion(){const b=this.getCurrentRecord();if(b.type!==m.VERSION)throw new Error("first sdp record must be version");const K=b.value.slice(0,this.consumeOneOrMore(b.value,0,g));if(K.length!==b.value.length)throw new Error('invalid proto version, "v='.concat(b.value,'"'));return this.currentLine++,K}parseOrigin(){const b=this.getCurrentRecord();if(b.type!==m.ORIGIN)throw new Error("second line of sdp must be origin");const K=this.extractOneOrMore(b,y);this.consumeSpaceForRecord(b);const q=this.extractOneOrMore(b,g);this.consumeSpaceForRecord(b);const ue=this.extractOneOrMore(b,g);this.consumeSpaceForRecord(b);const Ze=this.extractOneOrMore(b,T);this.consumeSpaceForRecord(b);const Qt=this.extractOneOrMore(b,T);this.consumeSpaceForRecord(b);const Hn=this.extract(b,this.consumeUnicastAddress);return this.currentLine++,{username:K,sessId:q,sessVersion:ue,nettype:Ze,addrtype:Qt,unicastAddress:Hn}}parseSessionName(){const b=this.getCurrentRecord();if(b.type===m.SESSION_NAME){const K=this.extract(b,this.consumeText);return this.currentLine++,K}}parseInformation(){const b=this.getCurrentRecord();if(b.type!==m.INFORMATION)return;const K=this.extract(b,this.consumeText);return this.currentLine++,K}parseUri(){const b=this.getCurrentRecord();if(b.type===m.URI)return this.currentLine++,b.value}parseEmail(){const b=[];for(;;){const K=this.getCurrentRecord();if(K.type!==m.EMAIL)break;b.push(K.value),this.currentLine++}return b}parsePhone(){const b=[];for(;;){const K=this.getCurrentRecord();if(K.type!==m.PHONE)break;b.push(K.value),this.currentLine++}return b}parseConnection(){const b=this.getCurrentRecord();if(b.type===m.CONNECTION){const K=this.extractOneOrMore(b,T);this.consumeSpaceForRecord(b);const q=this.extractOneOrMore(b,T);this.consumeSpaceForRecord(b);const ue=this.extract(b,this.consumeAddress);return this.currentLine++,{nettype:K,addrtype:q,address:ue}}}parseMedia(){const b=this.getCurrentRecord(),K=this.extract(b,this.consumeToken);this.consumeSpaceForRecord(b);let q=this.extract(b,this.consumePort);b.value[b.cur]==="/"&&(b.cur+=1,q+=this.extract(b,this.consumeInteger)),this.consumeSpaceForRecord(b);const ue=[];for(ue.push(this.extract(b,this.consumeToken));b.value[b.cur]==="/";)b.cur+=1,ue.push(this.extract(b,this.consumeToken));if(ue.length===0)throw new Error("Invalid proto");const Ze=this.parseFmt(b);return this.currentLine++,{mediaType:K,port:q,protos:ue,fmts:Ze}}parseTimeFields(){const b=[];for(;this.getCurrentRecord().type===m.TIME;){const K=this.parseTime(),q=this.parseRepeat(),ue=this.parseZone();b.push({time:K,repeats:q,zones:ue})}return b}parseMediaDescription(){const b=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===m.MEDIA;){const K=this.parseMedia(),q=this.parseInformation(),ue=this.parseConnections(),Ze=this.parseBandWidth(),Qt=this.parseKey(),Hn=this.parseMediaAttributes(K);b.push({media:K,information:q,connections:ue,bandwidths:Ze,key:Qt,attributes:Hn})}return b}parseConnections(){const b=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===m.CONNECTION;)b.push(this.parseConnection());return b}parseFmt(b){const K=[];for(;;)try{this.consumeSpaceForRecord(b),K.push(this.extract(b,this.consumeToken))}catch{break}if(K.length===0)throw new Error("Invalid fmts");return K}extract(b,K){for(var q=arguments.length,ue=new Array(q>2?q-2:0),Ze=2;Ze<q;Ze++)ue[Ze-2]=arguments[Ze];const Qt=K.call(this,b.value,b.cur,...ue),Hn=b.value.slice(b.cur,Qt);return b.cur=Qt,Hn}extractOneOrMore(b,K){const q=this.consumeOneOrMore(b.value,b.cur,K),ue=b.value.slice(b.cur,q);return b.cur=q,ue}consumeSpaceForRecord(b){if(b.value[b.cur]!==p)throw new Error("Invalid space at ".concat(b.cur,"."));b.cur+=1}}class we extends oe{constructor(){super(...arguments),ne(this,"attributes",void 0),ne(this,"digested",!1)}extractOneOrMore(b,K,q){const ue=this.consumeOneOrMore(b.attValue,b._cur,K),Ze=b.attValue.slice(b._cur,ue),[Qt,Hn]=q||[];if(typeof Qt=="number"&&Ze.length<Qt)throw new Error("error in length, should be more or equal than ".concat(Qt," characters."));if(typeof Hn=="number"&&Ze.length>Hn)throw new Error("error in length, should be less or equal than ".concat(Hn," characters."));return b._cur=ue,Ze}consumeAttributeSpace(b){if(b.attValue[b._cur]!==p)throw new Error("Invalid space at ".concat(b._cur,"."));b._cur+=1}extract(b,K){if(!b.attValue)throw new Error("Nothing to extract from attValue.");for(var q=arguments.length,ue=new Array(q>2?q-2:0),Ze=2;Ze<q;Ze++)ue[Ze-2]=arguments[Ze];const Qt=K.call(this,b.attValue,b._cur,...ue),Hn=b.attValue.slice(b._cur,Qt);return b._cur=Qt,Hn}atEnd(b){if(!b.attValue)throw new Error;return b._cur>=b.attValue.length}peekChar(b){if(!b.attValue)throw new Error;return b.attValue[b._cur]}peek(b,K){if(!b.attValue)throw new Error;for(let q=0;q<K.length;q++)if(K[q]!==b.attValue[b._cur+q])return!1;return!0}parseIceUfrag(b){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(b,U,[4,256])}parseIcePwd(b){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(b,U,[22,256])}parseIceOptions(b){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const K=[];for(;!this.atEnd(b);){K.push(this.extractOneOrMore(b,U));try{this.consumeAttributeSpace(b)}catch(q){if(this.atEnd(b))break;throw q}}this.attributes.iceOptions=K}parseFingerprint(b){const K=this.extract(b,this.consumeToken);this.consumeAttributeSpace(b);const q=this.extract(b,this.consumeTill);this.attributes.fingerprints.push({hashFunction:K,fingerprint:q})}parseExtmap(b){const K=this.extractOneOrMore(b,g);let q;this.peekChar(b)==="/"&&(this.extract(b,this.consume,"/"),q=this.extract(b,this.consumeToken)),this.consumeAttributeSpace(b);const ue=this.extract(b,this.consumeTill,p),Ze=X(X({entry:parseInt(K,10)},q&&{direction:q}),{},{extensionName:ue});this.peekChar(b)===p&&(this.consumeAttributeSpace(b),Ze.extensionAttributes=this.extract(b,this.consumeTill)),this.attributes.extmaps.push(Ze)}parseSetup(b){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const K=this.extract(b,this.consumeTill);if(K!=="active"&&K!=="passive"&&K!=="actpass"&&K!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=K}}class ut extends we{constructor(){super(...arguments),ne(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(b){if(this.digested)throw new Error("already digested");try{switch(b.attField){case"group":this.parseGroup(b);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(b);break;case"ice-pwd":this.parseIcePwd(b);break;case"ice-options":this.parseIceOptions(b);break;case"fingerprint":this.parseFingerprint(b);break;case"setup":this.parseSetup(b);break;case"tls-id":this.parseTlsId(b);break;case"identity":this.parseIdentity(b);break;case"extmap":this.parseExtmap(b);break;case"msid-semantic":this.parseMsidSemantic(b);break;default:b.ignored=!0,this.attributes.unrecognized.push(b)}}catch(K){throw console.error("parsing session attribute ".concat(b.attField,' error, "a=').concat(b.attField,":").concat(b.attValue,'"')),K}if(!b.ignored&&b.attValue&&!this.atEnd(b))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(b){const K=this.extract(b,this.consumeToken),q=[];for(;!this.atEnd(b)&&this.peekChar(b)===p;)this.consumeAttributeSpace(b),q.push(this.extract(b,this.consumeToken));this.attributes.groups.push({semantic:K,identificationTag:q})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(b){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(b,Y)}parseIdentity(b){const K=this.extractOneOrMore(b,Q),q=[];for(;!this.atEnd(b)&&this.peekChar(b)===p;){this.consumeAttributeSpace(b);const ue=this.extract(b,this.consumeToken);this.extract(b,this.consume,"=");const Ze=this.extractOneOrMore(b,Qt=>Qt!==p&&M(Qt));q.push({name:ue,value:Ze})}this.attributes.identities.push({assertionValue:K,extensions:q})}parseMsidSemantic(b){this.peekChar(b)===p&&this.consumeAttributeSpace(b);const K={semantic:this.extract(b,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(b)}catch{break}if(this.peekChar(b)==="*"){this.extract(b,this.consume,"*"),K.applyForAll=!0;break}{const q=this.extract(b,this.consumeTill,p);K.identifierList.push(q)}}this.attributes.msidSemantic=K}}class rt extends we{constructor(b){super(),ne(this,"attributes",void 0),b.protos.indexOf("RTP")!==-1||b.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(b){if(this.digested)throw new Error("already digested");try{switch(b.attField){case"extmap":this.parseExtmap(b);break;case"setup":this.parseSetup(b);break;case"ice-ufrag":this.parseIceUfrag(b);break;case"ice-pwd":this.parseIcePwd(b);break;case"ice-options":this.parseIceOptions(b);break;case"candidate":this.parseCandidate(b);break;case"remote-candidate":this.parseRemoteCandidate(b);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(b);break;case"rtpmap":this.parseRtpmap(b);break;case"ptime":this.parsePtime(b);break;case"maxptime":this.parseMaxPtime(b);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(b);break;case"ssrc":this.parseSSRC(b);break;case"fmtp":this.parseFmtp(b);break;case"rtcp-fb":this.parseRtcpFb(b);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(b);break;case"mid":this.parseMid(b);break;case"msid":this.parseMsid(b);break;case"imageattr":this.parseImageAttr(b);break;case"rid":this.parseRid(b);break;case"simulcast":this.parseSimulcast(b);break;case"sctp-port":this.parseSctpPort(b);break;case"max-message-size":this.parseMaxMessageSize(b);break;case"ssrc-group":this.parseSSRCGroup(b);break;default:b.ignored=!0,this.attributes.unrecognized.push(b)}}catch(K){throw console.error("parsing media attribute ".concat(b.attField,' error, "a=').concat(b.attField,":").concat(b.attValue,'"')),K}if(!b.ignored&&b.attValue&&!this.atEnd(b))throw new Error("attribute parsing error")}parseCandidate(b){const K=this.extractOneOrMore(b,U,[1,32]);this.consumeAttributeSpace(b);const q=this.extractOneOrMore(b,g,[1,5]);this.consumeAttributeSpace(b);const ue=this.extract(b,this.consumeToken);this.consumeAttributeSpace(b);const Ze=this.extractOneOrMore(b,g,[1,10]);this.consumeAttributeSpace(b);const Qt=this.extract(b,this.consumeAddress);this.consumeAttributeSpace(b);const Hn=this.extract(b,this.consumePort);this.consumeAttributeSpace(b),this.extract(b,this.consume,"typ"),this.consumeAttributeSpace(b);const yo={foundation:K,componentId:q,transport:ue,priority:Ze,connectionAddress:Qt,port:Hn,type:this.extract(b,this.consumeToken),extension:{}};for(this.peek(b," raddr")&&(this.extract(b,this.consume," raddr"),this.consumeAttributeSpace(b),yo.relAddr=this.extract(b,this.consumeAddress)),this.peek(b," rport")&&(this.extract(b,this.consume," rport"),this.consumeAttributeSpace(b),yo.relPort=this.extract(b,this.consumePort));this.peekChar(b)===p;){this.consumeAttributeSpace(b);const as=this.extract(b,this.consumeToken);this.consumeAttributeSpace(b),yo.extension[as]=this.extractOneOrMore(b,E)}this.attributes.candidates.push(yo)}parseRemoteCandidate(b){const K=[];for(;;){const q=this.extractOneOrMore(b,g,[1,5]);this.consumeAttributeSpace(b);const ue=this.extract(b,this.consumeAddress);this.consumeAttributeSpace(b);const Ze=this.extract(b,this.consumePort);K.push({componentId:q,connectionAddress:ue,port:Ze});try{this.consumeAttributeSpace(b)}catch{break}}this.attributes.remoteCandidatesList.push(K)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(b){const K=this.extract(b,this.consumeToken);this.consumeAttributeSpace(b);const q=this.extract(b,this.consumeTill,"/");this.extract(b,this.consume,"/");const ue={encodingName:q,clockRate:this.extractOneOrMore(b,g)};this.atEnd(b)||this.peekChar(b)!=="/"||(this.extract(b,this.consume,"/"),ue.encodingParameters=parseInt(this.extract(b,this.consumeTill),10));const Ze=this.attributes.payloads.find(Qt=>Qt.payloadType===parseInt(K,10));Ze?Ze.rtpMap=ue:this.attributes.payloads.push({payloadType:parseInt(K,10),rtpMap:ue,rtcpFeedbacks:[]})}parsePtime(b){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(b,this.consumeTill)}parseMaxPtime(b){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(b,this.consumeTill)}parseDirection(b){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=b.attField}parseSSRC(b){const K=this.extractOneOrMore(b,g);this.consumeAttributeSpace(b);const q=this.extract(b,this.consumeTill,":");let ue;this.peekChar(b)===":"&&(this.extract(b,this.consume,":"),ue=this.extract(b,this.consumeTill));const Ze=this.attributes.ssrcs.find(Qt=>Qt.ssrcId===parseInt(K,10));Ze?Ze.attributes[q]=ue:this.attributes.ssrcs.push({ssrcId:parseInt(K,10),attributes:{[q]:ue}})}parseFmtp(b){const K=this.extract(b,this.consumeTill,p);this.consumeAttributeSpace(b);const q=this.extract(b,this.consumeTill),ue={};q.split(";").forEach(Qt=>{let[Hn,yo]=Qt.split("=");Hn=Hr(Hn).call(Hn);const as=typeof yo=="string"?Hr(yo).call(yo):null;typeof Hn=="string"&&Hn.length>0&&(ue[Hn]=as)});const Ze=this.attributes.payloads.find(Qt=>Qt.payloadType===parseInt(K,10));Ze?Ze.fmtp={parameters:ue}:this.attributes.payloads.push({payloadType:parseInt(K,10),rtcpFeedbacks:[],fmtp:{parameters:ue}})}parseFmtParameters(b){const K={},q=this.extract(b,this.consumeTill,"=");b._cur++;const ue=this.extract(b,this.consumeTill,";");for(K[q]=ue;b.attValue[b._cur]===";";){const Ze=this.extract(b,this.consumeTill,"=");b._cur++;const Qt=this.extract(b,this.consumeTill,";");K[Ze]=Qt}return K}parseRtcpFb(b){let K="";K=this.peekChar(b)==="*"?this.extract(b,this.consume,"*"):this.extract(b,this.consumeTill,p),this.consumeAttributeSpace(b);const q=this.extract(b,this.consumeTill,p);let ue;if(q==="trr-int")ue={type:q,interval:this.extract(b,this.consumeTill)};else{const Ze={type:q};this.peekChar(b)===p&&(this.consumeAttributeSpace(b),Ze.parameter=this.extract(b,this.consumeToken),this.peekChar(b)===p&&(Ze.additional=this.extract(b,this.consumeTill))),ue=Ze}if(K==="*")this.attributes.rtcpFeedbackWildcards.push(ue);else{const Ze=this.attributes.payloads.find(Qt=>Qt.payloadType===parseInt(K,10));Ze?Ze.rtcpFeedbacks.push(ue):this.attributes.payloads.push({payloadType:parseInt(K,10),rtcpFeedbacks:[ue]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(b){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const K={port:this.extract(b,this.consumePort)};this.peekChar(b)===p&&(this.consumeAttributeSpace(b),K.netType=this.extractOneOrMore(b,T),this.consumeAttributeSpace(b),K.addressType=this.extractOneOrMore(b,T),this.consumeAttributeSpace(b),K.address=this.extract(b,this.consumeAddress)),this.attributes.rtcp=K}parseMsid(b){const K={id:this.extractOneOrMore(b,T,[1,64])};this.peekChar(b)===p&&(this.consumeAttributeSpace(b),K.appdata=this.extractOneOrMore(b,T,[1,64])),this.attributes.msids.push(K)}parseImageAttr(b){this.attributes.imageattr.push(b.attValue)}parseRid(b){const K=this.extractOneOrMore(b,ue=>I(ue)||g(ue)||ue==="_"||ue==="-");this.consumeAttributeSpace(b);const q={id:K,direction:this.extract(b,this.consumeToken),params:[]};if(this.peekChar(b)===p){if(this.consumeAttributeSpace(b),this.peek(b,"pt=")){this.extract(b,this.consume,"pt=");const ue=[];for(;;){const Ze=this.extract(b,this.consumeToken);ue.push(Ze);try{this.extract(b,this.consume,",")}catch{break}}q.payloads=ue,this.peekChar(b)===p&&this.extract(b,this.consume,p)}for(;;){const ue=this.extract(b,this.consumeToken);switch(ue){case"depend":{const Ze={type:ue,rids:this.extract(b,this.consume,"=").split(",")};q.params.push(Ze);break}default:{const Ze={type:ue};this.peekChar(b)==="="&&(this.extract(b,this.consume,"="),Ze.val=this.extract(b,this.consumeTill,";")),q.params.push(Ze)}}try{this.extract(b,this.consume,";")}catch{break}}}this.attributes.rids.push(q)}parseSimulcast(b){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=b.attValue,this.extract(b,this.consumeTill)}parseSctpPort(b){this.attributes.sctpPort=this.extractOneOrMore(b,g,[1,5])}parseMaxMessageSize(b){this.attributes.maxMessageSize=this.extractOneOrMore(b,g,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(b){this.attributes.mid=this.extract(b,this.consumeToken)}parseSSRCGroup(b){const K=this.extract(b,this.consumeToken),q=[];for(;;)try{this.consumeAttributeSpace(b);const ue=this.extract(b,this.consumeInteger);q.push(parseInt(ue,10))}catch{break}this.attributes.ssrcGroups.push({semantic:K,ssrcIds:q})}}function qe(ae,b,K){return b in ae?Object.defineProperty(ae,b,{value:K,enumerable:!0,configurable:!0,writable:!0}):ae[b]=K,ae}class tn{constructor(){qe(this,"eol",h)}print(b,K){let q="";return K&&(this.eol=K),q+=this.printVersion(b.version),q+=this.printOrigin(b.origin),q+=this.printSessionName(b.sessionName),q+=this.printInformation(b.information),q+=this.printUri(b.uri),q+=this.printEmail(b.emails),q+=this.printPhone(b.phones),q+=this.printConnection(b.connection),q+=this.printBandwidth(b.bandwidths),q+=this.printTimeFields(b.timeFields),q+=this.printKey(b.key),q+=this.printSessionAttributes(b.attributes),q+=this.printMediaDescription(b.mediaDescriptions),q}printVersion(b){return"v=".concat(b).concat(this.eol)}printOrigin(b){return"o=".concat(b.username," ").concat(b.sessId," ").concat(b.sessVersion," ").concat(b.nettype," ").concat(b.addrtype," ").concat(b.unicastAddress).concat(this.eol)}printSessionName(b){return b?"s=".concat(b).concat(this.eol):""}printInformation(b){return b?"i=".concat(b).concat(this.eol):""}printUri(b){return b?"u=".concat(b).concat(this.eol):""}printEmail(b){let K="";for(const q of b)K+="e=".concat(q).concat(this.eol);return K}printPhone(b){let K="";for(const q of b)K+="e=".concat(q).concat(this.eol);return K}printConnection(b){return b?"c=".concat(b.nettype," ").concat(b.addrtype," ").concat(b.address).concat(this.eol):""}printBandwidth(b){let K="";for(const q of b)K+="b=".concat(q.bwtype,":").concat(q.bandwidth).concat(this.eol);return K}printTimeFields(b){let K="";for(const q of b){K+="t=".concat(q.time.startTime," ").concat(q.time.startTime).concat(this.eol);for(const ue of q.repeats)K+="r=".concat(ue.repeatInterval," ").concat(ue.typedTimes.join(" ")).concat(this.eol);q.zoneAdjustments&&(K+="z=",K+="z=".concat(q.zoneAdjustments.map(ue=>"".concat(ue.time," ").concat(ue.back?"-":""," ").concat(ue.typedTime)).join(" ")).concat(this.eol),K+=this.eol)}return K}printKey(b){return b?"k=".concat(b).concat(this.eol):""}printAttributes(b){let K="";for(const q of b)K+="a=".concat(q.attField).concat(q.attValue?":".concat(q.attValue):"").concat(this.eol);return K}printMediaDescription(b){let K="";for(const q of b)K+=this.printMedia(q.media),K+=this.printInformation(q.information),K+=this.printConnections(q.connections),K+=this.printBandwidth(q.bandwidths),K+=this.printKey(q.key),K+=this.printMediaAttributes(q);return K}printConnections(b){let K="";for(const q of b)K+=this.printConnection(q);return K}printMedia(b){return"m=".concat(b.mediaType," ").concat(b.port," ").concat(b.protos.join("/")," ").concat(b.fmts.join(" ")).concat(this.eol)}printSessionAttributes(b){return new di(this.eol).print(b)}printMediaAttributes(b){return new se(this.eol).print(b)}}class zt{constructor(b){qe(this,"eol",void 0),this.eol=b}printIceUfrag(b){return b===void 0?"":"a=ice-ufrag:".concat(b).concat(this.eol)}printIcePwd(b){return b===void 0?"":"a=ice-pwd:".concat(b).concat(this.eol)}printIceOptions(b){return b===void 0?"":"a=ice-options:".concat(b.join(p)).concat(this.eol)}printFingerprints(b){return b.length>0?b.map(K=>"a=fingerprint:".concat(K.hashFunction).concat(p).concat(K.fingerprint)).join(this.eol)+this.eol:""}printExtmap(b){return b.map(K=>"a=extmap:".concat(K.entry).concat(K.direction?"/".concat(K.direction):"").concat(p).concat(K.extensionName).concat(K.extensionAttributes?"".concat(p).concat(K.extensionAttributes):"").concat(this.eol)).join("")}printSetup(b){return b===void 0?"":"a=setup:".concat(b).concat(this.eol)}printUnrecognized(b){return b.map(K=>"a=".concat(K.attField).concat(K.attValue?":".concat(K.attValue):"").concat(this.eol)).join("")}}class di extends zt{print(b){let K="";return K+=this.printGroups(b.groups),K+=this.printMsidSemantic(b.msidSemantic),K+=this.printIceLite(b.iceLite),K+=this.printIceUfrag(b.iceUfrag),K+=this.printIcePwd(b.icePwd),K+=this.printIceOptions(b.iceOptions),K+=this.printFingerprints(b.fingerprints),K+=this.printSetup(b.setup),K+=this.printTlsId(b.tlsId),K+=this.printIdentity(b.identities),K+=this.printExtmap(b.extmaps),K+=this.printUnrecognized(b.unrecognized),K}printGroups(b){let K="";return b.length>0&&(K+=b.map(q=>"a=group:".concat(q.semantic).concat(q.identificationTag.map(ue=>"".concat(p).concat(ue)).join("")).concat(this.eol)).join("")),K}printIceLite(b){return b===void 0?"":"a=ice-lite"+this.eol}printTlsId(b){return b?"a=tls-id:".concat(b).concat(this.eol):""}printIdentity(b){return b.length===0?"":b.map(K=>"a=identity:".concat(K.assertionValue).concat(K.extensions.map(q=>"".concat(p).concat(q.name).concat(q.value?"=".concat(q.value):"")))).join(this.eol)+this.eol}printMsidSemantic(b){if(!b)return"";let K="a=msid-semantic:".concat(b.semantic);return b.applyForAll?K+="".concat(p,"*"):b.identifierList.length>0&&(K+=b.identifierList.map(q=>"".concat(p).concat(q))),K+this.eol}}class se extends zt{print(b){const K=b.attributes;let q="";return q+=this.printRTCP(K.rtcp),q+=this.printIceUfrag(K.iceUfrag),q+=this.printIcePwd(K.icePwd),q+=this.printIceOptions(K.iceOptions),q+=this.printCandidates(K.candidates),q+=this.printRemoteCandidatesList(K.remoteCandidatesList),q+=this.printEndOfCandidates(K.endOfCandidates),q+=this.printFingerprints(K.fingerprints),q+=this.printSetup(K.setup),q+=this.printMid(K.mid),q+=this.printExtmap(K.extmaps),q+=this.printRTPRelated(K),q+=this.printPtime(K.ptime),q+=this.printMaxPtime(K.maxPtime),q+=this.printDirection(K.direction),q+=this.printSSRCGroups(K.ssrcGroups),q+=this.printSSRC(K.ssrcs),q+=this.printRTCPMux(K.rtcpMux),q+=this.printRTCPMuxOnly(K.rtcpMuxOnly),q+=this.printRTCPRsize(K.rtcpRsize),q+=this.printMSId(K.msids),q+=this.printImageattr(K.imageattr),q+=this.printRid(K.rids),q+=this.printSimulcast(K.simulcast),q+=this.printSCTPPort(K.sctpPort),q+=this.printMaxMessageSize(K.maxMessageSize),q+=this.printUnrecognized(K.unrecognized),q}printCandidates(b){return b.map(K=>"a=candidate:".concat(K.foundation).concat(p).concat(K.componentId).concat(p).concat(K.transport).concat(p).concat(K.priority).concat(p).concat(K.connectionAddress).concat(p).concat(K.port).concat(p,"typ").concat(p).concat(K.type).concat(K.relAddr?"".concat(p,"raddr").concat(p).concat(K.relAddr):"").concat(K.relPort?"".concat(p,"rport").concat(p).concat(K.relPort):"").concat(Object.keys(K.extension).map(q=>"".concat(p).concat(q).concat(p).concat(K.extension[q])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(b){return b.map(K=>"a=remote-candidates:".concat(K.join(p)).concat(this.eol)).join("")}printEndOfCandidates(b){return b===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(b){if(!b.payloads)return"";const K=b.payloads;let q="";q+=b.rtcpFeedbackWildcards.map(ue=>this.printRTCPFeedback("*",ue)).join("");for(const ue of K)q+=this.printRtpMap(ue.payloadType,ue.rtpMap),q+=this.printFmtp(ue.payloadType,ue.fmtp),q+=ue.rtcpFeedbacks.map(Ze=>this.printRTCPFeedback(ue.payloadType,Ze)).join("");return q}printFmtp(b,K){if(!K)return"";const q=Object.keys(K.parameters);return q.length===1&&K.parameters[q[0]]===null?"a=fmtp:".concat(b).concat(p).concat(q[0]).concat(this.eol):"a=fmtp:".concat(b).concat(p).concat(Object.keys(K.parameters).map(ue=>"".concat(ue,"=").concat(K.parameters[ue])).join(";")).concat(this.eol)}printRtpMap(b,K){return K?"a=rtpmap:".concat(b).concat(p).concat(K.encodingName,"/").concat(K.clockRate).concat(K.encodingParameters?"/".concat(K.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(b,K){let q="a=rtcp-fb:".concat(b).concat(p),ue=K;return ue.type==="trr-int"?q+="ttr-int".concat(p).concat(ue.interval):(q+="".concat(ue.type),ue.parameter&&(q+="".concat(p).concat(ue.parameter),ue.additional&&(q+="".concat(p).concat(ue.additional)))),q+this.eol}printPtime(b){return b===void 0?"":"a=ptime:".concat(b).concat(this.eol)}printMaxPtime(b){return b===void 0?"":"a=maxptime:".concat(b).concat(this.eol)}printDirection(b){return b===void 0?"":"a=".concat(b).concat(this.eol)}printSSRC(b){return b.map(K=>Object.keys(K.attributes).map(q=>"a=ssrc:".concat(K.ssrcId.toString(10)).concat(p).concat(q).concat(K.attributes[q]?":".concat(K.attributes[q]):"").concat(this.eol)).join("")).join("")}printRTCPMux(b){return b===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(b){return b===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(b){return b===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(b){if(b===void 0)return"";let K="a=rtcp:".concat(b.port);return b.netType&&(K+="".concat(p).concat(b.netType)),b.addressType&&(K+="".concat(p).concat(b.addressType)),b.address&&(K+="".concat(p).concat(b.address)),K+this.eol}printMSId(b){return b.map(K=>"a=msid:".concat(K.id).concat(K.appdata?"".concat(p).concat(K.appdata):"").concat(this.eol)).join("")}printImageattr(b){return b.map(K=>"a=imageattr:".concat(K).concat(this.eol)).join("")}printRid(b){return b.map(K=>{let q="a=rid:".concat(K.id).concat(p).concat(K.direction);return K.payloads&&(q+="".concat(p,"pt=").concat(K.payloads.join(","))),K.params.length>0&&(q+="".concat(p).concat(K.params.map(ue=>ue.type==="depend"?"depend=".concat(ue.rids.join(",")):"".concat(ue.type,"=").concat(ue.val)).join(";"))),q+this.eol}).join("")}printSimulcast(b){return b===void 0?"":"a=simulcast:".concat(b).concat(this.eol)}printSCTPPort(b){return b===void 0?"":"a=sctp-port:".concat(b).concat(this.eol)}printMaxMessageSize(b){return b===void 0?"":"a=max-message-size:".concat(b).concat(this.eol)}printMid(b){return b===void 0?"":"a=mid:".concat(b).concat(this.eol)}printSSRCGroups(b){return b.map(K=>"a=ssrc-group:".concat(K.semantic).concat(K.ssrcIds.map(q=>"".concat(p).concat(q.toString(10))).join("")).concat(this.eol)).join("")}}function he(ae){return new me().parse(ae)}function Ie(ae,b){return new tn().print(ae,b)}}},t={};function n(o){if(t[o])return t[o].exports;var s=t[o]={exports:{}};return e[o](s,s.exports,n),s.exports}return n.d=(o,s)=>{for(var c in s)n.o(s,c)&&!n.o(o,c)&&Object.defineProperty(o,c,{enumerable:!0,get:s[c]})},n.o=(o,s)=>Object.prototype.hasOwnProperty.call(o,s),n.r=o=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(o,"__esModule",{value:!0})},n(8)})();function _i(e){return fM.parse(e)}function xc(e,t){return fM.print(e,t)}var Oie=Vo("Array","keys"),Pie=Tc,Die=Lr,kie=O,xie=Oie,YR=Array.prototype,Lie={DOMTokenList:!0,NodeList:!0},Mie=function(e){var t=e.keys;return e===YR||kie(YR,e)&&t===YR.keys||Die(Lie,Pie(e))?xie:t},Xi=u(Mie);function vn(e,t,n){return(t=function(o){var s=function(c,d){if(typeof c!="object"||!c)return c;var h=c[Symbol.toPrimitive];if(h!==void 0){var p=h.call(c,"string");if(typeof p!="object")return p;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(c)}(o);return typeof s=="symbol"?s:s+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function mM(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,o)}return n}function ct(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?mM(Object(n),!0).forEach(function(o){vn(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):mM(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}const gM=new class extends pn{constructor(){super(...arguments),vn(this,"currentUploadLogID",0)}reportLogUploadError(e){const{errorRange:t}=e;t[t.length-1]&&t[t.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=t[t.length-1],this.emit("REPORT_LOG_UPLOAD",e))}};class Uie{constructor(t){vn(this,"logger",void 0),vn(this,"prefixLists",[]),this.logger=t}debug(){for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];this.logger.debug(...this.prefixLists,...n)}info(){for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];this.logger.info(...this.prefixLists,...n)}warning(){for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];this.logger.warning(...this.prefixLists,...n)}error(){for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];this.logger.error(...this.prefixLists,...n)}prefix(t){return this.prefixLists.push(t),this}popPrefix(){return this.prefixLists.pop(),this}}function qR(){const e=new Date;return e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}function _M(){const e=new Date,t=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return t?(t==null?void 0:t[0])+":"+e.getUTCMilliseconds():e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}const fo={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},kE=Date.now(),jf=e=>{for(const t in fo)if(Object.prototype.hasOwnProperty.call(fo,t)&&fo[t]===e)return t;return"DEFAULT"},R=new class{constructor(){vn(this,"proxyServerURL",void 0),vn(this,"logLevel",fo.DEBUG),vn(this,"uploadState","collecting"),vn(this,"uploadLogWaitingList",[]),vn(this,"uploadLogUploadingList",[]),vn(this,"uploadErrorCount",0),vn(this,"currentLogID",0),vn(this,"url",void 0),vn(this,"extLog",(e,t)=>{this.appendLogToWaitingList(e,...t)})}debug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const o=[fo.DEBUG].concat(t);this.log.apply(this,o)}info(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const o=[fo.INFO].concat(t);this.log.apply(this,o)}warning(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const o=[fo.WARNING].concat(t);this.log.apply(this,o)}warn(){this.warning(...arguments)}error(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const o=[fo.ERROR].concat(t);this.log.apply(this,o)}upload(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const o=[fo.DEBUG].concat(t);this.uploadLog.apply(this,o)}setLogLevel(e){e=Math.min(Math.max(0,e),4),this.logLevel=e}enableLogUpload(){jt("UPLOAD_LOG",!0)}disableLogUpload(){jt("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(e){this.proxyServerURL=e}prefix(e){return new Uie(this).prefix(e)}log(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(Date.now()-kE<100)return void setTimeout(()=>{this.log(...t)},Date.now()-kE);const o=Math.max(0,Math.min(4,t[0]));if(t[0]=qR()+" Agora-SDK [".concat(jf(o),"]:"),this.appendLogToWaitingList(o,...t),o<this.logLevel)return;const s=qR()+" %cAgora-SDK [".concat(jf(o),"]:");let c=[];if(!H("USE_NEW_LOG"))switch(o){case fo.DEBUG:c=[s,"color: #64B5F6;"].concat(t.slice(1)),console.log.apply(console,c);break;case fo.INFO:c=[s,"color: #1E88E5; font-weight: bold;"].concat(t.slice(1)),console.log.apply(console,c);break;case fo.WARNING:c=[s,"color: #FB8C00; font-weight: bold;"].concat(t.slice(1)),console.warn.apply(console,c);break;case fo.ERROR:c=[s,"color: #B00020; font-weight: bold;"].concat(t.slice(1)),console.error.apply(console,c)}}uploadLog(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(Date.now()-kE<100)return void setTimeout(()=>{this.uploadLog(...t)},Date.now()-kE);const o=Math.max(0,Math.min(4,t[0]));t[0]=qR()+" Agora-SDK [".concat(jf(o),"]:"),this.appendLogToWaitingList(o,...t)}appendLogToWaitingList(e){if(!H("UPLOAD_LOG"))return;for(var t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];Array.isArray(n[0])?n[0][0]=_M()+" Agora-SDK [".concat(jf(e),"]:"):n[0]=_M()+" Agora-SDK [".concat(jf(e),"]:");let s="";n.forEach(c=>{typeof c=="object"&&(c=JSON.stringify(c)),s+="".concat(c," ")}),this.uploadLogWaitingList.push({payload_str:s,log_level:e,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){const e=this.uploadLogUploadingList,t={sdk_version:po,process_id:H("PROCESS_ID"),payload:JSON.stringify(e)};return ws(async()=>{const n=await oi.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(H("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(H("LOG_UPLOAD_SERVER"),"/upload/v1")),t,{responseType:"text"});if(n.data!=="OK"){const o=new Error("unexpected upload log response");throw o.response=n,o}},()=>(this.uploadLogUploadingList=[],!1),n=>{const o={status:-1,message:n.message,errorRange:e.map(s=>s.log_item_id)};return n.response?(o.status=n.response.status,o.data=n.response.data,o.headers=n.response.headers):n.request&&(o.status=n.request.status),gM.reportLogUploadError(o),!0},{timeout:H("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:H("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,H("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),H("UPLOAD_LOG_INTERVAL"))}).catch(e=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),H("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),H("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var EM;function jie(e){return ar(e.reportId,"params.reportId",0,100,!1),ar(e.category,"params.category",0,100,!1),ar(e.event,"params.event",0,100,!1),ar(e.label,"params.label",0,100,!1),Ht(e.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(EM={}).FREE="free",EM.UPLOADING="uploading",function(e){e[e.MISC=0]="MISC",e[e.INTERNAL_EVENT=1]="INTERNAL_EVENT",e[e.PUBLIC_EVENT=2]="PUBLIC_EVENT",e[e.WEB_EVENT=3]="WEB_EVENT",e[e.INTERNAL_API=4]="INTERNAL_API",e[e.WEB_API=5]="WEB_API",e[e.PUBLIC_API=6]="PUBLIC_API"}({});const Vie={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let $n=function(e){return e.PUBLISH="publish",e.SUBSCRIBE="subscribe",e.WS_COMPRESSOR_INIT="ws_compressor_init",e.SESSION_INIT="session_init",e.JOIN_CHOOSE_SERVER="join_choose_server",e.REQ_USER_ACCOUNT="req_user_account",e.JOIN_GATEWAY="join_gateway",e.REJOIN_GATEWAY="rejoin_gateway",e.STREAM_SWITCH="stream_switch",e.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",e.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",e.FIRST_VIDEO_RECEIVED="first_video_received",e.FIRST_AUDIO_RECEIVED="first_audio_received",e.FIRST_VIDEO_DECODE="first_video_decode",e.FIRST_AUDIO_DECODE="first_audio_decode",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_UPDATE_STREAM="on_update_stream",e.ON_REMOVE_STREAM="on_remove_stream",e.USER_ANALYTICS="req_user_analytics",e.PC_STATS="pc_stats",e.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",e.AB_TEST="ab_test",e}({}),dn=function(e){return e.SESSION="io.agora.pb.Wrtc.Session",e.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",e.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",e.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",e.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",e.PUBLISH="io.agora.pb.Wrtc.Publish",e.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",e.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",e.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",e.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",e.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",e.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",e.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",e.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",e.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",e.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",e.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",e.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",e.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",e.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",e.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",e.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",e.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",e.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",e.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",e.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",e.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",e.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",e.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",e.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",e.PC_STATS="io.agora.pb.Wrtc.PCStats",e.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",e.AB_TEST="io.agora.pb.Wrtc.ABTest",e}({});(function(e){e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({});let Fie=function(e){return e[e.SESSION=26]="SESSION",e[e.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",e[e.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",e[e.JOIN_GATEWAY=28]="JOIN_GATEWAY",e[e.PUBLISH=30]="PUBLISH",e[e.SUBSCRIBE=29]="SUBSCRIBE",e[e.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",e[e.STREAM_SWITCH=32]="STREAM_SWITCH",e[e.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",e[e.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",e[e.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",e[e.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",e[e.API_INVOKE=41]="API_INVOKE",e[e.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",e[e.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",e[e.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",e[e.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",e[e.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",e[e.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",e[e.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",e[e.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",e[e.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",e[e.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",e[e.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",e[e.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",e[e.USER_ANALYTICS=1e4]="USER_ANALYTICS",e[e.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",e}({});function He(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(t,n,o){const s=o.value;if(typeof s=="function"){const c=e.className||t.__className__||(t.constructor.name==="AgoraRTCClient"?"Client":t.constructor.name);o.value=function(){for(var d,h=arguments.length,p=new Array(h),m=0;m<h;m++)p[m]=arguments[m];let g=p;if(e.argsMap)try{g=e.argsMap(this,...p)}catch(y){R.warning(y),g=[]}try{JSON.stringify(g)}catch{R.warning("arguments for method ".concat(c,".").concat(String(n)," not serializable for apiInvoke.")),g=[]}const E=(e.report||ke).reportApiInvoke(this._sessionId||null,{id:this._clientId||((d=this.store)===null||d===void 0?void 0:d.clientId)||this._ID,name:"".concat(c,".").concat(String(n)),options:g,tag:En.TRACER,reportResult:e.reportResult},e.throttleTime);try{const y=s.apply(this,p);return y instanceof ye?y.then(T=>(E.onSuccess(e.reportResult&&T),T)).catch(T=>{throw E.onError(T),T}):(E.onSuccess(e.reportResult&&y),y)}catch(y){throw E.onError(y),y}}}return o}}const ke=new class{constructor(){vn(this,"baseInfoMap",new Map),vn(this,"proxyServer",void 0),vn(this,"eventUploadTimer",void 0),vn(this,"setSessionIdTimer",void 0),vn(this,"url",void 0),vn(this,"sids",new Set),vn(this,"backupUrl",void 0),vn(this,"_appId",void 0),vn(this,"_aid",0),vn(this,"keyEventUploadPendingItems",[]),vn(this,"normalEventUploadPendingItems",[]),vn(this,"apiInvokeUploadPendingItems",[]),vn(this,"apiInvokeCount",0),vn(this,"apiInvokeLoggedCount",0),vn(this,"ltsList",[]),vn(this,"lastSendNormalEventTime",Date.now()),vn(this,"customReportCounterTimer",void 0),vn(this,"customReportCount",0),vn(this,"extApiInvoke",async e=>{for(const t of e){const n=ct(ct({},t),{},{sid:null,invokeId:++this.apiInvokeCount,tag:En.TRACER});this.sendApiInvoke(n)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),H("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),H("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(e){return this.baseInfoMap.get(e)}setAppId(e){this._appId=e,this._aid=parseInt(e.replace(/[a-fA-F0-9]{8}/g,t=>{let[n,o]=t;return n+o}),16)||0}reportApiInvoke(e,t,n){t.timeout=t.timeout||6e4,t.reportResult=t.reportResult===void 0||t.reportResult;const o=Date.now();this.apiInvokeCount+=1;const s=this.apiInvokeCount,c=!!H("SHOW_REPORT_INVOKER_LOG"),d=!!H("SHOW_REPORT_USER_INVOKER_LOG"),h=c||d&&t.id;h&&(this.apiInvokeLoggedCount+=1);const p=this.apiInvokeLoggedCount;function m(T,P){if(h){let I="[apiInvoke-".concat(p,"]");if(t.id&&(I+="[".concat(t.id,"]")),t.name&&(I+="[".concat(t.name,"]"),t.name===Nn.JOIN))return R.info("".concat(I," ").concat(T));R.info("".concat(I," ").concat(T),T==="start"?t.options:P||"")}}const g=()=>({tag:t.tag,invokeId:s,sid:e,name:t.name,apiInvokeTime:o,options:t.options,states:t.states||null});m("start");let E=!1;cr(t.timeout).then(()=>{E||(this.sendApiInvoke(ct(ct({},g()),{},{error:j.API_INVOKE_TIMEOUT,success:!1})),m("timeout"))});const y=new re(j.UNEXPECTED_ERROR,"".concat(t.name,": this api invoke is end"));return{onSuccess:T=>{const P=()=>{if(E)throw y;return E=!0,this.sendApiInvoke(ct(ct({},g()),{},{success:!0},t.reportResult&&{result:T})),m("onSuccess"),T};return n?J2(P,t.name+"Success",n,()=>E=!0):P()},onError:T=>{const P=()=>{if(E)throw T;E=!0,this.sendApiInvoke(ct(ct({},g()),{},{success:!1,error:T})),m("onFailure",T.toString())};return n?J2(P,t.name+"Error",n,()=>E=!0):P()}}}sessionInit(e,t){if(this.baseInfoMap.has(e))return;const n=Date.now(),o=this.createBaseInfo(e,n);o.cname=t.cname;const s=Object.assign({},{willUploadConsoleLog:H("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:HR?"global":"oversea",areas:H("AREAS")&&H("AREAS").join(",")},t.extend),{stringUid:c,channelProfile:d,channelMode:h,isABTestSuccess:p,lsid:m,clientRole:g}=t,E=Date.now(),y=ct(ct({},o),{},{eventType:$n.SESSION_INIT,appid:t.appid,browser:navigator.userAgent,buildFormat:t.buildFormat,build:zR,lts:E,elapse:E-n,extend:JSON.stringify(s),mode:t.mode,process:H("PROCESS_ID"),appType:H("APP_TYPE"),success:!0,version:po,stringUid:c,channelProfile:d,channelMode:h,isABTestSuccess:p,lsid:m,clientType:Ee(T=window.navigator.userAgent).call(T,"AgoraWebView")?42:20,clientRole:g,serviceId:H("PROCESS_ID"),extensionID:H("PLUGIN_INFO").join(",")||""});var T;this.send({type:dn.SESSION,data:y},!0)}joinChooseServer(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const o=n.info,s=Date.now(),c=ct(ct({},o),{},{role:t.role,eventType:$n.JOIN_CHOOSE_SERVER,lts:s,eventElapse:t.elapse||s-t.lts,chooseServerAddr:t.csAddr,errorCode:t.ec,elapse:s-n.startTime,success:t.succ,chooseServerAddrList:JSON.stringify(t.serverList),uid:t.uid?parseInt(t.uid):null,cid:t.cid?parseInt(t.cid):null,chooseServerIp:t.csIp||"",opid:t.opid,unilbsServerIds:t.unilbsServerIds,extend:t.extend||void 0,isHttp3:t.isHttp3,corssRegionTagReq:t.corssRegionTagReq||void 0,corssRegionTagRes:t.corssRegionTagRes||void 0});this.send({type:dn.JOIN_CHOOSE_SERVER,data:c},!0)}reqUserAccount(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const o=n.info,s=Date.now(),c=ct(ct({},o),{},{eventType:$n.REQ_USER_ACCOUNT,lts:s,success:t.success,serverAddress:t.serverAddr,stringUid:t.stringUid,uid:t.uid,errorCode:t.errorCode,elapse:t.elapse||s-n.startTime,eventElapse:s-t.lts,extend:JSON.stringify(t.extend)});this.send({type:dn.REQ_USER_ACCOUNT,data:c},!0)}joinGateway(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const o=n.info;t.vid&&(o.vid=t.vid),o.uid=t.uid,o.cid=t.cid;const s=Date.now(),{firstSuccess:c,addr:d,isProxy:h}=t,p=s-n.startTime,m=ct(ct({},o),{},{eventType:$n.JOIN_GATEWAY,lts:s,gatewayAddr:t.addr,success:t.succ,errorCode:t.ec,errorMsg:t.errorMsg||"",elapse:p,eventElapse:s-t.lts,firstSuccess:c,signalChannel:t.signalChannel,preload:t.preload?1:0,installId:WR(),isABTestSuccess:t.isABTestSuccess?1:0}),g=m.success?1:0;if(t.succ&&(n.lastJoinSuccessTime=s),c)this.send({type:dn.JOIN_GATEWAY,data:m},!0);else{let E;if(d)if(h){const T=d.match(/h=(\d{1,3}-){3}\d{1,3}/g),P=d.match(/p=[0-9]{1,6}/g);E={isSuccess:g,gatewayIp:T&&T.length?T[0].split("=")[1].replace(/-/g,"."):"",port:P&&P.length?P[0].split("=")[1]:"",isProxy:h?1:0}}else{const T=d.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),P=d.match(/(:|p=)[0-9]{1,6}/g);E={isSuccess:g,gatewayIp:T&&T.length?T[0].split("//")[1].replace(/-/g,"."):"",port:P&&P.length?P[0].split(/:|p=/g)[1]:"",isProxy:h?1:0}}else E={isSuccess:g,gatewayIp:"",port:"",isProxy:h?1:0};delete m.success,delete m.eventType,delete m.firstSuccess,m.vid=Number(m.vid);const y=Object.assign({},m,E,{eventType:$n.REJOIN_GATEWAY});this.send({type:dn.RE_JOIN_GATEWAY,data:y},!0)}}joinChannelTimeout(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const o=Date.now(),s=ct(ct({},n.info),{},{lts:o,timeout:t,elapse:o-n.startTime});this.send({type:dn.JOIN_CHANNEL_TIMEOUT,data:s},!0)}publish(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const o=n.info,s=Date.now(),c=ct(ct({},o),{},{eventType:$n.PUBLISH,lts:s,eventElapse:t.eventElapse,elapse:s-n.startTime,success:t.succ,errorCode:t.ec,videoName:t.videoName,audioName:t.audioName,screenName:t.screenName,screenshare:t.screenshare,audio:t.audio,video:t.video,p2pid:t.p2pid,publishRequestid:t.publishRequestid});this.send({type:dn.PUBLISH,data:c},!0)}subscribe(e,t,n){const o=this.baseInfoMap.get(e);if(!o)return;const s=o.info,c=Date.now(),d=ct(ct({},s),{},{eventType:$n.SUBSCRIBE,lts:c,eventElapse:t.eventElapse,elapse:c-o.startTime,success:t.succ,errorCode:t.ec,video:t.video,audio:t.audio,subscribeRequestid:t.subscribeRequestid,p2pid:t.p2pid,preSsrc:t.preSsrc?1:0},n&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof t.peerid=="string"?d.peerSuid=t.peerid:d.peer=t.peerid,this.send({type:dn.SUBSCRIBE,data:d},!0)}wsCompressorInit(e){var t;const n=[...Xi(t=this.baseInfoMap).call(t)],o=n.length?n[0]:"UnableToGetSid",s=this.baseInfoMap.get(o);if(!s)return;const c=s.info,d=Date.now(),h=ct(ct({},c),{},{eventType:$n.WS_COMPRESSOR_INIT,lts:d,eventElapse:e.eventElapse,elapse:d-s.startTime,status:e.status?1:2});this.send({type:dn.WS_COMPRESSOR_INIT,data:h},!0)}firstRemoteVideoDecode(e,t,n,o){const s=this.baseInfoMap.get(e);if(!s)return;const c=s.info,d=Date.now(),h=ct(ct(ct({},c),o),{},{elapse:d-s.startTime,eventType:t,lts:d,firstDecodeFrame:Math.max((o.firstFrame||d)-s.startTime,0),apEnd:Math.max(o.apEnd-s.startTime,0),apStart:Math.max(o.apStart-s.startTime,0),joinGwEnd:Math.max(o.joinGwEnd-s.startTime,0),joinGwStart:Math.max(o.joinGwStart-s.startTime,0),pcEnd:Math.max(o.pcEnd-s.startTime,0),pcStart:Math.max(o.pcStart-s.startTime,0),subscriberEnd:Math.max(o.subscriberEnd-s.startTime,0),subscriberStart:Math.max(o.subscriberStart-s.startTime,0),videoAddNotify:Math.max(o.videoAddNotify-s.startTime,0)});this.send({type:n,data:h},!0)}firstRemoteFrame(e,t,n,o){const s=this.baseInfoMap.get(e);if(!s)return;const c=s.info,d=Date.now(),h=ct(ct(ct({},c),o),{},{elapse:d-s.startTime,eventType:t,lts:d});this.send({type:n,data:h},!0)}abTest(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const o=n.info,s=Date.now(),c=ct(ct(ct({},o),t),{},{vid:o.vid===void 0?0:Number(o.vid),elapse:s-n.startTime,eventType:$n.AB_TEST,lts:s});this.send({type:dn.AB_TEST,data:c},!0)}pcStats(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const o=n.info,s=Date.now(),c=ct(ct(ct({},o),t),{},{vid:o.vid===void 0?0:Number(o.vid),elapse:s-n.startTime,eventType:$n.PC_STATS,lts:s,preallocation:t.preallocation?1:0});this.send({type:dn.PC_STATS,data:c},!0)}updateRemoteRTPCapabilities(e,t){if(e){const n=this.baseInfoMap.get(e);if(!n)return;const o=n.info,s=Date.now(),c=ct(ct(ct({},o),t),{},{vid:o.vid===void 0?0:Number(o.vid),eventType:$n.UPDATE_REMOTE_RTPCAPABILITIES,lts:s});this.send({type:dn.UPDATE_REMOTE_RTPCAPABILITIES,data:c},!0)}}onGatewayStream(e,t,n,o){const s=this.baseInfoMap.get(e);if(!s)return;const c=s.info,d=Date.now(),h=ct(ct(ct({},c),o),{},{eventType:t,lts:d});this.send({type:n,data:h},!0)}streamSwitch(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const o=n.info,s=Date.now(),c=ct(ct({},o),{},{eventType:$n.STREAM_SWITCH,lts:s,isDual:t.isdual,elapse:s-n.startTime,success:t.succ});this.send({type:dn.STREAM_SWITCH,data:c},!0)}requestProxyAppCenter(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const o=n.info,s=Date.now(),c=ct(ct({},o),{},{eventType:$n.REQUEST_PROXY_APPCENTER,lts:s,eventElapse:s-t.lts,elapse:s-n.startTime,APAddr:t.APAddr,workerManagerList:t.workerManagerList,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:dn.REQUEST_PROXY_APPCENTER,data:c},!0)}requestProxyWorkerManager(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const o=n.info,s=Date.now(),c=ct(ct({},o),{},{eventType:$n.REQUEST_PROXY_WORKER_MANAGER,lts:s,eventElapse:s-t.lts,elapse:s-n.startTime,workerManagerAddr:t.workerManagerAddr,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:dn.REQUEST_PROXY_WORKER_MANAGER,data:c},!0)}setProxyServer(e){this.proxyServer=e,e?R.debug("reportProxyServerurl: ".concat(e)):R.debug("disable reportProxyServerurl: ".concat(e))}peerPublishStatus(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const o=n.info,s=Date.now(),c=ct(ct({},o),{},{subscribeElapse:t.subscribeElapse,peer:t.peer,peerPublishDuration:Math.max(t.audioPublishDuration,t.videoPublishDuration),audiotag:t.audioPublishDuration>0?1:-1,videotag:t.videoPublishDuration>0?1:-1,lts:s,elapse:s-n.startTime,joinChannelSuccessElapse:s-(n.lastJoinSuccessTime||s),peerPublishDurationVideo:t.videoPublishDuration,peerPublishDurationAudio:t.audioPublishDuration});this.send({type:dn.PEER_PUBLISH_STATUS,data:c},!0)}workerEvent(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const o=n.info,s=Date.now();(function(c,d,h){const p=c[d];if(!p||typeof p!="string")return[c];c[d]="";const m=sa(JSON.stringify(c));let g=0;const E=[];let y=0;for(let T=0;T<p.length;T++)y+=p.charCodeAt(T)<=127?1:3,y<=h-m||(E[E.length]=Ce(Ce({},c),{},{[d]:p.substring(g,T)}),g=T,y=p.charCodeAt(T)<=127?1:3);return g!==p.length-1&&(E[E.length]=Ce(Ce({},c),{},{[d]:p.substring(g)})),E})(ct(ct(ct({},o),t),{},{elapse:s-n.startTime,lts:s,productType:"WebRTC"}),"payload",1300).forEach(c=>this.send({type:dn.WORKER_EVENT,data:c},!0))}apworkerEvent(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const o=n.info,s=Date.now(),c=ct(ct(ct({},o),t),{},{elapse:s-n.startTime,lts:s});this.send({type:dn.AP_WORKER_EVENT,data:c},!0)}joinWebProxyAP(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const o=n.info,s=Date.now(),c=ct(ct(ct({},o),t),{},{elapse:s-n.startTime,lts:s,extend:t.extend||void 0});this.send({type:dn.JOIN_WEB_PROXY_AP,data:c},!0)}WebSocketQuit(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const o=n.info,s=Date.now(),c=ct(ct(ct({},o),t),{},{elapse:s-n.startTime,lts:s});this.send({type:dn.WEBSOCKET_QUIT,data:c},!0)}async sendCustomReportMessage(e,t){if(this.customReportCount+=t.length,this.customReportCount>H("CUSTOM_REPORT_LIMIT"))throw new re(j.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));const n=Date.now(),o=t.map(s=>({type:dn.USER_ANALYTICS,data:ct(ct({sid:e},s),{},{lts:n})}));try{H("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(o):await this.postDataToStatsCollector(o)}catch(s){throw R.error("send custom report message failed",s.toString()),new re(j.CUSTOM_REPORT_SEND_FAILED,s.message)}}sendApiInvoke(e){const t=H("NOT_REPORT_EVENT");if(e.tag&&Ee(t)&&Ee(t).call(t,e.tag))return!1;if(e.sid===null)return this.apiInvokeUploadPendingItems.push(e),!1;const n=this.baseInfoMap.get(e.sid);if(!n)return this.apiInvokeUploadPendingItems.push(e),!1;const{cname:o,uid:s,cid:c}=n.info;let d;if(e.lts=e.lts||Date.now(),e.error)if(e.error instanceof re){const{code:p,message:m}=e.error;d=p||m||e.error.toString()}else d=e.error.toString();const h={invokeId:e.invokeId,sid:e.sid,cname:o,cid:c,uid:s,lts:e.lts,success:e.success,elapse:e.lts-n.startTime,execElapse:e.lts-e.apiInvokeTime,apiName:e.name,options:e.options?JSON.stringify(e.options):void 0,execStates:e.states?JSON.stringify(e.states):void 0,execResult:e.result?JSON.stringify(e.result):void 0,errorCode:e.error?d:void 0,errorMsg:e.error?JSON.stringify(e.error):void 0};return this.send({type:dn.API_INVOKE,data:h},!1),!0}addSid(e){this.sids.add(e)}removeSid(e){this.sids.delete(e)}appendSessionId(){const e=this.apiInvokeUploadPendingItems;if(e.length===0)return;const t=Array.from(this.sids).find(n=>n!==null);t&&e.forEach(n=>{n&&(n.sid=t,this.sendApiInvoke(Object.assign({},n)))}),e.length=0}send(e,t){if(t)return this.keyEventUploadPendingItems.push(e),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(e),this.normalEventUploadPendingItems.length>H("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(e,t){const n=[],o=[];for(;e.length;){const c=e.shift();n.length<20?n.push(c):o.push(c)}e.push(...o);for(const c of[...n]){var s;this.ltsList.indexOf(c.data.lts)!==-1?(c.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(c.data.lts)):(this.ltsList.push(c.data.lts),ql(s=this.ltsList).call(s,(d,h)=>d-h))}return t||(this.lastSendNormalEventTime=Date.now()),H("ENABLE_EVENT_REPORT")&&n.length&&(H("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(n):this.postDataToStatsCollector(n)).catch((c=>d=>{H("EVENT_REPORT_RETRY")&&(t?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(c):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(c),this.normalEventUploadPendingItems.length>H("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-H("NORMAL_EVENT_QUEUE_CAPACITY")),R.warning("report: drop normal events"))))})(n)),e}async postDataToStatsCollector2(e){On.networkState===xi.OFFLINE&&await ye.race([On.onlineWaiter,cr(2*Un.maxRetryTimeout)]);const t=s=>{let c=new Uint8Array;return s.forEach(d=>{const h=NR(JSON.stringify(d.data)),p=new ArrayBuffer(5),m=(E=>{let y=0;return Object.entries(dn).forEach(T=>{let[P,I]=T;I===E.type&&(y=Fie[P])}),y})(d),g=new DataView(p);g.setUint16(0,h.byteLength,!0),g.setUint8(2,255&m),g.setUint8(3,m>>>8&255),g.setUint8(4,m>>>16&255),c=W2(c,new Uint8Array(p)),c=W2(c,h)}),c},n="event";let o=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(H("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(n):"https://".concat(H("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(n);for(let s=0;s<2;s+=1){s===1&&(o=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(H("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(n):"https://".concat(H("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(n));try{await UR(o,{timeout:1e4,data:t(e),headers:ct(ct({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(c){if(s===1)throw c;continue}return}}async postDataToStatsCollector(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=(h=>{const p=h&&h.data.sid&&this.baseInfoMap.get(h.data.sid);return p&&p.info.vid&&+p.info.vid||0})(e[0]),o=n?void 0:this._aid,s={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:e.map(h=>JSON.stringify(h)),vid:n,aid:o};On.networkState===xi.OFFLINE&&await ye.race([On.onlineWaiter,cr(2*Un.maxRetryTimeout)]);const c=t?"/events/proto-raws":"/events/messages";let d=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(H("EVENT_REPORT_DOMAIN"),"&p=").concat(H("STATS_COLLECTOR_PORT"),"&d=").concat(c):"https://".concat(H("EVENT_REPORT_DOMAIN"),":").concat(H("STATS_COLLECTOR_PORT")).concat(c));for(let h=0;h<2;h+=1){h===1&&(d=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(H("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(H("STATS_COLLECTOR_PORT"),"&d=").concat(c):"https://".concat(H("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(H("STATS_COLLECTOR_PORT")).concat(c)));try{t?await Cie(d,{timeout:1e4,data:s}):await UR(d,{timeout:1e4,data:s})}catch(p){if(h===1)throw p;continue}return}}createBaseInfo(e,t){const n=Object.assign({},Vie);return n.sid=e,this.baseInfoMap.set(e,{info:n,startTime:t}),n}reportResourceTiming(e,t){const n=performance.getEntriesByName(e),o=n[n.length-1];o&&this.reportApiInvoke(t,{name:"Client.resourceTiming",options:o,tag:En.TRACER}).onSuccess()}};gM.on("REPORT_LOG_UPLOAD",e=>{e.networkState=On.networkState,ke.reportApiInvoke(null,{name:"logUploadError",options:e,tag:En.TRACER}).onSuccess("logUploadError")});class ee extends re{constructor(t){super(t,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),vn(this,"name","AgoraRTCException")}print(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(t,R)}throw(){super.throw(R)}}const lr={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function Rt(){return lr}function vM(){return"setSinkId"in HTMLAudioElement.prototype&&(!H("RESTRICTION_SET_PLAYBACK_DEVICE")||(Ha()||O2())&&!bR())}function yM(){return!lr.supportUnifiedPlan||H("CHROME_FORCE_PLAN_B")&&Ga()}let dr=function(e){return e.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",e.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",e.IOS_INTERRUPTION_START="ios-interruption-start",e.IOS_INTERRUPTION_END="ios-interruption-end",e.STATE_CHANGE="state-change",e}({});function nh(e,t,n){return{sampleRate:e,stereo:t,bitrate:n}}function Ct(e,t,n,o,s){return{width:e,height:t,frameRate:n,bitrateMin:o,bitrateMax:s}}function Xo(e,t,n,o,s){return{width:{max:e},height:{max:t},frameRate:n,bitrateMin:o,bitrateMax:s}}function XR(e,t){return{numSpatialLayers:e,numTemporalLayers:t}}const Bie={"90p":Ct(160,90),"90p_1":Ct(160,90),"120p":Ct(160,120,15,30,65),"120p_1":Ct(160,120,15,30,65),"120p_3":Ct(120,120,15,30,50),"120p_4":Ct(212,120),"180p":Ct(320,180,15,30,140),"180p_1":Ct(320,180,15,30,140),"180p_3":Ct(180,180,15,30,100),"180p_4":Ct(240,180,15,30,120),"240p":Ct(320,240,15,40,200),"240p_1":Ct(320,240,15,40,200),"240p_3":Ct(240,240,15,40,140),"240p_4":Ct(424,240,15,40,220),"360p":Ct(640,360,15,80,400),"360p_1":Ct(640,360,15,80,400),"360p_3":Ct(360,360,15,80,260),"360p_4":Ct(640,360,30,80,600),"360p_6":Ct(360,360,30,80,400),"360p_7":Ct(480,360,15,80,320),"360p_8":Ct(480,360,30,80,490),"360p_9":Ct(640,360,15,80,800),"360p_10":Ct(640,360,24,80,800),"360p_11":Ct(640,360,24,80,1e3),"480p":Ct(640,480,15,100,500),"480p_1":Ct(640,480,15,100,500),"480p_2":Ct(640,480,30,100,1e3),"480p_3":Ct(480,480,15,100,400),"480p_4":Ct(640,480,30,100,750),"480p_6":Ct(480,480,30,100,600),"480p_8":Ct(848,480,15,100,610),"480p_9":Ct(848,480,30,100,930),"480p_10":Ct(640,480,10,100,400),"720p":Ct(1280,720,15,120,1130),"720p_auto":Ct(1280,720,30,900,3e3),"720p_1":Ct(1280,720,15,120,1130),"720p_2":Ct(1280,720,30,120,2e3),"720p_3":Ct(1280,720,30,120,1710),"720p_5":Ct(960,720,15,120,910),"720p_6":Ct(960,720,30,120,1380),"1080p":Ct(1920,1080,15,120,2080),"1080p_1":Ct(1920,1080,15,120,2080),"1080p_2":Ct(1920,1080,30,120,3e3),"1080p_3":Ct(1920,1080,30,120,3150),"1080p_5":Ct(1920,1080,60,120,4780),"1440p":Ct(2560,1440,30,120,4850),"1440p_1":Ct(2560,1440,30,120,4850),"1440p_2":Ct(2560,1440,60,120,7350),"4k":Ct(3840,2160,30,120,8910),"4k_1":Ct(3840,2160,30,120,8910),"4k_3":Ct(3840,2160,60,120,13500)},Wie={"480p":Xo(640,480,5),"480p_1":Xo(640,480,5),"480p_2":Xo(640,480,30),"480p_3":Xo(640,480,15),"720p":Xo(1280,720,5),"720p_auto":Ct(1280,720,30,900,3e3),"720p_1":Xo(1280,720,5),"720p_2":Xo(1280,720,30),"720p_3":Xo(1280,720,15),"1080p":Xo(1920,1080,5),"1080p_1":Xo(1920,1080,5),"1080p_2":Xo(1920,1080,30),"1080p_3":Xo(1920,1080,15)},Hie={"1SL1TL":XR(1,1),"3SL3TL":XR(3,3),"2SL3TL":XR(2,3)};function $o(e){return e||(e="480p_1"),typeof e=="string"?Object.assign({},Bie[e]):e}function $R(e){return typeof e=="string"?Object.assign({},Wie[e]):e}function xE(e){return typeof e=="string"?Object.assign({},Hie[e]):e}const Gie={speech_low_quality:nh(16e3,!1),speech_standard:nh(32e3,!1,18),music_standard:nh(48e3,!1),standard_stereo:nh(48e3,!0,56),high_quality:nh(48e3,!1,128),high_quality_stereo:nh(48e3,!0,192)};function LE(e){return typeof e=="string"?Object.assign({},Gie[e]):e}const rh=[];function SM(e){return Kn(e,"mediaSource",["screen","window","application"]),!0}let Ne=function(e){return e.NEED_RENEGOTIATE="@need_renegotiate",e.NEED_REPLACE_TRACK="@need_replace_track",e.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",e.NEED_CLOSE="@need_close",e.NEED_ENABLE_TRACK="@need_enable_track",e.NEED_DISABLE_TRACK="@need_disable_track",e.NEED_SESSION_ID="@need_sid",e.SET_OPTIMIZATION_MODE="@set_optimization_mode",e.GET_STATS="@get_stats",e.GET_RTC_STATS="@get_rtc_stats",e.GET_LOW_VIDEO_TRACK="@get_low_video_track",e.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",e.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",e.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",e.NEED_MUTE_TRACK="@need_mute_track",e.NEED_UNMUTE_TRACK="@need_unmute_track",e}({}),Gt=function(e){return e.SCREEN_TRACK="screen_track",e.CUSTOM_TRACK="custome_track",e.LOW_STREAM="low_stream",e.SCREEN_LOW_TRACK="screen_low_track",e}({}),ih=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e}({}),zie=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",e}({}),Kie=function(e){return e[e.DISABLE=0]="DISABLE",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.AUDIO_ONLY=2]="AUDIO_ONLY",e[e.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",e}({}),ad=function(e){return e.TRANSCEIVER_UPDATED="transceiver-updated",e.SEI_TO_SEND="sei-to-send",e.SEI_RECEIVED="sei-received",e.TRACK_UPDATED="track-updated",e}({}),oh=function(e){return e.SOURCE_STATE_CHANGE="source-state-change",e.TRACK_ENDED="track-ended",e.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.CLOSED="closed",e}({}),sh=function(e){return e.FIRST_FRAME_DECODED="first-frame-decoded",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.VIDEO_STATE_CHANGED="video-state-changed",e}({}),ah=function(e){return e.AUDIO="audio",e.VIDEO="video",e.DATA="data",e}({}),$i=function(e){return e.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",e.RECEIVE_TRACK_BUFFER="receive_track_buffer",e.ON_AUDIO_BUFFER="on_audio_buffer",e.UPDATE_SOURCE="update_source",e}({});(function(e){e.UPDATE_TRACK_SOURCE="update-track-source"})({});const JR={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},QR={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},TM={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},Yie={uplinkNetworkQuality:0,downlinkNetworkQuality:0},wM={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let Qr=function(e){return e.ON_TRACK="on_track",e.ON_NODE="on_node",e}({}),Ji=function(e){return e.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",e.REQUEST_CONSTRAINTS="request_constraints",e}({}),Vf=function(e){return e.IDLE="IDLE",e.INITING="INITING",e.INITEND="INITEND",e}({}),cd=function(e){return e.STATE_CHANGE="state_change",e.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",e.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",e.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",e}({}),Ur=function(e){return e.NONE="none",e.INIT="init",e.CANPLAY="canplay",e.PLAYING="playing",e.PAUSED="paused",e.SUSPEND="suspend",e.STALLED="stalled",e.WAITING="waiting",e.ERROR="error",e.DESTROYED="destroyed",e.ABORT="abort",e.ENDED="ended",e.EMPTIED="emptied",e.LOADEDDATA="loadeddata",e}({}),ca=function(e){return e[e.VideoStateStopped=0]="VideoStateStopped",e[e.VideoStateStarting=1]="VideoStateStarting",e[e.VideoStateDecoding=2]="VideoStateDecoding",e[e.VideoStateFrozen=3]="VideoStateFrozen",e}({});const ZR={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};let ME=function(e){return e.OPEN="open",e.MESSAGE="message",e.CLOSE="close",e.CLOSING="closing",e.ERROR="error",e}({});function vt(e,t,n,o,s){var c,d,h={};return Object.keys(o).forEach(function(p){h[p]=o[p]}),h.enumerable=!!h.enumerable,h.configurable=!!h.configurable,("value"in h||h.initializer)&&(h.writable=!0),h=Fo(c=c1(d=n.slice()).call(d)).call(c,function(p,m){return m(e,t,p)||p},h),s&&h.initializer!==void 0&&(h.value=h.initializer?h.initializer.call(s):void 0,h.initializer=void 0),h.initializer===void 0?(Object.defineProperty(e,t,h),null):h}function Z(e,t,n){return(t=function(o){var s=function(c,d){if(typeof c!="object"||!c)return c;var h=c[Symbol.toPrimitive];if(h!==void 0){var p=h.call(c,"string");if(typeof p!="object")return p;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(c)}(o);return typeof s=="symbol"?s:s+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function RM(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,o)}return n}function un(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?RM(Object(n),!0).forEach(function(o){Z(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):RM(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}class CM extends pn{set _mediaStreamTrack(t){t!==this.mediaStreamTrack&&(this.safeEmit(ad.TRACK_UPDATED,t),this.mediaStreamTrack=t)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(t,n){super(),Z(this,"trackMediaType",void 0),Z(this,"_ID",void 0),Z(this,"_rtpTransceiver",void 0),Z(this,"_lowRtpTransceiver",void 0),Z(this,"_hints",[]),Z(this,"_isClosed",!1),Z(this,"_originMediaStreamTrack",void 0),Z(this,"mediaStreamTrack",void 0),Z(this,"_external",{}),this._ID=n||Jt(8,"track-"),this._originMediaStreamTrack=t,this.mediaStreamTrack=t,function(o){Ee(rh).call(rh,o)||rh.push(o)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(t){return t||Dc(()=>{var n;ke.reportApiInvoke(null,{name:Nn.GET_MEDIA_STREAM_TRACK,options:[],tag:En.TRACER}).onSuccess(((n=this._mediaStreamTrack)===null||n===void 0?void 0:n.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(t){return t===ih.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(t){const n=rh.indexOf(t);n!==-1&&rh.splice(n,1)}(this),this.emit(oh.CLOSED),this.removeAllListeners(ad.SEI_RECEIVED)}_updateRtpTransceiver(t,n){if(n===ih.LOW_STREAM){if(this._lowRtpTransceiver===t)return;this._lowRtpTransceiver=t}else{if(this._rtpTransceiver===t)return;this._rtpTransceiver=t}this.emit(ad.TRANSCEIVER_UPDATED,t,n)}}class ch extends CM{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(t,n){super(t,n),Z(this,"_enabled",!0),Z(this,"_muted",!1),Z(this,"_isExternalTrack",!1),Z(this,"_isClosed",!1),Z(this,"_enabledMutex",void 0),Z(this,"processor",void 0),Z(this,"_processorContext",void 0),Z(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new Ir("".concat(this.getTrackId())),t.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var t,n;return(t=(n=this._originMediaStreamTrack)===null||n===void 0?void 0:n.label)!==null&&t!==void 0?t:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,R.debug("[".concat(this.getTrackId(),"] close")),this.emit(Ne.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(t,n){let o=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=o,t!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),n&&this._originMediaStreamTrack.stop()),t.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=t,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Yt(this,Ne.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){R.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(oh.TRACK_ENDED)}stateCheck(t,n){if(R.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(t,": ").concat(n,"]")),za(n,t),this._enabled&&this._muted&&t==="enabled"&&n===!1)throw new re(j.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",R);if(!this._enabled&&!this._muted&&t==="muted"&&n===!0)throw new re(j.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",R)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():ye.resolve([])}}const bM=window.AudioContext||window.webkitAudioContext;let Qi=null;const Vt=new class extends pn{constructor(){super(...arguments),Z(this,"prevState",void 0),Z(this,"curState",void 0),Z(this,"currentTime",void 0),Z(this,"currentTimeStuckAt",void 0),Z(this,"interruptDetectorTrack",void 0),Z(this,"onLocalAudioTrackMute",()=>{R.info("ios15-interruption-start"),this.emit(dr.IOS_15_16_INTERRUPTION_START)}),Z(this,"onLocalAudioTrackUnmute",async()=>{R.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?R.info("ios15-interruption-end-canceled"):(Qi&&await Qi.suspend(),this.emit(dr.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(e){R.debug("webaudio bindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=e,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(e){R.debug("webaudio unbindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===e&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function lh(){if(!Qi){if(function(){if(!bM)return void R.error("your browser is not support web audio");R.info("create audio context");const e=un({},H("WEBAUDIO_INIT_OPTIONS"));R.debug("audio context init option:",JSON.stringify(e)),Qi=new bM(e),Vt.curState=Qi.state,Qi.onstatechange=()=>{Vt.prevState=Vt.curState,Vt.curState=Qi?Qi.state:void 0;const{prevState:t,curState:n}=Vt,o=n==="running",s=n==="interrupted",c=t==="running",d=t==="suspended",h=t==="interrupted",p=wt().osVersion;(Jr()||Yo())&&c&&s&&(R.info("ios".concat(p,"-interruption-start")),Vt.emit(dr.IOS_INTERRUPTION_START)),(Jr()||Yo())&&(d||h)&&o&&(R.info("ios".concat(p,"-interruption-end")),Vt.emit(dr.IOS_INTERRUPTION_END)),t!==n&&Vt.emit(dr.STATE_CHANGE,n,t)},setInterval(()=>{var t;const n=(t=Qi)===null||t===void 0?void 0:t.currentTime;Vt.currentTime!==n?(Vt.currentTimeStuckAt&&(R.debug("AudioContext current time resume at ".concat(n)),Vt.currentTimeStuckAt=void 0),Vt.currentTime=n):(n!==Vt.currentTimeStuckAt&&(ke.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:n},tag:En.TRACER}).onSuccess(),R.warning("AudioContext current time stuck at ".concat(n))),Vt.currentTimeStuckAt=n)},5e3),async function(t){const n=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let o,s=!1,c=!1,d=!1;function h(I){t.state==="running"?p(!1):Jr()||Yo()?t.state==="suspended"&&(p(!0),I&&t.resume().then(m,m)):t.state!=="closed"&&(p(!0),I&&t.resume().then(m,m))}function p(I){if(s!==I){s=I;for(let A=0,M=n;A<M.length;A+=1){const U=M[A];I?window.addEventListener(U,g,{capture:!0,passive:!0}):window.removeEventListener(U,g,{capture:!0,passive:!0})}}}function m(){h(!1)}function g(){h(!0)}function E(I){if(!d)if(o.paused)if(I){let A;y(!1),d=!0;try{A=o.play(),A?A.then(T,T):(o.addEventListener("playing",T),o.addEventListener("abort",T),o.addEventListener("error",T))}catch{T()}}else y(!0);else y(!1)}function y(I){if(c!==I){c=I;for(let A=0,M=n;A<M.length;A++){const U=M[A];I?window.addEventListener(U,P,{capture:!0,passive:!0}):window.removeEventListener(U,P,{capture:!0,passive:!0})}}}function T(){o.removeEventListener("playing",T),o.removeEventListener("abort",T),o.removeEventListener("error",T),d=!1,E(!1)}function P(){E(!0)}if(Jr()){const I=t.createMediaStreamDestination(),A=document.createElement("div");A.innerHTML="<audio x-webkit-airplay='deny'></audio>",o=A.children.item(0),o.controls=!1,o.disableRemotePlayback=!0,o.preload="auto",o.srcObject=I.stream,E(!0)}Vt.on(dr.STATE_CHANGE,function(){h(!0)}),h(!1)}(Qi)}(),!Qi)throw new re(j.NOT_SUPPORTED,"can not create audio context");return Qi}return Qi}function ld(e){if(function(){if(eC!==null)return eC;const o=lh(),s=o.createBufferSource(),c=o.createGain(),d=o.createGain();s.connect(c),s.connect(d),s.disconnect(c);let h=!1;try{s.disconnect(c)}catch{h=!0}return s.disconnect(),eC=h,h}())return;const t=e.connect,n=e.disconnect;e.connect=(o,s,c)=>{var d;return e._inputNodes||(e._inputNodes=[]),Ee(d=e._inputNodes).call(d,o)||(o instanceof AudioNode?(e._inputNodes.push(o),t.call(e,o,s,c)):t.call(e,o,s)),e},e.disconnect=(o,s,c)=>{n.call(e),o?CE(e._inputNodes,o):e._inputNodes=[];for(const d of e._inputNodes)t.call(e,d)}}let eC=null;function tC(e,t){let n=!1;const o=1/t;if(H("DISABLE_WEBAUDIO")){const s=window.setInterval(()=>{n?window.clearInterval(s):e(performance.now()/1e3)},1e3*o)}else{const s=lh();let c=s.createGain();c.gain.value=0,c.connect(s.destination);const d=()=>{if(n)return void(c=null);const h=s.createOscillator();h.onended=d,h.connect(c),h.start(0),h.stop(s.currentTime+o),e(s.currentTime)};d()}return()=>{n=!0}}class IM{constructor(){Z(this,"context",void 0),Z(this,"analyserNode",void 0),Z(this,"sourceNode",void 0),this.context=lh(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(t){if(t!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=t,t==null||t.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||Jr()||Yo()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;const t=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(t);else{const o=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(o);for(let s=0;s<t.length;++s)t[s]=o[s]/128-1}const n=Fo(t).call(t,(o,s)=>o+s*s,0)/t.length;return Math.max(10*Math.log10(n)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var t,n;(t=this.sourceNode)===null||t===void 0||t.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(n=this.sourceNode)===null||n===void 0||n.connect(this.analyserNode)}catch{R.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class AM extends pn{get processSourceNode(){return this.sourceNode}set processedNode(t){var n;if(!this.isDestroyed&&this._processedNode!==t){try{var o;(o=this.sourceNode)===null||o===void 0||o.disconnect(this.outputNode)}catch{}(n=this._processedNode)===null||n===void 0||n.disconnect(),this._processedNode=t,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),Z(this,"outputNode",void 0),Z(this,"outputTrack",void 0),Z(this,"isPlayed",!1),Z(this,"sourceNode",void 0),Z(this,"context",void 0),Z(this,"audioBufferNode",void 0),Z(this,"destNode",void 0),Z(this,"audioOutputLevel",0),Z(this,"volumeLevelAnalyser",void 0),Z(this,"_processedNode",void 0),Z(this,"playNode",void 0),Z(this,"isDestroyed",!1),Z(this,"onNoAudioInput",void 0),Z(this,"isNoAudioInput",!1),Z(this,"_noAudioInputCount",0),this.context=lh(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),ld(this.outputNode),this.volumeLevelAnalyser=new IM}startGetAudioBuffer(t){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(t),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=n=>{this.emit($i.ON_AUDIO_BUFFER,function(o){for(let s=0;s<o.outputBuffer.numberOfChannels;s+=1){const c=o.outputBuffer.getChannelData(s);for(let d=0;d<c.length;d+=1)c[d]=0}return o.inputBuffer}(n))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!Rt().webAudioMediaStreamDest)throw new re(j.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(t){this.context.state!=="running"&&bE(()=>{Vt.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=t||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(t>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;Jr()||Yo()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();const n=this.volumeLevelAnalyser.getAnalyserNode();let o;n.getFloatTimeDomainData?(o=new Float32Array(n.fftSize),n.getFloatTimeDomainData(o)):(o=new Uint8Array(n.fftSize),n.getByteTimeDomainData(o));let s=!1;for(let c=0;c<o.length;c++)o[c]!==0&&(s=!0);return s?(this.isNoAudioInput=!1,!0):(await cr(200),await this.checkHasAudioInput(t?t+1:1)&&s)}getAudioVolume(){return this.outputNode.gain.value}setVolume(t){this.outputNode.gain.setValueAtTime(t,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var t,n;(t=this.processedNode)===null||t===void 0||t.disconnect(),(n=this.sourceNode)===null||n===void 0||n.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var t;this.processedNode?(t=this.processedNode)===null||t===void 0||t.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class NM extends AM{get isFreeze(){return!1}constructor(t,n,o){var s;if(super(),Z(this,"sourceNode",void 0),Z(this,"track",void 0),Z(this,"clonedTrack",void 0),Z(this,"audioElement",void 0),Z(this,"isCurrentTrackCloned",!1),Z(this,"isRemoteTrack",!1),Z(this,"originVolumeLevelAnalyser",void 0),Z(this,"rebuildWebAudio",async()=>{if(R.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void R.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>R.info("resume success")),R.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const h=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?h.stop():this.isCurrentTrackCloned=!0;const p=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(p),ld(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const m=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(m,this.context.currentTime),ld(this.outputNode),this.emit($i.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=p,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),t.kind!=="audio")throw new re(j.UNEXPECTED_ERROR);this.track=t;const c=new MediaStream([this.track]);if(this.isRemoteTrack=!!n,this.sourceNode=this.context.createMediaStreamSource(c),ld(this.sourceNode),o){const h=o.clone();h.enabled=!0,this.clonedTrack=h,R.debug("create an unmuted track ".concat(h.id," from the original track ").concat(o.id," to get the volume"));const p=this.context.createMediaStreamSource(new MediaStream([h]));ld(p),this.originVolumeLevelAnalyser=new IM,this.originVolumeLevelAnalyser.updateSource(p)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=c;const d=wt();n&&d.os===Xn.IOS&&Number((s=d.osVersion)===null||s===void 0?void 0:s.split(".")[0])<15&&(Vt.on(dr.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(h=>{h||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(t){this.sourceNode.disconnect(),this.track=t,this.isCurrentTrackCloned=!1;const n=new MediaStream([t]);this.sourceNode=this.context.createMediaStreamSource(n),ld(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit($i.UPDATE_SOURCE),this.audioElement.srcObject=n}destroy(){var t;this.audioElement.srcObject=null,this.audioElement.remove(),Vt.off("state-change",this.rebuildWebAudio),(t=this.originVolumeLevelAnalyser)===null||t===void 0||t.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(t){return this.context.createMediaStreamSource(new MediaStream([t]))}updateOriginTrack(t){const n=t.clone();n.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=n),R.debug("create an unmuted track ".concat(n.id," from the original track ").concat(t.id," to get the volume"));const o=this.context.createMediaStreamSource(new MediaStream([n]));ld(o),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(o)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function OM(e,t,n){const o=(c,d)=>c?typeof c!="number"?c.max||c.exact||c.ideal||c.min||d:c:d,s={audio:!!n&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxHeight:o(t.height,1080),maxWidth:o(t.width,1920)}}};return t.frameRate&&typeof t.frameRate!="number"?(s.video.mandatory.maxFrameRate=t.frameRate.max,s.video.mandatory.minFrameRate=t.frameRate.min):typeof t.frameRate=="number"&&(s.video.mandatory.maxFrameRate=t.frameRate),await navigator.mediaDevices.getUserMedia(s)}async function qie(e,t){const n=await PM(e.mediaSource),{sourceId:o,audio:s}=await function(c){let d=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new ye((h,p)=>{const m=document.createElement("div");m.innerText="share screen",m.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const g=document.createElement("div");g.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const E=document.createElement("div");E.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",E.setAttribute("style","height: 12%;");const y=document.createElement("div");y.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const T=document.createElement("div");T.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const P=document.createElement("button");P.innerHTML="cancel",P.setAttribute("style","width: 85px;"),P.onclick=()=>{document.body.removeChild(M);const U=new Error("NotAllowedError");U.name="NotAllowedError",p(U)};let I=d;const A=document.createElement("div");if(d){const U=document.createElement("input");U.setAttribute("type","checkbox");const Y=document.createElement("span");U.setAttribute("style","margin-right: 6px;"),Y.innerText="Share audio",U.checked=I,U.onchange=()=>{I=U.checked},A.appendChild(U),A.appendChild(Y)}T.appendChild(A),T.appendChild(P),g.appendChild(E),g.appendChild(y),g.appendChild(T);const M=document.createElement("div");M.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),M.appendChild(m),M.appendChild(g),document.body.appendChild(M),c.map(U=>{if(U.id){const Y=document.createElement("div");Y.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let Q=U.thumbnail;try{const{width:J}=Q.getSize();J>1920&&(Q=Q.resize({width:1920}))}catch(J){throw J&&J.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),J}Y.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+Q.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+U.name.replace(/[\u00A0-\u9999<>\&]/g,function(J){return"&#"+J.charCodeAt(0)+";"})+"</span>",Y.onclick=()=>{document.body.removeChild(M),h({sourceId:U.id,audio:I})},y.appendChild(Y)}})})}(n,t);return await OM(o,e,s)}async function PM(e){let t=["window","screen"];e!=="application"&&e!=="window"||(t=["window"]),e==="screen"&&(t=["screen"]);const n=H2();if(!n)throw console.error("failed to fetch electron, please mount it to window"),new re(j.ELECTRON_IS_NULL);let o=null;try{var s;o=((s=n.desktopCapturer)===null||s===void 0?void 0:s.getSources({types:t}))||n.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:t})}catch{o=null}o&&o.then||(o=new ye((c,d)=>{n.desktopCapturer.getSources({types:t},(h,p)=>{h?d(h):c(p)})}));try{return await o}catch(c){throw new re(j.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,c.toString())}}const nC=new Ir("safari");let DM=!1,kM=!1;async function Zi(e,t){let n=0,o=null;for(;n<2;)try{o=await Xie(e,t,n>0);break}catch(s){if(s instanceof re)throw R.error("[".concat(t,"] ").concat(s.toString())),s;const c=UE(s.name||s.code||s,s.message);if(c.code===j.MEDIA_OPTION_INVALID){R.debug("[".concat(t,"] detect media option invalid, retry")),n+=1,await cr(500);continue}throw R.error("[".concat(t,"] ").concat(c.toString())),c}if(!o)throw new re(j.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return o}async function Xie(e,t,n){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new re(j.NOT_SUPPORTED,"can not find getUserMedia");n&&(e.video&&(delete e.video.width,delete e.video.height),e.screen&&(delete e.screen.width,delete e.screen.height));const o=Rt(),s=new MediaStream;if(e.audioSource&&s.addTrack(e.audioSource),e.videoSource&&s.addTrack(e.videoSource),!e.audio&&!e.video&&!e.screen)return R.debug("Using Video Source/ Audio Source"),s;if(e.screen)if(H2())e.screen.sourceId?dh(s,await OM(e.screen.sourceId,e.screen,!!e.screenAudio)):dh(s,await qie(e.screen,!!e.screenAudio));else if(Ha()&&e.screen.extensionId&&e.screen.mandatory){if(!o.getStreamFromExtension)throw new re(j.NOT_SUPPORTED,"This browser does not support screen sharing");R.debug("[".concat(t,'] Screen access on chrome stable, looking for extension"'));const y=await(d=e.screen.extensionId,h=t,new ye((T,P)=>{try{chrome.runtime.sendMessage(d,{getStream:!0},I=>{if(!I||!I.streamId)return R.error("[".concat(h,"] No response from Chrome Plugin. Plugin not installed properly"),I),void P(new re(j.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));T(I.streamId)})}catch(I){R.error("[".concat(h,"] AgoraRTC screensharing plugin is not accessible(").concat(d,")"),I.toString()),P(new re(j.CHROME_PLUGIN_NOT_INSTALL))}}));e.screen.mandatory.chromeMediaSourceId=y,dh(s,await navigator.mediaDevices.getUserMedia({video:{mandatory:e.screen.mandatory}}))}else if(o.getDisplayMedia){var c;e.screen.mediaSource&&SM(e.screen.mediaSource);const y={width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate,displaySurface:(c=e.screen.displaySurface)!==null&&c!==void 0?c:e.screen.mediaSource==="screen"?"monitor":e.screen.mediaSource},{selfBrowserSurface:T,surfaceSwitching:P,systemAudio:I,preferCurrentTab:A}=e.screen,M={selfBrowserSurface:T,surfaceSwitching:P,systemAudio:I,preferCurrentTab:A};!T&&delete M.selfBrowserSurface,!P&&delete M.surfaceSwitching,!I&&delete M.systemAudio,!A&&delete M.preferCurrentTab,R.debug("[".concat(t,"] getDisplayMedia:"),JSON.stringify({video:y,audio:e.screenAudio,controls:M})),dh(s,await navigator.mediaDevices.getDisplayMedia(un({video:y,audio:e.screenAudio},M)))}else{if(!gn())throw R.error("[".concat(t,"] This browser does not support screenSharing")),new re(j.NOT_SUPPORTED,"This browser does not support screen sharing");{e.screen.mediaSource&&SM(e.screen.mediaSource);const y={video:{mediaSource:e.screen.mediaSource,width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate}};R.debug("[".concat(t,"] getUserMedia: ").concat(JSON.stringify(y))),dh(s,await navigator.mediaDevices.getUserMedia(y))}}var d,h;if(!e.video&&!e.audio)return s;let p={video:e.video,audio:e.audio},m=H("MEDIA_DEVICE_CONSTRAINTS");if(m)try{typeof m=="string"&&(m=JSON.parse(m)),p=DR(p,m)}catch{}R.debug("[".concat(t,"] GetUserMedia"),JSON.stringify(p)),wt();let g,E=null;(gr()||Jr()||wE())&&(E=await nC.lock());try{g=await navigator.mediaDevices.getUserMedia(p)}catch(y){throw E&&E(),y}return p.audio&&(DM=!0),p.video&&(kM=!0),dh(s,g),E&&E(),s}function UE(e,t){switch(e){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new re(j.MEDIA_OPTION_INVALID,"".concat(e,": ").concat(t));case"NotFoundError":case"DevicesNotFoundError":return new re(j.DEVICE_NOT_FOUND,"".concat(e,": ").concat(t));case"NotSupportedError":return new re(j.NOT_SUPPORTED,"".concat(e,": ").concat(t));case"NotReadableError":return new re(j.NOT_READABLE,"".concat(e,": ").concat(t));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new re(j.PERMISSION_DENIED,"".concat(e,": ").concat(t));case"ConstraintNotSatisfiedError":return new re(j.CONSTRAINT_NOT_SATISFIED,"".concat(e,": ").concat(t));default:return R.error("getUserMedia unexpected error",e),new re(j.UNEXPECTED_ERROR,"".concat(e,": ").concat(t))}}function dh(e,t){const n=e.getVideoTracks()[0],o=e.getAudioTracks()[0],s=t.getVideoTracks()[0],c=t.getAudioTracks()[0];c&&(o&&e.removeTrack(o),e.addTrack(c)),s&&(n&&e.removeTrack(n),e.addTrack(s))}const eo=new class extends pn{get state(){return this._state}set state(e){e!==this._state&&(this.emit(cd.STATE_CHANGE,e),this._state=e)}constructor(){super(),Z(this,"_state",Vf.IDLE),Z(this,"isAccessMicrophonePermission",!1),Z(this,"isAccessCameraPermission",!1),Z(this,"lastAccessMicrophonePermission",!1),Z(this,"lastAccessCameraPermission",!1),Z(this,"checkdeviceMatched",!1),Z(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(H("ENUMERATE_DEVICES_INTERVAL")||(RE()||TE()===Xn.HARMONY_OS)&&Ga())&&this.updateDevicesInfo()},H("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(e=>R.error(e.toString()))}async enumerateDevices(e,t){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new re(j.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const o=await navigator.mediaDevices.enumerateDevices(),s=this.checkMediaDeviceInfoIsOk(o);let c=!this.isAccessMicrophonePermission&&e,d=!this.isAccessCameraPermission&&t;s.audio&&(c=!1),s.video&&(d=!1);let h=null,p=null,m=null;if(!n&&(c||d)){if(nC.isLocked&&(R.debug("[device manager] wait GUM lock"),(await nC.lock())(),R.debug("[device manager] GUM unlock")),DM&&(c=!1,this.isAccessMicrophonePermission=!0),kM&&(d=!1,this.isAccessCameraPermission=!0),R.debug("[device manager] check media device permissions",e,t,c,d),c&&d){try{m=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(g){const E=UE(g.name||g.code||g,g.message);if(E.code===j.PERMISSION_DENIED)throw E;R.warning("getUserMedia failed in getDevices",E)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(c){try{h=await navigator.mediaDevices.getUserMedia({audio:e})}catch(g){const E=UE(g.name||g.code||g,g.message);if(E.code===j.PERMISSION_DENIED)throw E;R.warning("getUserMedia failed in getDevices",E)}this.isAccessMicrophonePermission=!0}else if(d){try{p=await navigator.mediaDevices.getUserMedia({video:t})}catch(g){const E=UE(g.name||g.code||g,g.message);if(E.code===j.PERMISSION_DENIED)throw E;R.warning("getUserMedia failed in getDevices",E)}this.isAccessCameraPermission=!0}R.debug("[device manager] mic permission",e,"cam permission",t)}try{const g=await navigator.mediaDevices.enumerateDevices();return h&&h.getTracks().forEach(E=>E.stop()),p&&p.getTracks().forEach(E=>E.stop()),m&&m.getTracks().forEach(E=>E.stop()),h=null,p=null,m=null,g}catch(g){return h&&h.getTracks().forEach(E=>E.stop()),p&&p.getTracks().forEach(E=>E.stop()),m&&m.getTracks().forEach(E=>E.stop()),h=null,p=null,m=null,new re(j.ENUMERATE_DEVICES_FAILED,g.toString()).throw()}}async getRecordingDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(t=>t.kind==="audioinput")}async getCamerasDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,e)).filter(t=>t.kind==="videoinput")}async getSpeakers(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(t=>t.kind==="audiooutput")}searchDeviceIdByName(e){let t=null;return this.deviceInfoMap.forEach(n=>{n.device.label===e&&(t=n.device.deviceId)}),t}async getDeviceById(e){const t=(await this.enumerateDevices(!0,!0,!0)).find(n=>n.deviceId===e);if(!t)throw new re(j.DEVICE_NOT_FOUND,"deviceId: ".concat(e));return t}async init(){this.state=Vf.INITING;try{await this.updateDevicesInfo(),this.state=Vf.INITEND}catch(e){throw R.warning("Device Detection functionality cannot start properly.",e.toString()),this.state=Vf.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")||new re(j.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),e}}async updateDevicesInfo(){const e=await this.enumerateDevices(!0,!0,!0),t=Date.now(),n=[];if(e[0]&&e[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;const s=e.find(d=>d.kind==="audioinput"&&d.deviceId==="default"),c=e.find(d=>d.kind==="audiooutput"&&d.deviceId==="default");s&&c?c.groupId===s.groupId?R.debug("[device-check] default input ".concat(s.label," and output ").concat(c.label," is the same group")):R.debug("[device-check] default input ".concat(s.label," and output ").concat(c.label," is not the same group")):R.debug("[device-check] default input or output not found")}const o=this.checkMediaDeviceInfoIsOk(e);if(e.forEach(s=>{if(!s.deviceId)return;const c=this.deviceInfoMap.get("".concat(s.kind,"_").concat(s.deviceId));if((c?c.state:"INACTIVE")!=="ACTIVE"){const d={initAt:t,updateAt:t,device:s,state:"ACTIVE"};this.deviceInfoMap.set("".concat(s.kind,"_").concat(s.deviceId),d),n.push(d)}c&&(c.updateAt=t)}),this.deviceInfoMap.forEach((s,c)=>{s.state==="ACTIVE"&&s.updateAt!==t&&(s.state="INACTIVE",n.push(s))}),this.state!==Vf.INITEND)return o.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(o.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));n.forEach(s=>{switch(s.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(cd.RECORDING_DEVICE_CHANGED,s);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(cd.CAMERA_DEVICE_CHANGED,s);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(cd.PLAYOUT_DEVICE_CHANGED,s)}}),o.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),o.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(e){const t=e.filter(s=>s.kind==="audioinput"),n=e.filter(s=>s.kind==="videoinput"),o={audio:!1,video:!1};for(const s of t)if(s.label&&s.deviceId){o.audio=!0;break}for(const s of n)if(s.label&&s.deviceId){o.video=!0;break}return o}};let rC=!1;const to=new class extends pn{constructor(){super(...arguments),Z(this,"onAutoplayFailed",void 0),Z(this,"onAudioAutoplayFailed",void 0)}};function xM(){if(wt(),!rC){const e=t=>{t.preventDefault(),rC=!1,Of()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};rC=!0,Of()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),R.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),to.onAutoplayFailed?to.onAutoplayFailed():to.onAudioAutoplayFailed?R.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):R.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),to.emit("autoplay-failed")}}function LM(e,t,n,o){if(!e)return;const s=ke.getBaseInfoBySessionId(e);if(!s)return;const c=s.info,d=Date.now(),h=un(un({},c),{},{vid:c.vid===void 0?0:Number(c.vid),lts:d,elapse:d-s.startTime,cbRegistered:to.onAutoplayFailed||to.onAudioAutoplayFailed?1:-1,errorMsg:n,mediaType:t,trackId:o,extend:void 0});ke.send({type:dn.AUTOPLAY_FAILED,data:h},!0)}const $ie=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],si=new class{constructor(){Z(this,"onAutoplayFailed",void 0),Z(this,"elementMap",new Map),Z(this,"elementStateMap",new Map),Z(this,"elementsNeedToResume",[]),Z(this,"sinkIdMap",new Map),Z(this,"autoResumeAfterInterruption",e=>{Array.from(this.elementMap.entries()).forEach(t=>{let[n,o]=t;const s=this.elementStateMap.get(n),c=o.srcObject.getAudioTracks()[0],d=c&&c.readyState;if(R.debug("resume after interrupted, ele: ".concat(s," audio: ").concat(d," ").concat(e)),d==="live"){if(e)return o.pause(),void o.play();if(Vt.curState==="running")return $u()?(o.pause(),void o.play()):void(s&&s==="paused"&&o.play())}})}),Z(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(e=>{let[t,n]=e;const o=n.srcObject.getAudioTracks()[0];o&&o.readyState==="live"&&(R.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),n.pause(),n.play())})}),this.autoResumeAudioElement(),Vt.on(dr.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Vt.on(dr.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),Vt.on(dr.STATE_CHANGE,()=>{Jr()&&Vt.prevState==="suspended"&&Vt.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(e,t){const n=this.elementMap.get(e);if(this.sinkIdMap.set(e,t),n)try{await n.setSinkId(t)}catch(o){throw new re(j.PERMISSION_DENIED,"can not set sink id: "+o.toString())}}play(e,t,n,o){if(this.elementMap.has(t))return;const s=document.createElement("audio");s.autoplay=!0,s.srcObject=new MediaStream([e]),this.bindAudioElementEvents(t,s),this.elementMap.set(t,s),this.elementStateMap.set(t,Ur.INIT),this.setVolume(t,n);const c=this.sinkIdMap.get(t);if(c)try{s.setSinkId(c).catch(h=>{R.warning("[".concat(t,"] set sink id failed"),h.toString())})}catch(h){R.warning("[".concat(t,"] set sink id failed"),h.toString())}const d=s.play();d&&d.then&&d.catch(h=>{o&&LM(o,"audio",h.message,t),R.warning("audio element play warning",h.toString()),this.elementMap.has(t)&&h.name==="NotAllowedError"&&(R.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(s),bE(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),xM()}))})}updateTrack(e,t){const n=this.elementMap.get(e);n&&(n.srcObject=new MediaStream([t]))}isPlaying(e){return this.elementMap.has(e)&&this.elementStateMap.get(e)==="playing"}setVolume(e,t){const n=this.elementMap.get(e);n&&(t=Math.max(0,Math.min(100,t)),n.volume=t/100)}stop(e){const t=this.elementMap.get(e);if(this.sinkIdMap.delete(e),!t)return;const n=this.elementsNeedToResume.indexOf(t);this.elementsNeedToResume.splice(n,1),t.srcObject=null,t.remove(),this.elementMap.delete(e),this.elementStateMap.delete(e)}bindAudioElementEvents(e,t){$ie.forEach(n=>{t.addEventListener(n,o=>{const s=this.elementStateMap.get(e),c=o.type==="pause"?"paused":o.type;if(R.debug("[".concat(e,"] audio-element-status change ").concat(s," => ").concat(c)),o.type==="error"){const d=t==null?void 0:t.error;d&&R.error("[".concat(e,"] media error, code: ").concat(d.code,", message: ").concat(d.message))}this.elementStateMap.set(e,c)})})}getPlayerState(e){return this.elementStateMap.get(e)||"uninit"}autoResumeAudioElement(){const e=()=>{this.elementsNeedToResume.forEach(t=>{t.play().then(n=>{R.debug("Auto resume audio element success")}).catch(n=>{R.warning("Auto resume audio element failed!",n)})}),this.elementsNeedToResume=[]};new ye(t=>{document.body?t():window.addEventListener("load",()=>t())}).then(()=>{Of()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0))})}};function Rn(){return function(e,t,n){const o=n.value;return typeof o=="function"&&(n.value=function(){this._isClosed&&new re(j.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",R);for(var s=arguments.length,c=new Array(s),d=0;d<s;d++)c[d]=arguments[d];const h=o.apply(this,c);return h instanceof ye?new ye((p,m)=>{h.then(p).catch(m)}):h}),n}}class MM extends pn{constructor(t){super(),Z(this,"name","VideoProcessorDestination"),Z(this,"ID","0"),Z(this,"_source",void 0),Z(this,"videoContext",void 0),Z(this,"inputTrack",void 0),this.videoContext=t}get kind(){return"video"}get enabled(){return!0}pipe(){throw new re(j.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new re(j.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(t){if(t.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);t.track&&t.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=t.track,this.emit(Qr.ON_TRACK,t.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(Qr.ON_TRACK,void 0)}}class UM extends pn{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,n){super(),Z(this,"constraintsMap",new Map),Z(this,"statsRegistry",[]),Z(this,"usageRegistry",[]),Z(this,"trackId",void 0),Z(this,"direction",void 0),Z(this,"_chained",!1),this.trackId=t,this.direction=n}async getConstraints(){return await Er(this,Ji.REQUEST_CONSTRAINTS)}async requestApplyConstraints(t,n){var o;return R.info("processor ".concat(n.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(n,t),Yt(this,Ji.REQUEST_UPDATE_CONSTRAINTS,Array.from(Pi(o=this.constraintsMap).call(o)))}async requestRevertConstraints(t){var n;if(this.constraintsMap.has(t))return R.info("processor ".concat(t.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(t),Yt(this,Ji.REQUEST_UPDATE_CONSTRAINTS,Array.from(Pi(n=this.constraintsMap).call(n)))}registerStats(t,n,o){this.statsRegistry.find(s=>s.processorID===t.ID&&s.processorName===t.name&&s.type===n)||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:n,cb:o})}unregisterStats(t,n){const o=this.statsRegistry.findIndex(s=>s.processorID===t.ID&&s.processorName===t.name&&s.type===n);o!==-1&&this.statsRegistry.splice(o,1)}gatherStats(){const t=[];for(const{processorID:n,processorName:o,type:s,cb:c}of this.statsRegistry)try{const d=c();t.push({processorID:n,processorName:o,type:s,stats:d})}catch(d){R.error(new re(j.UNEXPECTED_ERROR,d.message))}return t}registerUsage(t,n){this.usageRegistry.find(o=>o.processorID===t.ID&&o.processorName===t.name)||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:n})}unregisterUsage(t){const n=this.usageRegistry.findIndex(o=>o.processorID===t.ID&&o.processorName===t.name);n!==-1&&this.usageRegistry.splice(n,1)}async gatherUsage(){const t=[];if(!this.chained)return[];for(const{cb:n}of this.usageRegistry)try{let o=n();o instanceof ye&&(o=await o),t.push(un(un({},o),{},{direction:this.direction}))}catch(o){R.error("gather extension usage error",o)}return t}getDirection(){return this.direction}}class jM extends pn{constructor(t){super(),Z(this,"name","AudioProcessorDestination"),Z(this,"ID","0"),Z(this,"inputTrack",void 0),Z(this,"inputNode",void 0),Z(this,"audioProcessorContext",void 0),Z(this,"_source",void 0),this.audioProcessorContext=t}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new re(j.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new re(j.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(Qr.ON_TRACK,void 0),this.emit(Qr.ON_NODE,void 0)}updateInput(t){if(t.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);t.track&&this.inputTrack!==t.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=t.track,this.emit(Qr.ON_TRACK,this.inputTrack)),t.node&&this.inputNode!==t.node&&(this.audioProcessorContext.chained=!0,this.inputNode=t.node,this.emit(Qr.ON_NODE,this.inputNode))}}class VM extends pn{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,n,o){super(),Z(this,"constraintsMap",new Map),Z(this,"statsRegistry",[]),Z(this,"audioContext",void 0),Z(this,"trackId",void 0),Z(this,"direction",void 0),Z(this,"usageRegistry",[]),Z(this,"_chained",!1),this.audioContext=t,this.trackId=n,this.direction=o}async getConstraints(){return Er(this,Ji.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(t,n){var o;return R.info("processor ".concat(n.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(n,t),Yt(this,Ji.REQUEST_UPDATE_CONSTRAINTS,Array.from(Pi(o=this.constraintsMap).call(o)))}async requestRevertConstraints(t){var n;if(this.constraintsMap.has(t))return this.constraintsMap.delete(t),Yt(this,Ji.REQUEST_UPDATE_CONSTRAINTS,Array.from(Pi(n=this.constraintsMap).call(n)))}registerStats(t,n,o){this.statsRegistry.find(s=>s.processorID===t.ID&&s.processorName===t.name&&s.type===n)||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:n,cb:o})}unregisterStats(t,n){const o=this.statsRegistry.findIndex(s=>s.processorID===t.ID&&s.processorName===t.name&&s.type===n);o!==-1&&this.statsRegistry.splice(o,1)}gatherStats(){const t=[];for(const{processorID:n,processorName:o,type:s,cb:c}of this.statsRegistry)try{const d=c();t.push({processorID:n,processorName:o,type:s,stats:d})}catch(d){R.error(new re(j.UNEXPECTED_ERROR,d.message))}return t}registerUsage(t,n){this.usageRegistry.find(o=>o.processorID===t.ID&&o.processorName===t.name)||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:n})}unregisterUsage(t){const n=this.usageRegistry.findIndex(o=>o.processorID===t.ID&&o.processorName===t.name);n!==-1&&this.usageRegistry.splice(n,1)}async gatherUsage(){const t=[];if(!this.chained)return[];for(const{cb:n}of this.usageRegistry)try{let o=n();o instanceof ye&&(o=await o),t.push(un(un({},o),{},{direction:this.direction}))}catch(o){R.error("gather extension usage error",o)}return t}getDirection(){return this.direction}}class iC extends pn{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),Z(this,"context",void 0),Z(this,"processSourceNode",void 0),Z(this,"outputTrack",void 0),Z(this,"processedNode",void 0),Z(this,"clonedTrack",void 0),Z(this,"outputNode",void 0),this.outputNode=new Jie}setVolume(){}createOutputTrack(){throw new re(j.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class Jie{disconnect(){}connect(){}}function FM(e){return new ye((t,n)=>{let o=!1;const s=document.createElement("video");s.setAttribute("autoplay",""),s.setAttribute("muted",""),s.muted=!0,s.autoplay=!0,s.setAttribute("playsinline",""),s.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(s);const c=Jr()?"canplay":"playing";s.addEventListener(c,()=>{const d=s.videoWidth,h=s.videoHeight;!d&&gn()||(o=!0,s.srcObject=null,s.remove(),t([d,h]))}),s.srcObject=new MediaStream([e]),s.play().catch(IE),setTimeout(()=>{o||(s.srcObject=null,s.remove(),t([s.videoWidth,s.videoHeight]))},4e3)})}function jE(e){const t={};e.facingMode&&(t.facingMode=e.facingMode),e.cameraId&&(t.deviceId={exact:e.cameraId});const n=$o(e.encoderConfig);return n.width!=null&&(t.width=n.width),n.height!=null&&(t.height=n.height),!j2()&&n.frameRate&&(t.frameRate=n.frameRate),O2()&&typeof t.frameRate=="object"&&(t.frameRate.max=60),gn()&&(t.frameRate={ideal:30,max:30}),t}function BM(e){const t={};return j2()||(e.AGC!==void 0&&(t.autoGainControl=e.AGC),e.AEC!==void 0&&(t.echoCancellation=e.AEC),e.ANS!==void 0&&(t.noiseSuppression=e.ANS,Ha()&&e.ANS&&(t.googHighpassFilter=e.ANS))),t}function WM(e){const t=BM(e);if(e.encoderConfig){const n=LE(e.encoderConfig);t.channelCount=n.stereo?2:1,t.sampleRate=n.sampleRate,t.sampleSize=n.sampleSize}return e.microphoneId&&(t.deviceId={exact:e.microphoneId}),RE()&&(t.sampleRate=void 0),t}const Qie=e=>{const t=e._encoderConfig;if(!t)return;const{frameRate:n,width:o,height:s}=e.getMediaStreamTrackSettings();let{frameRate:c=n,width:d=o,height:h=s}=t;if(!c||!d||!h)return;d=kR(d),h=kR(h),c=kR(c);const{max:p,min:m}=function(T,P,I){const A=200*Math.pow(I/15,.6)*Math.pow(T*P/640/360,.75);return{min:Math.floor(A),max:Math.floor(4*A)}}(d,h,c),{bitrateMax:g,bitrateMin:E}=t||{};g||R.debug("calculate bitrate: [w: ".concat(d,", h: ").concat(h,", fps: ").concat(c,"] => [brMax: ").concat(g,", brMin: ").concat(E,"]"));const{maxFramerate:y}=H("ENCODER_CONFIG_LIMIT");return y&&typeof y=="number"&&(c=Math.min(c,y)),{frameRate:c,bitrateMax:g||p,bitrateMin:E||m,scaleResolutionDownBy:1,scale:0}},HM=async(e,t,n)=>await(async(o,s,c)=>{const d=function(m){const g=[];for(let E=0;E<m.length;E+=2)g.push(parseInt(m.slice(E,E+2),16));return Uint8Array.from(g)}(eM(""+s+c)).slice(0,16),h=d.slice(0,12),p=await window.crypto.subtle.importKey("raw",d,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:h},p,o))})(e.buffer,t,n),oC=e=>{const t=document.createElement("canvas");return t.width=2,t.height=2,new ye((n,o)=>{t.toBlob(async s=>{if(t.remove(),s){const c=await GM(s);n({buffer:c,width:t.width,height:t.height})}else o(new re(j.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},e,1)})},GM=async e=>{const t=await e.arrayBuffer();return new Uint8Array(t)};var zM,KM,YM,qM,XM,$M,JM,QM,ZM,eU,tU,nU,rU,iU,oU,sU,aU,cU,mn,lU,dU,uU,hU,pU,fU,la,mU,gU,_U,EU,vU,yU,SU,TU,wU,RU,CU,bU,IU,yr;let Sn=(zM=He({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),KM=He({argsMap:(e,t)=>[e.getTrackId(),t]}),YM=Rn(),qM=Zu("LocalAudioTrack","_enabledMutex"),XM=He({argsMap:(e,t)=>[e.getTrackId(),t]}),$M=Rn(),JM=Zu("LocalAudioTrack","_enabledMutex"),QM=He({argsMap:(e,t)=>[e.getTrackId(),t]}),ZM=Rn(),eU=Rn(),tU=Rn(),nU=He({argsMap:e=>[e.getTrackId()]}),rU=Rn(),iU=He({argsMap:e=>[e.getTrackId()]}),oU=Rn(),sU=He({argsMap:e=>[e.getTrackId()]}),aU=He({argsMap:(e,t)=>[e.getTrackId(),t.name]}),cU=He({argsMap:e=>[e.getTrackId()]}),vt((mn=class extends ch{get _source(){return this.initWebAudio()}set _source(e){this._trackSource=e}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?si.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(e,t,n,o){super(e,n),Z(this,"trackMediaType",ah.AUDIO),Z(this,"_encoderConfig",void 0),Z(this,"_trackSource",void 0),Z(this,"metadata",[]),Z(this,"_enabled",!0),Z(this,"_volume",100),Z(this,"_useAudioElement",!0),Z(this,"_bypassWebAudio",!1),Z(this,"processor",void 0),Z(this,"_processorContext",void 0),Z(this,"_processorDestination",void 0),Z(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=t,this._getOriginVolumeLevel=!!o,this._trackSource=new iC,H("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),H("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),gr()&&!Qi?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(e){Ht(e,"volume",0,1e3),this._volume=e,this._source.setVolume(e/100),this._useAudioElement&&si.setVolume(this.getTrackId(),e);try{if(this._bypassWebAudio)return void R.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const t=this._source.createOutputTrack();this._mediaStreamTrack!==t&&(this._mediaStreamTrack=t,Yt(this,Ne.NEED_REPLACE_TRACK,this).then(()=>{R.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(n=>{R.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),n)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(e){if(!this._useAudioElement||!vM())throw new re(j.NOT_SUPPORTED,"your browser does not support setting the audio output device");await si.setSinkID(this.getTrackId(),e)}async setEnabled(e,t,n){return this._setEnabled(e,t,n)}async _setEnabled(e,t,n){if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(R.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){this._originMediaStreamTrack.enabled=!0;try{n||(this._enabled=!0),await Yt(this,Ne.NEED_ENABLE_TRACK,this),R.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(e," success"))}catch(o){throw n||(this._enabled=!1),R.error("[".concat(this.getTrackId(),"] setEnabled to true error"),o.toString()),o}}else{this._originMediaStreamTrack.enabled=!1,n||(this._enabled=!1);try{await Yt(this,Ne.NEED_DISABLE_TRACK,this)}catch(o){throw n||(this._enabled=!0),R.error("[".concat(this.getTrackId(),"] setEnabled to false error"),o.toString()),o}}}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,R.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await Yt(this,Ne.NEED_MUTE_TRACK,this):await Yt(this,Ne.NEED_UNMUTE_TRACK,this))}getStats(){return Dc(()=>{R.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),Yi(this,Ne.GET_STATS)||un({},JR)}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners($i.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners($i.ON_AUDIO_BUFFER),this._source.on($i.ON_AUDIO_BUFFER,n=>e(n))}play(){R.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(R.debug("[".concat(this.getTrackId(),"] start audio playback in element")),si.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){R.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?si.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];R.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&si.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(e,t){this._originMediaStreamTrack!==e&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),t&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:e,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Yt(this,Ne.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(e))}renewMediaStreamTrack(e){return ye.resolve(void 0)}pipe(e){if(this._bypassWebAudio)throw new re(j.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===e)return e;if(e._source)throw new re(j.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(!this.processor)return;const t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(e){e.on(Qr.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(t),await Yt(this,Ne.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Yt(this,Ne.NEED_REPLACE_TRACK,this))}),e.on(Qr.ON_NODE,t=>{this._source.processedNode=t})}unbindProcessorDestinationEvents(e){e.removeAllListeners(Qr.ON_TRACK),e.removeAllListeners(Qr.ON_NODE)}bindProcessorContextEvents(e){e.on(Ji.REQUEST_CONSTRAINTS,async t=>{t(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(e){e.removeAllListeners(Ji.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof iC&&(this._trackSource=new NM(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){const e=new VM(this._source.context,this.getTrackId(),"local"),t=new jM(e);return this._processorContext=e,this._processorDestination=t,this.bindProcessorContextEvents(e),this.bindProcessorDestinationEvents(t),this._source.on($i.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:e})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(si.stop(this.getTrackId()),this._source.play()),Yt(this,Ne.NEED_REPLACE_MIXING_TRACK,this).then(()=>{R.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(n=>{R.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),n)})),{processorContext:e,processorDestination:t}}}).prototype,"setVolume",[zM],Object.getOwnPropertyDescriptor(mn.prototype,"setVolume"),mn.prototype),vt(mn.prototype,"setPlaybackDevice",[KM,YM],Object.getOwnPropertyDescriptor(mn.prototype,"setPlaybackDevice"),mn.prototype),vt(mn.prototype,"setEnabled",[qM,XM,$M],Object.getOwnPropertyDescriptor(mn.prototype,"setEnabled"),mn.prototype),vt(mn.prototype,"setMuted",[JM,QM,ZM],Object.getOwnPropertyDescriptor(mn.prototype,"setMuted"),mn.prototype),vt(mn.prototype,"getStats",[eU],Object.getOwnPropertyDescriptor(mn.prototype,"getStats"),mn.prototype),vt(mn.prototype,"setAudioFrameCallback",[tU],Object.getOwnPropertyDescriptor(mn.prototype,"setAudioFrameCallback"),mn.prototype),vt(mn.prototype,"play",[nU,rU],Object.getOwnPropertyDescriptor(mn.prototype,"play"),mn.prototype),vt(mn.prototype,"stop",[iU,oU],Object.getOwnPropertyDescriptor(mn.prototype,"stop"),mn.prototype),vt(mn.prototype,"close",[sU],Object.getOwnPropertyDescriptor(mn.prototype,"close"),mn.prototype),vt(mn.prototype,"pipe",[aU],Object.getOwnPropertyDescriptor(mn.prototype,"pipe"),mn.prototype),vt(mn.prototype,"unpipe",[cU],Object.getOwnPropertyDescriptor(mn.prototype,"unpipe"),mn.prototype),mn),Ff=(lU=He({argsMap:(e,t)=>[e.getTrackId(),t]}),dU=Rn(),uU=Zu("MicrophoneAudioTrack","_enabledMutex"),hU=He({argsMap:(e,t,n)=>[e.getTrackId(),t,n]}),pU=Rn(),fU=He({argsMap:e=>[e.getTrackId()]}),vt((la=class extends Sn{get __className__(){return"MicrophoneAudioTrack"}constructor(e,t,n,o){super(e,t.encoderConfig?LE(t.encoderConfig):{},o,H("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),Z(this,"_config",void 0),Z(this,"_deviceName","default"),Z(this,"_constraints",void 0),Z(this,"_originalConstraints",void 0),Z(this,"_enabled",!0),this._config=t,this._constraints=n,this._originalConstraints=n,this._deviceName=e.label,typeof t.bypassWebAudio=="boolean"&&(this._bypassWebAudio=t.bypassWebAudio),($u()||CR())&&Vt.bindInterruptDetectorTrack(this)}async setDevice(e){if(R.info("[".concat(this.getTrackId(),"] start set device to ").concat(e)),this._enabled)try{const t=await eo.getDeviceById(e),n={};n.audio=un({},this._constraints),n.audio.deviceId={exact:e},this._originMediaStreamTrack.stop();let o=null;try{o=await Zi(n,this.getTrackId())}catch(s){throw R.error("[".concat(this.getTrackId(),"] setDevice failed"),s.toString()),o=await Zi({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(o.getAudioTracks()[0],!1),s}await this._updateOriginMediaStreamTrack(o.getAudioTracks()[0],!1),this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw R.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}else try{const t=await eo.getDeviceById(e);this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw R.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}R.info("[".concat(this.getTrackId(),"] set device to ").concat(e," success"))}async setEnabled(e,t,n){if(t)return R.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(e);if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(R.info("[".concat(this.getTrackId(),"] start setEnabled"),e),H("AUTO_RESET_AUDIO_ROUTE")&&(Jr()||Yo())){const d=navigator.audioSession;d&&(e||(d.type="playback"),d.type="auto")}if(!e){var o;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(o=this._source.clonedTrack)===null||o===void 0||o.stop(),n||(this._enabled=!1);try{await Yt(this,Ne.NEED_DISABLE_TRACK,this)}catch(d){throw R.error("[".concat(this.getTrackId(),"] setEnabled false failed"),d.toString()),d}return}const s=un({},this._constraints),c=eo.searchDeviceIdByName(this._deviceName);c&&!s.deviceId&&(s.deviceId=c);try{n||(this._enabled=!0);const d=await Zi({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(d.getAudioTracks()[0],!1),await Yt(this,Ne.NEED_ENABLE_TRACK,this)}catch(d){throw n||(this._enabled=!1),R.error("[".concat(this.getTrackId(),"] setEnabled true failed"),d.toString()),d}R.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),($u()||CR())&&Vt.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((Jr()||Yo())&&this._enabled&&!this._isClosed&&Vt.duringInterruption){const e=async()=>{Vt.off(dr.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(R.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};Vt.on(dr.IOS_INTERRUPTION_END,e)}else R.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(oh.TRACK_ENDED)}async renewMediaStreamTrack(e){const t=e||this._constraints,n=eo.searchDeviceIdByName(this._deviceName);if(n&&!t.deviceId&&(t.deviceId=n),this._constraints=t,this._enabled){this._originMediaStreamTrack.stop();const o=await Zi({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(o.getAudioTracks()[0],!0)}}bindProcessorContextEvents(e){super.bindProcessorContextEvents(e),e.on(Ji.REQUEST_UPDATE_CONSTRAINTS,async(t,n,o)=>{try{const s=Object.assign({},this._originalConstraints,...t);await this.renewMediaStreamTrack(s),n()}catch(s){o(s)}})}unbindProcessorContextEvents(e){super.unbindProcessorContextEvents(e),e.removeAllListeners(Ji.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[lU,dU],Object.getOwnPropertyDescriptor(la.prototype,"setDevice"),la.prototype),vt(la.prototype,"setEnabled",[uU,hU,pU],Object.getOwnPropertyDescriptor(la.prototype,"setEnabled"),la.prototype),vt(la.prototype,"close",[fU],Object.getOwnPropertyDescriptor(la.prototype,"close"),la.prototype),la),Zie=(mU=He({argsMap:(e,t)=>[e.getTrackId(),t,e.duration]}),gU=Rn(),_U=He({argsMap:e=>[e.getTrackId()]}),EU=Rn(),vU=He({argsMap:e=>[e.getTrackId()]}),yU=Rn(),SU=He({argsMap:e=>[e.getTrackId()]}),TU=Rn(),wU=He({argsMap:e=>[e.getTrackId()]}),RU=Rn(),CU=He({argsMap:e=>[e.getTrackId()]}),bU=He({argsMap:e=>[e.getTrackId()]}),IU=Rn(),vt((yr=class extends Sn{get __className__(){return"BufferSourceAudioTrack"}constructor(e,t,n,o){super(t.createOutputTrack(),n,o),Z(this,"source",void 0),Z(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=e,this._bufferSource=t,this._bufferSource.on($i.AUDIO_SOURCE_STATE_CHANGE,s=>{this.safeEmit(oh.SOURCE_STATE_CHANGE,s)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(e){e&&this._bufferSource.updateOptions(e),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(e){this._bufferSource.seekAudioBuffer(e)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(e){Ht(e,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(e)}}).prototype,"startProcessAudioBuffer",[mU,gU],Object.getOwnPropertyDescriptor(yr.prototype,"startProcessAudioBuffer"),yr.prototype),vt(yr.prototype,"pauseProcessAudioBuffer",[_U,EU],Object.getOwnPropertyDescriptor(yr.prototype,"pauseProcessAudioBuffer"),yr.prototype),vt(yr.prototype,"seekAudioBuffer",[vU,yU],Object.getOwnPropertyDescriptor(yr.prototype,"seekAudioBuffer"),yr.prototype),vt(yr.prototype,"resumeProcessAudioBuffer",[SU,TU],Object.getOwnPropertyDescriptor(yr.prototype,"resumeProcessAudioBuffer"),yr.prototype),vt(yr.prototype,"stopProcessAudioBuffer",[wU,RU],Object.getOwnPropertyDescriptor(yr.prototype,"stopProcessAudioBuffer"),yr.prototype),vt(yr.prototype,"close",[CU],Object.getOwnPropertyDescriptor(yr.prototype,"close"),yr.prototype),vt(yr.prototype,"setAudioBufferPlaybackSpeed",[bU,IU],Object.getOwnPropertyDescriptor(yr.prototype,"setAudioBufferPlaybackSpeed"),yr.prototype),yr);class Bn extends Sn{get __className__(){return"MixingAudioTrack"}get isActive(){for(const t of this.trackList)if(t._enabled&&!t._isClosed&&!t.muted)return!0;return!1}constructor(){const t=lh().createMediaStreamDestination();super(t.stream.getAudioTracks()[0],void 0,Jt(8,"track-mix-")),Z(this,"trackList",void 0),Z(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=t,this.trackList=[]}hasAudioTrack(t){return this.trackList.indexOf(t)!==-1}addAudioTrack(t){this.trackList.indexOf(t)===-1?(R.debug("add ".concat(t.getTrackId()," to mixing track")),t._source.outputNode.connect(this.destNode),this.trackList.push(t),this.updateEncoderConfig()):R.debug("track ".concat(t.getTrackId()," is already added"))}removeAudioTrack(t){if(this.trackList.indexOf(t)!==-1){R.debug("remove ".concat(t.getTrackId()," from mixing track"));try{t._source.outputNode.disconnect(this.destNode)}catch{}CE(this.trackList,t),this.updateEncoderConfig()}}updateEncoderConfig(){const t={};this.trackList.forEach(n=>{n._encoderConfig&&((n._encoderConfig.bitrate||0)>(t.bitrate||0)&&(t.bitrate=n._encoderConfig.bitrate),(n._encoderConfig.sampleRate||0)>(t.sampleRate||0)&&(t.sampleRate=n._encoderConfig.sampleRate),(n._encoderConfig.sampleSize||0)>(t.sampleSize||0)&&(t.sampleSize=n._encoderConfig.sampleSize),n._encoderConfig.stereo&&(t.stereo=!0))}),this._encoderConfig=t}_updateRtpTransceiver(t){this._rtpTransceiver!==t&&(this._rtpTransceiver=t,this.trackList.forEach(n=>{n instanceof Bn?n.emit(ad.TRANSCEIVER_UPDATED,t):n._updateRtpTransceiver(t)}))}}class eoe extends AM{set currentState(t){t!==this._currentState&&(this._currentState=t,this.safeEmit($i.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),Z(this,"audioBuffer",void 0),Z(this,"sourceNode",void 0),Z(this,"startPlayTime",0),Z(this,"startPlayOffset",0),Z(this,"pausePlayTime",0),Z(this,"options",void 0),Z(this,"currentLoopCount",0),Z(this,"currentPlaybackSpeed",100),Z(this,"_currentState","stopped"),this.audioBuffer=t,this.options=n,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(t){this.currentState==="stopped"?(this.options=t,this.startPlayOffset=this.options.startPlayTime||0):R.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(t){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=t,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=t))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(t){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=t/100),this.currentPlaybackSpeed=t}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const t=this.context.createBufferSource();return t.buffer=this.audioBuffer,t.loop=!!this.options.loop,t.connect(this.outputNode),t.playbackRate.value=this.currentPlaybackSpeed/100,t}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const AU=new Map;function NU(e,t){if(e.length===0||t.length===0)return 1/0;const n=xR(e),o=xR(t);return Math.floor(o/n)}class sC{get rendFrameRate(){const t=Math.max(1,NU(this._render_interframe_delays_sizes,this._render_interframe_delays));return Math.floor(1e3/t)}get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(t){t!==this._videoElementStatus&&(R.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(t)),this._videoElementStatus=t)}get videoState(){return this._videoState}set videoState(t){var n;t!==this._videoState&&(this._videoState=t,(n=this.onVideoStateChanged)===null||n===void 0||n.call(this,this.videoState))}constructor(t){Z(this,"trackId",void 0),Z(this,"config",void 0),Z(this,"onFirstVideoFrameDecoded",void 0),Z(this,"onVideoStateChanged",void 0),Z(this,"freezeTimeCounterList",[]),Z(this,"renderFreezeAccTime",0),Z(this,"renderFreezeAccTime2",0),Z(this,"isKeepLastFrame",!1),Z(this,"timeUpdatedCount",0),Z(this,"freezeTime",0),Z(this,"playbackTime",0),Z(this,"lastTimeUpdatedTime",0),Z(this,"autoplayFailed",!1),Z(this,"videoTrack",void 0),Z(this,"videoElement",void 0),Z(this,"cacheVideoElement",void 0),Z(this,"_render_interframe_delays",[]),Z(this,"_render_interframe_delays_sizes",[]),Z(this,"_videoState",ca.VideoStateStopped),Z(this,"videoElementCheckInterval",void 0),Z(this,"videoElementFreezeTimeout",void 0),Z(this,"_videoElementStatus",Ur.NONE),Z(this,"isGettingVideoDimensions",!1),Z(this,"startGetVideoDimensions",()=>{const n=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return R.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(n,500)};!this.isGettingVideoDimensions&&n()}),Z(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&Vt.curState==="running"&&(R.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(N2())),M2()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),Z(this,"handleVideoEvents",n=>{switch(n.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=Ur.PLAYING;break;case"loadeddata":if(this.videoState=ca.VideoStateStarting,this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=Ur.CANPLAY;break;case"stalled":this.videoElementStatus=Ur.STALLED;break;case"suspend":this.videoElementStatus=Ur.SUSPEND;break;case"pause":this.videoElementStatus=Ur.PAUSED,Jr()||Yo()||gr()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(R.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=Ur.WAITING;break;case"abort":this.videoElementStatus=Ur.ABORT;break;case"ended":this.videoElementStatus=Ur.ENDED;break;case"emptied":this.videoElementStatus=Ur.EMPTIED;break;case"error":{const o=this.videoElement.error;o&&(this.videoElementStatus=Ur.ERROR,R.error("[".concat(this.trackId,"] media error: ").concat(o.message," (").concat(o.code,")")));break}case"timeupdate":{const o=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=o);const s=o-this.lastTimeUpdatedTime,c=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=o,da.lastVisibleTime<da.lastHiddenTime||c<da.lastHiddenTime||c<da.lastVisibleTime)return;for(s>H("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=s),this.playbackTime+=s;this.playbackTime>=6e3;){this.playbackTime-=6e3;const d=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(d),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),Z(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(R.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(N2())),M2()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=t.trackId,this.config=t,t.element instanceof HTMLVideoElement?this.videoElement=t.element:this.videoElement=document.createElement("video"),Vt.on(dr.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Vt.on(dr.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var t;return(t=this.videoElement.parentElement)!==null&&t!==void 0?t:void 0}updateConfig(t){this.config=t,this.trackId=t.trackId,t.element!==this.videoElement&&(this.destroy(),this.videoElement=t.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.initVideoElement())}play(t){const n=this.videoElement.play();n&&n.catch&&n.catch(s=>{t&&LM(t,"video",s.message,this.trackId),s.name==="NotAllowedError"?(R.warning("detected video element autoplay failed",s),this.autoplayFailed=!0,this.handleAutoPlayFailed()):R.warning("[".concat(this.trackId,"] play warning: "),s)});const o=wt();if((o.name==="Safari"&&Number(o.version)===15||$u())&&n&&n.then){const s=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};n.then(s).catch(s)}}getCurrentFrame(){const t=document.createElement("canvas");t.width=this.videoElement.videoWidth,t.height=this.videoElement.videoHeight;const n=t.getContext("2d");if(!n)return R.error("create canvas context failed!"),new ImageData(2,2);n.drawImage(this.videoElement,0,0,t.width,t.height);const o=n.getImageData(0,0,t.width,t.height);return t.remove(),o}async getCurrentFrameToUint8Array(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const o=document.createElement("canvas");o.width=this.videoElement.videoWidth,o.height=this.videoElement.videoHeight;const s=o.getContext("2d");return s?(s.drawImage(this.videoElement,0,0,o.width,o.height),new ye((c,d)=>{o.toBlob(async h=>{if(o.remove(),h){const p=await GM(h);c({buffer:p,width:o.width,height:o.height})}else d(new re(j.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},t,n<0?.1:n>1?1:n)})):await oC(t)}destroy(){Vt.off(dr.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Vt.off(dr.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=ca.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=Ur.INIT,!this.videoElementCheckInterval&&(OU.forEach(c=>{this.videoElement.addEventListener(c,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{(function(c){return c!==document.body&&document.body.contains(c)})(this.videoElement)||(this.videoElementStatus=Ur.DESTROYED)},1e3),H("ENABLE_VIDEO_FRAME_CALLBACK"))){var t,n;let c;const d=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",d),this.videoElementFreezeTimeout=window.setTimeout(h,H("VIDEO_FREEZE_DURATION")))},h=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===ca.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=ca.VideoStateFrozen:document.addEventListener("visibilitychange",d))},p=(m,g)=>{if(this.videoElementStatus===Ur.PLAYING){if(c){const T=g.presentationTime-c.presentationTime,P=g.presentedFrames-c.presentedFrames;this._render_interframe_delays_sizes.push(P),this._render_interframe_delays.push(T);const I=xR(this._render_interframe_delays_sizes),A=I-this._render_interframe_delays_sizes[0];if(I>30&&A>5&&(this._render_interframe_delays_sizes.shift(),this._render_interframe_delays.shift()),this.videoState===ca.VideoStateStarting&&(this.videoState=ca.VideoStateDecoding),this.videoState===ca.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(h,H("VIDEO_FREEZE_DURATION"))),T<H("VIDEO_FREEZE_DURATION")&&this.videoState===ca.VideoStateFrozen&&(this.videoState=ca.VideoStateDecoding),T>H("VIDEO_FREEZE_DURATION")&&da.lastVisibleTime>=da.lastHiddenTime&&c.timestamp>da.lastVisibleTime&&c.timestamp>da.lastHiddenTime){const M=Math.min(66,NU(this._render_interframe_delays_sizes,this._render_interframe_delays)),U=Math.max(0,T-(P-1)*M);this.renderFreezeAccTime2+=U>M?U:0,this.renderFreezeAccTime+=T}}c=un(un({},g),{},{timestamp:m})}var E,y;H("ENABLE_VIDEO_FRAME_CALLBACK")&&((E=(y=this.videoElement).requestVideoFrameCallback)===null||E===void 0||E.call(y,p))};(t=(n=this.videoElement).requestVideoFrameCallback)===null||t===void 0||t.call(n,p)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),RE()&&!H("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");const o=wt();o.name==="Safari"&&Number(o.version)===15||$u()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,gn()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,gn()&&this.videoElement.load());const s=this.videoElement.play();s!==void 0&&s.catch(c=>{R.debug("[".concat(this.trackId,"] playback interrupted"),c.toString())})}resetVideoElement(){OU.forEach(t=>{this.videoElement&&this.videoElement.removeEventListener(t,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=Ur.NONE}handleAutoPlayFailed(){const t=n=>{n.preventDefault(),this.videoElement.play().then(()=>{R.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(o=>{R.error(o)}),this.autoplayFailed=!1,Of()?document.body.removeEventListener("click",t,!0):(document.body.removeEventListener("touchstart",t,!0),document.body.removeEventListener("mousedown",t,!0))};Of()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0)),xM()}}const OU=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class PU extends sC{constructor(t){super(t),Z(this,"container",void 0),Z(this,"slot",void 0),this.slot=t.element,this.updateConfig(t)}updateConfig(t){this.config=t,this.trackId=t.trackId;const n=t.element;n!==this.slot&&(this.destroy(),this.slot=n),this.createElements()}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.createElements())}play(t){var n;(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)&&super.play(t)}getCurrentFrame(){var t;return(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(t){var n;let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(t,o):await oC(t)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch{}this.container=void 0}}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",H("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),this.slot.appendChild(this.container)}mountedVideoElement(){var t;!this.container||(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var t;if((t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var t;(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var DU,kU,xU,LU,MU,UU,jU,VU,FU,BU,WU,HU,GU,zU,KU,YU,qU,XU,$U,JU,QU,ZU,ej,tj,nj,rj,gt,ij,oj,sj,aj,cj,lj,dj,uj,no;let nn=(DU=He({argsMap:(e,t,n)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),kU=Rn(),xU=He({argsMap:e=>[e.getTrackId()]}),LU=Zu("LocalVideoTrack","_enabledMutex"),MU=He({argsMap:(e,t)=>[e.getTrackId(),t]}),UU=Rn(),jU=Zu("LocalVideoTrack","_enabledMutex"),VU=He({argsMap:(e,t)=>[e.getTrackId(),t]}),FU=Rn(),BU=He({argsMap:(e,t)=>[e.getTrackId(),t,e._saveEncodeBitrateRatio]}),WU=Rn(),HU=He({argsMap:(e,t)=>[e.getTrackId(),t]}),GU=Rn(),zU=Rn(),KU=He({argsMap:(e,t,n)=>[e.getTrackId(),t,n]}),YU=Rn(),qU=Rn(),XU=Rn(),$U=Rn(),JU=Rn(),QU=Rn(),ZU=Rn(),ej=He({argsMap:(e,t)=>[e.getTrackId(),t.name]}),tj=He({argsMap:e=>[e.getTrackId()]}),nj=He({argsMap:e=>[e.getTrackId()]}),rj=He({argsMap:(e,t,n)=>[e.getTrackId(),t.label,n]}),gt=class ez extends ch{get videoHeight(){if(gr()){const{height:t}=this._mediaStreamTrack.getSettings();return this._videoHeight=t,this._videoHeight}return this._videoHeight}get videoWidth(){if(gr()){const{width:t}=this._mediaStreamTrack.getSettings();return this._videoWidth=t,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Ur.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(t){this._processorContext=t}get __className__(){return"LocalVideoTrack"}constructor(t,n,o,s,c,d){if(super(t,c),Z(this,"trackMediaType",ah.VIDEO),Z(this,"_player",void 0),Z(this,"isUseScaleResolutionDownBy",!1),Z(this,"_videoVisibleTimer",null),Z(this,"_previousVideoVisibleStatus",void 0),Z(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),Z(this,"_encoderConfig",void 0),Z(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),Z(this,"_optimizationMode",void 0),Z(this,"_saveEncodeBitrateRatio",1),Z(this,"_videoHeight",void 0),Z(this,"_videoWidth",void 0),Z(this,"_forceBitrateLimit",void 0),Z(this,"_enabled",!0),Z(this,"_processorDestination",void 0),Z(this,"_processorContext",void 0),gr()){const{width:h,height:p}=t.getSettings();this._videoWidth=h,this._videoHeight=p}else this.updateMediaStreamTrackResolution();if(this._scalabilityMode=o,this._optimizationMode=s,this._hints=d||[],n&&this._hints.indexOf(Gt.CUSTOM_TRACK)!==-1?this._encoderConfig=fn(n):this._encoderConfig=n,this._hints.indexOf(Gt.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(TR(Ot.CHROME,115)&&TE().indexOf("Windows")!==-1){const h=function(p,m){if("VideoFrame"in window&&"TransformStream"in window&&Rt().supportWebRTCInsertableStream){const g=new MediaStreamTrackProcessor(p),E=new MediaStreamTrackGenerator({kind:"video"});let y,T,P=Date.now();const I=()=>{A&&(clearInterval(A),A=void 0),y&&(y.close(),y=void 0),p.stop(),T=void 0,E.removeEventListener("ended",I)};let A=window.setInterval(()=>{if(T&&y&&Date.now()-P>1e3)try{E.readyState==="live"?T.enqueue(y.clone()):I()}catch{I()}},1e3);const M=new TransformStream({transform:(U,Y)=>{E.readyState==="live"?(T=Y,P=Date.now(),y===void 0?(y=U,Y.enqueue(U.clone())):(Y.enqueue(y),y=U)):U.close()}});return E.addEventListener("ended",I),g.readable.pipeThrough(M).pipeTo(E.writable),E}}(t);h&&(R.info("local screen video track begin to inject frame"),this._mediaStreamTrack=h)}n&&this._hints.indexOf(Gt.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(n),this._processorContext=new UM(this.getTrackId(),"local"),this._processorDestination=new MM(this.processorContext),this.bindProcessorDestinationEvents()}play(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof t=="string"){const s=document.getElementById(t);s?t=s:(R.warning("[".concat(this.getTrackId(),'] can not find "#').concat(t,'" element, use document.body')),t=document.body)}R.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(n));const o=un(un(un({},this._getDefaultPlayerConfig()),n),{},{trackId:this.getTrackId(),element:t});this._player?this._player.updateConfig(o):(t instanceof HTMLVideoElement?this._player=new sC(o):this._player=new PU(o),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const s=this.getVideoElementVisibleStatus();this.safeEmit(oh.VIDEO_ELEMENT_VISIBLE_STATUS,s)}catch{}},H("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,R.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(t,n){if(!n){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(R.info("[".concat(this.getTrackId(),"] start setEnabled"),t),!t){this._originMediaStreamTrack.enabled=!1;try{await Yt(this,Ne.NEED_DISABLE_TRACK,this)}catch(o){throw R.error("[".concat(this.getTrackId(),"] setEnabled to false error"),o.toString()),o}return n||(this._enabled=!1),void R.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await Yt(this,Ne.NEED_ENABLE_TRACK,this)}catch(o){throw R.error("[".concat(this.getTrackId(),"] setEnabled to true error"),o.toString()),o}R.info("[".concat(this.getTrackId(),"] setEnabled to true success")),n||(this._enabled=!0)}async setMuted(t){t!==this._muted&&(this.stateCheck("muted",t),this._muted=t,this._originMediaStreamTrack.enabled=!t,R.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(t)),t?await Yt(this,Ne.NEED_MUTE_TRACK,this):await Yt(this,Ne.NEED_UNMUTE_TRACK,this))}async setSaveEncodeBitrateRatio(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this._saveEncodeBitrateRatio;if(this._saveEncodeBitrateRatio!==1&&this._encoderConfig&&this._encoderConfig.bitrateMax&&this._encoderConfig.bitrateMin){this._encoderConfig.bitrateMin=Math.floor(this._encoderConfig.bitrateMin*t),this._encoderConfig.bitrateMax=Math.floor(this._encoderConfig.bitrateMax*t),R.debug("[".concat(this.getTrackId(),"] set save encode bitrate ratio, ").concat(t)),this._saveEncodeBitrateRatio=1;try{await Yt(this,Ne.NEED_UPDATE_VIDEO_ENCODER,this)}catch(n){return n.throw(R)}}}async setEncoderConfiguration(t,n){if(!this._enabled)throw new re(j.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(t=$o(t),H("USE_STANDARD_BITRATE_DEFAULT")&&(delete t.bitrateMax,delete t.bitrateMin),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),t.width||t.height||t.frameRate){const o=jE({encoderConfig:t});(gr()||Jr()||Yo())&&(o.deviceId=void 0),R.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(o));try{await this._originMediaStreamTrack.applyConstraints(o),this.updateMediaStreamTrackResolution()}catch(s){const c=new re(j.UNEXPECTED_ERROR,s.toString());throw R.error("[".concat(this.getTrackId(),"] applyConstraints error"),c.toString()),c}}this._encoderConfig=t,this._hints.indexOf(Gt.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await Yt(this,Ne.NEED_UPDATE_VIDEO_ENCODER,this)}catch(o){return o.throw(R)}}getStats(){return Dc(()=>{R.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),Yi(this,Ne.GET_STATS)||un({},QR)}async setBeautyEffect(t){R.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(t,n):await oC(t)}async setBitrateLimit(t){R.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(t))),t&&(this._forceBitrateLimit=t,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<t.max_bitrate?this._encoderConfig.bitrateMax:t.max_bitrate:this._encoderConfig.bitrateMax=t.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=t.min_bitrate))}async setOptimizationMode(t){if(t!=="motion"&&t!=="detail"&&t!=="balanced")return void R.error(j.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const n=this._optimizationMode;try{this._optimizationMode=t,await Yt(this,Ne.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(o){throw this._optimizationMode=n,R.error("[".concat(this.getTrackId(),"] set optimization mode failed"),o.toString()),o}R.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(t,")"))}setScalabiltyMode(t){if(t.numSpatialLayers===1&&t.numTemporalLayers!==1)return R.error(j.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=t,R.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(t,")"))}updateMediaStreamTrackResolution(){FM(this._originMediaStreamTrack).then(t=>{let[n,o]=t;this._videoHeight=o,this._videoWidth=n}).catch(IE)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(t){if(!this._enabled)throw new re(j.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");R.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(t)),t=$o(t),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),this._encoderConfig=t,this._hints.indexOf(Gt.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await Yt(this,Ne.NEED_UPDATE_VIDEO_ENCODER,this)}catch(n){return n.throw(R)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:t,height:n,frameRate:o}=this.getMediaStreamTrackSettings();if(!t||!n||!o)return;const{bitrateMax:s,bitrateMin:c}=this._encoderConfig;if(c==null||s==null){const{max:d,min:h}=function(p,m,g,E,y){const T=H("BITRATE_ADAPTER_TYPE");if(T==="DEFAULT_BITRATE")return{min:E,max:y};if(y===void 0){const P=Math.floor(200*Math.pow(g/15,.6)*Math.pow(p*m/640/360,.75));y=T==="STANDARD_BITRATE"?4*P:2*P,E=E??P}else E=E??Math.floor(y/10);return{min:E,max:y}}(t,n,o,c,s);if(this._encoderConfig.bitrateMin=h,this._encoderConfig.bitrateMax=d,H("VIDEO_STANDARD_BITRATE_VERSION")&&c==null&&s==null){const[p,m]=function(g,E,y){const T=4*Math.floor(2e5*Math.pow(y/15,.6)*Math.pow(g*E/230400,.75)),P=g*E,I=new Map([[19200,.9],[230400,.85],[518400,.75],[921600,.7],[2073600,.6],[3686400,.5]]),A=new Map([[230400,.95],[518400,.9],[921600,.85],[2073600,.8]]);let M=Pi(I).call(I).next().value,U=1;if(I.has(P))M=I.get(P);else{var Y;const we=ql(Y=Array.from(I.entries())).call(Y,(rt,qe)=>{let[tn]=rt,[zt]=qe;return tn-zt}),ut=we.find(rt=>{let[qe]=rt;return qe>P});if(ut){const rt=we.indexOf(ut);if(rt>0){const qe=we[rt-1],tn=(P-qe[0])/(ut[0]-qe[0]);M=qe[1]+tn*(ut[1]-qe[1])}else M=ut[1]}else M=we[we.length-1][1]}if(A.has(P))U=A.get(P);else{var Q;const we=ql(Q=Array.from(A.entries())).call(Q,(rt,qe)=>{let[tn]=rt,[zt]=qe;return tn-zt}),ut=we.find(rt=>{let[qe]=rt;return qe>P});if(ut){const rt=we.indexOf(ut);if(rt>0){const qe=we[rt-1],tn=(P-qe[0])/(ut[0]-qe[0]);U=qe[1]+tn*(ut[1]-qe[1])}else U=ut[1]}else U=we[we.length-1][1]}const J=H("VIDEO_NEW_BITRATE_RATIO");J&&J>0&&(M=J/100);const X=Math.floor(T*M),ne=Math.floor(65e4*Math.pow(g*E/230400,.5)*Math.pow(y/15,.69));let oe=X;const me=H("VIDEO_STANDARD_BITRATE_VERSION");return me&&me>0&&(me===1?oe=T:me===2?oe=X:me===3&&(oe=ne)),[Math.floor(oe/1e3),U]}(t,n,o);this._encoderConfig.bitrateMax=p,this._encoderConfig.bitrateMin=h?Math.min(h,p):p,this._saveEncodeBitrateRatio=m,R.debug("[".concat(this.getTrackId(),"] update new bitrate from profile, [w: ").concat(t,", h: ").concat(n,", fps: ").concat(o,"] => [brMax: ").concat(this._encoderConfig.bitrateMax,", brMin: ").concat(this._encoderConfig.bitrateMin,", save_bitrate_ratio: ").concat(this._saveEncodeBitrateRatio,"]"))}else R.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(t,", h: ").concat(n,", fps: ").concat(o,"] => [brMax: ").concat(d,", brMin: ").concat(h,"]")),this._saveEncodeBitrateRatio=1}}getVideoElementVisibleStatus(){try{var t,n;const o=this==null||(t=this._player)===null||t===void 0?void 0:t.getContainerElement(),s={track:this,element:this==null||(n=this._player)===null||n===void 0?void 0:n.getVideoElement(),slot:o==null?void 0:o.parentElement},{element:c,slot:d}=s;if(this.isPlaying&&c instanceof HTMLVideoElement&&d instanceof HTMLElement){const h=B2.checkOneElementVisible(c),p=Object.assign({},h);if(p.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=p.visible;const m=ke.reportApiInvoke(null,{tag:En.TRACER,name:Nn.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});p.visible?m.onSuccess("Video is visible"):m.onSuccess("Invisible because of ".concat(p.reason))}return p}return}catch(o){throw new re(j.GET_VIDEO_ELEMENT_VISIBLE_ERROR,o.message)}}async renewMediaStreamTrack(t){}pipe(t){if(this.processor===t)return t;if(t._source)throw new re(j.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),t}unpipe(){if(!this.processor)return;const t=this.processor;this.processor._source=void 0,this.processor=void 0,t.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(t){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],o=this._encoderConfig;t&&(o=un(un({},o),$o(t))),o=rd(o);const s=Jt(8,"track-video-cloned-"),c=new ez(n?this._mediaStreamTrack.clone():this._mediaStreamTrack,o,rd(this._scalabilityMode),this._optimizationMode,s,rd(this._hints));return t&&o&&c.setEncoderConfiguration(o),R.debug("clone video track from ".concat(this.getTrackId()," to ").concat(s,", clone ").concat(n)),c}async replaceTrack(t,n){if(!(t instanceof MediaStreamTrack))throw new re(j.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(t.kind!=="video")throw new re(j.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(t,n,!0),this.updateMediaStreamTrackResolution()}sendSeiData(t){if(Dc(()=>{ke.reportApiInvoke(null,{name:Nn.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:En.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!H("ENABLE_VIDEO_SEI")||!H("ENABLE_ENCODED_TRANSFORM"))return void R.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(t instanceof Uint8Array==0)return new re(j.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();const n=this.getRTCRtpTransceiver();if(!n)return void R.warning("Video track is not published, SEI can not be send");const o=n.sender.getParameters();if(o.codecs.length===0)return;const s=o.codecs[0].mimeType.toLocaleLowerCase();s==="video/h264"?this.safeEmit("sei-to-send",t):R.warning("SEI is not supported by ".concat(s))}bindProcessorDestinationEvents(){this.processorDestination.on(Qr.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(),await Yt(this,Ne.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Yt(this,Ne.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Qr.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(Ji.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(Ji.REQUEST_CONSTRAINTS)}},vt(gt.prototype,"play",[DU,kU],Object.getOwnPropertyDescriptor(gt.prototype,"play"),gt.prototype),vt(gt.prototype,"stop",[xU],Object.getOwnPropertyDescriptor(gt.prototype,"stop"),gt.prototype),vt(gt.prototype,"setEnabled",[LU,MU,UU],Object.getOwnPropertyDescriptor(gt.prototype,"setEnabled"),gt.prototype),vt(gt.prototype,"setMuted",[jU,VU,FU],Object.getOwnPropertyDescriptor(gt.prototype,"setMuted"),gt.prototype),vt(gt.prototype,"setSaveEncodeBitrateRatio",[BU,WU],Object.getOwnPropertyDescriptor(gt.prototype,"setSaveEncodeBitrateRatio"),gt.prototype),vt(gt.prototype,"setEncoderConfiguration",[HU,GU],Object.getOwnPropertyDescriptor(gt.prototype,"setEncoderConfiguration"),gt.prototype),vt(gt.prototype,"getStats",[zU],Object.getOwnPropertyDescriptor(gt.prototype,"getStats"),gt.prototype),vt(gt.prototype,"setBeautyEffect",[KU,YU],Object.getOwnPropertyDescriptor(gt.prototype,"setBeautyEffect"),gt.prototype),vt(gt.prototype,"getCurrentFrameData",[qU],Object.getOwnPropertyDescriptor(gt.prototype,"getCurrentFrameData"),gt.prototype),vt(gt.prototype,"getCurrentFrameImage",[XU],Object.getOwnPropertyDescriptor(gt.prototype,"getCurrentFrameImage"),gt.prototype),vt(gt.prototype,"setBitrateLimit",[$U],Object.getOwnPropertyDescriptor(gt.prototype,"setBitrateLimit"),gt.prototype),vt(gt.prototype,"setOptimizationMode",[JU],Object.getOwnPropertyDescriptor(gt.prototype,"setOptimizationMode"),gt.prototype),vt(gt.prototype,"setScalabiltyMode",[QU],Object.getOwnPropertyDescriptor(gt.prototype,"setScalabiltyMode"),gt.prototype),vt(gt.prototype,"updateMediaStreamTrackResolution",[ZU],Object.getOwnPropertyDescriptor(gt.prototype,"updateMediaStreamTrackResolution"),gt.prototype),vt(gt.prototype,"pipe",[ej],Object.getOwnPropertyDescriptor(gt.prototype,"pipe"),gt.prototype),vt(gt.prototype,"unpipe",[tj],Object.getOwnPropertyDescriptor(gt.prototype,"unpipe"),gt.prototype),vt(gt.prototype,"close",[nj],Object.getOwnPropertyDescriptor(gt.prototype,"close"),gt.prototype),vt(gt.prototype,"replaceTrack",[rj],Object.getOwnPropertyDescriptor(gt.prototype,"replaceTrack"),gt.prototype),gt),aC=(ij=He({argsMap:(e,t)=>[e.getTrackId(),t]}),oj=Rn(),sj=Zu("CameraVideoTrack","_enabledMutex"),aj=He({argsMap:(e,t)=>[e.getTrackId(),t]}),cj=Rn(),lj=He({argsMap:(e,t)=>[e.getTrackId(),t]}),dj=Rn(),uj=He({argsMap:e=>[e.getTrackId()]}),no=class tz extends nn{get __className__(){return"CameraVideoTrack"}constructor(t,n,o,s,c,d){super(t,$o(n.encoderConfig),s,c,d),Z(this,"_config",void 0),Z(this,"_originalConstraints",void 0),Z(this,"_constraints",void 0),Z(this,"_enabled",!0),Z(this,"_deviceName","default"),Z(this,"tryResumeVideoForIOS15_16WeChat",async()=>{($u()||CR())&&!function(){const h=wt();if(h.os!==Xn.IOS||!h.osVersion)return!1;const p=h.osVersion.split(".");return Number(p[0])===15&&Number(p[1])>=2}()&&U2()&&this._enabled&&!this._isClosed&&(R.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=n,this._originalConstraints=o,this._constraints=o,this._deviceName=t.label,this._encoderConfig=$o(this._config.encoderConfig),Vt.on(dr.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Vt.on(dr.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(t){return typeof t=="string"?this._setDeviceById(t):t.deviceId?this._setDeviceById(t.deviceId):t.facingMode?this._setDeviceByFacingModel(t.facingMode):void 0}async _setDeviceById(t){if(R.info("[".concat(this.getTrackId(),"] set device to ").concat(t)),this._enabled)try{const n=await eo.getDeviceById(t),o={};o.video=un({},this._constraints),o.video.deviceId={exact:t},o.video.facingMode=void 0,this._originMediaStreamTrack.stop();let s=null;try{s=await Zi(o,this.getTrackId())}catch(c){throw R.error("[".concat(this.getTrackId(),"] setDevice failed"),c.toString()),s=await Zi({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(s.getVideoTracks()[0],!1),c}await this._updateOriginMediaStreamTrack(s.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=n.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(n){throw R.error("[".concat(this.getTrackId(),"] setDevice error"),n.toString()),n}else try{const n=await eo.getDeviceById(t);this._deviceName=n.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(n){throw R.error("[".concat(this.getTrackId(),"] setDevice error"),n.toString()),n}R.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(t){R.info("[".concat(this.getTrackId(),"] set facingMode ").concat(t));const n={video:un(un({},this._constraints),{},{deviceId:void 0,facingMode:{exact:t}})};if(this._enabled){this._originMediaStreamTrack.stop();let o=null;try{o=await Zi(n,this.getTrackId())}catch(s){throw R.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),s.toString()),o=await Zi({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!1),s}await this._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=t,this._config.cameraId=void 0,this._constraints=un({},n.video),R.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(t,n){if(!n){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(R.info("[".concat(this.getTrackId(),"] start setEnabled"),t),t){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const o=await Zi({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!1)}await Yt(this,Ne.NEED_ENABLE_TRACK,this)}catch(o){throw R.error("[".concat(this.getTrackId(),"] setEnabled true error"),o.toString()),o}this.updateMediaStreamTrackResolution(),R.info("[".concat(this.getTrackId(),"] setEnabled to true success")),n||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),n||(this._enabled=!1);try{await Yt(this,Ne.NEED_DISABLE_TRACK,this)}catch(o){throw R.error("[".concat(this.getTrackId(),"] setEnabled to false error"),o.toString()),o}R.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(t,n){if(!this._enabled)throw new re(j.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");t=$o(t),H("USE_STANDARD_BITRATE_DEFAULT")&&(delete t.bitrateMax,delete t.bitrateMin),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate||t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate||t.bitrateMin);const o=fn(this._config);o.encoderConfig=t;const s=jE(o);(gr()||Jr()||Yo())&&(s.deviceId=void 0),R.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(s));try{await this._originMediaStreamTrack.applyConstraints(s),this.updateMediaStreamTrackResolution()}catch(c){const d=new re(j.UNEXPECTED_ERROR,c.toString());throw R.error("[".concat(this.getTrackId(),"] applyConstraints error"),d.toString()),d}this._config=o,this._constraints=s,this._originalConstraints=s,this._encoderConfig=t,this._hints.indexOf(Gt.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await Yt(this,Ne.NEED_UPDATE_VIDEO_ENCODER,this)}catch(c){return c.throw(R)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((Jr()||Yo())&&this._enabled&&!this._isClosed&&Vt.duringInterruption){const t=async()=>{Vt.off(dr.IOS_INTERRUPTION_END,t),this._enabled&&!this._isClosed&&(R.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};Vt.on(dr.IOS_INTERRUPTION_END,t)}else R.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(oh.TRACK_ENDED)}async renewMediaStreamTrack(t){const n=t||this._constraints,o=eo.searchDeviceIdByName(this._deviceName);if(o&&!n.deviceId&&(n.deviceId={exact:o}),this._enabled){const s=await Zi({video:n},this.getTrackId());this._constraints=n,await this._updateOriginMediaStreamTrack(s.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),Vt.off(dr.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Vt.off(dr.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(t){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],o=this._encoderConfig;t&&(o=un(un({},o),$o(t))),o=rd(o);const s=Jt(8,"track-cam-cloned-"),c=new tz(n?this._mediaStreamTrack.clone():this._mediaStreamTrack,rd(un(un({},this._config),{},{encoderConfig:o})),rd(this._constraints),rd(this._scalabilityMode),this._optimizationMode,s);return t&&o&&c.setEncoderConfiguration(o),R.debug("clone track from ".concat(this.getTrackId()," to ").concat(s,", clone ").concat(n)),c}bindProcessorContextEvents(){this.processorContext.on(Ji.REQUEST_UPDATE_CONSTRAINTS,async(t,n,o)=>{try{const s=Object.assign({},this._originalConstraints,...t);await this.renewMediaStreamTrack(s),n()}catch(s){o(s)}}),this.processorContext.on(Ji.REQUEST_CONSTRAINTS,async t=>{t(this._originMediaStreamTrack.getSettings())})}},vt(no.prototype,"setDevice",[ij,oj],Object.getOwnPropertyDescriptor(no.prototype,"setDevice"),no.prototype),vt(no.prototype,"setEnabled",[sj,aj,cj],Object.getOwnPropertyDescriptor(no.prototype,"setEnabled"),no.prototype),vt(no.prototype,"setEncoderConfiguration",[lj,dj],Object.getOwnPropertyDescriptor(no.prototype,"setEncoderConfiguration"),no.prototype),vt(no.prototype,"close",[uj],Object.getOwnPropertyDescriptor(no.prototype,"close"),no.prototype),no);function cC(e,t,n,o){n.optimizationMode&&(o&&o.width&&o.height?(n.encoderConfig=un(un({},o),{},{bitrateMin:o.bitrateMin,bitrateMax:o.bitrateMax}),n.optimizationMode!=="motion"&&n.optimizationMode!=="detail"||(t.contentHint=n.optimizationMode,t.contentHint===n.optimizationMode?R.debug("[".concat(e,"] set content hint to"),n.optimizationMode):R.debug("[".concat(e,"] set content hint failed")))):R.warning("[".concat(e,"] can not apply optimization mode bitrate config, no encoderConfig")))}var hj,pj,fj,mj,mo,gj,_j,Ej,vj,yj,Sj,Gr;class Tj extends CM{getUserId(){return this._userId}constructor(t,n,o,s){super(t,"track-".concat(t.kind,"-").concat(n,"-").concat(s.clientId,"_").concat(Jt(5,""))),Z(this,"_userId",void 0),Z(this,"_uintId",void 0),Z(this,"_isDestroyed",!1),Z(this,"store",void 0),Z(this,"processor",void 0),Z(this,"processorContext",void 0),this._userId=n,this._uintId=o,this.store=s}_updateOriginMediaStreamTrack(t){this._originMediaStreamTrack=t,this._mediaStreamTrack=t,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,R.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let uh=(hj=He({argsMap:(e,t,n)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),pj=He({argsMap:e=>[e.getTrackId()]}),fj=He({argsMap:(e,t)=>[e.getTrackId(),t.name]}),mj=He({argsMap:e=>[e.getTrackId()]}),vt((mo=class extends Tj{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Ur.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(e,t,n,o){super(e,t,n,o),Z(this,"_videoVisibleTimer",null),Z(this,"_previousVideoVisibleStatus",void 0),Z(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),Z(this,"trackMediaType",ah.VIDEO),Z(this,"_videoWidth",void 0),Z(this,"_videoHeight",void 0),Z(this,"_player",void 0),Z(this,"processorDestination",void 0),Z(this,"processorContext",void 0),this.updateMediaStreamTrackResolution(),this.processorContext=new UM(this.getTrackId(),"remote"),this.processorDestination=new MM(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return Dc(()=>{R.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),Yi(this,Ne.GET_STATS)||un({},wM)}play(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof e=="string"){const o=document.getElementById(e);o?e=o:(R.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}R.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(t));const n=un(un({fit:"cover"},t),{},{trackId:this.getTrackId(),element:e});this._player?this._player.updateConfig(n):(e instanceof HTMLVideoElement?this._player=new sC(n):this._player=new PU(n),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(sh.FIRST_FRAME_DECODED)},this._player.onVideoStateChanged=o=>{this.safeEmit(sh.VIDEO_STATE_CHANGED,o)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const o=this.getVideoElementVisibleStatus();this.safeEmit(sh.VIDEO_ELEMENT_VISIBLE_STATUS,o)}catch{}},H("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,R.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){FM(this._originMediaStreamTrack).then(e=>{let[t,n]=e;this._videoHeight=n,this._videoWidth=t}).catch(IE)}_updatePlayerSource(){R.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var e,t;const n=this==null||(e=this._player)===null||e===void 0?void 0:e.getContainerElement(),o={track:this,element:this==null||(t=this._player)===null||t===void 0?void 0:t.getVideoElement(),slot:n==null?void 0:n.parentElement},{element:s,slot:c}=o;if(this.isPlaying&&s instanceof HTMLVideoElement&&c instanceof HTMLElement){const d=B2.checkOneElementVisible(s),h=Object.assign({},d);if(h.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=h.visible;const p=ke.reportApiInvoke(null,{tag:En.TRACER,name:Nn.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});h.visible?p.onSuccess("Video is visible"):p.onSuccess("Invisible because of ".concat(h.reason))}return h}return}catch(n){throw new re(j.GET_VIDEO_ELEMENT_VISIBLE_ERROR,n.message)}}pipe(e){if(this.processor===e)return e;if(e._source)throw new re(j.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;const e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(Qr.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Qr.ON_TRACK)}_destroy(){super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(e){this.emit(ad.SEI_RECEIVED,e)}}).prototype,"play",[hj],Object.getOwnPropertyDescriptor(mo.prototype,"play"),mo.prototype),vt(mo.prototype,"stop",[pj],Object.getOwnPropertyDescriptor(mo.prototype,"stop"),mo.prototype),vt(mo.prototype,"pipe",[fj],Object.getOwnPropertyDescriptor(mo.prototype,"pipe"),mo.prototype),vt(mo.prototype,"unpipe",[mj],Object.getOwnPropertyDescriptor(mo.prototype,"unpipe"),mo.prototype),mo),hh=(gj=He({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),_j=He({argsMap:(e,t)=>[e.getTrackId(),t]}),Ej=He({argsMap:e=>[e.getTrackId()]}),vj=He({argsMap:e=>[e.getTrackId()]}),yj=He({argsMap:(e,t)=>[e.getTrackId(),t.name]}),Sj=He({argsMap:e=>[e.getTrackId()]}),vt((Gr=class extends Tj{get isPlaying(){return this._useAudioElement?si.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(e,t,n,o){super(e,t,n,o),Z(this,"trackMediaType",ah.AUDIO),Z(this,"_source",void 0),Z(this,"_useAudioElement",!0),Z(this,"_volume",100),Z(this,"processorContext",void 0),Z(this,"processorDestination",void 0),Z(this,"_played",!1),Z(this,"_bypassWebAudio",!1),H("DISABLE_WEBAUDIO")?(this._source=new iC,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new NM(e,!0),H("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once($i.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(sh.FIRST_FRAME_DECODED)}),this.processorContext=new VM(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new jM(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on($i.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners($i.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners($i.ON_AUDIO_BUFFER),this._source.on($i.ON_AUDIO_BUFFER,n=>e(n))}setVolume(e){this._volume=e,this._useAudioElement?si.setVolume(this.getTrackId(),e):this._source.setVolume(e/100)}async setPlaybackDevice(e){if(!this._useAudioElement||!vM())throw new re(j.NOT_SUPPORTED,"your browser does not support setting the audio output device");await si.setSinkID(this.getTrackId(),e)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return Dc(()=>{R.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),Yi(this,Ne.GET_STATS)||un({},TM)}play(){R.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(R.debug("[".concat(this.getTrackId(),"] use audio element to play")),si.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){R.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?si.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];R.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&si.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(e){if(this._bypassWebAudio)throw new re(j.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===e)return e;if(e._source)throw new re(j.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(this._bypassWebAudio)throw new re(j.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(Qr.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(Qr.ON_NODE,e=>{this._source.processedNode=e;const t=!e;this._useAudioElement!==t&&(this._played?(this.stop(),this._useAudioElement=t,this.play()):this._useAudioElement=t)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Qr.ON_TRACK),this.processorDestination.removeAllListeners(Qr.ON_NODE)}}).prototype,"setVolume",[gj],Object.getOwnPropertyDescriptor(Gr.prototype,"setVolume"),Gr.prototype),vt(Gr.prototype,"setPlaybackDevice",[_j],Object.getOwnPropertyDescriptor(Gr.prototype,"setPlaybackDevice"),Gr.prototype),vt(Gr.prototype,"play",[Ej],Object.getOwnPropertyDescriptor(Gr.prototype,"play"),Gr.prototype),vt(Gr.prototype,"stop",[vj],Object.getOwnPropertyDescriptor(Gr.prototype,"stop"),Gr.prototype),vt(Gr.prototype,"pipe",[yj],Object.getOwnPropertyDescriptor(Gr.prototype,"pipe"),Gr.prototype),vt(Gr.prototype,"unpipe",[Sj],Object.getOwnPropertyDescriptor(Gr.prototype,"unpipe"),Gr.prototype),Gr);const da=new class extends pn{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),Z(this,"_lastHiddenTime",0),Z(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),R.debug("current web page is ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};class wj extends pn{constructor(t,n){super(),Z(this,"trackMediaType",ah.DATA),Z(this,"_version",1),Z(this,"_type",3),Z(this,"_config",void 0),Z(this,"_originDataChannel",void 0),Z(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),Z(this,"_dataStreamPacketHandler",{serialize:o=>o,deserialize:o=>o}),Z(this,"_datachannelEventMap",new Map),this._config=t,n&&(this._originDataChannel=n,this._bandDataChannelEvents(n)),this._initPacketHeader()}useDataStream(t){this._dataStreamPacketHandler=t}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return H("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var t,n;return(t=(n=this._originDataChannel)===null||n===void 0?void 0:n.readyState)!==null&&t!==void 0?t:"connecting"}get _originDataChannelId(){var t,n;return(t=(n=this._originDataChannel)===null||n===void 0?void 0:n.id)!==null&&t!==void 0?t:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new ye((t,n)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&t();const o=setTimeout(()=>{var s;n(new re(j.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((s=this._originDataChannel)===null||s===void 0?void 0:s.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(o),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),t()},this._originDataChannel.onerror=()=>{throw clearTimeout(o),new re(j.DATACHANNEL_CONNECTION_TIMEOUT)}}else n(new re(j.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(t){this._originDataChannel=t,this._bandDataChannelEvents(t)}_initPacketHeader(){const t=new DataView(this._dataStreamPacketHeader);t.setUint16(0,this._version),t.setUint8(2,this._type),t.setUint8(3,this._config.id)}_bandDataChannelEvents(t){this._unbindDataChannelEvents(t),[ME.OPEN,ME.CLOSE,ME.ERROR].forEach(n=>{const o=()=>{this.emit(n)};this._datachannelEventMap.set(n,o),t.addEventListener(n,o)})}_unbindDataChannelEvents(t){Array.from(this._datachannelEventMap.entries()).forEach(n=>{let[o,s]=n;t.removeEventListener(o,s)}),this._datachannelEventMap.clear()}}class toe extends wj{constructor(t){super(t),Z(this,"_messageListener",void 0),this._messageListener=n=>{if(n.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const o=n.data.slice(0,this._dataStreamPacketHeader.byteLength),s=new DataView(o).getUint8(3);if(s!==this.id)return void(H("SHOW_DATASTREAM2_LOG")&&R.debug("invalid datachannel id: ".concat(s," !== ").concat(this.id)));let c=n.data.slice(this._dataStreamPacketHeader.byteLength);c=this._dataStreamPacketHandler.deserialize(c),this.emit(ME.MESSAGE,c)}}_updateOriginDataChannel(t){super._updateOriginDataChannel(t),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class noe extends wj{send(t){if(this._originDataChannel){let n=t;n=this._dataStreamPacketHandler.serialize(t);const o=new Uint8Array(this._dataStreamPacketHeader.byteLength+n.byteLength);o.set(new Uint8Array(this._dataStreamPacketHeader),0),o.set(new Uint8Array(n),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(o.buffer)}}}function VE(){const e=new Blob([atob("ZnVuY3Rpb24gdCh0LGUsbil7bGV0IGE9bmV3IFVpbnQ4QXJyYXkodCxlLG4pLG89W10scj0wO2Zvcig7by5sZW5ndGg8bjspciszPG4mJjA9PT1hW3JdJiYwPT09YVtyKzFdJiYzPT09YVtyKzJdJiYoMD09PWFbciszXXx8MT09PWFbciszXXx8Mj09PWFbciszXXx8Mz09PWFbciszXSk/KG8ucHVzaChhW3JdLGFbcisxXSxhW3IrM10pLHIrPTQpOihvLnB1c2goYVtyXSkscisrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobyl9ZnVuY3Rpb24gZSh0LGUpe2NvbnN0IG49ZnVuY3Rpb24odCl7Y29uc3QgZT10Lmxlbmd0aDtsZXQgbj1bXSxhPTA7Zm9yKDthPGU7KWErMjxlJiYwPT09dFthXSYmMD09PXRbYSsxXSYmKDA9PT10W2ErMl18fDE9PT10W2ErMl18fDI9PT10W2ErMl18fDM9PT10W2ErMl0pPyhuLnB1c2godFthXSx0W2ErMV0sMyx0W2ErMl0pLGErPTMpOihuLnB1c2godFthXSksYSsrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobil9KGUpLGE9bi5sZW5ndGgsbz1NYXRoLmZsb29yKGEvMjU1KSxyPWElMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNitvKzErYSt0LmJ5dGVMZW5ndGgpO3NbMF09MCxzWzFdPTAsc1syXT0wLHNbM109MSxzWzRdPTYsc1s1XT0xMDE7bGV0IGk9MDtmb3IoO2k8bzspc1s2K2ldPTI1NSxpKys7cmV0dXJuIHNbNitpXT1yLGkrKyxzLnNldChuLDYraSkscy5zZXQobmV3IFVpbnQ4QXJyYXkodCksNitpK2EpLHMuYnVmZmVyfWNvbnN0IG49NzEsYT0xLG89MixyPTEscz0yO3ZhciBpOyFmdW5jdGlvbih0KXt0W3QuQVVESU9fTEVWRUw9MV09IkFVRElPX0xFVkVMIix0W3QuTUVUQURBVEE9Ml09Ik1FVEFEQVRBIix0W3QuQVVESU9fNjRfQklUX1BUUz0zXT0iQVVESU9fNjRfQklUX1BUUyJ9KGl8fChpPXt9KSk7bmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCJTYWZhcmkiKT4tMSYmLTE9PT1uYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoIkNocm9tZSIpJiYoc2VsZi5vbnJ0Y3RyYW5zZm9ybT1mPT57Y29uc3QgdT1mLnRyYW5zZm9ybWVyO2xldCBkPVtdLGw9W107dS5vcHRpb25zLnBvcnQub25tZXNzYWdlPXQ9Pnt0LmRhdGEuc2VpJiZkLnB1c2godC5kYXRhLnNlaSksdC5kYXRhLm1ldGFkYXRhJiZsLnB1c2godC5kYXRhLm1ldGFkYXRhKX0sc2VsZi5wb3N0TWVzc2FnZSgic3RhcnRlZCIpO2NvbnN0IGc9dS5yZWFkYWJsZS5nZXRSZWFkZXIoKSxjPXUud3JpdGFibGUuZ2V0V3JpdGVyKCk7InNlaS1yeCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiBlKG4pe2cucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IGU9ZnVuY3Rpb24oZSl7Y29uc3Qgbj1uZXcgRGF0YVZpZXcoZS5kYXRhKTtsZXQgYT0wO2Zvcig7YSs0PGUuZGF0YS5ieXRlTGVuZ3RoOyl7aWYoMD09PW4uZ2V0VWludDgoYSswKSYmMD09PW4uZ2V0VWludDgoYSsxKSYmMD09PW4uZ2V0VWludDgoYSsyKSYmMT09PW4uZ2V0VWludDgoYSszKSYmNj09PW4uZ2V0VWludDgoYSs0KSl7bGV0IG89YSs2LHI9MCxzPTA7Zm9yKDsyNTU9PT0ocz1uLmdldFVpbnQ4KG8rKykpOylyKz0yNTU7cis9cztjb25zdCBpPXQoZS5kYXRhLG8scik7cmV0dXJuIG5ldyBVaW50OEFycmF5KGkpfWErK31yZXR1cm4gbnVsbH0oYS52YWx1ZSk7ZSYmbi5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3NlaTplfSl9Yy53cml0ZShhLnZhbHVlKSxuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSxlKG4pfX0pKX0odSk6InNlaS10eCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KG4pe2cucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IHQ9ZC5zaGlmdCgpO3QmJihhLnZhbHVlLmRhdGE9ZShhLnZhbHVlLmRhdGEsdCkpfWMud3JpdGUoYS52YWx1ZSksbi5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3RyYW5zZm9ybWVkOiEwfSksdChuKX19KSl9KHUpOiJhdWRpby1tZXRhZGF0YS1yeCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KGUpe2cucmVhZCgpLnRoZW4oKGY9PntpZighZi5kb25lKXtpZihmLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZEF1ZGlvRnJhbWUpe2NvbnN0IHQ9ZnVuY3Rpb24odCxlPSExKXtjb25zdCBmPXQuZ2V0VWludDgoMCk7aWYoZiE9PW4pcmV0dXJuO2NvbnN0IHU9dC5nZXRVaW50MTYoMSksZD1hK28rdSxsPW5ldyBVaW50OEFycmF5KHQuYnl0ZUxlbmd0aC1kKTtsLnNldChuZXcgVWludDhBcnJheSh0LmJ1ZmZlcixkLHQuYnl0ZUxlbmd0aC1kKSk7Y29uc3QgZz17bTpmLHRsdkxlbjp1LHRsdjpbXSxmcmFtZTpsfTtsZXQgYz1hK287Zm9yKDtjPGQ7KXtjb25zdCBuPXQuZ2V0VWludDgoYyksYT10LmdldFVpbnQxNihjK3IpLG89citzO2lmKG49PT1pLkFVRElPX0xFVkVMKXtsZXQgcj10LmdldFVpbnQ4KGMrbyk7Zm9yKGxldCBlPTE7ZTxhO2UrKylyPXI8PDh8dC5nZXRVaW50OChjK28rZSk7Zy50bHYucHVzaCh7dGFnOm4sbGVuZ3RoOmEsdmFsdWU6ZT8xMjdecj4+MToxMjcmcn0pfWVsc2UgaWYobj09PWkuTUVUQURBVEF8fG49PT1pLkFVRElPXzY0X0JJVF9QVFMpe2NvbnN0IGU9bmV3IFVpbnQ4QXJyYXkoYSk7Zm9yKGxldCBuPTA7bjxhO24rKyllW25dPXQuZ2V0VWludDgoYytvK24pO2cudGx2LnB1c2goe3RhZzpuLGxlbmd0aDphLHZhbHVlOmV9KX1jKz1vK2F9cmV0dXJuIGd9KG5ldyBEYXRhVmlldyhmLnZhbHVlLmRhdGEpKTtpZih0KXtjb25zdCBuPXQudGx2LmZpbmQoKHQ9PnQudGFnPT09aS5NRVRBREFUQXx8dC50YWc9PT1pLkFVRElPXzY0X0JJVF9QVFMpKTtuJiZuLnZhbHVlIGluc3RhbmNlb2YgVWludDhBcnJheSYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe21ldGFkYXRhOm4udmFsdWV9KSxmLnZhbHVlLmRhdGE9dC5mcmFtZS5idWZmZXJ9fWMud3JpdGUoZi52YWx1ZSksZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3RyYW5zZm9ybWVkOiEwfSksdChlKX19KSl9KHUpOiJhdWRpby1tZXRhZGF0YS10eCI9PT11Lm9wdGlvbnMubmFtZSYmZnVuY3Rpb24gdChlKXtnLnJlYWQoKS50aGVuKChmPT57aWYoIWYuZG9uZSl7aWYoZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe2dldE1ldGFkYXRhOiEwfSksZi52YWx1ZSBpbnN0YW5jZW9mIFJUQ0VuY29kZWRBdWRpb0ZyYW1lKXtjb25zdCB0PWwuc2hpZnQoKTt0JiYoZi52YWx1ZS5kYXRhPWZ1bmN0aW9uKHQsZSxpKXtjb25zdCBmPWkuYnl0ZUxlbmd0aCx1PWYrcitzLGQ9YStvK3UsbD1uZXcgQXJyYXlCdWZmZXIodC5ieXRlTGVuZ3RoK2QpLGc9bmV3IERhdGFWaWV3KGwpO2cuc2V0VWludDgoMCxuKSxnLnNldFVpbnQxNigxLHUpLGcuc2V0VWludDgoMyxlKSxnLnNldFVpbnQxNig0LGYpO2ZvcihsZXQgdD0wO3Q8Zjt0KyspZy5zZXRVaW50OCg2K3QsaVt0XSk7Y29uc3QgYz1uZXcgVWludDhBcnJheShnLmJ1ZmZlcik7cmV0dXJuIGMuc2V0KG5ldyBVaW50OEFycmF5KHQpLGQpLGMuYnVmZmVyfShmLnZhbHVlLmRhdGEsaS5BVURJT182NF9CSVRfUFRTLHQpKX1jLndyaXRlKGYudmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfSh1KX0sc2VsZi5wb3N0TWVzc2FnZSgicmVnaXN0ZXJlZCIpKTsK")],{type:"text/javascript"});return setTimeout(()=>V_.revokeObjectURL(e),0),new Worker(V_.createObjectURL(e))}const Rj=71,lC=1,dC=2,uC=1,Cj=2;var Ya=function(e){return e[e.AUDIO_LEVEL=1]="AUDIO_LEVEL",e[e.METADATA=2]="METADATA",e[e.AUDIO_64_BIT_PTS=3]="AUDIO_64_BIT_PTS",e}(Ya||{});function bj(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=e.getUint8(0);if(n!==Rj)return;const o=e.getUint16(1),s=lC+dC+o,c=new Uint8Array(e.byteLength-s);c.set(new Uint8Array(e.buffer,s,e.byteLength-s));const d={m:n,tlvLen:o,tlv:[],frame:c};let h=lC+dC;for(;h<s;){const p=e.getUint8(h),m=e.getUint16(h+uC),g=uC+Cj;if(p===Ya.AUDIO_LEVEL){let E=e.getUint8(h+g);for(let y=1;y<m;y++)E=E<<8|e.getUint8(h+g+y);d.tlv.push({tag:p,length:m,value:t?127^E>>1:127&E})}else if(p===Ya.METADATA||p===Ya.AUDIO_64_BIT_PTS){const E=new Uint8Array(m);for(let y=0;y<m;y++)E[y]=e.getUint8(h+g+y);d.tlv.push({tag:p,length:m,value:E})}h+=g+m}return d}const FE=new Map,BE=127,dd=1e-10,hC=139/13,WE=new Map;function pC(e,t,n){const o="".concat(e,"-").concat(t,"-").concat(n);let s=0;return WE.has(o)?s=WE.get(o):(s=Math.log(function(d,h){const p=d-h;h<p&&(h=p);let m=1;for(let g=d,E=1;g>h;g--,E++)m=m*g/E;return m}(t,e))+e*Math.log(.5)+(t-e)*Math.log(1-.5)-Math.log(n)+n*e,WE.set(o,s)),s<dd&&(s=dd),s}function Ij(e,t,n){const o=t.length,s=e.length/o;let c=!1;for(let d=0,h=0;d<o;d++){let p=0;for(let m=h+s;h<m;h++)e[h]>n&&p++;t[d]!==p&&(t[d]=p,c=!0)}return c}window.cache=WE;let roe=0;class Aj{constructor(t){Z(this,"id",void 0),Z(this,"immediates",[]),Z(this,"lastNonSilence",-1),Z(this,"immediateSpeechActivityScore",dd),Z(this,"lastLevelChangedTime",Date.now()),Z(this,"levels",[]),Z(this,"longs",[]),Z(this,"longSpeechActivityScore",dd),Z(this,"mediums",[]),Z(this,"mediumSpeechActivityScore",dd),Z(this,"minLevel",0),Z(this,"nextMinLevel",0),Z(this,"nextMinLevelWindowLength",0),Z(this,"energyScore",0),this.id=t||"".concat(roe++),this.immediates.length=50,this.mediums.length=10,this.longs.length=1,this.levels.length=this.immediates.length}computeImmediates(){const t=this.immediates,n=this.levels,o=this.minLevel+hC;let s=!1;for(let c=0;c<t.length;++c){let d=n[c];d<o&&(d=0);const h=Math.floor(d/hC);t[c]!==h&&(t[c]=h,s=!0)}return s}computeLongs(){return Ij(this.mediums,this.longs,4)}computeMediums(){return Ij(this.immediates,this.mediums,7)}evaluateImmediateSpeechActivityScore(){this.immediateSpeechActivityScore=pC(this.immediates[0],13,.78)}evaluateLongSpeechActivityScore(t){this.longSpeechActivityScore=pC(this.longs[0],10,47),this.longSpeechActivityScore>dd&&(this.lastNonSilence=t)}evaluateMediumSpeechActivityScore(){this.mediumSpeechActivityScore=pC(this.mediums[0],5,24)}evaluateSpeechActivityScores(t){this.computeImmediates()&&(this.evaluateImmediateSpeechActivityScore(),this.computeMediums()&&(this.evaluateMediumSpeechActivityScore(),this.computeLongs()&&this.evaluateLongSpeechActivityScore(t)))}getLastLevelChangedTime(){return this.lastLevelChangedTime}getLevels(){var t;return"[".concat(c1(t=[...this.levels]).call(t).join(),"]")}getSpeechActivityScore(t){switch(t){case 0:return this.immediateSpeechActivityScore;case 1:return this.mediumSpeechActivityScore;case 2:return this.longSpeechActivityScore;default:throw new Error("interval "+t)}}levelChanged(t,n){if(this.lastLevelChangedTime<=n){this.lastLevelChangedTime=n;let o=t;return t<0&&(o=0),t>BE&&(o=BE),this.levels.unshift(o),this.levels.length>this.immediates.length&&this.levels.pop(),this.updateMinLevel(o),o>=this.minLevel+hC?o:o/2}return-1}levelTimedOut(){this.levelChanged(0,this.lastLevelChangedTime)}updateMinLevel(t){if(t!==0){if(this.minLevel===0||this.minLevel>t)return this.minLevel=t,this.nextMinLevel=0,void(this.nextMinLevelWindowLength=0);if(this.nextMinLevel===0)return this.nextMinLevel=t,void(this.nextMinLevelWindowLength=1);if(this.nextMinLevel>t&&(this.nextMinLevel=t),this.nextMinLevelWindowLength++,this.nextMinLevelWindowLength>=750){let n=Math.sqrt(this.minLevel*this.nextMinLevel);n<0?n=0:n>BE&&(n=BE),this.minLevel=n,this.nextMinLevel=0,this.nextMinLevelWindowLength=0}}}}class ioe{constructor(t){Z(this,"algorithm",void 0),this.algorithm=t}execute(){let t=!this.algorithm;if(!t)try{const n=this.algorithm.runInDecisionMaker(this);n<=0?t=!0:setTimeout(this.execute.bind(this),n)}catch{t=!0}t&&this.algorithm&&this.algorithm.decisionMakerExited(this)}}class fC{constructor(t,n,o){Z(this,"isDominant",void 0),Z(this,"energyRanking",void 0),Z(this,"energyScore",void 0),this.isDominant=t,this.energyRanking=n,this.energyScore=o}}class ooe extends pn{constructor(t){super(),Z(this,"dominantId",null),Z(this,"lastDecisionTime",0),Z(this,"lastLevelChangedTime",0),Z(this,"lastLevelIdleTime",0),Z(this,"relativeSpeechActivities",[]),Z(this,"speakers",new Map),Z(this,"enableSilence",!1),Z(this,"timeoutToSilenceInterval",0),Z(this,"decisionMaker",null),Z(this,"loudest",[]),Z(this,"numLoudestToTrack",3),Z(this,"energyExpireTimeMs",250),Z(this,"energyAlphaPct",50),this.timeoutToSilenceInterval=t,this.enableSilence=t>0,this.relativeSpeechActivities.length=3}setLoudestConfig(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3,n=arguments.length>1?arguments[1]:void 0,o=arguments.length>2?arguments[2]:void 0;this.numLoudestToTrack=t,n!=null&&(this.energyExpireTimeMs=n),o!=null&&(this.energyAlphaPct=o),this.loudest.length>t&&this.loudest.splice(t)}getDominantSpeaker(){return this.dominantId}isAmongLoudest(t){return this.loudest.some(n=>n.id===t)}levelChanged(t,n){const o=Date.now(),s=this.getOrCreateSpeaker(t);this.lastLevelChangedTime<o&&(this.lastLevelChangedTime=o,this.maybeStartDecisionMaker());const c=s.levelChanged(n,o);return this.updateLoudestList(s,c,o)}runInDecisionMaker(t){return this.decisionMaker!==t||this.lastDecisionTime>0&&this.lastDecisionTime-this.lastLevelChangedTime>=15e3?-1:this._runInDecisionMaker()}decisionMakerExited(t){this.decisionMaker===t&&(this.decisionMaker=null)}destroy(){this.decisionMaker=null,this.loudest.length=0,this.speakers.clear(),this.removeAllListeners()}addSpeakers(t){t.forEach(n=>{this.speakers.has(n.id)||this.speakers.set(n.id,n)})}removeSpeakers(t){t.forEach(n=>{this.speakers.delete(n.id)})}getOrCreateSpeaker(t){let n=this.speakers.get(t);return n||(n=new Aj(t),this.speakers.set(t,n),this.maybeStartDecisionMaker()),n}updateLoudestList(t,n,o){const s=t.id===this.dominantId;if(n<0){let p=0;for(;p<this.loudest.length&&this.loudest[p]!==t;)++p;return new fC(s,p,t.energyScore)}if(t.energyScore=Math.floor((this.energyAlphaPct*n+(100-this.energyAlphaPct)*t.energyScore+50)/100),this.numLoudestToTrack===0)return new fC(s,0,t.energyScore);const c=o-this.energyExpireTimeMs;let d=0;for(;d<this.loudest.length;){const p=this.loudest[d];if(p.getLastLevelChangedTime()<c&&this.loudest.length>=this.numLoudestToTrack)this.loudest.splice(d,1);else if(p.id!==t.id)++d;else if(this.loudest.splice(d,1),this.loudest.length<this.numLoudestToTrack)break}let h=0;for(;h<this.loudest.length&&!(this.loudest[h].energyScore<t.energyScore);)++h;return h<this.numLoudestToTrack&&(this.loudest.splice(h,0,t),this.loudest.length>this.numLoudestToTrack&&this.loudest.splice(this.numLoudestToTrack,1)),new fC(s,h,t.energyScore)}maybeStartDecisionMaker(){!this.decisionMaker&&this.speakers.size>0&&(this.decisionMaker=new ioe(this),this.decisionMaker.execute())}makeDecision(t){let n=null,o=null;const s=this.speakers.size;let c=null;if(s===0)c=null;else if(s===1){var d;const h=Pi(d=this.speakers).call(d).next().value;this.enableSilence&&h&&(c=h.id,h.evaluateSpeechActivityScores(t),t-h.lastNonSilence>this.timeoutToSilenceInterval&&(c=null))}else{let h=this.dominantId==null?null:this.speakers.get(this.dominantId);if(h==null){const g=this.speakers.entries().next();g.value&&(c=g.value[0],h=g.value[1])}else c=h.id;h!=null&&h.evaluateSpeechActivityScores(t);const p=this.relativeSpeechActivities;let m=2;for(const g of this.speakers.entries()){const[E,y]=g;if(y===h)continue;y.evaluateSpeechActivityScores(t);for(let A=0;A<p.length;++A){const M=h==null?dd:h.getSpeechActivityScore(A);p[A]=Math.log(y.getSpeechActivityScore(A)/M)}const T=p[0],P=p[1],I=p[2];T>3&&P>2&&I>0&&P>m&&(m=P,c=E)}this.enableSilence&&h!=null&&c===h.id&&t-h.lastNonSilence>this.timeoutToSilenceInterval&&(c=null)}c==null&&!this.enableSilence||c===this.dominantId||(n=this.dominantId,this.dominantId=c,o=this.dominantId),o==null&&!this.enableSilence||o===n||this.emit("ActiveSpeakerChanged",o)}_runInDecisionMaker(){const t=Date.now(),n=300-(t-this.lastLevelIdleTime);let o=0;n<=0?(this.lastLevelIdleTime!==0&&this.timeoutIdleLevels(t),this.lastLevelIdleTime=t):o=n;let s=300-(t-this.lastDecisionTime);return s<=0&&(this.lastDecisionTime=t,this.makeDecision(t),s=300-(Date.now()-t)),s>0&&o>s&&(o=s),o}timeoutIdleLevels(t){const n=[];for(const s of Pi(o=this.speakers).call(o)){var o;const c=t-s.getLastLevelChangedTime();36e5<c&&(this.dominantId==null||s.id!==this.dominantId)?n.push(s.id):300<c&&s.levelTimedOut()}n.forEach(s=>this.speakers.delete(s))}}const ph=new Map;let Cs=null,HE=null;const Nj=3;let ud=[];const bs=new Map,GE=new Map;class soe{get samples(){return this.actives+this.inactives}get activeRate(){return this.actives/this.samples}constructor(t,n){Z(this,"id",void 0),Z(this,"track",void 0),Z(this,"score",0),Z(this,"active",!0),Z(this,"muted",!1),Z(this,"timer",0),Z(this,"actives",0),Z(this,"inactives",0),this.id=t,this.track=n,this.setActive(bs.size<3)}autoCheckActive(){this.autoSetActive(),this.autoAdjustActive(),this.resetTimer(),this.actives=0,this.inactives=0}autoSetActive(){const t=this.active;this.active=this.activeRate>=.8;const{actives:n,inactives:o}=function(){const s=[],c=[];return Array.from(Pi(bs).call(bs)).forEach(d=>{d.active?s.push(d):c.push(d)}),{actives:s,inactives:c}}();if(n.length>3){let s;n.forEach(c=>{(!s||s.score>c.score)&&(s=c)}),s&&s.setActive(!1)}if(n.length<3&&o.length>0){let s;o.forEach(c=>{(!s||s.score<c.score)&&c.id!==this.id&&(s=c)}),s&&t&&!this.active&&(s.samples>40&&s.activeRate-this.activeRate>.4?s.setActive(!0):this.active=!0)}this.setMuted(!this.active)}setActive(t){this.active=t,this.resetTimer(),this.setMuted(!t)}autoAdjustActive(){this.active?this.autoSwitchToInactive():this.autoSwitchToActive()}autoSwitchToActive(){const t=function(n){let o;return Array.from(Pi(bs).call(bs)).forEach(s=>{!s.active||s.id===n||s.samples<40||(!o||s.score<o.score)&&(o=s)}),o}(this.id);t&&this.activeRate-t.activeRate>.4&&(t.setActive(!1),this.setActive(!0))}autoSwitchToInactive(){const t=function(n){let o;return Array.from(Pi(bs).call(bs)).forEach(s=>{s.active||s.id===n||s.samples<40||(!o||s.score>o.score)&&(o=s)}),o}(this.id);t&&t.activeRate-this.activeRate>.4&&(t.setActive(!0),this.setActive(!1))}addSample(t){t?this.actives+=1:this.inactives+=1,this.samples>66.66666666666667&&this.autoCheckActive()}setMuted(t){this.track&&(this.track.enabled=!t,this.muted=t)}resetTimer(){this.clearTimer(),this.timer=window.setTimeout(()=>{if(this.samples!==0)return this.samples<50?this.resetTimer():void this.autoCheckActive()},1e3)}clearTimer(){this.timer&&(clearTimeout(this.timer),this.timer=0)}}let zE;function Oj(e){const t=bs.get(e);t&&(bs.delete(e),t.clearTimer())}const KE=new Map,aoe=new Map;function coe(e,t,n){let o=new Uint8Array(e,t,n),s=[],c=0;for(;s.length<n;)c+3<n&&o[c]===0&&o[c+1]===0&&o[c+2]===3&&(o[c+3]===0||o[c+3]===1||o[c+3]===2||o[c+3]===3)?(s.push(o[c],o[c+1],o[c+3]),c+=4):(s.push(o[c]),c++);return new Uint8Array(s)}const YE=new Map,Bf=new Map;(function(){const e=wt();lr.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),lr.getStreamFromExtension=e.name===Ot.CHROME&&Number(e.version)>34,lr.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const t=new RTCPeerConnection;let n=!1;try{t.addTransceiver("audio"),n=!0}catch{}return t.close(),n}(),lr.supportMinBitrate=e.name===Ot.CHROME||e.name===Ot.EDGE,lr.supportSetRtpSenderParameters=function(){const t=wt();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!Ga()||!(!gr()&&!wE())||t.name===Ot.FIREFOX&&Number(t.version)>=64)}(),e.name===Ot.SAFARI&&(Number(e.version)>=14?lr.supportDualStream=!0:lr.supportDualStream=!1),lr.webAudioMediaStreamDest=function(){const t=wt();return!(t.name===Ot.SAFARI&&Number(t.version)<12)}(),lr.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",lr.supportWebGL=typeof WebGLRenderingContext<"u",lr.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,Ga()||(lr.webAudioWithAEC=!0),lr.supportShareAudio=function(){const t=wt();return(t.os===Xn.WIN_10||t.os===Xn.WIN_81||t.os===Xn.WIN_7||t.os===Xn.LINUX||t.os===Xn.MAC_OS||t.os===Xn.CHROMIUM_OS)&&t.name===Ot.CHROME&&Number(t.version)>=74}(),lr.supportDataChannel=!!(Nf(76)||function(t){const n=wt();return!(n.name!==Ot.FIREFOX||!n.osVersion)&&Number(n.version)>=t}(68)||D2(14)),lr.supportPCSetConfiguration=function(){const t=window.RTCPeerConnection;return!gn()&&!!t&&t.prototype.setConfiguration instanceof Function}(),lr.supportWebRTCEncodedTransform=function(){const t=wt();return t.name==="Chrome"&&Number(t.version)>=87||t.name==="Safari"&&Number(t.version)>=15}(),lr.supportWebRTCInsertableStream=function(){const t=wt();return(t.name===Ot.CHROME||t.name===Ot.EDGE)&&Number(t.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),lr.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,lr.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,bE(()=>{lr.supportDualStreamEncoding=function(){const t=wt();return!!H("DISABLE_WEBAUDIO")||t.name==="Safari"&&Number(t.version)>=14||!!(t.name==="Chrome"&&/Windows/i.test(t.os||"")&&Number(t.version)>=100&&H("CHROME_DUAL_STREAM_USE_ENCODING"))}(),R.debug("browser ua: ",navigator.userAgent),R.info("browser info: ",e),R.info("browser compatibility: ",lr)})})();const loe=["CHINA","GLOBAL"],Pj=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],hd=[],fh=[];function pd(e,t){return!!t&&hd.some(n=>n.uid===e&&n.channelName===t)}function mC(){return fh.length>0}var doe=Xx.forEach,Dj=Jg("forEach")?[].forEach:function(e){return doe(this,e,arguments.length>1?arguments[1]:void 0)};Mt({target:"Array",proto:!0,forced:[].forEach!==Dj},{forEach:Dj});var uoe=Vo("Array","forEach"),hoe=Tc,poe=Lr,foe=O,moe=uoe,gC=Array.prototype,goe={DOMTokenList:!0,NodeList:!0},_oe=function(e){var t=e.forEach;return e===gC||foe(gC,e)&&t===gC.forEach||poe(goe,hoe(e))?moe:t},Eoe=u(_oe),voe=ea,kj=r_;Mt({target:"Object",stat:!0,forced:f(function(){kj(1)})},{keys:function(e){return kj(voe(e))}});var yoe=u(wn.Object.keys),Soe=u(o1),Toe=u(a1),woe=Mt,xj=Qp,Roe=__,Coe=xr,Lj=V0,boe=Sc,Ioe=br,Aoe=iw,Noe=Fn,Ooe=Rc,Poe=Vx("slice"),Doe=Noe("species"),_C=Array,koe=Math.max;woe({target:"Array",proto:!0,forced:!Poe},{slice:function(e,t){var n,o,s,c=Ioe(this),d=boe(c),h=Lj(e,d),p=Lj(t===void 0?d:t,d);if(xj(c)&&(n=c.constructor,(Roe(n)&&(n===_C||xj(n.prototype))||Coe(n)&&(n=n[Doe])===null)&&(n=void 0),n===_C||n===void 0))return Ooe(c,h,p);for(o=new(n===void 0?_C:n)(koe(p-h,0)),s=0;h<p;h++,s++)h in c&&Aoe(o,s,c[h]);return o.length=s,o}});var xoe=Vo("Array","slice"),Loe=O,Moe=xoe,EC=Array.prototype,Uoe=function(e){var t=e.slice;return e===EC||Loe(EC,e)&&t===EC.slice?Moe:t},joe=u(Uoe);function Oe(e,t,n,o,s){var c,d,h,p={};return Eoe(c=yoe(o)).call(c,function(m){p[m]=o[m]}),p.enumerable=!!p.enumerable,p.configurable=!!p.configurable,("value"in p||p.initializer)&&(p.writable=!0),p=Soe(d=Toe(h=joe(n).call(n)).call(h)).call(d,function(m,g){return g(e,t,m)||m},p),s&&p.initializer!==void 0&&(p.value=p.initializer?p.initializer.call(s):void 0,p.initializer=void 0),p.initializer===void 0?(Lx(e,t,p),null):p}let qE=function(e){return e[e.ACCESS_POINT=101]="ACCESS_POINT",e[e.UNILBS=201]="UNILBS",e[e.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",e}({}),vC=function(e){return e[e.IIIEGAL_APPID=1]="IIIEGAL_APPID",e[e.IIIEGAL_UID=2]="IIIEGAL_UID",e[e.INTERNAL_ERROR=3]="INTERNAL_ERROR",e}({}),Jo=function(e){return e[e.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",e[e.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",e[e.INTERNAL_ERROR=8]="INTERNAL_ERROR",e[e.NO_AUTHORIZED=9]="NO_AUTHORIZED",e[e.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",e[e.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",e[e.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",e[e.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",e[e.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",e[e.USER_OVERLOAD=16]="USER_OVERLOAD",e[e.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",e[e.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",e}({}),Zr=function(e){return e[e.NO_FLAG_SET=100]="NO_FLAG_SET",e[e.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",e[e.INVALID_FALG_SET=102]="INVALID_FALG_SET",e[e.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",e[e.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",e[e.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",e[e.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",e[e.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",e[e.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",e[e.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",e[e.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",e[e.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",e[e.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",e[e.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",e[e.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",e[e.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",e[e.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",e[e.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",e[e.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",e}({}),Be=function(e){return e[e.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",e[e.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",e[e.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",e[e.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",e[e.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",e[e.K_TICKET_INVALID=7]="K_TICKET_INVALID",e[e.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",e[e.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",e[e.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",e[e.K_UID_BANNED=14]="K_UID_BANNED",e[e.K_IP_BANNED=15]="K_IP_BANNED",e[e.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",e[e.DATASTREAM2_NOT_AVAILABLE=27]="DATASTREAM2_NOT_AVAILABLE",e[e.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",e[e.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",e[e.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",e[e.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",e[e.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",e[e.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",e[e.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",e[e.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",e[e.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",e[e.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",e[e.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",e[e.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",e[e.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",e[e.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",e[e.ERR_INVALID_UID=117]="ERR_INVALID_UID",e[e.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",e[e.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",e[e.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",e[e.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",e[e.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",e[e.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",e[e.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",e[e.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",e[e.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",e[e.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",e[e.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",e[e.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",e[e.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",e[e.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",e[e.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",e[e.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",e[e.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",e[e.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",e[e.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",e[e.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",e[e.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",e[e.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",e[e.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",e[e.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",e[e.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",e[e.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",e[e.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",e[e.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",e[e.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",e[e.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",e[e.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",e[e.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",e[e.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",e[e.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",e[e.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",e[e.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",e[e.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",e}({}),en=function(e){return e.CONNECTING="connecting",e.CONNECTED="connected",e.RECONNECTING="reconnecting",e.CLOSED="closed",e}({}),$e=function(e){return e.WS_CONNECTED="ws_connected",e.WS_RECONNECTING="ws_reconnecting",e.WS_CLOSED="ws_closed",e.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",e.ON_BINARY_DATA="on_binary_data",e.REQUEST_RECOVER="request_recover",e.REQUEST_JOIN_INFO="request_join_info",e.REQUEST_REJOIN_INFO="req_rejoin_info",e.IS_P2P_DISCONNECTED="is_p2p_dis",e.DISCONNECT_P2P="dis_p2p",e.ABORT_P2P_EXECUTION="abort_p2p_execution",e.NEED_RENEW_SESSION="need-sid",e.REPORT_JOIN_GATEWAY="report_join_gateway",e.REQUEST_TIMEOUT="request_timeout",e.REQUEST_SUCCESS="request_success",e.JOIN_RESPONSE="join_response",e.PRE_CONNECT_PC="pre_connect_pc",e.P2P_CONNECTION="p2p_connection",e.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",e.P2P_SUBSCRIBE="p2p_subscribe",e.P2P_UNSUBSCRIBE="p2p_unsubscribe",e.P2P_EXCHANGE_SDP="p2p_exchange_sdp",e.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",e.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",e.RECOVER_NOTIFICATION="recover_notification",e}({}),Ye=function(e){return e.PING="ping",e.PING_BACK="ping_back",e.JOIN="join_v3",e.REJOIN="rejoin_v3",e.LEAVE="leave",e.SET_CLIENT_ROLE="set_client_role",e.PUBLISH="publish",e.PUBLISH_DATASTREAM="publish_datastream",e.UNPUBLISH="unpublish",e.UNPUBLISH_DATASTREAM="unpublish_datastream",e.SUBSCRIBE="subscribe",e.PRE_SUBSCRIBE="pre_subscribe",e.SUBSCRIBE_DATASTREAM="subscribe_datastream",e.SUBSCRIBE_STREAMS="subscribe_streams",e.UNSUBSCRIBE="unsubscribe",e.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",e.UNSUBSCRIBE_STREAMS="unsubscribe_streams",e.SUBSCRIBE_CHANGE="subscribe_change",e.TRAFFIC_STATS="traffic_stats",e.RENEW_TOKEN="renew_token",e.SWITCH_VIDEO_STREAM="switch_video_stream",e.DEFAULT_VIDEO_STREAM="default_video_stream",e.SET_FALLBACK_OPTION="set_fallback_option",e.GATEWAY_INFO="gateway_info",e.CONTROL="control",e.SEND_METADATA="send_metadata",e.DATA_STREAM="data_stream",e.PICK_SVC_LAYER="pick_svc_layer",e.RESTART_ICE="restart_ice",e.CONNECT_PC="connect_pc",e.SET_VIDEO_PROFILE="set_video_profile",e.SET_PARAMETER="set_parameter",e.SET_RTM2_FLAG="set_rtm2_flag",e}({}),Wf=function(e){return e.WRTC_STATS="wrtc_stats",e.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",e.DENOISER_STATS="denoiser_stats",e.EXTENSION_USAGE_STATS="extension_usage_stats",e}({}),_t=function(e){return e.ON_USER_ONLINE="on_user_online",e.ON_USER_OFFLINE="on_user_offline",e.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",e.ON_PUBLISH_STREAM="on_publish_stream",e.ON_UPLINK_STATS="on_uplink_stats",e.ON_P2P_LOST="on_p2p_lost",e.ON_REMOVE_STREAM="on_remove_stream",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",e.ON_USER_BANNED="on_user_banned",e.ON_USER_LICENSE_BANNED="on_user_license_banned",e.ON_NOTIFICATION="on_notification",e.ON_CRYPT_ERROR="on_crypt_error",e.MUTE_AUDIO="mute_audio",e.MUTE_VIDEO="mute_video",e.UNMUTE_AUDIO="unmute_audio",e.UNMUTE_VIDEO="unmute_video",e.ON_P2P_OK="on_p2p_ok",e.RECEIVE_METADATA="receive_metadata",e.ON_DATA_STREAM="on_data_stream",e.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",e.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",e.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",e.ENABLE_LOCAL_VIDEO="enable_local_video",e.DISABLE_LOCAL_VIDEO="disable_local_video",e.ENABLE_LOCAL_AUDIO="enable_local_audio",e.DISABLE_LOCAL_AUDIO="disable_local_audio",e.ON_PUBLISHED_USER_LIST="on_published_user_list",e}({}),ei=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({}),tt=function(e){return e.CONNECTED="websocket:connected",e.RECONNECTING="websocket:reconnecting",e.WILL_RECONNECT="websocket:will_reconnect",e.CLOSED="websocket:closed",e.FAILED="websocket:failed",e.ON_MESSAGE="websocket:on_message",e.REQUEST_NEW_URLS="websocket:request_new_urls",e.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",e}({});function XE(e){if(typeof e!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(e))throw R.error("Invalid Channel Name ".concat(e)),new ee(j.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function $E(e){if(t=e,!(typeof t=="number"&&Math.floor(t)===t&&0<=t&&t<=4294967295||F2(e,1,255)))throw new ee(j.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var t;typeof e=="string"&&R.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let qa=function(e){return e.TRANSCODE="mix_streaming",e.RAW="raw_streaming",e}({});const Voe={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},yC={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function SC(e,t){ar(e.url,"".concat(t,".url"),1,1e3,!1),_n(e.x)||Ht(e.x,"".concat(t,".x"),0,1e4),_n(e.y)||Ht(e.y,"".concat(t,".y"),0,1e4),_n(e.width)||Ht(e.width,"".concat(t,".width"),0,1e4),_n(e.height)||Ht(e.height,"".concat(t,".height"),0,1e4),_n(e.zOrder)||Ht(e.zOrder,"".concat(t,".zOrder"),0,255),_n(e.alpha)||Ht(e.alpha,"".concat(t,".alpha"),0,1,!1)}const Foe={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""};let Lc=function(e){return e.WARNING="@live_uap-warning",e.ERROR="@line_uap-error",e.PUBLISH_STREAM_STATUS="@live_uap-publish-status",e.WORKER_STATUS="@live_uap-worker-status",e.REQUEST_NEW_ADDRESS="@live_uap-request-address",e}({}),TC=function(e){return e.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",e}({}),Wn=function(e){return e[e.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",e[e.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",e[e.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",e[e.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",e[e.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",e[e.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",e[e.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",e[e.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",e[e.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",e[e.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",e[e.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",e[e.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",e[e.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",e[e.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",e[e.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",e[e.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",e}({});function Mj(e){if(!e.channelName)throw new ee(j.INVALID_PARAMS,"invalid channelName in info");if(typeof e.uid!="number")throw new ee(j.INVALID_PARAMS,"invalid uid in info, uid must be a number");return e.token&&ar(e.token,"info.token",1,2047),$E(e.uid),XE(e.channelName),!0}let ti=function(e){return e[e.SetSdkProfile=0]="SetSdkProfile",e[e.SetSourceChannel=1]="SetSourceChannel",e[e.SetSourceUserId=2]="SetSourceUserId",e[e.SetDestChannel=3]="SetDestChannel",e[e.StartPacketTransfer=4]="StartPacketTransfer",e[e.StopPacketTransfer=5]="StopPacketTransfer",e[e.UpdateDestChannel=6]="UpdateDestChannel",e[e.Reconnect=7]="Reconnect",e[e.SetVideoProfile=8]="SetVideoProfile",e}({}),Xa=function(e){return e.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",e.NETWORK_CONNECTED="NETWORK_CONNECTED",e.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",e.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",e.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",e.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",e.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",e.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",e.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",e.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",e}({}),Ei=function(e){return e.RELAY_STATE_IDLE="RELAY_STATE_IDLE",e.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",e.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",e.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",e}({}),mh=function(e){return e.RELAY_OK="RELAY_OK",e.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",e.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",e.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",e}({}),xt=function(e){return e.High="high",e.Low="low",e.Audio="audio",e.Screen="screen",e.ScreenLow="screen_low",e}({}),nr=function(e){return e.DISCONNECT="disconnect",e.CONNECTION_STATE_CHANGE="connection-state-change",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGE="stream-type-change",e.IS_P2P_DISCONNECTED="is-p2p-dis",e.DISCONNECT_P2P="dis-p2p",e.REQUEST_NEW_GATEWAY_LIST="req-gate-url",e.NEED_RENEW_SESSION="need-sid",e.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",e.JOIN_RESPONSE="join-response",e.RESET_CONNECTION_EVENTS="reset-connection-events",e.PRE_CONNECT_PC="pre-connect_pc",e.UPDATE_GATEWAY_CONFIG="update-gateway-config",e}({}),JE=function(e){return e.P2P_DISCONNECTED="P2P_DISCONNECTED",e.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",e.TIMEOUT="TIMEOUT",e.UNKNOWN_REASON="UNKNOWN_REASON",e}({}),Jn=function(e){return e[e.Nothing=0]="Nothing",e[e.Audio=1]="Audio",e[e.LwoVideo=2]="LwoVideo",e[e.Video=4]="Video",e[e.Data=8]="Data",e[e.DataStream0=256]="DataStream0",e[e.DataStream1=512]="DataStream1",e[e.DataStream2=1024]="DataStream2",e[e.DataStream3=2048]="DataStream3",e[e.DataStream4=4096]="DataStream4",e[e.DataStream5=8192]="DataStream5",e[e.DataStream6=16384]="DataStream6",e[e.DataStream7=32768]="DataStream7",e}({}),Pt=function(e){return e.CHINA="CHINA",e.ASIA="ASIA",e.NORTH_AMERICA="NORTH_AMERICA",e.EUROPE="EUROPE",e.JAPAN="JAPAN",e.INDIA="INDIA",e.KOREA="KOREA",e.HKMC="HKMC",e.US="US",e.OCEANIA="OCEANIA",e.SOUTH_AMERICA="SOUTH_AMERICA",e.AFRICA="AFRICA",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="EXTENSIONS",e}({});const Uj=[Pt.AFRICA,Pt.ASIA,Pt.CHINA,Pt.EUROPE,Pt.GLOBAL,Pt.INDIA,Pt.JAPAN,Pt.NORTH_AMERICA,Pt.OCEANIA,Pt.OVERSEA,Pt.SOUTH_AMERICA];let Ar=function(e){return e.CHINA="CN",e.ASIA="AS",e.NORTH_AMERICA="NA",e.EUROPE="EU",e.JAPAN="JP",e.INDIA="IN",e.KOREA="KR",e.HKMC="HK",e.US="US",e.OCEANIA="OC",e.SOUTH_AMERICA="SA",e.AFRICA="AF",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="GLOBAL",e}({});const QE={CHINA:{},ASIA:{CODE:Ar.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:Ar.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:Ar.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:Ar.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:Ar.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:Ar.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:Ar.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:Ar.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:Ar.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:Ar.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:Ar.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:Ar.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:Ar.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};HR&&(QE.CHINA={CODE:Ar.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let Hf=function(e){return e.UPDATE_BITRATE_LIMIT="update_bitrate_limit",e.UPDATE_CLIENT_ROLE_OPTIONS="update_client_role_options",e}({});function jj(e){return!!e&&!(!e.uplink||!e.id)&&e.uplink.max_bitrate!==void 0&&e.uplink.min_bitrate!==void 0}class Vj extends pn{constructor(t,n){super(),x(this,"onICEConnectionStateChange",void 0),x(this,"onConnectionStateChange",void 0),x(this,"onDTLSTransportStateChange",void 0),x(this,"onDTLSTransportError",void 0),x(this,"onICETransportStateChange",void 0),x(this,"onFirstAudioReceived",void 0),x(this,"onFirstVideoReceived",void 0),x(this,"onFirstAudioDecoded",void 0),x(this,"onFirstVideoDecoded",void 0),x(this,"onFirstVideoDecodedTimeout",void 0),x(this,"onSelectedLocalCandidateChanged",void 0),x(this,"onSelectedRemoteCandidateChanged",void 0),x(this,"onICECandidateError",void 0),x(this,"getLocalVideoStats",void 0)}}class Fj extends Vj{constructor(t,n){super(t,n),x(this,"establishPromise",void 0)}}let Re=function(e){return e.VIDEO="video",e.AUDIO="audio",e}({}),Nr=function(e){return e.UDP_RELAY="udp_relay",e.UDP_TCP_RELAY="udp_tcp_relay",e.TCP_RELAY="tcp_relay",e.RELAY="relay",e}({}),$a=function(e){return e[e.FIRST_CONNECTION=0]="FIRST_CONNECTION",e[e.UDP_TCP_RESTART=1]="UDP_TCP_RESTART",e[e.RELAY_RESTART=2]="RELAY_RESTART",e[e.TCP_RESTART=3]="TCP_RESTART",e[e.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",e[e.OLD_RESTART=11]="OLD_RESTART",e[e.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",e}({});const Bj=["disconnected","failed"];let de=function(e){return e.LocalVideoTrack="videoTrack",e.LocalAudioTrack="audioTrack",e.LocalVideoLowTrack="videoLowTrack",e}({}),kt=function(e){return e.New="new",e.Connected="connected",e.Reconnecting="reconnecting",e.Disconnected="disconnected",e}({}),Me=function(e){return e.AudioMetadata="audioMetadata",e.StateChange="stateChange",e.IceConnectionStateChange="iceConnectionStateChange",e.RequestMuteLocal="requestMuteLocal",e.RequestUnmuteLocal="requestUnmuteLocal",e.RequestRePublish="requestRePublish",e.RequestRePublishDataChannel="requestRePublishDataChannel",e.RequestReSubscribe="requestReSubscribe",e.RequestUploadStats="requestUploadStats",e.RequestUpload="requestUpload",e.MediaReconnectStart="MediaReconnectStart",e.MediaReconnectEnd="MediaReconnectEnd",e.NeedSignalRTT="NeedSignalRTT",e.RequestRestartICE="RequestRestartIce",e.PeerConnectionStateChange="PeerConnectionStateChange",e.RequestReconnect="RequestReconnect",e.RequestReconnectPC="RequestReconnectPC",e.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",e.P2PLost="P2PLost",e.UpdateVideoEncoder="UpdateVideoEncoder",e.ConnectionTypeChange="ConnectionTypeChange",e.RequestLowStreamParameter="RequestLowStreamParameter",e.QueryClientConnectionState="QueryClientConnectionState",e.LocalCandidate="LocalCandidate",e.RequestP2PMuteLocal="requestP2PMuteLocal",e.RequestP2PUnPublish="RequestP2PUnPublish",e.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",e.RequestP2PMuteRemote="RequestP2PMuteRemote",e.RequestP2PRestartICE="RequestP2PRestartICE",e}({}),Qo=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),Zo=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),rr=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),Wj=function(e){return e.CONNECTED="transmitter:connected",e.RECONNECTING="transmitter:reconnecting",e.WILL_RECONNECT="transmitter:will_reconnect",e.CLOSED="transmitter:closed",e.FAILED="transmitter:failed",e.ON_MESSAGE="transmitter:on_message",e.REQUEST_NEW_URLS="transmitter:request_new_urls",e.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",e.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",e.FAILBACK="transmitter:failback",e.PRE_CONNECT_PC="transmitter:pre_connect_pc",e}({}),ua=function(e){return e.CAMERA_CHANGED="camera-changed",e.MICROPHONE_CHANGED="microphone-changed",e.PLAYBACK_DEVICE_CHANGED="playback-device-changed",e.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",e.AUTOPLAY_FAILED="autoplay-failed",e.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",e.SECURITY_POLICY_VIOLATION="security-policy-violation",e}({}),go=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),Is=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),gh=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),bn=function(e){return e.CALL="call",e.CANDIDATE="candidate",e.PUBLISH="publish",e.UNPUBLISH="unpublish",e.CONTROL="control",e.RESTART_ICE="restart_ice",e.ACK="ack",e.RESPONSE="response",e.JOIN="join",e.CHECK="check",e}({}),_h=function(e){return e.ABORT="abort",e}({}),Mc=function(e){return e.MUTE_LOCAL_AUDIO="mute_local_audio",e.MUTE_LOCAL_VIDEO="mute_local_video",e.UNMUTE_LOCAL_AUDIO="unmute_local_audio",e.UNMUTE_LOCAL_VIDEO="unmute_local_video",e}({}),Boe=function(e){return e.P2P_TOKEN_TIMEOUT="p2p_token_timeout",e.P2P_TOKEN_CHANGED="p2p_token_changed",e}({});const Woe={[qE.ACCESS_POINT]:{[Zr.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[Zr.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[Zr.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[Zr.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[Zr.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[Zr.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[Zr.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[Zr.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[Zr.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[Zr.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[Zr.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[Zr.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[Zr.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[Zr.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[Zr.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[Zr.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[Zr.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[Zr.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[qE.UNILBS]:{[Jo.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[Jo.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[Jo.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[Jo.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[Jo.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[Jo.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[Jo.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[Jo.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[Jo.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[Jo.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[Jo.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[Jo.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[qE.STRING_UID_ALLOCATOR]:{[vC.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[vC.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[vC.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function Eh(e){const t=Woe[Math.floor(e/1e4)];if(!t)return{desc:"unknown error",retry:!1};const n=t[e%1e4];if(!n){if(Math.floor(e/1e4)===qE.ACCESS_POINT){const o=e%1e4;if(o.toString()[0]==="1")return{desc:e.toString(),retry:!1};if(o.toString()[0]==="2")return{desc:e.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return n}const Hoe={[Be.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[Be.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[Be.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[Be.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[Be.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[Be.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[Be.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[Be.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[Be.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[Be.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[Be.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[Be.DATASTREAM2_NOT_AVAILABLE]:{desc:"DATASTREAM2_NOT_AVAILABLE",action:"quit"},[Be.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[Be.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[Be.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[Be.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[Be.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[Be.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[Be.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[Be.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[Be.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[Be.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[Be.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[Be.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[Be.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[Be.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[Be.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[Be.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[Be.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[Be.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[Be.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[Be.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[Be.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[Be.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[Be.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[Be.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[Be.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[Be.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[Be.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[Be.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[Be.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[Be.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Be.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Be.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[Be.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[Be.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[Be.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[Be.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[Be.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[Be.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[Be.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[Be.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[Be.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[Be.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[Be.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[Be.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[Be.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[Be.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[Be.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[Be.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[Be.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[Be.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[Be.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[Be.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function Gf(e){return Hoe[e]||{desc:"UNKNOWN_ERROR_".concat(e),action:"failed"}}function Hj(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,o)}return n}function wC(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Hj(Object(n),!0).forEach(function(o){x(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Hj(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}function RC(e,t){if(typeof e=="string")return e;const{proxy:n,host:o,port:s}=e;if(t){const c=H("JOIN_GATEWAY_FALLBACK_PORT")||443;return c===443?"wss://".concat(o,"/ws/?p=").concat(Number(s)+150):"wss://".concat(o,":").concat(c,"/ws/?p=").concat(Number(s)+150)}return n?"wss://".concat(n,"/ws/?h=").concat(o,"&p=").concat(s):"wss://".concat(o,":").concat(s)}const Goe=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,zoe=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,Koe=/wss:\/\/(.+):([0-9]+)\/?/,Yoe=/wss:\/\/(.[^\/]+)\/?/;let qoe=0;class Xoe{constructor(t,n){x(this,"id",0),x(this,"store",void 0),x(this,"recordIndex",void 0),x(this,"websockets",[]),x(this,"try443PortDuration",2e3),x(this,"forceCloseWSDuration",5e3),x(this,"try443PortTimeout",null),x(this,"forceCloseTimeout",null),x(this,"isTry443PortFailed",!1),x(this,"isNormalPortFailed",!1),x(this,"useDoubleDomain",!1),x(this,"useProxy",!1),x(this,"startTime",Date.now()),this.id=++qoe,this.try443PortDuration=H("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=t||5e3,this.store=n}closeAllWebsockets(){this.websockets.forEach(t=>{t.onopen=null,t.onclose=null,t.onmessage=null,t.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout),this.forceCloseTimeout=null,this.try443PortTimeout=null}logger(){var t;const n=Date.now()-this.startTime;for(var o=arguments.length,s=new Array(o),c=0;c<o;c++)s[c]=arguments[c];R.debug("[choose-best-ws ".concat((t=this.store)===null||t===void 0?void 0:t.clientId," ").concat(this.id,"] ").concat(n,"ms:"),...s)}createWebSocket(t,n,o){this.logger("createWebSocket:",t,{isTry443Port:n,hasTimeoutDetection:o});const s=H("GATEWAY_DOMAINS"),c=Date.now(),d=[],h=s.find(y=>{var T;return Ee(T=t.host).call(T,y)});h||(this.useDoubleDomain=!1);const p=[];if(this.useDoubleDomain)s.forEach(y=>{p.push(RC(wC(wC({},t),{},{host:t.host.replace(h,y)}),n))});else{const y=wC({},t);if(n&&h){const T=s.find(P=>P!==h);T&&(y.host=y.host.replace(h,T))}p.push(RC(y,n))}try{p.forEach(y=>{const T=new WebSocket(y);T.binaryType="arraybuffer",d.push(T),this.logger("ws is connecting:",T.url)})}catch(y){if(this.logger("ws create failed"),d.forEach(T=>T.close()),d.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(t,n,o);if(!n&&Number(t.port)!==443)return this.createWebSocket(t,!0,o);throw new ee(j.WS_ERR,"init websocket failed! Error: ".concat(y.toString()))}const m=Af();this.store&&this.store.recordJoinChannelService({urls:d.map(y=>y.url),service:"gateway"},this.recordIndex),d.forEach(y=>{y.onopen=()=>{this.logger("onopen: ws ".concat(y.url," open cost ").concat(Date.now()-c,"ms")),this.websockets.forEach(T=>{T!==y&&(T.onopen=null,T.onclose=null,T.onmessage=null,T.close(),this.logger("close backup websocket: ".concat(T.url)))}),this.websockets.length=0,m.resolve(y)},y.onclose=T=>{this.logger("onclose: ws ".concat(y.url," closed cost ").concat(Date.now()-c,"ms state: ").concat(y.readyState));const P=d.every(I=>I.readyState===WebSocket.CLOSED||I.readyState===WebSocket.CLOSING);this.logger("".concat(n?"443":"47xx"," websocket closed, all failed: ").concat(P)),P&&(n||this.isTry443PortFailed||this.useProxy)?(this.logger("onclose: all websocket is closed, ".concat(T.reason)),m.reject({code:T.code,reason:JE.A_ROUND_WS_FAILED})):!n&&P&&!this.isNormalPortFailed&&this.try443PortTimeout&&(this.logger("all 47xx websocket is closed, try 443 port"),this.clearTimeout(),E()),n?this.isTry443PortFailed=P:this.isNormalPortFailed=P},y.onmessage=T=>this.logger("".concat(y.url," onmessage: ").concat(T.data))}),this.websockets.push(...d);const g=()=>{this.websockets.forEach(y=>y.readyState!==WebSocket.OPEN&&y.close())},E=()=>{if(m.isResolved)return g();wt().os===Xn.MAC_OS&&gn()&&g(),this.createWebSocket(t,!0,!0).then(y=>{m.resolve(y)}).catch(y=>{this.isNormalPortFailed&&m.reject(y),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",m.isResolved),this.forceCloseTimeout=null,g()},this.forceCloseWSDuration)};return o||(()=>{if(n||this.useProxy)return this.logger("add 5s timeout at ".concat(n?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(()=>{this.forceCloseTimeout=null,g()},this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{this.logger("2s timeout, isWebsocket created: ",m.isResolved),this.try443PortTimeout=null,E()},this.try443PortDuration)})(),m.promise}chooseBestWebsocket(t,n,o,s){return this.useDoubleDomain=!!n,typeof t=="string"&&(t=function(c){let d,h,p;return[,d,h,p]=c.match(Goe)||[],d||([,h,p]=c.match(zoe)||[]),h&&p||([,h,p]=c.match(Koe)||[]),h&&p||([,h]=c.match(Yoe)||[]),h||R.warning("un-destructible url: ",c),{proxy:d,host:h,port:p||"443"}}(t)),this.recordIndex=s,this.useProxy=!!t.proxy,o&&this.useProxy&&(R.warn("cannot use 443 only when use proxy"),o=!1),this.createWebSocket(t,!!o,!1).finally(()=>this.clearTimeout())}}function Gj(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,o)}return n}class zj extends pn{get url(){return this.websocket&&this.websocket.url||this._websocketUrl}get reconnectMode(){return this._reconnectMode}set reconnectMode(t){var n;Ee(n=["tryNext","recover"]).call(n,t)&&this.resetReconnectCount(t),this._reconnectMode=t}get state(){return this._state}set state(t){t!==this._state&&(this._state=t,this._state==="reconnecting"?this.emit(tt.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(tt.CONNECTED):this._state==="closed"?this.emit(tt.CLOSED):this._state==="failed"&&this.emit(tt.FAILED))}resetReconnectCount(t){R.debug("websocket reset reconnect count, reason: "+t),this.reconnectCount=0}constructor(t,n){let o=arguments.length>2&&arguments[2]!==void 0&&arguments[2],s=arguments.length>3&&arguments[3]!==void 0&&arguments[3],c=arguments.length>4&&arguments[4]!==void 0&&arguments[4],d=arguments.length>5?arguments[5]:void 0;super(),x(this,"_websocketUrl",null),x(this,"connectionID",0),x(this,"currentURLIndex",0),x(this,"urls",[]),x(this,"_reconnectMode","tryNext"),x(this,"reconnectReason",void 0),x(this,"_initMutex",void 0),x(this,"name",void 0),x(this,"_state","closed"),x(this,"reconnectInterrupter",void 0),x(this,"websocket",void 0),x(this,"retryConfig",void 0),x(this,"reconnectCount",0),x(this,"forceCloseTimeout",5e3),x(this,"onlineReconnectListener",void 0),x(this,"useCompress",void 0),x(this,"tryDoubleDomain",!1),x(this,"use443PortOnly",!1),x(this,"wsInflateLength",0),x(this,"wsDeflateLength",0),x(this,"closeEstablishingWs",()=>{}),x(this,"store",void 0),x(this,"joinGatewayRecordIndex",void 0),this.store=d,this.name=t,this.retryConfig=function(E){for(var y=1;y<arguments.length;y++){var T=arguments[y]!=null?arguments[y]:{};y%2?Gj(Object(T),!0).forEach(function(P){x(E,P,T[P])}):Object.getOwnPropertyDescriptors?Object.defineProperties(E,Object.getOwnPropertyDescriptors(T)):Gj(Object(T)).forEach(function(P){Object.defineProperty(E,P,Object.getOwnPropertyDescriptor(T,P))})}return E}({},n),this.useCompress=o,this.tryDoubleDomain=s,this.use443PortOnly=c,this._initMutex=new Ir("websocket",d?d.clientId:void 0);const{timeout:h,timeoutFactor:p}=n,m=Math.max(300,Math.floor(3*h/5)),g=Math.max(1.2,Math.floor(8*p)/10);xi.ONLINE&&(this.retryConfig.timeout=m,this.retryConfig.timeoutFactor=g),On.on(Ju.NETWORK_STATE_CHANGE,(E,y)=>{E!==y&&(this.resetReconnectCount("network state change: ".concat(y," -> ").concat(E)),E===xi.ONLINE?(this.retryConfig.timeout=m,this.retryConfig.timeoutFactor=g):(this.retryConfig.timeout=h,this.retryConfig.timeoutFactor=p))})}getConnection(){return this.websocket||void 0}async init(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const o=await this._initMutex.lock();this._reconnectMode="tryNext",this.forceCloseTimeout=n,this.urls=t,this.state="connecting";try{const s=Af(),c=this.urls[this.currentURLIndex];H("ENABLE_PREALLOC_PC")&&this.emit(Wj.PRE_CONNECT_PC),this.createWebSocketConnection(c).then(s.resolve).catch(s.reject),this.once(tt.CLOSED,()=>{s.reject(new re(j.WS_DISCONNECT))}),this.once(tt.CONNECTED,s.resolve),await s.promise}catch{}finally{o()}}close(t,n){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const o=this.websocket;n?setTimeout(()=>o.close(),500):o.close(),this.websocket=void 0,this._websocketUrl=null}this.state=t?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(t,n){if(!this.websocket)return void R.warning("[".concat(this.name,"] can not reconnect, no websocket"));t!==void 0&&(this.reconnectMode=t),R.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(n)]},this.joinGatewayRecordIndex);const o=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),o&&o.bind(this.websocket)({code:9999,reason:n})}sendMessage(t){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new re(j.WS_ABORT,"websocket is not ready");try{n||(t=JSON.stringify(t)),this.websocket.send(t)}catch(o){throw new re(j.WS_ERR,"send websocket message error"+o.toString())}}setWsInflateData(t){this.wsDeflateLength=this.wsDeflateLength+t.originLength,this.wsInflateLength=this.wsInflateLength+t.compressedLength}getWsInflateData(){const t=this.wsInflateLength,n=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:t,wsDeflateLength:n}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(t){var n;const o=Af();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;const s=g=>{var E;(E=this.store)===null||E===void 0||E.signalChannelOpen(),R.debug("[".concat(this.name,"] websocket opened:"),g),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),o.resolve()},c=async g=>{var E;if(R.debug("[".concat(this.name,"] websocket close ").concat((E=this.websocket)===null||E===void 0?void 0:E.url,", code: ").concat(g.code,", reason: ").concat(g.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)o.reject(new re(j.WS_DISCONNECT,"websocket close: ".concat(g.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=g.reason,this.state="reconnecting");const y=Yi(this,tt.WILL_RECONNECT,this.reconnectMode,g.reason)||this.reconnectMode,T=await this.reconnectWithAction(y);if(this.state==="closed")return void R.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!T)return o.reject(new re(j.WS_DISCONNECT,"websocket reconnect failed: ".concat(g.code))),this.close(!0);o.resolve()}},d=g=>{this.emit(tt.ON_MESSAGE,g)},h=g=>{R.warn("[".concat(this.connectionID,"] ws open error ").concat(g))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),H("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(t=H("GATEWAY_WSS_ADDRESS")),R.debug("[".concat(this.name,"] start connect, url:"),t);const p=(n=this.store)===null||n===void 0?void 0:n.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var m;this._websocketUrl=RC(t);const g=await this.chooseBestWebsocketConnection(t);this.websocket=g,s&&s(this.websocket.url),this.websocket.onclose=c,this.websocket.onmessage=d,this.websocket.onerror=h,(m=this.store)===null||m===void 0||m.recordJoinChannelService({endTs:Date.now(),status:"success"},p),this.joinGatewayRecordIndex=p}catch(g){const E=this.state==="closed",y=g instanceof re,T=y&&g.code===j.WS_ABORT,P=y&&g.code===j.WS_ERR,I=y?g.message:g&&(g.reason||g.toString());R.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(I)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:T?"aborted":"error",errors:[g]},p),E||P?(o.reject(E?new re(j.WS_DISCONNECT,"websocket is closed: ".concat(I)):new re(j.WS_ERR,"init websocket failed: ".concat(I))),P&&R.error("[".concat(this.name,"] init websocket failed: ").concat(I))):c&&c(g)}return o.promise}async reconnectWithAction(t){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;R.warning("[choose-best-ws] action: =>",t),this.onlineReconnectListener||On.isOnline||!On.onlineWaiter||(this.onlineReconnectListener=On.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let o=!0;if(this.reconnectInterrupter=()=>o=!1,n){const d=LR(this.reconnectCount,this.retryConfig);R.debug("[".concat(this.name,"] wait ").concat(d,"ms to reconnect websocket, mode: ").concat(t)),await ye.race([cr(d),this.onlineReconnectListener||new ye(()=>{})])}if(this._state==="closed"||!o)return!1;this.reconnectCount+=1;const s=async(d,h)=>{this.emit(tt.RECONNECT_CREATE_CONNECTION,h),await this.createWebSocketConnection(d)};try{if(t==="retry")await s(this.urls[this.currentURLIndex],t);else if(t==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);R.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),await s(this.urls[this.currentURLIndex],t)}else t==="recover"&&(R.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.urls=await Er(this,tt.REQUEST_NEW_URLS),this.currentURLIndex=0,await s(this.urls[this.currentURLIndex],t))}catch(d){var c;R.error("[".concat(this.name,"] reconnect failed ").concat(d&&d.toString()));const h=d==null||(c=d.data)===null||c===void 0?void 0:c.desc;return Array.isArray(h)&&Ee(h).call(h,"dynamic key expired")?(this.emit(tt.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(t,n)}return!0}}class CC extends zj{constructor(t,n){super(t,n,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(t,n){const o=Af(),s=function(d,h){return new Xoe(d,h)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{R.debug("[choose-best-ws] close establishing websockets"),s.closeAllWebsockets(),o.reject(new re(j.WS_ABORT,"choose best websocket aborted"))};const c=H("GATEWAY_DOMAINS");return R.debug("[choose-best-ws] currentDomain: ",t,", domains: ",c,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),s.chooseBestWebsocket(t,this.tryDoubleDomain,this.use443PortOnly,n).then(o.resolve).catch(o.reject),o.promise.finally(()=>{this.closeEstablishingWs=void 0})}}class zf extends zj{constructor(t,n){super(t,n,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(t,n){return new ye((o,s)=>{let c=!1;const d=[];this.closeEstablishingWs=()=>{R.debug("[choose-best-ws] close establishing websockets"),d.forEach(P=>{P.onclose=null,P.onopen=null,P.onmessage=null,P.close()}),s(new re(j.WS_ABORT,"choose best websocket aborted"))};const h=H("GATEWAY_DOMAINS");let p;const m=t.indexOf("?h="),g=h.find(P=>m!==-1?Ee(t).call(t,P,m):Ee(t).call(t,P));R.debug("[choose-best-ws] currentDomain: ",g,", domains: ",h);let E=!this.tryDoubleDomain||!g;if(!E&&g){var y;const P=Date.now();try{h.forEach(I=>{const A=m===-1?t.replace(g,I):t.substr(0,m)+t.substr(m).replace(g,I),M=new WebSocket(A);M.binaryType="arraybuffer",d.push(M),R.debug("[choose-best-ws] ws is connecting:",M.url)})}catch{for(R.debug("[choose-best-ws] ws create failed, fallback to single url"),d.forEach(A=>A.close());d.length;)d.pop();E=!0}(y=this.store)===null||y===void 0||y.recordJoinChannelService({urls:d.map(I=>I.url),service:"gateway"},n),d.forEach(I=>{I.onopen=()=>{if(c)return;const A=Date.now()-P;R.debug("[choose-best-ws] ws open cost ".concat(A,"ms")),d.filter(M=>M!==I).forEach(M=>{R.debug("[choose-best-ws]close backup websocket: ".concat(M.url)),M.close()}),c=!0,o(I)},I.onclose=A=>{p=A,!c&&(d.find(M=>!(M.readyState===WebSocket.CLOSED||M.readyState===WebSocket.CLOSING))||(R.debug("[choose-best-ws] all websocket is closed"),c=!0,s(p)))},I.onmessage=A=>{R.debug("[choose-best-ws]".concat(I.url," onmessage: ").concat(A.data))}}),cr(this.forceCloseTimeout).then(()=>{d.forEach(I=>{I.readyState!==WebSocket.OPEN&&I.close()})})}if(E){var T;let P;R.debug("[choose-best-ws] use single url: ",t),(T=this.store)===null||T===void 0||T.recordJoinChannelService({urls:[t],service:"gateway"},n);try{P=new WebSocket(t),d.push(P),P.binaryType="arraybuffer"}catch(I){const A=new re(j.WS_ERR,"init websocket failed! Error: ".concat(I.toString()));return R.error("[".concat(this.name,"]").concat(A)),void s(A)}P.onopen=()=>{o(P)},P.onclose=I=>{s(I)},P.onmessage=I=>{R.debug("[choose-best-ws]".concat(P.url," onmessage: ").concat(I.data))},cr(this.forceCloseTimeout).then(()=>{P&&P.readyState!==WebSocket.OPEN&&P.close()})}}).then(o=>(this.closeEstablishingWs=void 0,o)).catch(o=>{throw this.closeEstablishingWs=void 0,o})}}class $oe extends pn{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===en.CONNECTED?this.emit($e.WS_CONNECTED):t===en.RECONNECTING?this.emit($e.WS_RECONNECTING,this._websocketReconnectReason):t===en.CLOSED&&this.emit($e.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(t,n){super(),x(this,"_disconnectedReason",void 0),x(this,"_websocketReconnectReason",void 0),x(this,"_connectionState",en.CLOSED),x(this,"reconnectToken",void 0),x(this,"websocket",void 0),x(this,"openConnectionTime",void 0),x(this,"clientId",void 0),x(this,"lastMsgTime",Date.now()),x(this,"uploadCache",[]),x(this,"uploadCacheInterval",void 0),x(this,"rttRolling",new nM(5)),x(this,"pingpongTimer",void 0),x(this,"wsInflateDataTimer",void 0),x(this,"pingpongTimeoutCount",0),x(this,"joinResponse",void 0),x(this,"multiIpOption",void 0),x(this,"initError",void 0),x(this,"spec",void 0),x(this,"store",void 0),x(this,"onWebsocketMessage",o=>{if(o.data instanceof ArrayBuffer)return void this.emit($e.ON_BINARY_DATA,o.data);const s=JSON.parse(o.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(s,"_id")){const c="res-@".concat(s._id);this.emit(c,s._result,s._message)}else if(Object.prototype.hasOwnProperty.call(s,"_type")){if(this.emit(s._type,s._message),s._type===_t.ON_NOTIFICATION&&this.handleNotification(s._message),s._type===_t.ON_USER_BANNED)switch(s._message.error_code){case 14:this.close(Dt.UID_BANNED);break;case 15:this.close(Dt.IP_BANNED);break;case 16:this.close(Dt.CHANNEL_BANNED)}if(s._type===_t.ON_USER_LICENSE_BANNED)switch(s._message.error_code){case Be.ERR_LICENSE_MISSING:this.close(Dt.LICENSE_MISSING);break;case Be.ERR_LICENSE_EXPIRED:this.close(Dt.LICENSE_EXPIRED);break;case Be.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Dt.LICENSE_MINUTES_EXCEEDED);break;case Be.ERR_LICENSE_PERIOD_INVALID:this.close(Dt.LICENSE_PERIOD_INVALID);break;case Be.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Dt.LICENSE_MULTIPLE_SDK_SERVICE);break;case Be.ERR_LICENSE_ILLEGAL:this.close(Dt.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=t.clientId,this.spec=t,this.store=n,this.websocket=new CC("gateway-".concat(this.clientId),this.spec.retryConfig,!0,H("JOIN_GATEWAY_USE_DUAL_DOMAIN"),H("JOIN_GATEWAY_USE_443PORT_ONLY"),n),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===en.CONNECTED&&this.reconnect("retry",_r.OFFLINE)})}async request(t,n,o,s){const c=Jt(6,""),d={_id:c,_type:t,_message:n},h=this.websocket.connectionID,p=()=>new ye((P,I)=>{if(this.connectionState===en.CONNECTED)return P();const A=()=>{this.off($e.WS_CLOSED,M),P()},M=()=>{this.off($e.WS_CONNECTED,A),I(new ee(j.WS_ABORT))};this.once($e.WS_CONNECTED,A),this.once($e.WS_CLOSED,M),t!==Ye.PUBLISH&&t!==Ye.PUBLISH_DATASTREAM&&t!==Ye.SUBSCRIBE&&t!==Ye.SUBSCRIBE_DATASTREAM&&t!==Ye.UNSUBSCRIBE&&t!==Ye.UNSUBSCRIBE_DATASTREAM&&t!==Ye.UNPUBLISH&&t!==Ye.UNPUBLISH_DATASTREAM&&t!==Ye.CONTROL&&t!==Ye.RESTART_ICE||this.once($e.DISCONNECT_P2P,()=>{I(new ee(j.DISCONNECT_P2P))}),t!==Ye.PUBLISH&&t!==Ye.RESTART_ICE||this.once($e.ABORT_P2P_EXECUTION,()=>{I(new ee(j.DISCONNECT_P2P))})});if(this.connectionState!==en.CONNECTING&&this.connectionState!==en.RECONNECTING||t===Ye.JOIN||t===Ye.REJOIN||await p(),this.websocket.sendMessage(d,!0),s)return;const m=new ye((P,I)=>{let A=!1;const M=(Y,Q)=>{A=!0,P({isSuccess:Y==="success",message:Q||{}}),this.off($e.WS_CLOSED,U),this.off($e.WS_RECONNECTING,U),this.emit($e.REQUEST_SUCCESS,t,n)};this.once("res-@".concat(c),M);const U=()=>{I(new ee(j.WS_ABORT,"type: ".concat(t))),this.off($e.WS_CLOSED,U),this.off($e.WS_RECONNECTING,U),this.off("res-@".concat(c),M)};this.once($e.WS_CLOSED,U),this.once($e.WS_RECONNECTING,U),cr(H("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==h||A||(R.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(t)),this.emit($e.REQUEST_TIMEOUT,t,n))})});let g=null;try{g=await m}catch(P){if(this.connectionState===en.CLOSED||t===Ye.LEAVE)throw new ee(j.WS_ABORT);return!this.spec.forceWaitGatewayResponse||o?P.throw():t===Ye.JOIN||t===Ye.REJOIN?null:(await p(),await this.request(t,n))}if(g.isSuccess)return g.message;const E=Number(g.message.error_code||g.message.code),y=Gf(E),T=new ee(j.UNEXPECTED_RESPONSE,"".concat(y.desc,": ").concat(g.message.error_str),{code:E,data:g.message,desc:y.desc});return y.action==="success"?g.message:(R.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(E,", message: ").concat(y.desc,", action: ").concat(y.action)),E===Be.ERR_TOO_MANY_BROADCASTERS?((t===Ye.JOIN||t===Ye.REJOIN)&&(this.initError=T,this.close()),T.throw()):y.action==="failed"?T.throw():y.action==="quit"?(this.initError=T,this.close(),T.throw()):(E===Be.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=g.message.option,R.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",_r.MULTI_IP)):this.reconnect(y.action,_r.SERVER_ERROR),t===Ye.JOIN||t===Ye.REJOIN?null:await this.request(t,n)))}waitMessage(t,n){return new ye(o=>{const s=c=>{(!n||n(c))&&(this.off(t,s),o(c))};this.on(t,s)})}uploadWRTCStats(t){if(!this.store.sessionId)return void R.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const n={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload(Wf.WRTC_STATS,n)}upload(t,n){const o={_type:t,_message:n};try{this.websocket.sendMessage(o)}catch{const c=H("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(o),this.uploadCache.length>c&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==en.CONNECTED)return;const d=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(d._type,d._message)},H("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,n){const o={_type:t,_message:n};this.websocket.sendMessage(o)}init(t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new ye((n,o)=>{this.once($e.WS_CONNECTED,()=>n(this.joinResponse)),this.once($e.WS_CLOSED,s=>o(this.initError||new ee(j.WS_ABORT,s))),this.connectionState=en.CONNECTING,this.websocket.init(t).catch(o),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=t||Dt.LEAVE,this.connectionState=en.CLOSED,R.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit($e.ABORT_P2P_EXECUTION);const t=await Er(this,$e.REQUEST_JOIN_INFO),n=await this.request(Ye.JOIN,t);if(!n)return this.emit($e.REPORT_JOIN_GATEWAY,JE.TIMEOUT,this.url||""),!1;this.joinResponse=n,this.emit($e.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=en.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new ee(j.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const t=xf(this,$e.REQUEST_REJOIN_INFO);t.token=this.reconnectToken;const n=await this.request(Ye.REJOIN,t);return!!n&&(this.connectionState=en.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),n.peers&&n.peers.forEach(o=>{this.emit(_t.ON_USER_ONLINE,{uid:o.uid}),o.audio&&this.emit(_t.ON_ADD_AUDIO_STREAM,{uid:o.uid,uint_id:o.uint_id,audio:!0,ssrcId:o.audio_ssrc}),o.video&&this.emit(_t.ON_ADD_VIDEO_STREAM,{uid:o.uid,uint_id:o.uint_id,video:!0,ssrcId:o.video_ssrc}),o.audio_mute?this.emit(_t.MUTE_AUDIO,{uid:o.uid}):this.emit(_t.UNMUTE_AUDIO,{uid:o.uid}),o.video_mute?this.emit(_t.MUTE_VIDEO,{uid:o.uid}):this.emit(_t.UNMUTE_VIDEO,{uid:o.uid}),o.audio_enable_local?this.emit(_t.ENABLE_LOCAL_AUDIO,{uid:o.uid}):this.emit(_t.DISABLE_LOCAL_AUDIO,{uid:o.uid}),o.video_enable_local?this.emit(_t.ENABLE_LOCAL_VIDEO,{uid:o.uid}):this.emit(_t.DISABLE_LOCAL_VIDEO,{uid:o.uid}),o.audio||o.video||this.emit(_t.ON_REMOVE_STREAM,{uid:o.uid,uint_id:o.uint_id})}),!0)}reconnect(t,n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,n)}handleNotification(t){R.debug("[".concat(this.clientId,"] receive notification: "),t);const n=Gf(t.code);if(t.code===28&&"detail"in t&&(R.info("[".concat(this.clientId,"] receive recover notification: "),t.detail),this.emit($e.RECOVER_NOTIFICATION,t.detail)),n.action!=="success"){if(n.action!=="failed")return n.action==="quit"?(n.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Dt.UID_BANNED),void this.close()):void this.reconnect(n.action,_r.SERVER_ERROR);R.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const t=H("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=t&&(R.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>H("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",_r.TIMEOUT):this.request(Ye.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const o=Date.now()-n;this.rttRolling.add(o),H("REPORT_STATS")&&this.send(Ye.PING_BACK,{pingpongElapse:o})}).catch(o=>{})}handleWsInflateData(){const{wsInflateLength:t,wsDeflateLength:n}=this.websocket.getWsInflateData();t!==0&&n!==0&&this.upload(Wf.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:n,ws_inflate_length:t})}handleWebsocketEvents(){this.websocket.on(tt.RECONNECT_CREATE_CONNECTION,t=>{this.emit($e.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(tt.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(tt.CLOSED,()=>{this.connectionState=en.CLOSED}),this.websocket.on(tt.FAILED,()=>{this._disconnectedReason=Dt.NETWORK_ERROR,this.connectionState=en.CLOSED}),this.websocket.on(tt.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===en.CONNECTED?this.connectionState=en.RECONNECTING:this.connectionState=en.CONNECTING}),this.websocket.on(tt.WILL_RECONNECT,(t,n,o)=>{const s=xf(this,$e.IS_P2P_DISCONNECTED),c=s||t!=="retry";s&&t==="retry"&&(R.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),t="tryNext",n=JE.P2P_DISCONNECTED),c&&(R.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(t)),this.emit($e.REPORT_JOIN_GATEWAY,n||JE.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit($e.DISCONNECT_P2P)),o(t)}),this.websocket.on(tt.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(t=>{R.warning("[".concat(this.clientId,"] rejoin failed ").concat(t)),this.reconnect("tryNext",_r.SERVER_ERROR)}):this.join().catch(t=>{if(this.emit($e.REPORT_JOIN_GATEWAY,t,this.url||""),t instanceof ee){if(t.code===j.UNEXPECTED_RESPONSE&&t.data.code===Be.ERR_NO_AUTHORIZED)return this.initError=new ee(j.TOKEN_EXPIRE,"dynamic key expired"),void this.close(Dt.TOKEN_EXPIRE);R.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",_r.SERVER_ERROR):(this.initError=t,this.close())}})}),this.websocket.on(tt.REQUEST_NEW_URLS,(t,n)=>{Er(this,$e.REQUEST_RECOVER,this.multiIpOption).then(t).catch(n)}),this.websocket.on(tt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(_t.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(Wj.PRE_CONNECT_PC,()=>{this.emit($e.PRE_CONNECT_PC)})}}let Joe=function(e){return e.NATIVE_RTC="native_rtc",e.NATIVE_RTM="native_rtm",e.WEB_RTC="web_rtc",e.WEB_RTM="web_rtm",e}({}),Pn=function(e){return e[e.CHOOSE_SERVER=11]="CHOOSE_SERVER",e[e.CLOUD_PROXY=18]="CLOUD_PROXY",e[e.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",e[e.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",e}({});function Kj(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,o)}return n}function ZE(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Kj(Object(n),!0).forEach(function(o){x(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Kj(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}function Uc(e){return e.match(/^[\.\:\d]+$/)?"".concat(e.replace(/[^\d]/g,"-"),".").concat(H("TURN_DOMAIN")):(R.debug("Cannot recognized as ip address: ".concat(e,", use as host")),e)}function bC(e,t){e.addresses||(e.addresses=[]);const n=function(h,p){if(H("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return h.map(E=>{let{ip:y,port:T}=E;return{address:"".concat(y,":").concat(T)}});const m=H("GATEWAY_DOMAINS");let g=m[1]&&Ee(p).call(p,m[1])?1:0;return h.map(E=>{let{domain_prefix:y,port:T,ip:P}=E;if(y)return{address:"".concat(y,".").concat(m[g++%m.length],":").concat(T)};const I=/^[\.\:\d]+$/.test(P),A=I?"".concat(P.replace(/[^\d]/g,"-"),".").concat(m[g++%m.length],":").concat(T):"".concat(P,":").concat(T);return I||R.debug("Cannot recognized as ip address: ".concat(P,", use as host")),{ip:P,port:T,address:A}})}(e.addresses,t),o=Array.isArray(e.detail)&&e.detail[18];if(o&&typeof o=="string"){const h=o.split(";");for(let p=0;p<h.length;p++){var s;const m=Hr(s=h[p]).call(s);n[p]&&m&&(n[p].ip6=m)}}const c=e.detail&&e.detail.candidate;let d;if(c){const[h,p]=c.split(":");h&&p&&(d={port:Number(p),ip:h,address:"".concat(h,":").concat(p)})}return{gatewayAddrs:n,apGatewayAddress:d,uid:e.uid,cid:e.cid,cert:e.cert,vid:e.detail&&e.detail[8],uni_lbs_ip:e.detail&&e.detail[1],res:e,csIp:e.detail&&e.detail[502]}}function Li(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function Yj(e){const t=e._encoderConfig;if(!t)return{};const n={resolution:t.width&&t.height?"".concat(Li(t.width),"x").concat(Li(t.height)):void 0,maxVideoBW:t.bitrateMax,minVideoBW:t.bitrateMin};return typeof t.frameRate=="number"?(n.maxFrameRate=t.frameRate,n.minFrameRate=t.frameRate):t.frameRate&&(n.maxFrameRate=t.frameRate.max||t.frameRate.ideal||t.frameRate.exact||t.frameRate.min,n.minFrameRate=t.frameRate.min||t.frameRate.ideal||t.frameRate.exact||t.frameRate.max),n}function qj(e){return e>=0&&e<.17?1:e>=.17&&e<.36?2:e>=.36&&e<.59?3:e>=.59&&e<=1?4:e>1?5:0}function Kf(e,t){let n,o,s;switch(t){case Pn.CHOOSE_SERVER:o=4096,s="choose server";break;case Pn.CLOUD_PROXY:o=1048576,s="proxy";break;case Pn.CLOUD_PROXY_5:o=4194304,s="proxy5";break;case Pn.CLOUD_PROXY_FALLBACK:o=4194310,s="proxy fallback";break;default:throw new ee(j.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:e.detail&&e.detail[502],retry:!1})}if(e.response_body.forEach(c=>{c.buffer&&c.buffer.flag===o&&(n={code:c.buffer.code,addresses:(c.buffer.edges_services||[]).map(d=>ZE(ZE({},d),{},{ticket:c.buffer.cert})),server_ts:e.enter_ts,uid:c.buffer.uid,cid:c.buffer.cid,cname:c.buffer.cname,detail:ZE(ZE({},c.buffer.detail),e.detail),flag:c.buffer.flag,opid:e.opid,cert:c.buffer.cert})}),!n)throw new ee(j.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(s," from multi unilbs response"),{csIp:e.detail&&e.detail[502]});return n}async function Xj(e,t){return await ye.all(e.addresses.map(async n=>({address:H("USE_TURN_IP")?n.ip:Uc(n.ip),tcpport:n.port,udpport:n.port,username:t&&H("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?t.toString():vr.username,password:t&&H("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await OR(t.toString()):vr.password})))}function IC(e,t){const n=t.getMediaStreamTrack(!0).getSettings(),o=t.videoHeight||n.height,s=t.videoWidth||n.width;return o&&s?Math.max(Math.min(o,s)/Math.min(Li(e.height),Li(e.width)),1):(R.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function jc(e){let{candidateType:t,relayProtocol:n,type:o,address:s,port:c,protocol:d}=e;const h={candidateType:t,relayProtocol:n,protocol:d};if(o!=="local-candidate"){const p=s.split(".");p.length>=4&&(p[1]="*",p[2]="*"),h.address=p.join("."),h.port=c}return h}function ev(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:H("SVC_MODE");if(H("ENABLE_SVC"))return function(t){return t in OE}(e)?e:OE.L1T3}const $j={[Re.VIDEO]:[{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"},{key:"video-orientation",extensionName:"urn:3gpp:video-orientation"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"playout-delay",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"},{key:"video-content-type",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"},{key:"color-space",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/color-space"},{key:"video-timing",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing"}],[Re.AUDIO]:[{key:"ssrc-audio-level",extensionName:"urn:ietf:params:rtp-hdrext:ssrc-audio-level"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}]};function tv(e,t,n){t.forEach(o=>{var s;const c=$j[e].find(h=>{var p;let{key:m}=h;return Ee(p=o.extensionName).call(p,m)});if(!c)return;const d=n.find(h=>{let{extensionName:p}=h;return Ee(p).call(p,c.key)});d&&Ee(s=d.extensionName).call(s,"gdpr_forbidden")&&(o.extensionName=d.extensionName)})}function vh(e,t){t.forEach(n=>{var o;const s=$j[e].find(c=>{var d;let{key:h}=c;return Ee(d=n.extensionName).call(d,h)});Ee(o=n.extensionName).call(o,"gdpr_forbidden")&&s&&(n.extensionName=s.extensionName)})}function Jj(e){return e==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"||Ee(e).call(e,"abs-send-time")}function nv(e){return e==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"||Ee(e).call(e,"draft-holmer-rmcat-transport-wide-cc-extensions-01")}function Qj(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,o)}return n}function Zj(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Qj(Object(n),!0).forEach(function(o){x(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Qj(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}function Yf(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=arguments.length>3?arguments[3]:void 0;const{filterRTX:s,filterVideoFec:c,filterAudioFec:d,filterAudioCodec:h,filterVideoCodec:p}=t,{useXR:m}=n;let g=[],E=[],y=[],T=[],P=!1,I=!1;if(_i(e).mediaDescriptions.forEach(M=>{o&&o!==M.attributes.direction||(M.media.mediaType!=="video"||P||(E=M.attributes.payloads,T=M.attributes.extmaps,P=!0),M.media.mediaType!=="audio"||I||(g=M.attributes.payloads,y=M.attributes.extmaps,I=!0))}),!T||E.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!y||g.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(E.forEach(M=>{var U;(U=M.rtpMap)!==null&&U!==void 0&&U.clockRate&&(M.rtpMap.clockRate=parseInt(M.rtpMap.clockRate)),m&&M.rtcpFeedbacks.push({type:"rrtr"})}),g.forEach(M=>{var U;(U=M.rtpMap)!==null&&U!==void 0&&U.clockRate&&(M.rtpMap.clockRate=parseInt(M.rtpMap.clockRate)),m&&M.rtcpFeedbacks.push({type:"rrtr"})}),s&&(g=g.filter(M=>{var U;return((U=M.rtpMap)===null||U===void 0?void 0:U.encodingName.toLowerCase())!=="rtx"}),E=E.filter(M=>{var U;return((U=M.rtpMap)===null||U===void 0?void 0:U.encodingName.toLowerCase())!=="rtx"})),c&&(E=E.filter(M=>{var U;return!/(red)|(ulpfec)|(flexfec)/i.test(((U=M.rtpMap)===null||U===void 0?void 0:U.encodingName)||"")})),d&&(g=g.filter(M=>{var U;return!/(red)|(ulpfec)|(flexfec)/i.test(((U=M.rtpMap)===null||U===void 0?void 0:U.encodingName)||"")})),h&&(h==null?void 0:h.length)>0&&(g=g.filter(M=>{var U;return Ee(h).call(h,((U=M.rtpMap)===null||U===void 0?void 0:U.encodingName.toLowerCase())||"")})),p&&(p==null?void 0:p.length)>0){const M=E.filter(U=>{var Y;return Ee(p).call(p,((Y=U.rtpMap)===null||Y===void 0?void 0:Y.encodingName.toLowerCase())||"")});E=M.concat(s?[]:OC(M,E))}const A=H("UNSUPPORTED_VIDEO_CODEC");return A&&A.length>0&&(E=E.filter(M=>!(M.rtpMap&&Ee(A).call(A,M.rtpMap.encodingName.toLowerCase())))),{audioCodecs:g,videoCodecs:E,audioExtensions:y,videoExtensions:T}}function Vc(e){const t=_i(e);let n,o;for(const s of t.mediaDescriptions){if(!n){const c=s.attributes.iceUfrag,d=s.attributes.icePwd;if(!c||!d)throw new Error("Cannot get iceUfrag or icePwd from SDP.");n={iceUfrag:c,icePwd:d}}if(!o){const c=s.attributes.fingerprints;c.length>0&&(o={fingerprints:c})}}if(!o&&t.attributes.fingerprints.length>0&&(o={fingerprints:t.attributes.fingerprints}),!o||!n)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:n,dtlsParameters:o}}function eV(e,t){const n=[],o=e.attributes.ssrcGroups.filter(d=>d.semantic==="FID"),s=e.attributes.ssrcGroups.find(d=>d.semantic==="SIM"),c=e.attributes.ssrcs;if(s)s.ssrcIds.forEach(d=>{var h;const p=(h=o.find(m=>m.ssrcIds[0]===d))===null||h===void 0?void 0:h.ssrcIds[1];n.push({ssrcId:d,rtx:t?p:void 0})});else if(o.length>0){const d=o[0].ssrcIds[0],h=o[0].ssrcIds[1];n.push({ssrcId:d,rtx:t?h:void 0})}else{if(c.length===0)throw new Error("No ssrcs found on local media description.");n.push({ssrcId:c[0].ssrcId})}return n}function tV(e,t,n){const{cname:o}=e;let s=[];t&&(s=nV(t)),s.length===0&&(s=e.iceParameters.candidates.map(g=>({foundation:g.foundation,componentId:"1",transport:g.protocol,priority:g.priority.toString(),connectionAddress:g.ip,port:g.port.toString(),type:g.type,extension:{}})),R.debug("Using candidates from gateway."));const c={fingerprints:e.dtlsParameters.fingerprints.map(g=>({hashFunction:g.algorithm,fingerprint:g.fingerprint}))},d={iceUfrag:e.iceParameters.iceUfrag,icePwd:e.iceParameters.icePwd};let h;switch(e.dtlsParameters.role){case"server":h="passive";break;case"client":h="active";break;case"auto":h="actpass"}const p=iv(e.rtpCapabilities),m=[];return Array.isArray(n)&&n.length>0&&n.forEach(g=>{m.push({kind:Re.VIDEO,ssrcId:g.v,rtx:g.v_rtx,mslabel:"".concat(g.v,"_").concat(g.a)},{kind:Re.AUDIO,ssrcId:g.a,mslabel:"".concat(g.v,"_").concat(g.a)})}),{dtlsParameters:c,iceParameters:d,candidates:s,rtpCapabilities:p,setup:h,cname:o,preSSRCs:m}}function nV(e){let t=[];return e.ip&&typeof e.port=="number"&&(t=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip,port:e.port.toString(),type:"host",extension:{}}],R.debug("Using remote candidate from AP ".concat(e.ip,":").concat(e.port)),e.ip6&&(t.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip6,port:e.port.toString(),type:"host",extension:{}}),R.debug("Using IPV6 remote candidate from AP ".concat(e.ip6,":").concat(e.port)))),t}function fd(e,t,n){const o=[],s=[];return e.forEach(c=>{let{ssrcId:d,rtx:h}=c;const p=Jt(8,"track-"),m={ssrcId:d,attributes:Zj({label:p,mslabel:n=n||Jt(10,""),msid:"".concat(n," ").concat(p)},t&&{cname:t})};if(o.push(m),h!==void 0){const g={ssrcId:h,attributes:Zj({label:p,mslabel:n,msid:"".concat(n," ").concat(p)},t&&{cname:t})};o.push(g),s.push({semantic:"FID",ssrcIds:[d,h]})}}),e.length>1&&s.push({semantic:"SIM",ssrcIds:e.map(c=>{let{ssrcId:d}=c;return d})}),{ssrcs:o,ssrcGroups:s}}function yh(e,t){t instanceof Sn&&e.attributes.payloads.forEach(n=>{var o;const s=(o=n.rtpMap)===null||o===void 0?void 0:o.encodingName.toLowerCase();if(!s||["opus","pcmu","pcma","g722"].indexOf(s)===-1)return;n.fmtp||(n.fmtp={parameters:{}}),s==="opus"&&typeof H("OPUS_PTIME")=="number"?n.fmtp.parameters.ptime=H("OPUS_PTIME"):n.fmtp.parameters.minptime="10",n.fmtp.parameters.useinbandfec="1";const c=t._encoderConfig;c&&(s!=="pcmu"&&s!=="pcma"&&s!=="g722"&&(c.bitrate&&!gn()&&(n.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*c.bitrate))),c.sampleRate&&(n.fmtp.parameters.maxplaybackrate="".concat(c.sampleRate),n.fmtp.parameters["sprop-maxcapturerate"]="".concat(c.sampleRate)),c.stereo&&(n.fmtp.parameters.stereo="1",n.fmtp.parameters["sprop-stereo"]="1")),t instanceof Ff&&s==="opus"&&t._config.DTX&&(n.fmtp.parameters.usedtx="1"))})}function AC(e){const t=e.attributes.unrecognized.findIndex(n=>n.attField==="x-google-flag"&&n.attValue==="conference");t!==-1&&e.attributes.unrecognized.splice(t,1)}function NC(e,t){var n;if(!(t instanceof nn&&t._encoderConfig&&t._hints.indexOf(Gt.SCREEN_TRACK)===-1))return;const o=t._encoderConfig;Rt().supportMinBitrate&&o.bitrateMin&&e.attributes.payloads.forEach(s=>{var c,d;Ee(c=["h264","h265","vp8","vp9","av1"]).call(c,((d=s.rtpMap)===null||d===void 0?void 0:d.encodingName.toLowerCase())||"")&&(s.fmtp||(s.fmtp={parameters:{}}),s.fmtp.parameters["x-google-min-bitrate"]="".concat(o.bitrateMin))}),Rt().supportMinBitrate&&!Ee(n=t._hints).call(n,Gt.LOW_STREAM)&&o.bitrateMax&&e.attributes.payloads.forEach(s=>{var c,d;Ee(c=["h264","h265","vp8","vp9","av1"]).call(c,((d=s.rtpMap)===null||d===void 0?void 0:d.encodingName.toLowerCase())||"")&&(s.fmtp||(s.fmtp={parameters:{}}),s.fmtp.parameters["x-google-start-bitrate"]="".concat(H("X_GOOGLE_START_BITRATE")||Math.floor(o.bitrateMax)))})}function rV(e){if(e.media.mediaType!=="video")return;const t=wt();if(t.name!==Ot.SAFARI&&t.os!==Xn.IOS)return;const n=e.attributes.extmaps.findIndex(o=>/video-orientation/g.test(o.extensionName));n!==-1&&e.attributes.extmaps.splice(n,1)}function rv(e,t,n){if(!t)return;let o,s;if(e.media.mediaType==="video"?(o=n.videoExtensions,s=n.videoCodecs):(o=n.audioExtensions,s=n.audioCodecs),t.twcc===!0){const c=o.find(d=>nv(d.extensionName));if(c){const d=c.extensionName;e.attributes.extmaps.find(p=>nv(p.extensionName))||e.attributes.extmaps.push({entry:c.entry,extensionName:d}),function(p,m){return m.filter(g=>!!p.find(E=>E.payloadType===g.payloadType&&!!E.rtcpFeedbacks.find(y=>y.type==="transport-cc")))}(s,e.attributes.payloads).forEach(p=>{p.rtcpFeedbacks.find(m=>m.type==="transport-cc")||p.rtcpFeedbacks.push({type:"transport-cc"})})}}else if(t.twcc===!1){const c=e.attributes.extmaps.findIndex(d=>nv(d.extensionName));c!==-1&&e.attributes.extmaps.splice(c,1),e.attributes.payloads.forEach(d=>{const h=d.rtcpFeedbacks.findIndex(p=>p.type==="transport-cc");h!==-1&&d.rtcpFeedbacks.splice(h,1)})}if(t.remb===!0){const c=o.find(d=>Jj(d.extensionName));if(c){const d=c.extensionName;e.attributes.extmaps.find(p=>p.extensionName===d)||e.attributes.extmaps.push({entry:c.entry,extensionName:d}),function(p,m){return m.filter(g=>!!p.find(E=>E.payloadType===g.payloadType&&!!E.rtcpFeedbacks.find(y=>y.type==="goog-remb")))}(s,e.attributes.payloads).forEach(p=>{p.rtcpFeedbacks.find(m=>m.type==="goog-remb")||p.rtcpFeedbacks.push({type:"goog-remb"})})}}else if(t.remb===!1){const c=e.attributes.extmaps.findIndex(d=>Jj(d.extensionName));c!==-1&&e.attributes.extmaps.splice(c,1),e.attributes.payloads.forEach(d=>{const h=d.rtcpFeedbacks.findIndex(p=>p.type==="goog-remb");h!==-1&&d.rtcpFeedbacks.splice(h,1)})}}function iV(e,t,n){if(gn()||e.media.mediaType!=="video"||!(t instanceof nn)||n!=="vp9"&&n!=="vp8"||n==="vp8"&&!H("SIMULCAST")||n==="vp9"&&H("ENABLE_SVC")||t._scalabilityMode===void 0||t._scalabilityMode.numSpatialLayers<=1)return;const o=n==="vp8"?2:t._scalabilityMode.numSpatialLayers,s=e.attributes.ssrcs[0],c=e.attributes.ssrcGroups.find(h=>h.semantic==="FID"&&h.ssrcIds[0]===s.ssrcId),d={semantic:"SIM",ssrcIds:[s.ssrcId]};for(let h=1;h<o;h++)e.attributes.ssrcs.push({ssrcId:s.ssrcId+h,attributes:fn(s.attributes)}),d.ssrcIds.push(s.ssrcId+h),c&&(e.attributes.ssrcs.push({ssrcId:c.ssrcIds[1]+h,attributes:fn(s.attributes)}),e.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[s.ssrcId+h,c.ssrcIds[1]+h]}));e.attributes.ssrcGroups.unshift(d)}async function oV(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=new RTCPeerConnection;n.addTransceiver("video",{direction:"sendonly"}),n.addTransceiver("audio",{direction:"sendonly"}),n.addTransceiver("video",{direction:"recvonly"}),n.addTransceiver("audio",{direction:"recvonly"});const o=(await n.createOffer()).sdp,{send:s,recv:c,sendrecv:d}=function(){let h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},m=arguments.length>2?arguments[2]:void 0;const g=Yf(m,h,p,"sendonly"),E=Yf(m,h,p,"recvonly"),y={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},T={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},P={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(es(g,E,"videoExtensions",y,T,P),es(g,E,"videoCodecs",y,T,P),es(g,E,"audioExtensions",y,T,P),es(g,E,"audioCodecs",y,T,P),H("RAISE_H264_BASELINE_PRIORITY")){const I=[],A=[];P.videoCodecs.forEach((M,U)=>{var Y;if(((Y=M.rtpMap)===null||Y===void 0?void 0:Y.encodingName.toLocaleLowerCase())==="h264"){var Q,J;const X=P.videoCodecs[U+1],ne=X&&dV(M,X),oe=(Q=M.fmtp)===null||Q===void 0?void 0:Q.parameters["profile-level-id"],me=(J=M.fmtp)===null||J===void 0?void 0:J.parameters["packetization-mode"];!oe||oe!==H("FIRST_H264_PROFILE_LEVEL_ID")||H("FIRST_PACKETIZATION_MODE")&&me!==H("FIRST_PACKETIZATION_MODE")?ne?A.push([M,X]):A.push([M]):ne?I.push([M,X]):I.push([M])}}),I.length>0&&A.length>0&&(R.debug("raising H264 baseline profile priority"),P.videoCodecs.forEach((M,U)=>{var Y;if(((Y=M.rtpMap)===null||Y===void 0?void 0:Y.encodingName.toLocaleLowerCase())==="h264"){const Q=dV(M,P.videoCodecs[U+1]),J=I.shift()||A.shift()||[];J.length>0&&(Q?P.videoCodecs.splice(U,2,...J):P.videoCodecs.splice(U,1,...J))}}),T.videoCodecs=T.videoCodecs.filter(M=>{var U,Y;return!(((U=M.rtpMap)===null||U===void 0?void 0:U.encodingName.toLocaleLowerCase())==="h264"&&((Y=M.fmtp)===null||Y===void 0?void 0:Y.parameters["profile-level-id"])!==H("FIRST_H264_PROFILE_LEVEL_ID"))}),H("FILTER_SEND_H264_BASELINE")&&(y.videoCodecs=y.videoCodecs.filter(M=>{var U,Y;return!(((U=M.rtpMap)===null||U===void 0?void 0:U.encodingName.toLocaleLowerCase())==="h264"&&((Y=M.fmtp)===null||Y===void 0?void 0:Y.parameters["profile-level-id"])!==H("FIRST_H264_PROFILE_LEVEL_ID"))})))}return{send:y,recv:T,sendrecv:P}}(e,t,o);try{n.close()}catch{}return{send:s,recv:c,sendrecv:d}}function sV(){const e={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},t=Yf(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),n={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},o={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},s={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(es(e,t,"videoExtensions",n,o,s),es(e,t,"videoCodecs",n,o,s),es(e,t,"audioExtensions",n,o,s),es(e,t,"audioCodecs",n,o,s),H("RAISE_H264_BASELINE_PRIORITY")){const c=s.videoCodecs.findIndex(d=>d.rtpMap&&d.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&d.fmtp&&d.fmtp.parameters["profile-level-id"]==="42001f");if(c!==-1){const d=s.videoCodecs.findIndex(h=>h.rtpMap&&h.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(d<c){R.debug("raising H264 baseline profile priority");const h=s.videoCodecs[c];s.videoCodecs.splice(c,1),s.videoCodecs.splice(d,0,h)}d!==-1&&(o.videoCodecs=o.videoCodecs.filter(h=>!(h.rtpMap&&h.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&h.fmtp&&h.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:n,recv:o,sendrecv:s}}function es(e,t,n,o,s,c){if(n==="videoExtensions"||n==="audioExtensions"){const d=[];return e[n].forEach(h=>{t[n].some((p,m)=>{if(h.entry===p.entry&&h.extensionName===p.extensionName)return d.push(m),!0})?c[n].push(h):o[n].push(h)}),void t[n].forEach((h,p)=>{d.indexOf(p)===-1&&s[n].push(h)})}if(n==="videoCodecs"||n==="audioCodecs"){const d=[];return e[n].forEach(h=>{t[n].some((p,m)=>{if(h.payloadType===p.payloadType&&JSON.stringify(h)===JSON.stringify(p))return d.push(m),!0})?c[n].push(h):o[n].push(h)}),void t[n].forEach((h,p)=>{d.indexOf(p)===-1&&s[n].push(h)})}}function iv(e){const{send:t,recv:n,sendrecv:o}=e;if(!o){if(!t||!n)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:t,recv:n}}let s,c;return t?(s={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},s.audioCodecs=[...t.audioCodecs,...o.audioCodecs],s.videoCodecs=[...t.videoCodecs,...o.videoCodecs],s.audioExtensions=[...t.audioExtensions,...o.audioExtensions],s.videoExtensions=[...t.videoExtensions,...o.videoExtensions]):s=o,n?(c={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},c.audioCodecs=[...n.audioCodecs,...o.audioCodecs],c.videoCodecs=[...n.videoCodecs,...o.videoCodecs],c.audioExtensions=[...n.audioExtensions,...o.audioExtensions],c.videoExtensions=[...n.videoExtensions,...o.videoExtensions]):c=o,{send:s,recv:c}}function Sh(e){e.media.mediaType==="audio"&&e.attributes.payloads.filter(t=>{var n;return((n=t.rtpMap)===null||n===void 0?void 0:n.encodingName.toLowerCase())==="opus"}).forEach(t=>{t.fmtp||(t.fmtp={parameters:{}}),t.fmtp.parameters.stereo="1",t.fmtp.parameters["sprop-stereo"]="1"})}function qf(e,t,n,o){let s=[];if(e===Re.VIDEO){if(H("H264_PROFILE_LEVEL_ID")&&o==="h264"&&(s=t.videoCodecs.filter(c=>{var d;return Ee(d=c.rtpMap&&c.rtpMap.encodingName.toLowerCase()||"").call(d,o)&&c&&c.fmtp&&c.fmtp.parameters["profile-level-id"]===H("H264_PROFILE_LEVEL_ID")})),!Array.isArray(s)||s.length===0){let c=[];const d=[],h=[],p=[];if(n.videoCodecs.forEach(m=>{const g=m.rtpMap&&m.rtpMap.encodingName.toLowerCase()||"";Ee(g).call(g,o)?c.push(m):Ee(g).call(g,"vp9")?d.push(m):Ee(g).call(g,"vp8")?h.push(m):Ee(g).call(g,"h264")&&p.push(m)}),c.length===0){let m="";d.length!==0?(c=d,m="vp9"):h.length!==0?(c=h,m="vp8"):p.length!==0&&(c=p,m="h264"),R.warning("codec ".concat(o," not included in rtpCapabilities, fallback to default payloads: ").concat(m))}c.length!==0&&(s=t.videoCodecs.filter(m=>c.some(g=>g.payloadType===m.payloadType)))}if(s.length===0&&(R.warning("codec ".concat(o," not included in rtpCapabilities, fallback to default payloads: ").concat(t.videoCodecs[0].rtpMap&&t.videoCodecs[0].rtpMap.encodingName)),s=t.videoCodecs),H("USE_PUB_RTX")||H("USE_SUB_RTX")){const c=OC(s,t.videoCodecs);s=[...s,...c]}}else{s=t.audioCodecs.filter(d=>{var h;return Ee(h=d.rtpMap&&d.rtpMap.encodingName.toLowerCase()||"").call(h,o)});const c=t.audioCodecs.filter(d=>{var h;return Ee(h=d.rtpMap&&d.rtpMap.encodingName.toLowerCase()||"").call(h,"red")});s.length===0&&(R.warning("codec ".concat(o," not included in rtpCapabilities, fallback to opus")),s=t.audioCodecs.filter(d=>{var h;return Ee(h=d.rtpMap&&d.rtpMap.encodingName.toLowerCase()||"").call(h,"opus")})),H("ENABLE_AUDIO_RED")&&c.length!==0&&(s=[...c,...s])}return s}function OC(e,t){const n=e.map(o=>o.payloadType.toString());return t.filter(o=>o.rtpMap&&o.rtpMap.encodingName==="rtx"&&o.fmtp&&o.fmtp.parameters.apt&&Ee(n).call(n,o.fmtp&&o.fmtp.parameters.apt))}async function Xf(e,t,n){const o=t.toString(),s=cV(o,"offer","remote","exchangeSDP");await e.setRemoteDescription({type:"offer",sdp:o});const c=await e.createAnswer();if(!c.sdp)throw new Error("cannot get answer sdp");let d=c.sdp;d=aV(d,n||{}),s==null||s(d||""),await e.setLocalDescription({type:"answer",sdp:d})}function aV(e,t,n){const o=_i(e),{useXR:s}=t;return o.mediaDescriptions.forEach(c=>{var d;c.attributes.mid&&(Array.isArray(n)&&!Ee(n).call(n,c.attributes.mid)||(c.media.mediaType==="audio"&&Sh(c),s&&Ee(d=["audio","video"]).call(d,c.media.mediaType)&&c.attributes.payloads.forEach(h=>{h.rtcpFeedbacks.findIndex(p=>p.type==="rrtr")===-1&&h.rtcpFeedbacks.push({type:"rrtr"})})))}),xc(o)}function cV(e,t,n,o){if(H("SDP_LOGGING"))return R.upload("exchanging ".concat(n," ").concat(t," SDP during P2PConnection.").concat(o,`
`),e),t==="offer"?s=>{cV(s,"answer",n==="local"?"remote":"local",o)}:void 0}function lV(e){const t=H("COMPATIBLE_SDP_EXTENSION");return!!(Array.isArray(t)&&t.length>0)&&t.some(n=>Ee(e).call(e,n))}function dV(e,t){try{var n;return((n=e.fmtp)===null||n===void 0?void 0:n.parameters.apt)===t.payloadType.toString()}catch{return!1}}function uV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,o)}return n}function Mi(e,t){return typeof H(e)===t?H(e):void 0}function Qoe(){try{const e=H("EXPERIMENTS")||{};return typeof e=="string"||Array.isArray(e)?{}:function(t){for(var n=1;n<arguments.length;n++){var o=arguments[n]!=null?arguments[n]:{};n%2?uV(Object(o),!0).forEach(function(s){x(t,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):uV(Object(o)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(o,s))})}return t}({},e)}catch(e){return R.debug("handle gateway attributes failed: ",e),{}}}const hV={};function Fc(e){(!(arguments.length>1&&arguments[1]!==void 0)||arguments[1])&&R.debug("install service ".concat(e.name)),hV[e.name]=e}function Ja(e){const t=hV[e];if(!t)throw new re(j.INVALID_OPERATION,"".concat(e," not found, please use AgoraRTC.use(").concat(e,"Service) to load it first"));return t}function pV(e,t){return Ja("DataStream").create(e,t)}function ov(){return Ja("InterceptFrame").create()}function fV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,o)}return n}function ha(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?fV(Object(n),!0).forEach(function(o){x(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):fV(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}const PC=new Map;class Zoe extends pn{get state(){return this._state}set state(t){if(t===this._state)return;const n=this._state;this._state=t,t==="DISCONNECTED"&&this._disconnectedReason?this.emit(nr.CONNECTION_STATE_CHANGE,t,n,this._disconnectedReason):this.emit(nr.CONNECTION_STATE_CHANGE,t,n)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(t){R.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(t)),this._joinGatewayStartTime=t}constructor(t,n){var o,s,c;super(),x(this,"store",void 0),x(this,"joinInfo",void 0),x(this,"key",void 0),x(this,"ntpOffset",0),x(this,"signal",void 0),x(this,"role",void 0),x(this,"inChannelInfo",{joinAt:null,duration:0}),x(this,"spec",void 0),x(this,"_state","DISCONNECTED"),x(this,"_statsCollector",void 0),x(this,"_disconnectedReason",void 0),x(this,"isSignalRecover",!1),x(this,"hasChangeBGPAddress",!1),x(this,"trafficStatsInterval",void 0),x(this,"networkQualityInterval",void 0),x(this,"_joinGatewayStartTime",0),x(this,"_signalTimeout",!1),x(this,"_clientRoleOptions",void 0),x(this,"_isProactiveJoin",!1),this.store=t,this.spec=n,this.signal=this.store.useP2P?(o={spec:ha(ha({},n),{},{retryConfig:n.websocketRetryConfig}),store:t},(s=(c=Ja("P2PChannel")).createSubmodule)===null||s===void 0?void 0:s.call(c,o)):new $oe(ha(ha({},n),{},{retryConfig:n.websocketRetryConfig}),t),this._statsCollector=n.statsCollector,this.role=n.role||"audience",this._clientRoleOptions=n.clientRoleOptions,this.handleSignalEvents()}async join(t,n,o){this.store.joinGatewayStart(),t.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const s=Date.now();let c=PC.get(t.cname);if(c||(c=new Map,PC.set(t.cname,c)),this._isProactiveJoin=!0,c.has(t.uid)){const m=new ee(j.UID_CONFLICT);throw ke.joinGateway(t.sid,{lts:s,succ:!1,ec:m.code,addr:null,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,isProxy:!!t.proxyServer,signalChannel:"0",preload:t.preload}),m}c.set(t.uid,!0),this.joinInfo=t,this.key=n;let d=0;this.joinGatewayStartTime=s;const h=t.proxyServer;try{R.debug("[".concat(this.store.clientId,"] use websocket join uid ").concat(d));const m=t.gatewayAddrs.map(g=>{let{address:E}=g;const[y,T]=E.split(":"),P={host:y,port:T};return t.proxyServer&&(P.proxy=t.proxyServer),P});d=(await this.signal.init(m)).uid,R.debug("[".concat(this.store.clientId,"] websocket join uid ").concat(d," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(m){var p;throw R.error("[".concat(this.store.clientId,"] User join failed"),m.toString()),ke.joinGateway(t.sid,{lts:s,succ:!1,ec:((p=m.data)===null||p===void 0?void 0:p.desc)||m.code,errorMsg:m.message,addr:this.signal.url,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,isProxy:!!h,signalChannel:"0",preload:t.preload}),c.delete(t.uid),this.signal.close(),m}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),R.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(m=>{R.warning("[".concat(this.store.clientId,"] get traffic stats error"),m.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(nr.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(nr.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(nr.NETWORK_QUALITY,{uplinkNetworkQuality:qj(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:qj(this._statsCollector.trafficStats.B_dnq)}):this.emit(nr.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),d}async leave(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0],n=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){n!==Dt.FALLBACK&&(this.state="DISCONNECTING");try{t||this.signal.connectionState!==en.CONNECTED||await function(o,s){return s===1/0?o:ye.race([o,wie(s)])}(this.signal.request(Ye.LEAVE,void 0,!0),3e3)}catch(o){R.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),o)}this.signal.close(n),n!==Dt.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(t,n,o){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ee(j.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const s={state:"offer",p2p_id:this.store.p2pId,ortc:n,mode:this.spec.mode,extend:H("PUB_EXTEND"),twcc:!!H("PUBLISH_TWCC"),rtx:!!H("USE_PUB_RTX")};try{return(await this.signal.request(Ye.PUBLISH,s,!0))._message}catch(c){if(o&&c.data&&c.data.code===Be.ERR_PUBLISH_REQUEST_INVALID)return R.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),c.toString()),await this.tryUnpubBeforeRepub(t,n),this.publish(t,n,!1);throw c}}async publishDataChannel(t,n,o){var s;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ee(j.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const c={stream_id:n.streamId,ordered:n.ordered?1:0,max_retrans_times:(s=n.maxRetransmits)!==null&&s!==void 0?s:10,channel_id:n.channelId,metadata:n.metadata};try{await this.signal.request(Ye.PUBLISH_DATASTREAM,c,!0)}catch(d){if(o&&d.data&&d.data.code===Be.ERR_PUBLISH_REQUEST_INVALID)return R.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),d.toString()),await this.tryUnpubDataChannelBeforeRepub(t,n),this.publishDataChannel(t,n,!1);throw d}}async unpublish(t,n){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ee(j.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(Ye.UNPUBLISH,{stream_id:n,ortc:t},!0)}catch(o){R.warning("[".concat(this.store.clientId,"] unpublish warning: "),o)}}async unpublishDataChannel(t){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ee(j.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await ye.all(t.map(n=>this.signal.request(Ye.UNPUBLISH_DATASTREAM,{channel_id:n},!0)))}catch(n){R.warning("unpublish datachannels warning: ",n)}}async presubscribe(t,n,o){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ee(j.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));const s={stream_id:t,stream_type:n,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!H("SUBSCRIBE_TWCC"),rtx:!!H("USE_SUB_RTX")||void 0,extend:H("SUB_EXTEND"),svc:Array.isArray(H("SVC"))&&H("SVC").length!==0?H("SVC"):void 0};try{return await this.signal.request(Ye.PRE_SUBSCRIBE,s,!0)}catch(c){if(o&&c.data&&c.data.code===Be.ERR_SUBSCRIBE_REQUEST_INVALID)return R.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),c.toString()),this.presubscribe(t,n,!1);throw c}}async subscribe(t,n,o){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ee(j.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const s={stream_id:t,stream_type:n.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!H("SUBSCRIBE_TWCC"),rtx:!!H("USE_SUB_RTX"),extend:H("SUB_EXTEND"),ssrcId:n.ssrcId,svc:Array.isArray(H("SVC"))&&H("SVC").length!==0?H("SVC"):void 0};try{return(await this.signal.request(Ye.SUBSCRIBE,s,!0))._message}catch(c){if(o&&c.data&&c.data.code===Be.ERR_SUBSCRIBE_REQUEST_INVALID)return R.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),c.toString()),await this.tryUnsubBeforeResub(t,n),await this.subscribe(t,n,!1);throw c}}async subscribeDataChannel(t,n,o){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ee(j.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));const s={uid:t,stream_id:n.id,channel_id:n.datachannelId};try{return void await this.signal.request(Ye.SUBSCRIBE_DATASTREAM,s,!0)}catch(c){if(o&&c.data&&c.data.code===Be.ERR_SUBSCRIBE_REQUEST_INVALID)return R.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),c.toString()),await this.tryUnsubDataChannelBeforeResub(t,n),await this.subscribeDataChannel(t,n,!1);throw c}}async subscribeAll(t,n){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ee(j.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const o={p2p_id:this.store.p2pId,users:t,dtx:!1,rtx:!!H("USE_SUB_RTX"),twcc:!!H("SUBSCRIBE_TWCC"),svc:Array.isArray(H("SVC"))&&H("SVC").length!==0?H("SVC"):void 0};try{return await this.signal.request(Ye.SUBSCRIBE_STREAMS,o,!0)}catch(s){if(n&&s.data&&s.data.code===Be.ERR_SUBSCRIBE_REQUEST_INVALID)return R.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),s.toString()),await this.tryMassUnsubBeforeResub(t),await this.subscribeAll(t,!1);throw s}}async setVideoProfile(t){const n=function(o){if(!(o.bitrateMax&&o.bitrateMin&&o.frameRate&&o.height&&o.width))return;let s=o.frameRate,c=o.width,d=o.height,h=!0;return typeof s!="number"&&(s=s.exact||s.ideal||s.max||s.min||0,s||(h=!1)),typeof c!="number"&&(c=c.exact||c.ideal||c.max||c.min||0,c||(h=!1)),typeof d!="number"&&(d=d.exact||d.ideal||d.max||d.min||0,s||(h=!1)),h?{stream_type:0,width:c,height:d,fps:s,start_bps:1e3*o.bitrateMax,min_bps:1e3*o.bitrateMin,target_bps:1e3*o.bitrateMax}:void 0}(t);if(n)return this.signal.request(Ye.SET_VIDEO_PROFILE,n);R.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(t,n){try{await this.signal.request(Ye.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:t,stream_id:n},!0)}catch(o){R.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),o)}}async unsubscribeDataChannel(t,n){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ee(j.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await ye.all(t.map(o=>this.signal.request(Ye.UNSUBSCRIBE_DATASTREAM,{stream_id:o,uid:n},!0)))}catch(o){R.warning("unsubscribeDataChannel warning: ",o)}}async massUnsubscribe(t){try{await this.signal.request(Ye.UNSUBSCRIBE_STREAMS,t,!0)}catch(n){R.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),n)}}async reconnectPC(t){const{iceParameters:n,dtlsParameters:o,rtpCapabilities:s}=t;return{gatewayEstablishParams:await this.signal.request(Ye.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:n,dtlsParameters:o,rtpCapabilities:s}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(Ye.GATEWAY_INFO)}async renewToken(t){await this.signal.request(Ye.RENEW_TOKEN,t),this.key=t.token}updateClientRole(t,n){n&&(this._clientRoleOptions=Object.assign({},n)),H("CLIENT_ROLE_OPTIONS")&&(R.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(H("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," ")),this._clientRoleOptions=Object.assign({},H("CLIENT_ROLE_OPTIONS"))),this.role=t}async setClientRole(t,n){if(n&&(this._clientRoleOptions=Object.assign({},n)),H("CLIENT_ROLE_OPTIONS")&&(this._clientRoleOptions=Object.assign({},H("CLIENT_ROLE_OPTIONS")),R.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(H("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," "))),this.state!=="CONNECTED")return void(this.role=t);let o,s=0;t==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(o=this._clientRoleOptions.delay,s=1):s=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:s=0,await this.signal.request(Ye.SET_CLIENT_ROLE,{role:t,level:s,delay:o,client_ts:Date.now()}),this.role=t}async setRemoteVideoStreamType(t,n){await this.signal.request(Ye.SWITCH_VIDEO_STREAM,{stream_id:t,stream_type:n})}async setDefaultRemoteVideoStreamType(t){await this.signal.request(Ye.DEFAULT_VIDEO_STREAM,{stream_type:t})}async setStreamFallbackOption(t,n){await this.signal.request(Ye.SET_FALLBACK_OPTION,{stream_id:t,fallback_type:n})}async pickSVCLayer(t,n){await this.signal.request(Ye.PICK_SVC_LAYER,{stream_id:t,spatial_layer:n.spatialLayer,temporal_layer:n.temporalLayer})}async setRTM2Flag(t){await this.signal.request(Ye.SET_RTM2_FLAG,{rtm2_flag:t})}async sendExtensionMessage(t,n,o){if(this.store.useP2P)return this.signal.sendExtensionMessage(t,n,o)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),ha({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(Ye.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const t=PC.get(this.joinInfo.cname);t&&t.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const t=function(n){let o;return o=n.startsWith("dc")?n.match(/(dc\:\/\/)?([^:]+):(\d+)/):n.match(/(wss\:\/\/)?([^:]+):(\d+)/),o?{username:vr.username,password:vr.password,turnServerURL:o[2],tcpport:parseInt(o[3])+30,udpport:parseInt(o[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],t&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(ha(ha({},vr),{},{turnServerURL:t.turnServerURL,tcpport:t.tcpport,udpport:t.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;const t=await this.signal.request(Ye.TRAFFIC_STATS,void 0,!0);t.timestamp=Date.now(),t.ntp_offset!=null&&(this.ntpOffset=t.ntp_offset),t.peer_delay.forEach(n=>{const o=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(s=>s.peer_uid===n.peer_uid);o&&o.B_st!==n.B_st&&bE(()=>{this.emit(nr.STREAM_TYPE_CHANGE,n.peer_uid,n.B_st)})}),this._statsCollector.updateTrafficStats(t)}getJoinMessage(t){var n;if(!this.joinInfo||!this.key)throw new ee(j.UNEXPECTED_ERROR,"can not generate join message, no join info");const o=Object.assign({},this.joinInfo.apResponse);let s=H("REPORT_APP_SCENARIO");if(typeof s!="string")try{s=JSON.stringify(s)}catch{s=void 0}var c;s&&s.length>128&&(s=void 0),this.store.hasStartJoinChannel=!0,this.store.isABTestSuccess||this.emit(nr.UPDATE_GATEWAY_CONFIG),c=this.store.clientId,Ee(fh).call(fh,c)||fh.push(c);const d=!(gn()||P2(87)||yM())&&typeof H("ENABLE_PRE_SUB")=="boolean"&&H("ENABLE_PRE_SUB"),h=!yM()&&Mi("ENABLE_PREALLOC_PC","boolean"),p=Qoe(),m=Nf(87)||function(){const E=wt();if(E.name!==Ot.SAFARI||!E.browserVersion)return!1;const y=E.browserVersion.split(".");return Number(y[0])>15||Number(y[0])===15&&Number(y[1])>=4}(),g=ha({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:po,browser:navigator.userAgent,process_id:H("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:o,extend:H("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:s,attributes:{userAttributes:ha(ha({enableEncodedTransform:!!H("ENABLE_AUDIO_METADATA")&&m||!!H("ENABLE_AUDIO_TOPN")&&TR(Ot.CHROME,87,116)||void 0,enableAudioMetadata:!!H("ENABLE_AUDIO_METADATA")&&m,enableAudioPts:!!H("ENABLE_AUDIO_PTS_METADATA")&&m,topnSmoothLevel:H("TOPN_SMOOTH_LEVEL"),topnNewSpeakerDelay:H("TOPN_NEW_SPEAKER_DELAY"),topnSwitchHoldMs:H("TOPN_SWITCH_HOLD_MS"),topnAudioGain:H("TOPN_AUDIO_GAIN"),enablePublishedUserList:H("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:H("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:Mi("SUBSCRIBE_AUDIO_FILTER_TOPN","number"),enablePublishAudioFilter:Mi("ENABLE_PUBLISH_AUDIO_FILTER","boolean"),enableUserLicenseCheck:Mi("ENABLE_USER_LICENSE_CHECK","boolean"),enableRTX:H("USE_PUB_RTX")===!0||H("USE_SUB_RTX")===!0||void 0,disableFEC:H("DISABLE_FEC"),enableNTPReport:!!H("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:!!H("ENABLE_INSTANT_VIDEO")||void 0,enableFulllinkAvSync:!!H("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:Mi("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!H("ENABLE_AUT_FEEDBACK")||void 0,rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!H("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:Mi("USE_XR","boolean"),enableLossbasedBwe:Mi("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!H("ENABLE_AUT_CC")||void 0,enableCCFallback:Mi("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:h,preSubNum:d?Mi("PRE_SUB_NUM","number"):void 0,enablePubTWCC:Mi("PUBLISH_TWCC","boolean"),enableSubTWCC:Mi("SUBSCRIBE_TWCC","boolean"),enablePubRTX:Mi("USE_PUB_RTX","boolean"),enableSubRTX:Mi("USE_SUB_RTX","boolean"),enableSubSVC:H("ENABLE_SVC")?H("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(H("SVC"))&&H("SVC").length!==0?H("SVC"):void 0,enableSvcExtended:H("ENABLE_SVC")&&Array.isArray(H("SVC_EXTENDED"))&&H("SVC_EXTENDED").length!==0?H("SVC_EXTENDED"):void 0},p),{},{audioDuplicate:Mi("ENABLE_AUDIO_RED","boolean")?(n=Mi("AUDIO_DUPLICATE_NUM","number"))!==null&&n!==void 0?n:2:void 0})},join_ts:this.joinGatewayStartTime},t);return this.joinInfo.stringUid&&(g.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(g.aes_mode=this.joinInfo.aesmode,H("ENCRYPT_AES")?(g.aes_secret=this.joinInfo.aespassword,g.aes_encrypt=!0):g.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(g.aes_salt=this.joinInfo.aessalt)),o.addresses[this.signal.websocket.currentURLIndex]&&(g.ap_response.ticket=o.addresses[this.signal.websocket.currentURLIndex].ticket,delete o.addresses),this.joinInfo.defaultVideoStream!==void 0&&(g.default_video_stream=this.joinInfo.defaultVideoStream),g}getRejoinMessage(){if(!this.joinInfo)throw new ee(j.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on($e.WS_RECONNECT_CREATE_CONNECTION,t=>{this.joinGatewayStartTime=Date.now()}),this.signal.on($e.WS_RECONNECTING,t=>{this.joinInfo&&ke.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:t||_r.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",ke.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on($e.WS_CLOSED,t=>{let n;switch(t){case Dt.LEAVE:n=_r.LEAVE;break;case Dt.UID_BANNED:case Dt.IP_BANNED:case Dt.CHANNEL_BANNED:case Dt.SERVER_ERROR:n=_r.SERVER_ERROR;break;case Dt.FALLBACK:n=_r.FALLBACK;break;case Dt.LICENSE_MISSING:case Dt.LICENSE_EXPIRED:case Dt.LICENSE_MINUTES_EXCEEDED:case Dt.LICENSE_PERIOD_INVALID:case Dt.LICENSE_MULTIPLE_SDK_SERVICE:case Dt.LICENSE_ILLEGAL:case Dt.TOKEN_EXPIRE:n=t;break;default:n=_r.NETWORK_ERROR}R.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(n||"undefined -> "+_r.NETWORK_ERROR)),this.joinInfo&&ke.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:t===Dt.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:n}),this._disconnectedReason=t,t!==Dt.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on($e.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo){if(this.role==="audience"){const t=H("CLIENT_ROLE_OPTIONS")||this._clientRoleOptions;t&&(t.level||t.delay)&&(R.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(t.level,", delay: ").concat(t.delay)),this.setClientRole(this.role,t))}if(ke.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload,isABTestSuccess:this.store.isABTestSuccess}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1){const t=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!t)return void R.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(t));jt("EVENT_REPORT_DOMAIN",t[1]),jt("EVENT_REPORT_BACKUP_DOMAIN",t[1]),jt("LOG_UPLOAD_SERVER","".concat(t[1],":6444"))}}}),this.signal.on(_t.ON_UPLINK_STATS,t=>{this._statsCollector.updateUplinkStats(t)}),this.signal.on($e.REQUEST_RECOVER,(t,n,o)=>{if(!this.joinInfo)return o(new ee(j.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));t&&(this.joinInfo.multiIP=t,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,Er(this,nr.REQUEST_NEW_GATEWAY_LIST).then(n).catch(o)}),this.signal.on($e.REQUEST_JOIN_INFO,async(t,n,o)=>{var s;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void t(this.getJoinMessage({ortc:{}}));const c=fn((s=this.joinInfo)===null||s===void 0?void 0:s.turnServer);if(H("NEW_TURN_MODE")&&c){let m=c.servers,g=c.serversFromGateway;const E=this.signal.currentURLIndex;m.length>0&&(m=[m[E%m.length]],c.servers=m),Array.isArray(g)&&g.length>0&&(g=[g[0]],c.serversFromGateway=g),R.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(E))}const{iceParameters:d,dtlsParameters:h,rtpCapabilities:p}=await Er(this,nr.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:c});try{t(this.getJoinMessage({ortc:{iceParameters:d,dtlsParameters:h,rtpCapabilities:p,version:"2"}}))}catch(m){n(m)}}),this.signal.on($e.REQUEST_REJOIN_INFO,t=>{t(this.getRejoinMessage())}),this.signal.on($e.REPORT_JOIN_GATEWAY,(t,n)=>{if(!this.joinInfo)return;let o,s="";var c;t instanceof ee?(o=((c=t.data)===null||c===void 0?void 0:c.desc)||t.code,s=t.message):o=t,ke.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:o,errorMsg:s,addr:n,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload})}),this.signal.on($e.IS_P2P_DISCONNECTED,t=>{t(xf(this,nr.IS_P2P_DISCONNECTED))}),this.signal.on($e.DISCONNECT_P2P,()=>{this.emit(nr.DISCONNECT_P2P)}),this.signal.on($e.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on($e.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on($e.JOIN_RESPONSE,t=>{const n=this.getCurrentGatewayAddress();this.emit(nr.JOIN_RESPONSE,t,n)}),this.signal.on($e.PRE_CONNECT_PC,async()=>{if(this.joinInfo){this.updateTurnConfigFromSignal();const t=this.getCurrentGatewayAddress(),n=H("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(t&&n){const o=nV(t);this.emit(nr.PRE_CONNECT_PC,{candidates:o,fingerprint:n})}}}),this.signal.on($e.RECOVER_NOTIFICATION,t=>{this.joinInfo&&typeof H("AP_REQUEST_DETAIL")=="string"&&(this.joinInfo.apRequestDetail="".concat(H("AP_REQUEST_DETAIL"),";").concat(t))})}async tryUnsubBeforeResub(t,n){try{await this.signal.request(Ye.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:t,ortc:[n]},!0)}catch(o){throw R.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),o),o}}async tryUnsubDataChannelBeforeResub(t,n){try{await this.signal.request(Ye.UNSUBSCRIBE,{stream_id:n.id},!0)}catch(o){throw R.warning("unsubscribe datachannel warning",o),o}}async tryUnpubBeforeRepub(t,n){try{await this.signal.request(Ye.UNPUBLISH,{stream_id:t,ortc:n},!0)}catch(o){throw R.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),o),o}}async tryUnpubDataChannelBeforeRepub(t,n){try{await this.signal.request(Ye.UNPUBLISH_DATASTREAM,{channnel_id:n.channelId},!0)}catch(o){throw R.warning("unpublish datastream warning: ",o),o}}async tryMassUnsubBeforeResub(t){const n={users:t.map(o=>({stream_id:o.stream_id,stream_type:o.stream_type}))};try{await this.signal.request(Ye.UNSUBSCRIBE_STREAMS,n,!0)}catch(o){throw R.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),o),o}}async muteLocal(t,n){const o={action:t.find(s=>s.stream_type===xt.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:n};try{await this.signal.request(Ye.CONTROL,o,!0,!0)}catch(s){throw R.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),s),s}}async unmuteLocal(t,n){const o={action:t.find(s=>s.stream_type===xt.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:n};try{await this.signal.request(Ye.CONTROL,o,!0,!0)}catch(s){throw R.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),s),s}}async muteRemote(t,n){const o={action:t===Re.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:n};try{await this.signal.request(Ye.CONTROL,o,!0,!0)}catch(s){throw R.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),s),s}}async unmuteRemote(t,n){const o={action:t===Re.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:n};try{await this.signal.request(Ye.CONTROL,o,!0,!0)}catch(s){throw R.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),s),s}}uploadWRTCStats(t){this.signal.uploadWRTCStats(t)}upload(t,n){this.signal.upload(t,n)}getSignalRTT(){return this.signal.rtt}async restartICE(t){const n={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:t};try{return await this.signal.request(Ye.RESTART_ICE,n,!0)}catch(o){throw R.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),o),o}}reconnect(t,n){this.state==="CONNECTED"&&this.signal.reconnect(t||void 0,n||_r.P2P_FAILED)}getCurrentGatewayAddress(){var t,n;if(!H("GATEWAY_WSS_ADDRESS"))return H("USE_CANDIDATE_FROM_AP_DETAIL")&&(t=this.joinInfo)!==null&&t!==void 0&&t.apGatewayAddress?(R.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):(n=this.joinInfo)!==null&&n!==void 0&&n.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(t){await this.signal.request(Ye.SET_PARAMETER,{enablePublishAudioFilter:t})}}let sv=0,DC=0;function As(e,t,n,o){return new ye((s,c)=>{t.timeout=t.timeout||H("HTTP_CONNECT_TIMEOUT"),t.responseType=t.responseType||"json",t.data&&!n?(t.data=JSON.stringify(t.data),sv+=sa(t.data)):n&&(t.data.size?sv+=t.data.size:t.data instanceof FormData?sv+=X2(t.data):sv+=sa(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,oi.request(t).then(d=>{typeof d.data=="string"?DC+=sa(d.data):d.data instanceof ArrayBuffer||d.data instanceof Uint8Array?DC+=d.data.byteLength:DC+=sa(JSON.stringify(d.data)),o&&s({data:d.data,headers:d.headers}),s(d.data)}).catch(d=>{oi.isCancel(d)?c(new ee(j.OPERATION_ABORTED,"cancel token canceled")):d.code==="ECONNABORTED"?c(new ee(j.NETWORK_TIMEOUT,d.message)):d.response?c(new ee(j.NETWORK_RESPONSE_ERROR,d.response.status)):c(new ee(j.NETWORK_ERROR,d.message))})})}/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */(function(){var e;function t(se){var he=0;return function(){return he<se.length?{done:!1,value:se[he++]}:{done:!0}}}var n=typeof Object.defineProperties=="function"?Object.defineProperty:function(se,he,Ie){return se==Array.prototype||se==Object.prototype||(se[he]=Ie.value),se},o,s=function(se){se=[typeof globalThis=="object"&&globalThis,se,typeof window=="object"&&window,typeof self=="object"&&self,typeof l=="object"&&l];for(var he=0;he<se.length;++he){var Ie=se[he];if(Ie&&Ie.Math==Math)return Ie}throw Error("Cannot find global object")}(this);function c(se,he){if(he)e:{var Ie=s;se=se.split(".");for(var ae=0;ae<se.length-1;ae++){var b=se[ae];if(!(b in Ie))break e;Ie=Ie[b]}(he=he(ae=Ie[se=se[se.length-1]]))!=ae&&he!=null&&n(Ie,se,{configurable:!0,writable:!0,value:he})}}function d(se){return(se={next:se})[Symbol.iterator]=function(){return this},se}function h(se){var he=typeof Symbol<"u"&&Symbol.iterator&&se[Symbol.iterator];return he?he.call(se):{next:t(se)}}if(c("Symbol",function(se){function he(b,K){this.A=b,n(this,"description",{configurable:!0,writable:!0,value:K})}if(se)return se;he.prototype.toString=function(){return this.A};var Ie="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",ae=0;return function b(K){if(this instanceof b)throw new TypeError("Symbol is not a constructor");return new he(Ie+(K||"")+"_"+ae++,K)}}),c("Symbol.iterator",function(se){if(se)return se;se=Symbol("Symbol.iterator");for(var he="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),Ie=0;Ie<he.length;Ie++){var ae=s[he[Ie]];typeof ae=="function"&&typeof ae.prototype[se]!="function"&&n(ae.prototype,se,{configurable:!0,writable:!0,value:function(){return d(t(this))}})}return se}),typeof Object.setPrototypeOf=="function")o=Object.setPrototypeOf;else{var p;e:{var m={};try{m.__proto__={a:!0},p=m.a;break e}catch{}p=!1}o=p?function(se,he){if(se.__proto__=he,se.__proto__!==he)throw new TypeError(se+" is not extensible");return se}:null}var g=o;function E(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function y(se){if(se.m)throw new TypeError("Generator is already running");se.m=!0}function T(se,he){return se.h=3,{value:he}}function P(se){this.g=new E,this.G=se}function I(se,he,Ie,ae){try{var b=he.call(se.g.j,Ie);if(!(b instanceof Object))throw new TypeError("Iterator result "+b+" is not an object");if(!b.done)return se.g.m=!1,b;var K=b.value}catch(q){return se.g.j=null,se.g.s(q),A(se)}return se.g.j=null,ae.call(se.g,K),A(se)}function A(se){for(;se.g.h;)try{var he=se.G(se.g);if(he)return se.g.m=!1,{value:he.value,done:!1}}catch(Ie){se.g.v=void 0,se.g.s(Ie)}if(se.g.m=!1,se.g.l){if(he=se.g.l,se.g.l=null,he.F)throw he.D;return{value:he.return,done:!0}}return{value:void 0,done:!0}}function M(se){this.next=function(he){return se.o(he)},this.throw=function(he){return se.s(he)},this.return=function(he){return function(Ie,ae){y(Ie.g);var b=Ie.g.j;return b?I(Ie,"return"in b?b.return:function(K){return{value:K,done:!0}},ae,Ie.g.return):(Ie.g.return(ae),A(Ie))}(se,he)},this[Symbol.iterator]=function(){return this}}function U(se,he){return he=new M(new P(he)),g&&se.prototype&&g(he,se.prototype),he}if(E.prototype.o=function(se){this.v=se},E.prototype.s=function(se){this.l={D:se,F:!0},this.h=this.C||this.u},E.prototype.return=function(se){this.l={return:se},this.h=this.u},P.prototype.o=function(se){return y(this.g),this.g.j?I(this,this.g.j.next,se,this.g.o):(this.g.o(se),A(this))},P.prototype.s=function(se){return y(this.g),this.g.j?I(this,this.g.j.throw,se,this.g.o):(this.g.s(se),A(this))},c("Array.prototype.entries",function(se){return se||function(){return function(he,Ie){he instanceof String&&(he+="");var ae=0,b=!1,K={next:function(){if(!b&&ae<he.length){var q=ae++;return{value:Ie(q,he[q]),done:!1}}return b=!0,{done:!0,value:void 0}}};return K[Symbol.iterator]=function(){return K},K}(this,function(he,Ie){return[he,Ie]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var Y=function(se,he){for(var Ie=0;Ie<se.length;Ie++)he(se[Ie])},Q=function(se){return se.replace(/\r?\n|\r/g,`\r
`)},J=function(se,he,Ie){return he instanceof Blob?(Ie=Ie!==void 0?Ie+"":typeof he.name=="string"?he.name:"blob",he.name===Ie&&Object.prototype.toString.call(he)!=="[object Blob]"||(he=new File([he],Ie)),[String(se),he]):[String(se),String(he)]},X=function(se,he){if(se.length<he)throw new TypeError(he+" argument required, but only "+se.length+" present.")},ne=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,oe=ne.FormData,me=ne.XMLHttpRequest&&ne.XMLHttpRequest.prototype.send,we=ne.Request&&ne.fetch,ut=ne.navigator&&ne.navigator.sendBeacon,rt=ne.Element&&ne.Element.prototype,qe=ne.Symbol&&Symbol.toStringTag;qe&&(Blob.prototype[qe]||(Blob.prototype[qe]="Blob"),"File"in ne&&!File.prototype[qe]&&(File.prototype[qe]="File"));try{new File([],"")}catch{ne.File=function(he,Ie,ae){return he=new Blob(he,ae||{}),Object.defineProperties(he,{name:{value:Ie},lastModified:{value:+(ae&&ae.lastModified!==void 0?new Date(ae.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),qe&&Object.defineProperty(he,qe,{value:"File"}),he}}var tn=function(se){return se.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},zt=function(se){this.i=[];var he=this;se&&Y(se.elements,function(Ie){if(Ie.name&&!Ie.disabled&&Ie.type!=="submit"&&Ie.type!=="button"&&!Ie.matches("form fieldset[disabled] *"))if(Ie.type==="file"){var ae=Ie.files&&Ie.files.length?Ie.files:[new File([],"",{type:"application/octet-stream"})];Y(ae,function(b){he.append(Ie.name,b)})}else Ie.type==="select-multiple"||Ie.type==="select-one"?Y(Ie.options,function(b){!b.disabled&&b.selected&&he.append(Ie.name,b.value)}):Ie.type==="checkbox"||Ie.type==="radio"?Ie.checked&&he.append(Ie.name,Ie.value):(ae=Ie.type==="textarea"?Q(Ie.value):Ie.value,he.append(Ie.name,ae))})};if((e=zt.prototype).append=function(se,he,Ie){X(arguments,2),this.i.push(J(se,he,Ie))},e.delete=function(se){X(arguments,1);var he=[];se=String(se),Y(this.i,function(Ie){Ie[0]!==se&&he.push(Ie)}),this.i=he},e.entries=function se(){var he,Ie=this;return U(se,function(ae){if(ae.h==1&&(he=0),ae.h!=3)return he<Ie.i.length?ae=T(ae,Ie.i[he]):(ae.h=0,ae=void 0),ae;he++,ae.h=2})},e.forEach=function(se,he){X(arguments,1);for(var Ie=h(this),ae=Ie.next();!ae.done;ae=Ie.next()){var b=h(ae.value);ae=b.next().value,b=b.next().value,se.call(he,b,ae,this)}},e.get=function(se){X(arguments,1);var he=this.i;se=String(se);for(var Ie=0;Ie<he.length;Ie++)if(he[Ie][0]===se)return he[Ie][1];return null},e.getAll=function(se){X(arguments,1);var he=[];return se=String(se),Y(this.i,function(Ie){Ie[0]===se&&he.push(Ie[1])}),he},e.has=function(se){X(arguments,1),se=String(se);for(var he=0;he<this.i.length;he++)if(this.i[he][0]===se)return!0;return!1},e.keys=function se(){var he,Ie,ae,b,K=this;return U(se,function(q){if(q.h==1&&(he=h(K),Ie=he.next()),q.h!=3)return Ie.done?void(q.h=0):(ae=Ie.value,b=h(ae),T(q,b.next().value));Ie=he.next(),q.h=2})},e.set=function(se,he,Ie){X(arguments,2),se=String(se);var ae=[],b=J(se,he,Ie),K=!0;Y(this.i,function(q){q[0]===se?K&&(K=!ae.push(b)):ae.push(q)}),K&&ae.push(b),this.i=ae},e.values=function se(){var he,Ie,ae,b,K=this;return U(se,function(q){if(q.h==1&&(he=h(K),Ie=he.next()),q.h!=3)return Ie.done?void(q.h=0):(ae=Ie.value,(b=h(ae)).next(),T(q,b.next().value));Ie=he.next(),q.h=2})},zt.prototype._asNative=function(){for(var se=new oe,he=h(this),Ie=he.next();!Ie.done;Ie=he.next()){var ae=h(Ie.value);Ie=ae.next().value,ae=ae.next().value,se.append(Ie,ae)}return se},zt.prototype._blob=function(){var se="----formdata-polyfill-"+Math.random(),he=[],Ie="--"+se+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(ae,b){return typeof ae=="string"?he.push(Ie+tn(Q(b))+`"\r
\r
`+Q(ae)+`\r
`):he.push(Ie+tn(Q(b))+'"; filename="'+tn(ae.name)+`"\r
Content-Type: `+(ae.type||"application/octet-stream")+`\r
\r
`,ae,`\r
`)}),he.push("--"+se+"--"),new Blob(he,{type:"multipart/form-data; boundary="+se})},zt.prototype[Symbol.iterator]=function(){return this.entries()},zt.prototype.toString=function(){return"[object FormData]"},rt&&!rt.matches&&(rt.matches=rt.matchesSelector||rt.mozMatchesSelector||rt.msMatchesSelector||rt.oMatchesSelector||rt.webkitMatchesSelector||function(se){for(var he=(se=(this.document||this.ownerDocument).querySelectorAll(se)).length;0<=--he&&se.item(he)!==this;);return-1<he}),qe&&(zt.prototype[qe]="FormData"),me){var di=ne.XMLHttpRequest.prototype.setRequestHeader;ne.XMLHttpRequest.prototype.setRequestHeader=function(se,he){di.call(this,se,he),se.toLowerCase()==="content-type"&&(this.B=!0)},ne.XMLHttpRequest.prototype.send=function(se){se instanceof zt?(se=se._blob(),this.B||this.setRequestHeader("Content-Type",se.type),me.call(this,se)):me.call(this,se)}}we&&(ne.fetch=function(se,he){return he&&he.body&&he.body instanceof zt&&(he.body=he.body._blob()),we.call(this,se,he)}),ut&&(ne.navigator.sendBeacon=function(se,he){return he instanceof zt&&(he=he._asNative()),ut.call(this,se,he)}),ne.FormData=zt}})();const $f=()=>{const e=H("AREAS");return e.length===0&&e.push(Pt.GLOBAL),Fo(e).call(e,(t,n,o)=>{const s=mV(n);return s?o===0?s:"".concat(t,",").concat(s):t},"")},mV=e=>e===Pt.OVERSEA?"".concat(Ar.ASIA,",").concat(Ar.EUROPE,",").concat(Ar.AFRICA,",").concat(Ar.NORTH_AMERICA,",").concat(Ar.SOUTH_AMERICA,",").concat(Ar.OCEANIA):Ar[e],ese=e=>{const t={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return e.map(n=>{const o=QE[n],s=Object.keys(o);s&&s.map(c=>{c!=="CODE"&&(t[c]=t[c].concat(o[c]))})}),t},av={GLOBAL:{ASIA:[Pt.CHINA,Pt.JAPAN,Pt.INDIA,Pt.KOREA,Pt.HKMC],EUROPE:[],NORTH_AMERICA:[Pt.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},cv=Object.keys(av[Pt.GLOBAL]),kC=[Pt.CHINA,Pt.NORTH_AMERICA,Pt.EUROPE,Pt.ASIA,Pt.JAPAN,Pt.INDIA,Pt.OCEANIA,Pt.SOUTH_AMERICA,Pt.AFRICA,Pt.KOREA,Pt.HKMC,Pt.US],tse=function(e,t){let n=[];if(Ee(e).call(e,Pt.GLOBAL)){const c=[Pt.GLOBAL,Pt.OVERSEA],d=Object.keys(QE);if(t===Pt.GLOBAL)throw new ee(j.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(t===Pt.CHINA)n=[Pt.OVERSEA];else if(s=t,Ee(cv).call(cv,s)){const h=(o=t,av[Pt.GLOBAL][o]||[]),p=[...c,t,...h];n=d.filter(m=>!Ee(p).call(p,m))}else if(function(h){let p=!1;return cv.forEach(m=>{var g;Ee(g=av[Pt.GLOBAL][m]).call(g,h)&&(p=!0)}),p}(t)){const h=function(m){let g;return cv.forEach(E=>{var y;Ee(y=av[Pt.GLOBAL][E]).call(y,m)&&(g=E)}),g}(t),p=[...c,h,t];n=d.filter(m=>!Ee(p).call(p,m))}else n=e;n=function(h){const p=[];return kC.forEach(m=>{Ee(h).call(h,m)&&p.push(m)}),p.concat(h.filter(m=>!Ee(kC).call(kC,m)))}(n)}else n=e;var o,s;return n};function gV(e){var t,n;if(!e&&Ee(t=H("AREAS")).call(t,Pt.EXTENSIONS))return R.debug("update area from ap : reset"),void xC(loe,!0);if(!Ee(n=H("AREAS")).call(n,Pt.GLOBAL)||!e)return;let o=QE.EXTENSIONS;o&&(o={CODE:mV(Pt.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(e,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(e,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(e,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(e,".agora.io"),"cds-ap-web-2-".concat(e,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(e,".agora.io"),"sua-ap-web-2-".concat(e,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(e,".agora.io"),"uap-ap-web-2-".concat(e,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(e,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(e,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(e,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(e,".agora.io")]},R.debug("update area from ap success: ".concat(e,",config is "),o),jt("AREAS",[Pt.EXTENSIONS],!0),Object.keys(o).map(s=>{s==="LOG_UPLOAD_SERVER"||s==="EVENT_REPORT_DOMAIN"||s==="EVENT_REPORT_BACKUP_DOMAIN"||s==="PROXY_SERVER_TYPE3"?jt(s,o[s][0]):jt(s,o[s])}))}function xC(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=ke.reportApiInvoke(null,{name:Nn.SET_AREA,options:e,tag:En.TRACER});try{let o=[];if(typeof e=="string"&&(o=[e]),Array.isArray(e)&&(e.forEach(c=>{if(!Ee(Uj).call(Uj,c))throw new ee(j.INVALID_PARAMS,"invalid area code")}),o=e),Object.prototype.toString.call(e)==="[object Object]"){const{areaCode:c,excludedArea:d}=e;if(!c)throw new ee(j.INVALID_PARAMS,"area code is needed");let h=c;typeof c=="string"&&(h=[c]),o=d?tse(h,d):h}if(!t){if(Rs.AREAS){const c=new ee(j.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return n.onError(c),void R.warning("setArea is prohibited because of config-distribute")}if(Ee(o).call(o,Pt.GLOBAL)&&H("AREAS")===Pt.EXTENSIONS){const c=new ee(j.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return n.onError(c),void R.warning("setArea is prohibited because of ap extensions")}}jt("AREAS",o,t);const s=ese(o);Object.keys(s).map(c=>{c==="LOG_UPLOAD_SERVER"||c==="EVENT_REPORT_DOMAIN"||c==="EVENT_REPORT_BACKUP_DOMAIN"||c==="PROXY_SERVER_TYPE3"?jt(c,s[c][0]):jt(c,s[c])}),R.debug("set area success:",o.join(","))}catch(o){throw n.onError(o),o}n.onSuccess()}function _V(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,o)}return n}function pa(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?_V(Object(n),!0).forEach(function(o){x(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_V(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}let LC=1;function nse(e,t,n,o,s){LC+=1;const c={sid:n.sid,command:"convergeAllocateEdge",uid:"666",appId:n.appId,ts:Math.floor(Date.now()/1e3),seq:LC,requestId:LC,version:po,cname:n.cname},d={service_name:t,json_body:JSON.stringify(c)};let h,p,m=e[0];return ws(async()=>{h=Date.now();const g=await As(m,{data:d,cancelToken:o,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(p=Date.now()-h,g.code!==0){const T=new ee(j.UNEXPECTED_RESPONSE,"live streaming ap error, code"+g.code,{retry:!0,responseTime:p});throw R.error(T.toString()),T}const E=JSON.parse(g.json_body);if(E.code!==200){const T=new ee(j.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(E.code,", reason: ").concat(E.reason),{code:E.code,responseTime:p});throw R.error(T.toString()),T}if(!E.servers||E.servers.length===0){const T=new ee(j.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:E.code,responseTime:p});throw R.error(T.toString()),T}const y=function(T,P){return{addressList:T.servers.map(I=>"wss://".concat(I.address.replace(/\./g,"-"),".").concat(H("WORKER_DOMAIN"),":").concat(I.wss,"?serviceName=").concat(encodeURIComponent(P))),workerToken:T.workerToken,vid:T.vid}}(E,t);return H("LIVE_STREAMING_ADDRESS")&&(y.addressList=H("LIVE_STREAMING_ADDRESS")instanceof Array?H("LIVE_STREAMING_ADDRESS"):[H("LIVE_STREAMING_ADDRESS")]),pa(pa({},y),{},{responseTime:p})},(g,E)=>(ke.apworkerEvent(n.sid,{success:!0,sc:200,serviceName:t,responseDetail:JSON.stringify(g.addressList),firstSuccess:E===0,responseTime:p,serverIp:e[E%e.length]}),!1),(g,E)=>(ke.apworkerEvent(n.sid,{success:!1,sc:g.data&&g.data.code||200,serviceName:t,responseTime:p,serverIp:e[E%e.length]}),!!(g.code!==j.OPERATION_ABORTED&&g.code!==j.UNEXPECTED_RESPONSE||g.data&&g.data.retry)&&(m=e[(E+1)%e.length],!0)),s)}let MC=1;function EV(e,t,n,o){let{url:s,areaCode:c}=e;const{clientId:d,sid:h}=t,p=Date.now();let m;const g=t.role,[E,y]=jC(t,c,[Pn.CHOOSE_SERVER]);let T=On.networkState;return ws(async()=>{T&&On.networkState===xi.OFFLINE&&On.onlineWaiter&&await ye.race([On.onlineWaiter,cr(o&&o.maxRetryTimeout||Un.maxRetryTimeout)]),T=On.networkState;const{data:P,headers:I}=await As(s,{data:E,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);m=I.http3==="1"?1:-1,ke.reportResourceTiming(s,h),yV(P,s,t,p,[Pn.CHOOSE_SERVER],m);const A=Kf(P,Pn.CHOOSE_SERVER);return UC(A),bC(A,s)},P=>(P&&ke.joinChooseServer(h,{role:g,lts:p,succ:!0,csAddr:s,opid:y,serverList:P.gatewayAddrs.map(I=>I.address),ec:null,cid:P.cid.toString(),uid:P.uid.toString(),csIp:P.csIp,unilbsServerIds:[Pn.CHOOSE_SERVER].toString(),isHttp3:m,corssRegionTagReq:t.apRequestDetail,corssRegionTagRes:P.res.detail&&P.res.detail[38]}),!1),P=>P.code!==j.OPERATION_ABORTED&&(P.code===j.CAN_NOT_GET_GATEWAY_SERVER?P.data.retry:(ke.joinChooseServer(h,{role:g,lts:p,succ:!1,csAddr:s,serverList:null,opid:y,ec:P.code,csIp:P.data&&P.data.csIp,unilbsServerIds:[Pn.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:T}),isHttp3:m,corssRegionTagReq:t.apRequestDetail}),R.warning("[".concat(d||"sid-".concat(h.slice(0,6)),"] Choose server network error, retry"),P),!0)),o)}function vV(e,t,n,o){let s,{url:c,areaCode:d,serviceIds:h}=e;const p=Date.now(),m=t.role,[g,E]=jC(t,d,h);let y;return ws(async()=>{y&&On.networkState===xi.OFFLINE&&On.onlineWaiter&&await ye.race([On.onlineWaiter,cr(o&&o.maxRetryTimeout||Un.maxRetryTimeout)]),y=On.networkState;const{data:T,headers:P}=await As(c,{data:g,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);s=P.http3==="1"?1:-1,ke.reportResourceTiming(c,t.sid),yV(T,c,t,p,h,s);const I=Kf(T,Pn.CHOOSE_SERVER),A=Kf(T,t.cloudProxyServer==="proxy5"?Pn.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?Pn.CLOUD_PROXY:Pn.CLOUD_PROXY_FALLBACK);return UC(I),{gatewayInfo:bC(I,c),proxyInfo:A,url:c}},T=>(T.gatewayInfo&&ke.joinChooseServer(t.sid,{role:m,lts:p,succ:!0,csAddr:c,serverList:T.gatewayInfo.gatewayAddrs.map(P=>P.address),ec:null,opid:E,cid:T.gatewayInfo.cid.toString(),uid:T.gatewayInfo.uid.toString(),csIp:T.gatewayInfo.csIp,unilbsServerIds:h.toString(),isHttp3:s,corssRegionTagReq:t.apRequestDetail,corssRegionTagRes:T.gatewayInfo.res.detail&&T.gatewayInfo.res.detail[38]}),T.proxyInfo&&ke.joinWebProxyAP(t.sid,{lts:p,sucess:1,apServerAddr:c,turnServerAddrList:T.proxyInfo.addresses.map(P=>P.ip).join(","),errorCode:null,eventType:t.cloudProxyServer,unilbsServerIds:h.toString()}),!1),T=>T.code!==j.OPERATION_ABORTED&&(T.code===j.CAN_NOT_GET_GATEWAY_SERVER?T.data.retry:(ke.joinWebProxyAP(t.sid,{lts:p,sucess:0,apServerAddr:c,turnServerAddrList:null,errorCode:T.code,eventType:t.cloudProxyServer,unilbsServerIds:h.toString(),extend:JSON.stringify({networkState:y})}),R.warning("[".concat(t.clientId,"] multi unilbs network error, retry"),T),!0)),o)}const yV=(e,t,n,o,s,c)=>{const{sid:d,clientId:h,cloudProxyServer:p}=n,m=[],g=E=>{E.flag===4096?ke.joinChooseServer(d,{role:n.role,lts:o,succ:!1,csAddr:t,opid:e.opid,serverList:null,ec:E.error.message,csIp:E.error.data&&E.error.data.csIp,unilbsServerIds:s.toString(),isHttp3:c,corssRegionTagReq:n.apRequestDetail}):E.flag!==1048576&&E.flag!==4194304&&E.flag!==4194310||ke.joinWebProxyAP(d,{lts:o,sucess:0,apServerAddr:t,turnServerAddrList:null,errorCode:E.error.code,eventType:p,unilbsServerIds:s.toString()})};if(e.response_body.forEach(E=>{const y=E.buffer.code;if(E.uri===23&&y===0&&!E.buffer.edges_services)if(E.buffer.flag===4194310)R.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),E.buffer.edges_services=[];else{const T={error:new ee(j.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:e.detail[502]}),flag:E.buffer.flag};m.push(T),g(T)}if(y!==0){const T=Eh(y),P={error:new ee(j.CAN_NOT_GET_GATEWAY_SERVER,T.desc,{desc:T.desc,retry:T.retry,csIp:e.detail[502]}),flag:E.buffer.flag};E.buffer.flag===4194310?R.warning(P.error.toString()):m.push(P),g(P)}}),m.length)throw R.warning("[".concat(h||"sid-".concat(d.slice(0,6)),"] multi unilbs ").concat(t," failed, ").concat(m.map(E=>"flag: ".concat(E.flag,", message: ").concat(E.error.message,", retry: ").concat(E.error.data.retry)).join(" | "))),new ee(j.CAN_NOT_GET_GATEWAY_SERVER,m.map(E=>"flag: ".concat(E.flag,", message: ").concat(E.error.message)).join(" | "),{retry:!!m.find(E=>E.error.data.retry),csIp:e.detail[502],desc:[...new Set(m.map(E=>{var y;return E==null||(y=E.error)===null||y===void 0||(y=y.data)===null||y===void 0?void 0:y.desc}).filter(E=>!!E))]})},UC=e=>{var t,n,o,s;if(e.addresses&&e.addresses.length===0&&e.code===0)throw new ee(j.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:e.detail&&e.detail[502]});if(H("AP_AREA")&&((o=e.detail)!==null&&o!==void 0&&o[23]&&typeof((s=e.detail)===null||s===void 0?void 0:s[23])=="string"?gV(e.detail[23].toLowerCase()):gV()),(t=e.detail)!==null&&t!==void 0&&t[19]&&typeof((n=e.detail)===null||n===void 0?void 0:n[19])=="string"){const d=e.detail[19],h=d==null?void 0:d.split(";");for(let p=0;p<h.length;p++){var c;const m=Hr(c=h[p]).call(c);e.addresses[p]&&h&&(e.addresses[p].fingerprint=m)}}if(H("GATEWAY_ADDRESS")&&H("GATEWAY_ADDRESS").length>0){R.debug("assign gateway address to",H("GATEWAY_ADDRESS"));const d=H("GATEWAY_ADDRESS").map(h=>{var p,m;const g=(p=(m=e.addresses.find(E=>E.ip===h.ip&&E.port===h.port))===null||m===void 0?void 0:m.fingerprint)!==null&&p!==void 0?p:"";return{ip:h.ip,port:h.port,ticket:e.addresses[0]&&e.addresses[0].ticket,fingerprint:g}});e.addresses=d}},rse=(e,t)=>{if(e.response_body&&e.response_body.length){const n=e.response_body[0];if(n.buffer.code!==0){const o=Eh(n.buffer.code);throw new ee(j.UPDATE_TICKET_FAILED,"[".concat(n.buffer.code,"]: ").concat(o.desc),{retry:o.retry})}return n.buffer.ticket}throw R.debug("update ticket request received ap response without response body:",t),new ee(j.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},jC=(e,t,n)=>{const o=Math.floor(Math.random()*1e12),s=e.role==="host"?"1":e.role==="audience"?"2":void 0,c={appid:e.appId,client_ts:Date.now(),opid:o,sid:e.sid,request_bodies:[{uri:22,buffer:{cname:e.cname,detail:pa(pa(pa({6:e.stringUid,11:t,12:H("USE_NEW_TOKEN")?"1":void 0},s?{17:s}:{}),{},{22:t},e.apRequestDetail?{33:e.apRequestDetail}:{}),e.apRTM?{26:"RTM2"}:{}),key:e.token,service_ids:n,uid:e.uid||0}}]};c.request_bodies.forEach(h=>{e.multiIP&&e.multiIP.gateway_ip&&(h.buffer.detail[5]=JSON.stringify({vocs_ip:[e.multiIP.uni_lbs_ip],vos_ip:[e.multiIP.gateway_ip]}))});const d=new FormData;return d.append("request",JSON.stringify(c)),[d,o]},ise=(e,t)=>{const n=Math.floor(Math.random()*1e12),o={appid:e.appId,client_ts:Date.now(),opid:n,sid:e.sid,request_bodies:[{uri:28,buffer:{cname:e.cname,detail:{1:"",6:e.stringUid,12:"1"},token:e.token,service_ids:t,uid:e.uid||0,edges_services:e.apResponse.addresses.map(c=>({ip:c.ip,port:c.port}))}}]},s=new FormData;return s.append("request",JSON.stringify(o)),[s,n]};let Th=0;function wh(e){return ye.all(e.map(t=>t.then(n=>{throw n},n=>n))).then(t=>{throw t},t=>t)}const Jf=async e=>{let{fragementLength:t,referenceList:n,asyncMapHandler:o,allFailedhandler:s,promisesCollector:c}=e,d=0;const h=t;let p,m=0;const g=async()=>{const E=(()=>{const y=d*h,T=y+h;return n.slice(y,T).map(o)})();c&&c.push(...E);try{p=await wh(E)}catch(y){if(m+=h,d++,!(m>=n.length))return void await g();s(y)}E.forEach(y=>y.cancel())};return await g(),p},SV=async e=>{let{referenceList:t,asyncMapHandler:n,closeFn:o}=e;const s=t.length;let c=0;const d=async()=>{const h=n(t.shift());try{return await h}catch(p){if(c++,c>=s||o!=null&&o(p))throw p;return d()}};return d()};async function VC(e,t,n,o){return{gatewayInfo:await async function(c,d,h,p){let m=null;const g=[],E=async()=>{const T=H("WEBCS_DOMAIN").slice(0,H("AJAX_REQUEST_CONCURRENT")).map(A=>({url:c.proxyServer?"https://".concat(c.proxyServer,"/ap/?url=").concat(A+"/api/v2/transpond/webrtc?v=2"):"https://".concat(A,"/api/v2/transpond/webrtc?v=2"),areaCode:$f()})),P=p.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:T.map(A=>A.url)}),I=await Jf({fragementLength:H("FRAGEMENT_LENGTH"),referenceList:T,asyncMapHandler:A=>(R.debug("[".concat(c.clientId,"] Connect to choose_server:"),A.url),EV(A,c,d,h)),allFailedhandler:A=>{throw p.recordJoinChannelService({endTs:Date.now(),status:"error",errors:A},P),A[0]},promisesCollector:g});return p.recordJoinChannelService({endTs:Date.now(),status:"success"},P),I},y=async()=>{if(await cr(1e3),m!==null)return m;const T=H("WEBCS_DOMAIN_BACKUP_LIST").map(A=>({url:c.proxyServer?"https://".concat(c.proxyServer,"/ap/?url=").concat(A+"/api/v2/transpond/webrtc?v=2"):"https://".concat(A,"/api/v2/transpond/webrtc?v=2"),areaCode:$f()})),P=p.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:T.map(A=>A.url)}),I=await Jf({fragementLength:H("FRAGEMENT_LENGTH"),referenceList:T,asyncMapHandler:A=>(R.debug("[".concat(c.clientId,"] Connect to backup choose_server:"),A.url),EV(A,c,d,h)),allFailedhandler:A=>{throw p.recordJoinChannelService({endTs:Date.now(),status:"error",errors:A},P),A[0]},promisesCollector:g});return p.recordJoinChannelService({endTs:Date.now(),status:"success"},P),I};try{return m=await wh([E(),y()]),g.length&&g.forEach(T=>T.cancel&&typeof T.cancel=="function"&&T.cancel()),m}catch(T){throw T[0]}}(e,t,n,o)}}async function TV(e,t,n,o,s){const c=e.cloudProxyServer;if(c==="disabled"){if(e.useLocalAccessPoint)return await VC(e,t,n,s);if(H("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:y,proxyInfo:T}=await CV(e,t,n,s);if(e.turnServer&&e.turnServer.mode!=="auto")return{gatewayInfo:y};const P=T.map(I=>({turnServerURL:I.address,tcpport:I.tcpport||vr.tcpport,udpport:I.udpport||vr.udpport,username:I.username||vr.username,password:I.password||vr.password,forceturn:!1,security:!0}));if(s.useP2P){var d;const I=(d=e.uid)!==null&&d!==void 0?d:y.uid,A="glb:".concat(I.toString()),M=await OR(A),U=T.map(Y=>({turnServerURL:Y.address,tcpport:Y.tcpport||vr.tcpport,udpport:Y.udpport||vr.udpport,username:A,password:M,forceturn:!1,security:!0}));P.push(...U)}return e.turnServer={mode:"manual",servers:P},{gatewayInfo:y}}return await VC(e,t,n,s)}const{proxyInfo:h,gatewayInfo:p}=await CV(e,t,n,s),m={gatewayInfo:p},g=h.map(y=>({turnServerURL:y.address,tcpport:c==="proxy3"?void 0:y.tcpport?y.tcpport:vr.tcpport,udpport:c==="proxy4"?void 0:y.udpport?y.udpport:vr.udpport,username:y.username||vr.username,password:y.password||vr.password,forceturn:c!=="proxy4",security:c==="proxy5"}));if(s.useP2P){var E;const y=(E=e.uid)!==null&&E!==void 0?E:p.uid,T="glb:".concat(y.toString()),P=await OR(T),I=h.map(A=>({turnServerURL:A.address,tcpport:c==="proxy3"?void 0:A.tcpport||vr.tcpport,udpport:c==="proxy4"?void 0:A.udpport||vr.udpport,username:T,password:P,forceturn:c!=="proxy4",security:c==="proxy5"}));g.push(...I)}return e.turnServer={mode:"manual",servers:g},R.debug("[".concat(e.clientId,"] set proxy server: ").concat(e.proxyServer,", mode: ").concat(c)),m}async function wV(e,t,n,o,s){const c=H("ACCOUNT_REGISTER").slice(0,H("AJAX_REQUEST_CONCURRENT"));let d=[];d=t.proxyServer?c.map(p=>"https://".concat(t.proxyServer,"/ap/?url=").concat(p+"/api/v1")):c.map(p=>"https://".concat(p,"/api/v1"));const h=s==null?void 0:s.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:d});try{const p=await async function(m,g,E,y,T){const P=Date.now(),I={sid:E.sid,opid:10,appid:E.appId,string_uid:g};let A=m[0];const M=await ws(()=>As(A+"".concat(A.indexOf("?")===-1?"?":"&","action=stringuid"),{data:I,cancelToken:y,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(U,Y)=>{if(U.code===0){if(U.uid<=0||U.uid>=Math.pow(2,32))throw R.error("Invalid Uint Uid ".concat(g," => ").concat(U.uid),U),ke.reqUserAccount(I.sid,{lts:P,success:!1,serverAddr:A,stringUid:I.string_uid,uid:U.uid,errorCode:j.INVALID_UINT_UID_FROM_STRING_UID,extend:I}),new ee(j.INVALID_UINT_UID_FROM_STRING_UID);return ke.reqUserAccount(I.sid,{lts:P,success:!0,serverAddr:A,stringUid:I.string_uid,uid:U.uid,errorCode:null,extend:I}),!1}const Q=Eh(U.code);return Q.retry&&(A=m[(Y+1)%m.length]),ke.reqUserAccount(I.sid,{lts:P,success:!1,serverAddr:A,stringUid:I.string_uid,uid:U.uid,errorCode:Q.desc,extend:I}),Q.retry},(U,Y)=>U.code!==j.OPERATION_ABORTED&&(ke.reqUserAccount(I.sid,{lts:P,success:!1,serverAddr:A,stringUid:I.string_uid,uid:null,errorCode:U.code,extend:I}),A=m[(Y+1)%m.length],!0),T);if(M.code!==0){const U=Eh(M.code);throw new ee(j.UNEXPECTED_RESPONSE,U.desc)}return M}(d,e,t,n,o);return s==null||s.recordJoinChannelService({status:"success",endTs:Date.now()},h),p.uid}catch(p){throw s==null||s.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[p]},h),p}}async function ose(e,t,n){const o=H("ACCOUNT_REGISTER");let s=[];s=t.proxyServer?o.map(c=>"https://".concat(t.proxyServer,"/ap/?url=").concat(c+"/api/v1")):o.map(c=>"https://".concat(c,"/api/v1"));try{return await SV({referenceList:s,asyncMapHandler:d=>async function(h,p,m,g){const E=Date.now(),y={sid:m.sid,opid:10,appid:m.appId,string_uid:p};try{const T=await As(h+"".concat(h.indexOf("?")===-1?"?":"&","action=stringuid"),{data:y,cancelToken:g,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(T.code!==0){const P=Eh(T.code);throw new ee(j.UNEXPECTED_RESPONSE,"preload sua error:".concat(P.desc),P)}if(T.uid<=0||T.uid>=Math.pow(2,32))throw new ee(j.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:E,url:h,req:y,uid:T.uid,elapse:Date.now()-E}}catch(T){throw T}}(d,e,t,n),closeFn:d=>d.code===j.OPERATION_ABORTED||d.code===j.UNEXPECTED_RESPONSE&&!d.data.retry})}catch(c){throw c}}async function sse(e,t,n){const o=H("CDS_AP").slice(0,H("AJAX_REQUEST_CONCURRENT")).map(p=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(p+"/api/v1"):"https://".concat(p,"/api/v1?action=config")),s=o.map(p=>function(m,g,E,y){const T=wt(),P={flag:64,cipher_method:0,features:pa(pa(pa(pa(pa({install_id:WR(),device:T.name,system:T.os,system_general:navigator.userAgent,vendor:g.appId,version:po,cname:g.cname,session_id:g.sid,proxyServer:g.proxyServer,sdk_type:Joe.WEB_RTC,browser_name:T.name,browser_version:T.version,user_agent:navigator.userAgent,channel_name:g.cname},g.stringUid&&{string_uid:g.stringUid}),g.uid&&{uid:g.uid+""}),T.os&&{os_name:T.os}),T.osVersion&&{os_version:T.osVersion}),{},{detail:""})};return ws(()=>As(m,{data:P,timeout:1e3,cancelToken:E,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,I=>I.code!==j.OPERATION_ABORTED,y)}(p,e,t,n));let c=null,d=null,h={};try{c=await wh(s)}catch(p){if(p.code===j.OPERATION_ABORTED)throw p;d=p}if(s.forEach(p=>p.cancel()),ke.reportApiInvoke(e.sid,{name:Nn.REQUEST_CONFIG_DISTRIBUTE,options:{error:d,res:c}}).onSuccess(),c&&c.test_tags)try{h=function(p){if(!p.test_tags)return{};const m=p.test_tags,g=Object.keys(m),E={};return g.forEach(y=>{var T;const P=Hr(T=y.slice(4)).call(T),I=JSON.parse(m[y]),A=I[1];E[P]={tag:I[0]||"",value:A}}),E}(c)}catch{}return h}async function RV(e,t){const n=H("WEBCS_DOMAIN").concat(H("WEBCS_DOMAIN_BACKUP_LIST")).map(o=>({url:"https://".concat(o,"/api/v2/transpond/webrtc?v=2"),areaCode:$f(),serviceIds:[Pn.CHOOSE_SERVER,Pn.CLOUD_PROXY_FALLBACK]}));try{return await SV({referenceList:n,asyncMapHandler:s=>async function(c,d,h){let p,{url:m,areaCode:g,serviceIds:E}=c;const y=Date.now(),[T,P]=jC(d,g,E);let I=On.networkState;try{I&&On.networkState===xi.OFFLINE&&On.onlineWaiter&&await ye.race([On.onlineWaiter,cr(Un.maxRetryTimeout)]),I=On.networkState;const{data:A,headers:M}=await As(m,{data:T,cancelToken:h,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);p=M.http3==="1"?1:-1,(J=>{const X=[];if(J.response_body.forEach(ne=>{const oe=ne.buffer.code;if(ne.uri===23&&oe===0&&!ne.buffer.edges_services)if(ne.buffer.flag===4194310)ne.buffer.edges_services=[];else{const me={error:new ee(j.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:J.detail[502]}),flag:ne.buffer.flag};X.push(me)}if(oe!==0){const me=Eh(oe),we={error:new ee(j.CAN_NOT_GET_GATEWAY_SERVER,me.desc,{desc:me.desc,retry:me.retry,csIp:J.detail[502]}),flag:ne.buffer.flag};ne.buffer.flag===4194310?R.warning(we.error.toString()):X.push(we)}}),X.length)throw new ee(j.CAN_NOT_GET_GATEWAY_SERVER,X.map(ne=>"flag: ".concat(ne.flag,", message: ").concat(ne.error.message)).join(" | "),{retry:!!X.find(ne=>ne.error.data.retry),csIp:J.detail[502],desc:[...new Set(X.map(ne=>{var oe;return ne==null||(oe=ne.error)===null||oe===void 0||(oe=oe.data)===null||oe===void 0?void 0:oe.desc}).filter(ne=>!!ne))]})})(A);const Y=Kf(A,Pn.CHOOSE_SERVER),Q=Kf(A,Pn.CLOUD_PROXY_FALLBACK);return UC(Y),{gatewayInfo:bC(Y,m),proxyInfo:Q,opid:P,requestTime:y,url:m,isHttp3:p,elapse:Date.now()-y}}catch(A){throw A}}(s,e,t),closeFn:s=>s.code===j.OPERATION_ABORTED||s.code===j.CAN_NOT_GET_GATEWAY_SERVER&&!s.data.retry})}catch(o){throw o}}async function CV(e,t,n,o){const s=H("PROXY_SERVER_TYPE3"),c=(T,P,I)=>{let A=I||s;return Array.isArray(A)&&(A=P%2==0?s[1]:s[0]),"https://".concat(A,"/ap/?url=").concat(T)};let d=null;const h=[],p=async()=>{const T=H("WEBCS_DOMAIN").slice(0,H("AJAX_REQUEST_CONCURRENT")).map((A,M)=>{let U;return U=e.cloudProxyServer==="disabled"&&e.proxyServer?c("".concat(A,"/api/v2/transpond/webrtc?v=2"),M,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(A,"/api/v2/transpond/webrtc?v=2"):c("".concat(A,"/api/v2/transpond/webrtc?v=2"),M),{url:U,areaCode:$f(),serviceIds:[Pn.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?Pn.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?Pn.CLOUD_PROXY:Pn.CLOUD_PROXY_FALLBACK]}}),P=o.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:T.map(A=>A.url)}),I=await Jf({fragementLength:H("FRAGEMENT_LENGTH"),referenceList:T,asyncMapHandler:A=>(R.debug("[".concat(e.clientId,"] Connect to choose_server:"),A.url),vV(A,e,t,n)),allFailedhandler:A=>{throw o.recordJoinChannelService({endTs:Date.now(),status:"error",errors:A},P),A[0]},promisesCollector:h});return o.recordJoinChannelService({endTs:Date.now(),status:"success"},P),I},m=async()=>{if(await cr(1e3),d!==null)return d;const T=H("WEBCS_DOMAIN_BACKUP_LIST").map((A,M)=>{let U;return U=e.cloudProxyServer==="disabled"&&e.proxyServer?c("".concat(A,"/api/v2/transpond/webrtc?v=2"),M,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(A,"/api/v2/transpond/webrtc?v=2"):c("".concat(A,"/api/v2/transpond/webrtc?v=2"),M),{url:U,areaCode:$f(),serviceIds:[Pn.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?Pn.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?Pn.CLOUD_PROXY:Pn.CLOUD_PROXY_FALLBACK]}}),P=o.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:T.map(A=>A.url)}),I=await Jf({fragementLength:H("FRAGEMENT_LENGTH"),referenceList:T,asyncMapHandler:A=>(R.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),A.url),vV(A,e,t,n)),allFailedhandler:A=>{throw o.recordJoinChannelService({endTs:Date.now(),status:"error",errors:A},P),A[0]},promisesCollector:h});return o.recordJoinChannelService({endTs:Date.now(),status:"success"},P),I};let g,E,y;try{({gatewayInfo:g,proxyInfo:E,url:y}=await wh([p(),m()]))}catch(T){throw T[0]}if(h.length&&h.forEach(T=>T.cancel&&typeof T.cancel=="function"&&T.cancel()),!g||!E)throw new ee(j.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(e.apUrl=y,e.cloudProxyServer!=="disabled"&&Array.isArray(s)&&y){const T=/^https?:\/\/(.+?)(\/.*)?$/.exec(y)[1];Ee(s).call(s,T)&&(e.proxyServer=T,R.setProxyServer(T),ke.setProxyServer(T))}return d={gatewayInfo:g,proxyInfo:await Xj(E,g.uid)},d}async function ase(e,t,n){const o=H("UAP_AP").slice(0,H("AJAX_REQUEST_CONCURRENT")).map(c=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(c+"/api/v1?action=uap"):"https://".concat(c,"/api/v1?action=uap")),s=o.map(c=>function(d,h,p,m){const g={command:"convergeAllocateEdge",sid:h.sid,appId:h.appId,token:h.token,ts:Date.now(),version:po,cname:h.cname,uid:h.uid.toString(),requestId:MC,seq:MC};MC+=1;const E={service_name:"tele_channel",json_body:JSON.stringify(g)};return ws(async()=>{const y=await As(d,{data:E,cancelToken:p,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(y.code!==0){const P=new ee(j.UNEXPECTED_RESPONSE,"cross channel ap error, code"+y.code,{retry:!0});throw R.error(P.toString()),P}const T=JSON.parse(y.json_body);if(T.code!==200){const P=new ee(j.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(T.code,", reason: ").concat(T.reason));throw R.error(P.toString()),P}if(!T.servers||T.servers.length===0){const P=new ee(j.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw R.error(P.toString()),P}return{vid:T.vid,workerToken:T.workerToken,addressList:(H("CHANNEL_MEDIA_RELAY_SERVERS")||T.servers).map(P=>"wss://".concat(P.address.replace(/\./g,"-"),".").concat(H("WORKER_DOMAIN"),":").concat(P.wss))}},void 0,y=>!!(y.code!==j.OPERATION_ABORTED&&y.code!==j.UNEXPECTED_RESPONSE||y.data&&y.data.retry),m)}(c,e,t,n));try{const c=await wh(s);return s.forEach(d=>d.cancel()),c}catch(c){throw c[0]}}async function cse(e,t,n){let o=null;const s=[],c=async d=>{const h=H(d?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(p=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(p+"/api/v2/transpond/webrtc?v=2"):"https://".concat(p,"/api/v2/transpond/webrtc?v=2"));return d&&(await cr(1e3),o!==null)?o:await Jf({fragementLength:H("FRAGEMENT_LENGTH"),referenceList:h,asyncMapHandler:p=>(R.debug("[".concat(e.clientId,"] update ticket, Connect to ").concat(d?"backup":""," choose_server:"),p),function(m,g,E,y){const[T]=ise(g,[Pn.CHOOSE_SERVER]);let P=On.networkState;return ws(async()=>{P&&On.networkState===xi.OFFLINE&&On.onlineWaiter&&await ye.race([On.onlineWaiter,cr(y&&y.maxRetryTimeout||Un.maxRetryTimeout)]),P=On.networkState;const I=await As(m,{data:T,cancelToken:E,headers:{"Content-Type":"multipart/form-data;"}},!0);return rse(I,m)},()=>!1,I=>I.code!==j.OPERATION_ABORTED&&(I.code===j.UPDATE_TICKET_FAILED?I.data.retry:(R.warning("[".concat(g.clientId,"] update ticket network error, retry"),I),!0)),y)}(p,e,t,n)),allFailedhandler:p=>{throw p[0]},promisesCollector:s})};try{return o=await wh([c(!1),c(!0)]),s.length&&s.forEach(d=>d.cancel&&typeof d.cancel=="function"&&d.cancel()),o}catch(d){throw d[0]}}function bV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,o)}return n}function FC(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?bV(Object(n),!0).forEach(function(o){x(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):bV(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}class lse extends pn{get isSuccess(){return!!this.configs}constructor(t,n){super(),x(this,"configs",void 0),x(this,"store",void 0),x(this,"joinInfo",void 0),x(this,"cancelToken",void 0),x(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),x(this,"interval",void 0),x(this,"mutex",void 0),x(this,"mutableParamsRead",!1),x(this,"configCache",{}),x(this,"limit_bitrate",void 0),this.mutex=new Ir("config-distribute",t),this.store=n}startGetConfigDistribute(t,n){this.joinInfo=t,this.cancelToken=n,this.interval&&this.stopGetConfigDistribute(),H("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},H("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0,this.configs=void 0,this.limit_bitrate=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,ke.reportApiInvoke(null,{options:void 0,name:Nn.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:En.TRACER}).onSuccess(JSON.stringify(Rs))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void R.debug("[config-distribute] get config distribute interrupted have no joininfo");let t;const n=await this.mutex.lock();try{t=await sse(this.joinInfo,this.cancelToken,this.retryConfig),R.debug("[config-distribute] get config distribute",JSON.stringify(t));const o=function(s){var c;const d=ql(c=Object.keys(s).filter(m=>/^webrtc_ng_global_parameter/.test(m))).call(c);for(let m=0;m<d.length;m++)for(let g=d.length-1;g>m;g--){const E=d[g],y=s[E].value;if(typeof y.__priority=="number"){const T=y.__priority,P=d[g-1],I=s[P].value;if(typeof I.__priority=="number"){if(!(T>I.__priority))continue;{const A=E;d[g]=d[g-1],d[g-1]=A}}else{const A=E;d[g]=d[g-1],d[g-1]=A}}}const h=Date.now();let p={};return d.forEach(m=>{const g=s[m].value.__expires;g&&g<=h||(p[m]=s[m])}),p}(t);this.cacheGlobalParameterConfig(o),this.store.hasStartJoinChannel||(this.store.isABTestSuccess=!0),this.configs=o}catch(o){const s=new ee(j.NETWORK_RESPONSE_ERROR,o);R.warning("[config-distribute] ".concat(s.toString()))}finally{n()}}getBitrateLimit(){return this.limit_bitrate||void 0}handleBitrateLimit(t){jj(t)&&(this.limit_bitrate?this.limit_bitrate&&this.limit_bitrate.id!==t.id&&this.emit(Hf.UPDATE_BITRATE_LIMIT,t):this.emit(Hf.UPDATE_BITRATE_LIMIT,t))}getLowStreamConfigDistribute(){return this.limit_bitrate&&FC({},this.limit_bitrate.low_stream_uplink)}handleABTestConfigDistribute(t){try{const n={},o=Object.keys(t),s=[];o.forEach(c=>{const d=t[c].value;n[c]=d;const h=d.__id;if(h&&this.configCache[c]&&this.configCache[c].__id===h)return;const p=d.__type,m=t[c].value,g=t[c].tag;let E=0;p?p===uM.REALTIME&&(E=1):Object.keys(m).some(y=>Object.prototype.hasOwnProperty.call(KR,y)||!mC()&&Object.prototype.hasOwnProperty.call(PE,y)?(E=1,!0):void 0),s.push({tag:g,isApplied:E,feature:c,params:JSON.stringify(d)})}),s.forEach(c=>{let{tag:d,feature:h,params:p,isApplied:m}=c;this.store.sessionId&&ke.abTest(this.store.sessionId,{intSucc:1,isApplied:m,tag:d,feature:h,params:p,cid:this.store.cid,uid:this.store.intUid})}),this.configCache=n}catch(n){R.debug("handleABTestConfigDistribute error",n)}}cacheGlobalParameterConfig(t){const n=function(s){const c={};return Object.keys(s).forEach(d=>{const h=s[d].value,p=h.__expires,m=h.__type;Object.keys(h).forEach(g=>{g==="__id"||g==="__type"||g==="__priority"||g==="__expires"||Object.prototype.hasOwnProperty.call(c,g)||(c[g]=FC(FC({value:h[g]},p&&{expires:p}),m&&{type:m}))})}),c}(t);try{var o;const s=(o=n.LIMIT_BITRATE)===null||o===void 0?void 0:o.value;delete n.LIMIT_BITRATE,s&&jj(s)&&this.handleBitrateLimit(s),this.limit_bitrate=s,this.handleGlobalParameterConfig(n),this.handleABTestConfigDistribute(t),function(h){try{const p=Date.now();Object.keys(h).forEach(m=>{const{value:g,type:E,expires:y}=h[m];y&&y<=p||((E===uM.REALTIME||Object.prototype.hasOwnProperty.call(KR,m))&&(Rs[m]=g,cn[m]=g,R.debug("Update realtime parameters from config distribute",m,g)),E||mC()||!Object.prototype.hasOwnProperty.call(PE,m)||(Rs[m]=g,cn[m]=g,R.debug("Update gateway parameters from config distribute",m,g)))})}catch(p){R.error("Error update config immediately: ".concat(h),p.message)}}(n);const c=JSON.stringify(n),d=window.btoa(c);window.localStorage.setItem("websdk_ng_global_parameter",d),R.debug("Caching global parameters ".concat(c))}catch(s){R.error("Error caching global parameters:",s.message)}}handleGlobalParameterConfig(t){try{const n=Date.now();Object.keys(t).forEach(o=>{if(o==="CLIENT_ROLE_OPTIONS"&&Object.prototype.hasOwnProperty.call(cn,o)){const{value:s,expires:c}=t[o];if(c&&c<=n)return;(function(d,h){try{return typeof d=="object"&&typeof h=="object"&&JSON.stringify(d)===JSON.stringify(h)}catch{return!1}})(cn[o],s)||(Rs[o]=s,cn[o]=s,this.emit(Hf.UPDATE_CLIENT_ROLE_OPTIONS,s),R.debug("Updating client role options: ".concat(JSON.stringify(s))))}})}catch(n){R.error("Error handling global parameter config:",n.message)}}}class dse extends pn{constructor(){super(...arguments),x(this,"resultStorage",new Map)}setLocalAudioStats(t,n,o){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",t,this.checkAudioInputLevel(o,n)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",t,this.checkSendAudioBitrate(o,n))}setLocalVideoStats(t,n,o){this.record("SEND_VIDEO_BITRATE_TOO_LOW",t,this.checkSendVideoBitrate(o,n)),this.record("FRAMERATE_INPUT_TOO_LOW",t,this.checkFramerateInput(o,n)),this.record("FRAMERATE_SENT_TOO_LOW",t,this.checkFramerateSent(o))}setRemoteAudioStats(t,n){const o=t.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",o,this.checkAudioOutputLevel(n))}setRemoteVideoStats(t,n){const o=t.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",o,this.checkVideoDecode(n))}record(t,n,o){if(H("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(t)||this.resultStorage.set(t,{result:[],isPrevNormal:!0});const s=this.resultStorage.get(t);if(s&&(s.result.push(o),s.result.length>=5)){var c;const d=Ee(c=s.result).call(c,!0);s.isPrevNormal&&!d&&this.emit("exception",IV[t],t,n),!s.isPrevNormal&&d&&this.emit("exception",IV[t]+2e3,t+"_RECOVER",n),s.isPrevNormal=d,s.result=[]}}checkAudioOutputLevel(t){return!(t.receiveBitrate>0&&t.receiveLevel===0)}checkAudioInputLevel(t,n){return n instanceof Bn&&!n.isActive||!!n.muted||t.sendVolumeLevel!==0}checkFramerateInput(t,n){let o=null;n._encoderConfig&&n._encoderConfig.frameRate&&(o=Li(n._encoderConfig.frameRate));const s=t.captureFrameRate;return!o||!s||!(o>10&&s<5||o<10&&o>=5&&s<=1)}checkFramerateSent(t){return!(t.captureFrameRate&&t.sendFrameRate&&t.captureFrameRate>5&&t.sendFrameRate<=1)}checkSendVideoBitrate(t,n){return!!n.muted||t.sendBitrate!==0}checkSendAudioBitrate(t,n){return n instanceof Bn&&!n.isActive||!!n.muted||t.sendBitrate!==0}checkVideoDecode(t){return t.receiveBitrate===0||t.decodeFrameRate!==0}}const IV={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},Or=new class{markSubscribeStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/subscribe-").concat(t))}markPublishStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/publish-").concat(t))}measureFromSubscribeStart(e,t){const n=performance.getEntriesByName("agora-web-sdk/".concat(e,"/subscribe-").concat(t));if(n.length>0){const o=n[n.length-1];return Math.round(performance.now()-o.startTime)}return 0}measureFromPublishStart(e,t){const n=performance.getEntriesByName("agora-web-sdk/".concat(e,"/publish-").concat(t));if(n.length>0){const o=n[n.length-1];return Math.round(performance.now()-o.startTime)}return 0}};function AV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,o)}return n}function md(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?AV(Object(n),!0).forEach(function(o){x(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):AV(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}class Qf{constructor(t){x(this,"store",void 0),x(this,"onStatsException",void 0),x(this,"onUploadPublishDuration",void 0),x(this,"onStatsChanged",void 0),x(this,"onVideoCodecChanged",void 0),x(this,"localStats",new Map),x(this,"remoteStats",new Map),x(this,"updateStatsInterval",void 0),x(this,"trafficStats",void 0),x(this,"trafficStatsPeerList",[]),x(this,"uplinkStats",void 0),x(this,"exceptionMonitor",void 0),x(this,"p2pChannel",void 0),x(this,"scalabilityMode",OE.L1T1),x(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=t,this.exceptionMonitor=new dse,this.exceptionMonitor.on("exception",(n,o,s)=>{this.onStatsException&&this.onStatsException(n,o,s)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(de.LocalAudioTrack)||md({},JR)}getLocalVideoTrackStats(){return this.localStats.get(de.LocalVideoTrack)||md({},QR)}getRemoteAudioTrackStats(t){const n=(c,d)=>{if(!this.trafficStats)return d;const h=this.trafficStats.peer_delay.find(p=>p.peer_uid===c);return h&&(d.publishDuration=h.B_ppad+(Date.now()-this.trafficStats.timestamp)),d},o={};if(t){var s;const c=(s=this.remoteStats.get(t))===null||s===void 0?void 0:s.audioStats;c&&(o[t]=n(t,c))}else Array.from(this.remoteStats.entries()).forEach(c=>{let[d,{audioStats:h}]=c;h&&(o[d]=n(d,h))});return o}getRemoteNetworkQualityStats(t){const n={};if(t){var o;const s=(o=this.remoteStats.get(t))===null||o===void 0?void 0:o.networkStats;s&&(n[t]=s)}else Array.from(this.remoteStats.entries()).forEach(s=>{let[c,{networkStats:d}]=s;d&&(n[c]=d)});return n}getRemoteVideoTrackStats(t){const n=(c,d)=>{if(!this.trafficStats)return d;const h=this.trafficStats.peer_delay.find(p=>p.peer_uid===c);return h&&(d.publishDuration=h.B_ppvd+(Date.now()-this.trafficStats.timestamp)),d},o={};if(t){var s;const c=(s=this.remoteStats.get(t))===null||s===void 0?void 0:s.videoStats;c&&(o[t]=n(t,c))}else Array.from(this.remoteStats.entries()).forEach(c=>{let[d,{videoStats:h}]=c;h&&(o[d]=n(d,h))});return o}getRTCStats(){let t=0,n=0,o=0,s=0;const c=this.localStats.get(de.LocalAudioTrack);c&&(t+=c.sendBytes,n+=c.sendBitrate);const d=this.localStats.get(de.LocalVideoTrack);d&&(t+=d.sendBytes,n+=d.sendBitrate);const h=this.localStats.get(de.LocalVideoLowTrack);h&&(t+=h.sendBytes,n+=h.sendBitrate),this.remoteStats.forEach(m=>{let{audioStats:g,videoStats:E}=m;g&&(o+=g.receiveBytes,s+=g.receiveBitrate),E&&(o+=E.receiveBytes,s+=E.receiveBitrate)});let p=1;return this.trafficStats&&(p+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:p,SendBitrate:n,SendBytes:t,RecvBytes:o,RecvBitrate:s,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(t){this.localStats.set(t,void 0)}removeLocalStats(t){t?this.localStats.delete(t):this.localStats.clear()}addRemoteStats(t){this.remoteStats.set(t,{})}removeRemoteStats(t){t?this.remoteStats.delete(t):this.remoteStats.clear()}addP2PChannel(t){this.p2pChannel=t}updateTrafficStats(t){t.peer_delay=t.peer_delay.filter(n=>n.B_ppad!==void 0||n.B_ppvd!==void 0),t.peer_delay.filter(n=>this.trafficStatsPeerList.indexOf(n.peer_uid)===-1).forEach(n=>{var o;const s=(o=this.p2pChannel)===null||o===void 0?void 0:o.getRemoteMedia(n.peer_uid),c=s!=null&&s.videoSSRC?Or.measureFromSubscribeStart(this.store.clientId,s.videoSSRC):0,d=s!=null&&s.audioSSRC?Or.measureFromSubscribeStart(this.store.clientId,s.audioSSRC):0;n.B_ppad!==void 0&&n.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(n.peer_uid,n.B_ppad,n.B_ppvd,c>d?c:d),this.trafficStatsPeerList.push(n.peer_uid))}),this.trafficStats=t}updateUplinkStats(t){this.uplinkStats&&this.uplinkStats.B_fir!==t.B_fir&&R.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(t.B_fir)),this.uplinkStats=t}static isRemoteVideoFreeze(t,n,o){if(!t)return!1;const s=!!o&&n.framesDecodeFreezeTime>o.framesDecodeFreezeTime,c=!o||n.framesDecodeCount>o.framesDecodeCount;return s||!c}static isRemoteAudioFreeze(t){return!!t&&t._isFreeze()}isLocalVideoFreeze(t){return!(!t.inputFrame||!t.sentFrame)&&t.inputFrame.frameRate>5&&t.sentFrame.frameRate<3}updateLocalStats(t){Array.from(this.localStats.entries()).forEach(n=>{let[o,s]=n;switch(o){case de.LocalVideoTrack:case de.LocalVideoLowTrack:{const h=s,p=md({},QR),m=t.getStats(),g=t.getLocalMedia(o);if(m){const E=m.videoSend.find(y=>y.ssrc===(g==null?void 0:g.ssrcs[0].ssrcId));if(E){const y=t.getLocalVideoSize(),T=t.getEncoderConfig(de.LocalVideoTrack);var c;(E.codec==="H264"||E.codec==="H265"||E.codec==="VP8"||E.codec==="VP9"||E.codec==="AV1X"||E.codec==="AV1")&&(p.codecType=E.codec,(h==null?void 0:h.codecType)!==E.codec&&((c=this.onVideoCodecChanged)===null||c===void 0||c.call(this,E.codec.toLocaleLowerCase()))),p.sendBytes=E.bytes,p.sendBitrate=h?8*Math.max(0,p.sendBytes-h.sendBytes):0,E.inputFrame?(p.captureFrameRate=E.inputFrame.frameRate,p.captureResolutionHeight=E.inputFrame.height,p.captureResolutionWidth=E.inputFrame.width):y&&(p.captureResolutionWidth=y.width,p.captureResolutionHeight=y.height),E.sentFrame?(p.sendFrameRate=E.sentFrame.frameRate,p.sendResolutionHeight=E.sentFrame.height,p.sendResolutionWidth=E.sentFrame.width):y&&(p.sendResolutionWidth=y.width,p.sendResolutionHeight=y.height),E.avgEncodeMs&&(p.encodeDelay=E.avgEncodeMs),T&&T.bitrateMax?p.targetSendBitrate=1e3*T.bitrateMax:E.targetBitrate&&(p.targetSendBitrate=E.targetBitrate),p.sendPackets=E.packets,p.sendPacketsLost=E.packetsLost,p.sendJitterMs=E.jitterMs,p.sendRttMs=E.rttMs,p.totalDuration=h?h.totalDuration+1:1,p.totalFreezeTime=h?h.totalFreezeTime:0,this.isLocalVideoFreeze(E)&&(p.totalFreezeTime+=1),E.scalabilityMode&&this.scalabilityMode!==E.scalabilityMode&&(R.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(E.scalabilityMode)),this.scalabilityMode=E.scalabilityMode)}this.trafficStats&&(p.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var d;this.localStats.set(o,p),((h==null?void 0:h.sendResolutionWidth)!==p.sendResolutionWidth||(h==null?void 0:h.sendResolutionHeight)!==p.sendResolutionHeight)&&((d=this.onStatsChanged)===null||d===void 0||d.call(this,"resolution",{width:p.sendResolutionWidth,height:p.sendResolutionHeight})),p&&g&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,g.track,p);break}case de.LocalAudioTrack:{const h=s,p=md({},JR),m=t.getStats(),g=t.getLocalMedia(o);if(m){const E=m.audioSend.find(y=>y.ssrc===(g==null?void 0:g.ssrcs[0].ssrcId));if(E){if(E.codec!=="opus"&&E.codec!=="aac"&&E.codec!=="PCMU"&&E.codec!=="PCMA"&&E.codec!=="G722"||(p.codecType=E.codec),E.inputLevel)p.sendVolumeLevel=Math.round(32767*E.inputLevel);else{const y=t.getLocalAudioVolume();y&&(p.sendVolumeLevel=Math.round(32767*y))}p.sendBytes=E.bytes,p.sendPackets=E.packets,p.sendPacketsLost=E.packetsLost,p.sendJitterMs=E.jitterMs,p.sendRttMs=E.rttMs,p.sendBitrate=h?8*Math.max(0,p.sendBytes-h.sendBytes):0}}this.trafficStats&&(p.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(de.LocalAudioTrack,p),p&&g&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,g.track,p);break}}})}updateRemoteStats(t){Array.from(this.remoteStats.entries()).forEach(n=>{var o,s;let[c,{videoStats:d,audioStats:h,videoPcStats:p}]=n;const m=h,g=d,E=p,y=md({},TM),T=md({},wM),P=md({},Yie),{audioTrack:I,videoTrack:A,audioSSRC:M,videoSSRC:U}=t.getRemoteMedia(c);let Y;Y=this.store.useP2P?t.getStats(!0):t.getStats();const Q=(o=Y)===null||o===void 0?void 0:o.audioRecv.find(oe=>oe.ssrc===M),J=(s=Y)===null||s===void 0?void 0:s.videoRecv.find(oe=>oe.ssrc===U),X=this.trafficStats&&this.trafficStats.peer_delay.find(oe=>oe.peer_uid===c);if(Q&&(Q.codec!=="opus"&&Q.codec!=="aac"&&Q.codec!=="PCMU"&&Q.codec!=="PCMA"&&Q.codec!=="G722"||(y.codecType=Q.codec),Q.outputLevel?y.receiveLevel=Math.round(32767*Q.outputLevel):I&&(y.receiveLevel=Math.round(32767*I.getVolumeLevel())),y.receiveBytes=Q.bytes,y.receivePackets=Q.packets,y.receivePacketsLost=Q.packetsLost,y.receivePacketsDiscarded=Q.packetsDiscarded,y.packetLossRate=y.receivePacketsLost/(y.receivePackets+y.receivePacketsLost),y.receiveBitrate=m?8*Math.max(0,y.receiveBytes-m.receiveBytes):0,y.totalDuration=m?m.totalDuration+1:1,y.totalFreezeTime=m?m.totalFreezeTime:0,y.freezeRate=y.totalFreezeTime/y.totalDuration,y.receiveDelay=Q.jitterBufferMs,y.totalDuration>10&&Qf.isRemoteAudioFreeze(I)&&(y.totalFreezeTime+=1)),J){var ne;J.codec!=="H264"&&J.codec!=="H265"&&J.codec!=="VP8"&&J.codec!=="VP9"&&J.codec!=="AV1X"&&J.codec!=="AV1"||(T.codecType=J.codec),T.receiveBytes=J.bytes,T.receiveBitrate=g?8*Math.max(0,T.receiveBytes-g.receiveBytes):0,T.decodeFrameRate=J.decodeFrameRate<0?0:J.decodeFrameRate,T.renderFrameRate=J.decodeFrameRate<0?0:J.decodeFrameRate,J.outputFrame&&(T.renderFrameRate=J.outputFrame.frameRate),J.receivedFrame?(T.receiveFrameRate=J.receivedFrame.frameRate,T.receiveResolutionHeight=J.receivedFrame.height,T.receiveResolutionWidth=J.receivedFrame.width):A&&(T.receiveResolutionHeight=A._videoHeight||0,T.receiveResolutionWidth=A._videoWidth||0),J.framesRateFirefox!==void 0&&(T.receiveFrameRate=Math.round(J.framesRateFirefox)),T.receivePackets=J.packets,T.receivePacketsLost=J.packetsLost,T.packetLossRate=T.receivePacketsLost/(T.receivePackets+T.receivePacketsLost);const oe=g?g.totalFreezeTime:0,me=g?g.totalDuration:0;T.totalDuration=g?g.totalDuration+1:1,T.totalFreezeTime=(ne=J.totalFreezesDuration)!==null&&ne!==void 0?ne:oe||0,T.receiveDelay=J.jitterBufferMs||0;const we=!!U&&t.getRemoteVideoIsReady(U);J.totalFreezesDuration===void 0&&A&&we&&Qf.isRemoteVideoFreeze(A,J,E)&&(T.totalFreezeTime+=1),T.freezeRate=Math.max(0,Math.min((T.totalFreezeTime-oe)/(T.totalDuration-me),1))}X&&(y.end2EndDelay=X.B_ad,T.end2EndDelay=X.B_vd,y.transportDelay=X.B_ed,T.transportDelay=X.B_ed,y.currentPacketLossRate=X.B_ealr4/100,T.currentPacketLossRate=X.B_evlr4/100,P.uplinkNetworkQuality=X.B_punq?X.B_punq:0,P.downlinkNetworkQuality=X.B_pdnq?X.B_pdnq:0),this.remoteStats.set(c,{audioStats:y,videoStats:T,videoPcStats:J,networkStats:P}),I&&this.exceptionMonitor.setRemoteAudioStats(I,y),A&&this.exceptionMonitor.setRemoteVideoStats(A,T)})}}class NV{constructor(){x(this,"destChannelMediaInfos",new Map),x(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(t){Mj(t),this.srcChannelMediaInfo=t}addDestChannelInfo(t){Mj(t),this.destChannelMediaInfos.set(t.channelName,t)}removeDestChannelInfo(t){XE(t),this.destChannelMediaInfos.delete(t)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function OV(e){if(!(e instanceof NV))return new ee(j.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const t=e.getSrcChannelMediaInfo(),n=e.getDestChannelMediaInfo();if(!t)return new ee(j.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(n.size===0)return new ee(j.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class Bc{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(t,n){x(this,"uid",void 0),x(this,"_uintid",void 0),x(this,"_trust_in_room_",!0),x(this,"_trust_audio_enabled_state_",!0),x(this,"_trust_video_enabled_state_",!0),x(this,"_trust_audio_mute_state_",!0),x(this,"_trust_video_mute_state_",!0),x(this,"_audio_muted_",!1),x(this,"_video_muted_",!1),x(this,"_audio_enabled_",!0),x(this,"_video_enabled_",!0),x(this,"_audio_added_",!1),x(this,"_video_added_",!1),x(this,"_is_pre_created",!1),x(this,"_video_pre_subscribed",!1),x(this,"_audio_pre_subscribed",!1),x(this,"_trust_video_stream_added_state_",!0),x(this,"_trust_audio_stream_added_state_",!0),x(this,"_audioTrack",void 0),x(this,"_videoTrack",void 0),x(this,"_dataChannels",[]),x(this,"_audioSSRC",void 0),x(this,"_videoSSRC",void 0),x(this,"_audioOrtc",void 0),x(this,"_videoOrtc",void 0),x(this,"_cname",void 0),x(this,"_rtxSsrcId",void 0),x(this,"_videoMid",void 0),x(this,"_audioMid",void 0),this.uid=t,this._uintid=n}}function PV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,o)}return n}function DV(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?PV(Object(n),!0).forEach(function(o){x(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):PV(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}const Zf="9",kV=4e4;function xV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,o)}return n}function Qa(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?xV(Object(n),!0).forEach(function(o){x(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):xV(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}var Rh=function(e){return e[e.DOWN=0]="DOWN",e[e.UP=1]="UP",e}(Rh||{});const lv=new Map;function LV(e,t,n,o){let{scale:s}=e;if(s===0&&o===Rh.UP||s>=t.length-1&&o===Rh.DOWN)return e;let c=Qa(Qa({},e),{},{scale:o===Rh.DOWN?++s:--s});switch(n){case"maintain-framerate":c=Qa(Qa({},c),t[s].motion);break;case"maintain-resolution":c=Qa(Qa({},c),t[s].detail);break;case"balanced":c=Qa(Qa({},c),t[s].balanced)}return c}function MV(e,t){if(t){const n={overUse:0,underUse:0,adaptationList:UV(t)};lv.set(e,n)}else lv.delete(e)}function UV(e){const t=Qa({},e),{bitrateMax:n,frameRate:o,scaleResolutionDownBy:s,bitrateMin:c}=t,{MIN_FRAME_RATE:d,MAX_THRESHOLD_FRAMERATE:h,MAX_SCALE:p,BITRATE_MIN_THRESHOLD:m,BITRATE_MAX_THRESHOLD:g,BWE_SCALE_UP_THRESHOLD:E,BWE_SCALE_DOWN_THRESHOLD:y,PERF_SCALE_DOWN_THRESHOLD:T,PERF_SCALE_UP_THRESHOLD:P,BALANCE_BITRATE_FACTOR:I,BALANCE_FRAMERATE_FACTOR:A,BALANCE_RESOLUTION_FACTOR:M,MOTION_RESOLUTION_FACTOR:U,MOTION_BITRATE_FACTOR:Y,DETAIL_FRAMERATE_FACTOR:Q,DETAIL_BITRATE_FACTOR:J}=GR,X=Math.min(t.frameRate,h),ne=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(y,1)*n),bwe_up:n,fps_down:Math.round(Math.pow(T,1)*X),fps_up:o},balanced:{scaleResolutionDownBy:1,frameRate:o,bitrateMax:n,bitrateMin:c},motion:{scaleResolutionDownBy:1,frameRate:o,bitrateMax:n,bitrateMin:c},detail:{scaleResolutionDownBy:1,frameRate:o,bitrateMax:n,bitrateMin:c}}];for(let oe=1;oe<=p;oe++){const me={bwe_up:Math.round(Math.pow(E,oe)*n),bwe_down:Math.round(Math.pow(y,oe+1)*n),fps_up:Math.round(Math.pow(P,oe)*X),fps_down:Math.round(Math.pow(T,oe+1)*X)},we={scaleResolutionDownBy:s/Math.pow(M,oe),frameRate:Math.max(Math.round(Math.pow(A,oe)*o),d),bitrateMax:Math.max(Math.round(Math.pow(I,oe)*n),g),bitrateMin:Math.max(Math.round(Math.pow(I,oe)*c),m)},ut={scaleResolutionDownBy:s/Math.pow(U,oe),frameRate:o,bitrateMax:Math.max(Math.round(Math.pow(Y,oe)*n),g),bitrateMin:Math.max(Math.round(Math.pow(Y,oe)*c),m)},rt={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(Q,oe)*o),d),bitrateMax:Math.max(Math.round(Math.pow(J,oe)*n),g),bitrateMin:Math.max(Math.round(Math.pow(J,oe)*c),m)};ne.push({scale:oe,threshold:me,balanced:we,motion:ut,detail:rt})}return ne}function use(e,t,n,o,s,c){const d=lv.get(e)||{overUse:0,underUse:0,adaptationList:UV(s)},{adaptationList:h}=d;lv.set(e,d);const{OVERUSE_TIMES_THRESHOLD:p,UNDERUSE_TIMES_THRESHOLD:m}=GR,{scale:g}=o;let E,y;return typeof t=="number"&&t>0&&function(T,P,I,A){if(P>=I.length)return!1;let{threshold:{fps_down:M}}=I[P];return H("FORCE_AG_HIGH_FRAMERATE")&&A==="maintain-framerate"&&(M=I[0].threshold.fps_down),T<M}(t,g,h,c)&&(d.overUse++,y=Mf.CPU,d.overUse>p)||typeof n=="number"&&n>0&&function(T,P,I){if(P>=I.length)return!1;const{threshold:{bwe_down:A}}=I[P];return T<A}(n,g,h)&&(d.overUse++,y=Mf.BANDWIDTH,d.overUse>p)?(d.overUse=0,d.underUse=0,E=LV(o,h,c,Rh.DOWN),[E,y]):(typeof t=="number"&&t>0&&typeof n=="number"&&n>0&&function(T,P,I,A){if(P===0)return;let{threshold:{fps_up:M}}=I[P];return H("FORCE_AG_HIGH_FRAMERATE")&&A==="maintain-framerate"&&(M=I[1].threshold.fps_up),T>M}(t,g,h,c)&&function(T,P,I){if(P===0)return;const{threshold:{bwe_up:A}}=I[P];return T>A}(n,g,h)&&(d.underUse++,d.underUse>m&&(d.overUse=0,d.underUse=0,E=LV(o,h,c,Rh.UP),E.scale===0&&(y=Mf.NONE))),[E,y])}function jV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,o)}return n}function BC(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?jV(Object(n),!0).forEach(function(o){x(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):jV(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}function hse(e){var t;return!!H("ENABLE_AG_ADAPTATION")&&!!(e instanceof aC||Ee(t=e._hints).call(t,Gt.CUSTOM_TRACK))&&(!!H("FORCE_SUPPORT_AG_ADAPTATION")||!!(function(n){const o=wt();if(o.os!==Xn.IOS||!o.osVersion)return!1;const s=o.osVersion.split(".");return Number(s[0])>=n}(14)&&k2(17,4)||D2(14)&&x2(17,4)))}const dv=new Map;function uv(e,t){const n=dv.get(e);if(n){const{timer:o}=n;window.clearTimeout(o),dv.delete(e)}t.qualityLimitationReason=Mf.NONE,MV(e)}function pse(e,t){var n;let o;switch(t){case de.LocalAudioTrack:o=xt.Audio;break;case de.LocalVideoTrack:o=Ee(n=e._hints).call(n,Gt.SCREEN_TRACK)?xt.Screen:xt.High;break;case de.LocalVideoLowTrack:o=xt.Low}return o}function WC(e){const t=Rt();if(e.some(n=>n._bypassWebAudio))throw new re(j.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!t.webAudioMediaStreamDest)throw new re(j.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function HC(e,t){WC(e);const n=new Bn;return e.forEach(o=>n.addAudioTrack(o)),n}const fse=!Rt().supportUnifiedPlan||H("CHROME_FORCE_PLAN_B")&&Ga();function hv(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var n;return fse?(n={spec:t,store:e},Ja("PlanBConnection").create(n)):new fa(t,e)}function GC(e){return e&&(e.iceConnectionState==="disconnected"||e.iceConnectionState==="checking"||e.iceConnectionState==="failed")}function VV(e){try{if(e.iceServers)return!1;if(e.turnServer&&e.turnServer.mode!=="off"){if(kf(e.turnServer.servers))return!1;if(H("FORCE_TURN_TCP")||e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).some(t=>t.forceturn))return!0}return!1}catch{return!1}}var yt;function FV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,o)}return n}function Ns(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?FV(Object(n),!0).forEach(function(o){x(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):FV(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}let fa=(yt=class Pd extends Fj{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,n;return(t=(n=this.peerConnection.getReceivers()[0])===null||n===void 0||(n=n.transport)===null||n===void 0?void 0:n.state)!==null&&t!==void 0?t:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"").filter(t=>{var n;return Ee(n=Object.keys(DE)).call(n,t)}))]}constructor(t,n){super(t,n),x(this,"id",Jt(5,"connection-")),x(this,"store",void 0),x(this,"peerConnection",void 0),x(this,"forceTurn",!1),x(this,"remoteSDP",void 0),x(this,"initialOffer",void 0),x(this,"transportEventReceiver",void 0),x(this,"statsFilter",void 0),x(this,"extension",{useXR:H("USE_XR")}),x(this,"localCapabilities",void 0),x(this,"remoteCodecs",void 0),x(this,"localCandidateCount",0),x(this,"allCandidatesReceived",!1),x(this,"isPreallocation",!1),x(this,"preSSRCMap",new Map),x(this,"dataStreamChannelMap",new Map),x(this,"establishPromise",void 0),x(this,"recoveredDataChannelIds",[]),x(this,"currentDataChannelId",1),x(this,"supportAV1RtpSpec",!1),x(this,"mutex",void 0),x(this,"qualityLimitationReason",Mf.NONE),x(this,"isFirstConnected",!1),this.store=n,this.forceTurn=VV(t),this.mutex=new Ir("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(Pd.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.isFirstConnected=!1,this.statsFilter=BR(this.peerConnection,H("STATS_UPDATE_INTERVAL"),void 0,gn()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}getPreMedia(t){const n=this.preSSRCMap.get(t);if(n!==void 0){const o=this.peerConnection.getTransceivers().find(s=>s.mid===n);if(o)return{transceiver:o,track:o.receiver.track,id:n}}}async updateRemoteRTPCapabilities(t,n){if(this.remoteCodecs=n,!this.remoteSDP)return void R.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(n));if(this.remoteSDP.updateRemoteCodec(t,n,this.store.codec)){const o=await this.peerConnection.createOffer(),s=this.logSDPExchange(o.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(o);const c=this.remoteSDP.toString();s==null||s(c),await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}else R.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const o=await this.peerConnection.createOffer();if(!o.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const s=Vc(o.sdp),c=await oV({filterRTX:!H("USE_PUB_RTX")&&!H("USE_SUB_RTX"),filterVideoFec:H("FILTER_VIDEO_FEC"),filterAudioFec:H("FILTER_AUDIO_FEC"),filterVideoCodec:H("FILTER_VIDEO_CODEC")},this.extension);if(this.localCapabilities=iv(c),this.initialOffer=o,H("ENABLE_SVC")&&this.store.codec=="av1"){const h=await async function(){try{const p=new RTCPeerConnection;p.addTransceiver("video",{direction:"sendonly",sendEncodings:[{scalabilityMode:OE.L1T3}]});const m=await p.createOffer();if(!m.sdp)return void p.close();const g=_i(m.sdp).mediaDescriptions[0];if(!g)return;const E=g.attributes.extmaps.find(y=>y.extensionName==="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension");return p.close(),E}catch{return}}();var t;h&&(this.supportAV1RtpSpec=!0,(t=c.send)===null||t===void 0||t.videoExtensions.push(h))}let d;return o.sdp&&lV(o.sdp)&&(d=fn(c),(n=d).send&&(vh(Re.VIDEO,n.send.videoExtensions),vh(Re.AUDIO,n.send.audioExtensions)),n.recv&&(vh(Re.VIDEO,n.recv.videoExtensions),vh(Re.AUDIO,n.recv.audioExtensions)),n.sendrecv&&(vh(Re.VIDEO,n.sendrecv.videoExtensions),vh(Re.AUDIO,n.sendrecv.audioExtensions))),Ns(Ns({},s),{},{rtpCapabilities:d||c,offerSDP:o.sdp})}catch(o){throw new re(j.GET_LOCAL_CONNECTION_PARAMS_FAILED,o.toString())}var n}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.initialOffer.sdp&&lV(this.initialOffer.sdp)&&(n=t.rtpCapabilities,o=this.localCapabilities,n.send&&(tv(Re.VIDEO,n.send.videoExtensions,o.send.videoExtensions),tv(Re.AUDIO,n.send.audioExtensions,o.send.audioExtensions)),n.recv&&(tv(Re.VIDEO,n.recv.videoExtensions,o.recv.videoExtensions),tv(Re.AUDIO,n.recv.audioExtensions,o.recv.audioExtensions))),this.remoteSDP=new class{get localCapabilities(){return fn(this._localCapabilities)}get rtpCapabilities(){return fn(this._rtpCapabilities)}get candidates(){return fn(this._candidates)}get iceParameters(){return fn(this._iceParameters)}get dtlsParameters(){return fn(this._dtlsParameters)}constructor(m){let g=arguments.length>1&&arguments[1]!==void 0&&arguments[1];x(this,"sessionDesc",void 0),x(this,"_localCapabilities",void 0),x(this,"_rtpCapabilities",void 0),x(this,"_candidates",void 0),x(this,"_originCandidates",void 0),x(this,"_iceParameters",void 0),x(this,"_isUseExtmapAllowMixed",void 0),x(this,"_dtlsParameters",void 0),x(this,"setup",void 0),x(this,"currentMidIndex",void 0),x(this,"cname",void 0),x(this,"firefoxSsrcMidMap",new Map),this._isUseExtmapAllowMixed=g,m=fn(m);const{iceParameters:E,dtlsParameters:y,candidates:T,rtpCapabilities:P,setup:I,localCapabilities:A,cname:M}=m;this._rtpCapabilities=P,this._candidates=T,this._originCandidates=fn(T),this._iceParameters=E,this._dtlsParameters=y,this._localCapabilities=A,this.setup=I,this.cname=M,this.sessionDesc=this.updateRemoteRTPCapabilities(P),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}preloadRemoteMedia(m){const g=this.candidates,E=this.dtlsParameters,y=this.iceParameters,T=this.rtpCapabilities.send;let P=this.sessionDesc.mediaDescriptions.length-1;for(let I=1;I<m;I++){const A=2*I+2e4,M=2*I+kV,{ssrcs:U,ssrcGroups:Y}=fd([{ssrcId:A}],this.cname),{ssrcs:Q,ssrcGroups:J}=fd([{ssrcId:M,rtx:H("USE_SUB_RTX")?M+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:Zf,protos:["UDP","TLS","RTP","SAVPF"],fmts:T.videoCodecs.map(X=>X.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:y.iceUfrag,icePwd:y.icePwd,unrecognized:[],candidates:g,extmaps:T.videoExtensions,fingerprints:E.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:Q,ssrcGroups:J,rtcpFeedbackWildcards:[],payloads:T.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++P)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:Zf,protos:["UDP","TLS","RTP","SAVPF"],fmts:T.audioCodecs.map(X=>X.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:y.iceUfrag,icePwd:y.icePwd,unrecognized:[],candidates:g,extmaps:T.audioExtensions,fingerprints:E.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:U,ssrcGroups:Y,rtcpFeedbackWildcards:[],payloads:T.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++P)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return xc(this.sessionDesc)}send(m,g,E,y){const{ssrcs:T,ssrcGroups:P}=fd(g,this.cname,H("SYNC_GROUP")?E:void 0),I=this.findPreloadMediaDesc(T);if(I){if(gn()&&this.firefoxSsrcMidMap.set(T[0].ssrcId,I.attributes.mid),y&&(y.twcc||y.remb)){const A=this.sessionDesc.mediaDescriptions.indexOf(I);return this.sessionDesc.mediaDescriptions[A]=this.mungSendMediaDesc(I,y),{mid:I.attributes.mid,needExchangeSDP:!0}}return{mid:I.attributes.mid,needExchangeSDP:!1}}{const A=this.findAvailableMediaIndex(m,T);let M;return A===-1||A===1&&(gr()||function(){const U=wt();return!(U.name!==Ot.CHROME||!U.osVersion)&&Number(U.version)<=90}()||H("ENABLE_ENCODED_TRANSFORM")&&Ha())||A===0&&H("USE_SUB_RTX")||L2()?(M=this.createOrRecycleSendMedia(m,T,P,"sendonly",y),this.updateBundleMids()):(M=fn(this.sessionDesc.mediaDescriptions[A]),M.attributes.direction="sendonly",M.attributes.ssrcs=T,M.attributes.ssrcGroups=P,this.sessionDesc.mediaDescriptions[A]=this.mungSendMediaDesc(M,y)),gn()&&this.firefoxSsrcMidMap.set(T[0].ssrcId,M.attributes.mid),{mid:M.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:m,needExchangeSDP:g}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:m.attributes.mid,needExchangeSDP:g}}batchSend(m){const g=m.map(T=>{let{kind:P,ssrcMsg:I,mslabel:A}=T;return this.send(P,I,A)}),E=[];let y=!1;return g.forEach(T=>{let{mid:P,needExchangeSDP:I}=T;I&&(y=!0),E.push(P)}),{mids:E,needExchangeSDP:y}}stopSending(m){const g=this.sessionDesc.mediaDescriptions.filter(E=>E.attributes.mid&&m.indexOf(E.attributes.mid)!==-1);if(g.length!==m.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");g.forEach(E=>{E.attributes.mid==="0"||gn()||L2()?E.attributes.ssrcs=[]:(E.attributes.ssrcs=[],E.attributes.direction="inactive",E.media.port="0")}),this.updateBundleMids()}mute(m){const g=this.sessionDesc.mediaDescriptions.find(E=>E.attributes.mid===m);if(!g)throw new Error("mediaDescription not found with ".concat(m," in remote SDP when calling RemoteSDP.mute."));g.attributes.direction="inactive"}unmute(m){const g=this.sessionDesc.mediaDescriptions.find(E=>E.attributes.mid===m);if(!g)throw new Error("mediaDescription not found with ".concat(m," in remote SDP when calling RemoteSDP.unmute."));g.attributes.direction="sendonly"}muteRemote(m){const g=this.sessionDesc.mediaDescriptions.filter(E=>Ee(m).call(m,E.attributes.mid||""));if(g.length!==m.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");g.forEach(E=>{E.attributes.direction="inactive"})}unmuteRemote(m){const g=this.sessionDesc.mediaDescriptions.filter(E=>Ee(m).call(m,E.attributes.mid||""));if(g.length!==m.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");g.forEach(E=>{E.attributes.direction="recvonly"})}receive(m,g,E,y){m.forEach((T,P)=>{this.createOrRecycleRecvMedia(T,[],"recvonly",g,E,y[P])}),this.updateBundleMids()}stopReceiving(m){const g=this.sessionDesc.mediaDescriptions.filter(E=>m.indexOf(E.attributes.mid)!==-1);if(g.length!==m.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");g.forEach(E=>{E.media.port="0",E.attributes.direction="inactive"}),this.updateBundleMids()}updateRemoteRTPCapabilities(m){const g=this.sessionDesc||_i((E=this._isUseExtmapAllowMixed,`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite`.concat(E?`
a=extmap-allow-mixed`:"",`
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`)));var E;this._rtpCapabilities=m;const y=this.rtpCapabilities.send,T=this.localCapabilities.send;for(const P of g.mediaDescriptions){if(P.attributes.iceUfrag=this._iceParameters.iceUfrag,P.attributes.icePwd=this._iceParameters.icePwd,P.attributes.fingerprints=this._dtlsParameters.fingerprints,P.attributes.candidates=this._candidates,P.attributes.setup=this.setup,P.media.mediaType==="application"&&(P.attributes.sctpPort="5000"),P.media.mediaType==="video"){if(y.videoCodecs.length===0){const I=T.videoCodecs.filter(A=>{var M,U;return(M=A.rtpMap)===null||M===void 0?void 0:Ee(U=M.encodingName.toLowerCase()).call(U,"vp8")})||[T.videoCodecs[0]];P.media.fmts=I.map(A=>A.payloadType.toString(10)),P.attributes.payloads=I,P.attributes.extmaps=[]}else if(P.media.fmts=y.videoCodecs.map(I=>I.payloadType.toString(10)),P.attributes.payloads=y.videoCodecs,P.attributes.extmaps=y.videoExtensions,H("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:I,ssrcGroups:A}=fd([{ssrcId:kV,rtx:H("USE_SUB_RTX")?40001:void 0}],this.cname);P.attributes.ssrcs=I,P.attributes.ssrcGroups=A}}if(P.media.mediaType==="audio"){if(y.audioCodecs.length===0){const I=T.audioCodecs.filter(A=>{var M,U;return(M=A.rtpMap)===null||M===void 0?void 0:Ee(U=M.encodingName.toLowerCase()).call(U,"opus")})||[T.audioCodecs[0]];P.media.fmts=I.map(A=>A.payloadType.toString(10)),P.attributes.payloads=I,P.attributes.extmaps=[]}else if(P.media.fmts=y.audioCodecs.map(I=>I.payloadType.toString(10)),P.attributes.payloads=y.audioCodecs,P.attributes.extmaps=y.audioExtensions,Sh(P),H("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:I,ssrcGroups:A}=fd([{ssrcId:2e4}],this.cname);P.attributes.ssrcs=I,P.attributes.ssrcGroups=A}}}return this.sessionDesc=g,this.currentMidIndex=g.mediaDescriptions.length-1,this.sessionDesc}updateCandidates(m){const g=this._originCandidates.filter(y=>y.transport==="udp"),E=[];if(g.forEach(y=>{E.push(DV(DV({},y),{},{foundation:"tcpcandidate",priority:Number(y.priority)-1+"",transport:"tcp",port:Number(y.port)+90+""}))}),g.length!==0){switch(m){case Nr.TCP_RELAY:this._candidates=E;break;case Nr.UDP_TCP_RELAY:case Nr.RELAY:this._candidates=[...g,...E];break;default:this._candidates=g}for(const y of this.sessionDesc.mediaDescriptions)y.attributes.candidates=this.candidates}}restartICE(m){m=fn(m),this._iceParameters=m,this.sessionDesc.mediaDescriptions.forEach(g=>{g.attributes.iceUfrag=m.iceUfrag,g.attributes.icePwd=m.icePwd})}predictReceivingMids(m){const g=[];for(let E=0;E<m;E++)g.push((this.currentMidIndex+E+1).toString(10));return g}findAvailableMediaIndex(m,g){return this.sessionDesc.mediaDescriptions.findIndex(E=>{const y=E.media.mediaType===m&&E.media.port!=="0"&&(E.attributes.direction==="sendonly"||E.attributes.direction==="sendrecv")&&E.attributes.ssrcs.length===0;if(gn()){if(y){const T=this.firefoxSsrcMidMap.get(g[0].ssrcId);return!(T||E.attributes.mid!=="0"&&E.attributes.mid!=="1")||!(!T||T!==E.attributes.mid)}return!1}return y})}createOrRecycleDataChannel(){for(const E of this.sessionDesc.mediaDescriptions)if(E.media.mediaType==="application")return{mediaDesc:E,needExchangeSDP:!1};this.currentMidIndex+=1;const m="".concat(this.currentMidIndex),g={media:{mediaType:"application",port:Zf,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(m),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(g),{mediaDesc:g,needExchangeSDP:!0}}createOrRecycleRecvMedia(m,g,E,y,T,P){const I=m._mediaStreamTrack.kind,A=this.rtpCapabilities.recv,M=qf(I,A,this.localCapabilities.send,I===Re.VIDEO?y:T),U=I===Re.VIDEO?A.videoExtensions:A.audioExtensions;this.currentMidIndex+=1;const Y="".concat(this.currentMidIndex);let Q={media:{mediaType:I,port:Zf,protos:["UDP","TLS","RTP","SAVPF"],fmts:M.map(X=>X.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:U,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:g,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:M,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:E,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(Y)}};Q=this.mungRecvMediaDsec(Q,m,P);const J=this.findFirstClosedMedia(I);if(J){const X=this.sessionDesc.mediaDescriptions.indexOf(J);this.sessionDesc.mediaDescriptions[X]=Q}else this.sessionDesc.mediaDescriptions.push(Q);return Q}updateRemoteCodec(m,g,E){const y=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(Q=>Q.rtpMap&&Q.rtpMap.encodingName.toLowerCase()||"").filter(Q=>{var J;return Ee(J=Object.keys(DE)).call(J,Q)}))],T=new Set(g);if(y.every(Q=>T.has(Q)))return R.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(g)),!1;const P=this._rtpCapabilities.recv.videoCodecs.filter(Q=>g.some(J=>{var X;return Ee(X=Q.rtpMap&&Q.rtpMap.encodingName.toLowerCase()||"").call(X,J)}));if(P.length===0)return R.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(y," codecs: ").concat(g)),!1;const I=[...new Set(P.map(Q=>Q.rtpMap&&Q.rtpMap.encodingName.toLowerCase()||""))];let A;if(R.debug("updateRemoteCodec, from ".concat(y," to ").concat(I)),m.length===0)A=this.sessionDesc.mediaDescriptions.filter(Q=>Q.media.mediaType==="video"&&Q.attributes.direction==="recvonly");else if(A=this.sessionDesc.mediaDescriptions.filter(Q=>Q.attributes.mid&&Ee(m).call(m,Q.attributes.mid)&&Q.attributes.direction==="recvonly"),A.length!==m.length)return R.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(m,", codecs: ").concat(g)),!1;if(H("USE_PUB_RTX")||H("USE_SUB_RTX")){const Q=OC(P,this.rtpCapabilities.recv.videoCodecs);P.push(...Q)}this._rtpCapabilities.recv.videoCodecs=P;const M=this.localCapabilities.send,U=this.rtpCapabilities.recv,Y=qf(Re.VIDEO,U,M,E);return A.forEach(Q=>{const J=Y.map(X=>X.payloadType.toString(10));R.debug("updateRemoteCodec mid: ".concat(Q.attributes.mid,", from"),Q.attributes.payloads,"to",Y),Q.attributes.payloads=Y,Q.media.fmts=J}),!0}createOrRecycleSendMedia(m,g,E,y,T){const P=this.rtpCapabilities.send,I=m===Re.VIDEO?P.videoCodecs:P.audioCodecs,A=m===Re.VIDEO?P.videoExtensions:P.audioExtensions;this.currentMidIndex+=1;const M="".concat(this.currentMidIndex);let U={media:{mediaType:m,port:Zf,protos:["UDP","TLS","RTP","SAVPF"],fmts:I.map(Q=>Q.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:A,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:g,ssrcGroups:E,rtcpFeedbackWildcards:[],payloads:I,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:y,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(M)}};U=this.mungSendMediaDesc(U,T);const Y=this.findFirstClosedMedia(m);if(Y){const Q=this.sessionDesc.mediaDescriptions.indexOf(Y);this.sessionDesc.mediaDescriptions[Q]=U}else this.sessionDesc.mediaDescriptions.push(U);return U}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(m=>m.media.port!=="0").map(m=>m.attributes.mid)}mungRecvMediaDsec(m,g,E){const y=fn(m);return AC(y),yh(y,g),NC(y,g),rV(y),rv(y,E,this.localCapabilities.send),y}mungSendMediaDesc(m,g){const E=fn(m);return rv(E,g,this.localCapabilities.recv),Sh(E),E}updateRecvMedia(m,g){const E=this.sessionDesc.mediaDescriptions.findIndex(y=>y.attributes.mid===m);if(E!==-1){const y=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[E],g);this.sessionDesc.mediaDescriptions[E]=y}}bumpMid(m){this.currentMidIndex+=m}findFirstClosedMedia(m){return this.sessionDesc.mediaDescriptions.find(g=>gn()?g.media.port==="0"&&g.media.mediaType===m:g.media.port==="0")}findPreloadMediaDesc(m){return this.sessionDesc.mediaDescriptions.find(g=>{var E;return((E=g.attributes)===null||E===void 0||(E=E.ssrcs[0])===null||E===void 0?void 0:E.ssrcId)===m[0].ssrcId})}getSSRC(m){var g;return(g=this.sessionDesc.mediaDescriptions.find(E=>E.attributes.mid===m))===null||g===void 0?void 0:g.attributes.ssrcs}}(Ns(Ns({},t),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec),t.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const s=this.remoteSDP.toString(),c=aV(this.initialOffer.sdp,this.extension),d=this.logSDPExchange(c||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),d==null||d(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s});const h=this.peerConnection.getTransceivers()[0];if(h!=null&&h.receiver&&this.tryBindTransportEvents(h.receiver),H("PRELOAD_MEDIA_COUNT")>0){this.remoteSDP.preloadRemoteMedia(H("PRELOAD_MEDIA_COUNT"));const m=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:m});const g=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(g)}const{preSSRCs:p}=t;if(Array.isArray(p)&&p.length>0){const{mids:m}=this.remoteSDP.batchSend(p.map(g=>({kind:g.kind,ssrcMsg:[{ssrcId:g.ssrcId,rtx:g.rtx}],mslabel:g.mslabel})));m.forEach((g,E)=>{this.preSSRCMap.set(p[E].ssrcId,g)}),await Xf(this.peerConnection,this.remoteSDP,this.extension),R.debug("[".concat(this.store.clientId,"] [P2PConnection] pre-batchReceive exchange SDP."))}}catch(s){throw new re(j.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(s.toString()))}var n,o}async updateRemoteConnect(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");const{rtpCapabilities:n}=t;this.remoteSDP.updateRemoteRTPCapabilities(n),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const{preSSRCs:o}=t;if(Array.isArray(o)&&o.length>0){const{mids:s}=this.remoteSDP.batchSend(o.map(c=>Object.assign({},{kind:c.kind,ssrcMsg:[{ssrcId:c.ssrcId,rtx:c.rtx}],mslabel:c.mslabel})));s.forEach((c,d)=>{this.preSSRCMap.set(o[d].ssrcId,c)})}await Xf(this.peerConnection,this.remoteSDP,this.extension),R.debug("[P2PConnection] updateRemoteRTPCapabilities by exchanging SDP.")}catch(n){throw new re(j.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(n.toString()))}}send(t,n,o){var s=this;return ho(function*(){const c=yield Tt(s.mutex.lock("From P2PConnection.send"));try{if(!s.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const d=[],h=ev();t.forEach(A=>{const M=s.peerConnection.addTransceiver(A._mediaStreamTrack,Ns({direction:"sendonly"},A.trackMediaType==="video"&&s.supportAV1RtpSpec&&h?{sendEncodings:[{scalabilityMode:h}]}:{}));d.push(M),A._updateRtpTransceiver(M)}),gn()&&H("SIMULCAST")===!0&&(yield Tt(s.applySimulcastForFirefox(d,t)));const p=yield Tt(s.peerConnection.createOffer()),m=s.remoteSDP.predictReceivingMids(t.length),g=s.mungSendOfferSDP(p.sdp,t,m),E=_i(g),y=m.map(A=>{const M=E.mediaDescriptions.find(U=>U.attributes.mid===A);if(!M)throw new Error("Cannot extract ssrc from mediaDescription.");return eV(M,H("USE_PUB_RTX"))});let T;try{T=yield y}catch(A){T=[],s.remoteSDP.receive(t,n,o,T);const M=s.remoteSDP.toString();throw yield Tt(s.peerConnection.setLocalDescription({type:"offer",sdp:g})),yield Tt(s.peerConnection.setRemoteDescription({type:"answer",sdp:M})),yield Tt(s.stopSending(m,!0)),A}s.remoteSDP.receive(t,n,o,T);const P=s.remoteSDP.toString(),I=s.logSDPExchange(g,"offer","local","send");return yield Tt(s.peerConnection.setLocalDescription({type:"offer",sdp:g})),yield Tt(s.applySimulcastEncodings(d,t)),yield Tt(s.applySendEncodings(d,t)),I==null||I(P),yield Tt(s.peerConnection.setRemoteDescription({type:"answer",sdp:P})),d.map((A,M)=>{const U=m[M];return{localSSRC:y[M],id:U,transceiver:A}})}catch(d){throw d instanceof re?d:new re(j.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(d.toString()))}finally{c()}})()}async createDataChannels(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let o=this.dataStreamChannelMap.get(t);if(o&&o.readyState==="open")R.debug("[P2PConnection] Channels are already available and can be reused directly.");else{const c=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof c!="number")throw new Error("create DataChannel error, because cannot get dc id");o=this.peerConnection.createDataChannel("datastream-channel",{id:c,negotiated:!0,ordered:!1,maxRetransmits:H("DATASTREAM_MAX_RETRANSMITS")}),o.binaryType="arraybuffer",this.dataStreamChannelMap.set(t,o)}n.forEach(c=>{c._updateOriginDataChannel(o)});const{needExchangeSDP:s}=this.remoteSDP.sendDataChannel();if(s){const c=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:c});const d=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(d),R.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else R.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(o){throw o instanceof re?o:new re(j.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(o.toString()))}}async stopDataChannels(t){try{const n=this.dataStreamChannelMap.get(t);return n&&(n.id&&this.recoveredDataChannelIds.push(n.id),n.close()),void this.dataStreamChannelMap.delete(t)}catch(n){throw n instanceof re?n:new re(j.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(n.toString()))}}async stopSending(t,n){const o=n?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const s=this.peerConnection.getTransceivers().filter(p=>t.indexOf(p.mid)!==-1);if(s.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");s.map(p=>{var m;uv(this.id+p.mid,this),p.direction="inactive",(m=p.stop)===null||m===void 0||m.call(p)});const c=await this.peerConnection.createOffer(),d=this.logSDPExchange(c.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(c),this.remoteSDP.stopReceiving(t);const h=this.remoteSDP.toString();d==null||d(h),await this.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(s){throw new re(j.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(s.toString()))}finally{o&&o()}}async receive(t,n,o,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:c,needExchangeSDP:d}=this.remoteSDP.send(t,n,o,s);d&&(await Xf(this.peerConnection,this.remoteSDP,this.extension),R.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP.")));const h=this.peerConnection.getTransceivers().find(p=>p.mid===c);if(!h)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:h.receiver.track,id:c,transceiver:h}}catch(c){throw new re(j.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(c.toString()))}}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:n,needExchangeSDP:o}=this.remoteSDP.batchSend(t);return o&&(await Xf(this.peerConnection,this.remoteSDP,this.extension),R.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),n.map(s=>{const c=this.peerConnection.getTransceivers().find(d=>d.mid===s);if(!c)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:c.receiver.track,id:s,transceiver:c}})}catch(n){throw new re(j.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(n.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");t.forEach(c=>{Array.from(this.preSSRCMap.entries()).some(d=>{let[h,p]=d;if(p===c)return this.preSSRCMap.delete(h),!0})}),this.remoteSDP.stopSending(t);const n=this.remoteSDP.toString(),o=this.logSDPExchange(n,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const s=await this.peerConnection.createAnswer();o==null||o(s.sdp||""),await this.peerConnection.setLocalDescription(s)}catch(n){throw new re(j.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async muteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.mute(t);const n=this.remoteSDP.toString(),o=this.logSDPExchange(n,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const s=await this.peerConnection.createAnswer();o==null||o(s.sdp||""),await this.peerConnection.setLocalDescription(s)}catch(n){throw new re(j.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(n.toString()))}}async unmuteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.unmute(t);const n=this.remoteSDP.toString(),o=this.logSDPExchange(n,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const s=await this.peerConnection.createAnswer();o==null||o(s.sdp||""),await this.peerConnection.setLocalDescription(s)}catch(n){throw new re(j.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(n.toString()))}}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(d=>d.mid&&t.indexOf(d.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(d=>{d.direction="inactive"});const o=await this.peerConnection.createOffer(),s=this.logSDPExchange(o.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.muteRemote(t);const c=this.remoteSDP.toString();s==null||s(c),await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(n){throw new re(j.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(d=>d.mid&&t.indexOf(d.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(async(d,h)=>{d.direction="sendonly"});const o=await this.peerConnection.createOffer(),s=this.logSDPExchange(o.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.unmuteRemote(t),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(t,this.remoteCodecs,this.store.codec);const c=this.remoteSDP.toString();s==null||s(c),await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(n){throw new re(j.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}restartICE(t){var n=this;return ho(function*(){const o=yield Tt(n.mutex.lock("From P2PConnection.restartICE"));try{if(!n.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const s=Rt().supportPCSetConfiguration,c=H("FORCE_TURN_TCP")||n.forceTurn;if(t===Nr.RELAY&&!s)return;if(s&&!c){const E=t===Nr.RELAY?"relay":"all",y=n.peerConnection.getConfiguration();y.iceTransportPolicy!==E&&(R.debug("[".concat(n.store.clientId,"] restartICE change iceTransportPolicy from [").concat(y.iceTransportPolicy,"] to [").concat(E,"]")),y.iceTransportPolicy=E,n.peerConnection.setConfiguration(y))}n.remoteSDP.updateCandidates(t);const d=yield Tt(n.peerConnection.createOffer({iceRestart:!0}));if(!d.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const h=Vc(d.sdp),{remoteIceParameters:p}=yield h.iceParameters;n.remoteSDP.restartICE(p);const m=n.remoteSDP.toString(),g=n.logSDPExchange(d.sdp||"","offer","local","restartICE");n.store.descriptionStart(),yield Tt(n.peerConnection.setLocalDescription(d)),g==null||g(m),yield Tt(n.peerConnection.setRemoteDescription({type:"answer",sdp:m}))}catch(s){R.warning("[".concat(n.store.clientId,"] restart ICE failed, abort operation"),s)}finally{o()}})()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;const t=await this.mutex.lock("From P2PConnection.extendCandidate");try{this.remoteSDP.updateCandidates(Nr.TCP_RELAY),await Xf(this.peerConnection,this.remoteSDP,this.extension)}catch(n){R.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),n)}finally{t()}}close(){var t;this.peerConnection.getTransceivers().forEach(n=>{uv(this.id+n.mid,this)}),this.preSSRCMap.clear(),this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return Ns(Ns({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const o=await this.peerConnection.createOffer(),s=this.mungSendOfferSDP(o.sdp,[n],[t]);this.remoteSDP.updateRecvMedia(t,n);const c=this.remoteSDP.toString(),d=this.logSDPExchange(s,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:s}),d==null||d(c),await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(o){throw new re(j.EXCHANGE_SDP_FAILED,o.toString())}}async updateSendParameters(t,n){const o=this.peerConnection.getTransceivers().filter(s=>s.mid===t);o.length===1&&(this.isVP8Simulcast(n)?gn()||await this.applySimulcastEncodings(o,[n]):await this.applySendEncodings(o,[n]))}setStatsRemoteVideoIsReady(t,n){this.statsFilter.setVideoIsReady2(t,n)}async replaceTrack(t,n){const o=this.peerConnection.getTransceivers().find(s=>s.mid===n);o&&await o.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){const t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){const n=t[0].transport.iceTransport,{local:o,remote:s}=n.getSelectedCandidatePair();return{local:Ns(Ns({},aa),{},{candidateType:o.type,protocol:o.protocol,address:o.address,port:o.port}),remote:Ns(Ns({},aa),{},{candidateType:s.type,protocol:s.protocol,address:s.address,port:s.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;this.peerConnection.connectionState==="connected"&&(this.isFirstConnected=!0),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=t=>{if(t&&(t.errorCode||t.errorText)){var n;const o="code: ".concat(t.errorCode,", message: ").concat(t.errorText),s=t.port?"local: ".concat(t.port):"";R.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICECandidateError(").concat(o,"), url: ").concat(t.url||"",", host_candidate:").concat(s)),(n=this.onICECandidateError)===null||n===void 0||n.call(this,o)}},this.peerConnection.onicegatheringstatechange=t=>{t&&t.target&&"iceGatheringState"in t.target&&R.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(t.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,R.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,R.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},H("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const n={iceServers:[]};return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&(kf(t.turnServer.servers)?n.iceServers=t.turnServer.servers:H("NEW_TURN_MODE")&&n.iceServers?(H("USE_TURN_SERVER_OF_GATEWAY")?t.turnServer.serversFromGateway&&n.iceServers.push(...Pd.newTurnServerConfigToIceServers(t.turnServer.serversFromGateway)):n.iceServers.push(...Pd.newTurnServerConfigToIceServers(t.turnServer.servers)),H("NEW_FORCE_TURN")&&(n.iceTransportPolicy="relay")):t.turnServer.mode!=="off"&&(n.iceServers&&n.iceServers.push(...Pd.turnServerConfigToIceServers(t.turnServer.servers)),H("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...Pd.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),H("FORCE_TURN_TCP")?n.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(o=>{o.forceturn&&(n.iceTransportPolicy="relay")}))),H("ENABLE_ENCODED_TRANSFORM")&&Rt().supportWebRTCEncodedTransform&&(n.encodedInsertableStreams=!0),n}static turnServerConfigToIceServers(t){const n=[];return t.forEach(o=>{o.security?o.tcpport&&n.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(Uc(o.turnServerURL),":").concat(o.tcpport,"?transport=tcp")}):(o.udpport&&!H("FORCE_TURN_TCP")&&n.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.udpport,"?transport=udp")}),o.tcpport&&n.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=tcp")}))}),n}static newTurnServerConfigToIceServers(t){const n=[];return t.forEach(o=>{const s=H("NEW_TURN_MODE");s===1?n.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":3478?transport=udp")}):s===2?n.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":3478?transport=tcp")}):s===3?n.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(Uc(o.turnServerURL),":443?transport=tcp")}):s===4&&(n.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":3478?transport=udp")}),n.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":3478?transport=tcp")}),n.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(Uc(o.turnServerURL),":443?transport=tcp")}))}),n}tryBindTransportEvents(t){const n=t.transport;if(n){this.transportEventReceiver=t,n.onstatechange=()=>{var s;n!=null&&n.state&&((s=this.onDTLSTransportStateChange)===null||s===void 0||s.call(this,n.state))},n.onerror=s=>{var c;(c=this.onDTLSTransportError)===null||c===void 0||c.call(this,"error"in s?s.error:s)};const o=n.iceTransport;o&&(o.onstatechange=()=>{const s=n==null?void 0:n.iceTransport.state;var c;s&&((c=this.onICETransportStateChange)===null||c===void 0||c.call(this,s))},o.getSelectedCandidatePair&&(o.onselectedcandidatepairchange=()=>{if(o.getSelectedCandidatePair()){const{local:s,remote:c}=o.getSelectedCandidatePair();R.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:s.type,protocol:s.protocol}),", remote ").concat(JSON.stringify({candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,n){var o,s;if(n||(n=this.peerConnection.getSenders().find(A=>A.track===t._mediaStreamTrack)),!n)return R.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return R.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Rt().supportSetRtpSenderParameters)return R.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const c={},d={};switch(t._optimizationMode){case"motion":c.degradationPreference="maintain-framerate";break;case"detail":c.degradationPreference="maintain-resolution";break;case"balanced":c.degradationPreference="balanced"}const h=function(I,A){return I.getTransceivers().find(M=>M.sender.track===A||M.receiver.track===A)}(this.peerConnection,t._mediaStreamTrack),p=Qie(t);if(hse(t)&&h&&n&&p&&this.getLocalVideoStats&&Ee(o=["vp8","vp9"]).call(o,this.store.codec)){var m;const I=c.degradationPreference||(Ee(m=t._hints).call(m,Gt.CUSTOM_TRACK)?H("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");(function(A,M,U,Y,Q,J){if(uv(A,U),Q(M),Y!=="balanced"&&Y!=="maintain-framerate"&&Y!=="maintain-resolution")return;let X=-1;MV(A,M);const ne=window.setInterval(()=>{const me=dv.get(A);if(!H("ENABLE_AG_ADAPTATION")||!me)return uv(A,U),void Q(M);const we=J();if(we.sendPackets>0&&we.OutgoingAvailableBandwidth>0){if(X===-1)return void(X=Date.now());if(Date.now()-X<1e3)return;const ut=we.sendFrameRate,rt=we.OutgoingAvailableBandwidth,[qe,tn]=use(A,ut,rt,me.adaptationConfig,M,Y);tn&&(U.qualityLimitationReason=tn),qe&&me.adaptationConfig.scale!==qe.scale&&(R.debug("[".concat(A,"] applyAdaptation: ").concat(U.qualityLimitationReason,`
           sendFps `).concat(ut,", bwe ").concat(rt,", switch from ").concat(me.adaptationConfig.scale," to ").concat(qe.scale," ")),me.adaptationConfig=BC(BC({},me.adaptationConfig),qe),Q(qe))}},H("CHECK_LOCAL_STATS_INTERVAL")),oe=BC({},M);dv.set(A,{timer:ne,adaptationConfig:oe,originConfig:M,adaptationFunc:Q}),R.debug("[".concat(A,"] start adaptation, originConfig: ").concat(JSON.stringify(M),", degradationPreference: ").concat(Y))})(this.id+h.mid,p,this,I,A=>{n&&this.updateAdaptation(n,A)},this.getLocalVideoStats.bind(this))}if(t._encoderConfig){var g;const{bitrateMax:I,frameRate:A,scaleResolutionDownBy:M}=t._encoderConfig;I&&(d.maxBitrate=1e3*I),(Ee(g=t._hints).call(g,Gt.LOW_STREAM)||t.isUseScaleResolutionDownBy)&&(A&&(d.maxFramerate=Li(A)),M&&M>=1&&(d.scaleResolutionDownBy=M))}const{maxFramerate:E}=H("ENCODER_CONFIG_LIMIT");if(E&&typeof E=="number"&&(d.maxFramerate=d.maxFramerate?Math.min(d.maxFramerate,E):E),H("DSCP_TYPE")&&Ga()){var y;const I=H("DSCP_TYPE");Ee(y=["very-low","low","medium","high"]).call(y,I)&&(d.networkPriority=I)}const T=n.getParameters(),P=(s=T.encodings)===null||s===void 0?void 0:s[0];gn()&&!P&&(c.encodings=[d]),P&&Object.assign(P,d),Object.assign(T,c),R.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(T.encodings))),await n.setParameters(T),await async function(I,A,M){try{var U;if(!Rt().supportSetRtpSenderParameters||!function(ne){return ne==="vp9"||ne==="av1"}(I)||!H("ENABLE_SVC"))return;const Y={},Q={},J=A.getParameters(),X=(U=J.encodings)===null||U===void 0?void 0:U[0];Q.scalabilityMode=ev(M),X&&Object.assign(X,Q),Object.assign(J,Y),await A.setParameters(J),R.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(J.encodings)))}catch(Y){R.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",Y)}}(this.store.codec,n,H("SVC_MODE"))}async updateAdaptation(t,n){var o,s;if(!t)return R.debug("[updateAdaptation] no rtpSender found");if(!Rt().supportSetRtpSenderParameters)return R.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const c={},{bitrateMax:d,frameRate:h,scaleResolutionDownBy:p}=n;d&&(c.maxBitrate=1e3*d),h&&(c.maxFramerate=Li(h)),p&&p>=1&&Ee(o=["vp8","vp9"]).call(o,this.store.codec)&&(c.scaleResolutionDownBy=p);const m=t.getParameters(),g=(s=m.encodings)===null||s===void 0?void 0:s[0];g&&Object.assign(g,c),Object.assign(m,{});try{await t.setParameters(m),R.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(m.encodings)))}catch(E){!("transport"in t)||t.transport&&t.transport.state==="connected"?this.peerConnectionState!=="connected"?R.debug("[updateAdaptation] peerConnection not connected}"):R.debug("[updateAdaptation] updateRtpSenderEncodings failed",E):R.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(t,n){try{if(!Rt().supportSetRtpSenderParameters||t.length!==n.length)return;for(let o=0;o<t.length;o++){const s=t[o],c=n[o];c instanceof nn&&!this.isVP8Simulcast(c)&&await this.updateRtpSenderEncodings(c,s.sender)}}catch{R.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,n,o){const s=_i(t);return n.forEach((c,d)=>{const h=o[d],p=s.mediaDescriptions.find(m=>m.attributes.mid===h);p&&(yh(p,c),iV(p,c,this.store.codec))}),xc(s)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,n,o)=>{var s;(s=this.onFirstVideoDecoded)===null||s===void 0||s.call(this,t,n,o)},this.statsFilter.onSelectedLocalCandidateChanged=(t,n)=>{var o;(o=this.onSelectedLocalCandidateChanged)===null||o===void 0||o.call(this,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,n)=>{var o;(o=this.onSelectedRemoteCandidateChanged)===null||o===void 0||o.call(this,t,n)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var n;(n=this.onFirstVideoDecodedTimeout)===null||n===void 0||n.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,n){if(t.length===n.length)for(let p=0;p<t.length;p++){var o,s,c,d,h;const m=t[p],g=n[p];if(g instanceof nn&&!Ee(o=g._hints).call(o,Gt.LOW_STREAM)&&(s=g._encoderConfig)!==null&&s!==void 0&&s.bitrateMax&&((c=g._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)>200&&(d=g._scalabilityMode)!==null&&d!==void 0&&d.numSpatialLayers&&((h=g._scalabilityMode)===null||h===void 0?void 0:h.numSpatialLayers)>1&&this.store.codec==="vp8"){const E={},y={high:1e3*(g._encoderConfig.bitrateMax-50),medium:5e4};E.encodings=[{rid:"m",active:!0,maxBitrate:y.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:y.high}];const T=m.sender.getParameters();await m.sender.setParameters(Object.assign(T,E))}}}async applySimulcastEncodings(t,n){if(!gn()&&t.length===n.length)for(let o=0;o<t.length;o++){const s=n[o];if(s instanceof nn&&this.isVP8Simulcast(s)){const c=t[o],d={},h={high:1e3*(s._encoderConfig.bitrateMax-50),medium:5e4};d.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:h.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:h.medium,scaleResolutionDownBy:4}];const p=c.sender.getParameters();await c.sender.setParameters(Object.assign(p,d))}}}isVP8Simulcast(t){var n,o,s,c,d;return!!(t instanceof nn&&H("SIMULCAST")&&this.store.codec==="vp8"&&!Ee(n=t._hints).call(n,Gt.LOW_STREAM)&&(o=t._encoderConfig)!==null&&o!==void 0&&o.bitrateMax&&((s=t._encoderConfig)===null||s===void 0?void 0:s.bitrateMax)>200&&(c=t._scalabilityMode)!==null&&c!==void 0&&c.numSpatialLayers&&((d=t._scalabilityMode)===null||d===void 0?void 0:d.numSpatialLayers)>1)}logSDPExchange(t,n,o,s){if(H("SDP_LOGGING"))return R.upload("[".concat(this.store.clientId,"] exchanging ").concat(o," ").concat(n," SDP during P2PConnection.").concat(s,`
`),t),n==="offer"?c=>{this.logSDPExchange(c,"answer",o==="local"?"remote":"local",s)}:void 0}async getRemoteSSRC(t){if(!this.remoteSDP)return;const n=this.remoteSDP.getSSRC(t);return n&&n.length!==0?n[0].ssrcId:void 0}setConfiguration(t){if(Rt().supportPCSetConfiguration){const n=Pd.resolvePCConfiguration(t);this.peerConnection.setConfiguration(n)}}},Oe(yt.prototype,"updateRemoteRTPCapabilities",[ai],Object.getOwnPropertyDescriptor(yt.prototype,"updateRemoteRTPCapabilities"),yt.prototype),Oe(yt.prototype,"connect",[ai],Object.getOwnPropertyDescriptor(yt.prototype,"connect"),yt.prototype),Oe(yt.prototype,"updateRemoteConnect",[ai],Object.getOwnPropertyDescriptor(yt.prototype,"updateRemoteConnect"),yt.prototype),Oe(yt.prototype,"createDataChannels",[ai],Object.getOwnPropertyDescriptor(yt.prototype,"createDataChannels"),yt.prototype),Oe(yt.prototype,"receive",[ai],Object.getOwnPropertyDescriptor(yt.prototype,"receive"),yt.prototype),Oe(yt.prototype,"batchReceive",[ai],Object.getOwnPropertyDescriptor(yt.prototype,"batchReceive"),yt.prototype),Oe(yt.prototype,"stopReceiving",[ai],Object.getOwnPropertyDescriptor(yt.prototype,"stopReceiving"),yt.prototype),Oe(yt.prototype,"muteRemote",[ai],Object.getOwnPropertyDescriptor(yt.prototype,"muteRemote"),yt.prototype),Oe(yt.prototype,"unmuteRemote",[ai],Object.getOwnPropertyDescriptor(yt.prototype,"unmuteRemote"),yt.prototype),Oe(yt.prototype,"muteLocal",[ai],Object.getOwnPropertyDescriptor(yt.prototype,"muteLocal"),yt.prototype),Oe(yt.prototype,"unmuteLocal",[ai],Object.getOwnPropertyDescriptor(yt.prototype,"unmuteLocal"),yt.prototype),Oe(yt.prototype,"close",[ai],Object.getOwnPropertyDescriptor(yt.prototype,"close"),yt.prototype),Oe(yt.prototype,"updateEncoderConfig",[ai],Object.getOwnPropertyDescriptor(yt.prototype,"updateEncoderConfig"),yt.prototype),Oe(yt.prototype,"updateSendParameters",[ai],Object.getOwnPropertyDescriptor(yt.prototype,"updateSendParameters"),yt.prototype),Oe(yt.prototype,"replaceTrack",[ai],Object.getOwnPropertyDescriptor(yt.prototype,"replaceTrack"),yt.prototype),Oe(yt.prototype,"updateAdaptation",[ai],Object.getOwnPropertyDescriptor(yt.prototype,"updateAdaptation"),yt.prototype),Oe(yt.prototype,"getRemoteSSRC",[ai],Object.getOwnPropertyDescriptor(yt.prototype,"getRemoteSSRC"),yt.prototype),yt);function ai(e,t,n){const o=e[t];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const s=this.mutex,c=await s.lock("From P2PConnection.".concat(t));try{for(var d=arguments.length,h=new Array(d),p=0;p<d;p++)h[p]=arguments[p];return await o.apply(this,h)}finally{c()}},n}function zC(e,t){let n=document.createElement("video"),o=document.createElement("canvas");n.setAttribute("style","display:none"),o.setAttribute("style","display:none"),n.setAttribute("muted",""),n.muted=!0,n.setAttribute("autoplay",""),n.autoplay=!0,n.setAttribute("playsinline",""),o.width=Li(t.width),o.height=Li(t.height);const s=Li(t.framerate||15);document.body.append(n),document.body.append(o);let c=e._mediaStreamTrack;n.srcObject=new MediaStream([c]),n.play();const d=o.getContext("2d");if(!d)throw new ee(j.UNEXPECTED_ERROR,"can not get canvas context");const h=Rt(),p=o.captureStream(h.supportRequestFrame?0:s).getVideoTracks()[0];p.canvas||(p.canvas=o),o.startCapture=()=>{if(!n)return o.stopCapture&&o.stopCapture();if(n.paused&&n.play(),n.videoHeight>2&&n.videoWidth>2){const g=n.videoWidth,E=n.videoHeight/g,y=o.width*E;Math.abs(y-o.height)>=2&&(R.debug("adjust low stream resolution","".concat(o.width,"x").concat(o.height," -> ").concat(o.width,"x").concat(y)),o.height=y)}d.drawImage(n,0,0,o.width,o.height),p.requestFrame&&p.requestFrame(),c!==e._mediaStreamTrack&&(c=e._mediaStreamTrack,n.srcObject=new MediaStream([c]))},o.stopCapture=tC(()=>o.startCapture&&o.startCapture(),s);const m=p.stop;return p.stop=()=>{m.call(p),n&&(n.remove(),n.srcObject=null,n=null),o&&(o.width=0,o.remove(),o.stopCapture&&o.stopCapture(),o.startCapture=void 0,o.stopCapture=void 0,o=null),R.debug("clean low stream renderer")},p}var ts=function(e){return e[e.Video_Send_Qp_Sum=2143]="Video_Send_Qp_Sum",e[e.Video_Send_Freeze=2082]="Video_Send_Freeze",e[e.Video_Recv_Qp_Sum=2144]="Video_Recv_Qp_Sum",e[e.Video_Recv_Freeze=2084]="Video_Recv_Freeze",e[e.Video_Render_Freeze_Time=2109]="Video_Render_Freeze_Time",e[e.Video_Render_Freeze_Time_Render=2147]="Video_Render_Freeze_Time_Render",e[e.Video_Render_Freeze_Time_Render2=2223]="Video_Render_Freeze_Time_Render2",e[e.Audio_Recv_Freeze=2083]="Audio_Recv_Freeze",e[e.Video_Send_Type=2225]="Video_Send_Type",e}(ts||{}),Qe=function(e){return e[e.Video_Send_Retransmit=2062]="Video_Send_Retransmit",e[e.Video_Send_Target_Encoded=2064]="Video_Send_Target_Encoded",e[e.Video_Send_Actual_Encoded=2060]="Video_Send_Actual_Encoded",e[e.Video_Send_Transmit=2066]="Video_Send_Transmit",e[e.Video_Send_Bandwidth=2061]="Video_Send_Bandwidth",e[e.Video_Capture_Height=2033]="Video_Capture_Height",e[e.Video_Capture_Width=2035]="Video_Capture_Width",e[e.Video_Capture_Frame_Rate=2034]="Video_Capture_Frame_Rate",e[e.Video_Send_Low_Height=2073]="Video_Send_Low_Height",e[e.Video_Send_Low_Frame_Rate=2075]="Video_Send_Low_Frame_Rate",e[e.Video_Send_Low_Width=2077]="Video_Send_Low_Width",e[e.Video_Send_Low_Bitrate=2069]="Video_Send_Low_Bitrate",e[e.Video_Send_Low_Package_Lost=2070]="Video_Send_Low_Package_Lost",e[e.Video_Send_Low_Package_Rate=2071]="Video_Send_Low_Package_Rate",e[e.Video_Send_Frame_Rate=2002]="Video_Send_Frame_Rate",e[e.Video_Send_Width=2003]="Video_Send_Width",e[e.Video_Send_Height=2004]="Video_Send_Height",e[e.Video_Send_Disabled=2095]="Video_Send_Disabled",e[e.Video_Send_Adaptation=2032]="Video_Send_Adaptation",e[e.Video_Send_Player_Status=2128]="Video_Send_Player_Status",e[e.Video_Send_Nacks=2009]="Video_Send_Nacks",e[e.Video_Send_Plis=2010]="Video_Send_Plis",e[e.Video_Send_Firs=2011]="Video_Send_Firs",e[e.Video_Send_Avg_Encode=2007]="Video_Send_Avg_Encode",e[e.Video_Send_Huge_Frame_Sent=2174]="Video_Send_Huge_Frame_Sent",e[e.Video_Send_Bytes_Retransmit=2173]="Video_Send_Bytes_Retransmit",e[e.Video_Send_Packages_Retransmit=2172]="Video_Send_Packages_Retransmit",e[e.Video_Send_Key_Frames_Encoded=2207]="Video_Send_Key_Frames_Encoded",e[e.Video_Send_Bitrate=2012]="Video_Send_Bitrate",e[e.Video_Send_Package_Rate=2031]="Video_Send_Package_Rate",e[e.Video_Send_Package_Lost=2005]="Video_Send_Package_Lost",e[e.Audio_Capture_PCM_Level=2104]="Audio_Capture_PCM_Level",e[e.Audio_Send_Level=2038]="Audio_Send_Level",e[e.Audio_Send_Bitrate=2039]="Audio_Send_Bitrate",e[e.Audio_Send_Package_Rate=2040]="Audio_Send_Package_Rate",e[e.Audio_Send_AEC_Return_Loss=2041]="Audio_Send_AEC_Return_Loss",e[e.Audio_Send_AEC_Return_Loss_Enhancement=2042]="Audio_Send_AEC_Return_Loss_Enhancement",e[e.Audio_Send_Freeze=2081]="Audio_Send_Freeze",e[e.Audio_Send_Disabled=2096]="Audio_Send_Disabled",e[e.Audio_Send_Bytes_Retransmit=2179]="Audio_Send_Bytes_Retransmit",e[e.Audio_Send_Packages_Retransmit=2180]="Audio_Send_Packages_Retransmit",e[e.Video_Recv_Height=2019]="Video_Recv_Height",e[e.Video_Recv_Width=2018]="Video_Recv_Width",e[e.Video_Recv_Frame_Rate_Output=2155]="Video_Recv_Frame_Rate_Output",e[e.Video_Recv_Jitter_Buffer=2023]="Video_Recv_Jitter_Buffer",e[e.Video_Recv_Current_Delay=2024]="Video_Recv_Current_Delay",e[e.Video_Recv_Nacks=2026]="Video_Recv_Nacks",e[e.Video_Recv_Plis=2027]="Video_Recv_Plis",e[e.Video_Recv_Firs=2028]="Video_Recv_Firs",e[e.Video_Recv_Disabled=2101]="Video_Recv_Disabled",e[e.Video_Recv_Player_Status=2129]="Video_Recv_Player_Status",e[e.Video_Recv_I_Frame_Delay=2149]="Video_Recv_I_Frame_Delay",e[e.Video_Render_Frame_Rate_Render=2022]="Video_Render_Frame_Rate_Render",e[e.Video_Render_Freeze_Duration=2156]="Video_Render_Freeze_Duration",e[e.Audio_Render_Level=2043]="Audio_Render_Level",e[e.Audio_Render_Freeze_Time_80ms=2226]="Audio_Render_Freeze_Time_80ms",e[e.Audio_Render_Freeze_Time_200ms=2227]="Audio_Render_Freeze_Time_200ms",e[e.Audio_Render_Freeze_Samples_80ms=2228]="Audio_Render_Freeze_Samples_80ms",e[e.Audio_Render_Freeze_Samples_200ms=2229]="Audio_Render_Freeze_Samples_200ms",e[e.Audio_Recv_PCM_Level=2105]="Audio_Recv_PCM_Level",e[e.Audio_Recv_Disabled=2102]="Audio_Recv_Disabled",e[e.Audio_Recv_Jitter_Buffer=2054]="Audio_Recv_Jitter_Buffer",e[e.Audio_Recv_Current_Delay=2047]="Audio_Recv_Current_Delay",e[e.Audio_Recv_Player_Status=2130]="Audio_Recv_Player_Status",e[e.Audio_Recv_Bitrate=2044]="Audio_Recv_Bitrate",e[e.Audio_Recv_Concealed_Samples=2148]="Audio_Recv_Concealed_Samples",e[e.Audio_Recv_Total_Samples_Received=2224]="Audio_Recv_Total_Samples_Received",e}(Qe||{}),ur=function(e){return e[e.Video_Render_Frame_Rate_Decode=2021]="Video_Render_Frame_Rate_Decode",e[e.Video_Recv_Frame_Rate=2020]="Video_Recv_Frame_Rate",e[e.Video_Recv_Frame_Dropped=2181]="Video_Recv_Frame_Dropped",e[e.Video_Recv_Bytes_Retransmit=2175]="Video_Recv_Bytes_Retransmit",e[e.Video_Recv_Packages_Retransmit=2176]="Video_Recv_Packages_Retransmit",e[e.Video_Recv_Packages_Discarded=2198]="Video_Recv_Packages_Discarded",e[e.Video_Recv_Avg_Decode=2200]="Video_Recv_Avg_Decode",e[e.Video_Recv_Avg_Processing_Delay=2202]="Video_Recv_Avg_Processing_Delay",e[e.Video_Recv_Avg_Assembly_Time=2203]="Video_Recv_Avg_Assembly_Time",e[e.Video_Recv_Avg_Inter_Frame_Delay=2204]="Video_Recv_Avg_Inter_Frame_Delay",e[e.Video_Recv_Key_Frames_Decoded=2206]="Video_Recv_Key_Frames_Decoded",e[e.Video_Recv_Package_Lost=2014]="Video_Recv_Package_Lost",e[e.Video_Recv_Bitrate=2029]="Video_Recv_Bitrate",e[e.Video_Recv_Package_Rate=2078]="Video_Recv_Package_Rate",e[e.Audio_Recv_Jitter=2055]="Audio_Recv_Jitter",e[e.Audio_Recv_Bytes_Retransmit=2178]="Audio_Recv_Bytes_Retransmit",e[e.Audio_Recv_Packages_Retransmit=2177]="Audio_Recv_Packages_Retransmit",e[e.Audio_Recv_Packages_Discarded=2199]="Audio_Recv_Packages_Discarded",e[e.Audio_Recv_Avg_Processing_Delay=2201]="Audio_Recv_Avg_Processing_Delay",e[e.Audio_Recv_Package_Rate=2046]="Audio_Recv_Package_Rate",e[e.Audio_Recv_Package_Lost=2045]="Audio_Recv_Package_Lost",e}(ur||{}),ci=function(e){return e[e.RTT=2006]="RTT",e[e.CONN_TYPE=801]="CONN_TYPE",e[e.STATS_UPDATE_INTERVAL=2205]="STATS_UPDATE_INTERVAL",e}(ci||{}),pv=function(e){return e[e.RTC_PEER_CONNECTION_STATE=2219]="RTC_PEER_CONNECTION_STATE",e}(pv||{});const gd=1e3,fv=6,em=3,mse=Math.max(fv,em);function We(e,t,n){n!=null&&Number.isFinite(n)&&(e[t]=Math.round(Math.max(0,n)))}function BV(e){const t={[ci.CONN_TYPE]:0,[ci.RTT]:e.rtt,[ci.STATS_UPDATE_INTERVAL]:e.updateInterval?Math.round(Math.max(0,e.updateInterval)):void 0};switch(e.selectedCandidatePair.localCandidate.candidateType){case"relay":{const n=e.selectedCandidatePair.localCandidate.relayProtocol;n==="udp"&&(t[ci.CONN_TYPE]=1),n==="tcp"&&(t[ci.CONN_TYPE]=3),n==="tls"&&(t[ci.CONN_TYPE]=4);break}case"srflx":t[ci.CONN_TYPE]=2;break;case"unknown":t[ci.CONN_TYPE]=5;break;default:t[ci.CONN_TYPE]=0}return t}function WV(e){let t=0;switch(e){case"none":t=0;break;case"cpu":t=1;break;case"bandwidth":t=2;break;case"other":t=3}return t}class HV extends pn{constructor(t){super(),x(this,"store",void 0),x(this,"uploadWRTCStatsTimer",void 0),x(this,"uploadOutboundDenoiserStatsTimer",void 0),x(this,"uploadExtStatsTimer",void 0),x(this,"uploadExtUsageStatsTimer",void 0),x(this,"uploadInboundExtStatsTimer",void 0),x(this,"requestStats",void 0),x(this,"requestTransportStats",void 0),x(this,"requestLocalMedia",void 0),x(this,"requestRemoteMedia",void 0),x(this,"requestAllTracks",void 0),x(this,"requestVideoIsReady",void 0),x(this,"requestUploadStats",void 0),x(this,"requestUpload",void 0),x(this,"uploadOutboundStarted",!1),x(this,"uploadInboundStarted",!1),x(this,"uploadTransportStarted",!1),x(this,"uploadBaseStatsStarted",!1),x(this,"uploadExtensionUsageStarted",!1),x(this,"lastRecvStats",void 0),x(this,"lastSendStats",void 0),x(this,"lastRefRecvStats",void 0),x(this,"lastRefSendStats",void 0),x(this,"lastNormalRecvStats",void 0),x(this,"lastNormalSendStats",void 0),x(this,"needUploadRenderFreezeTime",!0),x(this,"lastUploadCompensateTime",-1),x(this,"uploadCompensateDeltaTime",0),this.store=t}uploadWRTCStats(t){if(!this.requestStats||!this.requestUploadStats)return;const n=t%em==0,o=t%fv==0;let s,c;if(this.uploadTransportStarted&&(s=this.requestStats(),this.store.useP2P&&(c=this.requestStats(!0))),!s&&this.uploadOutboundStarted&&(s=this.requestStats()),!c&&this.uploadInboundStarted&&(c=this.requestStats(!0)),s||c){var d;const h={};if(this.uploadTransportStarted&&s){const m=this.getTransportStats(s,c,n);m&&(h.misc=[m])}if(this.uploadOutboundStarted&&s){const m=this.getOutboundStats(s,o?this.lastNormalSendStats:void 0,n?this.lastRefSendStats:void 0,this.lastSendStats);m&&(h.outbound=[m])}if(this.uploadInboundStarted&&c){this.uploadCompensateStats(t);const m=this.getInboundStats(c,o?this.lastNormalRecvStats:void 0,n?this.lastRefRecvStats:void 0,this.lastRecvStats);m&&(h.inbound=m)}const p=(d=this.requestTransportStats)===null||d===void 0?void 0:d.call(this).connectState;p&&(Array.isArray(h.misc)?h.misc[0]&&h.misc[0].addition&&(h.misc[0].addition[pv.RTC_PEER_CONNECTION_STATE]=FR[p]):h.misc=[{addition:{[pv.RTC_PEER_CONNECTION_STATE]:FR[p]}}]),this.requestUploadStats(h)}this.lastRecvStats=c,this.lastSendStats=s,o&&(this.lastNormalRecvStats=c,this.lastNormalSendStats=s),n&&(this.lastRefRecvStats=c,this.lastRefSendStats=s)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;this.uploadBaseStatsStarted=!0;let t=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted){if(this.uploadBaseStatsStarted){var n,o;const s=(n=this.requestTransportStats)===null||n===void 0?void 0:n.call(this);return void(s&&((o=this.requestUploadStats)===null||o===void 0||o.call(this,{misc:[{addition:{[pv.RTC_PEER_CONNECTION_STATE]:FR[s.connectState]}}]})))}return this.stopUploadWRTCStats()}this.uploadWRTCStats(t),++t===mse+1&&(t=1)},gd)}uploadCompensateStats(t){if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;const n=t%em==0&&this.needUploadRenderFreezeTime;if(!this.uploadInboundStarted||!n)return;if(this.lastUploadCompensateTime===-1)return void(this.lastUploadCompensateTime=Date.now());const o=Math.max(-6e3,Date.now()-this.lastUploadCompensateTime-6e3);if(this.uploadCompensateDeltaTime+=o,this.lastUploadCompensateTime=Date.now(),this.uploadCompensateDeltaTime<6e3)return;const s=Math.min(Math.floor(this.uploadCompensateDeltaTime/6e3),10);this.uploadCompensateDeltaTime-=6e3*s;const c=this.requestStats(!0);new Array(s).fill(0).forEach(()=>{if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;const d={};if(this.uploadInboundStarted&&c){const h=this.requestRemoteMedia()||[],p=[];h.forEach(m=>{let[g,E]=m;const y={peer:g.uid};if(g._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(g._videoSSRC)&&E.has(Re.VIDEO)&&g.videoTrack){const T=function(P,I,A){if(!I.videoRecv.find(U=>U.ssrc===P))return;const M={};if(A&&A._player){const U=A._player,{renderFreezeAccTime2:Y,videoElementStatus:Q}=U;if(da.visibility==="visible"&&Q===Ur.PLAYING&&Rt().supportRequestVideoFrameCallback){const J=Math.min(6e3,Y);U.renderFreezeAccTime2=Math.max(0,Y-J),We(M,ts.Video_Render_Freeze_Time_Render2,J),H("USE_NEW_RENDER_FREEZE_TIME")&&We(M,ts.Video_Render_Freeze_Time_Render,J)}}return M}(g._videoSSRC,c,g.videoTrack);T&&(y.video=T)}y.video&&p.push(y)}),p.length>0&&(d.inbound=p,this.requestUploadStats(d))}})}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0}getTransportStats(t,n,o){if(!this.requestStats)return;if(!o)return t.rtt==null?void 0:{addition:{[ci.RTT]:t.rtt,[ci.CONN_TYPE]:void 0,[ci.STATS_UPDATE_INTERVAL]:t.updateInterval||void 0}};const s=BV(t);if(this.store.useP2P){if(n){const c=BV(n);s[ci.CONN_TYPE]+=c[ci.CONN_TYPE]<<3}s[ci.CONN_TYPE]+=110}else s[ci.CONN_TYPE]+=100;return{addition:s}}getOutboundStats(t,n,o,s){if(!this.requestUploadStats||!this.requestLocalMedia)return;const c=this.requestLocalMedia();if(!c||c.length===0)return;let d,h,p;return c.forEach(m=>{let[g,{track:E,ssrcs:y}]=m;switch(g){case de.LocalVideoLowTrack:case de.LocalVideoTrack:if(g===de.LocalVideoTrack){const T=function(A,M,U,Y,Q,J){const X=M.videoSend.find(ut=>ut.ssrc===A);if(!X)return;const ne={},{sentFrame:oe,inputFrame:me}=X;if(Y&&(We(ne,ts.Video_Send_Qp_Sum,X.qpSumPerFrame),me&&oe)){var we;const ut=me.frameRate,rt=oe.frameRate;ne[ts.Video_Send_Freeze]=function(qe,tn){let zt=!0;return zt=!(qe<=5)&&(qe<=10?tn<3:qe<=20?tn<4:tn<5),zt}(ut,rt)?1:0,ne[ts.Video_Send_Type]=U.__className__==="CameraVideoTrack"?0:Ee(we=U._hints).call(we,Gt.SCREEN_TRACK)?1:2}if(Q){switch(oe&&(We(ne,Qe.Video_Send_Height,oe.height),We(ne,Qe.Video_Send_Width,oe.width),We(ne,Qe.Video_Send_Frame_Rate,oe.frameRate)),ne[Qe.Video_Send_Disabled]=U._originMediaStreamTrack&&!U._originMediaStreamTrack.enabled||U._mediaStreamTrack&&!U._mediaStreamTrack.enabled?1:0,X.adaptionChangeReason){case"none":ne[Qe.Video_Send_Adaptation]=0;break;case"cpu":ne[Qe.Video_Send_Adaptation]=1;break;case"bandwidth":ne[Qe.Video_Send_Adaptation]=2;break;case"other":ne[Qe.Video_Send_Adaptation]=3}let ut=0;X.adaptionChangeReason&&(ut+=WV(X.adaptionChangeReason)),M.qualityLimitationReason&&(ut+=WV(M.qualityLimitationReason)<<3),ne[Qe.Video_Send_Adaptation]=ut,ne[Qe.Video_Send_Player_Status]=ZR[U._player?U._player.videoElementStatus:"uninit"],We(ne,Qe.Video_Send_Nacks,X.nacksCount),We(ne,Qe.Video_Send_Plis,X.plisCount),We(ne,Qe.Video_Send_Firs,X.firsCount),We(ne,Qe.Video_Send_Avg_Encode,X.avgEncodeMs),We(ne,Qe.Video_Send_Huge_Frame_Sent,X.hugeFramesSent),We(ne,Qe.Video_Send_Bytes_Retransmit,X.retransmittedBytesSent),We(ne,Qe.Video_Send_Packages_Retransmit,X.retransmittedPacketsSent),We(ne,Qe.Video_Send_Key_Frames_Encoded,X.keyFramesEncoded);const rt=Q.videoSend.find(qe=>qe.ssrc===A);if(rt){let qe=gd*em;rt.timestamp&&X.timestamp&&(qe=X.timestamp-rt.timestamp),rt.packets!=null&&X.packets!=null&&We(ne,Qe.Video_Send_Package_Rate,1e3*(X.packets-rt.packets)/qe),X.packetsLost!=null&&rt.packetsLost!=null&&We(ne,Qe.Video_Send_Package_Lost,X.packetsLost-rt.packetsLost),rt.bytes!=null&&X.bytes!=null&&We(ne,Qe.Video_Send_Bitrate,8*(X.bytes-rt.bytes)/qe)}}return ne}(y[0].ssrcId,t,E,n,o),P=E&&function(A,M,U,Y){const Q=M.videoSend.find(X=>X.ssrc===A);if(!Q)return null;const J={};if(Y){const X=Q.inputFrame,ne=X&&X.height||U.videoHeight||0,oe=X&&X.width||U.videoWidth||0,me=X&&X.frameRate||0;We(J,Qe.Video_Capture_Height,ne),We(J,Qe.Video_Capture_Width,oe),We(J,Qe.Video_Capture_Frame_Rate,me)}return J}(y[0].ssrcId,t,E,!!o),I=function(A,M){const U={};return M&&(We(U,Qe.Video_Send_Retransmit,A.bitrate.retransmit),We(U,Qe.Video_Send_Target_Encoded,A.bitrate.targetEncoded),We(U,Qe.Video_Send_Actual_Encoded,A.bitrate.actualEncoded),We(U,Qe.Video_Send_Transmit,A.bitrate.transmit),We(U,Qe.Video_Send_Bandwidth,A.sendBandwidth)),U}(t,!!o);h=Object.assign({},T,P,I)}else p=function(T,P,I,A,M){const U=P.videoSend.find(Q=>Q.ssrc===T);if(!U)return;const Y={};if(A){const Q=U.sentFrame;Q&&(We(Y,Qe.Video_Send_Low_Height,Q.height),We(Y,Qe.Video_Send_Low_Width,Q.width),We(Y,Qe.Video_Send_Low_Frame_Rate,Q.frameRate));const J=A.videoSend.find(X=>X.ssrc===T);if(J){let X=gd*fv;J.timestamp&&U.timestamp&&(X=U.timestamp-J.timestamp),J.packets!=null&&U.packets!=null&&We(Y,Qe.Video_Send_Low_Package_Rate,1e3*(U.packets-J.packets)/X),U.packetsLost!=null&&J.packetsLost!=null&&We(Y,Qe.Video_Send_Low_Package_Lost,U.packetsLost-J.packetsLost),J.bytes!=null&&U.bytes!=null&&We(Y,Qe.Video_Send_Low_Bitrate,8*(U.bytes-J.bytes)/X)}}return Y}(y[0].ssrcId,t,0,o);break;case de.LocalAudioTrack:d=E&&function(T,P,I,A,M,U){const Y=P.audioSend.find(J=>J.ssrc===T);if(!Y)return;const Q={};if(M){Q[Qe.Audio_Send_Disabled]=I._originMediaStreamTrack&&!I._originMediaStreamTrack.enabled||I._mediaStreamTrack&&!I._mediaStreamTrack.enabled?1:0;const J=100*I._source.getAccurateVolumeLevel(),X=Y.inputLevel;if(X!=null){const oe=Math.ceil(50*Math.log10(100*X+1));We(Q,Qe.Audio_Send_Level,oe)}We(Q,Qe.Audio_Capture_PCM_Level,J),We(Q,Qe.Audio_Send_AEC_Return_Loss,Y.aecReturnLoss),We(Q,Qe.Audio_Send_AEC_Return_Loss_Enhancement,Y.aecReturnLossEnhancement),We(Q,Qe.Audio_Send_Bytes_Retransmit,Y.retransmittedBytesSent),We(Q,Qe.Audio_Send_Packages_Retransmit,Y.retransmittedPacketsSent),Q[Qe.Audio_Send_Freeze]=0;const ne=M.audioSend.find(oe=>oe.ssrc===T);if(ne){let oe=gd*fv;ne.timestamp&&Y.timestamp&&(oe=Y.timestamp-ne.timestamp),ne.bytes!=null&&Y.bytes!=null&&We(Q,Qe.Audio_Send_Bitrate,8*(Y.bytes-ne.bytes)/oe),ne.packets!=null&&Y.packets!=null&&We(Q,Qe.Audio_Send_Package_Rate,1e3*(Y.packets-ne.packets)/oe)}}return Q}(y[0].ssrcId,t,E,0,o)}}),{high:h,low:p,audio:d}}getInboundStats(t,n,o,s){if(!this.requestRemoteMedia)return;const c=this.requestRemoteMedia()||[],d=[];return c.forEach(h=>{let[p,m]=h;const g={peer:p.uid};if(m.has(Re.VIDEO)&&p.videoTrack){const E=p._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(p._videoSSRC)||!1,y=p.videoTrack?function(T,P,I,A,M,U,Y,Q){const J=P.videoRecv.find(qe=>qe.ssrc===T);if(!J)return;const X={},{receivedFrame:ne,outputFrame:oe,decodeFrameRate:me}=J;We(X,ur.Video_Render_Frame_Rate_Decode,me),J.framesRateFirefox&&We(X,ur.Video_Recv_Frame_Rate,J.framesRateFirefox),ne&&We(X,ur.Video_Recv_Frame_Rate,ne.frameRate),We(X,ur.Video_Recv_Frame_Dropped,J.framesDroppedCount),We(X,ur.Video_Recv_Bytes_Retransmit,J.retransmittedBytesReceived),We(X,ur.Video_Recv_Packages_Retransmit,J.retransmittedPacketsReceived),We(X,ur.Video_Recv_Packages_Discarded,J.packetsDiscarded),We(X,ur.Video_Recv_Avg_Decode,J.avgDecodeMs),We(X,ur.Video_Recv_Avg_Processing_Delay,J.avgProcessingDelayMs),We(X,ur.Video_Recv_Avg_Assembly_Time,J.avgFramesAssembledFromMultiplePacketsMs),We(X,ur.Video_Recv_Avg_Inter_Frame_Delay,J.avgInterFrameDelayMs),We(X,ur.Video_Recv_Key_Frames_Decoded,J.keyFramesDecoded);const we=Q&&Q.videoRecv.find(qe=>qe.ssrc===T);if(we){const qe=P.timestamp-Q.timestamp||gd;J.packetsLost!=null&&we.packetsLost!=null&&We(X,ur.Video_Recv_Package_Lost,J.packetsLost-we.packetsLost),we.bytes!=null&&J.bytes!=null&&We(X,ur.Video_Recv_Bitrate,8*(J.bytes-we.bytes)/qe),we.packets!=null&&J.packets!=null&&We(X,ur.Video_Recv_Package_Rate,1e3*(J.packets-we.packets)/qe)}const ut=U&&U.videoRecv.find(qe=>qe.ssrc===T);if(ut&&(We(X,ts.Video_Recv_Qp_Sum,J.qpSumPerFrame),X[ts.Video_Recv_Freeze]=A&&Qf.isRemoteVideoFreeze(I,J,ut)?1:0),Y){var rt;const qe=Y.videoRecv.find(zt=>zt.ssrc===T);ne?(We(X,Qe.Video_Recv_Height,ne.height),We(X,Qe.Video_Recv_Width,ne.width)):I&&(We(X,Qe.Video_Recv_Height,I._videoHeight||0),We(X,Qe.Video_Recv_Width,I._videoWidth||0)),oe&&We(X,Qe.Video_Recv_Frame_Rate_Output,oe.frameRate);const tn=(rt=I._player)===null||rt===void 0?void 0:rt.rendFrameRate.toFixed(0);if(tn&&We(X,Qe.Video_Render_Frame_Rate_Render,+tn),We(X,Qe.Video_Recv_Jitter_Buffer,J.jitterBufferMs),We(X,Qe.Video_Recv_Current_Delay,J.currentDelayMs),We(X,Qe.Video_Recv_Firs,J.firsCount),We(X,Qe.Video_Recv_Nacks,J.nacksCount),We(X,Qe.Video_Recv_Plis,J.plisCount),I){X[Qe.Video_Recv_Disabled]=I._originMediaStreamTrack.enabled&&I._mediaStreamTrack.enabled?0:1;const zt=I._player;if(zt){const{freezeTimeCounterList:di,renderFreezeAccTime:se,renderFreezeAccTime2:he,videoElementStatus:Ie}=zt;if(di&&di.length>0&&We(X,ts.Video_Render_Freeze_Time,di.splice(0,1)[0]),M&&da.visibility==="visible"&&Ie===Ur.PLAYING&&Rt().supportRequestVideoFrameCallback){const ae=Math.min(6e3,he);zt.renderFreezeAccTime2=Math.max(0,he-ae),We(X,ts.Video_Render_Freeze_Time_Render2,ae);const b=Math.min(6e3,se);zt.renderFreezeAccTime=Math.max(0,se-b),We(X,ts.Video_Render_Freeze_Time_Render,H("USE_NEW_RENDER_FREEZE_TIME")?ae:b)}if(typeof J.totalFreezesDuration=="number"){const ae=qe&&qe.totalFreezesDuration?J.totalFreezesDuration-qe.totalFreezesDuration:J.totalFreezesDuration;We(X,Qe.Video_Render_Freeze_Duration,1e3*ae)}}}if(X[Qe.Video_Recv_Player_Status]=ZR[I._player?I._player.videoElementStatus:"uninit"],qe&&J.totalInterFrameDelay!==void 0&&J.totalSquaredInterFrameDelay!==void 0&&qe.totalInterFrameDelay!==void 0&&qe.totalSquaredInterFrameDelay!==void 0){const zt=J.totalInterFrameDelay-qe.totalInterFrameDelay,di=J.totalSquaredInterFrameDelay-qe.totalSquaredInterFrameDelay,se=J.framesDecodeCount-qe.framesDecodeCount,he=zt/se*1e3,Ie=Math.round(1e3*Math.sqrt((di-Math.pow(zt,2)/se)/se));!isNaN(Ie)&&he+Ie>Math.max(3*he,he+150)&&(X[Qe.Video_Recv_I_Frame_Delay]=Ie)}}return X}(p._videoSSRC,t,p.videoTrack,E===!0,this.needUploadRenderFreezeTime,n,o,s):void 0;y&&(g.video=y)}if(m.has(Re.AUDIO)&&p.audioTrack){const E=p.audioTrack?function(y,T,P,I,A,M){const U=T.audioRecv.find(X=>X.ssrc===y);if(!U)return;const Y={};We(Y,ur.Audio_Recv_Jitter,U.jitterMs),We(Y,ur.Audio_Recv_Bytes_Retransmit,U.retransmittedBytesReceived),We(Y,ur.Audio_Recv_Packages_Retransmit,U.retransmittedPacketsReceived),We(Y,ur.Audio_Recv_Packages_Discarded,U.packetsDiscarded),We(Y,ur.Audio_Recv_Avg_Processing_Delay,U.avgProcessingDelayMs);const Q=M&&M.audioRecv.find(X=>X.ssrc===y);if(Q){const X=gd;U.packets!=null&&Q.packets!=null&&We(Y,ur.Audio_Recv_Package_Rate,1e3*(U.packets-Q.packets)/X),U.packetsLost!=null&&Q.packetsLost!=null&&We(Y,ur.Audio_Recv_Package_Lost,U.packetsLost-Q.packetsLost)}if(I){const{receivedFrames:X,droppedFrames:ne}=U;X!=null&&ne!=null&&(Y[ts.Audio_Recv_Freeze]=(J=X)===0||100*ne/J>20?1:0)}var J;if(A){const X=100*P._source.getAccurateVolumeLevel(),ne=U.outputLevel;if(ne!=null){const me=Math.ceil(50*Math.log10(100*ne+1));We(Y,Qe.Audio_Render_Level,me)}We(Y,Qe.Audio_Recv_PCM_Level,X),P&&(Y[Qe.Audio_Recv_Disabled]=P._originMediaStreamTrack.enabled&&P._mediaStreamTrack.enabled?0:1),We(Y,Qe.Audio_Recv_Jitter_Buffer,U.jitterBufferMs),We(Y,Qe.Audio_Recv_Current_Delay,U.jitterBufferMs),Y[Qe.Audio_Recv_Player_Status]=ZR[si.getPlayerState(P.getTrackId())];const oe=A.audioRecv.find(me=>me.ssrc===y);if(oe){oe.bytes!=null&&U.bytes!=null&&We(Y,Qe.Audio_Recv_Bitrate,8*(U.bytes-oe.bytes)/(gd*em));const me=U.concealedSamples-oe.concealedSamples;me>0&&We(Y,Qe.Audio_Recv_Concealed_Samples,me);const we=U.totalSamplesReceived-oe.totalSamplesReceived;we>0&&We(Y,Qe.Audio_Recv_Total_Samples_Received,we);const ut=U.freezeSamples80-oe.freezeSamples80;ut>0&&We(Y,Qe.Audio_Render_Freeze_Samples_80ms,ut);const rt=U.freezeSamples200-oe.freezeSamples200;rt>0&&We(Y,Qe.Audio_Render_Freeze_Samples_200ms,rt);const qe=U.freezeMs80-oe.freezeMs80;We(Y,Qe.Audio_Render_Freeze_Time_80ms,qe<0?0:qe);const tn=U.freezeMs200-oe.freezeMs200;We(Y,Qe.Audio_Render_Freeze_Time_200ms,tn<0?0:tn)}}return Y}(p._audioSSRC,t,p.audioTrack,n,o,s):void 0;E&&(g.audio=E)}(g.video||g.audio)&&d.push(g)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,d}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;const t=(this.requestAllTracks()||[]).find(n=>n instanceof Ff);if(t&&t._external.getDenoiserStats){const n=t._external.getDenoiserStats();n&&this.requestUpload(Wf.DENOISER_STATS,n)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(t=>{t.getProcessorStats().forEach(n=>{this.requestUpload&&this.requestUpload(n.type,n.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0,this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(t=>{let[n,o]=t;o.has(Re.VIDEO)&&n.videoTrack&&n.videoTrack.getProcessorStats().forEach(s=>{this.requestUpload&&this.requestUpload(s.type,s.stats)}),o.has(Re.AUDIO)&&n.audioTrack&&n.audioTrack.getProcessorStats().forEach(s=>{this.requestUpload&&this.requestUpload(s.type,s.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0,this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=void 0)}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);const t=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{const n=Date.now(),o={connectionInterval:H("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:n};let s=[];const c=this.requestAllTracks&&this.requestAllTracks()||[];for(const m of c)!m.muted&&m.enabled&&(s=s.concat(await m.getProcessorUsage()));const d=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(const[m,g]of d)g.has(Re.VIDEO)&&m.videoTrack&&(s=s.concat(await m.videoTrack.getProcessorUsage())),g.has(Re.AUDIO)&&m.audioTrack&&(s=s.concat(await m.audioTrack.getProcessorUsage()));if(s.length===0)return;o.details=function(m,g){const E={};for(const{id:I,value:A,level:M,direction:U}of m){var y;const Y=(y=g.get(I))!==null&&y!==void 0?y:0,Q=A===2?Y+H("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:Y;var T,P;g.set(I,Q),E[I]?(A===2&&(E[I].value=A),M>E[I].level&&(E[I].level=M),U==="remote"&&(E[I].remoteUidCount+=1),E[I].totalTs=(T=g.get(I))!==null&&T!==void 0?T:0):E[I]={value:A,level:M,remoteUidCount:U==="local"?0:1,totalTs:(P=g.get(I))!==null&&P!==void 0?P:0}}return Object.keys(E).map(I=>{const{level:A,value:M,totalTs:U}=E[I];return{id:I,level:A,value:M,totalTs:U}})}(s,t);const h=Date.now(),p=h>n?h:n+1;this.requestUpload&&this.requestUpload(Wf.EXTENSION_USAGE_STATS,{usageStats:o,sendTs:p})},H("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}stopUploadBaseStats(){this.uploadBaseStatsStarted=!1}}const gse=H("ICE_RESTART_INTERVAL");let mv=new Map,Ch=new Map,Wc=[Nr.UDP_TCP_RELAY,Nr.TCP_RELAY,Nr.RELAY],KC=H("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Rt().supportPCSetConfiguration;function GV(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=mv.get(e.id);n&&(window.clearTimeout(n),mv.delete(e.id));const o=Ch.get(e.id);t&&o&&o.index===Wc.length-1&&(R.debug("[".concat(e.id,"] reset ICE restart policy")),Ch.delete(e.id))}function zV(e,t,n){if(mv.size===0&&Ch.size===0&&(Array.isArray(H("RESTART_SEQUENCE"))&&H("RESTART_SEQUENCE").length>0&&!function(h,p){if(h.length!==p.length)return!1;for(let m=0;m<h.length;m+=1){const g=h[m];if(h.filter(E=>E===g).length!==p.filter(E=>E===g).length)return!1}return!0}(Wc,H("RESTART_SEQUENCE"))&&(Wc=H("RESTART_SEQUENCE").filter(h=>{var p;if(Ee(p=Object.values(Nr)).call(p,h))return!0}),R.debug("use reconnection policy from config distribution, queues: ".concat(Wc.join(" => ")))),KC=H("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Rt().supportPCSetConfiguration),Wc.length===0)return void n();let o,{index:s=0,type:c}=Ch.get(e.id)||{};if(KC&&c===Nr.RELAY)return void n();let d=c&&s>=Wc.length-1;if(KC)c=Nr.RELAY;else{if(d)return void n();c?(s++,c=Wc[s]):(c=Wc[0],s=0)}R.debug("[".concat(e.id,"] choose ICE restart policy: ").concat(c,", index: ").concat(s)),t(c),Ch.set(e.id,{index:s,type:c}),o=window.setTimeout(()=>zV(e,t,n),gse),mv.set(e.id,o)}var pt;function KV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,o)}return n}function ma(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?KV(Object(n),!0).forEach(function(o){x(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):KV(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}function YV(e){var t,n,o,s=2;for(typeof Symbol<"u"&&(n=fR,o=Symbol.iterator);s--;){if(n&&(t=e[n])!=null)return t.call(e);if(o&&(t=e[o])!=null)return new gv(t.call(e));n="@@asyncIterator",o="@@iterator"}throw new TypeError("Object is not async iterable")}function gv(e){function t(n){if(Object(n)!==n)return ye.reject(new TypeError(n+" is not an object."));var o=n.done;return ye.resolve(n.value).then(function(s){return{value:s,done:o}})}return gv=function(n){this.s=n,this.n=n.next},gv.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(n){var o=this.s.return;return o===void 0?ye.resolve({value:n,done:!0}):t(o.apply(this.s,arguments))},throw:function(n){var o=this.s.return;return o===void 0?ye.reject(n):t(o.apply(this.s,arguments))}},new gv(e)}let tm=(pt=class extends pn{get state(){return this._state}set state(e){const t=this._state;this._state=e,this.emit(Me.StateChange,t,this._state)}constructor(e,t){super(),x(this,"isPlanB",void 0),x(this,"store",void 0),x(this,"statsUploader",void 0),x(this,"connection",void 0),x(this,"localTrackMap",new Map),x(this,"remoteUserMap",new Map),x(this,"localDataChannels",[]),x(this,"remoteDataChannelMap",new Map),x(this,"pendingLocalTracks",[]),x(this,"pendingRemoteTracks",[]),x(this,"pendingLocalDataChannels",[]),x(this,"pendingRemoteDataChannels",[]),x(this,"statsCollector",void 0),x(this,"shouldForwardP2PCreation",void 0),x(this,"iceFailedCount",0),x(this,"dtlsFailedCount",0),x(this,"mutex",void 0),x(this,"_state",kt.Disconnected),x(this,"_pcStatsUploadType",H("NEW_ICE_RESTART")?$a.FIRST_CONNECTION:$a.OLD_FIRST_CONNECTION),x(this,"_isStartRestartIce",!1),x(this,"_restartTimer",void 0),x(this,"_isTryConnecting",!1),x(this,"_iceError",null),x(this,"_forceTurn",!1),x(this,"_isWaitPcToRePub",!1),x(this,"handleMuteLocalTrack",async(n,o,s)=>{const c=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==kt.Connected)return void s(new re(j.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const d=this.filterTobeMutedTracks(n);if(d.length===0)return void o();const h=d.find(m=>m[0]==="videoLowTrack");h&&h[1].track._originMediaStreamTrack.stop(),await this.connection.muteLocal(d.map(m=>{let[,{id:g}]=m;return g}));const p=this.createMuteMessage(d);await Yt(this,Me.RequestMuteLocal,p),o()}catch(d){s(d)}finally{c()}}),x(this,"handleUnmuteLocalTrack",async(n,o,s)=>{const c=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==kt.Connected)return void s(new re(j.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const d=this.filterTobeUnmutedTracks(n);if(d.length===0)return void o();const h=d.find(m=>m[0]==="videoLowTrack");if(h){const m=h[1];if(m.track._originMediaStreamTrack.stop(),!H("DISABLE_DUAL_STREAM_USE_ENCODING")&&Rt().supportDualStreamEncoding){const g=n._mediaStreamTrack.clone();m.track._mediaStreamTrack=g,m.track._originMediaStreamTrack=g}else{const g=zC(n,xf(this,Me.RequestLowStreamParameter));m.track._mediaStreamTrack=g,m.track._originMediaStreamTrack=g}await new ye((g,E)=>{this.handleReplaceTrack(m.track,g,E,!0)})}await this.connection.unmuteLocal(d.map(m=>{let[,{id:g}]=m;return g}));const p=this.createUnmuteMessage(d);await Yt(this,Me.RequestUnmuteLocal,p),o()}catch(d){s(d)}finally{c()}}),x(this,"handleUpdateVideoEncoder",async(n,o,s,c)=>{let d;c||(d=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoEncoder"));try{const p=this.localTrackMap.get(de.LocalVideoTrack);if(!this.connection||!p||p.track!==n||this.state!==kt.Connected)return void o();const{id:m,track:g}=p;await this.connection.updateSendParameters(m,g),await this.connection.updateEncoderConfig(m,g),this.emit(Me.UpdateVideoEncoder,g),o()}catch(p){s(p)}finally{var h;(h=d)===null||h===void 0||h()}}),x(this,"handleUpdateVideoSendParameters",async(n,o,s)=>{const c=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{const d=this.localTrackMap.get(de.LocalVideoTrack);if(!this.connection||!d||d.track!==n||this.state!==kt.Connected)return void o();const{id:h,track:p}=d;await this.connection.updateSendParameters(h,p),o()}catch(d){s(d)}finally{c()}}),x(this,"handleReplaceMixingTrack",async(n,o,s,c)=>{if(!this.connection||this.state!==kt.Connected)return void o();const d=HC([n]);let h;R.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(d.getTrackId(),"]")),typeof c=="boolean"&&c||(h=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(n,d),o()}catch(m){s(m)}finally{var p;(p=h)===null||p===void 0||p()}}),x(this,"handleReplaceTrack",async(n,o,s,c)=>{let d;R.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(n.getTrackId(),"]")),typeof c=="boolean"&&c||(d=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var h;const m=Array.from(this.localTrackMap.entries()).find(g=>{let[,{track:E}]=g;return n===E});if(!this.connection||!m||this.state!==kt.Connected)return void o();if(await((h=this.connection)===null||h===void 0?void 0:h.replaceTrack(n,m[1].id)),this.isPlanB){const g=m[1];g.id=n._mediaStreamTrack.id,this.localTrackMap.set(m[0],g)}if(m[0]===de.LocalVideoTrack&&!H("DISABLE_DUAL_STREAM_USE_ENCODING")&&Rt().supportDualStreamEncoding){const g=this.localTrackMap.get(de.LocalVideoLowTrack);if(g){const E=n._mediaStreamTrack.clone();g.track._originMediaStreamTrack.stop(),g.track._mediaStreamTrack=E,g.track._originMediaStreamTrack=E,await new ye((y,T)=>{this.handleReplaceTrack(g.track,y,T,!0)})}}o()}catch(m){s(m)}finally{var p;(p=d)===null||p===void 0||p()}}),x(this,"handleGetRTCStats",n=>{n(this.statsCollector.getRTCStats())}),x(this,"handleGetLocalVideoStats",n=>{n(this.statsCollector.getLocalVideoTrackStats())}),x(this,"handleGetLocalAudioStats",n=>{n(this.statsCollector.getLocalAudioTrackStats())}),x(this,"handleGetRemoteVideoStats",n=>this.statsCollector.getRemoteVideoTrackStats(n.uid)[n.uid]),x(this,"handleGetRemoteAudioStats",n=>this.statsCollector.getRemoteAudioTrackStats(n.uid)[n.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new HV(this.store),this.bindStatsUploaderEvents(),this.mutex=new Ir("P2PChannel-mutex",this.store.clientId),this.isPlanB=!Rt().supportUnifiedPlan||H("CHROME_FORCE_PLAN_B")&&Ga(),this.shouldForwardP2PCreation=H("FORWARD_P2P_CREATION")&&Rt().supportPCSetConfiguration&&bR(),this.shouldForwardP2PCreation&&(this.connection=hv(this.store),this.emit(Me.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection))}async startP2PConnection(e){var t;this.state=kt.New,this._forceTurn=VV(e),R.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] forceTurn: ").concat(this._forceTurn));const n=this.shouldForwardP2PCreation&&((t=this.connection)===null||t===void 0?void 0:t.peerConnectionState)==="closed";if(this.shouldForwardP2PCreation&&!n||(n&&this.connection&&(R.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.resetConnection(this.connection)),this.connection=hv(this.store,e),this.emit(Me.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),!this.connection)throw new re(j.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=H("NEW_ICE_RESTART")?$a.FIRST_CONNECTION:$a.OLD_FIRST_CONNECTION,this._isTryConnecting=!0,this._isStartRestartIce=!1,this._iceError=null,this.connection.setConfiguration(e),this.connection.establishPromise}async connect(e){if(!this.connection)throw new re(j.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");H("ENABLE_PREALLOC_PC")&&this.state===kt.Connected?await this.connection.updateRemoteConnect(e):(this.store.peerConnectionStart(),await this.connection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=kt.Connected)}updateRemoteRTPCapabilities(e){const t=Array.from(this.localTrackMap.entries()).filter(s=>{var c;let[d]=s;return Ee(c=[de.LocalVideoLowTrack,de.LocalVideoTrack]).call(c,d)}),n=t.map(s=>{let[,{id:c}]=s;return c}),o=t.map(s=>{let[c]=s;return c});if(this.connection instanceof fa){if(ke.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(o),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(e)}),!Ee(e).call(e,this.store.codec)){const s=["vp9","vp8","h264"].find(c=>Ee(e).call(e,c));s&&(this.store.codec=s,R.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(s,".")))}this.connection.updateRemoteRTPCapabilities(n,e)}}async getEstablishParams(){var e;if(this.connection instanceof fa&&this.connection.peerConnectionState!=="closed"&&Ee(e=[kt.New,kt.Connected]).call(e,this.state))return this.connection.establishPromise}async publishDataChannel(e){if(!this.connection||this.state!==kt.Connected){if(this.state===kt.Disconnected)throw new re(j.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return e.forEach(n=>{var o;Ee(o=this.pendingLocalDataChannels).call(o,n)||this.pendingLocalDataChannels.push(n)}),[]}const t=this.filterTobePublishedDataChannels(e);return t.length===0?[]:(t.forEach(n=>{const o=Date.now();this.store.publish(n.id.toString(),"datachannel",o)}),await this.connection.createDataChannels(this.store.uid,t),t.forEach(n=>{this.localDataChannels.push(n);const o=Date.now();this.store.publish(n.id+"","datachannel",void 0,o)}),e.map(n=>({streamId:n.id,ordered:n.ordered,maxRetransmits:n.maxRetransmits,metadata:n.metadata,channelId:n._originDataChannelId})))}publish(e,t,n){var o=this;return ho(function*(){const s=yield Tt(o.mutex.lock("From P2PChannel.publish"));try{var c;const d=o.connection&&Ee(c=["disconnected","failed"]).call(c,o.connection.peerConnectionState);if(!o.connection||o.state!==kt.Connected||d){if(o.state===kt.Disconnected)throw new re(j.UNEXPECTED_ERROR,"PeerConnection already disconnected.");o.throwIfTrackTypeNotMatch(e);const p=e.filter(m=>o.pendingLocalTracks.indexOf(m)===-1);return o.pendingLocalTracks=o.pendingLocalTracks.concat(p),void(d&&(o._isWaitPcToRePub=!0))}o.store.pubId=o.store.pubId+1,Or.markPublishStart(o.store.clientId,o.store.pubId);const h=o.filterTobePublishedTracks(e,t,n);if(h.length===0)return void(yield Tt(o.tryToUnmuteAudio(e)));yield*hE(YV(o.doPublish(o.connection,h)))}finally{s()}})()}doPublish(e,t){var n=this;return ho(function*(){t.forEach(y=>{let{track:T,type:P}=y;const I=Date.now();n.store.publish(T.getTrackId(),P===de.LocalAudioTrack?"audio":"video",I)}),n.bindLocalTrackEvents(t);const o=t.map(y=>{let{track:T}=y;return T}),s=yield Tt(e.send(o,n.store.codec,n.store.audioCodec)),c=(yield Tt(s.next())).value,d=n.createGatewayPublishMessage(t,c);let h;try{h=yield d}catch(y){throw s.throw(y),(y==null?void 0:y.code)===j.WS_ABORT&&t.forEach(T=>{let{track:P}=T;n.pendingLocalTracks.indexOf(P)===-1&&n.pendingLocalTracks.push(P)}),n.unbindLocalTrackEvents(t),y}const p=n.mapPubResToRemoteConfig(d,h,o),m=(yield Tt(s.next(p))).value;if(n.state===kt.Disconnected)throw new re(j.UNEXPECTED_ERROR,"PeerConnection already disconnected.");H("ENABLE_VIDEO_SEI");const g=H("ENABLE_ENCODED_TRANSFORM"),E=H("ENABLE_AUDIO_METADATA");o.forEach(async y=>{const T=y.getRTCRtpTransceiver();if(!T||!g)return;const{interceptLocalVideoFrame:P,interceptLocalAudioFrame:I}=ov();y.trackMediaType===Re.VIDEO?await P(T.sender,y):y.trackMediaType===Re.AUDIO&&await I(T.sender,{metadata:E?()=>{const A=y.metadata.shift();return A&&A.value}:void 0})}),t.forEach(y=>{let{type:T}=y;n.statsCollector.addLocalStats(T)}),n.assignLocalTracks(t,m),n.statsUploader.startUploadOutboundStats(),t.forEach(y=>{let{track:T,type:P}=y;const I=Date.now();n.store.publish(T.getTrackId(),P===de.LocalAudioTrack?"audio":"video",void 0,I)})})()}async updateVideoStreamParameter(e,t){const n=this.localTrackMap.get(t);if(!n||!this.connection)return;if(!(n.track instanceof nn))return R.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");const{track:o}=n,s=function(c,d){const h={};return c.height&&c.width&&(h.scaleResolutionDownBy=IC(c,d)),h.maxFramerate=c.framerate?Li(c.framerate):void 0,h.maxBitrate=c.bitrate?1e3*c.bitrate:void 0,h}(e,o);if(o._encoderConfig||(o._encoderConfig={}),t!==de.LocalVideoLowTrack||!H("DISABLE_DUAL_STREAM_USE_ENCODING")&&Rt().supportDualStreamEncoding)s.scaleResolutionDownBy!=null&&(o._encoderConfig.scaleResolutionDownBy=s.scaleResolutionDownBy);else{const c=o._originMediaStreamTrack;if(!c.canvas)return R.warn("[".concat(o.getTrackId(),"] no canvas on track"));(function(d,h){const p=d.canvas;h.width&&(p.width=Li(h.width)),h.height&&(p.height=Li(h.height)),h.framerate&&(p.stopCapture&&p.stopCapture(),p.stopCapture=tC(()=>{!p.startCapture&&p.stopCapture&&p.stopCapture(),p.startCapture&&p.startCapture()},Li(h.framerate)))})(c,e)}s.maxBitrate!=null&&(o._encoderConfig.bitrateMax=s.maxBitrate/1e3),s.maxFramerate!=null&&(o._encoderConfig.frameRate&&typeof o._encoderConfig.frameRate=="object"?o._encoderConfig.frameRate.max=s.maxFramerate:o._encoderConfig.frameRate={max:s.maxFramerate}),R.debug("[".concat(o.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(o._encoderConfig))),await this.connection.updateRtpSenderEncodings(o)}publishLowStream(e){var t=this;return ho(function*(){if(!t.connection||t.state!==kt.Connected)return;const n=yield Tt(t.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const s=t.localTrackMap.get(de.LocalVideoTrack);if(!s)throw new re(j.UNEXPECTED_ERROR,"Could not find high stream");if(t.localTrackMap.has(de.LocalVideoLowTrack))throw new re(j.UNEXPECTED_ERROR,"[".concat(t.store.clientId,"] Can't publish low stream when stream already publish"));const c=[{track:t.getLowVideoTrack(s.track,e),type:de.LocalVideoLowTrack}];if(yield*hE(YV(t.doPublish(t.connection,c))),s.track.muted||!s.track.enabled){var o;const d=(o=t.localTrackMap.get(de.LocalVideoLowTrack))===null||o===void 0?void 0:o.id;d!==void 0&&(yield Tt(t.connection.muteLocal([d])))}}finally{n()}})()}async republish(){this.pendingLocalTracks.length>0&&(R.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await Er(this,Me.RequestRePublish,this.pendingLocalTracks),this.emit(Me.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(R.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await Er(this,Me.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[]),this._isWaitPcToRePub=!1}async reSubscribe(e){for(let t=this.pendingRemoteTracks.length-1;t>=0;t--){const{user:n,kind:o}=this.pendingRemoteTracks[t];(o!==Re.AUDIO||n._audio_added_&&n._audioSSRC)&&(o!==Re.VIDEO||n._video_added_&&n._videoSSRC)||this.pendingRemoteTracks.splice(t,1)}if(e)await Er(this,Me.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:t,kind:n}of this.pendingRemoteTracks)await this.subscribe(t,n,n===Re.VIDEO?t._videoSSRC:t._audioSSRC);this.pendingRemoteTracks.forEach(t=>{let{user:n}=t;this.emit(Me.MediaReconnectEnd,n.uid)}),this.pendingRemoteTracks=[]}async unpublish(e){if(!this.connection||this.state!==kt.Connected)return void e.forEach(o=>{const s=this.pendingLocalTracks.indexOf(o);s!==-1&&this.pendingLocalTracks.splice(s,1)});const t=this.filterTobeUnpublishedTracks(e);if(t.length===0)return;const n=t.find(o=>o[0]==="videoLowTrack");return n&&n[1].track.close(),this.doUnpublish(this.connection,t)}async unpublishDataChannel(e){if(!this.connection||this.state!==kt.Connected)return void e.forEach(n=>{const o=this.pendingLocalDataChannels.indexOf(n);o!==-1&&this.pendingLocalDataChannels.splice(o,1)});const t=this.filterTobeUnpublishedDataChannels(e);return t.length!==0?(t.forEach(n=>{const o=this.localDataChannels.indexOf(n);o!==-1&&this.localDataChannels.splice(o,1)}),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),t.map(n=>n.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==kt.Connected)return;const e=this.localTrackMap.get(de.LocalVideoLowTrack);if(!e)return;e.track.close();const t=[[de.LocalVideoLowTrack,e]];return this.doUnpublish(this.connection,t)}async doUnpublish(e,t){const n=this.createGatewayUnpublishMessage(t);return await e.stopSending(t.map(o=>{let[,{id:s}]=o;return s})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(o=>{let[s,{track:c}]=o;return{type:s,track:c}})),t.forEach(o=>{let[s]=o;this.statsCollector.removeLocalStats(s)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),n}async subscribeDataChannel(e,t){if(!this.connection||this.state!==kt.Connected)throw new re(j.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const n=t.filter(o=>{var s;return!((s=this.remoteDataChannelMap.get(e))!==null&&s!==void 0&&s.get(o.id))});if(n.length!==0)return await this.connection.createDataChannels(e.uid,n),n.forEach(o=>{var s;this.remoteDataChannelMap.has(e)?(s=this.remoteDataChannelMap.get(e))===null||s===void 0||s.set(o.id,o):this.remoteDataChannelMap.set(e,new Map([[o.id,o]]));const c=this.pendingRemoteDataChannels.findIndex(d=>{let{user:h,id:p}=d;return h.uid===e.uid&&p===o.id});c!==-1&&this.pendingRemoteDataChannels.splice(c,1)}),n.map(o=>o.id)}async subscribe(e,t,n,o,s){var c;if(!this.connection||this.state!==kt.Connected)throw new re(j.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((c=this.remoteUserMap.get(e))!==null&&c!==void 0&&c.has(t))return;let d,h,p;const m=this.connection.getPreMedia(n);if(m)R.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(n,", no need to send sub to gateway.")),p=m.transceiver,d=m.track,h=m.id;else if(s){const y=s.find(P=>{let{stream_type:I}=P;return I===t});if(!y)throw new re(j.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(t," for user: ").concat(e.uid," because subscribe answer from gateway does not contain stream_type: ").concat(t,"."));const T=await this.connection.receive(t,y.ssrcs,String(e._uintid),y.attributes);this.connection instanceof fa&&(p=T.transceiver),d=T.track,h=T.id}else{const y=await this.connection.receive(t,[{ssrcId:n,rtx:o}],String(e._uintid),void 0);this.connection instanceof fa&&(p=y.transceiver),d=y.track,h=y.id}if(t===Re.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(d):(e._audioTrack=new hh(d,e.uid,e._uintid,this.store),R.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),p&&e._audioTrack._updateRtpTransceiver(p),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(d):(e._videoTrack=new uh(d,e.uid,e._uintid,this.store),R.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),p&&e._videoTrack._updateRtpTransceiver(p),this.bindRemoteTrackEvents(e,e._videoTrack)),p&&H("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:y,interceptRemoteAudioFrame:T}=ov();t==Re.VIDEO?await y(p.receiver,{onSei:H("ENABLE_VIDEO_SEI")&&(P=>{var I;return(I=e._videoTrack)===null||I===void 0?void 0:I._onSei(P)})}):t==Re.AUDIO&&await T(p.receiver,{enableTopn:!!H("ENABLE_AUDIO_TOPN"),enableMetadata:!!H("ENABLE_AUDIO_METADATA"),onMetadata:P=>{this.safeEmit(Me.AudioMetadata,P)}})}const g=this.remoteUserMap.get(e);g?g.set(t,h):this.remoteUserMap.set(e,new Map([[t,h]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats();const E=this.pendingRemoteTracks.findIndex(y=>{let{user:T,kind:P}=y;return T.uid===e.uid&&t===P});E!==-1&&(this.pendingRemoteTracks.splice(E,1),this.emit(Me.MediaReconnectEnd,e.uid))}async massSubscribe(e){return this.massSubscribeNoLock(e)}async massSubscribeNoLock(e){if(!this.connection||this.state!==kt.Connected)throw new re(j.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");e=e.filter(s=>{var c;let{user:d,mediaType:h}=s;return!((c=this.remoteUserMap.get(d))!==null&&c!==void 0&&c.has(h))});const t=[],n=new Map;e.forEach(s=>{if(!this.connection)return;const c=this.connection.getPreMedia(s.ssrcId);c?n.set(s.ssrcId,c):t.push(s)});const o=await this.connection.batchReceive(t.map(s=>{let{user:c,mediaType:d,ssrcId:h,rtxSsrcId:p}=s;return{kind:d,ssrcMsg:[{ssrcId:h,rtx:p}],mslabel:String(c._uintid)}}));t.forEach((s,c)=>{n.set(s.ssrcId,o[c])});for(const{user:s,mediaType:c,ssrcId:d}of e){const h=n.get(d);if(!h)return void R.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(s.uid," subscribe data,").concat(c,", ").concat(d));const{track:p,id:m,transceiver:g}=h;if(g&&H("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:T,interceptRemoteAudioFrame:P}=ov();c==Re.VIDEO?await T(g.receiver,{onSei:H("ENABLE_VIDEO_SEI")&&(I=>{var A;return(A=s._videoTrack)===null||A===void 0?void 0:A._onSei(I)})}):c==Re.AUDIO&&await P(g.receiver,{enableTopn:!!H("ENABLE_AUDIO_TOPN"),enableMetadata:!!H("ENABLE_AUDIO_METADATA"),onMetadata:I=>{this.safeEmit(Me.AudioMetadata,I)}})}if(c===Re.AUDIO?(s._audioTrack?s._audioTrack._updateOriginMediaStreamTrack(p):(s._audioTrack=new hh(p,s.uid,s._uintid,this.store),R.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(s._audioTrack.getTrackId()))),g&&s._audioTrack._updateRtpTransceiver(g),this.bindRemoteTrackEvents(s,s._audioTrack)):(s._videoTrack?s._videoTrack._updateOriginMediaStreamTrack(p):(s._videoTrack=new uh(p,s.uid,s._uintid,this.store),R.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(s._videoTrack.getTrackId()))),g&&s._videoTrack._updateRtpTransceiver(g),this.bindRemoteTrackEvents(s,s._videoTrack)),H("ENABLE_VIDEO_SEI")&&g){const{interceptRemoteVideoFrame:T,interceptRemoteAudioFrame:P}=ov();c==Re.VIDEO?await T(g.receiver,{onSei:I=>{var A;(A=s._videoTrack)===null||A===void 0||A._onSei(I)}}):c==Re.AUDIO&&await P(g.receiver)}const E=this.remoteUserMap.get(s);E?E.set(c,m):this.remoteUserMap.set(s,new Map([[c,m]])),this.statsCollector.addRemoteStats(s.uid),this.statsUploader.startUploadInboundStats();const y=this.pendingRemoteTracks.findIndex(T=>{let{user:P,kind:I}=T;return P.uid===s.uid&&c===I});y!==-1&&(this.pendingRemoteTracks.splice(y,1),this.emit(Me.MediaReconnectEnd,s.uid))}}async unsubscribe(e,t,n){const o=this.pendingRemoteTracks.filter(d=>{let{user:h,kind:p}=d;return t!==void 0?h.uid===e.uid&&t===p:h.uid===e.uid});if(o.forEach(d=>{const h=this.pendingRemoteTracks.indexOf(d);this.pendingRemoteTracks.splice(h,1)}),this.connection&&this.state===kt.Connected||n||o.forEach(d=>{let{kind:h}=d;var p;if(h===Re.AUDIO)(p=e._audioTrack)===null||p===void 0||p._destroy(),e._audioTrack=void 0;else if(h===Re.VIDEO){var m;(m=e._videoTrack)===null||m===void 0||m._destroy(),e._videoTrack=void 0}}),!this.connection||this.state!==kt.Connected)return;const s=this.filterTobeUnSubscribedTracks(e,t);if(s.length===0)return;await this.connection.stopReceiving(s.map(d=>{let[,{id:h}]=d;return h}));const c=this.createUnsubscribeMessage(s);return this.withdrawRemoteTracks(s),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),s.forEach(d=>{let[h,{kind:p}]=d;var m,g;if(p===Re.VIDEO&&h._videoSSRC&&((m=this.connection)===null||m===void 0||m.setStatsRemoteVideoIsReady(h._videoSSRC,!1)),p===Re.VIDEO)this.unbindRemoteTrackEvents(h._videoTrack),n||((g=h._videoTrack)===null||g===void 0||g._destroy(),h._videoTrack=void 0);else if(p===Re.AUDIO){var E;this.unbindRemoteTrackEvents(h._audioTrack),!n&&((E=h._audioTrack)===null||E===void 0||E._destroy(),h._audioTrack=void 0)}}),c}async unsubscribeDataChannel(e,t){if(t.forEach(s=>{const c=this.pendingRemoteDataChannels.findIndex(d=>d.id===s.id);c!==-1&&this.pendingRemoteDataChannels.splice(c,1)}),!this.connection)return;const n=this.filterTobeUnSubscribedDataChannels(e,t);if(n.length===0)return;t.forEach(s=>{s._close()});const o=this.remoteDataChannelMap.get(e);return n.forEach(s=>{o&&o.delete(s.id)}),o&&o.size===0&&(this.remoteDataChannelMap.delete(e),await this.connection.stopDataChannels(e.uid)),n.map(s=>s.id)}async massUnsubscribe(e){return this.massUnsubscribeNoLock(e)}async massUnsubscribeNoLock(e){let t=[];for(const{user:s,mediaType:c}of e){const d=this.pendingRemoteTracks.filter(h=>{let{user:p,kind:m}=h;return c!==void 0?p.uid===s.uid&&c===m:p.uid===s.uid});d.forEach(h=>{const p=this.pendingRemoteTracks.indexOf(h);this.pendingRemoteTracks.splice(p,1)}),t=t.concat(d)}if(!this.connection||this.state!==kt.Connected)return void t.forEach(s=>{let{user:c,kind:d}=s;var h;if(d===Re.AUDIO)(h=c._audioTrack)===null||h===void 0||h._destroy(),c._audioTrack=void 0;else if(d===Re.VIDEO){var p;(p=c._videoTrack)===null||p===void 0||p._destroy(),c._videoTrack=void 0}});const n=Fo(e).call(e,(s,c)=>{let{user:d,mediaType:h}=c;const p=this.filterTobeUnSubscribedTracks(d,h);return s.concat(p)},[]);if(n.length===0)return;await this.connection.stopReceiving(n.map(s=>{let[,{id:c}]=s;return c}));const o=this.createUnsubscribeAllMessage(n);return this.withdrawRemoteTracks(n),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),n.forEach(s=>{let[c,{kind:d}]=s;var h,p;if(d===Re.VIDEO&&c._videoSSRC&&((h=this.connection)===null||h===void 0||h.setStatsRemoteVideoIsReady(c._videoSSRC,!1)),d===Re.VIDEO)this.unbindRemoteTrackEvents(c._videoTrack),(p=c._videoTrack)===null||p===void 0||p._destroy(),c._videoTrack=void 0;else if(d===Re.AUDIO){var m;this.unbindRemoteTrackEvents(c._audioTrack),(m=c._audioTrack)===null||m===void 0||m._destroy(),c._audioTrack=void 0}}),o}isPreSubScribe(e){return!this.connection||this.state!==kt.Connected?!1:!!this.connection.getPreMedia(e)}async muteRemote(e,t){if(!this.connection)return;const n=this.remoteUserMap.get(e);if(!n)return void R.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid,"."));if(!n.get(t))return void R.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));const o=t===Re.VIDEO?e._videoSSRC:e._audioSSRC;o!==void 0&&this.connection.setStatsRemoteVideoIsReady(o,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.connection)return;const n=this.remoteUserMap.get(e);if(!n)return void R.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid,"."));n.get(t)||R.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))}addAudioMetadata(e){const t=this.localTrackMap.get(de.LocalAudioTrack),n=t&&t.track;n&&n.metadata.push(e)}getAllTracks(e){const t=this.localTrackMap.get(de.LocalAudioTrack);if((t==null?void 0:t.track)instanceof Bn){const n=t.track;return Array.from(this.localTrackMap.entries()).filter(o=>{let[s]=o;return s!==de.LocalAudioTrack}).filter(o=>{let[s]=o;return!(e&&s===de.LocalVideoLowTrack)}).map(o=>{let[,{track:s}]=o;return s}).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter(n=>{let[o]=n;return!(e&&o===de.LocalVideoLowTrack)}).map(n=>{let[,{track:o}]=n;return o})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(e,t,n,o,s){if(e){const d=this.localTrackMap.get(de.LocalAudioTrack),h=o?this.localTrackMap.get(de.LocalVideoLowTrack):this.localTrackMap.get(de.LocalVideoTrack);ke.publish(this.store.sessionId,{eventElapse:Or.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:d==null?void 0:d.track.getTrackLabel(),videoName:h==null?void 0:h.track.getTrackLabel(),screenshare:(h==null?void 0:h.track._hints.indexOf(Gt.SCREEN_TRACK))!==-1,audio:!!d,video:!!h,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:s})}else{var c;n||(n=[]);const d=n.find(p=>p instanceof Sn),h=o?(c=this.localTrackMap.get(de.LocalVideoTrack))===null||c===void 0?void 0:c.track:n.find(p=>p instanceof nn);ke.publish(this.store.sessionId,{eventElapse:Or.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:d==null?void 0:d.getTrackLabel(),videoName:h==null?void 0:h.getTrackLabel(),screenshare:(h==null?void 0:h._hints.indexOf(Gt.SCREEN_TRACK))!==-1,audio:!!d,video:!!h,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:s})}}reportSubscribeEvent(e,t,n,o){const s=o===Re.VIDEO?n._videoSSRC:n._audioSSRC;s&&ke.subscribe(this.store.sessionId,{succ:e,ec:t,video:o===Re.VIDEO,audio:o===Re.AUDIO,peerid:n.uid,subscribeRequestid:s,p2pid:this.store.p2pId,eventElapse:Or.measureFromSubscribeStart(this.store.clientId,s),preSsrc:this.isPreSubScribe(s)})}reset(){R.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new Ir("P2PChannel-mutex",this.store.clientId),this.connection&&(this.resetConnection(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=hv(this.store),this.emit(Me.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.statsUploader.stopUploadBaseStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(de.LocalAudioTrack);if((e==null?void 0:e.track)instanceof Bn){if(e.track.trackList.length>0){const t=e.track;e.track.trackList.forEach(n=>{t.removeAudioTrack(n)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=kt.Disconnected}getStats(){var e;return(e=this.connection)===null||e===void 0?void 0:e.getStats()}getRemoteVideoIsReady(e){var t;return((t=this.connection)===null||t===void 0?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(de.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(de.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const t=this.localTrackMap.get(e);return t&&t.track instanceof nn||t&&t.track instanceof Sn?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}getRemoteMedia(e){var t;const n=Array.from(Xi(t=this.remoteUserMap).call(t)).find(o=>o.uid===e);return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(n=>{let[o]=n;return{uid:o.uid,level:o.audioTrack?100*o.audioTrack._source.getAccurateVolumeLevel():0}});const t=this.localTrackMap.get(de.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=ql(e).call(e,(n,o)=>n.level-o.level),e}async disconnectForReconnect(){this.connection&&(R.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=kt.Reconnecting,H("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t]=e;var n;t._videoTrack&&t._videoTrack._player&&((n=t._videoTrack._player.getVideoElement())===null||n===void 0||n.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())}),this.resetConnection(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=hv(this.store),this.emit(Me.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var t;let[n,{track:o}]=e;switch(n){case de.LocalVideoTrack:Ee(t=o._hints).call(t,Gt.LOW_STREAM)?o.close():this.pendingLocalTracks.push(o);break;case de.LocalAudioTrack:o instanceof Bn?this.pendingLocalTracks=this.pendingLocalTracks.concat(o.trackList):this.pendingLocalTracks.push(o);case de.LocalVideoLowTrack:}}),this.emit(Me.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;Array.from(Xi(n).call(n)).forEach(o=>{this.setPendingRemoteMedia(t,o)}),this.emit(Me.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(e=>{this.pendingLocalDataChannels.push(e)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(e=>{let[t,n]=e;Array.from(Xi(n).call(n)).forEach(o=>{this.setPendingRemoteDataChannel(t,o)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),R.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(e,t){for(const n of this.pendingRemoteDataChannels){const{user:o,id:s}=n;if((e instanceof Bc?e.uid:e)===o.uid&&s===t)return!0}return!1}setPendingRemoteDataChannel(e,t){this.hasPendingRemoteDataChannel(e,t)||this.pendingRemoteDataChannels.push({user:e,id:t})}hasPendingRemoteMedia(e,t){for(const n of this.pendingRemoteTracks){const{user:o,kind:s}=n;if((e instanceof Bc?e.uid:e)===o.uid&&t===s)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}restartICE(e){var t=this;return ho(function*(){if(!t.connection||t.state!==kt.Connected)return;const n=yield Tt(t.mutex.lock("From P2PChannel.restartICE"));let o;try{o=yield Tt(t.connection.restartICE(e));const c=yield Tt(o.next());if(c.done)return;const d=c.value,h=yield d;switch(GC(t.connection)&&t.reportPCStats(Date.now(),!1,t._pcStatsUploadType),e){case Nr.UDP_TCP_RELAY:t._pcStatsUploadType=$a.UDP_TCP_RESTART;break;case Nr.TCP_RELAY:t._pcStatsUploadType=$a.TCP_RESTART;break;case Nr.RELAY:t._pcStatsUploadType=$a.RELAY_RESTART;break;default:t._pcStatsUploadType=$a.OLD_RESTART}t._isTryConnecting=!0,o.next(h)}catch(c){var s;(s=o)===null||s===void 0||s.throw(c)}finally{n()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats(),t=this.localTrackMap.get(de.LocalVideoTrack),n=this.localTrackMap.get(de.LocalAudioTrack),o=e.videoSend.find(T=>T.ssrc===(t==null?void 0:t.ssrcs[0].ssrcId)),s=e.audioSend.find(T=>T.ssrc===(n==null?void 0:n.ssrcs[0].ssrcId));if(!o||!s)return 1;const c=Yi(this,Me.NeedSignalRTT),d=o?o.rttMs:void 0,h=s?s.rttMs:void 0,p=d&&h?(d+h)/2:d||h,m=(p&&c?(p+c)/2:p||c)||0,g=100*e.sendPacketLossRate*.7/50+.3*m/1500,E=g<.17?1:g<.36?2:g<.59?3:g<.1?4:5,y=t==null?void 0:t.track;if(y&&y._encoderConfig&&y._hints.indexOf(Gt.SCREEN_TRACK)===-1){const T=y._encoderConfig.bitrateMax,P=e.bitrate.actualEncoded;if(T&&P){const I=(1e3*T-P)/(1e3*T);return Pj[I<.15?0:I<.3?1:I<.45?2:I<.6?3:4][E]}}return E}getDownlinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats();let t=0;return Array.from(this.remoteUserMap.entries()).forEach(n=>{let[o]=n;const s=o._audioSSRC,c=o._videoSSRC,d=e.audioRecv.find(P=>P.ssrc===s),h=e.videoRecv.find(P=>P.ssrc===c);if(!d&&!h)return void(t+=1);const p=Yi(this,Me.NeedSignalRTT),m=e.rtt,g=(m&&p?(m+p)/2:m||p)||0,E=d?d.jitterMs:void 0,y=e.recvPacketLossRate;let T=.7*y*100/50+.3*g/1500;E&&(T=.6*y*100/50+.2*g/1500+.2*E/400),t+=T<.1?1:T<.17?2:T<.36?3:T<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new ye((t,n)=>{this.handleMuteLocalTrack(e,t,n)})}async replaceTrack(e,t){var n;if(R.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(e.getTrackId(),"] to [").concat(t.getTrackId(),"]")),!this.connection||this.state!==kt.Connected)return;const o=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:d}]=c;return e===d});if(!o)return;const s=o[0];if(e!==t&&(this.unbindLocalTrackEvents([{track:e,type:s}]),this.bindLocalTrackEvents([{track:t,type:s}]),o[1].track=t),await((n=this.connection)===null||n===void 0?void 0:n.replaceTrack(t,o[1].id)),this.isPlanB){const c=o[1];c.id=t._mediaStreamTrack.id,this.localTrackMap.set(s,c)}if(s===de.LocalVideoTrack&&!H("DISABLE_DUAL_STREAM_USE_ENCODING")&&Rt().supportDualStreamEncoding){const c=this.localTrackMap.get(de.LocalVideoLowTrack);if(c){const d=e._mediaStreamTrack.clone();c.track._originMediaStreamTrack.stop(),c.track._mediaStreamTrack=d,c.track._originMediaStreamTrack=d,await new ye((h,p)=>{this.handleReplaceTrack(c.track,h,p,!0)})}}}filterTobePublishedTracks(e,t,n){const o=[],s=this.getAllTracks();e=Qu(e=e.filter(p=>s.indexOf(p)===-1));let c,d=!1;const h=this.localTrackMap.get(de.LocalAudioTrack);for(const p of e){if(p instanceof nn&&(this.localTrackMap.has(de.LocalVideoTrack)||d?new re(j.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(o.push({track:p,type:de.LocalVideoTrack}),d=!0),t)){const m=this.getLowVideoTrack(p,n);o.push({track:m,type:de.LocalVideoLowTrack})}if(p instanceof Sn)if(h){const m=h.track;if(m instanceof Bn)WC([p]),m.addAudioTrack(p),this.bindLocalAudioTrackEvents(p,!0);else{const g=HC([m,p]);R.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(g.getTrackId(),"]")),this.replaceTrack(m,g)}}else c instanceof Bn?(WC([p]),c.addAudioTrack(p)):c||!p._useAudioElement&&Rt().webAudioMediaStreamDest&&!p._bypassWebAudio?c=HC(c?[p,c]:[p]):c=p}return c&&(R.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(c.getTrackId(),"]")),o.push({track:c,type:de.LocalAudioTrack})),o}filterTobeUnpublishedTracks(e){const t=[],n=this.getAllTracks();e=Qu(e=e.filter(o=>n.indexOf(o)!==-1));for(const o of e){if(o instanceof Sn){const s=this.localTrackMap.get(de.LocalAudioTrack);if(!s)continue;s.track instanceof Bn?(s.track.removeAudioTrack(o),this.unbindLocalAudioTrackEvents(o),s.track.trackList.length===0&&(t.push([de.LocalAudioTrack,s]),s.track.close())):t.push([de.LocalAudioTrack,s])}if(o instanceof nn){const s=this.localTrackMap.get(de.LocalVideoTrack);if(!s)continue;t.push([de.LocalVideoTrack,s]);const c=this.localTrackMap.get(de.LocalVideoLowTrack);c&&t.push([de.LocalVideoLowTrack,c])}}return t}filterTobePublishedDataChannels(e){return e=(e=Qu(e)).filter(t=>this.localDataChannels.findIndex(n=>n.id===t.id)===-1)}filterTobeUnpublishedDataChannels(e){return e=(e=(e=Qu(e)).filter(t=>this.localDataChannels.indexOf(t)!==-1)).filter(t=>t._originDataChannel)}bindLocalTrackEvents(e){e.forEach(t=>{let{track:n,type:o}=t;switch(o){case de.LocalVideoTrack:n.addListener(Ne.GET_STATS,this.handleGetLocalVideoStats),n.addListener(Ne.GET_RTC_STATS,this.handleGetRTCStats),n.addListener(Ne.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(Ne.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(Ne.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.addListener(Ne.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.addListener(Ne.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.addListener(Ne.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(Ne.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case de.LocalAudioTrack:this.bindLocalAudioTrackEvents(n);case de.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,t){e instanceof Bn?e.trackList.forEach(n=>{n.addListener(Ne.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(Ne.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(Ne.GET_STATS,this.handleGetLocalAudioStats),n.addListener(Ne.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(Ne.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(Ne.GET_STATS,this.handleGetLocalAudioStats),e.addListener(Ne.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(Ne.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(Ne.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(Ne.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||(e.addListener(Ne.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.addListener(Ne.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(t=>{let[n,{track:o}]=t;return{track:o,type:n}})),e.forEach(t=>{let{track:n,type:o}=t;switch(o){case de.LocalVideoTrack:n.off(Ne.GET_STATS,this.handleGetLocalVideoStats),n.off(Ne.GET_RTC_STATS,this.handleGetRTCStats),n.off(Ne.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(Ne.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(Ne.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.off(Ne.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.off(Ne.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.off(Ne.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(Ne.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case de.LocalAudioTrack:this.unbindLocalAudioTrackEvents(n);case de.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof Bn?e.trackList.forEach(t=>{t.off(Ne.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(Ne.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(Ne.GET_STATS,this.handleGetLocalAudioStats),t.off(Ne.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(Ne.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(Ne.GET_STATS,this.handleGetLocalAudioStats),e.off(Ne.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(Ne.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(Ne.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(Ne.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),e.off(Ne.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(Ne.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof uh&&t.addListener(Ne.GET_STATS,n=>{n(this.handleGetRemoteVideoStats(e))}),t instanceof hh&&t.addListener(Ne.GET_STATS,n=>{n(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(Ne.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;n.has(Re.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),n.has(Re.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((n,o)=>{var s;let c,d,{track:h,type:p}=n;switch(p){case de.LocalAudioTrack:c=xt.Audio,d={dtx:h instanceof Ff&&h._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case de.LocalVideoTrack:c=Ee(s=h._hints).call(s,Gt.SCREEN_TRACK)?xt.Screen:xt.High,d=ma(ma({},Yj(h)),{},{codec:this.store.codec,svc_mode:ev()});break;case de.LocalVideoLowTrack:c=xt.Low,d=ma(ma({},Yj(h)),{},{codec:this.store.codec,svc_mode:ev()})}return{stream_type:c,attributes:d,ssrcs:t[o]}})}createGatewayUnpublishMessage(e){return e.map(t=>{var n;let o,[s,{track:c,ssrcs:d,id:h}]=t;switch(s){case de.LocalVideoTrack:o=Ee(n=c._hints).call(n,Gt.SCREEN_TRACK)?xt.Screen:xt.High;break;case de.LocalAudioTrack:o=xt.Audio;break;case de.LocalVideoLowTrack:o=xt.Low}return{stream_type:o,ssrcs:d,mid:h}})}assignLocalTracks(e,t){e.forEach((n,o)=>{let{track:s,type:c}=n;this.localTrackMap.set(c,{track:s,id:t[o].id,ssrcs:t[o].localSSRC})})}withdrawLocalTracks(e){e.forEach(t=>{let[n]=t;this.localTrackMap.delete(n)})}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{if(R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(t,")")),this.emit(Me.PeerConnectionStateChange,t),t==="connecting"&&e instanceof fa&&!gn()&&H("FIRST_TCP_CANDIDATE")&&window.setTimeout(()=>{t==="connecting"&&e.extendCandidate()},H("FIRST_TCP_CANDIDATE_INTERVAL")),t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t==="connected"&&(this._restartTimer&&(window.clearTimeout(this._restartTimer),this._restartTimer=void 0),e instanceof fa&&GV(e,!0),this._isTryConnecting&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isTryConnecting=!1,this._isStartRestartIce=!1,this._pcStatsUploadType=$a.DISCONNECTED_OR_FAILED,Yi(this,Me.QueryClientConnectionState)==="CONNECTED"&&this._isWaitPcToRePub)){const n=this.pendingLocalTracks.map(s=>s.getTrackId()),o=this.pendingLocalDataChannels.map(s=>"dc_".concat(s.id));ke.reportApiInvoke(this.store.sessionId,{name:Nn.REPUB_AFTER_PC_CONNECTED,options:n.concat(o),tag:En.TRACER}).onSuccess(),this.republish()}if(H("NEW_ICE_RESTART")&&e instanceof fa&&!gn()&&!this._forceTurn){if(Ee(Bj).call(Bj,t)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const n=s=>{GC(e)&&(R.debug("[".concat(this.store.clientId,"] [P2PChannel] try to restartICE, type is ").concat(s)),Yi(this,Me.QueryClientConnectionState)==="CONNECTED"&&this.emit(Me.RequestRestartICE,s))},o=()=>{GC(e)&&(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),R.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(Me.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())};return void(this._restartTimer=window.setTimeout(()=>{zV(e,n,o)},800))}}else{if(t==="disconnected"&&e.iceConnectionState==="disconnected")return setTimeout(()=>{e.iceConnectionState==="disconnected"&&H("ICE_RESTART")&&Yi(this,Me.QueryClientConnectionState)==="CONNECTED"&&this.emit(Me.RequestRestartICE)},800),void setTimeout(()=>{e.peerConnectionState==="disconnected"&&(R.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isTryConnecting=!1,setTimeout(()=>this.emit(Me.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);t==="failed"&&(R.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),setTimeout(()=>this.emit(Me.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},e.onICEConnectionStateChange=t=>{t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),ke.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:En.TRACER}).onSuccess(),this.emit(Me.IceConnectionStateChange,t)},e.onICETransportStateChange=t=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},e.onDTLSTransportStateChange=t=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},e.onDTLSTransportError=t=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},e.onFirstAudioDecoded=t=>{var n;const o=Array.from(Xi(n=this.remoteUserMap).call(n)).find(c=>c._audioSSRC===t);var s;o&&(this.store.subscribe(o.uid,"audio",void 0,void 0,void 0,Date.now()),(s=o.audioTrack)===null||s===void 0||s.emit(sh.FIRST_FRAME_DECODED),ke.firstRemoteFrame(this.store.sessionId,$n.FIRST_AUDIO_DECODE,dn.FIRST_AUDIO_DECODE,{peer:o._uintid,subscribeElapse:Or.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=t=>{var n;const o=Array.from(Xi(n=this.remoteUserMap).call(n)).find(s=>s._audioSSRC===t);o&&ke.firstRemoteFrame(this.store.sessionId,$n.FIRST_AUDIO_RECEIVED,dn.FIRST_AUDIO_RECEIVED,{peer:o._uintid,subscribeElapse:Or.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(t,n,o)=>{this.reportVideoFirstFrameDecoded(t,n,o)},e.onFirstVideoReceived=t=>{var n;const o=Array.from(Xi(n=this.remoteUserMap).call(n)).find(s=>s._videoSSRC===t);o&&ke.firstRemoteFrame(this.store.sessionId,$n.FIRST_VIDEO_RECEIVED,dn.FIRST_VIDEO_RECEIVED,{peer:o._uintid,subscribeElapse:Or.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(t,n)=>{const o=t.candidateType==="relay",s=n.candidateType==="relay";n.candidateType!=="unknown"&&o===s||this.emit(Me.ConnectionTypeChange,o),R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(jc(n))," -> ").concat(JSON.stringify(jc(t)),")"))},e.onSelectedRemoteCandidateChanged=(t,n)=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(jc(n))," -> ").concat(JSON.stringify(jc(t)),")"))},e.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)},e.getLocalVideoStats=()=>{const t=this.statsCollector.getLocalVideoTrackStats(),n=this.statsCollector.getRTCStats();return ma(ma({},t),n)},e.onICECandidateError=t=>{this._iceError=t}}resetConnection(e){e instanceof fa&&function(t){Ch.delete(t.id),GV(t)}(e),e.close(),this.emit(Me.PeerConnectionStateChange,"closed"),function(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0,t.getLocalVideoStats=void 0}(e),this._isWaitPcToRePub=!1}filterTobeMutedTracks(e){const t=[];if(this.getAllTracks().indexOf(e)===-1)return t;const n=this.localTrackMap.get(de.LocalAudioTrack);if(e instanceof Sn&&(n==null?void 0:n.track)instanceof Bn)return n.track.isActive||t.push([de.LocalAudioTrack,n]),t;const o=Array.from(this.localTrackMap.entries()).find(s=>{let[,{track:c}]=s;return e===c});if(o&&(t.push(o),o[0]===de.LocalVideoTrack)){const s=this.localTrackMap.get(de.LocalVideoLowTrack);s&&t.push([de.LocalVideoLowTrack,s])}return t}filterTobeUnmutedTracks(e){const t=[],n=this.localTrackMap.get(de.LocalAudioTrack);if(e instanceof Sn&&(n==null?void 0:n.track)instanceof Bn)return n.track.isActive&&t.push([de.LocalAudioTrack,n]),t;const o=Array.from(this.localTrackMap.entries()).find(s=>{let[,{track:c}]=s;return e===c});if(o)if(o[0]===de.LocalVideoTrack){t.push(o);const s=this.localTrackMap.get(de.LocalVideoLowTrack);s&&t.push([de.LocalVideoLowTrack,s])}else t.push(o);return t}createMuteMessage(e){return e.map(t=>{var n;let o,[s,{track:c,ssrcs:d,id:h}]=t;switch(s){case de.LocalAudioTrack:o=xt.Audio;break;case de.LocalVideoTrack:o=Ee(n=c._hints).call(n,Gt.SCREEN_TRACK)?xt.Screen:xt.High;break;case de.LocalVideoLowTrack:o=xt.Low}return{stream_type:o,ssrcs:d,mid:h}})}createUnmuteMessage(e){return e.map(t=>{var n;let o,[s,{track:c,ssrcs:d,id:h}]=t;switch(s){case de.LocalAudioTrack:o=xt.Audio;break;case de.LocalVideoTrack:o=Ee(n=c._hints).call(n,Gt.SCREEN_TRACK)?xt.Screen:xt.High;break;case de.LocalVideoLowTrack:o=xt.Low}return{stream_type:o,ssrcs:d,mid:h}})}filterTobeUnSubscribedTracks(e,t){const n=[],o=this.remoteUserMap.get(e);if(!o)return n;if(t){const s=o.get(t);if(!s)return n;n.push([e,{kind:t,id:s}])}else Array.from(o.entries()).forEach(s=>{let[c,d]=s;n.push([e,{kind:c,id:d}])});return n}filterTobeUnSubscribedDataChannels(e,t){const n=[];return t.forEach(o=>{var s;(s=this.remoteDataChannelMap.get(e))!==null&&s!==void 0&&s.has(o.id)&&n.push(o)}),n}createUnsubscribeMessage(e){const t=[];return e.forEach(n=>{let[o,{kind:s,id:c}]=n;switch(s){case Re.VIDEO:return void(o._videoSSRC&&t.push({stream_type:Re.VIDEO,ssrcId:o._videoSSRC}));case Re.AUDIO:return void(o._audioSSRC&&t.push({stream_type:Re.AUDIO,ssrcId:o._audioSSRC}))}}),t}createUnsubscribeAllMessage(e){const t=new Map;return e.forEach(n=>{let[o,{kind:s}]=n;if(t.has(o)){let c=t.get(o);s===Re.VIDEO?c|=Jn.Video:c|=Jn.Audio,t.set(o,c)}else s===Re.VIDEO?t.set(o,Jn.Video):t.set(o,Jn.Audio)}),{users:Array.from(t.entries()).map(n=>{let[o,s]=n;return{stream_id:o.uid,stream_type:s}})}}withdrawRemoteTracks(e){e.forEach(t=>{let[n,{kind:o}]=t;const s=this.remoteUserMap.get(n);s&&(s.delete(o),Array.from(s.entries()).length===0&&this.remoteUserMap.delete(n))})}async updateBitrateLimit(e){const t=this.localTrackMap.get(de.LocalVideoTrack),n=this.localTrackMap.get(de.LocalVideoLowTrack);t&&(await t.track.setBitrateLimit(e.uplink),await new ye((o,s)=>{this.handleUpdateVideoEncoder(t.track,o,s,!0)})),n&&e.low_stream_uplink&&(await n.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new ye((o,s)=>{this.handleUpdateVideoEncoder(n.track,o,s,!0)}))}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}mapPubResToRemoteConfig(e,t,n){return e.map((o,s)=>{var c;let{stream_type:d}=o;const h=(c=t.find(p=>{let{stream_type:m}=p;return d===m}))===null||c===void 0?void 0:c.attributes;if(h&&H("DISABLE_SCREEN_SHARE_REMB")){const p=n[s]._hints;(Ee(p).call(p,Gt.SCREEN_TRACK)||Ee(p).call(p,Gt.SCREEN_LOW_TRACK))&&(h.remb=!1,R.debug("disable remb for screen share, hints:",p))}return h})}async tryToUnmuteAudio(e){for(let n=0;n<e.length;n++)if(e[n]instanceof Sn){var t;const o=this.filterTobeUnmutedTracks(e[n]);if(o.length===0)continue;await((t=this.connection)===null||t===void 0?void 0:t.unmuteLocal(o.map(c=>{let[,{id:d}]=c;return d})));const s=this.createUnmuteMessage(o);return void await Yt(this,Me.RequestUnmuteLocal,s)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!((t=this.connection)===null||t===void 0||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(Me.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(Me.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks(),this.statsUploader.requestTransportStats=()=>{var e;return{connectState:((e=this.connection)===null||e===void 0?void 0:e.peerConnectionState)||"closed"}}}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await cr(LR(this.dtlsFailedCount,Un)),this.emit(Me.RequestReconnect)}async reconnectP2P(){const e=Array.from(this.localTrackMap.entries()),t=this.createGatewayUnpublishMessage(e);Array.from(this.remoteUserMap.entries()),t.length>0&&await Er(this,Me.RequestUnpublishForReconnectPC,t),this.disconnectForReconnect(),this.emit(Me.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(de.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof nn)}throwIfTrackTypeNotMatch(e){if(e.filter(t=>t instanceof nn).length>1)throw new re(j.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(t=>t instanceof Sn).length>1&&(e.some(t=>t instanceof Sn&&t._bypassWebAudio)||!Rt().webAudioMediaStreamDest))throw new re(j.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const t of e){if(t instanceof nn&&this.pendingLocalTracks.some(n=>n instanceof nn))throw new re(j.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof Sn&&this.pendingLocalTracks.some(n=>n instanceof Sn)&&(!Rt().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(n=>n instanceof Sn&&n._bypassWebAudio)))throw new re(j.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){var n;const o=!H("DISABLE_DUAL_STREAM_USE_ENCODING")&&Rt().supportDualStreamEncoding,s=ma(ma({},{width:160,height:120,framerate:15,bitrate:50}),t);let c;c=o?e._mediaStreamTrack.clone():zC(e,s);const d=Jt(8,"track-low-"),h=new nn(c,ma(ma({},o&&{scaleResolutionDownBy:IC(s,e)}),{},{frameRate:s.framerate,bitrateMax:s.bitrate,bitrateMin:s.bitrate}),void 0,void 0,d);return h.on(ad.TRANSCEIVER_UPDATED,p=>{e._updateRtpTransceiver(p,ih.LOW_STREAM)}),h._hints.push(Gt.LOW_STREAM),Ee(n=e._hints).call(n,Gt.SCREEN_TRACK)&&h._hints.push(Gt.SCREEN_LOW_TRACK),e.on("sei-to-send",p=>{h.emit("sei-to-send",p)}),e.addListener(Ne.NEED_CLOSE,()=>{h.close()}),h}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(e,t,n){let o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof fa){var s,c,d,h;const p=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:m,dtlsTransportState:g,peerConnectionState:E}=this.connection,{local:y,remote:T}=await this.connection.getSelectedCandidatePair();ke.pcStats(this.store.sessionId,{startTime:p,eventElapse:e-p||0,iceconnectionsate:m,dtlsstate:g,connectionstate:E,intSucc:t?1:2,error:this._iceError||o||"",selectedLocalCandidateProtocol:(s=y==null?void 0:y.protocol)!==null&&s!==void 0?s:"",selectedLocalCandidateType:(c=y.candidateType)!==null&&c!==void 0?c:"",selectedLocalCandidateAddress:"".concat(y.address,":").concat(y.port),selectedRemoteCandidateProtocol:(d=T.protocol)!==null&&d!==void 0?d:"",selectedRemoteCandidateType:(h=T.candidateType)!==null&&h!==void 0?h:"",selectedRemoteCandidateAddress:"".concat(T.address,":").concat(T.port),restartCnt:n,preallocation:this.connection.isPreallocation}),this._iceError=null}}reportVideoFirstFrameDecoded(e,t,n,o){var s;const c=Array.from(Xi(s=this.remoteUserMap).call(s)).find(d=>d._videoSSRC===e);if(c){o||this.store.subscribe(c.uid,"video",void 0,void 0,void 0,void 0,Date.now());const d=this.store.keyMetrics,h=d.subscribe.find(p=>p.userId===c.uid&&p.type==="video");ke.firstRemoteVideoDecode(this.store.sessionId,$n.FIRST_VIDEO_DECODE,dn.FIRST_VIDEO_DECODE,{peer:c._uintid,videowidth:t,videoheight:n,subscribeElapse:Or.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:d.requestAPEnd||0,apStart:d.requestAPStart||0,joinGwEnd:d.joinGatewayEnd||0,joinGwStart:d.joinGatewayStart||0,pcEnd:d.peerConnectionEnd||0,pcStart:d.peerConnectionStart||0,subscriberEnd:(h==null?void 0:h.subscribeEnd)||0,subscriberStart:(h==null?void 0:h.subscribeStart)||0,videoAddNotify:(h==null?void 0:h.streamAdded)||0,state:o?1:0,firstFrame:(h==null?void 0:h.firstFrame)||0})}}async remoteMediaSsrcChanged(e,t,n){if(!this.connection)return!1;const o=this.remoteUserMap.get(e);if(!o)return!1;const s=o.get(t);if(!s)return!1;const c=await this.connection.getRemoteSSRC(s);return c!==void 0&&c!==n}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:n}]=e;t===de.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,ih.LOW_STREAM):n._updateRtpTransceiver(void 0)})}},Oe(pt.prototype,"startP2PConnection",[zr],Object.getOwnPropertyDescriptor(pt.prototype,"startP2PConnection"),pt.prototype),Oe(pt.prototype,"connect",[zr],Object.getOwnPropertyDescriptor(pt.prototype,"connect"),pt.prototype),Oe(pt.prototype,"updateRemoteRTPCapabilities",[zr],Object.getOwnPropertyDescriptor(pt.prototype,"updateRemoteRTPCapabilities"),pt.prototype),Oe(pt.prototype,"publishDataChannel",[zr],Object.getOwnPropertyDescriptor(pt.prototype,"publishDataChannel"),pt.prototype),Oe(pt.prototype,"unpublish",[zr],Object.getOwnPropertyDescriptor(pt.prototype,"unpublish"),pt.prototype),Oe(pt.prototype,"unpublishDataChannel",[zr],Object.getOwnPropertyDescriptor(pt.prototype,"unpublishDataChannel"),pt.prototype),Oe(pt.prototype,"unpublishLowStream",[zr],Object.getOwnPropertyDescriptor(pt.prototype,"unpublishLowStream"),pt.prototype),Oe(pt.prototype,"subscribeDataChannel",[zr],Object.getOwnPropertyDescriptor(pt.prototype,"subscribeDataChannel"),pt.prototype),Oe(pt.prototype,"subscribe",[zr],Object.getOwnPropertyDescriptor(pt.prototype,"subscribe"),pt.prototype),Oe(pt.prototype,"massSubscribe",[zr],Object.getOwnPropertyDescriptor(pt.prototype,"massSubscribe"),pt.prototype),Oe(pt.prototype,"unsubscribe",[zr],Object.getOwnPropertyDescriptor(pt.prototype,"unsubscribe"),pt.prototype),Oe(pt.prototype,"unsubscribeDataChannel",[zr],Object.getOwnPropertyDescriptor(pt.prototype,"unsubscribeDataChannel"),pt.prototype),Oe(pt.prototype,"massUnsubscribe",[zr],Object.getOwnPropertyDescriptor(pt.prototype,"massUnsubscribe"),pt.prototype),Oe(pt.prototype,"muteRemote",[zr],Object.getOwnPropertyDescriptor(pt.prototype,"muteRemote"),pt.prototype),Oe(pt.prototype,"unmuteRemote",[zr],Object.getOwnPropertyDescriptor(pt.prototype,"unmuteRemote"),pt.prototype),Oe(pt.prototype,"hasRemoteMediaWithLock",[zr],Object.getOwnPropertyDescriptor(pt.prototype,"hasRemoteMediaWithLock"),pt.prototype),Oe(pt.prototype,"disconnectForReconnect",[zr],Object.getOwnPropertyDescriptor(pt.prototype,"disconnectForReconnect"),pt.prototype),Oe(pt.prototype,"updateBitrateLimit",[zr],Object.getOwnPropertyDescriptor(pt.prototype,"updateBitrateLimit"),pt.prototype),Oe(pt.prototype,"remoteMediaSsrcChanged",[zr],Object.getOwnPropertyDescriptor(pt.prototype,"remoteMediaSsrcChanged"),pt.prototype),pt);function zr(e,t,n){const o=e[t];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const s=this.mutex,c=await s.lock("From P2PChannel.".concat(t));try{for(var d=arguments.length,h=new Array(d),p=0;p<d;p++)h[p]=arguments[p];return await o.apply(this,h)}finally{c()}},n}function qV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,o)}return n}function XV(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?qV(Object(n),!0).forEach(function(o){x(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):qV(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}const _se=Date.now(),Ese=20,YC=new Map,_v=new Map;async function $V(e){const t=YC.get(e),n=Array.isArray(t)&&t[t.length-1],o=_v.get(e);if(!n)return void(o.isSyncing=!1);const s={uid:n.uid,payload:n.payload};o.firstRecvTs===0&&(o.firstRecvTs=n.recvTs,o.firstSendTs=n.sendTs);const c=n.sendTs-o.firstSendTs,d=c-(Date.now()-o.firstRecvTs);d>0&&(o.firstRecvTs=Date.now()-c);let h=n.mediaDelay+d;h<=0?(t.pop(),JV(n.context,s),h=0):h=Math.min(h,Ese),setTimeout(()=>t.length&&$V(e),h)}function JV(e,t){e.safeEmit(mt.STREAM_MESSAGE,t.uid,t.payload),e.onStreamMessage&&e.onStreamMessage(t)}function vse(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;if(!e.syncWithAudio)return JV(n,{uid:e.uid,payload:e.payload});const o="".concat(n.id,"-").concat(e.uid),s=YC.get(o)||[],c=s.findIndex(m=>e.sendTs>=m.sendTs),d=XV(XV({},e),{},{context:n,mediaDelay:t,recvTs:Date.now()});c===-1?s.push(d):s.splice(c,0,d),YC.set(o,s);let h=!1;var p;_v.has(o)?h=!((p=_v.get(o))===null||p===void 0||!p.isSyncing):_v.set(o,{isSyncing:h,firstRecvTs:0,firstSendTs:0}),h||$V(o)}const yse=wt().name;function QV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,o)}return n}function ZV(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?QV(Object(n),!0).forEach(function(o){x(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):QV(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}const bh="websdk_ng_cache_parameter",Sse=H("MAX_PRELOAD_ASYNC_LENGTH"),Tse=1e4,_d=new Map,Ed=[];let qC=null,XC=0,$C=0;const Ev=new Map,wse=function(e,t){const n=[];let o=0;const s=async()=>{const c=n.shift();c&&await c(),n.length>0&&o<t?s():o--};return async function(){for(var c=arguments.length,d=new Array(c),h=0;h<c;h++)d[h]=arguments[h];return new ye(async(p,m)=>{n.push(async()=>{try{const g=await e(...d);p(g)}catch(g){m(g)}}),o<t&&(o++,s())})}}(eF,Sse),JC=oi.CancelToken.source();async function eF(e,t,n,o,s,c){try{if(!H("ENABLE_PRELOAD"))return;if(!Rt().supportWebCrypto)return void Dc(()=>{R.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!n&&n!==null)throw new re(j.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));n&&ar(n,"token",1,2047),ar(e,"appid",1,2047),XE(t),o&&$E(o);const d=od();R.debug("preload channel ".concat(t,", uid is ").concat(o));const h={appId:e,cname:t,token:n||e,uid:typeof o!="string"?o:null,sid:d,proxyServer:s};let p,m;typeof o=="string"?(h.stringUid=o,[m,p]=await ye.all([ose(o,{sid:d,appId:e},JC.token),RV(ZV(ZV({},h),{},{token:n||e,uid:0}),JC.token)]),h.uid=m.uid,p.gatewayInfo.uid=h.uid,p.gatewayInfo.res.uid=h.uid):(c&&(h.stringUid=c),p=await RV(h,JC.token));const g={sid:d,appId:e,cname:t,token:n||e,uid:h.stringUid||o,intUid:h.uid||p.gatewayInfo.uid,stringUid:h.stringUid,ts:Date.now(),sua:m,ap:p};await async function(E){let y;try{E.uid&&nF({appId:E.appId,cname:E.cname,token:E.token,uid:E.uid,stringUid:E.stringUid});const T=sF(E),P=await async function(A,M){try{const U=await window.crypto.subtle.importKey("raw",Y2(M),"AES-GCM",!1,["encrypt"]),Y=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},U,id(window.btoa(JSON.stringify(A))));return kc(new Uint8Array(Y))}catch{return}}(E,E.token||E.appId);if(!P)return;y=oF(bh);const I=y?JSON.parse(y):[];I.push({[T]:P}),I.length>H("AP_CACHE_NUM")&&I.shift(),vv(bh,JSON.stringify(I))}catch(T){R.warn("Error caching server parameters:",T.message),vv(bh,"")}}(g),XC++}catch(d){throw $C++,function(h){qC||(qC=window.setTimeout(()=>{let m="";Ev.forEach((g,E)=>{m+="".concat(E,": ").concat(g," ;")}),ke.reportApiInvoke(null,{name:Nn.PRELOAD,options:{success:XC,failed:$C,err:m}}).onError(h),XC=0,$C=0,Ev.clear(),qC=null},Tse));const p=Ev.get(h.code)||0;Ev.set(h.code,p+1)}(d),d}}async function tF(e){try{if(H("AP_REQUEST_DETAIL")||H("ENABLE_ROLE_SELECT_EDGE"))return;const t=nF(e);if(!t||e.cloudProxyServer!=="disabled")return;const n=await async function(o,s){try{const c=await window.crypto.subtle.importKey("raw",Y2(s),"AES-GCM",!1,["decrypt"]),d=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},c,id(o));return JSON.parse(window.atob(kc(new Uint8Array(d))))}catch{return}}(t,e.token||e.appId);if(!n||!function(o,s){return o.cname===s.cname&&o.appId===s.appId&&o.token===s.token?s.stringUid?o.stringUid===s.stringUid:typeof s.uid=="number"?o.uid===s.uid:o.uid==s.uid:!1}(n,e))return;if(n&&Date.now()-n.ts<H("AP_CACHE_LIFETIME"))return n}catch(t){R.warn("Error get preloadInfo",t.message)}}function nF(e){let t;try{if(t=oF(bh),!t)return;const n=JSON.parse(t),o=sF(e),s=function(d,h){for(let p=d.length-1;p>=0;p--)if(h(d[p]))return p;return-1}(n,d=>o in d);if(s===-1)return;const c=n.splice(s,1)[0];return vv(bh,JSON.stringify(n)),c[o]}catch(n){R.warn("Error delete preload info: ".concat(t),n.message),vv(bh,"")}}function QC(e){if(e){let t=_d.get(e);t&&(window.clearTimeout(t),t=null,_d.delete(e)),Ee(Ed).call(Ed,e)||e.cloudProxyServer!=="disabled"||Ed.push(e)}if(_d.size<H("AP_CACHE_NUM")&&Ed.length>0){const t=Ed.shift();_d.set(t,window.setTimeout(async()=>{const{appId:n,cname:o,token:s,stringUid:c,uid:d,proxyServer:h}=t;try{await wse(n,o,s,d,h,c),_d.has(t)&&QC(t)}catch(p){R.warn("update preload failed",p.message),rF(t)}},H("AP_UPDATE_INTERVAL")))}}function rF(e){const t=Ed.indexOf(e);t!==-1&&Ed.splice(t,1);let n=_d.get(e);n&&(window.clearTimeout(n),n=null,_d.delete(e),QC())}function iF(e,t){const n=e.sua,o=e.ap;t&&n&&ke.reqUserAccount(e.sid,{lts:n.requestTime,elapse:n.elapse,success:!0,serverAddr:n.url,stringUid:t,uid:e.intUid,errorCode:null,extend:n.req}),ke.reportResourceTiming(e.ap.url,e.sid),ke.joinWebProxyAP(e.sid,{lts:o.requestTime,elapse:o.elapse,sucess:1,apServerAddr:o.url,turnServerAddrList:o.proxyInfo.addresses.map(s=>s.ip).join(","),eventType:"disabled",unilbsServerIds:[Pn.CHOOSE_SERVER,Pn.CLOUD_PROXY_FALLBACK].toString()}),ke.joinChooseServer(e.sid,{lts:o.requestTime,elapse:o.elapse,succ:!0,csAddr:o.url,opid:o.opid,serverList:o.gatewayInfo.gatewayAddrs.map(s=>s.address),ec:null,cid:o.gatewayInfo.cid.toString(),uid:o.gatewayInfo.uid.toString(),csIp:o.gatewayInfo.csIp,unilbsServerIds:[Pn.CHOOSE_SERVER].toString(),isHttp3:o.isHttp3})}function oF(e){return window.atob(window.localStorage.getItem(e)||"")}function vv(e,t){window.localStorage.setItem(e,window.btoa(t))}function sF(e){let t="".concat(e.appId,"_").concat(e.cname);return typeof e.uid=="string"&&(t+="_s_".concat(e.uid)),typeof e.uid=="number"&&(t+="_".concat(e.uid)),e.token&&(t+="_".concat(e.token)),eM(t)}function Rse(e){let t=function(){const n=Ise.pop();return n?(n.offset=n.limit=0,n):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(n,o){let s=n.appId;s!==void 0&&(Dn(o,10),Hc(o,s));let c=n.cid;c!==void 0&&(Dn(o,16),Dn(o,c));let d=n.cname;d!==void 0&&(Dn(o,26),Hc(o,d));let h=n.deviceId;h!==void 0&&(Dn(o,34),Hc(o,h));let p=n.elapse;p!==void 0&&(Dn(o,40),Gc(o,p));let m=n.fileSize;m!==void 0&&(Dn(o,48),Gc(o,Ih(m)));let g=n.height;g!==void 0&&(Dn(o,56),Gc(o,Ih(g)));let E=n.jpg;E!==void 0&&(Dn(o,66),Dn(o,E.length),cF(o,E));let y=n.networkType;y!==void 0&&(Dn(o,72),Gc(o,Ih(y)));let T=n.osType;T!==void 0&&(Dn(o,80),Gc(o,Ih(T)));let P=n.requestId;P!==void 0&&(Dn(o,90),Hc(o,P));let I=n.sdkVersion;I!==void 0&&(Dn(o,98),Hc(o,I));let A=n.sequence;A!==void 0&&(Dn(o,104),Gc(o,Ih(A)));let M=n.sid;M!==void 0&&(Dn(o,114),Hc(o,M));let U=n.timestamp;U!==void 0&&(Dn(o,120),Gc(o,U));let Y=n.uid;Y!==void 0&&(Dn(o,128),Dn(o,Y));let Q=n.vid;Q!==void 0&&(Dn(o,136),Dn(o,Q));let J=n.width;J!==void 0&&(Dn(o,144),Gc(o,Ih(J)));let X=n.service;X!==void 0&&(Dn(o,152),Dn(o,X));let ne=n.callbackData;ne!==void 0&&(Dn(o,162),Dn(o,ne.length),cF(o,ne));let oe=n.ticket;oe!==void 0&&(Dn(o,170),Hc(o,oe));let me=n.vendorConfigs;me!==void 0&&(Dn(o,178),Hc(o,me))}(e,t),function(n){let o=n.bytes,s=n.limit;return o.length===s?o:o.subarray(0,s)}(t)}function Cse(e){return function(n){let o={};e:for(;!Ase(n);){let s=nm(n);switch(s>>>3){case 0:break e;case 1:o.code=nm(n);break;case 2:o.msg=lF(n,nm(n));break;case 3:o.requestId=lF(n,nm(n));break;case 4:o.timestamp=Nse(n,!1);break;default:bse(n,7&s)}}return o}({bytes:t=e,offset:0,limit:t.length});var t}function bse(e,t){switch(t){case 0:for(;128&ns(e););break;case 2:ZC(e,nm(e));break;case 5:ZC(e,4);break;case 1:ZC(e,8);break;default:throw new Error("Unimplemented type: "+t)}}function Ih(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let Ise=[];function ZC(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function Ase(e){return e.offset>=e.limit}function yv(e,t){let n=e.bytes,o=e.offset,s=e.limit,c=o+t;if(c>n.length){let d=new Uint8Array(2*c);d.set(n),e.bytes=d}return e.offset=c,c>s&&(e.limit=c),o}function aF(e,t){let n=e.offset;if(n+t>e.limit)throw new Error("Read past limit");return e.offset+=t,n}function cF(e,t){let n=yv(e,t.length);e.bytes.set(t,n)}function lF(e,t){let n=aF(e,t),o=String.fromCharCode,s=e.bytes,c="�",d="";for(let h=0;h<t;h++){let p,m,g,E,y=s[h+n];128&y?(224&y)==192?h+1>=t?d+=c:(p=s[h+n+1],(192&p)!=128?d+=c:(E=(31&y)<<6|63&p,E<128?d+=c:(d+=o(E),h++))):(240&y)==224?h+2>=t?d+=c:(p=s[h+n+1],m=s[h+n+2],(49344&(p|m<<8))!=32896?d+=c:(E=(15&y)<<12|(63&p)<<6|63&m,E<2048||E>=55296&&E<=57343?d+=c:(d+=o(E),h+=2))):(248&y)==240?h+3>=t?d+=c:(p=s[h+n+1],m=s[h+n+2],g=s[h+n+3],(12632256&(p|m<<8|g<<16))!=8421504?d+=c:(E=(7&y)<<18|(63&p)<<12|(63&m)<<6|63&g,E<65536||E>1114111?d+=c:(E-=65536,d+=o(55296+(E>>10),56320+(1023&E)),h+=3))):d+=c:d+=o(y)}return d}function Hc(e,t){let n=t.length,o=0;for(let d=0;d<n;d++){let h=t.charCodeAt(d);h>=55296&&h<=56319&&d+1<n&&(h=(h<<10)+t.charCodeAt(++d)-56613888),o+=h<128?1:h<2048?2:h<65536?3:4}Dn(e,o);let s=yv(e,o),c=e.bytes;for(let d=0;d<n;d++){let h=t.charCodeAt(d);h>=55296&&h<=56319&&d+1<n&&(h=(h<<10)+t.charCodeAt(++d)-56613888),h<128?c[s++]=h:(h<2048?c[s++]=h>>6&31|192:(h<65536?c[s++]=h>>12&15|224:(c[s++]=h>>18&7|240,c[s++]=h>>12&63|128),c[s++]=h>>6&63|128),c[s++]=63&h|128)}}function ns(e){return e.bytes[aF(e,1)]}function dF(e,t){let n=yv(e,1);e.bytes[n]=t}function nm(e){let t,n=0,o=0;do t=ns(e),n<32&&(o|=(127&t)<<n),n+=7;while(128&t);return o}function Dn(e,t){for(t>>>=0;t>=128;)dF(e,127&t|128),t>>>=7;dF(e,t)}function Nse(e,t){let n,o=0,s=0,c=0;return n=ns(e),o=127&n,128&n&&(n=ns(e),o|=(127&n)<<7,128&n&&(n=ns(e),o|=(127&n)<<14,128&n&&(n=ns(e),o|=(127&n)<<21,128&n&&(n=ns(e),s=127&n,128&n&&(n=ns(e),s|=(127&n)<<7,128&n&&(n=ns(e),s|=(127&n)<<14,128&n&&(n=ns(e),s|=(127&n)<<21,128&n&&(n=ns(e),c=127&n,128&n&&(n=ns(e),c|=(127&n)<<7))))))))),{low:o|s<<28,high:s>>>4|c<<24,unsigned:t}}function Gc(e,t){let n=t.low>>>0,o=(t.low>>>28|t.high<<4)>>>0,s=t.high>>>24,c=s===0?o===0?n<16384?n<128?1:2:n<1<<21?3:4:o<16384?o<128?5:6:o<1<<21?7:8:s<128?9:10,d=yv(e,c),h=e.bytes;switch(c){case 10:h[d+9]=s>>>7&1;case 9:h[d+8]=c!==9?128|s:127&s;case 8:h[d+7]=c!==8?o>>>21|128:o>>>21&127;case 7:h[d+6]=c!==7?o>>>14|128:o>>>14&127;case 6:h[d+5]=c!==6?o>>>7|128:o>>>7&127;case 5:h[d+4]=c!==5?128|o:127&o;case 4:h[d+3]=c!==4?n>>>21|128:n>>>21&127;case 3:h[d+2]=c!==3?n>>>14|128:n>>>14&127;case 2:h[d+1]=c!==2?n>>>7|128:n>>>7&127;case 1:h[d]=c!==1?128|n:127&n}}const uF={},hF={},Sv=4294967296,Ose=Sv*Sv,pF=Ose/2;mF(0,!0);const fF=mF(0),Pse=rm(0,-2147483648,!1),Dse=rm(-1,2147483647,!1);function mF(e,t){let n,o,s;return t?(s=0<=(e>>>=0)&&e<256)&&(o=hF[e],o)?o:(n=rm(e,0,!0),s&&(hF[e]=n),n):(s=-128<=(e|=0)&&e<128)&&(o=uF[e],o)?o:(n=rm(e,e<0?-1:0,!1),s&&(uF[e]=n),n)}function rm(e,t,n){return{low:0|e,high:0|t,unsigned:!!n}}function gF(e,t){if(isNaN(e))return fF;{if(e<=-pF)return Pse;if(e+1>=pF)return Dse}return e<0?fF:rm(e%Sv|0,e/Sv|0,t)}function _F(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,o)}return n}class eb extends pn{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;const n=this._connectionState;this._connectionState=t,this.emit(Is.CONNECTION_STATE_CHANGE,t,n)}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(t){var n;super(),x(this,"name","AgoraRTCImageModeration"),x(this,"_connectionState",go.CONNECTING),x(this,"_sequence",0),x(this,"_moderationStartTime",void 0),x(this,"_workerConnection",void 0),x(this,"_workerMessageLengthLimit",void 0),x(this,"_qualityRatio",void 0),x(this,"_connectInfo",void 0),x(this,"_cancelTokenSource",oi.CancelToken.source()),x(this,"_retryConfig",void 0),x(this,"_moderationInterval",void 0),x(this,"_moderationTimer",null),x(this,"_moderationMode",1),x(this,"_quality",1),x(this,"_qualityTimer",null),x(this,"_ticket",void 0),x(this,"_moderationIntervalMinimum",void 0),x(this,"_uploadFailedNum",0),x(this,"_uploadNum",0),x(this,"_uploadTimer",null),x(this,"_extraInfo",void 0),x(this,"_vendor",""),x(this,"_encoder",new TextEncoder),x(this,"_moderationId",void 0),x(this,"inspectImage",()=>{if(this.connectionState!==go.CONNECTED)throw new ee(j.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===go.CONNECTED?this.requestToInspectImage():R.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=Jt(5,"image-moderation-"),this._workerMessageLengthLimit=H("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=H("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(n=t.interval)!==null&&n!==void 0?n:1e3,t.extraInfo&&(this._extraInfo=this._encoder.encode(t.extraInfo)),t.vendor&&(this._vendor=t.vendor),this._qualityRatio=H("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new zf("worker-"+this._moderationId,Un),this.on(Is.STATE_CHANGE,(o,s)=>{R.debug("[".concat(this._moderationId,"] Moderation operation :").concat(gh[o]," ").concat(s||""))}),this.handleWorkerEvents()}async init(t,n){this.emit(Is.STATE_CHANGE,gh.CONNECT_AP),this._connectInfo=t;const o=this._cancelTokenSource.token;return this._retryConfig=n,new ye((s,c)=>{this.on(Is.CONNECTION_STATE_CHANGE,(d,h)=>{d===go.CONNECTED&&s()}),this.requestAP(t,o,n).then(d=>{this.connectWorker(d)}).catch(d=>{c(d)})})}updateConfig(t){var n;this._moderationInterval=(n=t.interval)!==null&&n!==void 0?n:1e3,t.extraInfo&&(this._extraInfo=this._encoder.encode(t.extraInfo)),t.vendor&&(this._vendor=t.vendor),R.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(t))),this.connectionState===go.CONNECTED&&this.inspectImage()}async requestAP(t,n,o){const s=H("WEBCS_DOMAIN").map(p=>"https://".concat(p,"/api/v1")),c=await function(p,m,g,E){let{appId:y,areaCode:T,cname:P,sid:I,token:A,uid:M}=m;Th++;const U="moderation_plugin",Y={service_name:U,json_body:JSON.stringify({appId:y,areaCode:T,cname:P,command:"allocateEdge",requestId:Th,seq:Th,sid:I,appToken:A,ts:Date.now(),uid:M+""})};let Q,J,X=p[0];return ws(async()=>{Q=Date.now();const ne=await As(X,{data:Y,cancelToken:g,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(J=Date.now()-Q,ne.code!==0){const we=new ee(j.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+ne.code,{retry:!0,responseTime:J});throw R.error(we.toString()),we}const oe=JSON.parse(ne.json_body);if(oe.code!==200){const we=new ee(j.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(oe.code,", reason: ").concat(oe.reason),{code:oe.code,responseTime:J});throw R.error(we.toString()),we}if(!oe.servers||!Array.isArray(oe.servers)||oe.servers.length===0){const we=new ee(j.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:oe.code,responseTime:J});throw R.error(we.toString()),we}if(!oe.servers.some(we=>!!we.wss)){const we=new ee(j.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:oe.code,responseTime:J});throw R.error(we.toString()),we}const me=H("IMAGE_MODERATION_WORKER_HOST");return{addressList:oe.servers.map(we=>{let{address:ut,wss:rt}=we;if(ut&&rt)return"wss://".concat(ut.replace(/\./g,"-"),".").concat(me,":").concat(rt,"/moderation")}).filter(we=>!!we),workerToken:oe.workerToken,vid:oe.vid,ticket:oe.appTicket,responseTime:J}},(ne,oe)=>(ke.apworkerEvent(I,{success:!0,sc:200,serviceName:U,responseDetail:JSON.stringify(ne.addressList),firstSuccess:oe===0,responseTime:J,serverIp:p[oe%p.length]}),!1),(ne,oe)=>(ke.apworkerEvent(I,{success:!1,sc:ne.data&&ne.data.code||200,serviceName:U,responseTime:J,serverIp:p[oe%p.length]}),!!(ne.code!==j.OPERATION_ABORTED&&ne.code!==j.UNEXPECTED_RESPONSE||ne.data&&ne.data.retry)&&(X=p[(oe+1)%p.length],!0)),E)}(s,t,n,o);this.emit(Is.STATE_CHANGE,gh.AP_CONNECTED);const{addressList:d,ticket:h}=c;return this._ticket=h,d}async connectWorker(t){this.emit(Is.STATE_CHANGE,gh.CONNECT_WORKER),await this._workerConnection.init(t,1e4)}handleWorkerEvents(){this._workerConnection.on(tt.CONNECTED,async()=>{this.emit(Is.STATE_CHANGE,gh.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=go.CONNECTED}),this._workerConnection.on(tt.CLOSED,()=>{this.connectionState=go.CLOSED}),this._workerConnection.on(tt.FAILED,()=>{this.connectionState=go.CLOSED}),this._workerConnection.on(tt.RECONNECTING,()=>{this.connectionState=this.connectionState===go.CONNECTED?go.RECONNECTING:go.CONNECTING}),this._workerConnection.on(tt.ON_MESSAGE,async t=>{if(t.data instanceof ArrayBuffer){const n=Cse(new Uint8Array(t.data));H("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&R.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(n)),this._uploadNum++,n.code===void 0||n.code===0||(this._uploadFailedNum++,R.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(n.code,", msg is ").concat(n.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{ke.reportApiInvoke(this._connectInfo.sid||null,{name:Nn.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,n.code],tag:En.TRACER}).onError(new ee(j.IMAGE_MODERATION_UPLOAD_FAILED,n.msg)),this._uploadTimer=null},H("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else R.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(tt.WILL_RECONNECT,(t,n,o)=>{t==="recover"&&o(t),o("tryNext")}),this._workerConnection.on(tt.REQUEST_NEW_URLS,(t,n)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(n)})}static intToLong(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}async requestToInspectImage(){const t=Yi(this,Is.CLIENT_LOCAL_VIDEO_TRACK),n={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void(H("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&R.debug("Only the track being played can be inspected"));this._sequence++;const o=await this.generateRequestData(t,n);this._workerConnection.sendMessage(o,!0,!0)}else H("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&R.debug("Only the track being published can be inspected")}async generateRequestData(t,n){let{appId:o,cname:s,cid:c,vid:d,sid:h,uid:p}=n;const m=Date.now(),g=await t.getCurrentFrameImage("image/jpeg",this.quality),E=await HM(g,o,s),y=this._sequence+"-"+c+"-"+p+"-"+m+"-"+Jt(12,""),T={appId:o,cid:c,cname:s,deviceId:"",elapse:eb.intToLong(Number(m-this._moderationStartTime)),fileSize:g.buffer.byteLength,height:g.height,width:g.width,jpg:E,networkType:6,osType:7,requestId:y,sdkVersion:"4.23.3",sequence:this._sequence,sid:h,timestamp:gF(m),uid:p,vid:d,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete T.callbackData;const P=Rse(T);if(P.byteLength<this._workerMessageLengthLimit){if(H("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const I=function(A){for(var M=1;M<arguments.length;M++){var U=arguments[M]!=null?arguments[M]:{};M%2?_F(Object(U),!0).forEach(function(Y){x(A,Y,U[Y])}):Object.getOwnPropertyDescriptors?Object.defineProperties(A,Object.getOwnPropertyDescriptors(U)):_F(Object(U)).forEach(function(Y){Object.defineProperty(A,Y,Object.getOwnPropertyDescriptor(U,Y))})}return A}({},T);delete I.jpg,R.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(I))}return P}{const I=this.quality*this._qualityRatio;return this.quality=I,await this.generateRequestData(t,{appId:o,cname:s,cid:c,vid:d,sid:h,uid:p})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=oi.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=go.CLOSED,this.emit(Is.STATE_CHANGE,gh.CLOSED)}}function EF(e){if(Ht(e.interval,"interval",1e3,1/0),e&&e.extraInfo&&e.extraInfo.length>1024)throw new ee(j.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(e&&e.vendor&&e.vendor.length>1024)throw new ee(j.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}const kse={name:"ImageModeration",create:function(e){let{config:t}=e;return EF(t),new eb(t)}};var vF,yF,SF,TF,wF,RF,CF,bF,IF,AF,NF,OF,PF,DF,kF,xF,LF,MF,UF,jF,VF,FF,BF,WF,HF,GF,zF,KF,YF,qF,XF,$F,JF,QF,ZF,e4,t4,n4,r4,i4,o4,Te;function s4(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,o)}return n}function rs(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?s4(Object(n),!0).forEach(function(o){x(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s4(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}Ir.setLogger(R);let xse=(vF=He(),yF=He({argsMap:(e,t)=>{if(!Array.isArray(t)){if(!(t instanceof ch))return[t];t=[t]}return t.map(n=>n?Object(n).toString():"null")}}),SF=He({argsMap:(e,t)=>(t||(t=[]),Array.isArray(t)||t.trackMediaType!==ah.DATA?(Array.isArray(t)||(t=[t]),t.map(n=>n.getTrackId())):[t.getChannelId()])}),TF=He({argsMap:(e,t,n,o)=>[typeof t=="object"?t.uid:t,n,o]}),wF=He({argsMap:(e,t,n)=>[t,n]}),RF=He({argsMap:(e,t)=>t.map(n=>{let{user:o,mediaType:s}=n;return[o==null?void 0:o.uid,s]})}),CF=He({argsMap:(e,t,n,o)=>[typeof t=="object"?t.uid:t,n,o]}),bF=He({argsMap:(e,t)=>t.map(n=>{let{user:o,mediaType:s}=n;return{uid:o==null?void 0:o.uid,mediaType:s}})}),IF=He(),AF=He(),NF=He(),OF=He(),PF=He(),DF=He(),kF=He(),xF=He(),LF=He(),MF=He(),UF=He(),jF=He(),VF=He(),FF=He(),BF=He(),WF=He({argsMap:(e,t)=>[t]}),HF=He(),GF=He(),zF=He(),KF=He(),YF=He(),qF=He(),XF=He(),$F=He(),JF=He({argsMap:(e,t)=>(Array.isArray(t)||(t=[t]),[JSON.stringify(t)])}),QF=He(),ZF=He(),e4=He(),t4=He(),n4=He(),r4=He(),i4=He({reportResult:!0}),o4=He(),Te=class extends pn{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var e;return((e=this._config)===null||e===void 0?void 0:e.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(e,t){let n;if(super(),x(this,"store",void 0),x(this,"_uid",void 0),x(this,"_channelName",void 0),x(this,"_uintUid",void 0),x(this,"_users",[]),x(this,"_config",void 0),x(this,"_clientId",void 0),x(this,"_appId",void 0),x(this,"_sessionId",null),x(this,"_key",void 0),x(this,"_rtmConfig",{}),x(this,"_joinInfo",void 0),x(this,"_gateway",void 0),x(this,"_statsCollector",void 0),x(this,"_configDistribute",void 0),x(this,"_leaveMutex",void 0),x(this,"_publishMutex",void 0),x(this,"_renewTokenMutex",void 0),x(this,"_subscribeMutex",void 0),x(this,"_encryptionMode","none"),x(this,"_encryptionSecret",null),x(this,"_encryptionSalt",null),x(this,"_encryptDataStream",!1),x(this,"_encryptDataStreamKey",null),x(this,"_encryptDataStreamIv",null),x(this,"_proxyServer",void 0),x(this,"_turnServer",{servers:[],mode:"auto"}),x(this,"_cloudProxyServerMode","disabled"),x(this,"_isDualStreamEnabled",!1),x(this,"_defaultStreamFallbackType",void 0),x(this,"_lowStreamParameter",void 0),x(this,"_streamFallbackTypeCacheMap",new Map),x(this,"_remoteStreamTypeCacheMap",new Map),x(this,"_axiosCancelSource",oi.CancelToken.source()),x(this,"_audioVolumeIndicationInterval",void 0),x(this,"_networkQualityInterval",void 0),x(this,"_userOfflineTimeout",void 0),x(this,"_streamRemovedTimeout",void 0),x(this,"_liveTranscodeStreamingClient",void 0),x(this,"_liveRawStreamingClient",void 0),x(this,"_channelMediaRelayClient",void 0),x(this,"_networkQualitySensitivity","normal"),x(this,"_p2pChannel",void 0),x(this,"_useLocalAccessPoint",!1),x(this,"_setLocalAPVersion",void 0),x(this,"_joinAndNotLeaveYet",!1),x(this,"_numberOfJoinCount",0),x(this,"_remoteDefaultVideoStreamType",void 0),x(this,"_inspect",void 0),x(this,"_moderation",void 0),x(this,"_license",void 0),x(this,"_pendingPublishedUsers",[]),x(this,"ntpAlignErrorCount",0),x(this,"remoteInboundOffset",0),x(this,"_peerConnectionState",void 0),x(this,"_handleLocalTrackEnable",(s,c,d)=>{this.publish(s,!1).then(c).catch(d)}),x(this,"_handleLocalTrackDisable",(s,c,d)=>{this.unpublish(s).then(c).catch(d)}),x(this,"_handleUserOnline",s=>{if(H("BLOCK_LOCAL_CLIENT")&&pd(s.uid,this.channelName))return void R.debug("[".concat(s.uid,"] will be ignored in local"));this.isStringUID&&typeof s.uid!="string"&&R.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const c=this._users.find(d=>d.uid===s.uid);if(c)c._trust_in_room_=!0,c._is_pre_created&&(c._is_pre_created=!1,this.safeEmit(mt.USER_JOINED,c));else{const d=new Bc(s.uid,s.uint_id||s.uid);this._users.push(d),R.debug("[".concat(this._clientId,"] user online"),s.uid),this.safeEmit(mt.USER_JOINED,d)}}),x(this,"_handleUserOffline",s=>{if(H("BLOCK_LOCAL_CLIENT")&&pd(s.uid,this.channelName))return;const c=this._users.find(d=>d.uid===s.uid);c&&(this._handleRemoveStream(s),this._handleRemoveDataChannels(s),c._audio_pre_subscribed||c._video_pre_subscribed?c._is_pre_created=!0:CE(this._users,c),this._remoteStreamTypeCacheMap.delete(c.uid),this._streamFallbackTypeCacheMap.delete(c.uid),R.debug("[".concat(this._clientId,"] user offline"),s.uid,"reason:",s.reason),this.safeEmit(mt.USER_LEAVED,c,s.reason))}),x(this,"_handleAddAudioOrVideoStream",(s,c,d,h,p,m,g)=>{if(H("BLOCK_LOCAL_CLIENT")&&pd(c,this.channelName))return;const E=this._users.find(T=>T.uid===c);if(!E)return void R.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));R.debug("[".concat(this._clientId,"] stream added with uid ").concat(c,", type ").concat(s)),this.store.subscribe(E.uid,s,void 0,void 0,void 0,Date.now());const y=s==="audio"?E.hasAudio:E.hasVideo;E._uintid||(E._uintid=p||c),s==="audio"?E._trust_audio_stream_added_state_=!0:E._trust_video_stream_added_state_=!0,s==="audio"?(E._audio_added_=!0,d!==void 0&&(E._audioSSRC=d),h!==void 0&&(E._cname=h),m&&(E._audioOrtc=m)):(E._video_added_=!0,d!==void 0&&(E._videoSSRC=d),h!==void 0&&(E._cname=h),g!==void 0&&(E._rtxSsrcId=g),m&&(E._videoOrtc=m)),(s==="audio"?E.hasAudio:E.hasVideo)&&!y&&(R.info("[".concat(this._clientId,"] remote user ").concat(E.uid," published ").concat(s)),this.safeEmit(mt.USER_PUBLISHED,E,s)),s==="video"?ke.onGatewayStream(this._sessionId,$n.ON_ADD_VIDEO_STREAM,dn.ON_ADD_VIDEO_STREAM,{peer:p||c,ssrc:E._videoSSRC}):ke.onGatewayStream(this._sessionId,$n.ON_ADD_AUDIO_STREAM,dn.ON_ADD_AUDIO_STREAM,{peer:p||c,ssrc:E._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(E,s,d).then(T=>{if(T&&(R.debug("[".concat(this._clientId,"] resubscribe ").concat(s," for user ").concat(E.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof tm))return this._p2pChannel.unsubscribe(E,s,!0).then(()=>this._subscribe(E,s,!0).catch(P=>{R.error("[".concat(this._clientId,"] resubscribe error"),P.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(E,s)&&(R.debug("[".concat(this._clientId,"] resubscribe ").concat(s," for user ").concat(E.uid," after reconnect.")),this._subscribe(E,s,!0).catch(T=>{R.error("[".concat(this._clientId,"] resubscribe error"),T.toString())}))}),x(this,"_handleRemoveStream",s=>{if(H("BLOCK_LOCAL_CLIENT")&&pd(s.uid,this.channelName))return;const c=this._users.find(h=>h.uid===s.uid);if(!c)return void R.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));R.debug("[".concat(this._clientId,"] stream removed with uid ").concat(s.uid));let d=()=>{};c.hasAudio&&c.hasVideo?d=()=>{R.info("[".concat(this._clientId,"] remote user ").concat(c.uid," unpublished audio track")),this.safeEmit(mt.USER_UNPUBLISHED,c,"audio"),R.info("[".concat(this._clientId,"] remote user ").concat(c.uid," unpublished video track")),this.safeEmit(mt.USER_UNPUBLISHED,c,"video")}:c.hasVideo?d=()=>{R.info("[".concat(this._clientId,"] remote user ").concat(c.uid," unpublished video track")),this.safeEmit(mt.USER_UNPUBLISHED,c,"video")}:c.hasAudio&&(d=()=>{R.info("[".concat(this._clientId,"] remote user ").concat(c.uid," unpublished audio track")),this.safeEmit(mt.USER_UNPUBLISHED,c,"audio")}),c._video_pre_subscribed||c._audio_pre_subscribed||(c._trust_audio_stream_added_state_=!0,c._trust_video_stream_added_state_=!0,c._audio_added_=!1,c._video_added_=!1,this._p2pChannel instanceof tm&&this._p2pChannel.unsubscribe(c).then(h=>{if(h)return this._gateway.unsubscribe(h,c.uid)}),c._audioSSRC=void 0,c._videoSSRC=void 0,c._audioOrtc=void 0,c._videoOrtc=void 0,c._rtxSsrcId=void 0),ke.onGatewayStream(this._sessionId,$n.ON_REMOVE_STREAM,dn.ON_REMOVE_STREAM,{peer:s.uint_id||s.uid}),d()}),x(this,"_handleSetStreamLocalEnable",(s,c,d)=>{if(H("BLOCK_LOCAL_CLIENT")&&pd(c,this.channelName))return;const h=this._users.find(g=>g.uid===c);if(!h)return void R.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));R.debug("[".concat(this._clientId,"] local ").concat(s," ").concat(d?"enabled":"disabled"," with uid ").concat(c));const p=s==="audio"?h.hasAudio:h.hasVideo;if(s==="audio"){h._trust_audio_enabled_state_=!0;const g=h._audio_enabled_;if(h._audio_enabled_=d,h._audio_enabled_===g)return;{const E=h._audio_enabled_?"enable-local-audio":"disable-local-audio";R.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(c,", msg: ").concat(E)),this.safeEmit(mt.USER_INFO_UPDATED,c,E)}}else{h._trust_video_enabled_state_=!0;const g=h._video_enabled_;if(h._video_enabled_=d,h._video_enabled_===g)return;{const E=h._video_enabled_?"enable-local-video":"disable-local-video";R.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(c,", msg: ").concat(E)),this.safeEmit(mt.USER_INFO_UPDATED,c,E)}}const m=s==="audio"?h.hasAudio:h.hasVideo;return p!==m?!p&&m?(R.info("[".concat(this._clientId,"] remote user ").concat(c," published ").concat(s)),void this.safeEmit(mt.USER_PUBLISHED,h,s)):(s==="video"&&h._videoTrack&&h._videoTrack._destroy(),s==="audio"&&h._audioTrack,this._p2pChannel.muteRemote(h,s),R.info("[".concat(this._clientId,"] remote user ").concat(c," unpublished ").concat(s)),void this.safeEmit(mt.USER_UNPUBLISHED,h,s)):void 0}),x(this,"_handleMuteStream",(s,c,d)=>{if(H("BLOCK_LOCAL_CLIENT")&&pd(s,this.channelName))return;R.debug("[".concat(this._clientId,"] receive mute message"),s,c,d);const h=this._users.find(g=>g.uid===s);if(!h)return void R.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(s));const p=c==="audio"?h.hasAudio:h.hasVideo;if(c==="audio"){h._trust_audio_mute_state_=!0;const g=h._audio_muted_;if(h._audio_muted_=d,h._audio_muted_===g)return;{const E=h._audio_muted_?"mute-audio":"unmute-audio";R.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(s,", msg: ").concat(E)),this.safeEmit(mt.USER_INFO_UPDATED,s,E)}}else{h._trust_video_mute_state_=!0;const g=h._video_muted_;if(h._video_muted_=d,h._video_muted_===g)return;{const E=h._video_muted_?"mute-video":"unmute-video";R.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(s,", msg: ").concat(E)),this.safeEmit(mt.USER_INFO_UPDATED,s,E)}}const m=c==="audio"?h.hasAudio:h.hasVideo;if(p!==m){if(!p&&m)return(c==="audio"?h._audioSSRC:h._videoSSRC)?(R.info("[".concat(this._clientId,"] remote user ").concat(s," published ").concat(c)),void this.safeEmit(mt.USER_PUBLISHED,h,c)):void R.warning("[".concat(this._clientId,"] remote user ").concat(s," receive ").concat(c," unmute message  before add stream message, ").concat(c," SSRC doesn't exist yet."));c==="video"&&h._videoTrack&&!h._video_pre_subscribed&&h._videoTrack._destroy(),c==="audio"&&h._audioTrack,this._p2pChannel.muteRemote(h,c),R.info("[".concat(this._clientId,"] remote user ").concat(s," unpublished ").concat(c)),this.safeEmit(mt.USER_UNPUBLISHED,h,c)}}),x(this,"_handleP2PLost",async s=>{R.debug("[".concat(this._clientId,"] receive p2p lost"),s),parseInt(s.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():R.warning("[".concat(this._clientId,"] P2PLost stream not found"),s)}),x(this,"_handleTokenWillExpire",()=>{R.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(mt.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),x(this,"_handleBeforeUnload",s=>{s.type==="beforeunload"&&s.returnValue!==void 0&&s.returnValue!==""||(this.leave(),R.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),x(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(mt.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const s={downlinkNetworkQuality:0,uplinkNetworkQuality:0};s.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),s.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(mt.NETWORK_QUALITY,s)}),x(this,"_handleP2PAddAudioOrVideoStream",(s,c,d,h)=>{const p=this._users.find(g=>g.uid===c);if(!p)return void R.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));R.debug("[".concat(this._clientId,"] stream added with uid ").concat(c,", type ").concat(s)),this.store.subscribe(p.uid,s,void 0,void 0,void 0,Date.now());const m=s==="audio"?p.hasAudio:p.hasVideo;s==="audio"?p._trust_audio_stream_added_state_=!0:p._trust_video_stream_added_state_=!0,s==="audio"?(p._audio_added_=!0,d!==void 0&&(p._audioSSRC=d),h!==void 0&&(p._audioMid=h)):(p._video_added_=!0,d!==void 0&&(p._videoSSRC=d),h!==void 0&&(p._videoMid=h)),(s==="audio"?p.hasAudio:p.hasVideo)&&!m&&(R.info("[".concat(this._clientId,"] remote user ").concat(p.uid," published ").concat(s)),this.safeEmit(mt.USER_PUBLISHED,p,s)),this._p2pChannel.hasPendingRemoteMedia(p,s)&&(R.debug("[".concat(this._clientId,"] resubscribe ").concat(s," for user ").concat(p.uid," after reconnect.")),this._subscribe(p,s,!0).catch(g=>{R.error("[".concat(this._clientId,"] resubscribe error"),g.toString())}))}),this._config=e,this._clientId=t||Jt(5,"client-"),this.store=new class{constructor(s,c,d,h){Je(this,"state",void 0),this.state={codec:s,audioCodec:c,mode:d,clientId:h,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:sd.Default,hasStartJoinChannel:!1,isABTestSuccess:!1}}dispatch(s){this.state=function(c,d){switch(d.type){case Et.SET_SESSION_ID:return Ce(Ce({},c),{},{sessionId:d.sessionId});case Et.SET_P2P_ID:return Ce(Ce({},c),{},{p2pId:d.p2pId});case Et.SET_UID:return Ce(Ce({},c),{},{uid:d.uid});case Et.SET_INT_UID:return Ce(Ce({},c),{},{intUid:d.intUid});case Et.SET_PUB_ID:return Ce(Ce({},c),{},{pubId:d.pubId});case Et.KEY_METRIC_CLIENT_CREATED:return Ce(Ce({},c),{},{keyMetrics:Ce(Ce({},c.keyMetrics),{},{clientCreated:d.metric})});case Et.KEY_METRIC_JOIN_START:return Ce(Ce({},c),{},{keyMetrics:Ce(Ce({},c.keyMetrics),{},{joinStart:d.metric})});case Et.KEY_METRIC_JOIN_END:return Ce(Ce({},c),{},{keyMetrics:Ce(Ce({},c.keyMetrics),{},{joinEnd:d.metric})});case Et.KEY_METRIC_REQUEST_AP_START:return Ce(Ce({},c),{},{keyMetrics:Ce(Ce({},c.keyMetrics),{},{requestAPStart:d.metric})});case Et.KEY_METRIC_REQUEST_AP_END:return Ce(Ce({},c),{},{keyMetrics:Ce(Ce({},c.keyMetrics),{},{requestAPEnd:d.metric})});case Et.KEY_METRIC_JOIN_GATEWAY_START:return Ce(Ce({},c),{},{keyMetrics:Ce(Ce({},c.keyMetrics),{},{joinGatewayStart:d.metric})});case Et.KEY_METRIC_JOIN_GATEWAY_END:return Ce(Ce({},c),{},{keyMetrics:Ce(Ce({},c.keyMetrics),{},{joinGatewayEnd:d.metric})});case Et.KEY_METRIC_PEER_CONNECTION_START:return Ce(Ce({},c),{},{keyMetrics:Ce(Ce({},c.keyMetrics),{},{peerConnectionStart:d.metric})});case Et.KEY_METRIC_PEER_CONNECTION_END:return Ce(Ce({},c),{},{keyMetrics:Ce(Ce({},c.keyMetrics),{},{peerConnectionEnd:d.metric})});case Et.KEY_METRIC_DESCRIPTION_START:return Ce(Ce({},c),{},{keyMetrics:Ce(Ce({},c.keyMetrics),{},{descriptionStart:d.metric})});case Et.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return Ce(Ce({},c),{},{keyMetrics:Ce(Ce({},c.keyMetrics),{},{signalChannelOpen:d.metric})});case Et.KEY_METRIC_ICE_CONNECTION_END:return Ce(Ce({},c),{},{keyMetrics:Ce(Ce({},c.keyMetrics),{},{iceConnectionEnd:d.metric})});case Et.KEY_METRIC_PUBLISH:{const h=c.keyMetrics.publish,p=h.findIndex(m=>m.trackId===d.metric.trackId);return p!==-1?(h[p]=Ce(Ce({},h[p]),d.metric),Ce(Ce({},c),{},{keyMetrics:Ce(Ce({},c.keyMetrics),{},{publish:[...h]})})):Ce(Ce({},c),{},{keyMetrics:Ce(Ce({},c.keyMetrics),{},{publish:[...c.keyMetrics.publish,d.metric]})})}case Et.KEY_METRIC_SUBSCRIBE:{const h=c.keyMetrics.subscribe,p=h.findIndex(m=>m.userId===d.metric.userId&&m.type===d.metric.type);return p!==-1?(h[p]=Ce(Ce({},h[p]),d.metric),Ce(Ce({},c),{},{keyMetrics:Ce(Ce({},c.keyMetrics),{},{subscribe:[...h]})})):Ce(Ce({},c),{},{keyMetrics:Ce(Ce({},c.keyMetrics),{},{subscribe:[...c.keyMetrics.subscribe,d.metric]})})}case Et.SET_CLOUD_PROXY_SERVER_MODE:return c.cloudProxyServerMode=d.mode,c;case Et.RECORD_JOIN_CHANNEL_SERVICE:return typeof d.index!="number"?c.joinChannelServiceRecords=[...c.joinChannelServiceRecords,d.record]:(c.joinChannelServiceRecords[d.index]=Ce(Ce({},c.joinChannelServiceRecords[d.index]),d.record),c.joinChannelServiceRecords=[...c.joinChannelServiceRecords]),c;case Et.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return c.joinChannelServiceRecords=[],c;case Et.RESET_KEY_METRICS:return c.keyMetrics={publish:[],subscribe:[]},c;case Et.SET_USE_P2P:return Ce(Ce({},c),{},{useP2P:d.val});case Et.SET_TRANSPORT_TYPE:return Ce(Ce({},c),{},{p2pTransport:d.val});default:return c}}(this.state,s)}set sessionId(s){this.dispatch({type:Et.SET_SESSION_ID,sessionId:s})}get sessionId(){return this.state.sessionId}set cid(s){this.state.cid=s}get cid(){return this.state.cid}set codec(s){this.state.codec=s}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(s){this.dispatch({type:Et.SET_P2P_ID,p2pId:s})}get p2pId(){return this.state.p2pId}set dcId(s){this.dispatch({type:Et.SET_DC_ID,dcId:s})}get dcId(){return this.state.dcId}set uid(s){this.dispatch({type:Et.SET_UID,uid:s})}get uid(){return this.state.uid}set intUid(s){this.dispatch({type:Et.SET_INT_UID,intUid:s})}get intUid(){return this.state.intUid}set pubId(s){this.dispatch({type:Et.SET_PUB_ID,pubId:s})}get pubId(){return this.state.pubId}set cloudProxyServerMode(s){this.dispatch({type:Et.SET_CLOUD_PROXY_SERVER_MODE,mode:s})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(s){this.dispatch({type:Et.SET_USE_P2P,val:s})}get useP2P(){return this.state.useP2P}set p2pTransport(s){this.dispatch({type:Et.SET_TRANSPORT_TYPE,val:s})}get p2pTransport(){return this.state.p2pTransport}set hasStartJoinChannel(s){this.state.hasStartJoinChannel=s}get hasStartJoinChannel(){return this.state.hasStartJoinChannel}set isABTestSuccess(s){this.state.isABTestSuccess=s}get isABTestSuccess(){return this.state.isABTestSuccess}clientCreated(){this.dispatch({type:Et.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:Et.KEY_METRIC_JOIN_START,metric:Date.now()})}joinEnd(){this.dispatch({type:Et.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:Et.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:Et.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:Et.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:Et.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:Et.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:Et.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}descriptionStart(){this.dispatch({type:Et.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:Et.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:Et.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(s,c,d,h){this.dispatch({type:Et.KEY_METRIC_PUBLISH,metric:Ce(Ce({trackId:s,type:c},d&&{publishStart:d}),h&&{publishEnd:h})})}subscribe(s,c,d,h,p,m,g){this.dispatch({type:Et.KEY_METRIC_SUBSCRIBE,metric:Ce(Ce(Ce(Ce(Ce({userId:s,type:c},d&&{subscribeStart:d}),h&&{subscribeEnd:h}),p&&{firstFrame:p}),m&&{streamAdded:m}),g&&{firstDecoded:g})})}massSubscribe(s,c,d,h){s.forEach(p=>{this.dispatch({type:Et.KEY_METRIC_SUBSCRIBE,metric:Ce(Ce(Ce({userId:p.userId,type:p.type},c&&{subscribeStart:c}),d&&{subscribeEnd:d}),h&&{firstFrame:h})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(s,c){s.service==="gateway"&&Array.isArray(s.urls)&&(s.urls=s.urls.map(d=>d.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof c!="number"?(this.dispatch({type:Et.RECORD_JOIN_CHANNEL_SERVICE,record:Ce(Ce({},s),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(c<0||c>=this.state.joinChannelServiceRecords.length||this.dispatch({type:Et.RECORD_JOIN_CHANNEL_SERVICE,record:s,index:c}),c)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:Et.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:Et.RESET_KEY_METRICS})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}}(e.codec,e.audioCodec,e.mode,this._clientId),this._leaveMutex=new Ir("client-leave",this._clientId),this._publishMutex=new Ir("client-publish",this._clientId),this._renewTokenMutex=new Ir("client-renewtoken",this._clientId),this._subscribeMutex=new Ir("client-subscribe",this._clientId),this.store.clientCreated(),e.proxyServer&&this.setProxyServer(e.proxyServer,!0),e.turnServer&&this.setTurnServer(e.turnServer,!0),R.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(po," build: ").concat(zR,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),e.clientRoleOptions)try{PR(e.clientRoleOptions),n=Object.assign({},e.clientRoleOptions)}catch(s){R.warning("[".concat(this._clientId,"] ").concat(s.toString()))}var o;this._statsCollector=new Qf(this.store),this._statsCollector.onStatsException=(s,c,d)=>{R.warn("[".concat(this._clientId,"] receive exception msg, code: ").concat(s,", msg: ").concat(c,", uid: ").concat(d)),this.safeEmit(mt.EXCEPTION,{code:s,msg:c,uid:d})},this._statsCollector.onUploadPublishDuration=(s,c,d,h)=>{const p=this._users.find(m=>m.uid===s);p&&ke.peerPublishStatus(this._sessionId,{subscribeElapse:h,audioPublishDuration:c,videoPublishDuration:d,peer:p._uintid})},this._statsCollector.onVideoCodecChanged=s=>{if(H("VIDEO_STANDARD_BITRATE_VERSION")&&(s==="av1"||s==="h265"||s==="h264")){const c=this.localTracks.find(d=>d instanceof nn);c&&c._saveEncodeBitrateRatio!==1&&c.setSaveEncodeBitrateRatio(s==="h264"?H("BASELINE_MORE_H264_BITRATE_RATIO"):void 0)}},this.store.useP2P=e.mode==="p2p",this._gateway=new Zoe(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:e.websocketRetryConfig||Un,httpRetryConfig:e.httpRetryConfig||Un,forceWaitGatewayResponse:e.forceWaitGatewayResponse===void 0||e.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:e.role,clientRoleOptions:n}),this._configDistribute=new lse(this._clientId,this.store),this.store.useP2P?(this._p2pChannel=(o={store:this.store,statsCollector:this._statsCollector},Ja("P2PChannel").create(o)),this._handleP2PEvents()):this._p2pChannel=new tm(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(e,t,n,o,s){let c=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],d=arguments.length>6&&arguments[6]!==void 0&&arguments[6];jt("JOIN_GATEWAY_USE_443PORT_ONLY",c),jt("JOIN_GATEWAY_USE_DUAL_DOMAIN",d);const h=this._gateway.signal.websocket;return h instanceof CC&&(h.use443PortOnly=c,h.tryDoubleDomain=d),async function(p,m,g){yE.get(p)||yE.set(p,[]),SE.get(p)||SE.set(p,m),oa.get(p)||oa.set(p,0);const E=yE.get(p),y=SE.get(p);if(!E||!y)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(oa.get(p)===y){const M=Af();E.push(M),await M.promise}oa.set(p,oa.get(p)+1);for(var T=arguments.length,P=new Array(T>3?T-3:0),I=3;I<T;I++)P[I-3]=arguments[I];const A=await g(...P);return oa.set(p,oa.get(p)-1),oa.get(p)===y-1&&E.length>0&&(E[0].resolve(),E.shift()),oa.get(p)===0&&(yE.set(p,[]),SE.set(p,0),oa.set(p,0)),A}("client.join",H("JOIN_MAX_CONCURRENCY"),this.join.bind(this),e,t,n,o,s)}async join(e,t,n,o,s){const c=++this._numberOfJoinCount;this.store.joinStart(),o&&(this.store.uid=o);const d=(AE||AE||(AE=(window.location.protocol.split(":")[0]||"").toUpperCase(),AE))==="HTTPS",h=rM()?window.isSecureContext:"Browser Not Support";(!rM()&&!d||!window.isSecureContext)&&R.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser"),ke.setAppId(e);try{if(!n&&n!==null)throw new ee(j.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));n&&ar(n,"token",1,2047),ar(e,"appid",1,2047),XE(t),o&&$E(o),s&&ar(s,"optionalInfo",1,2047)}catch(I){throw ke.reportApiInvoke(od(),{name:Nn.JOIN,options:[e,t,n,o],states:{isHttps:d,isSecureContext:h},tag:En.TRACER}).onError(I),I}if(this._leaveMutex.isLocked&&(R.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),R.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const I=new ee(j.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw ke.reportApiInvoke(od(),{name:Nn.JOIN,options:[e,t,n,o],states:{isHttps:d,isSecureContext:h},tag:En.TRACER}).onError(I),I}this._gateway.state="CONNECTING";const p=await tF({appId:e,cname:t,uid:o,stringUid:typeof o=="string"?o:void 0,token:n||e,cloudProxyServer:this._cloudProxyServerMode});if(!this._joinAndNotLeaveYet)throw new ee(j.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));const m=(p==null?void 0:p.sid)||od();R.info("[".concat(this._clientId,"] start join channel ").concat(t,", join number: ").concat(c)),this._sessionId||(this._sessionId=m,this.store.sessionId=this._sessionId);const g=ke.reportApiInvoke(m,{id:this._clientId,name:Nn.JOIN,options:[e,t,n,o],states:{isHttps:d,isSecureContext:h},tag:En.TRACER}),E=rs(rs(rs({},this._rtmConfig),{},{role:this.role,clientId:this._clientId,appId:e,sid:this._sessionId,cname:t,uid:typeof o!="string"?o:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:n||e,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:s,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!p},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),{},{apRequestDetail:H("AP_REQUEST_DETAIL")||void 0});if(this._useLocalAccessPoint&&(E.setLocalAPVersion=this._setLocalAPVersion),typeof o=="string"&&(E.stringUid=o,this._uintUid?(E.uid=this._uintUid,this._uintUid=void 0):E.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(E.aesmode=this._encryptionMode,E.aespassword=await(async I=>{const A=function(Q){const J=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),X=new Uint8Array(new ArrayBuffer(J.length));for(let ne=0;ne<J.length;ne+=1)X[ne]=J.charCodeAt(ne);return X}(),M=await window.crypto.subtle.importKey("spki",A,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),U=NR(I),Y=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},M,U);return function(Q){let J="";for(let X=0;X<Q.length;X+=1)J+=String.fromCharCode(Q[X]);return window.btoa(J)}(new Uint8Array(Y))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new ee(j.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(E.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){const I=new TextEncoder,A=H("USE_PURE_ENCRYPTION_MASTER_KEY")?I.encode(E.appId+this._encryptionSecret+this._encryptionSecret):I.encode(E.appId+E.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function(M,U,Y){const Q=await window.crypto.subtle.importKey("raw",U,"PBKDF2",!1,["deriveBits","deriveKey"]),J=M==="aes-128-gcm2"?128:256,X=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:pM,hash:"SHA-256",salt:Y},Q,J+Aie);return new Uint8Array(X).subarray(J/8)}(this._encryptionMode,A,id(this._encryptionSalt)),this._encryptDataStreamKey=await async function(M,U,Y){const Q=await window.crypto.subtle.importKey("raw",U,"PBKDF2",!1,["deriveBits","deriveKey"]),J=M==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:pM,hash:"SHA-256",salt:Y},Q,{name:"AES-GCM",length:J},!0,["encrypt","decrypt"])}(this._encryptionMode,A,id(this._encryptionSalt))}else h?R.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):R.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,R.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:t,appId:e,stringUid:E.stringUid});const y=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&y===this._sessionId&&ke.joinChannelTimeout(this._sessionId,5)},5e3);try{var T;let I;const A=E.cloudProxyServer;if(Ee(T=["proxy3","proxy4","proxy5"]).call(T,A)){const J=H("PROXY_SERVER_TYPE3");Array.isArray(J)?E.proxyServer=J[0]:E.proxyServer=J}if(ke.setProxyServer(E.proxyServer),R.setProxyServer(E.proxyServer),this.store.requestAPStart(),p){if(R.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(E.stringUid?", ".concat(E.stringUid," => ").concat(p.intUid):""," ")),E.stringUid&&!E.uid&&(E.uid=p.intUid),I={gatewayInfo:p.ap.gatewayInfo},H("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&E.turnServer.mode==="auto")if(p.ap.proxyInfo.addresses.length===0)R.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{const J=(await Xj(p.ap.proxyInfo,p.ap.gatewayInfo.uid)).map(X=>({turnServerURL:X.address,tcpport:X.tcpport||vr.tcpport,udpport:X.udpport||vr.udpport,username:X.username||vr.username,password:X.password||vr.password,forceturn:!1,security:!0}));E.turnServer={mode:"manual",servers:J}}iF(p,E.stringUid)}else{if(E.stringUid&&!E.uid){let J;[J,I]=await ye.all([wV(E.stringUid,E,this._axiosCancelSource.token,this._config.httpRetryConfig||Un,this.store),TV(E,this._axiosCancelSource.token,this._config.httpRetryConfig||Un,!0,this.store)]),R.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(E.stringUid," => ").concat(J)),E.uid=J,I.gatewayInfo.uid=J,I.gatewayInfo.res.uid=J}else I=await TV(E,this._axiosCancelSource.token,this._config.httpRetryConfig||Un,!0,this.store);if(!this._joinAndNotLeaveYet)throw new ee(j.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(E,this._axiosCancelSource.token),this._configDistribute.on(Hf.UPDATE_BITRATE_LIMIT,J=>{this._p2pChannel.updateBitrateLimit(J)}),this._configDistribute.on(Hf.UPDATE_CLIENT_ROLE_OPTIONS,J=>{this._setClientRoleOptions(J)})},0),this._key=n||e;const M=I.gatewayInfo,U=E.uid?E.uid:M.uid;this._joinInfo=rs(rs({},E),{},{cid:M.cid,uid:U,vid:M.vid,apResponse:M.res,apGatewayAddress:M.apGatewayAddress,uni_lbs_ip:M.uni_lbs_ip,gatewayAddrs:M.gatewayAddrs}),this.store.intUid=U,this.store.cid=M.cid;const Y=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new ee(j.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));g.onSuccess(Y),this._appId=e,this._channelName=E.cname,this._uid=Y,this.store.uid=Y,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(gr()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);const Q=E.stringUid?"string uid: ".concat(E.stringUid,",uid: ").concat(E.uid):"uid: ".concat(this._uid);return R.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(t,",").concat(Q)),setTimeout(()=>{R.startUpload()},5e3),this.store.joinEnd(),P=this,Ee(hd).call(hd,P)||hd.push(P),this._cloudProxyServerMode==="disabled"&&Rt().supportWebCrypto&&H("ENABLE_PRELOAD")&&QC(this._joinInfo),Y}catch(I){const A=Array.isArray(I)?I[0]:I;throw A&&A.code===j.OPERATION_ABORTED?R.warning("[".concat(this._clientId,"] join number: ").concat(c,", Joining channel failed, rollback"),A):R.error("[".concat(this._clientId,"] join number: ").concat(c,", Joining channel failed, rollback"),A),A.code!==j.OPERATION_ABORTED&&this._numberOfJoinCount===c&&(this._gateway.state="DISCONNECTED",this._reset()),g.onError(A),A}var P}_joinGateway(){if(!this._joinInfo||!this._key)throw new ee(j.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!H("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}async leave(){R.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(gr()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(t){const n=hd.indexOf(t);n!==-1&&hd.splice(n,1)}(this),this._statsCollector.stopUpdateStats();const e=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return R.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void e();await this._gateway.leave(this.connectionState!=="CONNECTED",Dt.LEAVE),R.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),e()}async publish(e){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(e)){if(!(e instanceof ch))return this._publishDataChannel(e);e=[e]}if(e.length===0)throw new ee(j.INVALID_PARAMS,"param list is empty");const n=e;if(this._gateway.role==="audience")throw new ee(j.INVALID_OPERATION,"audience can not publish stream");for(const s of n){if(!(s instanceof ch))throw new ee(j.INVALID_PARAMS,"parameter is not local track");if(!s._enabled&&t)throw new ee(j.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(s.getTrackId()))}R.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(n.map(s=>"".concat(s.getTrackId()," "))));const o=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),t&&n.forEach(s=>{const c=this._configDistribute.getBitrateLimit();s instanceof nn&&c&&s.setBitrateLimit(c.uplink)});try{await this._publishHighStream(n),R.info("[".concat(this._clientId,"] Publish success, id ").concat(n.map(s=>"".concat(s.getTrackId()," "))))}catch(s){throw R.error("[".concat(this._clientId,"] publish error"),s.toString()),s}finally{o()}}async _publishDataChannel(e){Ht(e.id,"id",0,65535,!0),za(e.ordered,"ordered"),ar(e.metadata,"metadata",0,512),R.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(e.id));const t=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(s=>s.id===e.id)!==-1)throw new ee(j.INVALID_PARAMS,"Invalid id: ".concat(e.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new ee(j.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ee(j.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&H("FORCE_TURN")&&!H("TURN_ENABLE_TCP")&&!H("TURN_ENABLE_UDP"))throw new ee(j.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const n=function(s){return pV(s,!1)}(e),o=await this._p2pChannel.publishDataChannel([n]);if(o.length>0){if(typeof n._originDataChannelId!="number")throw R.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new ee(j.CREATE_DATACHANNEL_ERROR);try{await ye.all(o.map(s=>this._uid&&this._gateway.publishDataChannel(this._uid,s,!0))),await n._waitTillOpen()}catch(s){if(s.code!==j.DISCONNECT_P2P)throw s}}return R.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(n.id)),n}catch(n){throw R.error("[".concat(this._clientId,"] publish datachannels error"),n.toString()),n}finally{t()}}async unpublish(e){if(!this._joinInfo||this._uid===void 0)throw new ee(j.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let t=[];if(e)if(Array.isArray(e))t=e;else{if(!(e instanceof ch))return this._unpublishDataChannel([e]);t=[e]}else this.store.useP2P||await this._unpublishDataChannel(),t=this._p2pChannel.getAllTracks(!0);R.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(t.map(o=>"".concat(o.getTrackId()," "))," "));const n=await this._publishMutex.lock();try{if(this.store.useP2P){const o=await this._p2pChannel.unpublish(t);o&&await this._gateway.sendExtensionMessage(bn.UNPUBLISH,{unpubMsg:o},!0)}else{const o=await this._p2pChannel.unpublish(t);o&&await this._gateway.unpublish(o,this._uid),R.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(t.map(s=>"".concat(s.getTrackId()))))}}catch(o){throw R.error("[".concat(this._clientId,"] unpublish error"),o.toString()),o}finally{n&&n()}}async _unpublishDataChannel(e){e!==void 0&&e.length!==0||(e=this._p2pChannel.getAllDataChannels()),R.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(e.map(n=>"".concat(n.id," "))," "));const t=await this._publishMutex.lock();try{const n=await this._p2pChannel.unpublishDataChannel(e);n&&await this._gateway.unpublishDataChannel(n),R.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(e.map(o=>"".concat(o.id))))}catch(n){throw R.error("[".concat(this._clientId,"] unpublish dataChannel error"),n.toString()),n}finally{t&&t()}}async subscribe(e,t,n){if(!(e instanceof Bc)){const o=this.remoteUsers.find(s=>s.uid===e);if(!o)throw new ee(j.INVALID_REMOTE_USER,"user is not in the channel");e=o}return t==="datachannel"?this._subscribeDataChannel(e,n):this._subscribe(e,t)}async presubscribe(e,t){if(Kn(t,"mediaType",["audio","video"]),this.store.useP2P)throw new ee(j.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new ee(j.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ee(j.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));const n=t===Re.AUDIO,o=t===Re.VIDEO,s=await this._subscribeMutex.lock();try{const{ssrcId:c,ortc:d,rtxSsrcId:h,cname:p,uint_id:m}=await this._gateway.presubscribe(e,t,!0);if(c==null)throw new ee(j.UNEXPECTED_RESPONSE,"no ssrc id");let g=this._users.find(y=>y.uid===e);g||(g=new Bc(e,m||e),g._is_pre_created=!0,this._users.push(g)),p&&(g._cname=p),g._uintid||(g._uintid=m||e),n&&(g._audioSSRC=c,g._audio_pre_subscribed=!0,d&&(g._audioOrtc=d)),o&&(g._videoSSRC=c,g._video_pre_subscribed=!0,d&&(g._videoOrtc=d),h!=null&&(g._rtxSsrcId=h)),R.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(c)),await this._p2pChannel.subscribe(g,t,c,h,d);const E=n?g._audioTrack:g._videoTrack;if(!E)throw new ee(j.UNEXPECTED_ERROR,"can not find remote track in user");return n&&(g._trust_audio_stream_added_state_=!0,g._audio_added_=!0),o&&(g._trust_video_stream_added_state_=!0,g._video_added_=!0),E}catch(c){throw R.error("[".concat(this._clientId,"] presub user ").concat(e," error"),c),c}finally{s()}}async _subscribeDataChannel(e,t){var n;if(Ht(t,"channelId",0,65535,!0),!this._joinInfo)throw new ee(j.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ee(j.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(h=>h===e))throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),new ee(j.INVALID_REMOTE_USER,"user is not in the channel");if(!e.hasAudio&&!e.hasVideo&&e._dataChannels.length===0)throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),new ee(j.INVALID_REMOTE_USER,"user is not published");const s=(n=e._dataChannels)===null||n===void 0?void 0:n.find(h=>h.id===t);if(!s)throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, remote datachannel is not published")),new ee(j.REMOTE_USER_IS_NOT_PUBLISHED);const c=await this._subscribeMutex.lock();R.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: datachannel"));try{const h=await this._p2pChannel.subscribeDataChannel(e,[s]);if(h&&Ee(h).call(h,s.id))try{var d;if(typeof s._originDataChannelId!="number")throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, cannot get RTCDatachannel")),new ee(j.CREATE_DATACHANNEL_ERROR);const p={id:s.id,datachannelId:s._originDataChannelId,ordered:s.ordered,maxRetransmits:s.maxRetransmits,metadata:(d=s.metadata)!==null&&d!==void 0?d:""};await this._gateway.subscribeDataChannel(e.uid,p,!0),await s._waitTillOpen()}catch(p){if((p==null?void 0:p.code)!==j.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(e,[s]),p;await this._p2pChannel.unsubscribeDataChannel(e,[s]),this._p2pChannel.setPendingRemoteDataChannel(e,s.id)}return R.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: datachannel")),s}finally{c()}}async _p2pSubscribe(e,t,n){if(Kn(t,"mediaType",["audio","video"]),!this._joinInfo)throw new ee(j.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ee(j.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(c=>c===e)){const c=new ee(j.INVALID_REMOTE_USER,"user is not in the channel");throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),c}if(!e.hasAudio&&!e.hasVideo){const c=new ee(j.INVALID_REMOTE_USER,"user is not published");throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),c}if(!n&&(t==="audio"&&!e.hasAudio||t==="video"&&!e.hasVideo)){const c=new ee(j.REMOTE_USER_IS_NOT_PUBLISHED);throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),c}const s=await this._subscribeMutex.lock();R.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{const d=t==="audio"?e._audioSSRC:e._videoSSRC,h=t==="audio"?e._audioMid:e._videoMid;this.store.subscribe(e.uid,t,Date.now()),this.store.useP2P&&await this._p2pChannel.subscribe(e,t,d,h)}catch(d){throw d}R.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(d=>{R.warning("[".concat(this._clientId,"] auto set fallback failed"),d)});const c=t==="audio"?e._audioTrack:e._videoTrack;if(!c)throw new ee(j.UNEXPECTED_ERROR,"can not find remote track in user object");return c}catch(c){throw R.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),c),c}finally{s()}}async _subscribe(e,t,n){if(this.store.useP2P)return this._p2pSubscribe(e,t);if(Kn(t,"mediaType",["audio","video"]),!this._joinInfo)throw new ee(j.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ee(j.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(m=>m===e)){const m=new ee(j.INVALID_REMOTE_USER,"user is not in the channel");throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),m}if(!e.hasAudio&&!e.hasVideo){const m=new ee(j.INVALID_REMOTE_USER,"user is not published");throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),m}if(!(n||(t!=="audio"||e.hasAudio&&e._audioSSRC!==void 0)&&(t!=="video"||e.hasVideo&&e._videoSSRC!==void 0))){const m=new ee(j.REMOTE_USER_IS_NOT_PUBLISHED);throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),m}let s=t==="audio"?e._audioSSRC:e._videoSSRC,c=t==="audio"?e._audioOrtc:e._videoOrtc,d=t==="video"?e._rtxSsrcId:void 0,h={stream_type:t==="audio"?Re.AUDIO:Re.VIDEO,ssrcId:s};const p=await this._subscribeMutex.lock();R.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{const g=t==="audio"?e._audioSSRC:e._videoSSRC;g!==void 0&&g!==s&&(s=g,c=t==="audio"?e._audioOrtc:e._videoOrtc,d=t==="video"?e._rtxSsrcId:void 0,h={stream_type:t==="audio"?Re.AUDIO:Re.VIDEO,ssrcId:s}),Or.markSubscribeStart(this.store.clientId,s),this.store.subscribe(e.uid,t,Date.now()),await this._p2pChannel.subscribe(e,t,s,d,c);try{this._p2pChannel.isPreSubScribe(s)||await this._gateway.subscribe(e.uid,h,!0)}catch(E){if((E==null?void 0:E.code)!==j.WS_ABORT)throw await this._p2pChannel.unsubscribe(e,t),E;await this._p2pChannel.unsubscribe(e,t,!0),this._p2pChannel.setPendingRemoteMedia(e,t)}this.store.subscribe(e.uid,t,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,e,t)}catch(g){throw this._p2pChannel.reportSubscribeEvent(!1,g==null?void 0:g.code,e,t),g}R.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(g=>{R.warning("[".concat(this._clientId,"] auto set fallback failed"),g)});const m=t==="audio"?e._audioTrack:e._videoTrack;if(!m)throw new ee(j.UNEXPECTED_ERROR,"can not find remote track in user object");return m}catch(m){throw R.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),m),m}finally{p()}}async massSubscribe(e){if(Ka(e,"subscribeList"),!this._joinInfo)throw new ee(j.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ee(j.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const t=Date.now(),n=new Map,o=await this._subscribeMutex.lock();R.info("[".concat(this._clientId,"]start massSubscribe user ").concat(e.map(h=>{let{user:p,mediaType:m}=h;return"user: ".concat(p==null?void 0:p.uid,", mediaType: ").concat(m)}).join("; ")));const s=(e=[...e]).map(h=>{let{user:p,mediaType:m}=h;return{user:p,mediaType:m}}),c=await this._p2pChannel.globalLock();try{var d;for(let p=e.length-1;p>=0;p--){const m=e[p],{user:g,mediaType:E}=m;if(Kn(E,"mediaType",["audio","video"]),!g){const I=new ee(j.INVALID_PARAMS,"user property does not exist in subscribeList item");throw R.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),I}if(!this._users.find(I=>I===g)){const I=new ee(j.INVALID_REMOTE_USER,"user is not in the channel");R.error("[".concat(this._clientId,"] can not massSubscribe ").concat(g.uid,", this user is not in the channel")),s[p].error=I,e.splice(p,1);continue}if(E==="audio"&&(!g.hasAudio||g._audioSSRC===void 0)||E==="video"&&(!g.hasVideo||g._videoSSRC===void 0)){const I=new ee(j.REMOTE_USER_IS_NOT_PUBLISHED);R.error("[".concat(this._clientId,"] can not subscribe ").concat(g.uid," with mediaType ").concat(E,", remote user is not published")),s[p].error=I,e.splice(p,1);continue}const T=Jn.Video|Jn.LwoVideo,P=n.get(g);if(P){if(E==="video"?P&T:P&Jn.Audio){e.splice(p,1),R.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(g.uid,", mediaType:").concat(E," twice"));continue}n.set(g,P|(E==="video"?T:Jn.Audio))}else n.set(g,E==="video"?T:Jn.Audio)}for(let p=e.length-1;p>=0;p--){const m=e[p],{user:g,mediaType:E}=m,y=Jn.Video|Jn.LwoVideo;if(this._p2pChannel.hasRemoteMedia(g,E)){await this._p2pChannel.unmuteRemoteNoLock(g,E);const T=n.get(g);n.set(g,E==="video"?T^y:T^Jn.Audio),e.splice(p,1)}}this.store.massSubscribe(e.map(p=>({userId:p.user.uid,type:p.mediaType})),t);let h=Fo(d=Array.from(n.entries())).call(d,(p,m)=>{let[g,E]=m;if(E===0)return p;const y={stream_id:g.uid,stream_type:E};return E&Jn.Audio&&(y.audio_ssrc=g._audioSSRC),E&Jn.Video&&(y.video_ssrc=g._videoSSRC),p.push(y),p},[]);try{e.length>0&&await this._p2pChannel.massSubscribeNoLock(e.map(m=>{let{user:g,mediaType:E}=m;return{user:g,mediaType:E,ssrcId:E===Re.VIDEO?g._videoSSRC:g._audioSSRC,rtxSsrcId:E===Re.VIDEO?g._rtxSsrcId:void 0}}));const p=new Map;if(h=h.filter(m=>m.video_ssrc&&!this._p2pChannel.isPreSubScribe(m.video_ssrc)||m.audio_ssrc&&!this._p2pChannel.isPreSubScribe(m.audio_ssrc)||!m.video_ssrc&&!m.audio_ssrc),h.length>0){const m=await this._gateway.subscribeAll(h,!0);((m==null?void 0:m.users)||[]).forEach(g=>{let{stream_id:E,video_error_code:y,audio_error_code:T,error_code:P}=g;(y||T||P)&&p.set(E,{video_error_code:y,audio_error_code:T,error_code:P})})}if(Array.from(p.entries()).length>0){const m=[];Array.from(p.entries()).forEach(g=>{let[E,y]=g;const T=this.remoteUsers.find(P=>P.uid===E);if(T){let P;y.error_code||y.video_error_code&&y.audio_error_code?P=void 0:y.video_error_code?P=Re.VIDEO:y.audio_error_code&&(P=Re.AUDIO),m.push({user:T,mediaType:P})}}),m.length>0&&await this._p2pChannel.massUnsubscribeNoLock(m)}for(const m of s){const g=p.get(m.user.uid);if(g){const E=g.error_code||m.mediaType==="audio"&&g.audio_error_code||m.mediaType==="video"&&g.video_error_code;if(E){const y=Gf(E);R.error("user:".concat(m.user.uid," mediaType:").concat(m.mediaType," has massSubscribe error ").concat(y.desc)),m.error=new ee(j.SUBSCRIBE_FAILED,"code ".concat(E,": ").concat(y.desc))}}m.error||(m.mediaType==="video"?m.track=m.user.videoTrack:m.track=m.user.audioTrack)}return this.store.massSubscribe(s.filter(m=>!m.error).map(m=>({userId:m.user.uid,type:m.mediaType})),void 0,Date.now()),s.forEach(m=>{var g;ke.subscribe(this.store.sessionId,{succ:!!m.error,ec:((g=m.error)===null||g===void 0?void 0:g.code)||null,video:m.mediaType===Re.VIDEO,audio:m.mediaType===Re.AUDIO,peerid:m.user.uid,subscribeRequestid:m.mediaType===Re.VIDEO?m.user._videoSSRC:m.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-t),preSsrc:this._p2pChannel.isPreSubScribe(m.user._videoSSRC)},!0)}),R.info("[".concat(this._clientId,"] massSubscribe success ").concat(e.map(m=>{let{user:g,mediaType:E}=m;return"user: ".concat(g==null?void 0:g.uid,", mediaType: ").concat(E)}).join("; "))),s}catch(p){throw await this._p2pChannel.massUnsubscribeNoLock(e),p}}finally{c(),o()}}async unsubscribe(e,t,n){if(!(e instanceof Bc)){const c=this.remoteUsers.find(d=>d.uid===e);if(!c)throw new ee(j.INVALID_REMOTE_USER,"user is not in the channel");e=c}if(t||this.store.useP2P){if(t==="datachannel")return this._unsubscribeDataChannel(e,n)}else await this._unsubscribeDataChannel(e,n);if(t&&Kn(t,"mediaType",["audio","video"]),!this._joinInfo)throw new ee(j.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(c=>c===e)){const c=new ee(j.INVALID_REMOTE_USER,"user is not in the channel");throw R.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),c}R.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: ").concat(t));const s=await this._subscribeMutex.lock();try{if(this.store.useP2P)await this._p2pChannel.unsubscribe(e,t);else{const c=await this._p2pChannel.unsubscribe(e,t);c&&await this._gateway.unsubscribe(c,e.uid),t&&t!=="audio"||(e._audio_pre_subscribed=!1),t&&t!=="video"||(e._video_pre_subscribed=!1),e._is_pre_created&&CE(this._users,e),R.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(e.uid,", mediaType: ").concat(t))}}catch(c){if(c.code===j.DISCONNECT_P2P)return void R.warning("disconnecting p2p, abort unsubscribe request.");throw R.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),c.toString()),c}finally{s()}}async _unsubscribeDataChannel(e,t){if(t&&Ht(t,"id",0,65535,!0),!this._joinInfo)throw new ee(j.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(s=>s===e)){const s=new ee(j.INVALID_REMOTE_USER,"user is not in the channel");throw R.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),s}let o;if(typeof t=="number"){const s=e._dataChannels.find(c=>c.id===t);s&&(o=[s])}else o=e._dataChannels;if(o===void 0){const s=new ee(j.REMOTE_USER_IS_NOT_PUBLISHED);throw R.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid," with channelId ").concat(t,", remote datachannel is not published")),s}R.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(o.map(s=>s.id)));try{const s=await this._p2pChannel.unsubscribeDataChannel(e,o);s&&await this._gateway.unsubscribeDataChannel(s,e.uid),R.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(s))}catch(s){if(s.code===j.DISCONNECT_P2P)return void R.warning("disconnecting p2p, abort unsubscribe request.");throw R.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),s.toString()),s}}async massUnsubscribe(e){if(Ka(e,"unsubscribeList"),!this._joinInfo)throw new ee(j.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");R.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(e.map(n=>{let{user:o,mediaType:s}=n;return"user: ".concat(o==null?void 0:o.uid,", mediaType: ").concat(s,";")}).join())),e=[...e];const t=new Map;for(let n=e.length-1;n>=0;n--){const{user:o,mediaType:s}=e[n];if(!o){const h=new ee(j.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw R.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),h}if(Kn(s,"mediaType",["video","audio",void 0]),!this._users.find(h=>h===o)){R.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(o.uid,", user is not in the channel")),e.splice(n,1);continue}const d=Jn.Video|Jn.LwoVideo;if(t.has(o)){const h=t.get(o);let p;switch(s){case"video":p=h&d;break;case"audio":p=h&Jn.Audio;break;default:p=h&(Jn.Audio|d)}if(p){R.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(o.uid,",mediaType:").concat(s," twice.")),e.splice(n,1);continue}s?s==="audio"?t.set(o,h|Jn.Audio):s==="video"&&t.set(o,h|d):t.set(o,h|Jn.Audio|d)}else s?s==="audio"?t.set(o,Jn.Audio):s==="video"&&t.set(o,d):t.set(o,Jn.Audio|d)}try{const n=await this._p2pChannel.massUnsubscribe(e);n&&await this._gateway.massUnsubscribe(n),R.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(e.map(o=>{let{user:s,mediaType:c}=o;return"user: ".concat(s==null?void 0:s.uid,", mediaType: ").concat(c,";")}).join()))}catch(n){if(n.code===j.DISCONNECT_P2P)return void R.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw R.error("[".concat(this._clientId,"] massUnsubscribe error"),n.toString()),n}}async setLowStreamParameter(e){(function(n){if(!n)throw new re(j.INVALID_PARAMS);_n(n.width)||IR(n.width,"streamParameter.width"),_n(n.height)||IR(n.height,"streamParameter.height"),_n(n.framerate)||IR(n.framerate,"streamParameter.framerate"),_n(n.bitrate)||Ht(n.bitrate,"streamParameter.bitrate")})(e),(!e.width&&e.height||e.width&&!e.height)&&R.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),R.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(e));const t=this._configDistribute.getLowStreamConfigDistribute();if(t&&t.bitrate&&e.bitrate&&t.bitrate<e.bitrate&&(e.bitrate=t.bitrate),this._lowStreamParameter=e,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(e,de.LocalVideoLowTrack)}async enableDualStream(){if(!Rt().supportDualStream)throw ke.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new ee(j.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new ee(j.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(e){throw ke.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),e}this._isDualStreamEnabled=!0,ke.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),R.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new ee(j.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(de.LocalVideoLowTrack))try{const e=await this._p2pChannel.unpublishLowStream();e&&await this._gateway.unpublish(e,this._joinInfo.stringUid||this._joinInfo.uid)}catch(e){throw ke.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),e}this._isDualStreamEnabled=!1,ke.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),R.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(e,t){if(function(o){Kn(o,"role",["audience","host"])}(e),t&&PR(t),this.mode==="rtc"||this.mode==="p2p")throw R.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new ee(j.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(t&&t.level&&e==="host")throw new ee(j.INVALID_OPERATION,"host mode can not set audience latency level");if(e==="audience"&&this._p2pChannel.hasLocalMedia())throw new ee(j.INVALID_OPERATION,"can not set client role to audience when publishing stream");const n=this._config.role;this._joinInfo&&(this._joinInfo.role=e),e!==n&&H("ENABLE_ROLE_SELECT_EDGE")?(this._gateway.updateClientRole(e,t),this._config.role=e,this._gateway.reconnect("recover",_r.REGIONAL_DISTRIBUTION)):(await this._gateway.setClientRole(e,t),this._config.role=e),R.info("[".concat(this._clientId,"] set client role to ").concat(e,", level: ").concat(t&&t.level))}async _setClientRoleOptions(e){if(this.mode==="rtc"||this.mode==="p2p"||this._config.role!=="audience"||this._p2pChannel.hasLocalMedia())return;let t=!1;try{e&&PR(e),await this._gateway.setClientRole(this._config.role,e),t=!0}catch{}finally{R.info("[".concat(this._clientId,"] set client role options ").concat(t?"succeed":"failed",", options is ").concat(e))}}getRemoteInboundOffset(){var e;const t=(e=this._p2pChannel.getStats())===null||e===void 0?void 0:e.audioSend[0];if(!t||!t.timestamp)return 0;const n=t.timestamp-Date.now();return Math.abs(n)>1e3+t.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?n:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(e,t){if(ar(e,"proxyServer"),!t){if(this.connectionState!=="DISCONNECTED")throw new ee(j.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new ee(j.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=e,ke.setProxyServer(this._proxyServer),R.setProxyServer(this._proxyServer),R.info("[".concat(this._clientId,"] Set proxy server ").concat(t?"by initialize call":""," success."))}setTurnServer(e,t){if(Array.isArray(e)||(e=[e]),!t){if(this.connectionState!=="DISCONNECTED")throw new ee(j.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new ee(j.INVALID_OPERATION,"You have already set the proxy")}if(kf(e))return this._turnServer={servers:e,mode:"original-manual"},void R.info("[".concat(this._clientId,"] Set original turnserver ").concat(t?"by initialize call":""," success: ").concat(e.map(n=>n.urls).join(","),"."));e.forEach(n=>z2(n)),this._turnServer={servers:e,mode:"manual"},R.info("[".concat(this._clientId,"] Set turnserver ").concat(t?"by initialize call":""," success."))}setLicense(e){if(this.connectionState!=="DISCONNECTED")throw new ee(j.INVALID_OPERATION,"you should set license before join channel");if(ar(e,"license",32,32),!/^[A-Za-z\d]+$/.test(e))throw new ee(j.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=e,R.info("[".concat(this._clientId,"] set license success"),e)}startProxyServer(e){if(this.connectionState!=="DISCONNECTED")throw new ee(j.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new ee(j.INVALID_OPERATION,"You have already set the proxy");const t=[3,4,5];let n;switch(e===void 0&&(e=3),e){case 1:case 2:throw new ee(j.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:n="proxy3";break;case 4:n="proxy4";break;case 5:n="proxy5";break;default:throw new ee(j.INVALID_PARAMS,"proxy server mode must be ".concat(t.join("|")))}this._cloudProxyServerMode=n,this.store.cloudProxyServerMode=n,R.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new ee(j.INVALID_OPERATION,"Stop proxy server after leave channel");ke.setProxyServer(),R.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",R.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(e){if(!e.accessPoints)throw new ee(j.INVALID_PARAMS,"accessPoints is required.");Ka(e.accessPoints.serverList,"accessPoints.serverList"),ar(e.accessPoints.domain,"accessPoints.domain");const t=(y,T)=>{Ht(y,T,0,65535,!0)};let n=443;if(e.accessPoints.port&&(t(e.accessPoints.port,"accessPoints.port"),n=e.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new ee(j.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");H("CLOSE_AFB_FOR_LOCAL_AP")&&(jt("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),jt("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const o=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,s=e.accessPoints.domain,c=e.accessPoints.serverList.map(y=>o.test(y)?"".concat(y.replace(/\./g,"-"),".").concat(s):y),d=c.map(y=>"".concat(y,":").concat(n));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,jt("WEBCS_DOMAIN",d),jt("WEBCS_DOMAIN_BACKUP_LIST",d),jt("GATEWAY_DOMAINS",[s]),e.report&&e.report.hostname&&Array.isArray(e.report.hostname)&&e.report.hostname.length?(Ka(e.report.hostname,"report.hostname"),jt("EVENT_REPORT_DOMAIN",e.report.hostname[0]),jt("EVENT_REPORT_BACKUP_DOMAIN",e.report.hostname[1]||e.report.hostname[0])):(jt("EVENT_REPORT_DOMAIN",c[0]),jt("EVENT_REPORT_BACKUP_DOMAIN",c[1]||c[0]));let h=6443;e.report&&e.report.port&&(t(e.report.port,"report.port"),h=e.report.port),jt("STATS_COLLECTOR_PORT",h),e.report?jt("ENABLE_EVENT_REPORT",!0):jt("ENABLE_EVENT_REPORT",!1);let p="";e.log&&e.log.hostname&&Array.isArray(e.log.hostname)&&e.log.hostname.length?(Ka(e.log.hostname,"log.hostname"),p=e.log.hostname[0]):p=c[0];let m=6444;e.log&&e.log.port&&(t(e.log.port,"log.port"),m=e.log.port),jt("LOG_UPLOAD_SERVER","".concat(p,":").concat(m));let g=[];e.cds&&e.cds.hostname&&Array.isArray(e.cds.hostname)&&e.cds.hostname.length?(Ka(e.cds.hostname,"cds.hostname"),g=e.cds.hostname):g=c;let E=443;e.cds&&e.cds.port&&(t(e.cds.port,"cds.port"),E=e.cds.port),jt("CDS_AP",g.map(y=>"".concat(y,":").concat(E))),e.cds?jt("ENABLE_CONFIG_DISTRIBUTE",!0):jt("ENABLE_CONFIG_DISTRIBUTE",!1),R.info("set local access point v2 success")}setLocalAccessPoints(e,t){if(Ka(e,"serverList"),ar(t,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new ee(j.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const n=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;e=e.map(o=>n.test(o)?"".concat(o.replace(/\./g,"-"),".").concat(t):o),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,jt("WEBCS_DOMAIN",e),jt("WEBCS_DOMAIN_BACKUP_LIST",e),jt("GATEWAY_DOMAINS",[t]),jt("EVENT_REPORT_DOMAIN",e[0]),jt("EVENT_REPORT_BACKUP_DOMAIN",e[1]||e[0]),jt("LOG_UPLOAD_SERVER","".concat(e[0],":6444")),R.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(e){if(Kn(e,"streamType",[0,1,4,5,6,7,8,9]),this._remoteDefaultVideoStreamType=e,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(e),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(t){throw R.error("[".concat(this._clientId,"] set default remote video stream type error"),t.toString()),t}else R.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(e))}async setRemoteVideoStreamType(e,t){Kn(t,"streamType",[0,1,4,5,6,7,8,9]);try{await this._gateway.setRemoteVideoStreamType(e,t),setTimeout(()=>{const n=this._users.find(o=>o.uid===e);n&&n.videoTrack&&n.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(n){throw R.error("[".concat(this._clientId,"] set remote video stream type error"),n.toString()),n}R.info("[".concat(this._clientId,"] set remote ").concat(e," video stream type to ").concat(t)),this._remoteStreamTypeCacheMap.set(e,t)}async setStreamFallbackOption(e,t){Kn(t,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{await this._gateway.setStreamFallbackOption(e,t)}catch(n){throw R.error("[".concat(this._clientId,"] set stream fallback option"),n.toString()),n}R.info("[".concat(this._clientId,"] set remote ").concat(e," stream fallback type to ").concat(t)),this._streamFallbackTypeCacheMap.set(e,t)}setEncryptionConfig(e,t,n,o){(function(c){Kn(c,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(e),ar(t,"secret");const s=["aes-128-gcm2","aes-256-gcm2"];if(Ee(s).call(s,e)){if(!n||!(n instanceof Uint8Array&&n.length===32))throw new ee(j.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(n)throw new ee(j.INVALID_PARAMS,"current encrypt mode does not need salt");if(o){if(za(o,"encryptDataStream"),!Ee(s).call(s,e))throw new ee(j.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(t)||R.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=e,this._encryptionSecret=t,n&&(this._encryptionSalt=kc(n))}async renewToken(e){if(ar(e,"token",1,2047),!this._key||!this._joinInfo)throw new ee(j.INVALID_OPERATION,"renewToken should not be called before user join");const t=this._key;this._key=e,this._joinInfo&&(this._joinInfo.token=e);const n=await this._renewTokenMutex.lock();try{if(H("USE_NEW_TOKEN")){R.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const o=await cse(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Un);R.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:e,ticket:o})}else R.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:e});R.debug("[".concat(this._clientId,"] renewToken success"))}catch(o){throw this._key=t,this._joinInfo.token=t,R.error("[".concat(this._clientId,"] renewToken failed"),o.toString()),o}finally{n()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?R.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const e=this._p2pChannel.getAudioLevels();this.safeEmit(mt.VOLUME_INDICATOR,e)},H("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const e=this._statsCollector.getRTCStats(),t=this._gateway.getInChannelInfo();return e.Duration=Math.round(t.duration/1e3),e}async startLiveStreaming(e,t){if(!t){if(this.codec!=="h264")throw new ee(j.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new ee(j.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(e)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(e))throw new ee(j.LIVE_STREAMING_TASK_CONFLICT);const n=t?qa.TRANSCODE:qa.RAW;return this._createLiveStreamingClient(n).startLiveStreamingTask(e,n)}setLiveTranscoding(e){return this._createLiveStreamingClient(qa.TRANSCODE).setTranscodingConfig(e)}async stopLiveStreaming(e){const t=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(n=>n&&n.hasUrl(e));if(!t.length)throw new ee(j.INVALID_PARAMS,"can not find live streaming url to stop");await ye.all(t.map(n=>n&&n.stopLiveStreamingTask(e)))}async startChannelMediaRelay(e){OV(e),await this._createChannelMediaRelayClient().startChannelMediaRelay(e)}async updateChannelMediaRelay(e){OV(e),await this._createChannelMediaRelayClient().updateChannelMediaRelay(e)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendAudioMetadata(e){this._p2pChannel instanceof tm&&this._p2pChannel.addAudioMetadata(e)}async sendStreamMessage(e){var t;let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new ee(j.INVALID_OPERATION,"can not send data stream, not joined");if((typeof e=="string"||e instanceof Uint8Array)&&(e={payload:e}),typeof e.payload=="string"){const s=new TextEncoder;e.payload=s.encode(e.payload)}let o=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&Ee(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)&&(o=!0,e.payload=await async function(s,c,d){var h;const p=Fo(h=Array.from(d)).call(h,(I,A)=>I+A,0),m={serverTs:0,seq:Nie++,length:d.length,checkSum:p},g=new Uint8Array(Z2(p,2)),E=new ArrayBuffer(th),y=new DataView(E);y.setUint32(0,m.serverTs),y.setUint16(4,m.seq),y.setUint16(6,m.length),y.setUint16(8,m.checkSum);const T=16-d.length%16;d=q2(d,new Uint8Array(T));const P=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:s,tagLength:hM,additionalData:g},c,d);return q2(new Uint8Array(E),new Uint8Array(P))}(this._encryptDataStreamIv,this._encryptDataStreamKey,e.payload)),new Blob([e.payload]).size>1024)throw new ee(j.INVALID_PARAMS,o?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(Ye.DATA_STREAM,{payload:kc(e.payload),syncWithAudio:e.syncWithAudio,sendTs:Date.now()-_se},!n)}sendMetadata(e){if(!this._joinInfo)throw new ee(j.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([e]).size>1024)throw new ee(j.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(Ye.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:kc(e)})}async sendCustomReportMessage(e){if(Array.isArray(e)||(e=[e]),e.forEach(jie),!this._joinInfo)throw new ee(j.INVALID_OPERATION,"can not send custom report, not joined");await ke.sendCustomReportMessage(this._joinInfo.sid,e)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}async pickSVCLayer(e,t){Kn(t.spatialLayer,"spatialLayer",[0,1,2,3]),Kn(t.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(e,t)}catch(n){throw R.error("[".concat(this._clientId,"] pick SVC layer failed"),n.toString()),n}}async setRTMConfig(e){const{apRTM:t=!1,rtmFlag:n}=e;if(za(t,"apRTM"),Ht(n,"rtmFlag",0),this._rtmConfig.apRTM=t,this._rtmConfig.rtmFlag=n,R.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(e)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=t,this._joinInfo.rtmFlag=n,this._gateway.setRTM2Flag(n)}_reset(){if(R.debug("[".concat(this._clientId,"] reset client")),function(e){const t=fh.indexOf(e);t!==-1&&fh.splice(t,1)}(this._clientId),this.store.hasStartJoinChannel=!1,this.store.isABTestSuccess=!1,this._axiosCancelSource.cancel(),this._axiosCancelSource=oi.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&rF(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&ke.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(e=>{e._audioTrack&&e._audioTrack._destroy(),e._videoTrack&&e._videoTrack._destroy(),e._dataChannels&&(e._dataChannels.forEach(t=>t._close()),e._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new Ir("client-publish",this._clientId),this._subscribeMutex=new Ir("client-subscribe",this._clientId),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(e,t){var n;const o=e||od();e?R.debug("[".concat(this._clientId,"] new Session ").concat(o)):R.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(o));const s=e?"":this._sessionId||"";this._sessionId=o,this.store.sessionId=o,ke.addSid(o);const c={lts:new Date().getTime(),mode:this.mode,buildFormat:1,stringUid:(t==null?void 0:t.stringUid)||((n=this._joinInfo)===null||n===void 0?void 0:n.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:s,clientRole:this.role==="audience"?2:1};ke.sessionInit(this._sessionId,rs({cname:t.channel,appid:t.appId},c)),this._joinInfo&&(this._joinInfo.sid=o),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=o)}async _publishHighStream(e){if(!this._joinInfo||this._uid===void 0)throw new ee(j.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ee(j.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&H("FORCE_TURN")&&!H("TURN_ENABLE_TCP")&&!H("TURN_ENABLE_UDP"))throw new ee(j.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");R.debug("[".concat(this._clientId,"] publish high stream"));try{const n=await this._p2pChannel.publish(e,this._isDualStreamEnabled,this._lowStreamParameter);if(this.store.useP2P){const o=(await n.next()).value;if(o){try{await this._gateway.sendExtensionMessage(bn.PUBLISH,o,!0)}catch(s){throw n.throw(s),s}await n.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{const o=(await n.next()).value;if(o){var t;let s;try{s=await this._gateway.publish(this._uid,o,!0)}catch(c){if(c.code!==j.DISCONNECT_P2P)throw n.throw(c),c}await n.next(((t=s)===null||t===void 0?void 0:t.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const s of e)s instanceof nn&&s._encoderConfig&&this._gateway.setVideoProfile(s._encoderConfig).catch(c=>{R.debug("[".concat(this._clientId,"] stop setVideoProfile, because websocket is closed"))}),!s.muted&&s.enabled||await this._p2pChannel.muteLocalTrack(s)}}catch(n){if(this._p2pChannel.reportPublishEvent(!1,n==null?void 0:n.code,e),(n==null?void 0:n.code)===j.WS_ABORT)return;throw n}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new ee(j.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ee(j.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));R.debug("[".concat(this._clientId,"] publish low stream"));const e=this._configDistribute.getLowStreamConfigDistribute();e&&e.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&e.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=e.bitrate));try{const n=await this._p2pChannel.publishLowStream(this._lowStreamParameter),o=(await n.next()).value;if(o){var t;let s;try{s=await this._gateway.publish(this._uid,o,!0)}catch(c){if(c.code!==j.DISCONNECT_P2P)throw n.throw(c),c}n.next(((t=s)===null||t===void 0?void 0:t.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(n){if(this._p2pChannel.reportPublishEvent(!1,n==null?void 0:n.code,void 0,!0),(n==null?void 0:n.code)===j.WS_ABORT)return;throw n}}_createLiveStreamingClient(e){const t=()=>{if(!this._joinInfo||!this._appId)return new ee(j.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const n=(o={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},Ja("LiveStreaming").create(o));var o;return n.onLiveStreamError=(s,c)=>{ke.reportApiInvoke(this._sessionId,{name:Nn.ON_LIVE_STREAM_ERROR,options:[s,c],tag:En.TRACER}).onSuccess(),this.safeEmit(mt.LIVE_STREAMING_ERROR,s,c)},n.onLiveStreamWarning=(s,c)=>{ke.reportApiInvoke(this._sessionId,{name:Nn.ON_LIVE_STREAM_WARNING,options:[s,c],tag:En.TRACER}).onSuccess(),this.safeEmit(mt.LIVE_STREAMING_WARNING,s,c)},n.on(TC.REQUEST_WORKER_MANAGER_LIST,(s,c,d)=>{if(!this._joinInfo)return d(new ee(j.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(h,p,m,g){const E=H("UAP_AP").slice(0,H("AJAX_REQUEST_CONCURRENT")).map(y=>p.proxyServer?"https://".concat(p.proxyServer,"/ap/?url=").concat(y+"/api/v1?action=uap"):"https://".concat(y,"/api/v1?action=uap"));return await nse(E,h,p,m,g)})(s,this._joinInfo,this._axiosCancelSource.token,Un).then(c).catch(d)}),n};return e===qa.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||t(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||t(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new ee(j.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:t,sendResolutionHeight:n}=this.getLocalVideoStats(),o=(e={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:t,height:n}},Ja("ChannelMediaRelay").create(e));o.on("state",s=>{s===Ei.RELAY_STATE_FAILURE&&o&&o.dispose(),this.safeEmit(mt.CHANNEL_MEDIA_RELAY_STATE,s)}),o.on("event",s=>{this.safeEmit(mt.CHANNEL_MEDIA_RELAY_EVENT,s)}),this._channelMediaRelayClient=o,this._statsCollector.onStatsChanged=(s,c)=>{var d;s==="resolution"&&((d=this._channelMediaRelayClient)===null||d===void 0||d.setVideoProfile(c))}}var e;return this._channelMediaRelayClient}_handleUpdateDataChannel(e,t){const{added:n,deleted:o}=e,s=[];if(t){const c=[];this._users.forEach(d=>{d._dataChannels.forEach(h=>{n.every(p=>p.uid!==d._uintid||p.stream_id!==h.id)&&c.push({uid:d._uintid,stream_id:h.id,ordered:h.ordered,max_retrans_times:h.maxRetransmits,metadata:h.metadata})})}),c.length>0&&this._handleUpdateDataChannel({added:[],deleted:c})}Array.isArray(n)&&n.length>0&&n.forEach(c=>{const{uid:d,stream_id:h,ordered:p,max_retrans_times:m,metadata:g}=c,E=this._users.find(y=>y._uintid===d);if(!E)return void R.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(R.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(d)),Ee(s).call(s,E)||s.push(E),E._uintid||(E._uintid=d),E._dataChannels.findIndex(y=>y.id===c.stream_id)===-1){const y={id:h,ordered:!!p,maxRetransmits:m,metadata:g},T=function(P){return pV(P,!0)}(y);E._dataChannels.push(T),R.info("[".concat(this._clientId,"] remote user ").concat(E.uid," published datachannel")),t||this.safeEmit(mt.USER_PUBLISHED,E,"datachannel",y)}this._p2pChannel.hasPendingRemoteDataChannel(E,c.stream_id)&&(R.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(E.uid," after reconnect.")),this._subscribeDataChannel(E,c.stream_id).catch(y=>{R.error("[".concat(this._clientId,"] resubscribe datachannel error"),y.toString())}))}),t&&(this.safeEmit(mt.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(o)&&o.length>0&&o.forEach(c=>{const{uid:d,stream_id:h}=c,p=this._users.find(g=>g._uintid===d);if(!p)return void R.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const m=p._dataChannels.find(g=>g.id===c.stream_id);m&&(R.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(d)),this._p2pChannel.unsubscribeDataChannel(p,[m]).then(g=>{if(p._dataChannels=p._dataChannels.filter(E=>E!==m),g)return this._gateway.unsubscribeDataChannel(g,p.uid)}),R.info("[".concat(this._clientId,"] remote user ").concat(d," unpublished datachannel ,id:").concat(m.id)),this.safeEmit(mt.USER_UNPUBLISHED,p,"datachannel",m._config))})}_handleRemoveDataChannels(e){const t=this._users.find(n=>n.uid===e.uid);if(t){if(t._dataChannels!==void 0&&t._dataChannels.length>0){R.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(e.uid));const n=()=>{R.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished datachannel")),t._dataChannels.forEach(o=>{this.safeEmit(mt.USER_UNPUBLISHED,t,"datachannel",o._config)})};this._p2pChannel.unsubscribeDataChannel(t,t._dataChannels).then(o=>{if(o)return this._gateway.unsubscribeDataChannel(o,t.uid)}),n()}}else R.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(nr.UPDATE_GATEWAY_CONFIG,()=>{(function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(t){return void R.error("Error loading sdk config",t.message)}if(e)try{const t=JSON.parse(window.atob(e)),n=Date.now();Object.keys(t).forEach(o=>{const{value:s,type:c,expires:d}=t[o];d&&d<=n||c||mC()||!Object.prototype.hasOwnProperty.call(PE,o)||(Rs[o]=s,cn[o]=s,R.debug("Update gateway parameters from config distribute",o,s))})}catch(t){R.error("Error update config from local cache",t.message)}})()}),this._gateway.on(nr.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(nr.CONNECTION_STATE_CHANGE,(e,t,n)=>{var o;if(n===Dt.FALLBACK)return;const s=()=>{this.safeEmit(mt.CONNECTION_STATE_CHANGE,e,t,n)};if(ke.reportApiInvoke(this._sessionId||((o=this._gateway.joinInfo)===null||o===void 0?void 0:o.sid)||null,{name:Nn.CONNECTION_STATE_CHANGE,options:[e,t,n],tag:En.TRACER}).onSuccess(JSON.stringify({cur:e,prev:t,reason:n})),R.info("[".concat(this._clientId,"] signal connection state change: ").concat(t," -> ").concat(e)),e==="DISCONNECTED")return this._reset(),void s();if(e==="RECONNECTING")this._users.forEach(d=>{d._trust_in_room_=!1,d._trust_audio_enabled_state_=!1,d._trust_video_enabled_state_=!1,d._trust_audio_mute_state_=!1,d._trust_video_mute_state_=!1,d._trust_audio_stream_added_state_=!1,d._trust_video_stream_added_state_=!1,d._is_pre_created||(d._audio_pre_subscribed||(d._audioSSRC=void 0,d._audioOrtc=void 0),d._video_pre_subscribed||(d._videoSSRC=void 0,d._videoOrtc=void 0,d._rtxSsrcId=void 0),d._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(e==="CONNECTED"){var c;this._streamFallbackTypeCacheMap.forEach((d,h)=>{this._gateway.setStreamFallbackOption(h,d).catch(p=>{R.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),p)})}),this._remoteStreamTypeCacheMap.forEach((d,h)=>{this._gateway.setRemoteVideoStreamType(h,d).catch(p=>{R.warning("[".concat(this._clientId,"] auto set remote stream type failed"),p)})}),this._remoteDefaultVideoStreamType!==void 0&&((c=this._joinInfo)===null||c===void 0?void 0:c.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{R.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(d=>{R.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(d))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(d=>!d._trust_in_room_).forEach(d=>{R.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(d.uid)),this._handleUserOffline({uid:d.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(d=>{d._trust_audio_mute_state_||(R.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(d.uid)),this._handleMuteStream(d.uid,Re.AUDIO,!1)),d._trust_video_mute_state_||(R.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(d.uid)),this._handleMuteStream(d.uid,Re.VIDEO,!1)),d._trust_audio_enabled_state_||(R.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(d.uid)),this._handleSetStreamLocalEnable("audio",d.uid,!0)),d._trust_video_enabled_state_||(R.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(d.uid)),this._handleSetStreamLocalEnable("video",d.uid,!0)),d._trust_video_stream_added_state_||(R.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(d.uid)),this._handleResetAddStream(d,"video")),d._trust_audio_stream_added_state_||(R.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(d.uid)),this._handleResetAddStream(d,"audio")),d._video_added_||d._audio_added_||(R.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(d.uid)),this._handleRemoveStream({uid:d.uid,uint_id:d._uintid}))}))},1e3))}s()}),this._gateway.on(nr.REQUEST_NEW_GATEWAY_LIST,async(e,t)=>{if(!this._joinInfo)return t(new ee(j.UNEXPECTED_ERROR,"can not recover, no join info"));try{let n;const o=await tF(rs(rs({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));o?(n=o.ap,iF(o),this._joinInfo.preload=!0):(n=await VC(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Un,this.store),this._joinInfo.preload=!1),this._joinInfo&&(this._joinInfo.apResponse=n.gatewayInfo.res,this._joinInfo.gatewayAddrs=n.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=n.gatewayInfo.uni_lbs_ip);const s=[];n.gatewayInfo.gatewayAddrs.forEach(c=>{let{address:d}=c;const[h,p]=d.split(":");this._joinInfo&&this._joinInfo.proxyServer?s.push({proxy:this._joinInfo.proxyServer,host:h,port:p}):s.push({host:h,port:p})}),e(s)}catch(n){t(n)}}),this._gateway.on(nr.NETWORK_QUALITY,e=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(mt.NETWORK_QUALITY,e)}),this._gateway.on(nr.STREAM_TYPE_CHANGE,(e,t)=>{this.safeEmit(mt.STREAM_TYPE_CHANGED,e,t),ke.reportApiInvoke(this._sessionId,{name:Nn.STREAM_TYPE_CHANGE,options:[e,t],tag:En.TRACER}).onSuccess(JSON.stringify({uid:e,streamType:t}))}),this._gateway.on(nr.IS_P2P_DISCONNECTED,e=>{this._p2pChannel.isP2PDisconnected()?e(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?e(!1):e(!0)}),this._gateway.on(nr.REQUEST_P2P_CONNECTION_PARAMS,async(e,t,n)=>{try{let o=await this._p2pChannel.getEstablishParams();H("ENABLE_PREALLOC_PC")&&o||(o=await this._p2pChannel.startP2PConnection(e)),t(o)}catch(o){n(o)}}),this._gateway.on(nr.JOIN_RESPONSE,(e,t)=>{if(this.store.useP2P)return;let n;e.attributes?n=e.attributes.userAttributes.preSubSsrcs:R.debug("no attributes in joinResponse");const o=tV(e.ortc,t,n);this._p2pChannel.connect(o)}),this._gateway.on(nr.PRE_CONNECT_PC,async e=>{const{candidates:t,fingerprint:n}=e;if(this._joinInfo&&t.length>0&&!this._p2pChannel.isPlanB){var o;await this._p2pChannel.startP2PConnection({turnServer:this._joinInfo.turnServer});const{cert:s,cid:c}=this._joinInfo.apResponse;await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(c,"_").concat(s),icePwd:"".concat(c,"_").concat(s)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:(o=H("FINGERPRINT"))!==null&&o!==void 0?o:n}]},candidates:t,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0})}})}_handleGatewaySignalEvents(){this._gateway.signal.on(_t.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(_t.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(_t.ON_ADD_AUDIO_STREAM,e=>this._handleAddAudioOrVideoStream("audio",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc)),this._gateway.signal.on(_t.ON_ADD_VIDEO_STREAM,e=>this._handleAddAudioOrVideoStream("video",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc,e.rtxSsrcId)),this._gateway.signal.on(_t.ON_REMOTE_DATASTREAM_UPDATE,e=>{this._handleUpdateDataChannel(e)}),this._gateway.signal.on(_t.ON_REMOTE_FULL_DATASTREAM_INFO,e=>{this._handleUpdateDataChannel({added:e.datastreams||[],deleted:[]},!0)}),this._gateway.signal.on(_t.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(_t.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(_t.MUTE_AUDIO,e=>this._handleMuteStream(e.uid,Re.AUDIO,!0)),this._gateway.signal.on(_t.UNMUTE_AUDIO,e=>this._handleMuteStream(e.uid,Re.AUDIO,!1)),this._gateway.signal.on(_t.MUTE_VIDEO,e=>this._handleMuteStream(e.uid,Re.VIDEO,!0)),this._gateway.signal.on(_t.UNMUTE_VIDEO,e=>this._handleMuteStream(e.uid,Re.VIDEO,!1)),this._gateway.signal.on(_t.RECEIVE_METADATA,e=>{const t=id(e.metadata);this.safeEmit(mt.RECEIVE_METADATA,e.uid,t)}),this._gateway.signal.on(_t.ON_DATA_STREAM,async e=>{var t;if(!e)return;let n=id(e.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&Ee(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)){if(e.payload.length<th)throw new ee(j.UNEXPECTED_RESPONSE,"payload length ".concat(e.payload.length," is less than header length ").concat(th));n=await async function(c,d,h){const p=h.subarray(0,th),m=p.slice(8,th),g=(m[0]<<8)+m[1],E=(p[6]<<8)+p[7],y=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:c,tagLength:hM,additionalData:new Uint8Array(Z2(g,2))},d,h.subarray(th));return new Uint8Array(y).subarray(0,E)}(this._encryptDataStreamIv,this._encryptDataStreamKey,n)}let o=0;if(e.ordered||e.syncWithAudio){const s=this._p2pChannel.getStats(),c=this.remoteUsers.find(h=>h.uid===e.uid),d=s==null?void 0:s.audioRecv.find(h=>h.ssrc===(c==null?void 0:c._audioSSRC));o=d==null?void 0:d.jitterBufferMs}(o==null||Number.isNaN(o))&&(o=0),vse(rs(rs({},e),{},{payload:n}),o,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(_t.ON_CRYPT_ERROR,()=>{Dc(()=>{R.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(mt.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(_t.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(_t.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{R.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,Dt.TOKEN_EXPIRE),this.safeEmit(mt.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(_t.ON_STREAM_FALLBACK_UPDATE,e=>{R.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(e.stream_id,", attr: ").concat(e.stream_type)),this.safeEmit(mt.STREAM_FALLBACK,e.stream_id,e.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(_t.ON_PUBLISH_STREAM,e=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:e.proxy})),R.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(e))))}),this._gateway.signal.on(_t.ENABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!0)}),this._gateway.signal.on(_t.DISABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!1)}),this._gateway.signal.on($e.REQUEST_TIMEOUT,(e,t)=>{if(this._joinInfo)switch(e){case Ye.PUBLISH:{if(!t)return;const s=t.ortc;if(s){var n,o;const c=s.some(p=>{let{stream_type:m}=p;return m===xt.Audio}),d=s.some(p=>{let{stream_type:m}=p;return m!==xt.Audio}),h=s.some(p=>{let{stream_type:m}=p;return m===xt.Screen||m===xt.ScreenLow});t.state==="offer"&&ke.publish(this._joinInfo.sid,{eventElapse:Or.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:j.TIMEOUT,audio:c,video:d,p2pid:t.p2p_id,publishRequestid:this.store.pubId,screenshare:h,audioName:c?(n=s.find(p=>{let{stream_type:m}=p;return m===xt.Audio}))===null||n===void 0||(n=n.ssrcs[0])===null||n===void 0?void 0:n.ssrcId.toString():void 0,videoName:d?(o=s.find(p=>{let{stream_type:m}=p;return m!==xt.Audio}))===null||o===void 0||(o=o.ssrcs[0])===null||o===void 0?void 0:o.ssrcId.toString():void 0})}break}case Ye.SUBSCRIBE:t&&ke.subscribe(this._joinInfo.sid,{succ:!1,ec:j.TIMEOUT,audio:t.stream_type===Re.AUDIO,video:t.stream_type===Re.VIDEO,peerid:t.stream_id,subscribeRequestid:t.ssrcId,p2pid:this.store.p2pId,eventElapse:Or.measureFromSubscribeStart(this.store.clientId,t.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(t.ssrcId)})}}),this._gateway.signal.on(_t.ON_P2P_OK,e=>{this.uid,this._uid}),this._gateway.signal.on(_t.ON_PUBLISHED_USER_LIST,e=>{if(e==null||!e.users)return;H("BLOCK_LOCAL_CLIENT")&&(e.users=e.users.filter(o=>!pd(o.string_id||o.stream_id,this.channelName)));const t=[],n=[];for(const o of e.users){let s=this._users.find(g=>g._uintid===o.stream_id);s?s._trust_in_room_=!0:(s=new Bc(o.string_id||o.stream_id,o.stream_id),this._users.push(s),this.getListeners(mt.PUBLISHED_USER_LIST).length===0&&(R.debug("[".concat(this._clientId,"] user online"),o.stream_id),this.safeEmit(mt.USER_JOINED,s)));const c=Jn.Audio&o.stream_type,d=(Jn.Video|Jn.LwoVideo)&o.stream_type,h=(65280&o.stream_type)!=0,p=c&&s.hasAudio,m=d&&s.hasVideo;d&&(s._trust_video_stream_added_state_=!0,s._video_added_=!0,s._videoSSRC=o.video_ssrc,s._rtxSsrcId=o.video_rtx),c&&(s._trust_audio_stream_added_state_=!0,s._audio_added_=!0,s._audioSSRC=o.audio_ssrc),c&&!p&&this.getListeners(mt.PUBLISHED_USER_LIST).length===0&&(R.info("[".concat(this._clientId,"] remote user ").concat(s.uid," published audio")),this.safeEmit(mt.USER_PUBLISHED,s,"audio")),d&&!m&&this.getListeners(mt.PUBLISHED_USER_LIST).length===0&&(R.info("[".concat(this._clientId,"] remote user ").concat(s.uid," published video")),this.safeEmit(mt.USER_PUBLISHED,s,"video")),(c&&!p||d&&!m||h)&&t.push(s),d&&this._p2pChannel.hasPendingRemoteMedia(s,"video")&&n.push({user:s,mediaType:"video"}),c&&this._p2pChannel.hasPendingRemoteMedia(s,"audio")&&n.push({user:s,mediaType:"audio"})}n.length>0&&(R.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(n.map(o=>"user: ".concat(o.user.uid,", mediaType: ").concat(o.mediaType)).join("; ")," ")),this.massSubscribe(n).catch(o=>{R.error("[".concat(this._clientId,"] mass resubscribe error"),o.toString())})),this.getListeners(mt.PUBLISHED_USER_LIST).length>0?H("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=t:(R.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(t.map(o=>o.uid).join(", "))),this.safeEmit(mt.PUBLISHED_USER_LIST,t)):R.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(t.map(o=>o.uid).join(", ")))}),this._gateway.signal.on(_t.ON_RTP_CAPABILITY_CHANGE,e=>{const{video_codec:t}=e;this._p2pChannel instanceof tm&&this._p2pChannel.updateRemoteRTPCapabilities(t.map(n=>n.toLowerCase()).filter(n=>{var o;return Ee(o=Object.keys(DE)).call(o,n)}))})}_handleP2PEvents(){this._gateway.signal.on(_t.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(bn.PUBLISH,(e,t,n)=>{const{uid:o}=e;e.forEach(s=>{const{kind:c,ssrcs:d,mid:h,isMuted:p}=s;this._handleP2PAddAudioOrVideoStream(c,o,d[0].ssrcId,h);const m=this._users.find(g=>g.uid===o);return m&&this.store.useP2P?this._p2pChannel.mockSubscribe(m,c,d[0].ssrcId,h).then(()=>{t()}).catch(n):t(),this._handleMuteStream(o,c,!!p)})}),this._gateway.signal.on(bn.CALL,async(e,t,n)=>{if(this.store.useP2P)try{var o;t(await this._p2pChannel.startP2P({turnServer:(o=this._joinInfo)===null||o===void 0?void 0:o.turnServer},e))}catch(s){n(s)}}),this._gateway.signal.on($e.P2P_CONNECTION,async e=>{this.store.useP2P&&(await this._p2pChannel).p2pConnect(e)}),this._gateway.signal.on(bn.UNPUBLISH,async(e,t,n)=>{if(this.store.useP2P){const{unpubMsg:o,uid:s}=e,c=this._users.find(d=>d.uid===s);if(!c)return R.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(s)),void t();try{o.forEach(async d=>{let{stream_type:h}=d;const p=h===xt.Audio?Re.AUDIO:Re.VIDEO;await this._p2pChannel.unsubscribe(c,p),this._handleMuteStream(s,p,!0)}),t()}catch(d){n(d)}}}),this._gateway.signal.on(bn.CONTROL,async(e,t)=>{const{action:n}=e;switch(n){case Mc.MUTE_LOCAL_VIDEO:this._handleMuteStream(t,Re.VIDEO,!0);break;case Mc.MUTE_LOCAL_AUDIO:this._handleMuteStream(t,Re.AUDIO,!0);break;case Mc.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",t),this._handleMuteStream(t,Re.VIDEO,!1);break;case Mc.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",t),this._handleMuteStream(t,Re.AUDIO,!1)}}),this._gateway.signal.on(bn.RESTART_ICE,async(e,t,n)=>{if(this.store.useP2P)try{const{direction:o,iceParameter:s}=e;o!==ei.SEND_ONLY||s?t(await this._p2pChannel.restartICE(o,s)):(this._p2pChannel.handleDisconnect(o),t())}catch(o){n(o)}}),this._gateway.signal.on(bn.CANDIDATE,e=>{if(this.store.useP2P){const{candidate:t,direction:n}=e;this._p2pChannel.addRemoteCandidate(t,n)}}),this._p2pChannel.on(Me.RequestP2PRestartICE,async(e,t,n)=>{try{const{direction:o}=e;t(await this._gateway.sendExtensionMessage(bn.RESTART_ICE,e,o===ei.SEND_ONLY))}catch(o){n(o)}}),this._p2pChannel.on(Me.LocalCandidate,e=>{this._gateway.sendExtensionMessage(bn.CANDIDATE,JSON.stringify(e),!0)}),this._p2pChannel.on(Me.RequestP2PMuteLocal,async(e,t,n)=>{try{await this._gateway.sendExtensionMessage(bn.CONTROL,e,!0),t()}catch(o){n(o)}}),this._p2pChannel.on(Me.RequestP2PUnmuteRemote,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(o){o.code===j.DISCONNECT_P2P?t():n(o)}else t()}),this._p2pChannel.on(Me.RequestP2PMuteRemote,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.muteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(o){o.code===j.DISCONNECT_P2P?t():n(o)}else t()}),this._p2pChannel.on(Me.StateChange,(e,t)=>{t===kt.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(Me.PeerConnectionStateChange,e=>{const t=this._peerConnectionState;e!==t&&(this.safeEmit(mt.PEERCONNECTION_STATE_CHANGE,e,t),this._peerConnectionState=e)}),this._p2pChannel.on(Me.RequestMuteLocal,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.muteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(o){o.code===j.DISCONNECT_P2P?t():n(o)}else t()}),this._p2pChannel.on(Me.RequestUnmuteLocal,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(o){o.code===j.DISCONNECT_P2P?t():n(o)}else t()}),this._p2pChannel.on(Me.RequestRePublish,(e,t,n)=>{this.publish(e,!1).then(t).catch(n)}),this._p2pChannel.on(Me.RequestRePublishDataChannel,(e,t,n)=>{ye.all(e.map(async o=>{const s=await this._p2pChannel.publishDataChannel([o]);try{s.forEach(c=>{this._uid&&this._gateway.publishDataChannel(this._uid,c,!0)})}catch(c){if(c.code!==j.DISCONNECT_P2P)throw c}})).then(t).catch(n)}),this._p2pChannel.on(Me.RequestReSubscribe,async(e,t,n)=>{try{for(const{user:o,kind:s}of e)s===Re.VIDEO?await this.subscribe(o,"video"):await this.subscribe(o,"audio");t()}catch(o){n(o)}}),this._p2pChannel.on(Me.RequestUpload,(e,t)=>{this._gateway.upload(e,t)}),this._p2pChannel.on(Me.RequestUploadStats,e=>{this._gateway.uploadWRTCStats(e)}),this._p2pChannel.on(Me.MediaReconnectStart,e=>{this.safeEmit(mt.MEDIA_RECONNECT_START,e)}),this._p2pChannel.on(Me.MediaReconnectEnd,e=>{this.safeEmit(mt.MEDIA_RECONNECT_END,e)}),this._p2pChannel.on(Me.NeedSignalRTT,e=>{e(this._gateway.getSignalRTT())}),this._p2pChannel.on(Me.RequestRestartICE,async e=>{if(this.store.useP2P)return;const t=await this._p2pChannel.restartICE(e),n=await t.next();if(n.done)return;const o=n.value;let s;try{s=await this._gateway.restartICE({iceParameters:o})}catch(d){return void t.throw(d)}const{iceParameters:c}=function(d){const h=d.iceParameters;return{iceParameters:{iceUfrag:h.iceUfrag,icePwd:h.icePwd}}}(s);await t.next({remoteIceParameters:c})}),this._p2pChannel.on(Me.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(Me.RequestReconnectPC,async()=>{var e;const{iceParameters:t,dtlsParameters:n,rtpCapabilities:o}=await this._p2pChannel.startP2PConnection({turnServer:(e=this._joinInfo)===null||e===void 0?void 0:e.turnServer}),{gatewayEstablishParams:s,gatewayAddress:c}=await this._gateway.reconnectPC({iceParameters:t,dtlsParameters:n,rtpCapabilities:o}),d=tV(s,c);await this._p2pChannel.connect(d),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(Me.RequestUnpublishForReconnectPC,async(e,t,n)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(e,this._uid),t()):n()}),this._p2pChannel.on(Me.P2PLost,()=>{this.safeEmit(mt.P2P_LOST,this.store.uid)}),this._p2pChannel.on(Me.UpdateVideoEncoder,e=>{e._encoderConfig&&this._gateway.setVideoProfile(e._encoderConfig)}),this._p2pChannel.on(Me.ConnectionTypeChange,e=>{this.safeEmit(mt.IS_USING_CLOUD_PROXY,e)}),this._p2pChannel.on(Me.RequestLowStreamParameter,e=>{e(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(Me.QueryClientConnectionState,e=>{e(this.connectionState)}),this._p2pChannel.on(Me.AudioMetadata,e=>{this.safeEmit(mt.AUDIO_METADATA,e)})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(e){if(!this._joinInfo||this.connectionState!=="CONNECTED")throw new ee(j.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new ee(j.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{const n=(t={config:e},Ja("ContentInspect").create(t));this._inspect=n,this.handleVideoInspectEvents(n);const{appId:o,cname:s,sid:c,token:d,uid:h,cid:p,vid:m}=this._joinInfo;await n.init({appId:o,areaCode:"",cname:s,sid:c,token:d,uid:h,cid:p,vid:m?Number(m):0},Un)}catch(n){throw Array.isArray(n)?n[0]:n}var t}handleVideoInspectEvents(e){e.on(rr.CONNECTION_STATE_CHANGE,(t,n)=>{if(this.safeEmit(mt.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,t,n),n===Qo.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(mt.CONTENT_INSPECT_ERROR,new ee(j.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));e.inspectImage()}}),e.on(rr.INSPECT_RESULT,(t,n)=>{var o;if((n==null?void 0:n.code)===j.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return R.debug("Stop inspect content because that has left channel"),this==null||(o=this._inspect)===null||o===void 0||o.close(),void(this._inspect=void 0);this.safeEmit(mt.CONTENT_INSPECT_RESULT,t,n)}),e.on(rr.CLIENT_LOCAL_VIDEO_TRACK,t=>{t(this.localTracks.filter(n=>n.trackMediaType==="video")[0])})}async disableContentInspect(){if(!this._inspect)throw new ee(j.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(e){throw Array.isArray(e)?e[0]:e}}async setImageModeration(e,t){if(za(e,"enabled"),e){if(!t)throw new ee(j.INVALID_PARAMS,"config is required");if(EF(t),!this._joinInfo)throw new ee(j.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(t);else{const o=(n={config:t},Ja("ImageModeration").create(n));this._moderation=o,this.handleImageModerationEvents(o);const{appId:s,cname:c,sid:d,token:h,uid:p,cid:m,vid:g}=this._joinInfo;await o.init({appId:s,areaCode:"",cname:c,sid:d,token:h,uid:p,cid:m,vid:g?Number(g):0},Un)}}catch(o){throw Array.isArray(o)?o[0]:o}}else{var n;if(!this._moderation)throw new ee(j.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(o){throw Array.isArray(o)?o[0]:o}}}handleImageModerationEvents(e){e.on(Is.CONNECTION_STATE_CHANGE,(t,n)=>{if(this.safeEmit(mt.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,t,n),t===go.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new ee(j.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");e.inspectImage()}}),e.on(Is.CLIENT_LOCAL_VIDEO_TRACK,t=>{t(this.localTracks.filter(n=>n.trackMediaType==="video")[0])})}setP2PTransport(e){if(function(t){Kn(t,"transport",["default","auto","relay","sd-rtn"])}(e),this.mode!=="p2p")throw new ee(j.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=e,R.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(e))}getJoinChannelServiceRecords(){return R.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(e){za(e,"enabled"),jt("ENABLE_PUBLISH_AUDIO_FILTER",e),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(e)}_handleResetAddStream(e,t){switch(t){case"audio":e._audio_added_=!1,e._trust_audio_stream_added_state_=!0;break;case"video":e._video_added_=!1,e._trust_video_stream_added_state_=!0}}},Oe(Te.prototype,"leave",[vF],Object.getOwnPropertyDescriptor(Te.prototype,"leave"),Te.prototype),Oe(Te.prototype,"publish",[yF],Object.getOwnPropertyDescriptor(Te.prototype,"publish"),Te.prototype),Oe(Te.prototype,"unpublish",[SF],Object.getOwnPropertyDescriptor(Te.prototype,"unpublish"),Te.prototype),Oe(Te.prototype,"subscribe",[TF],Object.getOwnPropertyDescriptor(Te.prototype,"subscribe"),Te.prototype),Oe(Te.prototype,"presubscribe",[wF],Object.getOwnPropertyDescriptor(Te.prototype,"presubscribe"),Te.prototype),Oe(Te.prototype,"massSubscribe",[RF],Object.getOwnPropertyDescriptor(Te.prototype,"massSubscribe"),Te.prototype),Oe(Te.prototype,"unsubscribe",[CF],Object.getOwnPropertyDescriptor(Te.prototype,"unsubscribe"),Te.prototype),Oe(Te.prototype,"massUnsubscribe",[bF],Object.getOwnPropertyDescriptor(Te.prototype,"massUnsubscribe"),Te.prototype),Oe(Te.prototype,"setLowStreamParameter",[IF],Object.getOwnPropertyDescriptor(Te.prototype,"setLowStreamParameter"),Te.prototype),Oe(Te.prototype,"enableDualStream",[AF],Object.getOwnPropertyDescriptor(Te.prototype,"enableDualStream"),Te.prototype),Oe(Te.prototype,"disableDualStream",[NF],Object.getOwnPropertyDescriptor(Te.prototype,"disableDualStream"),Te.prototype),Oe(Te.prototype,"setClientRole",[OF],Object.getOwnPropertyDescriptor(Te.prototype,"setClientRole"),Te.prototype),Oe(Te.prototype,"_setClientRoleOptions",[PF],Object.getOwnPropertyDescriptor(Te.prototype,"_setClientRoleOptions"),Te.prototype),Oe(Te.prototype,"setProxyServer",[DF],Object.getOwnPropertyDescriptor(Te.prototype,"setProxyServer"),Te.prototype),Oe(Te.prototype,"setTurnServer",[kF],Object.getOwnPropertyDescriptor(Te.prototype,"setTurnServer"),Te.prototype),Oe(Te.prototype,"setLicense",[xF],Object.getOwnPropertyDescriptor(Te.prototype,"setLicense"),Te.prototype),Oe(Te.prototype,"startProxyServer",[LF],Object.getOwnPropertyDescriptor(Te.prototype,"startProxyServer"),Te.prototype),Oe(Te.prototype,"stopProxyServer",[MF],Object.getOwnPropertyDescriptor(Te.prototype,"stopProxyServer"),Te.prototype),Oe(Te.prototype,"setLocalAccessPointsV2",[UF],Object.getOwnPropertyDescriptor(Te.prototype,"setLocalAccessPointsV2"),Te.prototype),Oe(Te.prototype,"setLocalAccessPoints",[jF],Object.getOwnPropertyDescriptor(Te.prototype,"setLocalAccessPoints"),Te.prototype),Oe(Te.prototype,"setRemoteDefaultVideoStreamType",[VF],Object.getOwnPropertyDescriptor(Te.prototype,"setRemoteDefaultVideoStreamType"),Te.prototype),Oe(Te.prototype,"setRemoteVideoStreamType",[FF],Object.getOwnPropertyDescriptor(Te.prototype,"setRemoteVideoStreamType"),Te.prototype),Oe(Te.prototype,"setStreamFallbackOption",[BF],Object.getOwnPropertyDescriptor(Te.prototype,"setStreamFallbackOption"),Te.prototype),Oe(Te.prototype,"setEncryptionConfig",[WF],Object.getOwnPropertyDescriptor(Te.prototype,"setEncryptionConfig"),Te.prototype),Oe(Te.prototype,"renewToken",[HF],Object.getOwnPropertyDescriptor(Te.prototype,"renewToken"),Te.prototype),Oe(Te.prototype,"enableAudioVolumeIndicator",[GF],Object.getOwnPropertyDescriptor(Te.prototype,"enableAudioVolumeIndicator"),Te.prototype),Oe(Te.prototype,"startLiveStreaming",[zF],Object.getOwnPropertyDescriptor(Te.prototype,"startLiveStreaming"),Te.prototype),Oe(Te.prototype,"setLiveTranscoding",[KF],Object.getOwnPropertyDescriptor(Te.prototype,"setLiveTranscoding"),Te.prototype),Oe(Te.prototype,"stopLiveStreaming",[YF],Object.getOwnPropertyDescriptor(Te.prototype,"stopLiveStreaming"),Te.prototype),Oe(Te.prototype,"startChannelMediaRelay",[qF],Object.getOwnPropertyDescriptor(Te.prototype,"startChannelMediaRelay"),Te.prototype),Oe(Te.prototype,"updateChannelMediaRelay",[XF],Object.getOwnPropertyDescriptor(Te.prototype,"updateChannelMediaRelay"),Te.prototype),Oe(Te.prototype,"stopChannelMediaRelay",[$F],Object.getOwnPropertyDescriptor(Te.prototype,"stopChannelMediaRelay"),Te.prototype),Oe(Te.prototype,"sendCustomReportMessage",[JF],Object.getOwnPropertyDescriptor(Te.prototype,"sendCustomReportMessage"),Te.prototype),Oe(Te.prototype,"pickSVCLayer",[QF],Object.getOwnPropertyDescriptor(Te.prototype,"pickSVCLayer"),Te.prototype),Oe(Te.prototype,"setRTMConfig",[ZF],Object.getOwnPropertyDescriptor(Te.prototype,"setRTMConfig"),Te.prototype),Oe(Te.prototype,"enableContentInspect",[e4],Object.getOwnPropertyDescriptor(Te.prototype,"enableContentInspect"),Te.prototype),Oe(Te.prototype,"disableContentInspect",[t4],Object.getOwnPropertyDescriptor(Te.prototype,"disableContentInspect"),Te.prototype),Oe(Te.prototype,"setImageModeration",[n4],Object.getOwnPropertyDescriptor(Te.prototype,"setImageModeration"),Te.prototype),Oe(Te.prototype,"setP2PTransport",[r4],Object.getOwnPropertyDescriptor(Te.prototype,"setP2PTransport"),Te.prototype),Oe(Te.prototype,"getJoinChannelServiceRecords",[i4],Object.getOwnPropertyDescriptor(Te.prototype,"getJoinChannelServiceRecords"),Te.prototype),Oe(Te.prototype,"setPublishAudioFilterEnabled",[o4],Object.getOwnPropertyDescriptor(Te.prototype,"setPublishAudioFilterEnabled"),Te.prototype),Te);class im{constructor(t,n){x(this,"id",0),x(this,"element",void 0),x(this,"peerPair",void 0),x(this,"context",void 0),x(this,"audioPlayerElement",void 0),x(this,"audioTrack",void 0),im.count+=1,this.id=im.count,this.element=t,this.context=n}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=t=>{const n=document.createElement("audio");n.srcObject=new MediaStream([t.track]),n.play(),this.audioPlayerElement=n}}async switchSdp(){if(!this.peerPair)return;const t=async(o,s)=>{const c=s==="offer"?await o.createOffer():await o.createAnswer();return await o.setLocalDescription(c),o.iceGatheringState==="complete"?o.localDescription:new ye(d=>{o.onicegatheringstatechange=()=>{o.iceGatheringState==="complete"&&d(o.localDescription)}})},n=async(o,s)=>await o.setRemoteDescription(s);try{const o=await t(this.peerPair[0],"offer");await n(this.peerPair[1],o);const s=await t(this.peerPair[1],"answer");await n(this.peerPair[0],s)}catch(o){throw new ee(j.LOCAL_AEC_ERROR,o.toString()).print()}}async getTracksFromMediaElement(t){if(this.audioTrack)return this.audioTrack;let n;try{t instanceof HTMLVideoElement&&(t.captureStream?t.captureStream():t.mozCaptureStream()),n=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(t).connect(n)}catch(s){throw new ee(j.LOCAL_AEC_ERROR,s.toString()).print()}if(!n)throw new ee(j.LOCAL_AEC_ERROR,"no dest node when local aec").print();const o=n.stream.getAudioTracks()[0];return this.audioTrack=o,o}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const t=this.element,n=await this.getTracksFromMediaElement(t);this.peerPair&&this.peerPair[0].addTrack(n),await this.switchSdp()}close(){R.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(t=>{t.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var a4,Tv;x(im,"count",0);const Lse=window.AudioContext||window.webkitAudioContext,Mse=new(a4=He({report:ke}),Oe((Tv=class{constructor(){x(this,"units",[]),x(this,"context",void 0)}processExternalMediaAEC(e){if(!this._doesEnvironmentNeedAEC())return R.debug("the system does not need to process local aec"),-1;this.context||(this.context=new Lse);let t=this.units.find(n=>n&&n.getElement()===e);return t||(t=new im(e,this.context),this.units.push(t)),t.startEchoCancellation(),R.debug("start processing local audio echo cancellation, id is",t.id),t.id}_doesEnvironmentNeedAEC(){return wt().name!==Ot.SAFARI}}).prototype,"processExternalMediaAEC",[a4],Object.getOwnPropertyDescriptor(Tv.prototype,"processExternalMediaAEC"),Tv.prototype),Tv);function c4(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,o)}return n}function l4(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?c4(Object(n),!0).forEach(function(o){x(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c4(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}const tb=window||document;function d4(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!tb)return;const n=jn._cspEventHandlerPointer;if(n&&t)return void console.error(n,t);const o=s=>{if(!(s&&s.blockedURI&&(jn.onSecurityPolicyViolation||jn.getListeners(ua.SECURITY_POLICY_VIOLATION).length>0)))return;const c=s.blockedURI;H("CSP_DETECTED_HOSTNAME_LIST").some(d=>Ee(c).call(c,d))&&(jn.onSecurityPolicyViolation&&typeof jn.onSecurityPolicyViolation=="function"&&jn.onSecurityPolicyViolation(s),jn.getListeners(ua.SECURITY_POLICY_VIOLATION).length>0&&jn.safeEmit(ua.SECURITY_POLICY_VIOLATION,s))};n&&tb.removeEventListener("securitypolicyviolation",n),(t||e&&typeof e=="function"||jn.getListeners(ua.SECURITY_POLICY_VIOLATION).length>0)&&tb.addEventListener("securitypolicyviolation",o),jn._cspEventHandlerPointer=o}var Use=O,jse=YL,u4=RegExp.prototype,Vse=function(e){return e===u4||Use(u4,e)?jse(e):e.flags},Kr=u(Vse);function Ah(e){let t=e.length;for(;--t>=0;)e[t]=0}const nb=256,h4=286,om=30,sm=15,rb=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),wv=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Fse=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),p4=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Za=new Array(576);Ah(Za);const am=new Array(60);Ah(am);const cm=new Array(512);Ah(cm);const lm=new Array(256);Ah(lm);const ib=new Array(29);Ah(ib);const Rv=new Array(om);function ob(e,t,n,o,s){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=o,this.max_length=s,this.has_stree=e&&e.length}let f4,m4,g4;function sb(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}Ah(Rv);const _4=e=>e<256?cm[e]:cm[256+(e>>>7)],dm=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},ro=(e,t,n)=>{e.bi_valid>16-n?(e.bi_buf|=t<<e.bi_valid&65535,dm(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=n-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)},ga=(e,t,n)=>{ro(e,n[2*t],n[2*t+1])},E4=(e,t)=>{let n=0;do n|=1&e,e>>>=1,n<<=1;while(--t>0);return n>>>1},v4=(e,t,n)=>{const o=new Array(16);let s,c,d=0;for(s=1;s<=sm;s++)d=d+n[s-1]<<1,o[s]=d;for(c=0;c<=t;c++){let h=e[2*c+1];h!==0&&(e[2*c]=E4(o[h]++,h))}},y4=e=>{let t;for(t=0;t<h4;t++)e.dyn_ltree[2*t]=0;for(t=0;t<om;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},S4=e=>{e.bi_valid>8?dm(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},T4=(e,t,n,o)=>{const s=2*t,c=2*n;return e[s]<e[c]||e[s]===e[c]&&o[t]<=o[n]},ab=(e,t,n)=>{const o=e.heap[n];let s=n<<1;for(;s<=e.heap_len&&(s<e.heap_len&&T4(t,e.heap[s+1],e.heap[s],e.depth)&&s++,!T4(t,o,e.heap[s],e.depth));)e.heap[n]=e.heap[s],n=s,s<<=1;e.heap[n]=o},w4=(e,t,n)=>{let o,s,c,d,h=0;if(e.sym_next!==0)do o=255&e.pending_buf[e.sym_buf+h++],o+=(255&e.pending_buf[e.sym_buf+h++])<<8,s=e.pending_buf[e.sym_buf+h++],o===0?ga(e,s,t):(c=lm[s],ga(e,c+nb+1,t),d=rb[c],d!==0&&(s-=ib[c],ro(e,s,d)),o--,c=_4(o),ga(e,c,n),d=wv[c],d!==0&&(o-=Rv[c],ro(e,o,d)));while(h<e.sym_next);ga(e,256,t)},cb=(e,t)=>{const n=t.dyn_tree,o=t.stat_desc.static_tree,s=t.stat_desc.has_stree,c=t.stat_desc.elems;let d,h,p,m=-1;for(e.heap_len=0,e.heap_max=573,d=0;d<c;d++)n[2*d]!==0?(e.heap[++e.heap_len]=m=d,e.depth[d]=0):n[2*d+1]=0;for(;e.heap_len<2;)p=e.heap[++e.heap_len]=m<2?++m:0,n[2*p]=1,e.depth[p]=0,e.opt_len--,s&&(e.static_len-=o[2*p+1]);for(t.max_code=m,d=e.heap_len>>1;d>=1;d--)ab(e,n,d);p=c;do d=e.heap[1],e.heap[1]=e.heap[e.heap_len--],ab(e,n,1),h=e.heap[1],e.heap[--e.heap_max]=d,e.heap[--e.heap_max]=h,n[2*p]=n[2*d]+n[2*h],e.depth[p]=(e.depth[d]>=e.depth[h]?e.depth[d]:e.depth[h])+1,n[2*d+1]=n[2*h+1]=p,e.heap[1]=p++,ab(e,n,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((g,E)=>{const y=E.dyn_tree,T=E.max_code,P=E.stat_desc.static_tree,I=E.stat_desc.has_stree,A=E.stat_desc.extra_bits,M=E.stat_desc.extra_base,U=E.stat_desc.max_length;let Y,Q,J,X,ne,oe,me=0;for(X=0;X<=sm;X++)g.bl_count[X]=0;for(y[2*g.heap[g.heap_max]+1]=0,Y=g.heap_max+1;Y<573;Y++)Q=g.heap[Y],X=y[2*y[2*Q+1]+1]+1,X>U&&(X=U,me++),y[2*Q+1]=X,Q>T||(g.bl_count[X]++,ne=0,Q>=M&&(ne=A[Q-M]),oe=y[2*Q],g.opt_len+=oe*(X+ne),I&&(g.static_len+=oe*(P[2*Q+1]+ne)));if(me!==0){do{for(X=U-1;g.bl_count[X]===0;)X--;g.bl_count[X]--,g.bl_count[X+1]+=2,g.bl_count[U]--,me-=2}while(me>0);for(X=U;X!==0;X--)for(Q=g.bl_count[X];Q!==0;)J=g.heap[--Y],J>T||(y[2*J+1]!==X&&(g.opt_len+=(X-y[2*J+1])*y[2*J],y[2*J+1]=X),Q--)}})(e,t),v4(n,m,e.bl_count)},R4=(e,t,n)=>{let o,s,c=-1,d=t[1],h=0,p=7,m=4;for(d===0&&(p=138,m=3),t[2*(n+1)+1]=65535,o=0;o<=n;o++)s=d,d=t[2*(o+1)+1],++h<p&&s===d||(h<m?e.bl_tree[2*s]+=h:s!==0?(s!==c&&e.bl_tree[2*s]++,e.bl_tree[32]++):h<=10?e.bl_tree[34]++:e.bl_tree[36]++,h=0,c=s,d===0?(p=138,m=3):s===d?(p=6,m=3):(p=7,m=4))},C4=(e,t,n)=>{let o,s,c=-1,d=t[1],h=0,p=7,m=4;for(d===0&&(p=138,m=3),o=0;o<=n;o++)if(s=d,d=t[2*(o+1)+1],!(++h<p&&s===d)){if(h<m)do ga(e,s,e.bl_tree);while(--h!=0);else s!==0?(s!==c&&(ga(e,s,e.bl_tree),h--),ga(e,16,e.bl_tree),ro(e,h-3,2)):h<=10?(ga(e,17,e.bl_tree),ro(e,h-3,3)):(ga(e,18,e.bl_tree),ro(e,h-11,7));h=0,c=s,d===0?(p=138,m=3):s===d?(p=6,m=3):(p=7,m=4)}};let b4=!1;const I4=(e,t,n,o)=>{ro(e,0+(o?1:0),3),S4(e),dm(e,n),dm(e,~n),n&&e.pending_buf.set(e.window.subarray(t,t+n),e.pending),e.pending+=n};var Bse=e=>{b4||((()=>{let t,n,o,s,c;const d=new Array(16);for(o=0,s=0;s<28;s++)for(ib[s]=o,t=0;t<1<<rb[s];t++)lm[o++]=s;for(lm[o-1]=s,c=0,s=0;s<16;s++)for(Rv[s]=c,t=0;t<1<<wv[s];t++)cm[c++]=s;for(c>>=7;s<om;s++)for(Rv[s]=c<<7,t=0;t<1<<wv[s]-7;t++)cm[256+c++]=s;for(n=0;n<=sm;n++)d[n]=0;for(t=0;t<=143;)Za[2*t+1]=8,t++,d[8]++;for(;t<=255;)Za[2*t+1]=9,t++,d[9]++;for(;t<=279;)Za[2*t+1]=7,t++,d[7]++;for(;t<=287;)Za[2*t+1]=8,t++,d[8]++;for(v4(Za,287,d),t=0;t<om;t++)am[2*t+1]=5,am[2*t]=E4(t,5);f4=new ob(Za,rb,257,h4,sm),m4=new ob(am,wv,0,om,sm),g4=new ob(new Array(0),Fse,0,19,7)})(),b4=!0),e.l_desc=new sb(e.dyn_ltree,f4),e.d_desc=new sb(e.dyn_dtree,m4),e.bl_desc=new sb(e.bl_tree,g4),e.bi_buf=0,e.bi_valid=0,y4(e)},Wse=(e,t,n,o)=>{let s,c,d=0;e.level>0?(e.strm.data_type===2&&(e.strm.data_type=(h=>{let p,m=4093624447;for(p=0;p<=31;p++,m>>>=1)if(1&m&&h.dyn_ltree[2*p]!==0)return 0;if(h.dyn_ltree[18]!==0||h.dyn_ltree[20]!==0||h.dyn_ltree[26]!==0)return 1;for(p=32;p<nb;p++)if(h.dyn_ltree[2*p]!==0)return 1;return 0})(e)),cb(e,e.l_desc),cb(e,e.d_desc),d=(h=>{let p;for(R4(h,h.dyn_ltree,h.l_desc.max_code),R4(h,h.dyn_dtree,h.d_desc.max_code),cb(h,h.bl_desc),p=18;p>=3&&h.bl_tree[2*p4[p]+1]===0;p--);return h.opt_len+=3*(p+1)+5+5+4,p})(e),s=e.opt_len+3+7>>>3,c=e.static_len+3+7>>>3,c<=s&&(s=c)):s=c=n+5,n+4<=s&&t!==-1?I4(e,t,n,o):e.strategy===4||c===s?(ro(e,2+(o?1:0),3),w4(e,Za,am)):(ro(e,4+(o?1:0),3),((h,p,m,g)=>{let E;for(ro(h,p-257,5),ro(h,m-1,5),ro(h,g-4,4),E=0;E<g;E++)ro(h,h.bl_tree[2*p4[E]+1],3);C4(h,h.dyn_ltree,p-1),C4(h,h.dyn_dtree,m-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,d+1),w4(e,e.dyn_ltree,e.dyn_dtree)),y4(e),o&&S4(e)},Hse=(e,t,n)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=n,t===0?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(lm[n]+nb+1)]++,e.dyn_dtree[2*_4(t)]++),e.sym_next===e.sym_end),Gse=e=>{ro(e,2,3),ga(e,256,Za),(t=>{t.bi_valid===16?(dm(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)})(e)},zse={_tr_init:Bse,_tr_stored_block:I4,_tr_flush_block:Wse,_tr_tally:Hse,_tr_align:Gse},um=(e,t,n,o)=>{let s=65535&e|0,c=e>>>16&65535|0,d=0;for(;n!==0;){d=n>2e3?2e3:n,n-=d;do s=s+t[o++]|0,c=c+s|0;while(--d);s%=65521,c%=65521}return s|c<<16|0};const Kse=new Uint32Array((()=>{let e,t=[];for(var n=0;n<256;n++){e=n;for(var o=0;o<8;o++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t})());var ni=(e,t,n,o)=>{const s=Kse,c=o+n;e^=-1;for(let d=o;d<c;d++)e=e>>>8^s[255&(e^t[d])];return-1^e},vd={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Nh={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:Yse,_tr_stored_block:lb,_tr_flush_block:qse,_tr_tally:zc,_tr_align:Xse}=zse,{Z_NO_FLUSH:Kc,Z_PARTIAL_FLUSH:$se,Z_FULL_FLUSH:Jse,Z_FINISH:is,Z_BLOCK:A4,Z_OK:li,Z_STREAM_END:N4,Z_STREAM_ERROR:_a,Z_DATA_ERROR:Qse,Z_BUF_ERROR:db,Z_DEFAULT_COMPRESSION:Zse,Z_FILTERED:eae,Z_HUFFMAN_ONLY:Cv,Z_RLE:tae,Z_FIXED:nae,Z_DEFAULT_STRATEGY:rae,Z_UNKNOWN:iae,Z_DEFLATED:bv}=Nh,ub=286,oae=30,sae=19,aae=2*ub+1,cae=15,yd=258,Ea=262,Oh=42,Sd=113,hm=666,Td=(e,t)=>(e.msg=vd[t],t),O4=e=>2*e-(e>4?9:0),Yc=e=>{let t=e.length;for(;--t>=0;)e[t]=0},lae=e=>{let t,n,o,s=e.w_size;t=e.hash_size,o=t;do n=e.head[--o],e.head[o]=n>=s?n-s:0;while(--t);t=s,o=t;do n=e.prev[--o],e.prev[o]=n>=s?n-s:0;while(--t)};let qc=(e,t,n)=>(t<<e.hash_shift^n)&e.hash_mask;const _o=e=>{const t=e.state;let n=t.pending;n>e.avail_out&&(n=e.avail_out),n!==0&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+n),e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,t.pending===0&&(t.pending_out=0))},Eo=(e,t)=>{qse(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,_o(e.strm)},Cn=(e,t)=>{e.pending_buf[e.pending++]=t},pm=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},hb=(e,t,n,o)=>{let s=e.avail_in;return s>o&&(s=o),s===0?0:(e.avail_in-=s,t.set(e.input.subarray(e.next_in,e.next_in+s),n),e.state.wrap===1?e.adler=um(e.adler,t,s,n):e.state.wrap===2&&(e.adler=ni(e.adler,t,s,n)),e.next_in+=s,e.total_in+=s,s)},P4=(e,t)=>{let n,o,s=e.max_chain_length,c=e.strstart,d=e.prev_length,h=e.nice_match;const p=e.strstart>e.w_size-Ea?e.strstart-(e.w_size-Ea):0,m=e.window,g=e.w_mask,E=e.prev,y=e.strstart+yd;let T=m[c+d-1],P=m[c+d];e.prev_length>=e.good_match&&(s>>=2),h>e.lookahead&&(h=e.lookahead);do if(n=t,m[n+d]===P&&m[n+d-1]===T&&m[n]===m[c]&&m[++n]===m[c+1]){c+=2,n++;do;while(m[++c]===m[++n]&&m[++c]===m[++n]&&m[++c]===m[++n]&&m[++c]===m[++n]&&m[++c]===m[++n]&&m[++c]===m[++n]&&m[++c]===m[++n]&&m[++c]===m[++n]&&c<y);if(o=yd-(y-c),c=y-yd,o>d){if(e.match_start=t,d=o,o>=h)break;T=m[c+d-1],P=m[c+d]}}while((t=E[t&g])>p&&--s!=0);return d<=e.lookahead?d:e.lookahead},Ph=e=>{const t=e.w_size;let n,o,s;do{if(o=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-Ea)&&(e.window.set(e.window.subarray(t,t+t-o),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),lae(e),o+=t),e.strm.avail_in===0)break;if(n=hb(e.strm,e.window,e.strstart+e.lookahead,o),e.lookahead+=n,e.lookahead+e.insert>=3)for(s=e.strstart-e.insert,e.ins_h=e.window[s],e.ins_h=qc(e,e.ins_h,e.window[s+1]);e.insert&&(e.ins_h=qc(e,e.ins_h,e.window[s+3-1]),e.prev[s&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=s,s++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<Ea&&e.strm.avail_in!==0)},D4=(e,t)=>{let n,o,s,c=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,d=0,h=e.strm.avail_in;do{if(n=65535,s=e.bi_valid+42>>3,e.strm.avail_out<s||(s=e.strm.avail_out-s,o=e.strstart-e.block_start,n>o+e.strm.avail_in&&(n=o+e.strm.avail_in),n>s&&(n=s),n<c&&(n===0&&t!==is||t===Kc||n!==o+e.strm.avail_in)))break;d=t===is&&n===o+e.strm.avail_in?1:0,lb(e,0,0,d),e.pending_buf[e.pending-4]=n,e.pending_buf[e.pending-3]=n>>8,e.pending_buf[e.pending-2]=~n,e.pending_buf[e.pending-1]=~n>>8,_o(e.strm),o&&(o>n&&(o=n),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+o),e.strm.next_out),e.strm.next_out+=o,e.strm.avail_out-=o,e.strm.total_out+=o,e.block_start+=o,n-=o),n&&(hb(e.strm,e.strm.output,e.strm.next_out,n),e.strm.next_out+=n,e.strm.avail_out-=n,e.strm.total_out+=n)}while(d===0);return h-=e.strm.avail_in,h&&(h>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=h&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-h,e.strm.next_in),e.strstart),e.strstart+=h,e.insert+=h>e.w_size-e.insert?e.w_size-e.insert:h),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),d?4:t!==Kc&&t!==is&&e.strm.avail_in===0&&e.strstart===e.block_start?2:(s=e.window_size-e.strstart,e.strm.avail_in>s&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,s+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),s>e.strm.avail_in&&(s=e.strm.avail_in),s&&(hb(e.strm,e.window,e.strstart,s),e.strstart+=s,e.insert+=s>e.w_size-e.insert?e.w_size-e.insert:s),e.high_water<e.strstart&&(e.high_water=e.strstart),s=e.bi_valid+42>>3,s=e.pending_buf_size-s>65535?65535:e.pending_buf_size-s,c=s>e.w_size?e.w_size:s,o=e.strstart-e.block_start,(o>=c||(o||t===is)&&t!==Kc&&e.strm.avail_in===0&&o<=s)&&(n=o>s?s:o,d=t===is&&e.strm.avail_in===0&&n===o?1:0,lb(e,e.block_start,n,d),e.block_start+=n,_o(e.strm)),d?3:1)},pb=(e,t)=>{let n,o;for(;;){if(e.lookahead<Ea){if(Ph(e),e.lookahead<Ea&&t===Kc)return 1;if(e.lookahead===0)break}if(n=0,e.lookahead>=3&&(e.ins_h=qc(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),n!==0&&e.strstart-n<=e.w_size-Ea&&(e.match_length=P4(e,n)),e.match_length>=3)if(o=zc(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do e.strstart++,e.ins_h=qc(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(--e.match_length!=0);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=qc(e,e.ins_h,e.window[e.strstart+1]);else o=zc(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(o&&(Eo(e,!1),e.strm.avail_out===0))return 1}return e.insert=e.strstart<2?e.strstart:2,t===is?(Eo(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(Eo(e,!1),e.strm.avail_out===0)?1:2},Dh=(e,t)=>{let n,o,s;for(;;){if(e.lookahead<Ea){if(Ph(e),e.lookahead<Ea&&t===Kc)return 1;if(e.lookahead===0)break}if(n=0,e.lookahead>=3&&(e.ins_h=qc(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,n!==0&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-Ea&&(e.match_length=P4(e,n),e.match_length<=5&&(e.strategy===eae||e.match_length===3&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){s=e.strstart+e.lookahead-3,o=zc(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=s&&(e.ins_h=qc(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(--e.prev_length!=0);if(e.match_available=0,e.match_length=2,e.strstart++,o&&(Eo(e,!1),e.strm.avail_out===0))return 1}else if(e.match_available){if(o=zc(e,0,e.window[e.strstart-1]),o&&Eo(e,!1),e.strstart++,e.lookahead--,e.strm.avail_out===0)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(o=zc(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===is?(Eo(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(Eo(e,!1),e.strm.avail_out===0)?1:2};function va(e,t,n,o,s){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=o,this.func=s}const fm=[new va(0,0,0,0,D4),new va(4,4,8,4,pb),new va(4,5,16,8,pb),new va(4,6,32,32,pb),new va(4,4,16,16,Dh),new va(8,16,32,32,Dh),new va(8,16,128,128,Dh),new va(8,32,128,256,Dh),new va(32,128,258,1024,Dh),new va(32,258,258,4096,Dh)];function dae(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=bv,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*aae),this.dyn_dtree=new Uint16Array(2*(2*oae+1)),this.bl_tree=new Uint16Array(2*(2*sae+1)),Yc(this.dyn_ltree),Yc(this.dyn_dtree),Yc(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(cae+1),this.heap=new Uint16Array(2*ub+1),Yc(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*ub+1),Yc(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const mm=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.status!==Oh&&t.status!==57&&t.status!==69&&t.status!==73&&t.status!==91&&t.status!==103&&t.status!==Sd&&t.status!==hm?1:0},k4=e=>{if(mm(e))return Td(e,_a);e.total_in=e.total_out=0,e.data_type=iae;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap===2?57:t.wrap?Oh:Sd,e.adler=t.wrap===2?0:1,t.last_flush=-2,Yse(t),li},x4=e=>{const t=k4(e);return t===li&&(n=>{n.window_size=2*n.w_size,Yc(n.head),n.max_lazy_match=fm[n.level].max_lazy,n.good_match=fm[n.level].good_length,n.nice_match=fm[n.level].nice_length,n.max_chain_length=fm[n.level].max_chain,n.strstart=0,n.block_start=0,n.lookahead=0,n.insert=0,n.match_length=n.prev_length=2,n.match_available=0,n.ins_h=0})(e.state),t},L4=(e,t,n,o,s,c)=>{if(!e)return _a;let d=1;if(t===Zse&&(t=6),o<0?(d=0,o=-o):o>15&&(d=2,o-=16),s<1||s>9||n!==bv||o<8||o>15||t<0||t>9||c<0||c>nae||o===8&&d!==1)return Td(e,_a);o===8&&(o=9);const h=new dae;return e.state=h,h.strm=e,h.status=Oh,h.wrap=d,h.gzhead=null,h.w_bits=o,h.w_size=1<<h.w_bits,h.w_mask=h.w_size-1,h.hash_bits=s+7,h.hash_size=1<<h.hash_bits,h.hash_mask=h.hash_size-1,h.hash_shift=~~((h.hash_bits+3-1)/3),h.window=new Uint8Array(2*h.w_size),h.head=new Uint16Array(h.hash_size),h.prev=new Uint16Array(h.w_size),h.lit_bufsize=1<<s+6,h.pending_buf_size=4*h.lit_bufsize,h.pending_buf=new Uint8Array(h.pending_buf_size),h.sym_buf=h.lit_bufsize,h.sym_end=3*(h.lit_bufsize-1),h.level=t,h.strategy=c,h.method=n,x4(e)};var uae=(e,t)=>{if(mm(e)||t>A4||t<0)return e?Td(e,_a):_a;const n=e.state;if(!e.output||e.avail_in!==0&&!e.input||n.status===hm&&t!==is)return Td(e,e.avail_out===0?db:_a);const o=n.last_flush;if(n.last_flush=t,n.pending!==0){if(_o(e),e.avail_out===0)return n.last_flush=-1,li}else if(e.avail_in===0&&O4(t)<=O4(o)&&t!==is)return Td(e,db);if(n.status===hm&&e.avail_in!==0)return Td(e,db);if(n.status===Oh&&n.wrap===0&&(n.status=Sd),n.status===Oh){let s=bv+(n.w_bits-8<<4)<<8,c=-1;if(c=n.strategy>=Cv||n.level<2?0:n.level<6?1:n.level===6?2:3,s|=c<<6,n.strstart!==0&&(s|=32),s+=31-s%31,pm(n,s),n.strstart!==0&&(pm(n,e.adler>>>16),pm(n,65535&e.adler)),e.adler=1,n.status=Sd,_o(e),n.pending!==0)return n.last_flush=-1,li}if(n.status===57){if(e.adler=0,Cn(n,31),Cn(n,139),Cn(n,8),n.gzhead)Cn(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),Cn(n,255&n.gzhead.time),Cn(n,n.gzhead.time>>8&255),Cn(n,n.gzhead.time>>16&255),Cn(n,n.gzhead.time>>24&255),Cn(n,n.level===9?2:n.strategy>=Cv||n.level<2?4:0),Cn(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(Cn(n,255&n.gzhead.extra.length),Cn(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(e.adler=ni(e.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69;else if(Cn(n,0),Cn(n,0),Cn(n,0),Cn(n,0),Cn(n,0),Cn(n,n.level===9?2:n.strategy>=Cv||n.level<2?4:0),Cn(n,3),n.status=Sd,_o(e),n.pending!==0)return n.last_flush=-1,li}if(n.status===69){if(n.gzhead.extra){let s=n.pending,c=(65535&n.gzhead.extra.length)-n.gzindex;for(;n.pending+c>n.pending_buf_size;){let h=n.pending_buf_size-n.pending;if(n.pending_buf.set(n.gzhead.extra.subarray(n.gzindex,n.gzindex+h),n.pending),n.pending=n.pending_buf_size,n.gzhead.hcrc&&n.pending>s&&(e.adler=ni(e.adler,n.pending_buf,n.pending-s,s)),n.gzindex+=h,_o(e),n.pending!==0)return n.last_flush=-1,li;s=0,c-=h}let d=new Uint8Array(n.gzhead.extra);n.pending_buf.set(d.subarray(n.gzindex,n.gzindex+c),n.pending),n.pending+=c,n.gzhead.hcrc&&n.pending>s&&(e.adler=ni(e.adler,n.pending_buf,n.pending-s,s)),n.gzindex=0}n.status=73}if(n.status===73){if(n.gzhead.name){let s,c=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>c&&(e.adler=ni(e.adler,n.pending_buf,n.pending-c,c)),_o(e),n.pending!==0)return n.last_flush=-1,li;c=0}s=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,Cn(n,s)}while(s!==0);n.gzhead.hcrc&&n.pending>c&&(e.adler=ni(e.adler,n.pending_buf,n.pending-c,c)),n.gzindex=0}n.status=91}if(n.status===91){if(n.gzhead.comment){let s,c=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>c&&(e.adler=ni(e.adler,n.pending_buf,n.pending-c,c)),_o(e),n.pending!==0)return n.last_flush=-1,li;c=0}s=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,Cn(n,s)}while(s!==0);n.gzhead.hcrc&&n.pending>c&&(e.adler=ni(e.adler,n.pending_buf,n.pending-c,c))}n.status=103}if(n.status===103){if(n.gzhead.hcrc){if(n.pending+2>n.pending_buf_size&&(_o(e),n.pending!==0))return n.last_flush=-1,li;Cn(n,255&e.adler),Cn(n,e.adler>>8&255),e.adler=0}if(n.status=Sd,_o(e),n.pending!==0)return n.last_flush=-1,li}if(e.avail_in!==0||n.lookahead!==0||t!==Kc&&n.status!==hm){let s=n.level===0?D4(n,t):n.strategy===Cv?((c,d)=>{let h;for(;;){if(c.lookahead===0&&(Ph(c),c.lookahead===0)){if(d===Kc)return 1;break}if(c.match_length=0,h=zc(c,0,c.window[c.strstart]),c.lookahead--,c.strstart++,h&&(Eo(c,!1),c.strm.avail_out===0))return 1}return c.insert=0,d===is?(Eo(c,!0),c.strm.avail_out===0?3:4):c.sym_next&&(Eo(c,!1),c.strm.avail_out===0)?1:2})(n,t):n.strategy===tae?((c,d)=>{let h,p,m,g;const E=c.window;for(;;){if(c.lookahead<=yd){if(Ph(c),c.lookahead<=yd&&d===Kc)return 1;if(c.lookahead===0)break}if(c.match_length=0,c.lookahead>=3&&c.strstart>0&&(m=c.strstart-1,p=E[m],p===E[++m]&&p===E[++m]&&p===E[++m])){g=c.strstart+yd;do;while(p===E[++m]&&p===E[++m]&&p===E[++m]&&p===E[++m]&&p===E[++m]&&p===E[++m]&&p===E[++m]&&p===E[++m]&&m<g);c.match_length=yd-(g-m),c.match_length>c.lookahead&&(c.match_length=c.lookahead)}if(c.match_length>=3?(h=zc(c,1,c.match_length-3),c.lookahead-=c.match_length,c.strstart+=c.match_length,c.match_length=0):(h=zc(c,0,c.window[c.strstart]),c.lookahead--,c.strstart++),h&&(Eo(c,!1),c.strm.avail_out===0))return 1}return c.insert=0,d===is?(Eo(c,!0),c.strm.avail_out===0?3:4):c.sym_next&&(Eo(c,!1),c.strm.avail_out===0)?1:2})(n,t):fm[n.level].func(n,t);if(s!==3&&s!==4||(n.status=hm),s===1||s===3)return e.avail_out===0&&(n.last_flush=-1),li;if(s===2&&(t===$se?Xse(n):t!==A4&&(lb(n,0,0,!1),t===Jse&&(Yc(n.head),n.lookahead===0&&(n.strstart=0,n.block_start=0,n.insert=0))),_o(e),e.avail_out===0))return n.last_flush=-1,li}return t!==is?li:n.wrap<=0?N4:(n.wrap===2?(Cn(n,255&e.adler),Cn(n,e.adler>>8&255),Cn(n,e.adler>>16&255),Cn(n,e.adler>>24&255),Cn(n,255&e.total_in),Cn(n,e.total_in>>8&255),Cn(n,e.total_in>>16&255),Cn(n,e.total_in>>24&255)):(pm(n,e.adler>>>16),pm(n,65535&e.adler)),_o(e),n.wrap>0&&(n.wrap=-n.wrap),n.pending!==0?li:N4)},hae=(e,t)=>{let n=t.length;if(mm(e))return _a;const o=e.state,s=o.wrap;if(s===2||s===1&&o.status!==Oh||o.lookahead)return _a;if(s===1&&(e.adler=um(e.adler,t,n,0)),o.wrap=0,n>=o.w_size){s===0&&(Yc(o.head),o.strstart=0,o.block_start=0,o.insert=0);let p=new Uint8Array(o.w_size);p.set(t.subarray(n-o.w_size,n),0),t=p,n=o.w_size}const c=e.avail_in,d=e.next_in,h=e.input;for(e.avail_in=n,e.next_in=0,e.input=t,Ph(o);o.lookahead>=3;){let p=o.strstart,m=o.lookahead-2;do o.ins_h=qc(o,o.ins_h,o.window[p+3-1]),o.prev[p&o.w_mask]=o.head[o.ins_h],o.head[o.ins_h]=p,p++;while(--m);o.strstart=p,o.lookahead=2,Ph(o)}return o.strstart+=o.lookahead,o.block_start=o.strstart,o.insert=o.lookahead,o.lookahead=0,o.match_length=o.prev_length=2,o.match_available=0,e.next_in=d,e.input=h,e.avail_in=c,o.wrap=s,li},gm={deflateInit:(e,t)=>L4(e,t,bv,15,8,rae),deflateInit2:L4,deflateReset:x4,deflateResetKeep:k4,deflateSetHeader:(e,t)=>mm(e)||e.state.wrap!==2?_a:(e.state.gzhead=t,li),deflate:uae,deflateEnd:e=>{if(mm(e))return _a;const t=e.state.status;return e.state=null,t===Sd?Td(e,Qse):li},deflateSetDictionary:hae,deflateInfo:"pako deflate (from Nodeca project)"};const pae=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var Iv={assign:function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const n=t.shift();if(n){if(typeof n!="object")throw new TypeError(n+"must be non-object");for(const o in n)pae(n,o)&&(e[o]=n[o])}}return e},flattenChunks:e=>{let t=0;for(let o=0,s=e.length;o<s;o++)t+=e[o].length;const n=new Uint8Array(t);for(let o=0,s=0,c=e.length;o<c;o++){let d=e[o];n.set(d,s),s+=d.length}return n}};let M4=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{M4=!1}const _m=new Uint8Array(256);for(let e=0;e<256;e++)_m[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;_m[254]=_m[254]=1;var Em={string2buf:e=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(e);let t,n,o,s,c,d=e.length,h=0;for(s=0;s<d;s++)n=e.charCodeAt(s),(64512&n)==55296&&s+1<d&&(o=e.charCodeAt(s+1),(64512&o)==56320&&(n=65536+(n-55296<<10)+(o-56320),s++)),h+=n<128?1:n<2048?2:n<65536?3:4;for(t=new Uint8Array(h),c=0,s=0;c<h;s++)n=e.charCodeAt(s),(64512&n)==55296&&s+1<d&&(o=e.charCodeAt(s+1),(64512&o)==56320&&(n=65536+(n-55296<<10)+(o-56320),s++)),n<128?t[c++]=n:n<2048?(t[c++]=192|n>>>6,t[c++]=128|63&n):n<65536?(t[c++]=224|n>>>12,t[c++]=128|n>>>6&63,t[c++]=128|63&n):(t[c++]=240|n>>>18,t[c++]=128|n>>>12&63,t[c++]=128|n>>>6&63,t[c++]=128|63&n);return t},buf2string:(e,t)=>{const n=t||e.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(e.subarray(0,t));let o,s;const c=new Array(2*n);for(s=0,o=0;o<n;){let d=e[o++];if(d<128){c[s++]=d;continue}let h=_m[d];if(h>4)c[s++]=65533,o+=h-1;else{for(d&=h===2?31:h===3?15:7;h>1&&o<n;)d=d<<6|63&e[o++],h--;h>1?c[s++]=65533:d<65536?c[s++]=d:(d-=65536,c[s++]=55296|d>>10&1023,c[s++]=56320|1023&d)}}return((d,h)=>{if(h<65534&&d.subarray&&M4)return String.fromCharCode.apply(null,d.length===h?d:d.subarray(0,h));let p="";for(let m=0;m<h;m++)p+=String.fromCharCode(d[m]);return p})(c,s)},utf8border:(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let n=t-1;for(;n>=0&&(192&e[n])==128;)n--;return n<0||n===0?t:n+_m[e[n]]>t?n:t}},U4=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const j4=Object.prototype.toString,{Z_NO_FLUSH:fae,Z_SYNC_FLUSH:mae,Z_FULL_FLUSH:gae,Z_FINISH:_ae,Z_OK:Av,Z_STREAM_END:Eae,Z_DEFAULT_COMPRESSION:vae,Z_DEFAULT_STRATEGY:yae,Z_DEFLATED:Sae}=Nh;function vm(e){this.options=Iv.assign({level:vae,method:Sae,chunkSize:16384,windowBits:15,memLevel:8,strategy:yae},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new U4,this.strm.avail_out=0;let n=gm.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(n!==Av)throw new Error(vd[n]);if(t.header&&gm.deflateSetHeader(this.strm,t.header),t.dictionary){let o;if(o=typeof t.dictionary=="string"?Em.string2buf(t.dictionary):j4.call(t.dictionary)==="[object ArrayBuffer]"?new Uint8Array(t.dictionary):t.dictionary,n=gm.deflateSetDictionary(this.strm,o),n!==Av)throw new Error(vd[n]);this._dict_set=!0}}function fb(e,t){const n=new vm(t);if(n.push(e,!0),n.err)throw n.msg||vd[n.err];return n.result}vm.prototype.push=function(e,t){const n=this.strm,o=this.options.chunkSize;let s,c;if(this.ended)return!1;for(c=t===~~t?t:t===!0?_ae:fae,typeof e=="string"?n.input=Em.string2buf(e):j4.call(e)==="[object ArrayBuffer]"?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;)if(n.avail_out===0&&(n.output=new Uint8Array(o),n.next_out=0,n.avail_out=o),(c===mae||c===gae)&&n.avail_out<=6)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else{if(s=gm.deflate(n,c),s===Eae)return n.next_out>0&&this.onData(n.output.subarray(0,n.next_out)),s=gm.deflateEnd(this.strm),this.onEnd(s),this.ended=!0,s===Av;if(n.avail_out!==0){if(c>0&&n.next_out>0)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else if(n.avail_in===0)break}else this.onData(n.output)}return!0},vm.prototype.onData=function(e){this.chunks.push(e)},vm.prototype.onEnd=function(e){e===Av&&(this.result=Iv.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var Tae={Deflate:vm,deflate:fb,deflateRaw:function(e,t){return(t=t||{}).raw=!0,fb(e,t)},gzip:function(e,t){return(t=t||{}).gzip=!0,fb(e,t)},constants:Nh};const Nv=16209;var wae=function(e,t){let n,o,s,c,d,h,p,m,g,E,y,T,P,I,A,M,U,Y,Q,J,X,ne,oe,me;const we=e.state;n=e.next_in,oe=e.input,o=n+(e.avail_in-5),s=e.next_out,me=e.output,c=s-(t-e.avail_out),d=s+(e.avail_out-257),h=we.dmax,p=we.wsize,m=we.whave,g=we.wnext,E=we.window,y=we.hold,T=we.bits,P=we.lencode,I=we.distcode,A=(1<<we.lenbits)-1,M=(1<<we.distbits)-1;e:do{T<15&&(y+=oe[n++]<<T,T+=8,y+=oe[n++]<<T,T+=8),U=P[y&A];t:for(;;){if(Y=U>>>24,y>>>=Y,T-=Y,Y=U>>>16&255,Y===0)me[s++]=65535&U;else{if(!(16&Y)){if(!(64&Y)){U=P[(65535&U)+(y&(1<<Y)-1)];continue t}if(32&Y){we.mode=16191;break e}e.msg="invalid literal/length code",we.mode=Nv;break e}Q=65535&U,Y&=15,Y&&(T<Y&&(y+=oe[n++]<<T,T+=8),Q+=y&(1<<Y)-1,y>>>=Y,T-=Y),T<15&&(y+=oe[n++]<<T,T+=8,y+=oe[n++]<<T,T+=8),U=I[y&M];n:for(;;){if(Y=U>>>24,y>>>=Y,T-=Y,Y=U>>>16&255,!(16&Y)){if(!(64&Y)){U=I[(65535&U)+(y&(1<<Y)-1)];continue n}e.msg="invalid distance code",we.mode=Nv;break e}if(J=65535&U,Y&=15,T<Y&&(y+=oe[n++]<<T,T+=8,T<Y&&(y+=oe[n++]<<T,T+=8)),J+=y&(1<<Y)-1,J>h){e.msg="invalid distance too far back",we.mode=Nv;break e}if(y>>>=Y,T-=Y,Y=s-c,J>Y){if(Y=J-Y,Y>m&&we.sane){e.msg="invalid distance too far back",we.mode=Nv;break e}if(X=0,ne=E,g===0){if(X+=p-Y,Y<Q){Q-=Y;do me[s++]=E[X++];while(--Y);X=s-J,ne=me}}else if(g<Y){if(X+=p+g-Y,Y-=g,Y<Q){Q-=Y;do me[s++]=E[X++];while(--Y);if(X=0,g<Q){Y=g,Q-=Y;do me[s++]=E[X++];while(--Y);X=s-J,ne=me}}}else if(X+=g-Y,Y<Q){Q-=Y;do me[s++]=E[X++];while(--Y);X=s-J,ne=me}for(;Q>2;)me[s++]=ne[X++],me[s++]=ne[X++],me[s++]=ne[X++],Q-=3;Q&&(me[s++]=ne[X++],Q>1&&(me[s++]=ne[X++]))}else{X=s-J;do me[s++]=me[X++],me[s++]=me[X++],me[s++]=me[X++],Q-=3;while(Q>2);Q&&(me[s++]=me[X++],Q>1&&(me[s++]=me[X++]))}break}}break}}while(n<o&&s<d);Q=T>>3,n-=Q,T-=Q<<3,y&=(1<<T)-1,e.next_in=n,e.next_out=s,e.avail_in=n<o?o-n+5:5-(n-o),e.avail_out=s<d?d-s+257:257-(s-d),we.hold=y,we.bits=T};const Ov=15,Rae=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Cae=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),bae=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Iae=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var ym=(e,t,n,o,s,c,d,h)=>{const p=h.bits;let m,g,E,y,T,P,I=0,A=0,M=0,U=0,Y=0,Q=0,J=0,X=0,ne=0,oe=0,me=null;const we=new Uint16Array(16),ut=new Uint16Array(16);let rt,qe,tn,zt=null;for(I=0;I<=Ov;I++)we[I]=0;for(A=0;A<o;A++)we[t[n+A]]++;for(Y=p,U=Ov;U>=1&&we[U]===0;U--);if(Y>U&&(Y=U),U===0)return s[c++]=20971520,s[c++]=20971520,h.bits=1,0;for(M=1;M<U&&we[M]===0;M++);for(Y<M&&(Y=M),X=1,I=1;I<=Ov;I++)if(X<<=1,X-=we[I],X<0)return-1;if(X>0&&(e===0||U!==1))return-1;for(ut[1]=0,I=1;I<Ov;I++)ut[I+1]=ut[I]+we[I];for(A=0;A<o;A++)t[n+A]!==0&&(d[ut[t[n+A]]++]=A);if(e===0?(me=zt=d,P=20):e===1?(me=Rae,zt=Cae,P=257):(me=bae,zt=Iae,P=0),oe=0,A=0,I=M,T=c,Q=Y,J=0,E=-1,ne=1<<Y,y=ne-1,e===1&&ne>852||e===2&&ne>592)return 1;for(;;){rt=I-J,d[A]+1<P?(qe=0,tn=d[A]):d[A]>=P?(qe=zt[d[A]-P],tn=me[d[A]-P]):(qe=96,tn=0),m=1<<I-J,g=1<<Q,M=g;do g-=m,s[T+(oe>>J)+g]=rt<<24|qe<<16|tn|0;while(g!==0);for(m=1<<I-1;oe&m;)m>>=1;if(m!==0?(oe&=m-1,oe+=m):oe=0,A++,--we[I]==0){if(I===U)break;I=t[n+d[A]]}if(I>Y&&(oe&y)!==E){for(J===0&&(J=Y),T+=M,Q=I-J,X=1<<Q;Q+J<U&&(X-=we[Q+J],!(X<=0));)Q++,X<<=1;if(ne+=1<<Q,e===1&&ne>852||e===2&&ne>592)return 1;E=oe&y,s[E]=Y<<24|Q<<16|T-c|0}}return oe!==0&&(s[T+oe]=I-J<<24|64<<16|0),h.bits=Y,0};const{Z_FINISH:V4,Z_BLOCK:Aae,Z_TREES:Pv,Z_OK:wd,Z_STREAM_END:Nae,Z_NEED_DICT:Oae,Z_STREAM_ERROR:os,Z_DATA_ERROR:F4,Z_MEM_ERROR:B4,Z_BUF_ERROR:Pae,Z_DEFLATED:W4}=Nh,Dv=16180,kv=16190,ec=16191,mb=16192,gb=16194,xv=16199,Lv=16200,_b=16206,ir=16209,H4=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function Dae(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Rd=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<Dv||t.mode>16211?1:0},G4=e=>{if(Rd(e))return os;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=Dv,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,wd},z4=e=>{if(Rd(e))return os;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,G4(e)},K4=(e,t)=>{let n;if(Rd(e))return os;const o=e.state;return t<0?(n=0,t=-t):(n=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?os:(o.window!==null&&o.wbits!==t&&(o.window=null),o.wrap=n,o.wbits=t,z4(e))},Y4=(e,t)=>{if(!e)return os;const n=new Dae;e.state=n,n.strm=e,n.window=null,n.mode=Dv;const o=K4(e,t);return o!==wd&&(e.state=null),o};let Eb,vb,q4=!0;const kae=e=>{if(q4){Eb=new Int32Array(512),vb=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(ym(1,e.lens,0,288,Eb,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;ym(2,e.lens,0,32,vb,0,e.work,{bits:5}),q4=!1}e.lencode=Eb,e.lenbits=9,e.distcode=vb,e.distbits=5},X4=(e,t,n,o)=>{let s;const c=e.state;return c.window===null&&(c.wsize=1<<c.wbits,c.wnext=0,c.whave=0,c.window=new Uint8Array(c.wsize)),o>=c.wsize?(c.window.set(t.subarray(n-c.wsize,n),0),c.wnext=0,c.whave=c.wsize):(s=c.wsize-c.wnext,s>o&&(s=o),c.window.set(t.subarray(n-o,n-o+s),c.wnext),(o-=s)?(c.window.set(t.subarray(n-o,n),0),c.wnext=o,c.whave=c.wsize):(c.wnext+=s,c.wnext===c.wsize&&(c.wnext=0),c.whave<c.wsize&&(c.whave+=s))),0};var xae=(e,t)=>{let n,o,s,c,d,h,p,m,g,E,y,T,P,I,A,M,U,Y,Q,J,X,ne,oe=0;const me=new Uint8Array(4);let we,ut;const rt=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Rd(e)||!e.output||!e.input&&e.avail_in!==0)return os;n=e.state,n.mode===ec&&(n.mode=mb),d=e.next_out,s=e.output,p=e.avail_out,c=e.next_in,o=e.input,h=e.avail_in,m=n.hold,g=n.bits,E=h,y=p,ne=wd;e:for(;;)switch(n.mode){case Dv:if(n.wrap===0){n.mode=mb;break}for(;g<16;){if(h===0)break e;h--,m+=o[c++]<<g,g+=8}if(2&n.wrap&&m===35615){n.wbits===0&&(n.wbits=15),n.check=0,me[0]=255&m,me[1]=m>>>8&255,n.check=ni(n.check,me,2,0),m=0,g=0,n.mode=16181;break}if(n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&m)<<8)+(m>>8))%31){e.msg="incorrect header check",n.mode=ir;break}if((15&m)!==W4){e.msg="unknown compression method",n.mode=ir;break}if(m>>>=4,g-=4,X=8+(15&m),n.wbits===0&&(n.wbits=X),X>15||X>n.wbits){e.msg="invalid window size",n.mode=ir;break}n.dmax=1<<n.wbits,n.flags=0,e.adler=n.check=1,n.mode=512&m?16189:ec,m=0,g=0;break;case 16181:for(;g<16;){if(h===0)break e;h--,m+=o[c++]<<g,g+=8}if(n.flags=m,(255&Kr(n))!==W4){e.msg="unknown compression method",n.mode=ir;break}if(57344&Kr(n)){e.msg="unknown header flags set",n.mode=ir;break}n.head&&(n.head.text=m>>8&1),512&Kr(n)&&4&n.wrap&&(me[0]=255&m,me[1]=m>>>8&255,n.check=ni(n.check,me,2,0)),m=0,g=0,n.mode=16182;case 16182:for(;g<32;){if(h===0)break e;h--,m+=o[c++]<<g,g+=8}n.head&&(n.head.time=m),512&Kr(n)&&4&n.wrap&&(me[0]=255&m,me[1]=m>>>8&255,me[2]=m>>>16&255,me[3]=m>>>24&255,n.check=ni(n.check,me,4,0)),m=0,g=0,n.mode=16183;case 16183:for(;g<16;){if(h===0)break e;h--,m+=o[c++]<<g,g+=8}n.head&&(n.head.xflags=255&m,n.head.os=m>>8),512&Kr(n)&&4&n.wrap&&(me[0]=255&m,me[1]=m>>>8&255,n.check=ni(n.check,me,2,0)),m=0,g=0,n.mode=16184;case 16184:if(1024&Kr(n)){for(;g<16;){if(h===0)break e;h--,m+=o[c++]<<g,g+=8}n.length=m,n.head&&(n.head.extra_len=m),512&Kr(n)&&4&n.wrap&&(me[0]=255&m,me[1]=m>>>8&255,n.check=ni(n.check,me,2,0)),m=0,g=0}else n.head&&(n.head.extra=null);n.mode=16185;case 16185:if(1024&Kr(n)&&(T=n.length,T>h&&(T=h),T&&(n.head&&(X=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(o.subarray(c,c+T),X)),512&Kr(n)&&4&n.wrap&&(n.check=ni(n.check,o,T,c)),h-=T,c+=T,n.length-=T),n.length))break e;n.length=0,n.mode=16186;case 16186:if(2048&Kr(n)){if(h===0)break e;T=0;do X=o[c+T++],n.head&&X&&n.length<65536&&(n.head.name+=String.fromCharCode(X));while(X&&T<h);if(512&Kr(n)&&4&n.wrap&&(n.check=ni(n.check,o,T,c)),h-=T,c+=T,X)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=16187;case 16187:if(4096&Kr(n)){if(h===0)break e;T=0;do X=o[c+T++],n.head&&X&&n.length<65536&&(n.head.comment+=String.fromCharCode(X));while(X&&T<h);if(512&Kr(n)&&4&n.wrap&&(n.check=ni(n.check,o,T,c)),h-=T,c+=T,X)break e}else n.head&&(n.head.comment=null);n.mode=16188;case 16188:if(512&Kr(n)){for(;g<16;){if(h===0)break e;h--,m+=o[c++]<<g,g+=8}if(4&n.wrap&&m!==(65535&n.check)){e.msg="header crc mismatch",n.mode=ir;break}m=0,g=0}n.head&&(n.head.hcrc=Kr(n)>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=ec;break;case 16189:for(;g<32;){if(h===0)break e;h--,m+=o[c++]<<g,g+=8}e.adler=n.check=H4(m),m=0,g=0,n.mode=kv;case kv:if(n.havedict===0)return e.next_out=d,e.avail_out=p,e.next_in=c,e.avail_in=h,n.hold=m,n.bits=g,Oae;e.adler=n.check=1,n.mode=ec;case ec:if(t===Aae||t===Pv)break e;case mb:if(n.last){m>>>=7&g,g-=7&g,n.mode=_b;break}for(;g<3;){if(h===0)break e;h--,m+=o[c++]<<g,g+=8}switch(n.last=1&m,m>>>=1,g-=1,3&m){case 0:n.mode=16193;break;case 1:if(kae(n),n.mode=xv,t===Pv){m>>>=2,g-=2;break e}break;case 2:n.mode=16196;break;case 3:e.msg="invalid block type",n.mode=ir}m>>>=2,g-=2;break;case 16193:for(m>>>=7&g,g-=7&g;g<32;){if(h===0)break e;h--,m+=o[c++]<<g,g+=8}if((65535&m)!=(m>>>16^65535)){e.msg="invalid stored block lengths",n.mode=ir;break}if(n.length=65535&m,m=0,g=0,n.mode=gb,t===Pv)break e;case gb:n.mode=16195;case 16195:if(T=n.length,T){if(T>h&&(T=h),T>p&&(T=p),T===0)break e;s.set(o.subarray(c,c+T),d),h-=T,c+=T,p-=T,d+=T,n.length-=T;break}n.mode=ec;break;case 16196:for(;g<14;){if(h===0)break e;h--,m+=o[c++]<<g,g+=8}if(n.nlen=257+(31&m),m>>>=5,g-=5,n.ndist=1+(31&m),m>>>=5,g-=5,n.ncode=4+(15&m),m>>>=4,g-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=ir;break}n.have=0,n.mode=16197;case 16197:for(;n.have<n.ncode;){for(;g<3;){if(h===0)break e;h--,m+=o[c++]<<g,g+=8}n.lens[rt[n.have++]]=7&m,m>>>=3,g-=3}for(;n.have<19;)n.lens[rt[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,we={bits:n.lenbits},ne=ym(0,n.lens,0,19,n.lencode,0,n.work,we),n.lenbits=we.bits,ne){e.msg="invalid code lengths set",n.mode=ir;break}n.have=0,n.mode=16198;case 16198:for(;n.have<n.nlen+n.ndist;){for(;oe=n.lencode[m&(1<<n.lenbits)-1],A=oe>>>24,M=oe>>>16&255,U=65535&oe,!(A<=g);){if(h===0)break e;h--,m+=o[c++]<<g,g+=8}if(U<16)m>>>=A,g-=A,n.lens[n.have++]=U;else{if(U===16){for(ut=A+2;g<ut;){if(h===0)break e;h--,m+=o[c++]<<g,g+=8}if(m>>>=A,g-=A,n.have===0){e.msg="invalid bit length repeat",n.mode=ir;break}X=n.lens[n.have-1],T=3+(3&m),m>>>=2,g-=2}else if(U===17){for(ut=A+3;g<ut;){if(h===0)break e;h--,m+=o[c++]<<g,g+=8}m>>>=A,g-=A,X=0,T=3+(7&m),m>>>=3,g-=3}else{for(ut=A+7;g<ut;){if(h===0)break e;h--,m+=o[c++]<<g,g+=8}m>>>=A,g-=A,X=0,T=11+(127&m),m>>>=7,g-=7}if(n.have+T>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=ir;break}for(;T--;)n.lens[n.have++]=X}}if(n.mode===ir)break;if(n.lens[256]===0){e.msg="invalid code -- missing end-of-block",n.mode=ir;break}if(n.lenbits=9,we={bits:n.lenbits},ne=ym(1,n.lens,0,n.nlen,n.lencode,0,n.work,we),n.lenbits=we.bits,ne){e.msg="invalid literal/lengths set",n.mode=ir;break}if(n.distbits=6,n.distcode=n.distdyn,we={bits:n.distbits},ne=ym(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,we),n.distbits=we.bits,ne){e.msg="invalid distances set",n.mode=ir;break}if(n.mode=xv,t===Pv)break e;case xv:n.mode=Lv;case Lv:if(h>=6&&p>=258){e.next_out=d,e.avail_out=p,e.next_in=c,e.avail_in=h,n.hold=m,n.bits=g,wae(e,y),d=e.next_out,s=e.output,p=e.avail_out,c=e.next_in,o=e.input,h=e.avail_in,m=n.hold,g=n.bits,n.mode===ec&&(n.back=-1);break}for(n.back=0;oe=n.lencode[m&(1<<n.lenbits)-1],A=oe>>>24,M=oe>>>16&255,U=65535&oe,!(A<=g);){if(h===0)break e;h--,m+=o[c++]<<g,g+=8}if(M&&!(240&M)){for(Y=A,Q=M,J=U;oe=n.lencode[J+((m&(1<<Y+Q)-1)>>Y)],A=oe>>>24,M=oe>>>16&255,U=65535&oe,!(Y+A<=g);){if(h===0)break e;h--,m+=o[c++]<<g,g+=8}m>>>=Y,g-=Y,n.back+=Y}if(m>>>=A,g-=A,n.back+=A,n.length=U,M===0){n.mode=16205;break}if(32&M){n.back=-1,n.mode=ec;break}if(64&M){e.msg="invalid literal/length code",n.mode=ir;break}n.extra=15&M,n.mode=16201;case 16201:if(n.extra){for(ut=n.extra;g<ut;){if(h===0)break e;h--,m+=o[c++]<<g,g+=8}n.length+=m&(1<<n.extra)-1,m>>>=n.extra,g-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=16202;case 16202:for(;oe=n.distcode[m&(1<<n.distbits)-1],A=oe>>>24,M=oe>>>16&255,U=65535&oe,!(A<=g);){if(h===0)break e;h--,m+=o[c++]<<g,g+=8}if(!(240&M)){for(Y=A,Q=M,J=U;oe=n.distcode[J+((m&(1<<Y+Q)-1)>>Y)],A=oe>>>24,M=oe>>>16&255,U=65535&oe,!(Y+A<=g);){if(h===0)break e;h--,m+=o[c++]<<g,g+=8}m>>>=Y,g-=Y,n.back+=Y}if(m>>>=A,g-=A,n.back+=A,64&M){e.msg="invalid distance code",n.mode=ir;break}n.offset=U,n.extra=15&M,n.mode=16203;case 16203:if(n.extra){for(ut=n.extra;g<ut;){if(h===0)break e;h--,m+=o[c++]<<g,g+=8}n.offset+=m&(1<<n.extra)-1,m>>>=n.extra,g-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=ir;break}n.mode=16204;case 16204:if(p===0)break e;if(T=y-p,n.offset>T){if(T=n.offset-T,T>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=ir;break}T>n.wnext?(T-=n.wnext,P=n.wsize-T):P=n.wnext-T,T>n.length&&(T=n.length),I=n.window}else I=s,P=d-n.offset,T=n.length;T>p&&(T=p),p-=T,n.length-=T;do s[d++]=I[P++];while(--T);n.length===0&&(n.mode=Lv);break;case 16205:if(p===0)break e;s[d++]=n.length,p--,n.mode=Lv;break;case _b:if(n.wrap){for(;g<32;){if(h===0)break e;h--,m|=o[c++]<<g,g+=8}if(y-=p,e.total_out+=y,n.total+=y,4&n.wrap&&y&&(e.adler=n.check=Kr(n)?ni(n.check,s,y,d-y):um(n.check,s,y,d-y)),y=p,4&n.wrap&&(Kr(n)?m:H4(m))!==n.check){e.msg="incorrect data check",n.mode=ir;break}m=0,g=0}n.mode=16207;case 16207:if(n.wrap&&Kr(n)){for(;g<32;){if(h===0)break e;h--,m+=o[c++]<<g,g+=8}if(4&n.wrap&&m!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=ir;break}m=0,g=0}n.mode=16208;case 16208:ne=Nae;break e;case ir:ne=F4;break e;case 16210:return B4;default:return os}return e.next_out=d,e.avail_out=p,e.next_in=c,e.avail_in=h,n.hold=m,n.bits=g,(n.wsize||y!==e.avail_out&&n.mode<ir&&(n.mode<_b||t!==V4))&&X4(e,e.output,e.next_out,y-e.avail_out),E-=e.avail_in,y-=e.avail_out,e.total_in+=E,e.total_out+=y,n.total+=y,4&n.wrap&&y&&(e.adler=n.check=Kr(n)?ni(n.check,s,y,e.next_out-y):um(n.check,s,y,e.next_out-y)),e.data_type=n.bits+(n.last?64:0)+(n.mode===ec?128:0)+(n.mode===xv||n.mode===gb?256:0),(E===0&&y===0||t===V4)&&ne===wd&&(ne=Pae),ne},tc={inflateReset:z4,inflateReset2:K4,inflateResetKeep:G4,inflateInit:e=>Y4(e,15),inflateInit2:Y4,inflate:xae,inflateEnd:e=>{if(Rd(e))return os;let t=e.state;return t.window&&(t.window=null),e.state=null,wd},inflateGetHeader:(e,t)=>{if(Rd(e))return os;const n=e.state;return 2&n.wrap?(n.head=t,t.done=!1,wd):os},inflateSetDictionary:(e,t)=>{const n=t.length;let o,s,c;return Rd(e)?os:(o=e.state,o.wrap!==0&&o.mode!==kv?os:o.mode===kv&&(s=1,s=um(s,t,n,0),s!==o.check)?F4:(c=X4(e,t,n,n),c?(o.mode=16210,B4):(o.havedict=1,wd)))},inflateInfo:"pako inflate (from Nodeca project)"},Lae=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const $4=Object.prototype.toString,{Z_NO_FLUSH:Mae,Z_FINISH:Uae,Z_OK:Sm,Z_STREAM_END:yb,Z_NEED_DICT:Sb,Z_STREAM_ERROR:jae,Z_DATA_ERROR:J4,Z_MEM_ERROR:Vae}=Nh;function Tm(e){this.options=Iv.assign({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,t.windowBits===0&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&!(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new U4,this.strm.avail_out=0;let n=tc.inflateInit2(this.strm,t.windowBits);if(n!==Sm)throw new Error(vd[n]);if(this.header=new Lae,tc.inflateGetHeader(this.strm,this.header),t.dictionary&&(typeof t.dictionary=="string"?t.dictionary=Em.string2buf(t.dictionary):$4.call(t.dictionary)==="[object ArrayBuffer]"&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=tc.inflateSetDictionary(this.strm,t.dictionary),n!==Sm)))throw new Error(vd[n])}function Tb(e,t){const n=new Tm(t);if(n.push(e),n.err)throw n.msg||vd[n.err];return n.result}Tm.prototype.push=function(e,t){const n=this.strm,o=this.options.chunkSize,s=this.options.dictionary;let c,d,h;if(this.ended)return!1;for(d=t===~~t?t:t===!0?Uae:Mae,$4.call(e)==="[object ArrayBuffer]"?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;){for(n.avail_out===0&&(n.output=new Uint8Array(o),n.next_out=0,n.avail_out=o),c=tc.inflate(n,d),c===Sb&&s&&(c=tc.inflateSetDictionary(n,s),c===Sm?c=tc.inflate(n,d):c===J4&&(c=Sb));n.avail_in>0&&c===yb&&n.state.wrap>0&&e[n.next_in]!==0;)tc.inflateReset(n),c=tc.inflate(n,d);switch(c){case jae:case J4:case Sb:case Vae:return this.onEnd(c),this.ended=!0,!1}if(h=n.avail_out,n.next_out&&(n.avail_out===0||c===yb))if(this.options.to==="string"){let p=Em.utf8border(n.output,n.next_out),m=n.next_out-p,g=Em.buf2string(n.output,p);n.next_out=m,n.avail_out=o-m,m&&n.output.set(n.output.subarray(p,p+m),0),this.onData(g)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(c!==Sm||h!==0){if(c===yb)return c=tc.inflateEnd(this.strm),this.onEnd(c),this.ended=!0,!0;if(n.avail_in===0)break}}return!0},Tm.prototype.onData=function(e){this.chunks.push(e)},Tm.prototype.onEnd=function(e){e===Sm&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=Iv.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var Fae={Inflate:Tm,inflate:Tb,inflateRaw:function(e,t){return(t=t||{}).raw=!0,Tb(e,t)},ungzip:Tb,constants:Nh};const{Deflate:M0e,deflate:Bae,deflateRaw:U0e,gzip:j0e}=Tae,{Inflate:V0e,inflate:Wae,inflateRaw:F0e,ungzip:B0e}=Fae;var Hae=Bae,Gae=Wae,Q4=function(e){return e[e.ONE_BYTE=0]="ONE_BYTE",e[e.TWO_BYTE=1]="TWO_BYTE",e}(Q4||{});class zae{constructor(){x(this,"_sequence",0),x(this,"_startTime",Date.now()),x(this,"isUseOneByte",!0)}get startTime(){const t=Date.now()-this._startTime;return t<Math.pow(2,16)?t:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(t){const n={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:t};if(t.byteLength>128){const h=new Uint8Array(4);h.set([1,0,0,0]);const p={id:0,length:4,data:h.buffer},m={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[p]};n.commonPacketHeader.extension=1,n.extension=m,n.payload=this.compress(t),n.commonPacketHeader.length=8+(n.extension.length+2)+n.payload.byteLength}else n.commonPacketHeader.length=8+n.payload.byteLength;H("SHOW_DATASTREAM2_LOG")&&R.debug("send data header: ".concat(JSON.stringify(n.commonPacketHeader)));const o=new ArrayBuffer(n.commonPacketHeader.length),s=new Uint8Array(o),c=new DataView(o);let d=0;if(c.setUint16(d,n.commonPacketHeader.extension<<15|n.commonPacketHeader.reserved<<14|n.commonPacketHeader.length,!0),d+=2,c.setUint32(d,n.commonPacketHeader.sequence,!0),d+=4,c.setUint16(d,n.commonStreamHeader,!0),d+=2,n.extension){const h=this.serializeExtension(n.extension);s.set(new Uint8Array(h),d),d+=h.byteLength}if(s.set(new Uint8Array(n.payload),d),d+=n.payload.byteLength,d!==n.commonPacketHeader.length)throw Error("serialize error!");return o}deserialize(t){if(t.byteLength<4)return new ArrayBuffer(0);const n=new DataView(t);let o=0;const s=n.getUint16(o,!0);o+=2;const c={length:16383&s,reserved:(16384&s)>>14,extension:(32768&s)>>15,sequence:n.getUint16(o+2,!0)<<16|n.getUint16(o,!0)};let d,h;if(o+=4,H("SHOW_DATASTREAM2_LOG")&&R.debug("receive data header: ".concat(JSON.stringify(c))),n.getUint16(o,!0),o+=2,c.extension){h=this.deserializeExtension(t.slice(o)),o+=2+h.length,d=t.slice(o);let p=!1;if(h.datas.length>0){const m=h.datas.find(g=>g.id===0);m&&(p=(1&new DataView(m.data).getUint32(0,!0))==1)}d=p?this.decompress(d):d}else d=t.slice(8);return d}serializeExtension(t){const{profile:n,length:o,datas:s}=t,c=new ArrayBuffer(o+2),d=new Uint8Array(c),h=new DataView(c);let p=0;if(h.setUint8(p++,n),h.setUint8(p++,o),s.forEach(m=>{n?(h.setUint8(p++,m.id),h.setUint8(p++,m.length),d.set(new Uint8Array(m.data),p),p+=m.data.byteLength):(h.setUint8(p++,m.id|m.length<<4),d.set(new Uint8Array(m.data),p),p+=m.data.byteLength)}),p!==o+2)throw Error("serialize extension error, is ".concat(p,"!==").concat(o+2));return c}deserializeExtension(t){const n=new DataView(t);let o=0;const s=n.getUint8(o);o++;const c=n.getUint8(o);o++;const d=s===Q4.TWO_BYTE,h=[],p=new DataView(t,2);let m=0;for(;m<c;){let g=0,E=0,y=new ArrayBuffer(0);d?(g=p.getUint8(m),m++,E=p.getUint8(m),m++):(g=15&p.getUint8(m),E=p.getUint8(m)>>4,m++),E>0&&(y=p.buffer.slice(m+2,m+2+E),m+=y.byteLength),h.push({id:g,length:E,data:y})}if(m!==c)throw Error("parse error");return{profile:s,length:c,datas:h}}decompress(t){return Gae(new Uint8Array(t))}compress(t){return Hae(new Uint8Array(t))}}const Kae={name:"DataStream",create:(e,t)=>{const n=t?new toe(e):new noe(e);return n.useDataStream(new zae),n}};class Yae extends pn{constructor(t,n,o){super(),x(this,"ws",void 0),x(this,"requestId",1),x(this,"heartBeatTimer",void 0),x(this,"joinInfo",void 0),x(this,"clientId",void 0),x(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),x(this,"onClose",s=>{this.emit("close"),this.dispose()}),x(this,"onMessage",s=>{const c=JSON.parse(s.data);if(!c||c.command!=="serverResponse"||!c.requestId)return c&&c.command==="serverStatus"&&c.serverStatus&&c.serverStatus.command?(this.emit("status",c.serverStatus),void this.emit(c.serverStatus.command,c.serverStatus)):void 0;this.emit("req_".concat(c.requestId),c)}),this.joinInfo=t,this.clientId=n,this.ws=new zf("cross-channel-".concat(this.clientId),o),this.ws.on(tt.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(tt.CONNECTED,this.onOpen),this.ws.on(tt.ON_MESSAGE,this.onMessage),this.ws.on(tt.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(t){const n=this.requestId++;return t.requestId=n,t.seq=n,this.ws.sendMessage(t),n}waitStatus(t){return new ye((n,o)=>{const s=window.setTimeout(()=>{o(new ee(j.TIMEOUT,"wait status timeout, status: ".concat(t)))},5e3);this.once(t,c=>{window.clearTimeout(s),c.state&&c.state!==0?o(new ee(j.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(t))):n(void 0)}),this.once("dispose",()=>{window.clearTimeout(s),o(new ee(j.WS_ABORT))})})}async request(t){if(this.ws.state==="closed")throw new ee(j.WS_DISCONNECT);const n=()=>new ye((d,h)=>{this.ws.once(tt.CLOSED,()=>h(new ee(j.WS_ABORT))),this.ws.once(tt.CONNECTED,d)});this.ws.state!=="connected"&&await n();const o=this.sendMessage(t),s=new ye((d,h)=>{const p=()=>{h(new ee(j.WS_ABORT))};this.ws.once(tt.RECONNECTING,p),this.ws.once(tt.CLOSED,p),this.once("req_".concat(o),d),cr(3e3).then(()=>{this.removeAllListeners("req_".concat(o)),this.ws.off(tt.RECONNECTING,p),this.ws.off(tt.CLOSED,p),h(new ee(j.TIMEOUT,"cross channel ws request timeout"))})}),c=await s;if(!c||c.code!==200)throw new ee(j.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(c)));return c}async connect(t){this.ws.removeAllListeners(tt.REQUEST_NEW_URLS),this.ws.on(tt.REQUEST_NEW_URLS,n=>{n(t)}),await this.ws.init(t)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(t){const n=this.requestId++;return t.requestId=n,this.ws.sendMessage(t),n}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class qae extends pn{set state(t){t!==this._state&&(t!==Ei.RELAY_STATE_FAILURE&&(this.errorCode=mh.RELAY_OK),this.emit("state",t,this.errorCode),this._state=t)}get state(){return this._state}constructor(t,n,o,s,c){super(),x(this,"joinInfo",void 0),x(this,"sid",void 0),x(this,"clientId",void 0),x(this,"cancelToken",oi.CancelToken.source()),x(this,"workerToken",void 0),x(this,"requestId",0),x(this,"signal",void 0),x(this,"prevChannelMediaConfig",void 0),x(this,"httpRetryConfig",void 0),x(this,"_resolution",void 0),x(this,"_state",Ei.RELAY_STATE_IDLE),x(this,"errorCode",mh.RELAY_OK),x(this,"onStatus",d=>{R.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(d))),d&&d.command&&(d.command==="onAudioPacketReceived"&&this.emit("event",Xa.PACKET_RECEIVED_AUDIO_FROM_SRC),d.command==="onVideoPacketReceived"&&this.emit("event",Xa.PACKET_RECEIVED_VIDEO_FROM_SRC),d.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=mh.SRC_TOKEN_EXPIRED,this.state=Ei.RELAY_STATE_FAILURE),d.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=mh.DEST_TOKEN_EXPIRED,this.state=Ei.RELAY_STATE_FAILURE))}),x(this,"onReconnect",async()=>{R.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",Xa.NETWORK_DISCONNECTED),this.state=Ei.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(d=>{this.state!==Ei.RELAY_STATE_IDLE&&(R.error("auto restart channel media relay failed",d.toString()),this.errorCode=mh.SERVER_CONNECTION_LOST,this.state=Ei.RELAY_STATE_FAILURE)})}),this.joinInfo=t,this.clientId=n,this.sid=od(),this.signal=new Yae(this.joinInfo,this.clientId,o),this.httpRetryConfig=s,this._resolution=c}async startChannelMediaRelay(t){if(this.state!==Ei.RELAY_STATE_IDLE)throw new ee(j.INVALID_OPERATION);this.state=Ei.RELAY_STATE_CONNECTING,await this.connect(),R.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(t)}catch(n){throw n.data&&n.data.serverResponse&&n.data.serverResponse.command==="SetSourceChannel"?new ee(j.CROSS_CHANNEL_FAILED_JOIN_SRC):n.data&&n.data.serverResponse&&n.serverResponse.command==="SetDestChannelStatus"?new ee(j.CROSS_CHANNEL_FAILED_JOIN_DEST):n.data&&n.data.serverResponse&&n.serverResponse.command==="StartPacketTransfer"?new ee(j.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):n}this.prevChannelMediaConfig=t}async updateChannelMediaRelay(t){if(this.state!==Ei.RELAY_STATE_RUNNING)throw new ee(j.INVALID_OPERATION);await this.sendUpdateMessage(t),this.prevChannelMediaConfig=t}async setVideoProfile(t){if(this._resolution=t,this.state!==Ei.RELAY_STATE_RUNNING)throw new ee(j.INVALID_OPERATION);const n=this.genMessage(ti.SetVideoProfile);await this.signal.request(n),R.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),R.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=Ei.RELAY_STATE_IDLE,this.dispose()}dispose(){R.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=oi.CancelToken.source(),this.state=Ei.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const t=await ase(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=t.workerToken,await this.signal.connect(t.addressList),this.emit("event",Xa.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(t){const n=this.genMessage(ti.StopPacketTransfer);await this.signal.request(n),await this.signal.waitStatus("Normal Quit"),R.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const o=this.genMessage(ti.SetSdkProfile,t);await this.signal.request(o),R.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const s=this.genMessage(ti.SetSourceChannel,t);await this.signal.request(s),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",Xa.PACKET_JOINED_SRC_CHANNEL),R.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const c=this.genMessage(ti.SetSourceUserId,t);await this.signal.request(c),R.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const d=this.genMessage(ti.SetDestChannel,t);await this.signal.request(d),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",Xa.PACKET_JOINED_DEST_CHANNEL),R.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const h=this.genMessage(ti.StartPacketTransfer,t);await this.signal.request(h),this.emit("event",Xa.PACKET_SENT_TO_DEST_CHANNEL),this.state=Ei.RELAY_STATE_RUNNING,R.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(t){const n=this.genMessage(ti.UpdateDestChannel,t);await this.signal.request(n),this.emit("event",Xa.PACKET_UPDATE_DEST_CHANNEL),R.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const t=this.genMessage(ti.StopPacketTransfer);await this.signal.request(t),R.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(t,n){const o=[],s=[],c=[];this.requestId+=1;const d={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:po,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};d.sdkVersion==="4.23.3"&&(d.sdkVersion="0.0.1");let h=null,p=null;switch(t){case ti.SetSdkProfile:return d.clientRequest={command:"SetSdkProfile",type:"multi_channel"},d;case ti.SetSourceChannel:if(p=n&&n.getSrcChannelMediaInfo(),!p)throw new ee(j.UNEXPECTED_ERROR,"can not find source config");return d.clientRequest={command:"SetSourceChannel",uid:"0",channelName:p.channelName,token:p.token||this.joinInfo.appId},d;case ti.SetSourceUserId:if(p=n&&n.getSrcChannelMediaInfo(),!p)throw new ee(j.UNEXPECTED_ERROR,"can not find source config");return d.clientRequest={command:"SetSourceUserId",uid:p.uid+""},d;case ti.SetDestChannel:if(h=n&&n.getDestChannelMediaInfo(),!h)throw new ee(j.UNEXPECTED_ERROR,"can not find dest config");return h.forEach(m=>{o.push(m.channelName),s.push(m.uid+""),c.push(m.token||this.joinInfo.appId)}),d.clientRequest={command:"SetDestChannel",channelName:o,uid:s,token:c},d;case ti.StartPacketTransfer:return d.clientRequest={command:"StartPacketTransfer"},d;case ti.Reconnect:return d.clientRequest={command:"Reconnect"},d;case ti.StopPacketTransfer:return d.clientRequest={command:"StopPacketTransfer"},d;case ti.UpdateDestChannel:if(h=n&&n.getDestChannelMediaInfo(),!h)throw new ee(j.UNEXPECTED_ERROR,"can not find dest config");return h.forEach(m=>{o.push(m.channelName),s.push(m.uid+""),c.push(m.token||this.joinInfo.appId)}),d.clientRequest={command:"UpdateDestChannel",channelName:o,uid:s,token:c},d;case ti.SetVideoProfile:d.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return d}}const Xae={name:"ChannelMediaRelay",create:function(e){return new qae(e.joinInfo,e.clientId,e.websocketRetryConfig||Un,e.httpRetryConfig||Un,e.resolution)}};function Z4(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,o)}return n}function wm(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Z4(Object(n),!0).forEach(function(o){x(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Z4(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}class $ae extends pn{constructor(t,n,o,s){super(),x(this,"spec",void 0),x(this,"token",void 0),x(this,"websocket",void 0),x(this,"pingpongTimer",void 0),x(this,"reconnectMode","retry"),x(this,"serviceMode",void 0),x(this,"reqId",0),x(this,"commandReqId",0),x(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),x(this,"handleWebSocketMessage",c=>{if(!c.data)return;const d=JSON.parse(c.data);d.requestId?this.emit("@".concat(d.requestId,"-").concat(d.sid),d):(ke.workerEvent(this.spec.sid,{actionType:"status",serverCode:d.code,workerType:this.serviceMode===qa.TRANSCODE?1:2}),this.emit(Lc.PUBLISH_STREAM_STATUS,d))}),this.spec=n,this.token=t,this.serviceMode=s,this.websocket=new zf("live-streaming",o),this.websocket.on(tt.CONNECTED,this.handleWebSocketOpen),this.websocket.on(tt.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(tt.REQUEST_NEW_URLS,(c,d)=>{Er(this,Lc.REQUEST_NEW_ADDRESS).then(c).catch(d)}),this.websocket.on(tt.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(t){return this.websocket.init(t)}async request(t,n,o,s){this.reqId+=1,t==="request"&&(this.commandReqId+=1);const c=this.commandReqId,d=this.reqId;if(!d||!this.websocket)throw new ee(j.UNEXPECTED_ERROR);const h=wm({command:t,sdkVersion:po==="4.23.3"?"0.0.1":po,seq:d,requestId:d,allocate:o,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},n);if(this.websocket.state==="closed")throw new ee(j.WS_DISCONNECT);const p=()=>new ye((y,T)=>{this.websocket.once(tt.CLOSED,()=>T(new ee(j.WS_ABORT))),this.websocket.once(tt.CONNECTED,y)});this.websocket.state!=="connected"&&await p(),h.clientRequest&&(h.clientRequest.workerToken=this.token);const m=new ye((y,T)=>{const P=()=>{T(new ee(j.WS_ABORT))};this.websocket.once(tt.RECONNECTING,P),this.websocket.once(tt.CLOSED,P),this.once("@".concat(d,"-").concat(this.spec.sid),I=>{y(I)})});s&&ke.workerEvent(this.spec.sid,wm(wm({},s),{},{requestId:c,actionType:"request",payload:JSON.stringify(n.clientRequest),serverCode:0,code:0}));const g=Date.now();this.websocket.sendMessage(h);let E=null;try{E=await m}catch(y){if(this.websocket.state==="closed")throw y;return await p(),await this.request(t,n,o)}return s&&ke.workerEvent(this.spec.sid,wm(wm({},s),{},{requestId:c,actionType:"response",payload:JSON.stringify(E.serverResponse),serverCode:E.code,success:E.code===200,responseTime:Date.now()-g})),E.code!==200&&this.handleResponseError(E),E}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const t=po==="4.23.3"?"0.0.1":po;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:t,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(t){switch(t.code){case Wn.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void R.warning("live stream response already exists stream");case Wn.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case Wn.LIVE_STREAM_RESPONSE_BAD_STREAM:case Wn.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new ee(j.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:t.code}).throw();case Wn.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(t.serverResponse.command==="UnpublishStream")return;throw new ee(j.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Wn.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new ee(j.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:t.code}).throw();case Wn.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const n=new ee(j.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(Lc.WARNING,n,t.serverResponse.url)}case Wn.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const n=new ee(j.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(Lc.WARNING,n,t.serverResponse.url)}case Wn.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new ee(j.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Wn.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new ee(j.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:t.code}).throw();case Wn.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const n=new ee(j.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(Lc.WARNING,n,t.serverResponse.url)}case Wn.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new ee(j.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code}).throw();case Wn.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new ee(j.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case Wn.LIVE_STREAM_RESPONSE_WORKER_LOST:case Wn.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(t.serverResponse.command==="UnpublishStream")return;throw new ee(j.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Wn.ERROR_FAIL_SEND_MESSAGE:if(t.serverResponse.command==="UnpublishStream")return;if(t.serverResponse.command==="UpdateTranscoding"||t.serverResponse.command==="ControlStream")return new ee(j.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:t.code}).throw();throw new ee(j.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Wn.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Wn.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Wn.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Wn.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new ee(j.LIVE_STREAMING_CDN_ERROR,"",{code:t.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(IE)},6e3)}}function e3(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,o)}return n}function vi(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?e3(Object(n),!0).forEach(function(o){x(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):e3(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}class Jae extends pn{constructor(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Un,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Un;super(),x(this,"onLiveStreamWarning",void 0),x(this,"onLiveStreamError",void 0),x(this,"spec",void 0),x(this,"retryTimeout",1e4),x(this,"connection",void 0),x(this,"httpRetryConfig",void 0),x(this,"wsRetryConfig",void 0),x(this,"streamingTasks",new Map),x(this,"isStartingStreamingTask",!1),x(this,"taskMutex",new Ir("live-streaming")),x(this,"cancelToken",oi.CancelToken.source()),x(this,"transcodingConfig",void 0),x(this,"uapResponse",void 0),x(this,"lastTaskId",1),x(this,"statusError",new Map),this.spec=t,this.httpRetryConfig=o,this.wsRetryConfig=n}async setTranscodingConfig(t){const n=vi(vi({},Foe),t);n.videoCodecProfile!==66&&n.videoCodecProfile!==77&&n.videoCodecProfile!==100&&(R.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(n.videoCodecProfile," -> 100")),n.videoCodecProfile=100),n.transcodingUsers||(n.transcodingUsers=n.userConfigs),n.transcodingUsers&&(n.transcodingUsers=n.transcodingUsers.map(d=>vi(vi(vi({},Voe),d),{},{zOrder:d.zOrder?d.zOrder+1:1}))),function(d){_n(d.width)||Ht(d.width,"config.width",0,1e4),_n(d.height)||Ht(d.height,"config.height",0,1e4),_n(d.videoBitrate)||Ht(d.videoBitrate,"config.videoBitrate",1,1e6),_n(d.videoFrameRate)||Ht(d.videoFrameRate,"config.videoFrameRate"),_n(d.lowLatency)||za(d.lowLatency,"config.lowLatency"),_n(d.audioSampleRate)||Kn(d.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),_n(d.audioBitrate)||Ht(d.audioBitrate,"config.audioBitrate",1,128),_n(d.audioChannels)||Kn(d.audioChannels,"config.audioChannels",[1,2,3,4,5]),_n(d.videoGop)||Ht(d.videoGop,"config.videoGop"),_n(d.videoCodecProfile)||Kn(d.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),_n(d.userCount)||Ht(d.userCount,"config.userCount",0,17),_n(d.backgroundColor)||Ht(d.backgroundColor,"config.backgroundColor",0,16777215),_n(d.userConfigExtraInfo)||ar(d.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),d.transcodingUsers&&!_n(d.transcodingUsers)&&(Ka(d.transcodingUsers,"config.transcodingUsers"),d.transcodingUsers.forEach((h,p)=>{$E(h.uid),_n(h.x)||Ht(h.x,"transcodingUser[".concat(p,"].x"),0,1e4),_n(h.y)||Ht(h.y,"transcodingUser[".concat(p,"].y"),0,1e4),_n(h.width)||Ht(h.width,"transcodingUser[".concat(p,"].width"),0,1e4),_n(h.height)||Ht(h.height,"transcodingUser[".concat(p,"].height"),0,1e4),_n(h.zOrder)||Ht(h.zOrder-1,"transcodingUser[".concat(p,"].zOrder"),0,100),_n(h.alpha)||Ht(h.alpha,"transcodingUser[".concat(p,"].alpha"),0,1,!1)})),_n(d.watermark)||SC(d.watermark,"watermark"),_n(d.backgroundImage)||SC(d.backgroundImage,"backgroundImage"),d.images&&!_n(d.images)&&(Ka(d.images,"config.images"),d.images.forEach((h,p)=>{SC(h,"images[".concat(p,"]"))}))}(n);const o=[];n.images&&o.push(...n.images.map(d=>vi(vi(vi({},yC),d),{},{zOrder:255}))),n.backgroundImage&&(o.push(vi(vi(vi({},yC),n.backgroundImage),{},{zOrder:0})),delete n.backgroundImage),n.watermark&&(o.push(vi(vi(vi({},yC),n.watermark),{},{zOrder:255})),delete n.watermark),n.images=o,n.transcodingUsers&&(n.userConfigs=n.transcodingUsers.map(d=>vi({},d)),n.userCount=n.transcodingUsers.length,delete n.transcodingUsers);const s=(n.userConfigs||[]).map(d=>typeof d.uid=="number"?ye.resolve(d.uid):wV(d.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await ye.all(s)).forEach((d,h)=>{n.userConfigs&&n.userConfigs[h]&&(n.userConfigs[h].uid=d)}),this.transcodingConfig=n,this.connection)try{var c;const d=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(Pi(c=this.streamingTasks).call(c)).map(h=>h.taskId).join("#")});R.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(d.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(d){if(!d.data||!d.data.retry)throw d;d.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(h=>{R.warning("[".concat(this.spec.clientId,"] live streaming receive error"),d.toString(),"try to republish",h.url),this.startLiveStreamingTask(h.url,h.mode,d).then(()=>{R.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(h.url," success"))}).catch(p=>{R.error("[".concat(this.spec.clientId,"] live streaming republish failed"),h.url,p.toString()),this.onLiveStreamError&&this.onLiveStreamError(h.url,p)})})}}async startLiveStreamingTask(t,n,o){if(!this.transcodingConfig&&n===qa.TRANSCODE)throw new ee(j.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");const s={command:"PublishStream",ts:Date.now(),url:t,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};R.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(t,", mode: ").concat(n));const c=await this.taskMutex.lock();if(!this.connection&&o)return void c();if(this.streamingTasks.get(t)&&!o)return c(),new ee(j.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(n))}catch(h){throw c(),h}switch(n){case qa.TRANSCODE:s.transcodingConfig=vi({},this.transcodingConfig)}this.uapResponse&&this.uapResponse.vid&&(s.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const d=this.lastTaskId++;try{const h=new ye((m,g)=>{cr(this.retryTimeout).then(()=>{if(o)return g(o);const E=this.statusError.get(t);return E?(this.statusError.delete(t),g(E)):void 0})}),p=await ye.race([this.connection.request("request",{clientRequest:s},!0,{url:t,command:"PublishStream",workerType:n===qa.TRANSCODE?1:2,requestByUser:!o,tid:d.toString()}),h]);this.isStartingStreamingTask=!1,R.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(p.code)),this.streamingTasks.set(t,{clientRequest:s,mode:n,url:t,taskId:d}),c()}catch(h){if(c(),this.isStartingStreamingTask=!1,!h.data||!h.data.retry||o)throw h;return h.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(t,n,h)):await this.startLiveStreamingTask(t,n,h)}}stopLiveStreamingTask(t){return new ye((n,o)=>{const s=this.streamingTasks.get(t);if(!s||!this.connection)return new ee(j.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const c=s.mode;s.abortTask=()=>{R.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(t),n()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:s.url}},!1,{url:t,command:"UnPublishStream",workerType:c===qa.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(d=>{R.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(d.code)),this.streamingTasks.delete(t),this.streamingTasks.size===0&&(this.connection&&this.connection.close(),this.connection=void 0),n()}).catch(o)})}resetAllTask(){var t;const n=Array.from(Pi(t=this.streamingTasks).call(t));this.terminate();for(const o of n)this.startLiveStreamingTask(o.url,o.mode).catch(s=>{this.onLiveStreamError&&this.onLiveStreamError(o.url,s)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=oi.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(t){if(this.connection)throw new ee(j.UNEXPECTED_ERROR,"live streaming connection has already connected");const n=await Er(this,TC.REQUEST_WORKER_MANAGER_LIST,t);return this.uapResponse=n,this.connection=new $ae(n.workerToken,this.spec,this.wsRetryConfig,t),this.connection.on(Lc.WARNING,(o,s)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(s,o)),this.connection.on(Lc.PUBLISH_STREAM_STATUS,o=>this.handlePublishStreamServer(o)),this.connection.on(Lc.REQUEST_NEW_ADDRESS,(o,s)=>{if(!this.connection)return s(new ee(j.UNEXPECTED_ERROR,"can not get new live streaming address list"));Er(this,TC.REQUEST_WORKER_MANAGER_LIST,t).then(c=>{this.uapResponse=c,o(c.addressList)}).catch(s)}),await this.connection.init(n.addressList),this.connection}handlePublishStreamServer(t){const n=t.serverStatus&&t.serverStatus.url||"empty_url",o=this.streamingTasks.get(n),s=t.reason;switch(t.code){case Wn.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Wn.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Wn.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Wn.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const d=new ee(j.LIVE_STREAMING_CDN_ERROR,"",{code:t.code});if(o)return R.error(d.toString()),this.onLiveStreamError&&this.onLiveStreamError(n,d);if(!this.isStartingStreamingTask)return;this.statusError.set(n,d)}case Wn.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const d=new ee(j.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,s);return this.onLiveStreamWarning&&this.onLiveStreamWarning(n,d)}case Wn.LIVE_STREAM_RESPONSE_WORKER_LOST:case Wn.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var c;if(!this.connection)return;this.connection.tryNextAddress();const d=Array.from(Pi(c=this.streamingTasks).call(c));for(const h of d)h.abortTask?h.abortTask():(R.warning("[".concat(this.spec.clientId,"] publish stream status code"),t.code,"try to republish",h.url),this.startLiveStreamingTask(h.url,h.mode,new ee(j.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code})).then(()=>{R.debug("[".concat(this.spec.clientId,"] republish live stream success"),h.url)}).catch(p=>{R.error(p.toString()),this.onLiveStreamError&&this.onLiveStreamError(h.url,p)}));return}}}hasUrl(t){return this.streamingTasks.has(t)}}const Qae={name:"LiveStreaming",create:function(e){return new Jae(e.joinInfo,e.websocketRetryConfig||Un,e.httpRetryConfig||Un)}};function Zae(e){let t=r3();return function(n,o){let s=n.appId;s!==void 0&&(Ut(o,10),ya(o,s));let c=n.cid;c!==void 0&&(Ut(o,16),Ut(o,c));let d=n.cname;d!==void 0&&(Ut(o,26),ya(o,d));let h=n.deviceId;h!==void 0&&(Ut(o,34),ya(o,h));let p=n.elapse;p!==void 0&&(Ut(o,40),Xc(o,p));let m=n.fileSize;m!==void 0&&(Ut(o,48),Xc(o,kh(m)));let g=n.height;g!==void 0&&(Ut(o,56),Xc(o,kh(g)));let E=n.jpg;E!==void 0&&(Ut(o,66),Ut(o,E.length),function(di,se){let he=xh(di,se.length);di.bytes.set(se,he)}(o,E));let y=n.networkType;y!==void 0&&(Ut(o,72),Xc(o,kh(y)));let T=n.osType;T!==void 0&&(Ut(o,80),Xc(o,kh(T)));let P=n.requestId;P!==void 0&&(Ut(o,90),ya(o,P));let I=n.sdkVersion;I!==void 0&&(Ut(o,98),ya(o,I));let A=n.sequence;A!==void 0&&(Ut(o,104),Xc(o,kh(A)));let M=n.sid;M!==void 0&&(Ut(o,114),ya(o,M));let U=n.timestamp;U!==void 0&&(Ut(o,120),Xc(o,U));let Y=n.uid;Y!==void 0&&(Ut(o,128),Ut(o,Y));let Q=n.vid;Q!==void 0&&(Ut(o,136),Ut(o,Q));let J=n.width;J!==void 0&&(Ut(o,144),Xc(o,kh(J)));let X=n.service;X!==void 0&&(Ut(o,152),Ut(o,X));let ne=n.callbackData;ne!==void 0&&(Ut(o,162),ya(o,ne));let oe=n.jpgEncryption;oe!==void 0&&(Ut(o,168),Ut(o,oe));let me=n.requestType;me!==void 0&&(Ut(o,176),Ut(o,me));let we=n.scorePorn;we!==void 0&&(Ut(o,185),Ib(o,we));let ut=n.scoreSexy;ut!==void 0&&(Ut(o,193),Ib(o,ut));let rt=n.scoreNeutral;rt!==void 0&&(Ut(o,201),Ib(o,rt));let qe=n.scene;qe!==void 0&&(Ut(o,208),Ut(o,qe));let tn=n.ossFilePrefix;tn!==void 0&&(Ut(o,218),ya(o,tn));let zt=n.serviceVendor;if(zt!==void 0)for(let di of zt){Ut(o,226);let se=r3();nce(di,se),Ut(o,se.limit),sce(o,se),oce(se)}}(e,t),function(n){let o=n.bytes,s=n.limit;return o.length===s?o:o.subarray(0,s)}(t)}function ece(e){return function(n){let o={};e:for(;!i3(n);){let s=Sa(n);switch(s>>>3){case 0:break e;case 1:o.code=Sa(n);break;case 2:o.msg=o3(n,Sa(n));break;case 3:{let c=rce(n);o.data=tce(n),n.limit=c;break}default:t3(n,7&s)}}return o}({bytes:t=e,offset:0,limit:t.length});var t}function tce(e){let t={};e:for(;!i3(e);){let n=Sa(e);switch(n>>>3){case 0:break e;case 1:t.requestId=o3(e,Sa(e));break;case 2:t.requestType=Sa(e)>>>0;break;case 3:t.scorePorn=bb(e);break;case 4:t.scoreSexy=bb(e);break;case 5:t.scoreNeutral=bb(e);break;case 6:t.requestScene=Sa(e)>>>0;break;case 7:t.scene=Sa(e)>>>0;break;default:t3(e,7&n)}}return t}function nce(e,t){let n=e.service;n!==void 0&&(Ut(t,8),Ut(t,n));let o=e.vendor;o!==void 0&&(Ut(t,16),Ut(t,o));let s=e.token;s!==void 0&&(Ut(t,26),ya(t,s));let c=e.callbackUrl;c!==void 0&&(Ut(t,34),ya(t,c))}function rce(e){let t=Sa(e),n=e.limit;return e.limit=e.offset+t,n}function t3(e,t){switch(t){case 0:for(;128&s3(e););break;case 2:Rb(e,Sa(e));break;case 5:Rb(e,4);break;case 1:Rb(e,8);break;default:throw new Error("Unimplemented type: "+t)}}let ice=new Float32Array(1);new Uint8Array(ice.buffer);let wb=new Float64Array(1),yi=new Uint8Array(wb.buffer);function kh(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let n3=[];function r3(){const e=n3.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}function oce(e){n3.push(e)}function Rb(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function i3(e){return e.offset>=e.limit}function xh(e,t){let n=e.bytes,o=e.offset,s=e.limit,c=o+t;if(c>n.length){let d=new Uint8Array(2*c);d.set(n),e.bytes=d}return e.offset=c,c>s&&(e.limit=c),o}function Cb(e,t){let n=e.offset;if(n+t>e.limit)throw new Error("Read past limit");return e.offset+=t,n}function o3(e,t){let n=Cb(e,t),o=String.fromCharCode,s=e.bytes,c="�",d="";for(let h=0;h<t;h++){let p,m,g,E,y=s[h+n];128&y?(224&y)==192?h+1>=t?d+=c:(p=s[h+n+1],(192&p)!=128?d+=c:(E=(31&y)<<6|63&p,E<128?d+=c:(d+=o(E),h++))):(240&y)==224?h+2>=t?d+=c:(p=s[h+n+1],m=s[h+n+2],(49344&(p|m<<8))!=32896?d+=c:(E=(15&y)<<12|(63&p)<<6|63&m,E<2048||E>=55296&&E<=57343?d+=c:(d+=o(E),h+=2))):(248&y)==240?h+3>=t?d+=c:(p=s[h+n+1],m=s[h+n+2],g=s[h+n+3],(12632256&(p|m<<8|g<<16))!=8421504?d+=c:(E=(7&y)<<18|(63&p)<<12|(63&m)<<6|63&g,E<65536||E>1114111?d+=c:(E-=65536,d+=o(55296+(E>>10),56320+(1023&E)),h+=3))):d+=c:d+=o(y)}return d}function ya(e,t){let n=t.length,o=0;for(let d=0;d<n;d++){let h=t.charCodeAt(d);h>=55296&&h<=56319&&d+1<n&&(h=(h<<10)+t.charCodeAt(++d)-56613888),o+=h<128?1:h<2048?2:h<65536?3:4}Ut(e,o);let s=xh(e,o),c=e.bytes;for(let d=0;d<n;d++){let h=t.charCodeAt(d);h>=55296&&h<=56319&&d+1<n&&(h=(h<<10)+t.charCodeAt(++d)-56613888),h<128?c[s++]=h:(h<2048?c[s++]=h>>6&31|192:(h<65536?c[s++]=h>>12&15|224:(c[s++]=h>>18&7|240,c[s++]=h>>12&63|128),c[s++]=h>>6&63|128),c[s++]=63&h|128)}}function sce(e,t){let n=xh(e,t.limit),o=e.bytes,s=t.bytes;for(let c=0,d=t.limit;c<d;c++)o[c+n]=s[c]}function s3(e){return e.bytes[Cb(e,1)]}function a3(e,t){let n=xh(e,1);e.bytes[n]=t}function bb(e){let t=Cb(e,8),n=e.bytes;return yi[0]=n[t++],yi[1]=n[t++],yi[2]=n[t++],yi[3]=n[t++],yi[4]=n[t++],yi[5]=n[t++],yi[6]=n[t++],yi[7]=n[t++],wb[0]}function Ib(e,t){let n=xh(e,8),o=e.bytes;wb[0]=t,o[n++]=yi[0],o[n++]=yi[1],o[n++]=yi[2],o[n++]=yi[3],o[n++]=yi[4],o[n++]=yi[5],o[n++]=yi[6],o[n++]=yi[7]}function Sa(e){let t,n=0,o=0;do t=s3(e),n<32&&(o|=(127&t)<<n),n+=7;while(128&t);return o}function Ut(e,t){for(t>>>=0;t>=128;)a3(e,127&t|128),t>>>=7;a3(e,t)}function Xc(e,t){let n=t.low>>>0,o=(t.low>>>28|t.high<<4)>>>0,s=t.high>>>24,c=s===0?o===0?n<16384?n<128?1:2:n<1<<21?3:4:o<16384?o<128?5:6:o<1<<21?7:8:s<128?9:10,d=xh(e,c),h=e.bytes;switch(c){case 10:h[d+9]=s>>>7&1;case 9:h[d+8]=c!==9?128|s:127&s;case 8:h[d+7]=c!==8?o>>>21|128:o>>>21&127;case 7:h[d+6]=c!==7?o>>>14|128:o>>>14&127;case 6:h[d+5]=c!==6?o>>>7|128:o>>>7&127;case 5:h[d+4]=c!==5?128|o:127&o;case 4:h[d+3]=c!==4?n>>>21|128:n>>>21&127;case 3:h[d+2]=c!==3?n>>>14|128:n>>>14&127;case 2:h[d+1]=c!==2?n>>>7|128:n>>>7&127;case 1:h[d]=c!==1?128|n:127&n}}function c3(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,o)}return n}const ace=new Map([["moderation",1],["supervise",2]]);class cce extends pn{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;const n=this._connectionState;this._connectionState=t,this.emit(rr.CONNECTION_STATE_CHANGE,n,t)}get inspectType(){return this._inspectType}set inspectType(t){var n;this._inspectMode=Fo(n=t.map(o=>ace.get(o)||0)).call(n,(o,s)=>o+s),this._inspectType=t}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(t){super(),x(this,"name","AgoraRTCVideoContentInspect"),x(this,"_connectionState",Qo.CONNECTING),x(this,"_innerConnectionState",void 0),x(this,"sequence",0),x(this,"inspectStartTime",void 0),x(this,"workerManagerConnection",void 0),x(this,"workerConnection",void 0),x(this,"workerMessageLengthLimit",void 0),x(this,"inspectIntervalMinimum",void 0),x(this,"qualityRatio",void 0),x(this,"_connectInfo",void 0),x(this,"_cancelTokenSource",oi.CancelToken.source()),x(this,"_retryConfig",void 0),x(this,"wmSequence",0),x(this,"inspectInterval",void 0),x(this,"inspectTimer",null),x(this,"ossFilePrefix",void 0),x(this,"extraInfo",void 0),x(this,"_inspectType",void 0),x(this,"_inspectMode",void 0),x(this,"_quality",1),x(this,"qualityTimer",null),x(this,"_inspectId",void 0),x(this,"_needWorkUrlOnly",!1),x(this,"inspectImage",()=>{if(this.connectionState!==Qo.CONNECTED)throw new ee(j.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===Qo.CONNECTED?this.requestToInspectImage():R.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=Jt(5,"inspect-"),this.workerMessageLengthLimit=H("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=H("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=H("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=t.interval,this.ossFilePrefix=t.ossFilePrefix,this.extraInfo=t.extraInfo,this.inspectType=t.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new zf("worker-manager-"+this._inspectId,Un),this.on(rr.STATE_CHANGE,(n,o)=>{this._innerConnectionState=n,R.debug("[".concat(this._inspectId,"] Inspect operation :").concat(Zo[n]," ").concat(o||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new zf("worker-"+this._inspectId,Un),this.handleWorkerEvents()}async init(t,n){this.emit(rr.STATE_CHANGE,Zo.CONNECT_AP),this._connectInfo=t;const o=this._cancelTokenSource.token;return this._retryConfig=n,new ye((s,c)=>{this.on(rr.CONNECTION_STATE_CHANGE,(d,h)=>{h===Qo.CONNECTED&&s()}),this.requestAP(t,o,n).then(d=>{this.connectWorkerManager(d)}).catch(d=>{c(d)})})}async requestAP(t,n,o){const s=H("WEBCS_DOMAIN").map(h=>"https://".concat(h,"/api/v1")),c=await function(h,p,m,g){let{appId:E,areaCode:y,cname:T,sid:P,token:I,uid:A}=p;Th++;const M="image_moderation_api",U={service_name:M,json_body:JSON.stringify({appId:E,areaCode:y,cname:T,command:"allocateEdge",requestId:Th,seq:Th,sid:P,token:I,ts:Date.now(),uid:A+""})};let Y,Q,J=h[0];return ws(async()=>{Y=Date.now();const X=await As(J,{data:U,cancelToken:m,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(Q=Date.now()-Y,X.code!==0){const we=new ee(j.UNEXPECTED_RESPONSE,"image inspect ap error, code"+X.code,{retry:!0,responseTime:Q});throw R.error(we.toString()),we}const ne=JSON.parse(X.json_body);if(ne.code!==200){const we=new ee(j.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(ne.code,", reason: ").concat(ne.reason),{code:ne.code,responseTime:Q});throw R.error(we.toString()),we}if(!ne.servers||!Array.isArray(ne.servers)||ne.servers.length===0){const we=new ee(j.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:ne.code,responseTime:Q});throw R.error(we.toString()),we}const oe=H("VIDEO_INSPECT_WORKER_MANAGER_HOST"),me=H("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:ne.servers.map(we=>{let{address:ut,wss:rt}=we;if(ut&&rt)return"wss://".concat(ut.replace(/\./g,"-"),".").concat(oe,":").concat(me||rt)}).filter(we=>!!we),workerToken:ne.workerToken,vid:ne.vid,responseTime:Q}},(X,ne)=>(ke.apworkerEvent(P,{success:!0,sc:200,serviceName:M,responseDetail:JSON.stringify(X.addressList),firstSuccess:ne===0,responseTime:Q,serverIp:h[ne%h.length]}),!1),(X,ne)=>(ke.apworkerEvent(P,{success:!1,sc:X.data&&X.data.code||200,serviceName:M,responseTime:Q,serverIp:h[ne%h.length]}),!!(X.code!==j.OPERATION_ABORTED&&X.code!==j.UNEXPECTED_RESPONSE||X.data&&X.data.retry)&&(J=h[(ne+1)%h.length],!0)),g)}(s,t,n,o);this.emit(rr.STATE_CHANGE,Zo.AP_CONNECTED);const{addressList:d}=c;return this.wmSequence++,d}async connectWorkerManager(t){let n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=n,this.emit(rr.STATE_CHANGE,Zo.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(t,1e4)}async connectWorker(t){await this.workerConnection.init([t])}handleWorkerManagerEvents(){this.workerManagerConnection.on(tt.CONNECTED,async()=>{this.emit(rr.STATE_CHANGE,Zo.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.23.3",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(tt.CLOSED,()=>{this._innerConnectionState<Zo.GET_WORKER_MANAGER_RESPONSE&&R.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(tt.FAILED,()=>{this._innerConnectionState<Zo.GET_WORKER_MANAGER_RESPONSE&&R.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(tt.RECONNECTING,()=>{this._innerConnectionState<Zo.GET_WORKER_MANAGER_RESPONSE&&R.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(tt.ON_MESSAGE,async t=>{this.emit(rr.STATE_CHANGE,Zo.GET_WORKER_MANAGER_RESPONSE);const n=this.workerManagerConnection.url;this.workerManagerConnection.close();const o=JSON.parse(t.data);if(o.code!==200)throw R.error("[".concat(this._inspectId,"] Unexpected code ").concat(o.code," from worker manager")),new ee(j.UNEXPECTED_RESPONSE,"response code of worker is unexpected",o);if(!(o.serverResponse&&o.serverResponse.portWss&&n))throw R.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(o))),new ee(j.UNEXPECTED_RESPONSE,"response content of worker is unexpected",o);{const s=H("VIDEO_INSPECT_WORKER_PORT")||o.serverResponse.portWss,c=n.replace(/:\d+\/?$/,":".concat(s));this.emit(rr.STATE_CHANGE,Zo.CONNECT_WORKER,c),this._needWorkUrlOnly?this.emit(rr.REQUEST_NEW_WORKER_URL,c):await this.connectWorker(c)}}),this.workerManagerConnection.on(tt.WILL_RECONNECT,(t,n,o)=>{o(t)}),this.workerManagerConnection.on(tt.REQUEST_NEW_URLS,(t,n)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(n)})}handleWorkerEvents(){this.workerConnection.on(tt.CONNECTED,async()=>{this.emit(rr.STATE_CHANGE,Zo.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=Qo.CONNECTED}),this.workerConnection.on(tt.ON_MESSAGE,async t=>{if(t.data instanceof ArrayBuffer){const o=ece(new Uint8Array(t.data));if(H("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&R.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(o)),o.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(rr.INSPECT_RESULT,void 0,void 0);if(o.data&&o.data.scorePorn&&o.data.scoreSexy&&o.data.scoreNeutral){var n;const s={porn:o.data.scorePorn,sexy:o.data.scoreSexy,neutral:o.data.scoreNeutral},c=Fo(n=Object.keys(s)).call(n,(h,p)=>s[h]>s[p]?h:p,"porn"),d=Object.keys(s).find(h=>h===c);this.emit(rr.INSPECT_RESULT,d)}else this.emit(rr.INSPECT_RESULT,void 0,new ee(j.UNEXPECTED_RESPONSE,o.code+"","There is an unexpected data on message"))}else this.emit(rr.INSPECT_RESULT,void 0,new ee(j.UNEXPECTED_RESPONSE,o.code+"",o.msg))}else R.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(rr.INSPECT_RESULT,void 0,new ee(j.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(tt.CLOSED,()=>{this.connectionState=Qo.CLOSED}),this.workerConnection.on(tt.FAILED,()=>{this.connectionState=Qo.CLOSED}),this.workerConnection.on(tt.RECONNECTING,()=>{this.connectionState=this.connectionState===Qo.CONNECTED?Qo.RECONNECTING:Qo.CONNECTING}),this.workerConnection.on(tt.WILL_RECONNECT,(t,n,o)=>{t==="recover"&&o(t),o("tryNext")}),this.workerConnection.on(tt.REQUEST_NEW_URLS,(t,n)=>{this.workerManagerConnection.close(),this.once(rr.REQUEST_NEW_WORKER_URL,o=>{t([o])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(o=>{this.connectWorkerManager(o,!0)}).catch(o=>{n(o)})})}async requestToInspectImage(){this.sequence++;const t=Yi(this,rr.CLIENT_LOCAL_VIDEO_TRACK),n={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void this.emit(rr.INSPECT_RESULT,void 0,new ee(j.INVALID_OPERATION,"Only the track being played can be inspected"));const o=await this.generateRequestData(t,n);this.workerConnection.sendMessage(o,!0,!0)}else this.emit(rr.INSPECT_RESULT,void 0,new ee(j.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(t,n){let{appId:o,cname:s,cid:c,vid:d,sid:h,uid:p}=n;const m=Date.now(),g=await t.getCurrentFrameImage("image/jpeg",this.quality),E=await HM(g,o,s),y=this.sequence+"-"+c+"-"+p+"-"+m+"-"+Jt(12,""),T={appId:o,cid:c,cname:s,deviceId:"",elapse:(P=Number(m-this.inspectStartTime),{low:P|=0,high:P>>31,unsigned:P>=0}),fileSize:E.byteLength,jpgEncryption:2,height:g.height,width:g.width,jpg:E,networkType:6,osType:7,requestId:y,sdkVersion:"4.23.3",sequence:this.sequence,sid:h,timestamp:gF(m),uid:p,vid:d,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};var P;this.extraInfo===void 0&&delete T.callbackData,this.ossFilePrefix===void 0&&delete T.ossFilePrefix;const I=Zae(T);if(I.byteLength<this.workerMessageLengthLimit){if(H("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const A=function(M){for(var U=1;U<arguments.length;U++){var Y=arguments[U]!=null?arguments[U]:{};U%2?c3(Object(Y),!0).forEach(function(Q){x(M,Q,Y[Q])}):Object.getOwnPropertyDescriptors?Object.defineProperties(M,Object.getOwnPropertyDescriptors(Y)):c3(Object(Y)).forEach(function(Q){Object.defineProperty(M,Q,Object.getOwnPropertyDescriptor(Y,Q))})}return M}({},T);delete A.jpg,R.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(A))}return I}{const A=this.quality*this.qualityRatio;return this.quality=A,await this.generateRequestData(t,{appId:o,cname:s,cid:c,vid:d,sid:h,uid:p})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=oi.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=Qo.CLOSED,this.emit(rr.STATE_CHANGE,Zo.CLOSED)}}const lce={name:"ContentInspect",create:function(e){let{config:t}=e;return function(n){if(!n)throw new ee(j.INVALID_PARAMS,"inspectConfig is necessary.");if(!n.inspectType||!Array.isArray(n.inspectType))throw new ee(j.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{const o=[...new Set(n.inspectType)];o.forEach(s=>{var c;if(!Ee(c=["supervise","moderation"]).call(c,s))throw new ee(j.INVALID_PARAMS,"".concat(s," is not a valid inspect type."))}),n.inspectType=o}if(n&&n.extraInfo&&n.extraInfo.length>1024)throw new ee(j.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")}(t),new cce(t)}};var l3=u(wn.Object.getOwnPropertySymbols),dce=Mt,uce=F0.indexOf,hce=Jg,Ab=_e([].indexOf),d3=!!Ab&&1/Ab([1],1,-0)<0;dce({target:"Array",proto:!0,forced:d3||!hce("indexOf")},{indexOf:function(e){var t=arguments.length>1?arguments[1]:void 0;return d3?Ab(this,e,t)||0:uce(this,e,t)}});var pce=Vo("Array","indexOf"),fce=O,mce=pce,Nb=Array.prototype,gce=function(e){var t=e.indexOf;return e===Nb||fce(Nb,e)&&t===Nb.indexOf?mce:t},u3=u(gce);function _ce(e,t){if(e==null)return{};var n,o,s=function(d,h){if(d==null)return{};var p={};for(var m in d)if({}.hasOwnProperty.call(d,m)){if(u3(h).call(h,m)!==-1)continue;p[m]=d[m]}return p}(e,t);if(l3){var c=l3(e);for(o=0;o<c.length;o++)n=c[o],u3(t).call(t,n)===-1&&{}.propertyIsEnumerable.call(e,n)&&(s[n]=e[n])}return s}let h3=class{get localCapabilities(){return fn(this._localCapabilities)}get rtpCapabilities(){return fn(this._rtpCapabilities)}get candidates(){return fn(this._candidates)}get iceParameters(){return fn(this._iceParameters)}get dtlsParameters(){return fn(this._dtlsParameters)}constructor(e){x(this,"sessionDesc",void 0),x(this,"_localCapabilities",void 0),x(this,"_rtpCapabilities",void 0),x(this,"_candidates",void 0),x(this,"_iceParameters",void 0),x(this,"_dtlsParameters",void 0),x(this,"setup",void 0),x(this,"currentMidIndex",void 0),x(this,"cname","o/i14u9pJrxRKAsu"),x(this,"firefoxSsrcMidMap",new Map),e=fn(e);const{remoteIceParameters:t,remoteDtlsParameters:n,candidates:o,remoteRTPCapabilities:s,localCapabilities:c,direction:d,setup:h,videoCodec:p,audioCodec:m}=e;let g;this.setup=h,g=d===ei.RECEIVE_ONLY?_i(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):_i(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=s,this._candidates=o,this._iceParameters=t,this._dtlsParameters=n,this._localCapabilities=c;const E=d===ei.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,y=d===ei.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,T=d===ei.RECEIVE_ONLY?s.send.videoCodecs:qf(Re.VIDEO,E,y,p),P=d===ei.RECEIVE_ONLY?s.send.audioCodecs:qf(Re.AUDIO,E,y,m);for(const I of g.mediaDescriptions)I.attributes.iceUfrag=t.iceUfrag,I.attributes.icePwd=t.icePwd,I.attributes.fingerprints=n.fingerprints,I.attributes.candidates=o,I.attributes.setup=this.setup,I.media.mediaType==="application"&&(I.attributes.sctpPort="5000"),I.media.mediaType==="video"&&(I.media.fmts=T.map(A=>A.payloadType.toString(10)),I.attributes.payloads=T,I.attributes.extmaps=E.videoExtensions),I.media.mediaType==="audio"&&(I.media.fmts=P.map(A=>A.payloadType.toString(10)),I.attributes.payloads=P,I.attributes.extmaps=E.audioExtensions,Sh(I));this.sessionDesc=g,this.currentMidIndex=g.mediaDescriptions.length-1}toString(){return xc(this.sessionDesc)}hasMid(e){return Array.isArray(e)?e.every(t=>this.hasMid(t)):this.sessionDesc.mediaDescriptions.some(t=>t.attributes.mid===e)}send(e,t,n,o,s){n=n.replace(/ /g,"-");const{ssrcs:c,ssrcGroups:d}=fd(t,this.cname,H("SYNC_GROUP")?n:void 0),h=this.findPreloadMediaDesc(c);if(h){if(gn()&&this.firefoxSsrcMidMap.set(c[0].ssrcId,h.attributes.mid),s&&(s.twcc||s.remb)){const p=this.sessionDesc.mediaDescriptions.indexOf(h);return this.sessionDesc.mediaDescriptions[p]=this.mungSendMediaDesc(h,s),{mid:h.attributes.mid,needExchangeSDP:!0}}return{mid:h.attributes.mid,needExchangeSDP:!1}}{const p=this.findAvailableMediaIndex(e,c,o);let m;return p===-1?(m=this.createOrRecycleSendMedia(e,c,d,"sendonly",o,s),this.updateBundleMids()):(m=fn(this.sessionDesc.mediaDescriptions[p]),m.attributes.direction="sendonly",m.attributes.ssrcs=c,m.attributes.ssrcGroups=d,this.sessionDesc.mediaDescriptions[p]=this.mungSendMediaDesc(m,s)),gn()&&this.firefoxSsrcMidMap.set(c[0].ssrcId,m.attributes.mid),{needExchangeSDP:!0,mid:m.attributes.mid}}}stopSending(e){const t=this.sessionDesc.mediaDescriptions.filter(n=>n.attributes.mid&&e.indexOf(n.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach(n=>{n.attributes.ssrcs=[]}),this.updateBundleMids()}receive(e,t,n){const o=[];return e.forEach(s=>{const c=s._mediaStreamTrack.kind,d=this.findAvailableRecvMediaIndex(c);let h,p=!1;d===-1?(p=!0,h=this.createOrRecycleRecvMedia(s,[],"recvonly",t,n),this.updateBundleMids()):(h=fn(this.sessionDesc.mediaDescriptions[d]),h.attributes.direction="recvonly"),o.push({mid:h.attributes.mid,needCreateTransceiver:p})}),o}stopReceiving(e){const t=this.sessionDesc.mediaDescriptions.filter(n=>e.indexOf(n.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach(n=>{n.media.port="0",n.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(e){const{foundation:t,protocol:n,address:o,port:s,type:c,relatedAddress:d,relatedPort:h,priority:p}=new RTCIceCandidate(e),m={foundation:t??"",componentId:"1",transport:n??"",priority:p?p+"":"",connectionAddress:o??"",port:s?s+"":"",type:c?c+"":"",relAddr:d??"",relPort:h?h+"":"",extension:{}};this.candidates.some(g=>g.priority===m.priority&&g.connectionAddress===m.connectionAddress&&g.port===m.port)||(this._candidates.push(m),this.sessionDesc.mediaDescriptions.forEach(g=>{g.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(e,t,n,o,s){const c=e._mediaStreamTrack.kind,d=this.rtpCapabilities.recv,h=qf(c,d,this.localCapabilities.send,c===Re.AUDIO?s:o),p=c===Re.VIDEO?d.videoExtensions:d.audioExtensions,m="".concat(++this.currentMidIndex);let g={media:{mediaType:c,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:h.map(y=>y.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:p,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:h,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:n,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(m)}};g=this.mungRecvMediaDsec(g,e);const E=this.findFirstClosedMedia(c);if(E){const y=this.sessionDesc.mediaDescriptions.indexOf(E);this.sessionDesc.mediaDescriptions[y]=g}else this.sessionDesc.mediaDescriptions.push(g);return g}muteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter(n=>Ee(e).call(e,n.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(n=>{n.attributes.direction="inactive"})}unmuteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter(n=>Ee(e).call(e,n.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(n=>{n.attributes.direction="recvonly"})}findAvailableMediaIndex(e,t,n){return this.sessionDesc.mediaDescriptions.findIndex(o=>{const s=o.media.mediaType===e&&o.media.port!=="0"&&(o.attributes.direction==="sendonly"||o.attributes.direction==="sendrecv")&&o.attributes.ssrcs.length===0;if(gn()){if(s){const c=this.firefoxSsrcMidMap.get(t[0].ssrcId);return!(c||o.attributes.mid!=="0"&&o.attributes.mid!=="1")||!(!c||c!==o.attributes.mid)}return!1}return s&&o.attributes.mid===n})}findAvailableRecvMediaIndex(e){return this.sessionDesc.mediaDescriptions.findIndex(t=>{const n=t.media.mediaType===e&&t.media.port!=="0"&&(t.attributes.direction==="recvonly"||t.attributes.direction==="sendrecv");return t.attributes.mid!=="0"&&t.attributes.mid!=="1"&&n})}predictReceivingMids(e){const t=[];for(let n=0;n<e;n++)t.push((this.currentMidIndex+n+1).toString(10));return t}restartICE(e){e=fn(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd})}createOrRecycleSendMedia(e,t,n,o,s,c){const d=this.rtpCapabilities.send,h=e===Re.VIDEO?d.videoCodecs:d.audioCodecs,p=e===Re.VIDEO?d.videoExtensions:d.audioExtensions;gn()&&(s="".concat(++this.currentMidIndex));let m={media:{mediaType:e,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:h.map(E=>E.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:p,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:n,rtcpFeedbackWildcards:[],payloads:h,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:o,rtcpMux:!0,rtcpRsize:!0,mid:s}};m=this.mungSendMediaDesc(m,c);const g=this.findFirstClosedMedia(e);if(g){const E=this.sessionDesc.mediaDescriptions.indexOf(g);this.sessionDesc.mediaDescriptions[E]=m}else this.sessionDesc.mediaDescriptions.push(m);return m}mungRecvMediaDsec(e,t,n){const o=fn(e);return AC(o),yh(o,t),NC(o,t),rV(o),rv(o,n,this.localCapabilities.send),o}mungSendMediaDesc(e,t){const n=fn(e);return rv(n,t,this.localCapabilities.recv),Sh(n),n}updateRecvMedia(e,t){const n=this.sessionDesc.mediaDescriptions.findIndex(o=>o.attributes.mid===e);if(n!==-1){const o=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],t);this.sessionDesc.mediaDescriptions[n]=o}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(e=>e.media.port!=="0").map(e=>e.attributes.mid)}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find(t=>{var n;return((n=t.attributes)===null||n===void 0||(n=n.ssrcs[0])===null||n===void 0?void 0:n.ssrcId)===e[0].ssrcId})}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find(t=>gn()?t.media.port==="0"&&t.media.mediaType===e:t.media.port==="0")}};const Ece=["sdp"];var rn;function p3(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,o)}return n}function $c(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?p3(Object(n),!0).forEach(function(o){x(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):p3(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}let f3=(rn=class Bh extends Vj{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,n;return(t=(n=this.peerConnection.getReceivers()[0])===null||n===void 0||(n=n.transport)===null||n===void 0?void 0:n.state)!==null&&t!==void 0?t:null}get localCodecs(){return[]}set isInRestartIce(t){this._isInRestartIce=t}get isInRestartIce(){return this._isInRestartIce}constructor(t,n,o){super(t,n),x(this,"direction",void 0),x(this,"name",void 0),x(this,"store",void 0),x(this,"spec",void 0),x(this,"peerConnection",void 0),x(this,"initialOffer",void 0),x(this,"transport",void 0),x(this,"statsFilter",void 0),x(this,"localCandidateCount",0),x(this,"_isInRestartIce",!1),x(this,"mutex",void 0),x(this,"onLocalCandidate",void 0),x(this,"remoteSDP",void 0),x(this,"pendingCandidates",[]),x(this,"localCapabilities",void 0),x(this,"isReady",!1),x(this,"restartCnt",0),x(this,"curTurnServerIndex",0),this.store=n,this.spec=t,this.mutex=new Ir("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(Bh.resolvePCConfiguration(t,n.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=o??ei.SEND_ONLY,this.name=this.direction===ei.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=BR(this.peerConnection,H("STATS_UPDATE_INTERVAL"),void 0,gn()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(t){try{const n=await oV();if(this.localCapabilities=iv(n),t){const{sdp:o}=t,s=_ce(t,Ece),c=function(){const g={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},E=Yf(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),y={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},T={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},P={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(es(E,g,"videoExtensions",y,T,P),es(E,g,"videoCodecs",y,T,P),es(E,g,"audioExtensions",y,T,P),es(E,g,"audioCodecs",y,T,P),H("RAISE_H264_BASELINE_PRIORITY")){const I=P.videoCodecs.findIndex(A=>A.rtpMap&&A.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&A.fmtp&&A.fmtp.parameters["profile-level-id"]==="42001f");if(I!==-1){const A=P.videoCodecs.findIndex(M=>M.rtpMap&&M.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(A<I){R.debug("raising H264 baseline profile priority");const M=P.videoCodecs[I];P.videoCodecs.splice(I,1),P.videoCodecs.splice(A,0,M)}A!==-1&&H("FILTER_SEND_H264_BASELINE")&&(y.videoCodecs=y.videoCodecs.filter(M=>!(M.rtpMap&&M.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&M.fmtp&&M.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:y,recv:T,sendrecv:P}}({},{},o);this.remoteSDP=new h3({remoteIceParameters:s.iceParameters,remoteDtlsParameters:s.dtlsParameters,candidates:[],remoteRTPCapabilities:c,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;const d=await this.peerConnection.createAnswer();if(!d.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");const h=Vc(d.sdp);await this.peerConnection.setLocalDescription(d);const p=await sV({},{},d.sdp);this.localCapabilities=iv(p);const m=this.peerConnection.getTransceivers()[0];return m!=null&&m.receiver&&m.receiver.transport&&this.tryBindTransportEvents(m.receiver.transport),$c($c({},h),{},{sdp:d.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});const o=await this.peerConnection.createOffer();if(!o.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const s=Vc(o.sdp);return this.initialOffer=o,$c($c({},s),{},{sdp:o.sdp})}}catch(n){throw new re(j.GET_LOCAL_CONNECTION_PARAMS_FAILED,n.toString())}}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);const{sdp:n,iceParameters:o,dtlsParameters:s}=t,c=await sV({},{},n);this.remoteSDP=new h3({remoteIceParameters:o,remoteDtlsParameters:s,candidates:[],remoteRTPCapabilities:c,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});const d=this.peerConnection.getTransceivers()[0];d!=null&&d.sender&&d.sender.transport&&this.tryBindTransportEvents(d.sender.transport)}catch(n){throw new re(j.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(n.toString()))}}async addRemoteCandidate(t){try{t&&this.pendingCandidates.push(t),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(n=>{this.peerConnection.addIceCandidate(n)}),this.pendingCandidates=[])}catch(n){throw new re(j.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(n.toString()))}}send(t,n,o){var s=this;return ho(function*(){const c=yield Tt(s.mutex.lock("From P2PConnection.send"));try{if(!s.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const d=[],h=s.remoteSDP.receive(t,n,o);t.forEach((A,M)=>{if(h[M].needCreateTransceiver){const U=s.peerConnection.addTransceiver(A._mediaStreamTrack,{direction:"sendonly"});d.push(U),A._updateRtpTransceiver(U)}else{const U=s.peerConnection.getTransceivers().find(Y=>Y.mid===h[M].mid);if(!U)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(h[M].mid));d.push(U),A._updateRtpTransceiver(U)}}),gn()&&H("SIMULCAST")===!0&&(yield Tt(s.applySimulcastForFirefox(d,t)));const p=h.map(A=>A.mid),m=yield Tt(s.peerConnection.createOffer()),g=s.mungSendOfferSDP(m.sdp,t,p),E=_i(g),y=p.map(A=>{const M=E.mediaDescriptions.find(U=>U.attributes.mid===A);if(!M)throw new Error("Cannot extract ssrc from mediaDescription.");return eV(M,H("USE_PUB_RTX"))}),T=d.map((A,M)=>{const U=p[M];return{localSSRC:y[M],id:U}});yield Tt(s.peerConnection.setLocalDescription({type:"offer",sdp:g}));try{yield T}catch(A){const M=s.remoteSDP.toString();throw yield Tt(s.peerConnection.setLocalDescription({type:"offer",sdp:g})),yield Tt(s.peerConnection.setRemoteDescription({type:"answer",sdp:M})),yield Tt(s.stopSending(p,!0)),A}yield Tt(s.applySimulcastEncodings(d,t)),yield Tt(s.applySendEncodings(d,t));const P=s.remoteSDP.toString(),I=s.logSDPExchange(g,"offer","local","send");return I==null||I(P),yield Tt(s.setRemoteDescription({type:"answer",sdp:P})),d.map((A,M)=>{const U=p[M];return{localSSRC:y[M],id:U}})}catch(d){throw d instanceof re?d:new re(j.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(d.toString()))}finally{c()}})()}async stopSending(t,n){const o=n?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const s=this.peerConnection.getTransceivers().filter(p=>t.indexOf(p.mid)!==-1);if(s.length!==t.length)throw new Error("Transceivers' length (".concat(s.length,") doesn't match mids' length (").concat(t.length,") when trying to call P2PConnection.stopSending."));s.map(p=>{var m;p.direction="inactive",(m=p.stop)===null||m===void 0||m.call(p)});const c=await this.peerConnection.createOffer(),d=this.logSDPExchange(c.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(c),this.remoteSDP.stopReceiving(t);const h=this.remoteSDP.toString();d==null||d(h),await this.setRemoteDescription({type:"answer",sdp:h})}catch(s){throw new re(j.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(s.toString()))}finally{o&&o()}}async receive(t,n,o,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:c,needExchangeSDP:d}=this.remoteSDP.send(t,n,o,s);if(d){const p=this.remoteSDP.toString(),m=this.logSDPExchange(p,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:p});const g=await this.peerConnection.createAnswer(),E=this.mungReceiveAnswerSDP(g.sdp,c,t);m==null||m(E||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:E}),R.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else R.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."));const h=this.peerConnection.getTransceivers().find(p=>p.mid===c);if(!h||h.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:h.receiver.track,mid:h.mid,transceiver:h}}catch(c){throw new re(j.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(c.toString()))}}async mockReceive(t,n,o,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:c,needExchangeSDP:d}=this.remoteSDP.send(t,n,o,s);if(d){const h=this.remoteSDP.toString(),p=this.logSDPExchange(h,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:h});const m=await this.peerConnection.createAnswer(),g=this.mungReceiveAnswerSDP(m.sdp,c,t);p==null||p(g||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:g}),R.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else R.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."))}catch(c){throw new re(j.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(c.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);const n=this.remoteSDP.toString(),o=this.logSDPExchange(n,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:n});const s=await this.peerConnection.createAnswer();o==null||o(s.sdp||""),await this.peerConnection.setLocalDescription(s)}catch(n){throw new re(j.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async restartICE(t){try{if(this.store.p2pTransport===sd.Auto&&(this.store.p2pTransport=sd.SdRtn,Rt().supportPCSetConfiguration&&this.peerConnection.setConfiguration(Bh.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,Rt().supportPCSetConfiguration&&this.peerConnection.setConfiguration(Bh.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!t){this.restartCnt++,this.isReady=!1;const n=await this.peerConnection.createOffer({iceRestart:!0});if(!n.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const{iceParameters:o}=Vc(n.sdp);return this.store.descriptionStart(),this.direction===ei.SEND_ONLY&&await this.peerConnection.setLocalDescription(n),o}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(t),this.store.descriptionStart(),this.direction===ei.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});const n=await this.peerConnection.createAnswer();if(!n.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");const{iceParameters:o}=Vc(n.sdp);return await this.peerConnection.setLocalDescription(n),o}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(n){throw new re(j.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}close(){var t;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const o=await this.peerConnection.createOffer(),s=this.mungSendOfferSDP(o.sdp,[n],[t]);this.remoteSDP.updateRecvMedia(t,n);const c=this.remoteSDP.toString(),d=this.logSDPExchange(s,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:s}),d==null||d(c),await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(o){throw new re(j.EXCHANGE_SDP_FAILED,o.toString())}}async updateSendParameters(t,n){const o=this.peerConnection.getTransceivers().filter(s=>s.mid===t);o.length===1&&(this.isVP8Simulcast(n)?gn()||await this.applySimulcastEncodings(o,[n]):await this.applySendEncodings(o,[n]))}setStatsRemoteVideoIsReady(t,n){this.statsFilter.setVideoIsReady2(t,n)}async replaceTrack(t,n){const o=this.peerConnection.getTransceivers().find(s=>s.mid===n);o&&await o.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){const t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){const n=t[0].transport.iceTransport,{local:o,remote:s}=n.getSelectedCandidatePair();return{local:$c($c({},aa),{},{candidateType:o.type,protocol:o.protocol,address:o.address,port:o.port}),remote:$c($c({},aa),{},{candidateType:s.type,protocol:s.protocol,address:s.address,port:s.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t,n;Ee(t=["connected","completed"]).call(t,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(n=this.onICEConnectionStateChange)===null||n===void 0||n.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=t=>{if(t.candidate){var n;t.candidate.candidate&&((n=this.onLocalCandidate)===null||n===void 0||n.call(this,t.candidate.toJSON())),this.localCandidateCount+=1}else R.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t,n){let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const s={iceServers:[]};var c;return t.iceServers?s.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(kf(t.turnServer.servers)?s.iceServers=t.turnServer.servers:(s.iceServers&&s.iceServers.push(...Bh.turnServerConfigToIceServers(t.turnServer.servers,n,o)),H("USE_TURN_SERVER_OF_GATEWAY")&&s.iceServers&&t.turnServer.serversFromGateway&&s.iceServers.push(...Bh.turnServerConfigToIceServers(t.turnServer.serversFromGateway,n,o)),Ee(c=[sd.Relay,sd.SdRtn]).call(c,n)&&(s.iceTransportPolicy="relay"),H("FORCE_TURN_TCP")?s.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(d=>{d.forceturn&&(s.iceTransportPolicy="relay")}))),H("ENABLE_ENCODED_TRANSFORM")&&Rt().supportWebRTCEncodedTransform&&(s.encodedInsertableStreams=!0),R.debug("P2PConnection p2pTransport is ".concat(n)),s}static turnServerConfigToIceServers(t,n){let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const s=[],c=t.filter(h=>h.tcpport);R.debug("P2PConnection turnServers is ".concat(c,", current index is ").concat(o));const d=c.length>o?c[o]:c[0];switch(n){case sd.SdRtn:const h=t.filter(m=>{var g;return Ee(g=m.username).call(g,"glb:")&&m.turnServerURL==m.turnServerURL}),p=h.length>o?h[o]:h[0];p&&(s.push({username:p.username,credential:p.password,credentialType:"password",urls:"turn:".concat(Uc(p.turnServerURL),":").concat(p.tcpport,"?transport=udp")}),s.push({username:p.username,credential:p.password,credentialType:"password",urls:"turns:".concat(Uc(p.turnServerURL),":").concat(p.tcpport,"?transport=tcp")}));break;case sd.Relay:d&&(s.push({username:d.username,credential:d.password,credentialType:"password",urls:"turn:".concat(d.turnServerURL,":").concat(d.tcpport,"?transport=udp")}),s.push({username:d.username,credential:d.password,credentialType:"password",urls:"turns:".concat(Uc(d.turnServerURL),":").concat(d.tcpport,"?transport=tcp")}));break;default:d&&(s.push({username:d.username,credential:d.password,credentialType:"password",urls:"turn:".concat(d.turnServerURL,":").concat(d.tcpport,"?transport=udp")}),s.push({username:d.username,credential:d.password,credentialType:"password",urls:"turns:".concat(Uc(d.turnServerURL),":").concat(d.tcpport,"?transport=tcp")}),s.push({username:d.username,credential:d.password,credentialType:"password",urls:"stun:".concat(d.turnServerURL,":").concat(d.tcpport)}))}return s}tryBindTransportEvents(t){if(t){this.transport=t,t.onstatechange=()=>{var o;t!=null&&t.state&&((o=this.onDTLSTransportStateChange)===null||o===void 0||o.call(this,t.state))},t.onerror=o=>{var s;(s=this.onDTLSTransportError)===null||s===void 0||s.call(this,"error"in o?o.error:o)};const n=t.iceTransport;n&&(n.onstatechange=()=>{const o=t==null?void 0:t.iceTransport.state;var s;o&&((s=this.onICETransportStateChange)===null||s===void 0||s.call(this,o))},n.getSelectedCandidatePair&&(n.onselectedcandidatepairchange=()=>{if(n.getSelectedCandidatePair()){const{local:o,remote:s}=n.getSelectedCandidatePair();R.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:o.type,protocol:o.protocol}),", remote ").concat(JSON.stringify({candidateType:s.type,protocol:s.protocol,address:s.address,port:s.port})," )"))}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,n){var o;if(n||(n=this.peerConnection.getSenders().find(g=>g.track===t._mediaStreamTrack)),!n)return R.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return R.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Rt().supportSetRtpSenderParameters)return R.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const s={},c={};switch(t._optimizationMode){case"motion":s.degradationPreference="maintain-framerate";break;case"detail":s.degradationPreference="maintain-resolution";break;default:s.degradationPreference="balanced"}if(t._encoderConfig){var d;const{bitrateMax:g,frameRate:E,scaleResolutionDownBy:y}=t._encoderConfig;g&&(c.maxBitrate=1e3*g),Ee(d=t._hints).call(d,Gt.LOW_STREAM)&&(E&&(c.maxFramerate=Li(E)),y&&y>=1&&(c.scaleResolutionDownBy=y))}if(H("DSCP_TYPE")&&Ga()){var h;const g=H("DSCP_TYPE");Ee(h=["very-low","low","medium","high"]).call(h,g)&&(c.networkPriority=g)}const p=n.getParameters(),m=(o=p.encodings)===null||o===void 0?void 0:o[0];gn()&&!m&&(s.encodings=[c]),m&&Object.assign(m,c),Object.assign(p,s),R.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(p.encodings))),await n.setParameters(p)}async applySendEncodings(t,n){try{if(!Rt().supportSetRtpSenderParameters||t.length!==n.length)return;for(let o=0;o<t.length;o++){const s=t[o],c=n[o];c instanceof nn&&!this.isVP8Simulcast(c)&&await this.updateRtpSenderEncodings(c,s.sender)}}catch{R.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,n,o){const s=_i(t);return n.forEach((c,d)=>{const h=o[d],p=s.mediaDescriptions.find(m=>m.attributes.mid===h);p&&(yh(p,c),iV(p,c,this.store.codec))}),xc(s)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,n,o)=>{var s;(s=this.onFirstVideoDecoded)===null||s===void 0||s.call(this,t,n,o)},this.statsFilter.onSelectedLocalCandidateChanged=(t,n)=>{var o;(o=this.onSelectedLocalCandidateChanged)===null||o===void 0||o.call(this,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,n)=>{var o;(o=this.onSelectedRemoteCandidateChanged)===null||o===void 0||o.call(this,t,n)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var n;(n=this.onFirstVideoDecodedTimeout)===null||n===void 0||n.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,n){if(t.length===n.length)for(let p=0;p<t.length;p++){var o,s,c,d,h;const m=t[p],g=n[p];if(g instanceof nn&&!Ee(o=g._hints).call(o,Gt.LOW_STREAM)&&(s=g._encoderConfig)!==null&&s!==void 0&&s.bitrateMax&&((c=g._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)>200&&(d=g._scalabilityMode)!==null&&d!==void 0&&d.numSpatialLayers&&((h=g._scalabilityMode)===null||h===void 0?void 0:h.numSpatialLayers)>1&&this.store.codec==="vp8"){const E={},y={high:1e3*(g._encoderConfig.bitrateMax-50),medium:5e4};E.encodings=[{rid:"m",active:!0,maxBitrate:y.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:y.high}];const T=m.sender.getParameters();await m.sender.setParameters(Object.assign(T,E))}}}async applySimulcastEncodings(t,n){if(!gn()&&t.length===n.length)for(let o=0;o<t.length;o++){const s=n[o];if(s instanceof nn&&this.isVP8Simulcast(s)){const c=t[o],d={},h={high:1e3*(s._encoderConfig.bitrateMax-50),medium:5e4};d.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:h.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:h.medium,scaleResolutionDownBy:4}];const p=c.sender.getParameters();await c.sender.setParameters(Object.assign(p,d))}}}isVP8Simulcast(t){var n,o,s,c,d;return!!(t instanceof nn&&H("SIMULCAST")&&this.store.codec==="vp8"&&!Ee(n=t._hints).call(n,Gt.LOW_STREAM)&&(o=t._encoderConfig)!==null&&o!==void 0&&o.bitrateMax&&((s=t._encoderConfig)===null||s===void 0?void 0:s.bitrateMax)>200&&(c=t._scalabilityMode)!==null&&c!==void 0&&c.numSpatialLayers&&((d=t._scalabilityMode)===null||d===void 0?void 0:d.numSpatialLayers)>1)}logSDPExchange(t,n,o,s){if(H("SDP_LOGGING"))return R.upload("[".concat(this.store.clientId,"] exchanging ").concat(o," ").concat(n," SDP during P2PConnection.").concat(s,`
`),t),n==="offer"?c=>{this.logSDPExchange(c,"answer",o==="local"?"remote":"local",s)}:void 0}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(d=>d.mid&&t.indexOf(d.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(d=>{d.direction="inactive"});const o=await this.peerConnection.createOffer(),s=this.logSDPExchange(o.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.muteRemote(t);const c=this.remoteSDP.toString();s==null||s(c),await this.setRemoteDescription({type:"answer",sdp:c})}catch(n){throw new re(j.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(d=>d.mid&&t.indexOf(d.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(async d=>{d.direction="sendonly"});const o=await this.peerConnection.createOffer(),s=this.logSDPExchange(o.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.unmuteRemote(t);const c=this.remoteSDP.toString();s==null||s(c),await this.setRemoteDescription({type:"answer",sdp:c})}catch(n){throw new re(j.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}async getRemoteSSRC(t,n){var o;if(n=n??((o=this.currentRemoteDescription)===null||o===void 0?void 0:o.sdp)){var s;const c=(s=_i(n).mediaDescriptions.find(d=>d.attributes.mid===t))===null||s===void 0?void 0:s.attributes.ssrcs;return c==null?void 0:c[0].ssrcId}}async setRemoteDescription(t){var n;await this.peerConnection.setRemoteDescription(t),Ee(n=["connected","completed"]).call(n,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(t,n,o){const s=_i(t),c=s.mediaDescriptions.find(d=>d.attributes.mid===n);return c&&o===Re.AUDIO&&c.media.mediaType==="audio"&&Sh(c),xc(s)}},Oe(rn.prototype,"establish",[ss],Object.getOwnPropertyDescriptor(rn.prototype,"establish"),rn.prototype),Oe(rn.prototype,"connect",[ss],Object.getOwnPropertyDescriptor(rn.prototype,"connect"),rn.prototype),Oe(rn.prototype,"receive",[ss],Object.getOwnPropertyDescriptor(rn.prototype,"receive"),rn.prototype),Oe(rn.prototype,"mockReceive",[ss],Object.getOwnPropertyDescriptor(rn.prototype,"mockReceive"),rn.prototype),Oe(rn.prototype,"stopReceiving",[ss],Object.getOwnPropertyDescriptor(rn.prototype,"stopReceiving"),rn.prototype),Oe(rn.prototype,"restartICE",[ss],Object.getOwnPropertyDescriptor(rn.prototype,"restartICE"),rn.prototype),Oe(rn.prototype,"close",[ss],Object.getOwnPropertyDescriptor(rn.prototype,"close"),rn.prototype),Oe(rn.prototype,"updateEncoderConfig",[ss],Object.getOwnPropertyDescriptor(rn.prototype,"updateEncoderConfig"),rn.prototype),Oe(rn.prototype,"updateSendParameters",[ss],Object.getOwnPropertyDescriptor(rn.prototype,"updateSendParameters"),rn.prototype),Oe(rn.prototype,"replaceTrack",[ss],Object.getOwnPropertyDescriptor(rn.prototype,"replaceTrack"),rn.prototype),Oe(rn.prototype,"muteLocal",[ss],Object.getOwnPropertyDescriptor(rn.prototype,"muteLocal"),rn.prototype),Oe(rn.prototype,"unmuteLocal",[ss],Object.getOwnPropertyDescriptor(rn.prototype,"unmuteLocal"),rn.prototype),rn);function ss(e,t,n){const o=e[t];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const s=this.mutex,c=await s.lock("From P2PConnection.".concat(t));try{for(var d=arguments.length,h=new Array(d),p=0;p<d;p++)h[p]=arguments[p];return await o.apply(this,h)}finally{c()}},n}let Os=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({});var m3,g3,_3,E3,v3,y3,S3,T3,w3,R3,C3,hn;function b3(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,o)}return n}function Mv(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?b3(Object(n),!0).forEach(function(o){x(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):b3(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}let vce=(m3=Ps(Os.SEND_ONLY),g3=Ps(Os.SEND_ONLY),_3=Ps(),E3=Ps(Os.RECEIVE_ONLY),v3=Ps(Os.RECEIVE_ONLY),y3=Ps(Os.RECEIVE_ONLY),S3=Ps(Os.RECEIVE_ONLY),T3=Ps(Os.RECEIVE_ONLY),w3=Ps(Os.RECEIVE_ONLY),R3=Ps(),C3=Ps(Os.RECEIVE_ONLY),hn=class extends pn{get state(){return this._state}set state(e){const t=this._state;this._state=e,this.emit(Me.StateChange,t,this._state)}constructor(e,t){super(),x(this,"isPlanB",!1),x(this,"store",void 0),x(this,"statsUploader",void 0),x(this,"sendConnection",void 0),x(this,"recvConnection",void 0),x(this,"localTrackMap",new Map),x(this,"remoteUserMap",new Map),x(this,"localDataChannels",[]),x(this,"pendingLocalTracks",[]),x(this,"pendingRemoteTracks",[]),x(this,"statsCollector",void 0),x(this,"dtlsFailedCount",0),x(this,"sendMutex",void 0),x(this,"recvMutex",void 0),x(this,"_state",kt.Disconnected),x(this,"_restartStates",["disconnected","failed"]),x(this,"reconnectInterval",void 0),x(this,"uploadUnplinkStarted",!1),x(this,"uploadDownlinkStarted",!1),x(this,"uplinkStateUploadInterval",void 0),x(this,"downlinkStatsUploadInterval",void 0),x(this,"handleMuteLocalTrack",async(n,o,s)=>{const c=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==kt.Connected)return void s(new re(j.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const p=this.filterTobeMutedTracks(n);if(p.length===0)return void o();const m=p.find(T=>T[0]==="videoLowTrack");m&&m[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(p.map(T=>{let[,{id:P}]=T;return P}));let g=!1;var d,h;n.trackMediaType==="video"?g=!((d=this.localTrackMap.get(de.LocalAudioTrack))===null||d===void 0||!d.track._muted):g=((h=this.localTrackMap.get(de.LocalVideoTrack))===null||h===void 0?void 0:h.id)===void 0;const E=this.createMuteMessage(p);await Yt(this,Me.RequestMuteLocal,E);const y=n.trackMediaType==="video"?Mc.MUTE_LOCAL_VIDEO:Mc.MUTE_LOCAL_AUDIO;await Yt(this,Me.RequestP2PMuteLocal,{action:y,message:E,isMuteAll:g}),o()}catch(p){s(p)}finally{c()}}),x(this,"handleUnmuteLocalTrack",async(n,o,s)=>{const c=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==kt.Connected)return void s(new re(j.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const d=this.filterTobeUnmutedTracks(n);if(d.length===0)return void o();await this.sendConnection.unmuteLocal(d.map(m=>{let[,{id:g}]=m;return g}));const h=this.createUnmuteMessage(d),p=n.trackMediaType==="video"?Mc.UNMUTE_LOCAL_VIDEO:Mc.UNMUTE_LOCAL_AUDIO;await Yt(this,Me.RequestP2PMuteLocal,{action:p,message:h}),o()}catch(d){s(d)}finally{c()}}),x(this,"handleUpdateVideoEncoder",async(n,o,s,c)=>{let d;typeof c=="boolean"&&c||(d=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoEncoder"));try{const p=this.localTrackMap.get(de.LocalVideoTrack);if(!this.sendConnection||!p||p.track!==n||this.state!==kt.Connected)return void o();const{id:m,track:g}=p;m&&(await this.sendConnection.updateSendParameters(m,g),await this.sendConnection.updateEncoderConfig(m,g),this.emit(Me.UpdateVideoEncoder,g)),o()}catch(p){s(p)}finally{var h;(h=d)===null||h===void 0||h()}}),x(this,"handleUpdateVideoSendParameters",async(n,o,s)=>{const c=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{const d=this.localTrackMap.get(de.LocalVideoTrack);if(!this.sendConnection||!d||d.track!==n||this.state!==kt.Connected)return void o();const{id:h,track:p}=d;h&&await this.sendConnection.updateSendParameters(h,p),o()}catch(d){s(d)}finally{c()}}),x(this,"handleReplaceTrack",async(n,o,s,c)=>{let d;R.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(n.getTrackId(),"]")),typeof c=="boolean"&&c||(d=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var h;const m=Array.from(this.localTrackMap.entries()).find(g=>{let[,{track:E}]=g;return n===E});if(!this.sendConnection||!m||m[1].id===void 0||this.state!==kt.Connected)return void o();if(await((h=this.sendConnection)===null||h===void 0?void 0:h.replaceTrack(n,m[1].id)),m[0]===de.LocalVideoTrack&&Rt().supportDualStreamEncoding){const g=this.localTrackMap.get(de.LocalVideoLowTrack);if(g){const E=n._mediaStreamTrack.clone();g.track._originMediaStreamTrack.stop(),g.track._mediaStreamTrack=E,g.track._originMediaStreamTrack=E,await new ye((y,T)=>{this.handleReplaceTrack(g.track,y,T,!0)})}}o()}catch(m){s(m)}finally{var p;(p=d)===null||p===void 0||p()}}),x(this,"handleGetLocalVideoStats",n=>{n(this.statsCollector.getLocalVideoTrackStats())}),x(this,"handleGetLocalAudioStats",n=>{n(this.statsCollector.getLocalAudioTrackStats())}),x(this,"handleGetRemoteVideoStats",n=>this.statsCollector.getRemoteVideoTrackStats(n.uid)[n.uid]),x(this,"handleGetRemoteAudioStats",n=>this.statsCollector.getRemoteAudioTrackStats(n.uid)[n.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new HV(e),this.bindStatsUploaderEvents(),this.sendMutex=new Ir("P2PChannel2-send-mutex",e.clientId),this.recvMutex=new Ir("P2PChannel2-recv-mutex",e.clientId),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(n=>{n&&(n.iceConnectionState!=="disconnected"&&n.iceConnectionState!=="failed"||this.handleDisconnect(n.direction))})},H("ICE_RESTART_INTERVAL"))}async startP2PConnection(e,t){throw new re(j.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(e){throw new re(j.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(e,t){let n;try{if(t){this.recvConnection&&(R.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),n=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new f3(e,this.store,ei.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);const o=await this.recvConnection.establish(t);return{iceParameters:o.iceParameters,dtlsParameters:o.dtlsParameters,sdp:o.sdp}}{this.state=kt.New,this.sendConnection&&(R.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),n=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new f3(e,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);const o=await this.sendConnection.establish();return{iceParameters:o.iceParameters,dtlsParameters:o.dtlsParameters,sdp:o.sdp}}}finally{n&&n()}}async p2pConnect(e){if(!this.sendConnection)throw new re(j.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=kt.Connected}async addRemoteCandidate(e,t){if(t===ei.RECEIVE_ONLY){if(!this.sendConnection)throw new re(j.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(e)}else{if(!this.recvConnection)throw new re(j.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(e)}}publish(e,t,n){var o=this;return ho(function*(){const s=yield Tt(o.sendMutex.lock("From P2PChannel.publish"));try{if(!o.sendConnection||o.state!==kt.Connected){o.throwIfTrackTypeNotMatch(e);const m=e.filter(g=>o.pendingLocalTracks.indexOf(g)===-1);return void(o.pendingLocalTracks=o.pendingLocalTracks.concat(m))}o.store.pubId=o.store.pubId+1,Or.markPublishStart(o.store.clientId,o.store.pubId);const c=o.filterTobePublishedTracks(e,t,n);if(c.length===0)return void(yield Tt(o.tryToUnmuteAudio(e)));c.forEach(m=>{let{track:g,type:E}=m;const y=Date.now();o.store.publish(g.getTrackId(),E===de.LocalAudioTrack?"audio":"video",y)}),o.bindLocalTrackEvents(c);const d=yield Tt(o.sendConnection.send(c.map(m=>{let{track:g}=m;return g}),o.store.codec,o.store.audioCodec)),h=(yield Tt(d.next())).value,p=o.createGatewayPublishMessage(c,h);try{yield p}catch(m){throw d.throw(m),(m==null?void 0:m.code)===j.WS_ABORT&&c.forEach(g=>{let{track:E}=g;o.pendingLocalTracks.indexOf(E)===-1&&o.pendingLocalTracks.push(E)}),o.unbindLocalTrackEvents(c),m}yield Tt(d.next()),c.forEach(m=>{let{type:g}=m;o.statsCollector.addLocalStats(g)}),o.statsUploader.startUploadOutboundStats(),o.assignLocalTracks(c,h),c.forEach(m=>{let{track:g,type:E}=m;const y=Date.now();o.store.publish(g.getTrackId(),E===de.LocalAudioTrack?"audio":"video",void 0,y)}),o.startUploadUplinkState()}finally{s()}})()}async unpublish(e){if(!this.sendConnection||this.state!==kt.Connected)return void(e.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(s=>!Ee(e).call(e,s)));const t=this.filterTobeUnpublishedTracks(e);if(t.length===0)return;const n=t.find(s=>s[0]==="videoLowTrack");n&&n[1].track.close();const o=this.createGatewayUnpublishMessage(t);if(await this.sendConnection.stopSending(t.map(s=>{let[,{id:c}]=s;return c})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(s=>{let[c,{track:d}]=s;return{type:c,track:d}})),t.forEach(s=>{let[c]=s;this.statsCollector.removeLocalStats(c)}),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===kt.Connected)return n&&n[1].track.close(),o;e.forEach(s=>{const c=this.pendingLocalTracks.indexOf(s);c!==-1&&this.pendingLocalTracks.splice(c,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);const e=()=>{const t=[],n=[];Array.from(this.localTrackMap.entries()).forEach(o=>{let[s,{track:c,ssrcs:d}]=o;const h={stream_type:pse(c,s),ssrcs:d};c._muted||!c._enabled?t.push(h):n.push(h)}),t.length>0&&t.forEach(o=>{Yt(this,Me.RequestMuteLocal,[o])}),n.length>0&&n.forEach(o=>{Yt(this,Me.RequestUnmuteLocal,[o])})};e(),this.uplinkStateUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(e){return ho(function*(){throw new re(j.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(R.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await Er(this,Me.RequestRePublish,this.pendingLocalTracks),this.emit(Me.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new re(j.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(e,t,n,o){var s;if(!this.recvConnection)throw new re(j.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((s=this.remoteUserMap.get(e))!==null&&s!==void 0&&s.has(t))return;const{track:c,mid:d,transceiver:h}=await this.recvConnection.receive(t,[{ssrcId:n}],String(e.uid),o);t===Re.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(c):(e._audioTrack=new hh(c,e.uid,e._uintid,this.store),R.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),h&&e._audioTrack._updateRtpTransceiver(h),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoSSRC=n,e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(c):(e._videoTrack=new uh(c,e.uid,e._uintid,this.store),R.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),h&&e._videoTrack._updateRtpTransceiver(h),this.bindRemoteTrackEvents(e,e._videoTrack));const p=this.remoteUserMap.get(e);p?p.set(t,d):this.remoteUserMap.set(e,new Map([[t,d]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();const m=this.pendingRemoteTracks.findIndex(g=>{let{user:E,kind:y}=g;return E.uid===e.uid&&t===y});m!==-1&&(this.pendingRemoteTracks.splice(m,1),this.emit(Me.MediaReconnectEnd,e.uid))}async mockSubscribe(e,t,n,o){if(!this.recvConnection)throw new re(j.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(t,[{ssrcId:n}],String(e.uid),o)}async unsubscribe(e,t,n){const o=this.pendingRemoteTracks.filter(c=>{let{user:d,kind:h}=c;return t!==void 0?d.uid===e.uid&&t===h:d.uid===e.uid});if(o.forEach(c=>{const d=this.pendingRemoteTracks.indexOf(c);this.pendingRemoteTracks.splice(d,1)}),this.recvConnection||n||o.forEach(c=>{let{kind:d}=c;var h;if(d===Re.AUDIO)(h=e._audioTrack)===null||h===void 0||h._destroy(),e._audioTrack=void 0;else if(d===Re.VIDEO){var p;(p=e._videoTrack)===null||p===void 0||p._destroy(),e._videoTrack=void 0}}),!this.recvConnection)return;const s=this.filterTobeUnSubscribedTracks(e,t);s.length!==0&&(await this.recvConnection.stopReceiving(s.map(c=>{let[,{id:d}]=c;return d})),this.withdrawRemoteTracks(s),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),s.forEach(c=>{let[d,{kind:h}]=c;var p,m;if(h===Re.VIDEO&&d._videoSSRC&&((p=this.recvConnection)===null||p===void 0||p.setStatsRemoteVideoIsReady(d._videoSSRC,!1)),h===Re.VIDEO)this.unbindRemoteTrackEvents(d._videoTrack),n||((m=d._videoTrack)===null||m===void 0||m._destroy(),d._videoTrack=void 0);else if(h===Re.AUDIO){var g;this.unbindRemoteTrackEvents(d._audioTrack),!n&&((g=d._audioTrack)===null||g===void 0||g._destroy(),d._audioTrack=void 0)}}),s.forEach(c=>{let[,{kind:d}]=c;Yt(this,Me.RequestP2PMuteRemote,d)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);const e=()=>Array.from(this.remoteUserMap.entries()).forEach(t=>{let[,n]=t;[Re.VIDEO,Re.AUDIO].forEach(o=>{n.has(o)?Yt(this,Me.RequestP2PUnmuteRemote,o):Yt(this,Me.RequestP2PMuteRemote,o)})});e(),this.downlinkStatsUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(e){throw new re(j.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(e){throw new re(j.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(e){throw new re(j.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(e){throw new re(j.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(e,t){if(!this.recvConnection)return;const n=this.remoteUserMap.get(e);if(!n)return void R.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid,"."));if(!n.get(t))return void R.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));const o=t===Re.VIDEO?e._videoSSRC:e._audioSSRC;o!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(o,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.recvConnection)return;const n=this.remoteUserMap.get(e);if(!n)return void R.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid,"."));n.get(t)||R.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))}getAllTracks(e){const t=this.localTrackMap.get(de.LocalAudioTrack);if((t==null?void 0:t.track)instanceof Bn){const n=t.track;return Array.from(this.localTrackMap.entries()).filter(o=>{let[s]=o;return s!==de.LocalAudioTrack}).filter(o=>{let[s]=o;return!(e&&s===de.LocalVideoLowTrack)}).map(o=>{let[,{track:s}]=o;return s}).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter(n=>{let[o]=n;return!(e&&o===de.LocalVideoLowTrack)}).map(n=>{let[,{track:o}]=n;return o})}reportPublishEvent(e,t,n,o,s){if(e){const d=this.localTrackMap.get(de.LocalAudioTrack),h=o?this.localTrackMap.get(de.LocalVideoLowTrack):this.localTrackMap.get(de.LocalVideoTrack);ke.publish(this.store.sessionId,{eventElapse:Or.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:d==null?void 0:d.track.getTrackLabel(),videoName:h==null?void 0:h.track.getTrackLabel(),screenshare:(h==null?void 0:h.track._hints.indexOf(Gt.SCREEN_TRACK))!==-1,audio:!!d,video:!!h,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:s})}else{var c;n||(n=[]);const d=n.find(p=>p instanceof Sn),h=o?(c=this.localTrackMap.get(de.LocalVideoTrack))===null||c===void 0?void 0:c.track:n.find(p=>p instanceof nn);ke.publish(this.store.sessionId,{eventElapse:Or.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:d==null?void 0:d.getTrackLabel(),videoName:h==null?void 0:h.getTrackLabel(),screenshare:(h==null?void 0:h._hints.indexOf(Gt.SCREEN_TRACK))!==-1,audio:!!d,video:!!h,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:s})}}reportSubscribeEvent(e,t,n,o){const s=o===Re.VIDEO?n._videoSSRC:n._audioSSRC;s&&ke.subscribe(this.store.sessionId,{succ:e,ec:t,video:o===Re.VIDEO,audio:o===Re.AUDIO,peerid:n.uid,subscribeRequestid:o===Re.VIDEO?n._videoSSRC:n._audioSSRC,p2pid:this.store.p2pId,eventElapse:Or.measureFromSubscribeStart(this.store.clientId,s)})}reset(){R.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new Ir("P2PChannel2-send-mutex",this.store.clientId),this.sendMutex=new Ir("P2PChannel2-recv-mutex",this.store.clientId),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(de.LocalAudioTrack);if((e==null?void 0:e.track)instanceof Bn){if(e.track.trackList.length>0){const t=e.track;e.track.trackList.forEach(n=>{t.removeAudioTrack(n)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=kt.Disconnected}getStats(e){var t,n;return e?(n=this.recvConnection)===null||n===void 0?void 0:n.getStats():(t=this.sendConnection)===null||t===void 0?void 0:t.getStats()}getRemoteVideoIsReady(e){var t;return((t=this.recvConnection)===null||t===void 0?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(de.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(de.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const t=this.localTrackMap.get(e);return t&&t.track instanceof nn||t&&t.track instanceof Sn?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}getRemoteMedia(e){var t;const n=Array.from(Xi(t=this.remoteUserMap).call(t)).find(o=>o.uid===e);return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(n=>{let[o]=n;return{uid:o.uid,level:o.audioTrack?100*o.audioTrack._source.getAccurateVolumeLevel():0}});const t=this.localTrackMap.get(de.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=ql(e).call(e,(n,o)=>n.level-o.level),e}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(R.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=kt.Reconnecting,H("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t]=e;var n;t._videoTrack&&t._videoTrack._player&&((n=t._videoTrack._player.getVideoElement())===null||n===void 0||n.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var t;let[n,{track:o}]=e;switch(n){case de.LocalVideoTrack:Ee(t=o._hints).call(t,Gt.LOW_STREAM)?o.close():this.pendingLocalTracks.push(o);break;case de.LocalAudioTrack:o instanceof Bn?this.pendingLocalTracks=this.pendingLocalTracks.concat(o.trackList):this.pendingLocalTracks.push(o);case de.LocalVideoLowTrack:}}),this.emit(Me.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;Array.from(Xi(n).call(n)).forEach(o=>{this.setPendingRemoteMedia(t,o)}),this.emit(Me.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),R.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(e,t){for(const n of this.pendingRemoteTracks){const{user:o,kind:s}=n;if((e instanceof Bc?e.uid:e)===o.uid&&t===s)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}async restartICE(e,t){let n,o;if(e===ei.SEND_ONLY){if(!this.sendConnection)throw new re(j.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");n=await this.sendMutex.lock("From P2PChannel.restartICE"),o=this.sendConnection}else{if(!this.recvConnection)throw new re(j.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");n=await this.recvMutex.lock("From P2PChannel.restartICE"),o=this.recvConnection}try{if(t){const s=await o.restartICE(t);return o.isInRestartIce=!1,s}{const s=await o.restartICE();if(s){const c=await Er(this,Me.RequestP2PRestartICE,{direction:ei.RECEIVE_ONLY,iceParameter:s});await o.restartICE(c),o.isInRestartIce=!1}}}finally{n()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const e=this.sendConnection.getStats(),t=this.localTrackMap.get(de.LocalVideoTrack),n=this.localTrackMap.get(de.LocalAudioTrack),o=e.videoSend.find(T=>{var P;return T.ssrc===(t==null||(P=t.ssrcs)===null||P===void 0?void 0:P[0].ssrcId)}),s=e.audioSend.find(T=>{var P;return T.ssrc===(n==null||(P=n.ssrcs)===null||P===void 0?void 0:P[0].ssrcId)});if(!o||!s)return 1;const c=Yi(this,Me.NeedSignalRTT),d=o?o.rttMs:void 0,h=s?s.rttMs:void 0,p=d&&h?(d+h)/2:d||h,m=(p&&c?(p+c)/2:p||c)||0,g=100*e.sendPacketLossRate*.7/50+.3*m/1500,E=g<.17?1:g<.36?2:g<.59?3:g<.1?4:5,y=t==null?void 0:t.track;if(y&&y._encoderConfig&&y._hints.indexOf(Gt.SCREEN_TRACK)===-1){const T=y._encoderConfig.bitrateMax,P=e.bitrate.actualEncoded;if(T&&P){const I=(1e3*T-P)/(1e3*T);return Pj[I<.15?0:I<.3?1:I<.45?2:I<.6?3:4][E]}}return E}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const e=this.recvConnection.getStats();let t=0;return Array.from(this.remoteUserMap.entries()).forEach(n=>{let[o]=n;const s=o._audioSSRC,c=o._videoSSRC,d=e.audioRecv.find(P=>P.ssrc===s),h=e.videoRecv.find(P=>P.ssrc===c);if(!d&&!h)return void(t+=1);const p=Yi(this,Me.NeedSignalRTT),m=e.rtt,g=(m&&p?(m+p)/2:m||p)||0,E=d?d.jitterMs:void 0,y=e.recvPacketLossRate;let T=.7*y*100/50+.3*g/1500;E&&(T=.6*y*100/50+.2*g/1500+.2*E/400),t+=T<.1?1:T<.17?2:T<.36?3:T<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new ye((t,n)=>{this.handleMuteLocalTrack(e,t,n)})}filterTobePublishedTracks(e,t,n){const o=[],s=Rt(),c=this.getAllTracks();e=Qu(e=e.filter(p=>c.indexOf(p)===-1));let d=!1,h=!1;for(const p of e){if(p instanceof nn&&(this.localTrackMap.has(de.LocalVideoTrack)||d?new re(j.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(o.push({track:p,type:de.LocalVideoTrack}),d=!0),t)){const m=this.getLowVideoTrack(p,n);o.push({track:m,type:de.LocalVideoLowTrack})}if(p instanceof Sn){const m=this.localTrackMap.get(de.LocalAudioTrack);if(m){if(!(m.track instanceof Bn))throw new re(j.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(p._bypassWebAudio)throw new re(j.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");m.track.addAudioTrack(p),this.bindLocalAudioTrackEvents(p,!0)}else if(h){const g=o.find(E=>{let{type:y}=E;return y===de.LocalAudioTrack});if(!(g.track instanceof Bn))throw new re(j.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(p._bypassWebAudio)throw new re(j.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");g.track.addAudioTrack(p)}else{if(!s.webAudioMediaStreamDest||p instanceof Bn||p._bypassWebAudio)o.push({track:p,type:de.LocalAudioTrack});else{const g=new Bn;g.addAudioTrack(p),o.push({track:g,type:de.LocalAudioTrack})}h=!0}}}return o}filterTobeUnpublishedTracks(e){const t=[],n=this.getAllTracks();e=Qu(e=e.filter(o=>n.indexOf(o)!==-1));for(const o of e){if(o instanceof Sn){const s=this.localTrackMap.get(de.LocalAudioTrack);if(!s)continue;s.track instanceof Bn?(s.track.removeAudioTrack(o),this.unbindLocalAudioTrackEvents(o),s.track.trackList.length===0&&(t.push([de.LocalAudioTrack,s]),s.track.close())):t.push([de.LocalAudioTrack,s])}if(o instanceof nn){const s=this.localTrackMap.get(de.LocalVideoTrack);if(!s)continue;t.push([de.LocalVideoTrack,s]);const c=this.localTrackMap.get(de.LocalVideoLowTrack);c&&t.push([de.LocalVideoLowTrack,c])}}return t}bindLocalTrackEvents(e){e.forEach(t=>{let{track:n,type:o}=t;switch(o){case de.LocalVideoTrack:n.addListener(Ne.GET_STATS,this.handleGetLocalVideoStats),n.addListener(Ne.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(Ne.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(Ne.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.addListener(Ne.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.addListener(Ne.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.addListener(Ne.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(Ne.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case de.LocalAudioTrack:this.bindLocalAudioTrackEvents(n);case de.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,t){e instanceof Bn?e.trackList.forEach(n=>{n.addListener(Ne.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(Ne.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(Ne.GET_STATS,this.handleGetLocalAudioStats),n.addListener(Ne.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(Ne.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(Ne.GET_STATS,this.handleGetLocalAudioStats),e.addListener(Ne.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(Ne.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(Ne.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(Ne.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||e.addListener(Ne.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(t=>{let[n,{track:o}]=t;return{track:o,type:n}})),e.forEach(t=>{let{track:n,type:o}=t;switch(o){case de.LocalVideoTrack:n.off(Ne.GET_STATS,this.handleGetLocalVideoStats),n.off(Ne.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(Ne.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(Ne.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.off(Ne.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.off(Ne.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.off(Ne.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(Ne.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case de.LocalAudioTrack:this.unbindLocalAudioTrackEvents(n);case de.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof Bn?e.trackList.forEach(t=>{t.off(Ne.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(Ne.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(Ne.GET_STATS,this.handleGetLocalAudioStats),t.off(Ne.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(Ne.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(Ne.GET_STATS,this.handleGetLocalAudioStats),e.off(Ne.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(Ne.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(Ne.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(Ne.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(Ne.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof uh&&t.addListener(Ne.GET_STATS,n=>{n(this.handleGetRemoteVideoStats(e))}),t instanceof hh&&t.addListener(Ne.GET_STATS,n=>{n(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(Ne.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;n.has(Re.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),n.has(Re.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((n,o)=>{var s;let c,{track:d,type:h}=n;switch(h){case de.LocalAudioTrack:c=xt.Audio;break;case de.LocalVideoTrack:c=Ee(s=d._hints).call(s,Gt.SCREEN_TRACK)?xt.Screen:xt.High;break;case de.LocalVideoLowTrack:c=xt.Low}return{kind:h===de.LocalAudioTrack?Re.AUDIO:Re.VIDEO,stream_type:c,mid:t[o].id,ssrcs:t[o].localSSRC,isMuted:d.muted||!d.enabled}})}createGatewayUnpublishMessage(e){return e.map(t=>{var n;let o,[s,{track:c,ssrcs:d,id:h}]=t;switch(s){case de.LocalVideoTrack:o=Ee(n=c._hints).call(n,Gt.SCREEN_TRACK)?xt.Screen:xt.High;break;case de.LocalAudioTrack:o=xt.Audio;break;case de.LocalVideoLowTrack:o=xt.Low}return{stream_type:o,ssrcs:d,mid:h}})}assignLocalTracks(e,t){e.forEach((n,o)=>{let{track:s,type:c}=n;this.localTrackMap.set(c,{track:s,id:t[o].id,ssrcs:t[o].localSSRC})})}withdrawLocalTracks(e){e.forEach(t=>{let[n]=t;this.localTrackMap.delete(n)})}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{var n;R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(e.name,".onConnectionStateChange(").concat(t,")")),this.emit(Me.PeerConnectionStateChange,t),t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t==="connected"&&(e.isInRestartIce=!1),Ee(n=this._restartStates).call(n,t)&&!e.isInRestartIce&&(t==="disconnected"&&await cr(800),e.iceConnectionState!=="disconnected"&&e.iceConnectionState!=="failed"||this.handleDisconnect(e.direction))},e.onICEConnectionStateChange=t=>{t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),ke.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:En.TRACER}).onSuccess(),this.emit(Me.IceConnectionStateChange,t)},e.onICETransportStateChange=t=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},e.onDTLSTransportStateChange=t=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},e.onDTLSTransportError=t=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},e.onFirstAudioDecoded=t=>{var n;const o=Array.from(Xi(n=this.remoteUserMap).call(n)).find(c=>c._audioSSRC===t);var s;o&&(this.store.subscribe(o.uid,"audio",void 0,void 0,void 0,Date.now()),(s=o.audioTrack)===null||s===void 0||s.emit(sh.FIRST_FRAME_DECODED),ke.firstRemoteFrame(this.store.sessionId,$n.FIRST_AUDIO_DECODE,dn.FIRST_AUDIO_DECODE,{peer:o._uintid,subscribeElapse:Or.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=t=>{var n;const o=Array.from(Xi(n=this.remoteUserMap).call(n)).find(s=>s._audioSSRC===t);o&&ke.firstRemoteFrame(this.store.sessionId,$n.FIRST_AUDIO_RECEIVED,dn.FIRST_AUDIO_RECEIVED,{peer:o._uintid,subscribeElapse:Or.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(t,n,o)=>{this.reportVideoFirstFrameDecoded(t,n,o)},e.onFirstVideoReceived=t=>{var n;const o=Array.from(Xi(n=this.remoteUserMap).call(n)).find(s=>s._videoSSRC===t);o&&ke.firstRemoteFrame(this.store.sessionId,$n.FIRST_VIDEO_RECEIVED,dn.FIRST_VIDEO_RECEIVED,{peer:o._uintid,subscribeElapse:Or.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(t,n)=>{const o=t.candidateType==="relay",s=n.candidateType==="relay";n.candidateType!=="unknown"&&o===s||this.emit(Me.ConnectionTypeChange,o),R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(jc(n))," -> ").concat(JSON.stringify(jc(t)),")"))},e.onSelectedRemoteCandidateChanged=(t,n)=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(jc(n))," -> ").concat(JSON.stringify(jc(t)),")"))},e.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)},e.onLocalCandidate=t=>{this.emit(Me.LocalCandidate,{candidate:t,direction:e.direction})}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.onLocalCandidate=void 0}async handleDisconnect(e){const t=e===ei.SEND_ONLY?this.sendConnection:this.recvConnection;t&&!t.isInRestartIce&&(t.isInRestartIce=!0,R.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(t.name,"] start use restartICE")),e===ei.SEND_ONLY?this.restartICE(e):Er(this,Me.RequestP2PRestartICE,{direction:ei.SEND_ONLY}))}filterTobeMutedTracks(e){const t=[];if(this.getAllTracks().indexOf(e)===-1)return t;const n=this.localTrackMap.get(de.LocalAudioTrack);if(e instanceof Sn&&(n==null?void 0:n.track)instanceof Bn)return n.track.isActive||t.push([de.LocalAudioTrack,n]),t;const o=Array.from(this.localTrackMap.entries()).find(s=>{let[,{track:c}]=s;return e===c});if(o&&(t.push(o),o[0]===de.LocalVideoTrack)){const s=this.localTrackMap.get(de.LocalVideoLowTrack);s&&t.push([de.LocalVideoLowTrack,s])}return t}filterTobeUnmutedTracks(e){const t=[],n=this.localTrackMap.get(de.LocalAudioTrack);if(e instanceof Sn&&(n==null?void 0:n.track)instanceof Bn)return n.track.isActive&&t.push([de.LocalAudioTrack,n]),t;const o=Array.from(this.localTrackMap.entries()).find(s=>{let[,{track:c}]=s;return e===c});if(o)if(o[0]===de.LocalVideoTrack){t.push(o);const s=this.localTrackMap.get(de.LocalVideoLowTrack);s&&t.push([de.LocalVideoLowTrack,s])}else t.push(o);return t}createMuteMessage(e){return e.map(t=>{var n;let o,[s,{track:c,ssrcs:d,id:h}]=t;switch(s){case de.LocalAudioTrack:o=xt.Audio;break;case de.LocalVideoTrack:o=Ee(n=c._hints).call(n,Gt.SCREEN_TRACK)?xt.Screen:xt.High;break;case de.LocalVideoLowTrack:o=xt.Low}return{stream_type:o,ssrcs:d,mid:h}})}createUnmuteMessage(e){return e.map(t=>{var n;let o,[s,{track:c,ssrcs:d,id:h}]=t;switch(s){case de.LocalAudioTrack:o=xt.Audio;break;case de.LocalVideoTrack:o=Ee(n=c._hints).call(n,Gt.SCREEN_TRACK)?xt.Screen:xt.High;break;case de.LocalVideoLowTrack:o=xt.Low}return{stream_type:o,ssrcs:d,mid:h}})}filterTobeUnSubscribedTracks(e,t){const n=[],o=this.remoteUserMap.get(e);if(!o)return n;if(t){const s=o.get(t);if(!s)return n;n.push([e,{kind:t,id:s}])}else Array.from(o.entries()).forEach(s=>{let[c,d]=s;n.push([e,{kind:c,id:d}])});return n}createUnsubscribeMessage(e){const t=[];return e.forEach(n=>{let[o,{kind:s,id:c}]=n;switch(s){case Re.VIDEO:return void(o._videoSSRC&&t.push({stream_type:Re.VIDEO,ssrcId:o._videoSSRC}));case Re.AUDIO:return void(o._audioSSRC&&t.push({stream_type:Re.AUDIO,ssrcId:o._audioSSRC}))}}),t}withdrawRemoteTracks(e){e.forEach(t=>{let[n,{kind:o}]=t;const s=this.remoteUserMap.get(n);s&&(s.delete(o),Array.from(s.entries()).length===0&&this.remoteUserMap.delete(n))})}async updateBitrateLimit(e){const t=this.localTrackMap.get(de.LocalVideoTrack),n=this.localTrackMap.get(de.LocalVideoLowTrack);t&&(await t.track.setBitrateLimit(e.uplink),await new ye((o,s)=>{this.handleUpdateVideoEncoder(t.track,o,s,!0)})),n&&e.low_stream_uplink&&(await n.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new ye((o,s)=>{this.handleUpdateVideoEncoder(n.track,o,s,!0)}))}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const e=this.sendConnection.peerConnectionState,t=this.recvConnection.peerConnectionState;return e!=="connected"&&t!=="connected"}return!0}async tryToUnmuteAudio(e){for(let t=0;t<e.length;t++)if(e[t]instanceof Sn){const n=this.filterTobeUnmutedTracks(e[t]);if(n.length===0)continue;const o=this.createUnmuteMessage(n);return void await Yt(this,Me.RequestUnmuteLocal,o)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=e=>this.getStats(e),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(e=>{let[,{ssrcs:t}]=e;return!!t}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!((t=this.recvConnection)===null||t===void 0||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(Me.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(Me.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await cr(LR(this.dtlsFailedCount,Un)),this.emit(Me.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(de.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof nn)}throwIfTrackTypeNotMatch(e){if(e.filter(t=>t instanceof nn).length>1)throw new re(j.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(t=>t instanceof Sn).length>1&&(e.some(t=>t instanceof Sn&&t._bypassWebAudio)||!Rt().webAudioMediaStreamDest))throw new re(j.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const t of e){if(t instanceof nn&&this.pendingLocalTracks.some(n=>n instanceof nn))throw new re(j.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof Sn&&this.pendingLocalTracks.some(n=>n instanceof Sn)&&(!Rt().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(n=>n instanceof Sn&&n._bypassWebAudio)))throw new re(j.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){const n=!H("DISABLE_DUAL_STREAM_USE_ENCODING")&&Rt().supportDualStreamEncoding,o=Mv(Mv({},{width:160,height:120,framerate:15,bitrate:50}),t);let s;s=n?e._mediaStreamTrack.clone():zC(e,o);const c=Jt(8,"track-low-"),d=new nn(s,Mv(Mv({},n&&{scaleResolutionDownBy:IC(o,e)}),{},{frameRate:o.framerate,bitrateMax:o.bitrate,bitrateMin:o.bitrate}),void 0,void 0,c);return d.on(ad.TRANSCEIVER_UPDATED,h=>{e._updateRtpTransceiver(h,ih.LOW_STREAM)}),d._hints.push(Gt.LOW_STREAM),e.addListener(Ne.NEED_CLOSE,()=>{d.close()}),d}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(e,t,n,o){var s;const c=Array.from(Xi(s=this.remoteUserMap).call(s)).find(d=>d._videoSSRC===e);if(c){o||this.store.subscribe(c.uid,"video",void 0,void 0,void 0,void 0,Date.now());const d=this.store.keyMetrics,h=d.subscribe.find(p=>p.userId===c.uid&&p.type==="video");ke.firstRemoteVideoDecode(this.store.sessionId,$n.FIRST_VIDEO_DECODE,dn.FIRST_VIDEO_DECODE,{peer:c._uintid,videowidth:t,videoheight:n,subscribeElapse:Or.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:d.requestAPEnd||0,apStart:d.requestAPStart||0,joinGwEnd:d.joinGatewayEnd||0,joinGwStart:d.joinGatewayStart||0,pcEnd:d.peerConnectionEnd||0,pcStart:d.peerConnectionStart||0,subscriberEnd:(h==null?void 0:h.subscribeEnd)||0,subscriberStart:(h==null?void 0:h.subscribeStart)||0,videoAddNotify:(h==null?void 0:h.streamAdded)||0,state:o?1:0})}}async remoteMediaSsrcChanged(e,t,n){if(!this.recvConnection)return!1;const o=this.remoteUserMap.get(e);if(!o)return!1;const s=o.get(t);if(!s)return!1;const c=await this.recvConnection.getRemoteSSRC(s);return c!==void 0&&c!==n}isPreSubScribe(e){return!1}async publishDataChannel(e){throw new re(j.NOT_SUPPORTED)}async unpublishDataChannel(e){throw new re(j.NOT_SUPPORTED)}async subscribeDataChannel(e,t){throw new re(j.NOT_SUPPORTED)}async unsubscribeDataChannel(e,t){throw new re(j.NOT_SUPPORTED)}hasPendingRemoteDataChannel(e,t){throw new re(j.NOT_SUPPORTED)}setPendingRemoteDataChannel(e,t){throw new re(j.NOT_SUPPORTED)}async preConnect(e){throw new re(j.NOT_SUPPORTED)}getEstablishParams(){throw new re(j.NOT_SUPPORTED)}async reSubscribe(e){throw new re(j.NOT_SUPPORTED)}async updateVideoStreamParameter(e,t){throw new re(j.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:n}]=e;t===de.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,ih.LOW_STREAM):n._updateRtpTransceiver(void 0)})}},Oe(hn.prototype,"p2pConnect",[m3],Object.getOwnPropertyDescriptor(hn.prototype,"p2pConnect"),hn.prototype),Oe(hn.prototype,"unpublish",[g3],Object.getOwnPropertyDescriptor(hn.prototype,"unpublish"),hn.prototype),Oe(hn.prototype,"unpublishLowStream",[_3],Object.getOwnPropertyDescriptor(hn.prototype,"unpublishLowStream"),hn.prototype),Oe(hn.prototype,"subscribe",[E3],Object.getOwnPropertyDescriptor(hn.prototype,"subscribe"),hn.prototype),Oe(hn.prototype,"mockSubscribe",[v3],Object.getOwnPropertyDescriptor(hn.prototype,"mockSubscribe"),hn.prototype),Oe(hn.prototype,"unsubscribe",[y3],Object.getOwnPropertyDescriptor(hn.prototype,"unsubscribe"),hn.prototype),Oe(hn.prototype,"muteRemote",[S3],Object.getOwnPropertyDescriptor(hn.prototype,"muteRemote"),hn.prototype),Oe(hn.prototype,"unmuteRemote",[T3],Object.getOwnPropertyDescriptor(hn.prototype,"unmuteRemote"),hn.prototype),Oe(hn.prototype,"hasRemoteMediaWithLock",[w3],Object.getOwnPropertyDescriptor(hn.prototype,"hasRemoteMediaWithLock"),hn.prototype),Oe(hn.prototype,"disconnectForReconnect",[R3],Object.getOwnPropertyDescriptor(hn.prototype,"disconnectForReconnect"),hn.prototype),Oe(hn.prototype,"remoteMediaSsrcChanged",[C3],Object.getOwnPropertyDescriptor(hn.prototype,"remoteMediaSsrcChanged"),hn.prototype),hn);function Ps(e){return function(t,n,o){const s=t[n];if(typeof s!="function")throw new Error("Cannot use mutex on object property.");return o.value=async function(){for(var c=arguments.length,d=new Array(c),h=0;h<c;h++)d[h]=arguments[h];switch(e){case Os.SEND_ONLY:{const p=await this.sendMutex.lock("From P2PChannel2.".concat(n));try{return await s.apply(this,d)}finally{p()}}case Os.RECEIVE_ONLY:{const p=await this.recvMutex.lock("From P2PChannel2.".concat(n));try{return await s.apply(this,d)}finally{p()}}default:{const p=await this.sendMutex.lock("From P2PChannel2.".concat(n)),m=await this.recvMutex.lock("From P2PChannel2.".concat(n));try{return await s.apply(this,d)}finally{p(),m()}}}},o}}class Cd extends pn{constructor(t,n){super(),x(this,"signal",void 0),x(this,"token",void 0),x(this,"tokenTimeout",void 0),x(this,"tokenInterval",void 0),x(this,"_sequence",0),x(this,"userMap",new Map),x(this,"encoder",new TextEncoder),this.signal=t,this.token=n;const o=()=>{this.signal.connectionState===en.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(o,1e3):this.tokenInterval=window.setTimeout(o,3*H("P2P_TOKEN_INTERVAL"))};o()}async send(t,n,o,s,c){var d;if(this.userMap.size===0)return;const h=Array.from(Pi(d=this.userMap).call(d))[0].token;typeof n!="string"&&(n=JSON.stringify(n)),s=s??Jt(6,""),c=c??this._sequence++;const p={_id:s,_type:t,_seq:c,_message:n,token:"".concat(this.token,"_").concat(h)};H("SHOW_P2P_LOG")&&R.debug("send message",p,"noNeedResponse : ".concat(o)),this.splitMessage(JSON.stringify(p)).forEach(g=>{this.signal.request(Ye.DATA_STREAM,{payload:kc(this.encoder.encode(g))})});const m=new ye((g,E)=>{const y=window.setTimeout(()=>{this.off("res-@".concat(s,"_ack"),T),this.off("res-@".concat(s),I),this.off(_h.ABORT,P),R.debug("[external-signal] request timeout, type: ".concat(t,", requestId: ").concat(s)),this.userMap.size===0?E(new re(j.INVALID_REMOTE_USER)):E(new re(j.TIMEOUT))},H("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),T=()=>{y&&window.clearTimeout(y),this.off(_h.ABORT,P),o&&g()},P=()=>{y&&window.clearTimeout(y),this.off("res-@".concat(s,"_ack"),T),this.off("res-@".concat(s),I),E(new re(j.EXTERNAL_SIGNAL_ABORT,"type: ".concat(t,", requestId: ").concat(s)))};this.once(_h.ABORT,P),this.once("res-@".concat(s,"_ack"),T);const I=(M,U)=>{A=!0,y&&window.clearTimeout(y),this.off("res-@".concat(s,"_ack"),T),this.off(_h.ABORT,P),M==="success"?g(U):E(new re(j.P2P_MESSAGE_FAILED,"request ".concat(t," failed, requestId: ").concat(s)))};let A=!1;o||(this.once("res-@".concat(s),I),cr(H("SIGNAL_REQUEST_TIMEOUT")).then(()=>{A||R.warning("external_signal request timeout, type: ".concat(t,", requestId: ").concat(s,", ").concat(p))}))});try{return await m}catch(g){if(g.code===j.TIMEOUT)return await this.send(t,n,o,s,c);throw g}}onMessage(t){var n;const{_uid:o}=t;let s,c=this.userMap.get(o);if(c)s=c.splitMessageMap;else{if(this.userMap.size>0||!("_type"in t)||t._type!==bn.CHECK)return;const{token:m}=t;s=new Map,c={uid:o,isStart:!0,token:m,splitMessageMap:s,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(o,c),this.signal.emit(_t.ON_USER_ONLINE,{uid:o}),this.handleUserOnline()}if("id"in t&&"total"in t){var d;const{id:m,total:g}=t,E=(d=s.get(m))!==null&&d!==void 0?d:[];if(E.push(t),s.has(m)||s.set(m,E),E.length!==g)return;{const y=ql(E).call(E,(T,P)=>T.index-P.index).map(T=>T.payload).join("");s.delete(m),(t=JSON.parse(y))._uid=o}}const{_type:h,token:p}=t;if(Ee(n=[bn.ACK,bn.CHECK]).call(n,h))return h===bn.CHECK&&this.handleCheckToken(c,p),void this.receiveMessage(t);p==="".concat(c.token,"_").concat(this.token)?this.handleReceivedMessage(t):R.debug('Receive unexpected message", '.concat(p,", cur_token: ").concat(c.token,"_").concat(this.token),t)}check(){const t={_id:Jt(6,""),token:this.token,_type:bn.CHECK};H("SHOW_P2P_LOG")&&R.debug("send message",t),this.signal.request(Ye.DATA_STREAM,{payload:kc(this.encoder.encode(JSON.stringify(t)))})}ack(t){const n={_id:t,_type:bn.ACK,token:this.token};H("SHOW_P2P_LOG")&&R.debug("send message",n),this.signal.request(Ye.DATA_STREAM,{payload:kc(this.encoder.encode(JSON.stringify(n)))})}response(t,n,o){this.send(bn.RESPONSE,JSON.stringify({success:!o,message:n}),!0,t)}handleReceivedMessage(t){const n=()=>{this.userMap.forEach(m=>{const{receivedMessagesMap:g,nextExpectedSequenceNumber:E}=m;for(;g.has(E);){const y=g.get(E);g.delete(E),this.receiveMessage(y),m.nextExpectedSequenceNumber++}})};if(!t)return void n();const{_uid:o,_seq:s}=t,c=this.userMap.get(o),{receivedMessagesMap:d,isStart:h,nextExpectedSequenceNumber:p}=c;if(s<p)return this.ack(t._id),void R.debug("[external-signal] receive old message, seq: ".concat(s,", ").concat(t._message));d.set(s,t),h&&s===p&&(this.receiveMessage(t),d.delete(p),c.nextExpectedSequenceNumber++,n())}receiveMessage(t){const{_id:n,_type:o,_message:s,_uid:c}=t;if(H("SHOW_P2P_LOG")&&R.debug("receive message",t),n){let d;switch(t._type!==bn.ACK&&(s&&(d=JSON.parse(s)),this.ack(t._id)),t._type){case bn.CANDIDATE:case bn.CONTROL:this.signal.emit(o,d,c);break;case bn.PUBLISH:case bn.UNPUBLISH:case bn.RESTART_ICE:case bn.CALL:d.uid=c,Er(this.signal,o,d).then(h=>{this.response(t._id,h)}).catch(()=>{this.response(t._id,void 0,!0)});break;case bn.ACK:this.getListeners("res-@".concat(n,"_ack")).length>0&&this.emit("res-@".concat(n,"_ack"));break;case bn.RESPONSE:{const{success:h,message:p}=d;this.emit("res-@".concat(n),h?"success":"failed",p);break}}}}splitMessage(t){if(t.length<Cd.MAX_MESSAGE_SIZE)return[t];const n=[],{remoteToken:o}=JSON.parse(t),s=Jt(6,"");let c=0,d=800;const h=Math.ceil(t.length/d);for(;t.length>0;){c++;const p={id:s,index:c,total:h,payload:t.slice(0,d),token:"".concat(this.token,"_").concat(o)};JSON.stringify(p).length>Cd.MAX_MESSAGE_SIZE?d-=50:(n.push(p),t=t.slice(d))}return n.map(p=>JSON.stringify(p))}handleCheckToken(t,n){return t.token!==n?(R.debug("token changed, from ".concat(t.token," to ").concat(n)),this.reset(t.uid,n),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{R.debug("token timeout, ".concat(n)),this.reset(t.uid)},H("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){const t=await Er(this.signal,bn.CALL,void 0),n=await this.send(bn.CALL,t);this.signal.emit($e.P2P_CONNECTION,n,!0)}async reset(t,n){const o=this.userMap.get(t);o&&(this.emit(_h.ABORT),this.signal.emit(_t.ON_USER_OFFLINE,{uid:o.uid,reason:Boe.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),n||(R.debug("change local token from ".concat(n," to ").concat(n)),this.token=Jt(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(_h.ABORT)}}x(Cd,"MAX_SIZE",1),x(Cd,"MAX_MESSAGE_SIZE",1024);class yce extends pn{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===en.CONNECTED?this.emit($e.WS_CONNECTED):t===en.RECONNECTING?this.emit($e.WS_RECONNECTING,this._websocketReconnectReason):t===en.CLOSED&&this.emit($e.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(t,n){super(),x(this,"_disconnectedReason",void 0),x(this,"_websocketReconnectReason",void 0),x(this,"_connectionState",en.CLOSED),x(this,"reconnectToken",void 0),x(this,"p2pToken",void 0),x(this,"websocket",void 0),x(this,"openConnectionTime",void 0),x(this,"clientId",void 0),x(this,"lastMsgTime",Date.now()),x(this,"uploadCache",[]),x(this,"uploadCacheInterval",void 0),x(this,"rttRolling",new nM(5)),x(this,"pingpongTimer",void 0),x(this,"pingpongTimeoutCount",0),x(this,"joinResponse",void 0),x(this,"multiIpOption",void 0),x(this,"initError",void 0),x(this,"spec",void 0),x(this,"store",void 0),x(this,"_external_signal",void 0),x(this,"onWebsocketMessage",o=>{if(o.data instanceof ArrayBuffer)return void this.emit($e.ON_BINARY_DATA,o.data);const s=JSON.parse(o.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(s,"_id")){const c="res-@".concat(s._id);this.emit(c,s._result,s._message)}else if(Object.prototype.hasOwnProperty.call(s,"_type")){switch(s._type){case _t.ON_DATA_STREAM:return void this.handleDataStream(s._message);case _t.MUTE_AUDIO:case _t.MUTE_VIDEO:case _t.ON_P2P_LOST:case _t.ON_USER_ONLINE:return;case _t.ON_USER_OFFLINE:const{uid:c}=s._message;return R.debug("[".concat(this.clientId,"] user-offline uid: ").concat(c)),void this._external_signal.reset(c)}if(this.emit(s._type,s._message),s._type===_t.ON_NOTIFICATION&&this.handleNotification(s._message),s._type===_t.ON_USER_BANNED)switch(s._message.error_code){case 14:this.close(Dt.UID_BANNED);break;case 15:this.close(Dt.IP_BANNED);break;case 16:this.close(Dt.CHANNEL_BANNED)}if(s._type===_t.ON_USER_LICENSE_BANNED)switch(s._message.error_code){case Be.ERR_LICENSE_MISSING:this.close(Dt.LICENSE_MISSING);break;case Be.ERR_LICENSE_EXPIRED:this.close(Dt.LICENSE_EXPIRED);break;case Be.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Dt.LICENSE_MINUTES_EXCEEDED);break;case Be.ERR_LICENSE_PERIOD_INVALID:this.close(Dt.LICENSE_PERIOD_INVALID);break;case Be.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Dt.LICENSE_MULTIPLE_SDK_SERVICE);break;case Be.ERR_LICENSE_ILLEGAL:this.close(Dt.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=t.clientId,this.spec=t,this.store=n,this.websocket=new CC("gateway-".concat(this.clientId),this.spec.retryConfig,!0,H("JOIN_GATEWAY_USE_DUAL_DOMAIN"),H("JOIN_GATEWAY_USE_443PORT_ONLY"),n),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===en.CONNECTED&&this.reconnect("retry",_r.OFFLINE)}),this.p2pToken=Jt(6,""),this._external_signal=new Cd(this,this.p2pToken)}async request(t,n,o,s){const c=Jt(6,""),d={_id:c,_type:t,_message:n},h=this.websocket.connectionID,p=()=>new ye((P,I)=>{if(this.connectionState===en.CONNECTED)return P();const A=()=>{this.off($e.WS_CLOSED,M),P()},M=()=>{this.off($e.WS_CONNECTED,A),I(new re(j.WS_ABORT))};this.once($e.WS_CONNECTED,A),this.once($e.WS_CLOSED,M)});if(this.connectionState!==en.CONNECTING&&this.connectionState!==en.RECONNECTING||t===Ye.JOIN||t===Ye.REJOIN||await p(),this.websocket.sendMessage(d,!0),s)return;const m=new ye((P,I)=>{let A=!1;const M=(Y,Q)=>{A=!0,P({isSuccess:Y==="success",message:Q||{}}),this.off($e.WS_CLOSED,U),this.off($e.WS_RECONNECTING,U),this.emit($e.REQUEST_SUCCESS,t,n)};this.once("res-@".concat(c),M);const U=()=>{I(new re(j.WS_ABORT,"type: ".concat(t))),this.off($e.WS_CLOSED,U),this.off($e.WS_RECONNECTING,U),this.off("res-@".concat(c),M)};this.once($e.WS_CLOSED,U),this.once($e.WS_RECONNECTING,U),cr(H("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==h||A||(R.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(t)),this.emit($e.REQUEST_TIMEOUT,t,n))})});let g=null;try{g=await m}catch(P){if(this.connectionState===en.CLOSED||t===Ye.LEAVE)throw new re(j.WS_ABORT);return!this.spec.forceWaitGatewayResponse||o?P.throw():t===Ye.JOIN||t===Ye.REJOIN?null:(await p(),await this.request(t,n))}if(g.isSuccess)return g.message;const E=Number(g.message.error_code||g.message.code),y=Gf(E),T=new re(j.UNEXPECTED_RESPONSE,"".concat(y.desc,": ").concat(g.message.error_str),{code:E,data:g.message,desc:y.desc});return y.action==="success"?g.message:(R.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(E,", message: ").concat(y.desc,", action: ").concat(y.action)),E===Be.ERR_TOO_MANY_BROADCASTERS?((t===Ye.JOIN||t===Ye.REJOIN)&&(this.initError=T,this.close()),T.throw()):y.action==="failed"?T.throw():y.action==="quit"?(this.initError=T,this.close(),T.throw()):(E===Be.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=g.message.option,R.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",_r.MULTI_IP)):this.reconnect(y.action,_r.SERVER_ERROR),t===Ye.JOIN||t===Ye.REJOIN?null:await this.request(t,n)))}waitMessage(t,n){return new ye(o=>{const s=c=>{(!n||n(c))&&(this.off(t,s),o(c))};this.on(t,s)})}uploadWRTCStats(t){if(!this.store.sessionId)return void R.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const n={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload(Wf.WRTC_STATS,n)}upload(t,n){const o={_type:t,_message:n};try{this.websocket.sendMessage(o)}catch{const c=H("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(o),this.uploadCache.length>c&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==en.CONNECTED)return;const d=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(d._type,d._message)},H("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,n){const o={_type:t,_message:n};this.websocket.sendMessage(o)}async sendExtensionMessage(t,n,o){return await this._external_signal.send(t,n,o)}init(t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new ye((n,o)=>{this.once($e.WS_CONNECTED,()=>n(this.joinResponse)),this.once($e.WS_CLOSED,()=>o(this.initError||new re(j.WS_ABORT))),this.connectionState=en.CONNECTING,this.websocket.init(t).catch(o)})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=t||Dt.LEAVE,this.connectionState=en.CLOSED,R.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=Jt(6,""),this._external_signal.clear(),this._external_signal=new Cd(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit($e.ABORT_P2P_EXECUTION);const t=await Er(this,$e.REQUEST_JOIN_INFO),n=await this.request(Ye.JOIN,t);if(!n)return this.emit($e.REPORT_JOIN_GATEWAY,j.TIMEOUT,this.url||""),!1;this.joinResponse=n,this.emit($e.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=en.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(t,n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,n)}handleDataStream(t){try{var n;const o=id(t.payload),s=new TextDecoder().decode(o),c=JSON.parse(s);"total"in c&&"id"in c||Ee(n=Object.values(bn)).call(n,c._type)?(c._uid=t.uid,this._external_signal.onMessage(c)):this.emit(_t.ON_DATA_STREAM,t)}catch{this.emit(_t.ON_DATA_STREAM,t)}}handleNotification(t){R.debug("[".concat(this.clientId,"] receive notification: "),t);const n=Gf(t.code);if(n.action!=="success"){if(n.action!=="failed")return n.action==="quit"?(n.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Dt.UID_BANNED),void this.close()):void this.reconnect(n.action,_r.SERVER_ERROR);R.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const t=H("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=t&&(R.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>H("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",_r.TIMEOUT):this.request(Ye.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const o=Date.now()-n;this.rttRolling.add(o),H("REPORT_STATS")&&this.send(Ye.PING_BACK,{pingpongElapse:o})}).catch(o=>{})}handleWebsocketEvents(){this.websocket.on(tt.RECONNECT_CREATE_CONNECTION,t=>{this.emit($e.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(tt.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(tt.CLOSED,()=>{this.connectionState=en.CLOSED}),this.websocket.on(tt.FAILED,()=>{this._disconnectedReason=Dt.NETWORK_ERROR,this.connectionState=en.CLOSED}),this.websocket.on(tt.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===en.CONNECTED?this.connectionState=en.RECONNECTING:this.connectionState=en.CONNECTING}),this.websocket.on(tt.WILL_RECONNECT,(t,n,o)=>{t!=="retry"?(R.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(t)),this.reconnectToken=void 0):R.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),o(t)}),this.websocket.on(tt.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(t=>{if(this.emit($e.REPORT_JOIN_GATEWAY,t,this.url||""),t instanceof re&&t.code===j.UNEXPECTED_RESPONSE&&t.data.code===Be.ERR_NO_AUTHORIZED)return R.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",_r.SERVER_ERROR);R.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",_r.SERVER_ERROR):(this.initError=t,this.close())})}),this.websocket.on(tt.REQUEST_NEW_URLS,(t,n)=>{Er(this,$e.REQUEST_RECOVER,this.multiIpOption).then(t).catch(n)}),this.websocket.on(tt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(_t.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}const Sce={name:"P2PChannel",create:function(e){let{store:t,statsCollector:n}=e;return new vce(t,n)},createSubmodule:function(e){let{store:t,spec:n}=e;return new yce(n,t)}};function I3(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,o)}return n}function A3(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?I3(Object(n),!0).forEach(function(o){x(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):I3(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}class Tce{constructor(t){x(this,"sessionDesc",void 0),x(this,"localCapabilities",void 0),x(this,"rtpCapabilities",void 0),x(this,"candidates",void 0),x(this,"_originCandidates",void 0),x(this,"iceParameters",void 0),x(this,"dtlsParameters",void 0),x(this,"setup",void 0),x(this,"currentMidIndex",void 0),x(this,"cname",void 0),t=fn(t);const{iceParameters:n,dtlsParameters:o,candidates:s,rtpCapabilities:c,setup:d,localCapabilities:h,sdkCodec:p,cname:m}=t,g=_i(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=c,this.candidates=s,this._originCandidates=fn(s),this.iceParameters=n,this.dtlsParameters=o,this.setup=d,this.localCapabilities=h,this.cname=m;for(let E=0;E<g.mediaDescriptions.length;E++){const y=g.mediaDescriptions[E];if(y.attributes.iceUfrag=n.iceUfrag,y.attributes.icePwd=n.icePwd,y.attributes.fingerprints=o.fingerprints,y.attributes.candidates=s,y.attributes.setup=d,y.media.mediaType==="video"){y.media.fmts=c.videoCodecs.map(P=>P.payloadType.toString(10));let T=c.videoCodecs.filter(P=>{var I,A;return(I=P.rtpMap)===null||I===void 0?void 0:Ee(A=I.encodingName.toLowerCase()).call(A,p)});T.length===0&&(T=c.videoCodecs),y.attributes.payloads=T,y.attributes.extmaps=c.videoExtensions}y.media.mediaType==="audio"&&(y.media.fmts=c.audioCodecs.map(T=>T.payloadType.toString(10)),y.attributes.payloads=c.audioCodecs,y.attributes.extmaps=c.audioExtensions),g.mediaDescriptions[E]=this.mungMediaDesc(y)}this.sessionDesc=g,this.currentMidIndex=g.mediaDescriptions.length-1}toString(){return xc(this.sessionDesc)}send(t,n,o){const{ssrcs:s,ssrcGroups:c}=fd(n,this.cname),d=this.sessionDesc.mediaDescriptions.find(m=>t===Re.VIDEO?m.media.mediaType==="video":m.media.mediaType==="audio"),h=s[0].attributes.label,p=s[0].attributes.mslabel;return d.attributes.ssrcs=d.attributes.ssrcs.concat(s),d.attributes.ssrcGroups=d.attributes.ssrcGroups.concat(c),{id:h,mslabel:p}}batchSend(t){return t.map(n=>{let{kind:o,ssrcMsg:s}=n;return this.send(o,s,void 0)})}stopSending(t){this.sessionDesc.mediaDescriptions.forEach(n=>{const o=[],s=[],c=[];n.attributes.ssrcs.forEach(d=>{Ee(t).call(t,d.attributes.label||"")?c.push(d):o.push(d)}),n.attributes.ssrcGroups.forEach(d=>{var h;Ee(h=c.map(p=>p.ssrcId)).call(h,d.ssrcIds[0])||s.push(d)}),n.attributes.ssrcs=o,n.attributes.ssrcGroups=s})}mute(t){const n=this.sessionDesc.mediaDescriptions.find(o=>o.attributes.mid===t);if(!n)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.mute."));n.attributes.direction="inactive"}unmute(t){const n=this.sessionDesc.mediaDescriptions.find(o=>o.attributes.mid===t);if(!n)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.unmute."));n.attributes.direction="sendonly"}receive(t,n,o){t.forEach((s,c)=>{const d=s._mediaStreamTrack,h=this.sessionDesc.mediaDescriptions.findIndex(m=>m.attributes.mid===d.kind),p=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[h],s);this.sessionDesc.mediaDescriptions[h]=p})}stopReceiving(t){}updateCandidates(t){const n=this._originCandidates.filter(s=>s.transport==="udp"),o=[];if(n.forEach(s=>{o.push(A3(A3({},s),{},{foundation:"tcpcandidate",priority:Number(s.priority)-1+"",transport:"tcp",port:Number(s.port)+90+""}))}),n.length!==0){switch(t){case Nr.TCP_RELAY:this.candidates=o;break;case Nr.UDP_TCP_RELAY:case Nr.RELAY:this.candidates=[...n,...o];break;default:this.candidates=n}for(const s of this.sessionDesc.mediaDescriptions)s.attributes.candidates=this.candidates}}restartICE(t){t=fn(t),this.iceParameters=t,this.sessionDesc.mediaDescriptions.forEach(n=>{n.attributes.iceUfrag=t.iceUfrag,n.attributes.icePwd=t.icePwd})}predictReceivingMids(t){const n=[];for(let o=0;o<t;o++)n.push((this.currentMidIndex+o+1).toString(10));return n}mungRecvMediaDsec(t,n){const o=fn(t);return yh(o,n),NC(o,n),o}updateRecvMedia(t,n){const o=this.sessionDesc.mediaDescriptions.findIndex(s=>s.attributes.mid===t);if(o!==-1){const s=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[o],n);this.sessionDesc.mediaDescriptions[o]=s}}bumpMid(t){this.currentMidIndex+=t}updateTrackLabel(t,n,o){const s=this.sessionDesc.mediaDescriptions.find(d=>t===Re.VIDEO?d.attributes.mid==="video":d.attributes.mid==="audio");if(s){const d=s.attributes.ssrcs.find(h=>h.attributes.label===n);var c;d&&(d.attributes.label=o,(c=d.attributes.msid)===null||c===void 0||c.replace(n,o))}}mungMediaDesc(t){const n=fn(t);return AC(n),function(o){const s=o.attributes.extmaps.find(c=>nv(c.extensionName));s&&o.attributes.extmaps.splice(o.attributes.extmaps.indexOf(s),1),o.attributes.payloads.forEach(c=>{const d=c.rtcpFeedbacks.findIndex(h=>h.type==="transport-cc");d!==-1&&c.rtcpFeedbacks.splice(d,1)})}(n),n}getSSRC(t){for(const n of this.sessionDesc.mediaDescriptions)for(const o of n.attributes.ssrcs)if(o.attributes.label===t)return[o]}}var qt;function N3(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,o)}return n}function Uv(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?N3(Object(n),!0).forEach(function(o){x(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):N3(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}let wce=(qt=class zm extends Fj{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"").filter(t=>{var n;return Ee(n=Object.keys(DE)).call(n,t)}))]}constructor(t,n){super(t,n),x(this,"store",void 0),x(this,"peerConnection",void 0),x(this,"remoteSDP",void 0),x(this,"initialOffer",void 0),x(this,"statsFilter",void 0),x(this,"useRTX",!1),x(this,"localCapabilities",void 0),x(this,"localCandidateCount",0),x(this,"allCandidatesReceived",!1),x(this,"establishPromise",void 0),x(this,"mutex",void 0),this.store=n,this.mutex=new Ir("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(zm.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.statsFilter=BR(this.peerConnection,H("STATS_UPDATE_INTERVAL"),void 0,gn()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const t=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!t.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const n=Vc(t.sdp),o=Yf(t.sdp,{filterRTX:!this.useRTX,filterVideoFec:H("FILTER_VIDEO_FEC"),filterAudioFec:H("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=o,this.initialOffer=t,Uv(Uv({},n),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:o},offerSDP:t.sdp})}catch(t){throw new re(j.GET_LOCAL_CONNECTION_PARAMS_FAILED,t.toString())}}async updateRemoteConnect(){}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new Tce(Uv(Uv({},t),{},{rtpCapabilities:t.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));const n=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:n})}catch(n){throw new re(j.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(n.toString()))}}async updateRemoteRTPCapabilities(t,n){throw new re(j.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(t){}send(t,n){var o=this;return ho(function*(){const s=yield Tt(o.mutex.lock());try{if(!o.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const c=t.map(y=>o.peerConnection.addTrack(y._mediaStreamTrack)),d=yield Tt(o.peerConnection.createOffer()),h=_i(d.sdp),p=t.map(y=>{const T=y._mediaStreamTrack,P=h.mediaDescriptions.find(I=>I.attributes.mid===T.kind);if(!P)throw new Error("Cannot extract ssrc from mediaDescription.");return function(I,A,M){const U=I.attributes.ssrcs.filter(Q=>Q.attributes.label===A),Y=I.attributes.ssrcGroups;if(U.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(Y&&U.length>1){const Q=Y.find(J=>J.ssrcIds.indexOf(U[0].ssrcId)!==-1);return Q?[{ssrcId:Q.ssrcIds[0],rtx:M?Q.ssrcIds[1]:void 0}]:[{ssrcId:U[0].ssrcId}]}return[{ssrcId:U[0].ssrcId}]}(P,T.id,o.useRTX)});let m;try{m=yield p}catch(y){throw c.forEach(T=>{gr()&&T.replaceTrack(null),o.peerConnection.removeTrack(T)}),y}const g=o.mungSendOfferSDP(d.sdp,t);o.remoteSDP.receive(t,n,m);const E=o.remoteSDP.toString();return yield Tt(o.peerConnection.setLocalDescription({type:"offer",sdp:g})),yield Tt(o.applySendEncodings(c,t)),yield Tt(o.peerConnection.setRemoteDescription({type:"answer",sdp:E})),t.map((y,T)=>{const P=y._mediaStreamTrack.id;return{localSSRC:p[T],id:P}})}catch(c){throw new re(j.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(c.toString()))}finally{s()}})()}async stopSending(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const n=this.peerConnection.getSenders().filter(c=>{var d;return t.indexOf(((d=c.track)===null||d===void 0?void 0:d.id)||"")!==-1});if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");n.map(c=>{gr()&&c.replaceTrack(null),this.peerConnection.removeTrack(c)});const o=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(o),this.remoteSDP.stopReceiving(t);const s=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(n){throw new re(j.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(n.toString()))}}async receive(t,n,o,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{id:c,mslabel:d}=this.remoteSDP.send(t,n,s),h=new ye((g,E)=>{const y=setTimeout(()=>{E(new Error("Cannot receive track, id: ".concat(c)))},1e4),T=P=>{const I=wt();if((I.name==="Safari"&&Number(I.version)===11||Jr())&&P.track.id!==c&&P.streams[0].id===d){var A;const M=P.streams[0].getTracks()[0];return(A=this.remoteSDP)===null||A===void 0||A.updateTrackLabel(t,c,P.track.id),this.peerConnection.removeEventListener("track",T),clearTimeout(y),void g(M)}if(P.track.id===c)return this.peerConnection.removeEventListener("track",T),clearTimeout(y),void g(P.track)};this.peerConnection.addEventListener("track",T)}),p=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:p});const m=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(m),{track:await h,id:c}}catch(c){throw new re(j.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(c.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);const n=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const o=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(o)}catch(n){throw new re(j.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async muteRemote(t){}async unmuteRemote(t){}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getSenders().filter(o=>{var s;return t.indexOf(((s=o.track)===null||s===void 0?void 0:s.id)||"")!==-1});if(n.length!==t.length)throw new Error("sender' length doesn't match mids' length.");n.map(o=>{if(gr()&&o.track)o.track.enabled=!1;else{const s=o.getParameters();s.encodings.forEach(c=>c.active=!1),o.setParameters(s)}})}catch(n){throw new re(j.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getSenders().filter(c=>{var d;return t.indexOf(((d=c.track)===null||d===void 0?void 0:d.id)||"")!==-1});if(n.length!==t.length)throw new Error("Senders' length doesn't match mids' length.");n.map(async c=>{if(gr()&&c.track)c.track.enabled=!0;else{const d=c.getParameters();d.encodings.forEach(h=>h.active=!0),await c.setParameters(d)}});const o=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(o);const s=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(n){throw new re(j.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}restartICE(t){var n=this;return ho(function*(){const o=yield Tt(n.mutex.lock("From P2PConnection.restartICE"));try{if(!n.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const s=Rt().supportPCSetConfiguration;if(t===Nr.RELAY&&!s)return;if(s){const m=n.peerConnection.getConfiguration(),g=t===Nr.RELAY?"relay":"all";m.iceTransportPolicy!==g&&(R.debug("[".concat(n.store.clientId,"] restartICE change iceTransportPolicy from [").concat(m.iceTransportPolicy,"] to [").concat(g,"]")),m.iceTransportPolicy=g,n.peerConnection.setConfiguration(m))}t!==Nr.RELAY&&n.remoteSDP.updateCandidates(t);const c=yield Tt(n.peerConnection.createOffer({iceRestart:!0}));if(!c.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const d=Vc(c.sdp),{remoteIceParameters:h}=yield d.iceParameters;n.remoteSDP.restartICE(h);const p=n.remoteSDP.toString();yield Tt(n.peerConnection.setLocalDescription(c)),yield Tt(n.peerConnection.setRemoteDescription({type:"answer",sdp:p}))}catch(s){R.warning("[".concat(n.store.clientId,"] restart ICE failed, abort operation"),s)}finally{o()}})()}close(){var t;this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const o=await this.peerConnection.createOffer(),s=this.mungSendOfferSDP(o.sdp,[n]);this.remoteSDP.updateRecvMedia(n._mediaStreamTrack.kind,n);const c=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:s}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(o){throw new re(j.EXCHANGE_SDP_FAILED,o.toString())}}async updateSendParameters(t,n){const o=this.peerConnection.getSenders().filter(s=>{var c;return((c=s.track)===null||c===void 0?void 0:c.id)===t});o.length===1&&await this.applySendEncodings(o,[n])}setStatsRemoteVideoIsReady(t,n){this.statsFilter.setVideoIsReady2(t,n)}async replaceTrack(t,n){const o=this.peerConnection.getSenders().find(s=>{var c;return((c=s.track)===null||c===void 0?void 0:c.id)===n});o&&await o.replaceTrack(t._mediaStreamTrack)}createDataChannels(t,n){throw new re(j.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(t){throw new re(j.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,R.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,R.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},H("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const n={iceServers:[],sdpSemantics:"plan-b"};return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(kf(t.turnServer.servers)?n.iceServers=t.turnServer.servers:(n.iceServers&&n.iceServers.push(...zm.turnServerConfigToIceServers(t.turnServer.servers)),H("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...zm.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(o=>{o.forceturn&&(n.iceTransportPolicy="relay")}))),n}static turnServerConfigToIceServers(t){const n=[];return t.forEach(o=>{o.security?o.tcpport&&n.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=tcp")}):(o.udpport&&n.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.udpport,"?transport=udp")}),o.tcpport&&n.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=tcp")}))}),n}async updateRtpSenderEncodings(t,n){var o;if(n||(n=this.peerConnection.getSenders().find(m=>{var g;return((g=m.track)===null||g===void 0?void 0:g.id)===t._mediaStreamTrack.id})),!n)return R.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(!Rt().supportSetRtpSenderParameters)return R.warn("Browser not support set rtp-sender parameters");const s={},c={};if(t instanceof nn)switch(t._optimizationMode){case"motion":s.degradationPreference="maintain-framerate";break;case"detail":s.degradationPreference="maintain-resolution";break;default:s.degradationPreference="balanced"}if(H("DSCP_TYPE")&&Ga()){var d;const m=H("DSCP_TYPE");Ee(d=["very-low","low","medium","high"]).call(d,m)&&(c.networkPriority=m)}const h=n.getParameters(),p=(o=h.encodings)===null||o===void 0?void 0:o[0];p&&Object.assign(p,c),Object.assign(h,s),R.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(h.encodings))),await n.setParameters(h)}async applySendEncodings(t,n){try{if(!Rt().supportSetRtpSenderParameters||t.length!==n.length)return;for(let o=0;o<t.length;o++){const s=t[o],c=n[o];s&&c&&await this.updateRtpSenderEncodings(c,s)}}catch{R.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,n){const o=_i(t);return n.forEach((s,c)=>{const d=s._mediaStreamTrack,h=o.mediaDescriptions.find(p=>p.attributes.mid===d.kind);h&&yh(h,s)}),xc(o)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,n,o)=>{var s;(s=this.onFirstVideoDecoded)===null||s===void 0||s.call(this,t,n,o)},this.statsFilter.onSelectedLocalCandidateChanged=(t,n)=>{var o;(o=this.onSelectedLocalCandidateChanged)===null||o===void 0||o.call(this,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,n)=>{var o;(o=this.onSelectedRemoteCandidateChanged)===null||o===void 0||o.call(this,t,n)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const n=this.remoteSDP.batchSend(t).map((c,d)=>{let{id:h,mslabel:p}=c;const{kind:m}=t[d];return new ye((g,E)=>{const y=setTimeout(()=>{E(new Error("Cannot receive track, id: ".concat(h)))},1e4),T=P=>{const I=wt();if(I.name==="Safari"&&Number(I.version)===11&&P.track.id!==h&&P.streams[0].id===p){var A;const M=P.streams[0].getTracks()[0];return(A=this.remoteSDP)===null||A===void 0||A.updateTrackLabel(m,h,P.track.id),this.peerConnection.removeEventListener("track",T),clearTimeout(y),void g({track:M,id:h})}if(P.track.id===h)return this.peerConnection.removeEventListener("track",T),clearTimeout(y),void g({track:P.track,id:h})};this.peerConnection.addEventListener("track",T)})}),o=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:o});const s=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(s),await ye.all(n)}catch(n){throw new re(j.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(n.toString()))}}async getRemoteSSRC(t){if(!this.remoteSDP)return;const n=this.remoteSDP.getSSRC(t);return n==null?void 0:n[0].ssrcId}setConfiguration(t){if(Rt().supportPCSetConfiguration){const n=zm.resolvePCConfiguration(t);this.peerConnection.setConfiguration(n)}}},Oe(qt.prototype,"connect",[vo],Object.getOwnPropertyDescriptor(qt.prototype,"connect"),qt.prototype),Oe(qt.prototype,"stopSending",[vo],Object.getOwnPropertyDescriptor(qt.prototype,"stopSending"),qt.prototype),Oe(qt.prototype,"receive",[vo],Object.getOwnPropertyDescriptor(qt.prototype,"receive"),qt.prototype),Oe(qt.prototype,"stopReceiving",[vo],Object.getOwnPropertyDescriptor(qt.prototype,"stopReceiving"),qt.prototype),Oe(qt.prototype,"muteRemote",[vo],Object.getOwnPropertyDescriptor(qt.prototype,"muteRemote"),qt.prototype),Oe(qt.prototype,"unmuteRemote",[vo],Object.getOwnPropertyDescriptor(qt.prototype,"unmuteRemote"),qt.prototype),Oe(qt.prototype,"muteLocal",[vo],Object.getOwnPropertyDescriptor(qt.prototype,"muteLocal"),qt.prototype),Oe(qt.prototype,"unmuteLocal",[vo],Object.getOwnPropertyDescriptor(qt.prototype,"unmuteLocal"),qt.prototype),Oe(qt.prototype,"close",[vo],Object.getOwnPropertyDescriptor(qt.prototype,"close"),qt.prototype),Oe(qt.prototype,"updateEncoderConfig",[vo],Object.getOwnPropertyDescriptor(qt.prototype,"updateEncoderConfig"),qt.prototype),Oe(qt.prototype,"updateSendParameters",[vo],Object.getOwnPropertyDescriptor(qt.prototype,"updateSendParameters"),qt.prototype),Oe(qt.prototype,"replaceTrack",[vo],Object.getOwnPropertyDescriptor(qt.prototype,"replaceTrack"),qt.prototype),Oe(qt.prototype,"getRemoteSSRC",[vo],Object.getOwnPropertyDescriptor(qt.prototype,"getRemoteSSRC"),qt.prototype),qt);function vo(e,t,n){const o=e[t];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const s=this.mutex,c=await s.lock("Locking from P2PConnection.".concat(t));try{for(var d=arguments.length,h=new Array(d),p=0;p<d;p++)h[p]=arguments[p];return await o.apply(this,h)}finally{c()}},n}const Rce={name:"PlanBConnection",create:function(e){let{store:t,spec:n}=e;return new wce(n,t)}},Cce={interceptLocalAudioFrame:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Rt().supportWebRTCEncodedTransform)return void R.warning("browser not support audio encoded transform");if(FE.has(e)||!e.track)return;const n={track:e.track};if(Ha()){if(!e.createEncodedStreams)return void R.warning("browser not support createEncodedStreams() API");let s=null;try{s=e.createEncodedStreams()}catch(d){return void R.error("create audio-encoded-streams error",d&&d.message)}const c=new TransformStream({transform(d,h){n.controller||(n.controller=h),e.track&&e.track.id!==n.track.id&&(R.debug("audio track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",o),n.track=e.track,n.track.addEventListener("ended",o));const p=t.metadata&&t.metadata();p?function(m,g){const{chunk:E,controller:y}=g,T=H("ENABLE_AUDIO_PTS_METADATA")?Ya.AUDIO_64_BIT_PTS:Ya.METADATA;E.data=function(P,I,A){const M=A.byteLength,U=M+uC+Cj,Y=lC+dC+U,Q=new ArrayBuffer(P.byteLength+Y),J=new DataView(Q);J.setUint8(0,Rj),J.setUint16(1,U),J.setUint8(3,I),J.setUint16(4,M);for(let ne=0;ne<M;ne++)J.setUint8(6+ne,A[ne]);const X=new Uint8Array(J.buffer);return X.set(new Uint8Array(P),Y),X.buffer}(E.data,T,m),y.enqueue(E)}(p,{sender:e,chunk:d,controller:h}):h.enqueue(d)}});s.readable.pipeThrough(c).pipeTo(s.writable)}else if(gr()){if(typeof RTCRtpScriptTransform>"u")return void R.warning("browser not support RTCRtpScriptTransform");const s=VE(),c=new MessageChannel;await new ye(h=>s.onmessage=p=>{p.data==="registered"&&h(void 0)});const d=new RTCRtpScriptTransform(s,{name:"audio-metadata-tx",port:c.port2},[c.port2]);e.transform=d,await new ye(h=>s.onmessage=p=>{p.data==="started"&&h(void 0)}),c.port1.onmessage=h=>{var p;if(h.data.transformed&&e.track&&((p=e.track)===null||p===void 0?void 0:p.id)!==n.track.id)R.debug("audio track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",o),n.track=e.track,n.track.addEventListener("ended",o);else if(h.data.getMetadata){const m=t.metadata&&t.metadata();m&&c.port1.postMessage({metadata:m})}},n.worker=s}function o(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",o)}const s=FE.get(e);if(s){FE.delete(e);try{var c,d;(c=s.controller)===null||c===void 0||c.terminate(),(d=s.worker)===null||d===void 0||d.terminate()}catch(h){R.warning(h&&h.message)}}}FE.set(e,n),e.track.addEventListener("ended",o)},interceptRemoteAudioFrame:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Rt().supportWebRTCEncodedTransform)return void R.warning("browser not support audio encoded transform");if(KE.has(e))return;const n={track:e.track,onMetadata:t.onMetadata};if(Ha()){if(!e.createEncodedStreams)return void R.warning("browser not support createEncodedStreams() API");TR(Ot.CHROME,87,116)||(t.enableTopn=!1);let s=null;try{s=e.createEncodedStreams()}catch(d){return void R.error("create audio-encoded-streams error",d&&d.message)}const c=new TransformStream({transform(d,h){n.controller||(n.controller=h),e.track&&e.track.id!==n.track.id&&(R.debug("audio track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",o),n.track=e.track,n.track.addEventListener("ended",o)),t.enableTopn?function(p,m,g){var E;const y=bj(new DataView(m.data));if(!y)return g.enqueue(m);const T=p.track.id;aoe.set(T,p.track);const P=(E=y.tlv.find(Q=>Q.tag===Ya.AUDIO_LEVEL))===null||E===void 0?void 0:E.value;let I=0;typeof P=="number"&&(I=127-P);const A=Math.round(Math.pow(10,I/60)-1),{selected:M,speaker:U}=function(Q,J){let X=ph.get(Q);if(X||(X=function(ne){const oe=new Aj;return ph.set(ne,oe),Cs||(Cs=new ooe(H("TOPN_SILENCE_THRESHOLD")||500),Cs.on("ActiveSpeakerChanged",me=>{me!=null&&(HE=me)})),Cs.addSpeakers([oe]),oe}(Q)),ph.size<=Nj)return{selected:!0,speaker:X};if(!Cs)throw new Error("no active speaker detector");return Cs.levelChanged(X.id,J),ud=Cs.loudest.map(ne=>ne.id),HE&&!Ee(ud).call(ud,HE)&&ud.length>=Nj&&ud.pop(),{selected:Ee(ud).call(ud,X.id)||X.id===HE,speaker:X}}(p,A),Y=function(Q,J,X){const ne=bs.get(Q)||new soe(Q,J);return ne.score=X,bs.set(Q,ne),function(oe){if(GE.set(oe,!0),!zE)return void(zE=Date.now());const me=Date.now();me-zE>1e3&&(GE.get(oe)?GE.set(oe,!1):(Oj(oe),GE.delete(oe)),zE=me)}(Q),ne}(T,p.track,U.energyScore);Y.addSample(M),Y.active&&(m.data=y.frame.buffer,g.enqueue(m))}(e,d,h):t.enableMetadata?function(p,m,g){const E=bj(new DataView(p.data));if(!E)return m.enqueue(p);const y=E.tlv.find(T=>T.tag===Ya.METADATA||T.tag===Ya.AUDIO_64_BIT_PTS);y&&g&&y.value instanceof Uint8Array&&g(y.value),p.data=E.frame.buffer,m.enqueue(p)}(d,h,t.onMetadata):h.enqueue(d)}});s.readable.pipeThrough(c).pipeTo(s.writable)}else if(gr()){if(typeof RTCRtpScriptTransform>"u")return void R.warning("browser not support RTCRtpScriptTransform");const s=VE(),c=new MessageChannel;await new ye(h=>s.onmessage=p=>{p.data==="registered"&&h(void 0)});const d=new RTCRtpScriptTransform(s,{name:"audio-metadata-rx",port:c.port2},[c.port2]);e.transform=d,await new ye(h=>s.onmessage=p=>{p.data==="started"&&h(void 0)}),c.port1.onmessage=h=>{var p;h.data.transformed&&e.track&&((p=e.track)===null||p===void 0?void 0:p.id)!==n.track.id?(R.debug("audio track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",o),n.track=e.track,n.track.addEventListener("ended",o)):h.data.metadata&&n.onMetadata&&n.onMetadata(h.data.metadata)},n.worker=s}function o(){e.track.removeEventListener("ended",o),function(s){const c=KE.get(s);if(c){(function(p){const m=ph.get(p);m&&(ph.delete(p),Cs&&(Cs.removeSpeakers([m]),ph.size===0&&(Cs.destroy(),Cs=null)))})(s),Oj(s.track.id),KE.delete(s);try{var d,h;(d=c.controller)===null||d===void 0||d.terminate(),(h=c.worker)===null||h===void 0||h.terminate()}catch(p){R.warning(p&&p.message)}}}(e)}KE.set(e,n),e.track.addEventListener("ended",o)},interceptLocalVideoFrame:async function(e,t){if(!Rt().supportWebRTCEncodedTransform)return void R.warning("browser not support video encoded transform");if(YE.has(e)||!e.track)return;const n={track:e.track};if(Ha()){if(!e.createEncodedStreams)return void R.warning("browser not support createEncodedStreams() API");let s=null;try{s=e.createEncodedStreams()}catch(h){return void R.error("create video-encoded-streams error",h&&h.message)}const c=[];t.on("sei-to-send",h=>{c.push(h)});const d=new TransformStream({transform(h,p){n.controller||(n.controller=p),e.track&&e.track.id!==n.track.id&&(R.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",o),n.track=e.track,n.track.addEventListener("ended",o));const m=c.shift();m&&(h.data=function(g,E){const y=function(U){const Y=U.length;let Q=[],J=0;for(;J<Y;)J+2<Y&&U[J]===0&&U[J+1]===0&&(U[J+2]===0||U[J+2]===1||U[J+2]===2||U[J+2]===3)?(Q.push(U[J],U[J+1],3,U[J+2]),J+=3):(Q.push(U[J]),J++);return new Uint8Array(Q)}(E),T=y.length,P=Math.floor(T/255),I=T%255,A=new Uint8Array(6+P+1+T+g.byteLength);A[0]=0,A[1]=0,A[2]=0,A[3]=1,A[4]=6,A[5]=101;let M=0;for(;M<P;)A[6+M]=255,M++;return A[6+M]=I,M++,A.set(y,6+M),A.set(new Uint8Array(g),6+M+T),A.buffer}(h.data,m)),p.enqueue(h)}});s.readable.pipeThrough(d).pipeTo(s.writable)}else{if(!gr())return;{if(typeof RTCRtpScriptTransform>"u")return void R.warning("browser not support RTCRtpScriptTransform");const s=VE(),c=new MessageChannel;await new ye(h=>s.onmessage=p=>{p.data==="registered"&&h(void 0)});const d=new RTCRtpScriptTransform(s,{name:"sei-tx",port:c.port2},[c.port2]);e.transform=d,await new ye(h=>s.onmessage=p=>{p.data==="started"&&h(void 0)}),t.on("sei-to-send",h=>{c.port1.postMessage({sei:h})}),c.port1.onmessage=h=>{var p;h.data.transformed&&e.track&&((p=e.track)===null||p===void 0?void 0:p.id)!==n.track.id&&(R.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",o),n.track=e.track,n.track.addEventListener("ended",o))},n.worker=s}}function o(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",o)}const s=YE.get(e);if(s){YE.delete(e);try{var c,d;(c=s.controller)===null||c===void 0||c.terminate(),(d=s.worker)===null||d===void 0||d.terminate()}catch(h){R.warning(h&&h.message)}}}YE.set(e,n),e.track.addEventListener("ended",o)},interceptRemoteVideoFrame:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Rt().supportWebRTCEncodedTransform)return void R.warning("browser not support video encoded transform");if(!e.track)return;if(Bf.has(e)){const s=Bf.get(e);return void(s&&(s.onSei=t.onSei))}const n={track:e.track,onSei:t.onSei};if(Ha()){if(!e.createEncodedStreams)return void R.warning("browser not support createEncodedStreams() API");let s=null;try{s=e.createEncodedStreams()}catch(d){return void R.error("create video-encoded-streams error",d&&d.message)}const c=new TransformStream({transform(d,h){n.controller||(n.controller=h),e.track&&e.track.id!==n.track.id&&(R.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",o),n.track=e.track,n.track.addEventListener("ended",o));const p=function(m){const g=new DataView(m.data);let E=0;for(;E+4<m.data.byteLength;){if(g.getUint8(E+0)===0&&g.getUint8(E+1)===0&&g.getUint8(E+2)===0&&g.getUint8(E+3)===1&&g.getUint8(E+4)===6){let y=E+6,T=0,P=0;for(;(P=g.getUint8(y++))===255;)T+=255;T+=P;const I=coe(m.data,y,T);return new Uint8Array(I)}E++}return null}(d);p&&n.onSei&&n.onSei(p),h.enqueue(d)}});s.readable.pipeThrough(c).pipeTo(s.writable)}else if(gr()){if(typeof RTCRtpScriptTransform>"u")return void R.warning("browser not support RTCRtpScriptTransform");const s=VE(),c=new MessageChannel;await new ye(h=>s.onmessage=p=>{p.data==="registered"&&h(void 0)});const d=new RTCRtpScriptTransform(s,{name:"sei-rx",port:c.port2},[c.port2]);e.transform=d,await new ye(h=>s.onmessage=p=>{p.data==="started"&&h(void 0)}),c.port1.onmessage=h=>{var p;h.data.transformed&&e.track&&((p=e.track)===null||p===void 0?void 0:p.id)!==n.track.id?(R.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",o),n.track=e.track,n.track.addEventListener("ended",o)):h.data.sei&&n.onSei&&n.onSei(h.data.sei)},n.worker=s}function o(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",o)}(function(s){const c=Bf.get(s);if(c){Bf.delete(s);try{var d,h;(d=c.controller)===null||d===void 0||d.terminate(),(h=c.worker)===null||h===void 0||h.terminate()}catch(p){R.warning(p&&p.message)}}})(e)}Bf.set(e,n),e.track.addEventListener("ended",o)}},bce={name:"InterceptFrame",create:()=>Cce};WR(),jt("PROCESS_ID","process-".concat(Jt(8,""),"-").concat(Jt(4,""),"-").concat(Jt(4,""),"-").concat(Jt(4,""),"-").concat(Jt(12,""))),function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(t){return void R.error("Error loading sdk config",t.message)}if(e)try{const t=JSON.parse(window.atob(e)),n=Date.now();R.debug("Loading global parameters from cache",t),Object.keys(t).forEach(o=>{if(Object.prototype.hasOwnProperty.call(cn,o)){const{value:s,expires:c}=t[o];if(c&&c<=n)return;Rs[o]=s,cn[o]=s}})}catch(t){R.error("Error loading mutableParamsCache: ".concat(e),t.message)}}(),Array.isArray(Rs.AREAS)&&Rs.AREAS.length>0&&xC(Rs.AREAS,!0);const O3=(e,t,n)=>{R.debug("setParameter key:".concat(e,", value:").concat(JSON.stringify(t))),jt(e,t,n)};Fc(Xae,!1),Fc(Qae,!1),Fc(kse,!1),Fc(lce,!1),Fc(Kae,!1),Fc(Sce,!1),Fc(Rce,!1),Fc(bce,!1);const jn=function(e){const t=new pn,n=e,o={getListeners:t.getListeners.bind(t),on:(s,c)=>(function(d,h){d===ua.SECURITY_POLICY_VIOLATION&&d4(h,!0)}(s,c),t.on.bind(t)(s,c)),addListener:t.addListener.bind(t),once:t.once.bind(t),off:t.off.bind(t),removeAllListeners:t.removeAllListeners.bind(t),emit:t.emit.bind(t),safeEmit:t.safeEmit.bind(t)};return l4(l4({},n),o)}({__TRACK_LIST__:rh,VERSION:po,BUILD:zR,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:O3,getParameter:H,getSupportedCodec:async function(){let e={audio:[],video:[]};try{let t=new RTCPeerConnection;const n=await async function(o){let s;return Rt().supportUnifiedPlan?(o.addTransceiver("video",{direction:"recvonly"}),o.addTransceiver("audio",{direction:"recvonly"}),s=(await o.createOffer()).sdp):s=(await o.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,s}(t);if(!n)return e;t.close(),t=null,e=function(o){const s={video:[],audio:[]};return o.match(/ VP8/i)&&s.video.push("VP8"),o.match(/ VP9/i)&&s.video.push("VP9"),o.match(/ AV1/i)&&s.video.push("AV1"),o.match(/ H264/i)&&s.video.push("H264"),o.match(/ H265/i)&&s.video.push("H265"),o.match(/ opus/i)&&s.audio.push("OPUS"),o.match(/ PCMU/i)&&s.audio.push("PCMU"),o.match(/ PCMA/i)&&s.audio.push("PCMA"),o.match(/ G722/i)&&s.audio.push("G722"),s}(n)}catch(t){throw new ee(j.CREATE_OFFER_FAILED,t.toString&&t.toString()).print()}return e},checkSystemRequirements:function(){const e=ke.reportApiInvoke(null,{name:Nn.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:En.TRACER});let t=!1;try{const c=window.RTCPeerConnection,d=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,h=window.WebSocket;t=!!(c&&d&&h),t&&bR()&&P2(75)&&new c().close()}catch(c){return R.error("check system requirement failed: ",c),!1}let n=!1;const o=wt();o.name===Ot.CHROME&&Number(o.version)>=58&&(Ts.engine.name!=="WebKit"||function(){const c=wt();if(wE()){if(c.os===Xn.MAC_OS)return!0;if(c.os===Xn.IOS){const d=Ts.os.version&&Ts.os.version.split(".");if(d&&Number(d[0])===14&&d[1]&&Number(d[1])>=3||d&&Number(d[0])>14)return!0}}return!1}())&&(n=!0),(o.name===Ot.FIREFOX&&Number(o.version)>=56||o.name===Ot.OPERA&&Number(o.version)>=45||o.name===Ot.SAFARI&&Number(o.version)>=11||o.name==="WebKit"&&(Jr()||Yo())&&o.osVersion&&Number(o.osVersion.split(".")[0])>=11||U2()||wt().name===Ot.QQ)&&(n=!0),R.debug("checkSystemRequirements, api:",t,"browser",n);const s=t&&n;return e.onSuccess(s),s},getDevices:function(e){return eo.enumerateDevices(!0,!0,e)},getMicrophones:function(e){return eo.getRecordingDevices(e)},getCameras:function(e){return eo.getCamerasDevices(e)},getElectronScreenSources:PM,getPlaybackDevices:function(e){return eo.getSpeakers(e)},createClient:function(){var e;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const n=Jt(5,"client-"),o=ke.reportApiInvoke(null,{id:n,name:Nn.CREATE_CLIENT,options:[t],tag:En.TRACER});try{(function(s){Kn(s.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),Kn(s.mode,"config.mode",["rtc","live","p2p"]),s.audioCodec!==void 0&&Kn(s.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),s.proxyServer!==void 0&&ar(s.proxyServer,"config.proxyServer",1,1e4),s.turnServer!==void 0&&z2(s.turnServer),s.httpRetryConfig!==void 0&&G2(s.httpRetryConfig),s.websocketRetryConfig!==void 0&&G2(s.websocketRetryConfig)})(t)}catch(s){throw o.onError(s),s}return(k2(16,0)||x2(16,0))&&(t.codec==="vp9"&&(t.codec="vp8",R.debug("browser not support vp9, force use vp8")),jt("UNSUPPORTED_VIDEO_CODEC",["vp9"])),t.audioCodec===void 0&&(t.audioCodec="opus"),o.onSuccess(),new xse(rs(rs({forceWaitGatewayResponse:!0},t),{},{role:Ee(e=["rtc","p2p"]).call(e,t.mode)?"host":t.role||"audience"}),n)},createCameraVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=H("CAMERA_CAPTURE_CONFIG"),n=Jt(8,"track-cam-"),o=ke.reportApiInvoke(null,{id:n,tag:En.TRACER,name:Nn.CREATE_CAM_VIDEO_TRACK,options:[un({},e),t]});t&&(e.encoderConfig=t);const s=jE(e);let c=null;R.info("start create camera video track with config",JSON.stringify(e),"trackId",n);try{c=(await Zi({video:s},n)).getVideoTracks()[0]||null}catch(h){throw o.onError(h),h}if(!c){const h=new re(j.UNEXPECTED_ERROR,"can not find track in media stream");return o.onError(h),h.throw(R)}if(e.optimizationMode&&cC(n,c,e,$o(e.encoderConfig)),H("USE_STANDARD_BITRATE_DEFAULT")){const h=$o(e.encoderConfig);e.encoderConfig=h,delete h.bitrateMax,delete h.bitrateMin}const d=new aC(c,e,s,e.scalabiltyMode?xE(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,n);return o.onSuccess(d.getTrackId()),R.info("create camera video success, trackId:",n),d},createCustomVideoTrack:function(e){const t=Jt(8,"track-cus-"),n=ke.reportApiInvoke(null,{id:t,tag:En.TRACER,name:Nn.CREATE_CUSTOM_VIDEO_TRACK,options:[e]});H("USE_STANDARD_BITRATE_DEFAULT")&&(delete e.bitrateMax,delete e.bitrateMin);const o=new nn(e.mediaStreamTrack,{width:e.width,height:e.height,frameRate:e.frameRate,bitrateMax:e.bitrateMax,bitrateMin:e.bitrateMin},e.scalabiltyMode?xE(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,t,[Gt.CUSTOM_TRACK]);return n.onSuccess(o.getTrackId()),R.info("create custom video track success with config",e,"trackId",o.getTrackId()),o},createScreenVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable";const n=typeof t=="object"?function(y){return BM(y)}(t):void 0;n&&(t="auto");const o=Jt(8,"track-scr-v-"),s=ke.reportApiInvoke(null,{id:o,tag:En.TRACER,name:Nn.CREATE_SCREEN_VIDEO_TRACK,options:[un({},e),t]});e.encoderConfig?typeof e.encoderConfig=="string"||e.encoderConfig.width&&e.encoderConfig.height||(e.encoderConfig.width={max:1920},e.encoderConfig.height={max:1080}):e.encoderConfig="1080p_2";const c=function(y){const T={};y.screenSourceType&&(T.mediaSource=y.screenSourceType),y.extensionId&&Ha()&&(T.extensionId=y.extensionId);const{displaySurface:P,selfBrowserSurface:I,surfaceSwitching:A,systemAudio:M,preferCurrentTab:U}=y;(Nf(107)||wR(107)||RR(93))&&(P&&(Kn(P,"displaySurface",["browser","window","monitor"]),T.displaySurface=P),I?(Kn(I,"selfBrowserSurface",["exclude","include"]),T.selfBrowserSurface=I):T.selfBrowserSurface="include",A&&(Kn(A,"surfaceSwitching",["exclude","include"]),T.surfaceSwitching=A)),(Nf(105)||wR(105)||RR(91))&&M&&(Kn(M,"systemAudio",["exclude","include"]),T.systemAudio=M),(Nf(94)||wR(94)||RR(80))&&U&&(T.preferCurrentTab=!0),y.electronScreenSourceId&&(T.sourceId=y.electronScreenSourceId);const Y=y.encoderConfig?$R(y.encoderConfig):null;return T.mandatory={chromeMediaSource:"desktop",maxWidth:Y?Y.width:void 0,maxHeight:Y?Y.height:void 0},Y&&(Y.frameRate&&(typeof Y.frameRate=="number"?(T.mandatory.maxFrameRate=Y.frameRate,T.mandatory.minFrameRate=Y.frameRate):(T.mandatory.maxFrameRate=Y.frameRate.max||Y.frameRate.ideal||Y.frameRate.exact||void 0,T.mandatory.minFrameRate=Y.frameRate.min||Y.frameRate.ideal||Y.frameRate.exact||void 0),T.frameRate=Y.frameRate),Y.width&&(T.width=Y.width),Y.height&&(T.height=Y.height)),T}(e);let d=null,h=null;const p=Rt();if(!p.supportShareAudio&&t==="enable"){const y=new re(j.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return s.onError(y),y.throw(R)}R.info("start create screen video track with config",e,"withAudio",t,"trackId",o);const m=p.supportShareAudio&&t!=="disable";try{const y=await Zi({screen:c,screenAudio:m?n||!0:void 0},o);d=y.getVideoTracks()[0]||null,h=y.getAudioTracks()[0]||null}catch(y){throw s.onError(y),y}if(!d){const y=new re(j.UNEXPECTED_ERROR,"can not find track in media stream");return s.onError(y),y.throw(R)}if(!h&&t==="enable"){d&&d.stop();const y=new re(j.SHARE_AUDIO_NOT_ALLOWED);return s.onError(y),y.throw(R)}e.optimizationMode||(e.optimizationMode="detail"),e.optimizationMode&&(cC(o,d,e,e.encoderConfig&&$R(e.encoderConfig)||void 0),e.encoderConfig&&typeof e.encoderConfig!="string"&&(e.encoderConfig.bitrateMin=e.encoderConfig.bitrateMax));const g=new nn(d,e.encoderConfig?$R(e.encoderConfig):{},e.scalabiltyMode?xE(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,o,[Gt.SCREEN_TRACK]);if(!h)return s.onSuccess(g.getTrackId()),R.info("create screen video track success","video:",g.getTrackId()),g;const E=new Sn(h,void 0,Jt(8,"track-scr-a-"),!1);return s.onSuccess([g.getTrackId(),E.getTrackId()]),R.info("create screen video track success","video:",g.getTrackId(),"audio:",E.getTrackId()),[g,E]},createMicrophoneAndCameraTracks:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=H("CAMERA_CAPTURE_CONFIG"),o=Jt(8,"track-mic-"),s=Jt(8,"track-cam-"),c=ke.reportApiInvoke(null,{id:"".concat(o,"-").concat(s),tag:En.TRACER,name:Nn.CREATE_MIC_AND_CAM_TRACKS,options:[e,t,n]});n&&(t.encoderConfig=n);const d=jE(t),h=WM(e);let p=null,m=null;R.info("start create camera video track(".concat(s,") and microphone audio track(").concat(o,") with config, audio: ").concat(JSON.stringify(e),", video: ").concat(JSON.stringify(t)));try{const y=await Zi({audio:h,video:d},"".concat(o,"-").concat(s));p=y.getAudioTracks()[0],m=y.getVideoTracks()[0]}catch(y){throw c.onError(y),y}if(!p||!m){const y=new re(j.UNEXPECTED_ERROR,"can not find tracks in media stream");return c.onError(y),y.throw(R)}if(t.optimizationMode&&cC(s,m,t,$o(t.encoderConfig)),H("USE_STANDARD_BITRATE_DEFAULT")){const y=$o(t.encoderConfig);t.encoderConfig=y,delete y.bitrateMax,delete y.bitrateMin}const g=new Ff(p,e,h,o),E=new aC(m,t,d,t.scalabiltyMode?xE(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,s);return c.onSuccess([g.getTrackId(),E.getTrackId()]),R.info("create camera video track(".concat(s,") and microphone audio track(").concat(o,") success")),[g,E]},createMicrophoneAudioTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=Jt(8,"track-mic-"),n=ke.reportApiInvoke(null,{id:t,tag:En.TRACER,name:Nn.CREATE_MIC_AUDIO_TRACK,options:[e]}),o=WM(e);let s=null;R.info("start create microphone audio track with config",JSON.stringify(e),"trackId",t);try{s=(await Zi({audio:o},t)).getAudioTracks()[0]||null}catch(d){throw n.onError(d),d}if(!s){const d=new re(j.UNEXPECTED_ERROR,"can not find track in media stream");return n.onError(d),d.throw(R)}const c=new Ff(s,e,o,t);return n.onSuccess(c.getTrackId()),R.info("create microphone audio track success, trackId:",t),c},createCustomAudioTrack:function(e){const t=Jt(8,"track-cus-"),n=ke.reportApiInvoke(null,{id:t,tag:En.TRACER,name:Nn.CREATE_CUSTOM_AUDIO_TRACK,options:[e]}),o=new Sn(e.mediaStreamTrack,e.encoderConfig?LE(e.encoderConfig):{},t,!1);return R.info("create custom audio track success with config",e,"trackId",o.getTrackId()),n.onSuccess(o.getTrackId()),o},createBufferSourceAudioTrack:async function(e){var t;const{cacheOnlineFile:n,encoderConfig:o}=e;let{source:s}=e;const c={source:s instanceof AudioBuffer?"AudioBuffer":s instanceof File?(t=File.name)!==null&&t!==void 0?t:"File":s,cacheOnlineFile:n,encoderConfig:o},d=Jt(8,"track-buf-"),h=ke.reportApiInvoke(null,{id:d,tag:En.TRACER,name:Nn.CREATE_BUFFER_AUDIO_TRACK,options:[c]});if(H("DISABLE_WEBAUDIO"))throw new re(j.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");R.info("start create buffer source audio track with config",JSON.stringify(c),"trackId",d);const p=s;if(!(s instanceof AudioBuffer))try{s=await async function(E,y){let T=null;if(typeof E=="string"){const I=AU.get(E);if(I)return R.debug("use cached audio resource: ",E),I;try{T=(await ws(()=>oi.get(E,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(A){throw new re(j.FETCH_AUDIO_FILE_FAILED,A.toString())}}else T=await new ye((A,M)=>{const U=new FileReader;U.onload=Y=>{Y.target?A(Y.target.result):M(new re(j.READ_LOCAL_AUDIO_FILE_ERROR))},U.onerror=()=>{M(new re(j.READ_LOCAL_AUDIO_FILE_ERROR))},U.readAsArrayBuffer(E)});const P=await function(I){const A=lh();return new ye((M,U)=>{A.decodeAudioData(I,Y=>{M(Y)},Y=>{U(new re(j.DECODE_AUDIO_FILE_FAILED,Y.toString()))})})}(T);return typeof E=="string"&&y&&AU.set(E,P),P}(s,n)}catch(E){return h.onError(E),E.throw(R)}const m=new eoe(s),g=new Zie(p,m,o?LE(o):{},d);return R.info("create buffer source audio track success, trackId:",d),h.onSuccess(g.getTrackId()),g},setAppType:function(e){if(R.debug("setAppType: ".concat(e)),!(Number.isInteger(e)&&e>=0))throw R.debug("Invalid appType"),new ee(j.INVALID_PARAMS,"invalid app type",e);jt("APP_TYPE",Math.floor(e))},setLogLevel:function(e){R.setLogLevel(e)},enableLogUpload:function(){H("USE_NEW_LOG")?jt("UPLOAD_LOG",!0):R.enableLogUpload()},disableLogUpload:function(){H("USE_NEW_LOG")?jt("UPLOAD_LOG",!1):R.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new NV},checkAudioTrackIsActive:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const n=ke.reportApiInvoke(null,{tag:En.TRACER,name:Nn.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof Sn||e instanceof hh)){const p=new ee(j.INVALID_TRACK,"the parameter is not a audio track");return n.onError(p),p.throw()}t&&t<1e3&&(t=1e3);const o=e instanceof Sn?e.getTrackLabel():"remote_track",s=e.getVolumeLevel();let c=s,d=s;const h=Date.now();return new ye(p=>{const m=setInterval(()=>{const g=e.getVolumeLevel();c=g>c?g:c,d=g<d?g:d;const E=c-d>1e-4,y=Date.now()-h;if(E||y>t){clearInterval(m);const T=E,P={duration:y,deviceLabel:o,maxVolumeLevel:c,result:T};R.info("[track-".concat(e.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(P))),n.onSuccess(P),p(T)}},200)})},checkVideoTrackIsActive:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const n=ke.reportApiInvoke(null,{tag:En.TRACER,name:Nn.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof nn||e instanceof uh)){const E=new ee(j.INVALID_TRACK,"the parameter is not a video track");return n.onError(E),E.throw()}t&&t<1e3&&(t=1e3);const o=e instanceof nn?e.getTrackLabel():"remote_track",s=e.getMediaStreamTrack(!0),c=document.createElement("video");c.style.width="1px",c.style.height="1px",c.setAttribute("muted",""),c.muted=!0,c.setAttribute("playsinline",""),c.controls=!1,(gr()||wE())&&(c.style.opacity="0.01",c.style.position="fixed",c.style.left="0",c.style.top="0",document.body.appendChild(c)),c.srcObject=new MediaStream([s]),c.play();const d=document.createElement("canvas");d.width=160,d.height=120;let h=0,p=0;try{const E=Date.now();h=await function(y,T,P,I){let A,M=0,U=null;return new ye((Y,Q)=>{function J(){M>I&&A&&(A(),Y(M));const X=P.getContext("2d");if(!X){const me=new ee(j.UNEXPECTED_ERROR,"can not get canvas 2d context.");return R.error(me.toString()),void Q(me)}X.drawImage(y,0,0,160,120);const ne=X.getImageData(0,0,P.width,P.height),oe=Math.floor(ne.data.length/3);if(U){for(let me=0;me<oe;me+=3)if(ne.data[me]!==U[me])return M+=1,void(U=ne.data);U=ne.data}else U=ne.data}setTimeout(()=>{A&&(A(),Y(M))},T),A=tC(()=>{J()},30)})}(c,t,d,4),p=Date.now()-E}catch(E){throw n.onError(E),E}yse===Ot.SAFARI&&(c.pause(),c.remove()),c.srcObject=null;const m=h>4,g={duration:p,changedPicNum:h,deviceLabel:o,result:m};return R.info("[track-".concat(e.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(g))),n.onSuccess(g),m},setArea:xC,audioElementPlayCenter:si,resumeAudioContext:function(){si.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(e){Mse.processExternalMediaAEC(e)},registerExtensions:function(e){const t=H("PLUGIN_INFO")||[];e.forEach(n=>{"name"in n&&!Ee(t).call(t,n.name)&&t.push(n.name);const o=n;o.__registered__=!0,o.logger.hookLog=R.extLog,o.reporter.hookApiInvoke=ke.extApiInvoke,o.parameters&&Object.keys(o.parameters).forEach(s=>{o.parameters[s]=H(s)})}),O3("PLUGIN_INFO",t)},ChannelMediaRelayError:mh,ChannelMediaRelayEvent:Xa,ChannelMediaRelayState:Ei,RemoteStreamFallbackType:Kie,RemoteStreamType:zie,ConnectionDisconnectedReason:Dt,AudienceLatencyLevelType:Tie,AREAS:Pt,preload:async function(e,t,n,o){return eF(e,t,n,o)}});return Object.defineProperties(jn,{onAudioAutoplayFailed:{get:()=>to.onAudioAutoplayFailed,set:e=>{to.onAudioAutoplayFailed=e}},onAutoplayFailed:{get:()=>to.onAutoplayFailed,set:e=>{to.onAutoplayFailed=e}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>jn._onSecurityPolicyViolation,set(e){jn._onSecurityPolicyViolation=e,d4(e)}},__CLIENT_LIST__:{get:()=>H("SHOW_GLOBAL_CLIENT_LIST")?hd:[]}}),eo.on(cd.CAMERA_DEVICE_CHANGED,e=>{R.info("camera device changed",JSON.stringify(e)),jn.onCameraChanged&&jn.onCameraChanged(e),jn.safeEmit(ua.CAMERA_CHANGED,e)}),eo.on(cd.RECORDING_DEVICE_CHANGED,e=>{R.info("microphone device changed",JSON.stringify(e)),jn.onMicrophoneChanged&&jn.onMicrophoneChanged(e),jn.safeEmit(ua.MICROPHONE_CHANGED,e)}),eo.on(cd.PLAYOUT_DEVICE_CHANGED,e=>{R.debug("playout device changed",JSON.stringify(e)),jn.onPlaybackDeviceChanged&&jn.onPlaybackDeviceChanged(e),jn.safeEmit(ua.PLAYBACK_DEVICE_CHANGED,e)}),si.onAutoplayFailed=()=>{R.info("detect audio element autoplay failed"),to.onAudioAutoplayFailed&&to.onAudioAutoplayFailed()},Vt.on("autoplay-failed",()=>{R.info("detect webaudio autoplay failed"),to.onAudioAutoplayFailed&&to.onAudioAutoplayFailed(),jn.safeEmit(ua.AUTOPLAY_FAILED)}),Vt.on(dr.STATE_CHANGE,(e,t)=>{R.info("audio context state changed: ".concat(t," => ").concat(e)),jn.onAudioContextStateChanged&&jn.onAudioContextStateChanged(e,t),jn.safeEmit(ua.AUDIO_CONTEXT_STATE_CHANGED,e,t)}),On.on(Ju.NETWORK_STATE_CHANGE,(e,t)=>{R.info("[network-indicator] network state changed, ".concat(t," => ").concat(e))}),window&&(window.__ARTC__=jn),jn})})(Z7);var D0e=Z7.exports;const Vm=KA(D0e),k0e=()=>{var st;const[r,i]=k.useState([]),[a,l]=k.useState(!0),[u,f]=k.useState(!1),[_,v]=k.useState(!1),[w,C]=k.useState(!1),[N,D]=k.useState("1"),[O,G]=k.useState(null),[F,V]=k.useState(0),L=k.useRef(null),[B,W]=k.useState(null),[z,$]=k.useState(null),[te,ie]=k.useState({}),[ce,pe]=k.useState(!1),{AppId:Pe,ChannelName:_e,PatientImage:ge,PatientName:fe}=Gg();k.useEffect(()=>{const ze=Vm.createClient({mode:"rtc",codec:"vp8"});return L.current=ze,Vm.setLogLevel(4),(async()=>{try{console.log("Joining channel with AppId:",Pe,"ChannelName:",_e);const dt=await ze.join(Pe,_e,null,null);console.log("Joined channel with UID:",dt);const[at,Fe]=await Vm.createMicrophoneAndCameraTracks();at.setEnabled(!1),Fe.setEnabled(!1),W(at),$(Fe),await ze.publish([at,Fe]),console.log("Published local tracks"),i([{id:dt,name:localStorage.getItem("fullName"),isSelf:!0,isMuted:a,isVideoOn:u,videoTrack:Fe,audioTrack:at,imageURL:localStorage.getItem("imageURL")}]),ze.enableAudioVolumeIndicator(),ze.on("volume-indicator",Ke=>{if(Ke.length===0)return;const et=5,nt=[...Ke].sort((It,an)=>an.level-It.level);if(nt[0]&&nt[0].level>et){const It=String(nt[0].uid);console.log("Active speaker detected:",It,"level:",nt[0].level),D(It)}else nt.every(It=>It.level<=et)&&D(null);const bt={};Ke.forEach(It=>{bt[String(It.uid)]=Math.min(100,Math.round(It.level*1.2))}),ie(bt)}),ze.on("user-joined",Ke=>{console.log("User joined:",Ke.uid),i(et=>et.find(nt=>nt.id===Ke.uid)?et:[...et,{id:Ke.uid,name:fe||"",isSelf:!1,isMuted:!0,isVideoOn:!1,videoTrack:null,audioTrack:null,imageURL:ge||""}])}),ze.on("user-published",async(Ke,et)=>{await ze.subscribe(Ke,et),console.log("Subscribed to",et,"track from user",Ke.uid),et==="audio"&&Ke.audioTrack&&Ke.audioTrack.play(),i(nt=>{var It;if(nt.find(an=>an.id===Ke.uid))return nt.map(an=>{var kr;if(an.id===Ke.uid){const fi={...an,name:an.name||localStorage.getItem("fullName")};return et==="video"&&(fi.videoTrack=Ke.videoTrack,fi.isVideoOn=!0),et==="audio"&&(fi.audioTrack=Ke.audioTrack,fi.isMuted=!1,(kr=Ke.audioTrack)==null||kr.play()),fi}return an});{const an={id:Ke.uid,name:localStorage.getItem("fullName"),isSelf:!1,isMuted:et!=="audio",isVideoOn:et==="video",videoTrack:et==="video"?Ke.videoTrack:null,audioTrack:et==="audio"?Ke.audioTrack:null,imageURL:ge};return et==="audio"&&((It=Ke.audioTrack)==null||It.play()),[...nt,an]}})}),ze.on("user-unpublished",(Ke,et)=>{et==="video"&&i(nt=>nt.map(bt=>bt.id===Ke.uid?{...bt,videoTrack:null,isVideoOn:!1}:bt)),et==="audio"&&i(nt=>nt.map(bt=>bt.id===Ke.uid?{...bt,audioTrack:null,isMuted:!0}:bt))}),ze.on("user-left",Ke=>{console.log("User left:",Ke.uid),i(et=>et.filter(nt=>nt.id!==Ke.uid)),D(et=>et===String(Ke.uid)?null:et)}),it.success("Connected to call"),pe(!0)}catch(dt){console.error("Failed to join channel",dt),it.error("Failed to connect to call")}})(),C(!0),()=>{L.current&&(L.current.off("active-speaker"),L.current.off("volume-indicator"),L.current.removeAllListeners(),L.current.leave().then(()=>{console.log("Client left channel")}).catch(dt=>{console.error("Error leaving channel:",dt)})),B&&(B.stop(),B.close()),z&&(z.stop(),z.close())}},[Pe,_e]),k.useEffect(()=>{const ze=setInterval(()=>{V(ht=>ht+1)},1e3);return()=>clearInterval(ze)},[]);const xe=ze=>{const ht=Math.floor(ze/3600),dt=Math.floor(ze%3600/60),at=ze%60;return`${ht.toString().padStart(2,"0")}:${dt.toString().padStart(2,"0")}:${at.toString().padStart(2,"0")}`},be=()=>{B&&(B.enabled?B.setEnabled(!1):B.setEnabled(!0)),l(!a),i(ze=>ze.map(ht=>ht.isSelf?{...ht,isMuted:!a}:ht)),it(a?"Microphone turned on":"Microphone muted")},ft=()=>{z&&(z.enabled?z.setEnabled(!1):z.setEnabled(!0)),f(!u),i(ze=>ze.map(ht=>ht.isSelf?{...ht,isVideoOn:!u}:ht)),it(u?"Camera turned off":"Camera turned on")},je=async()=>{var ze,ht,dt,at;if(_)try{const Fe=await Vm.createCameraVideoTrack();z&&await((dt=L.current)==null?void 0:dt.unpublish(z)),await((at=L.current)==null?void 0:at.publish(Fe)),$(Fe),v(!1),it("Screen sharing stopped")}catch(Fe){console.error("Failed to stop screen sharing",Fe),it.error("Failed to stop screen sharing")}else try{const Fe=await Vm.createScreenVideoTrack({encoderConfig:{width:1920,height:1080,frameRate:30,bitrateMax:1e3}},"disable");z&&await((ze=L.current)==null?void 0:ze.unpublish(z)),await((ht=L.current)==null?void 0:ht.publish(Fe)),$(Fe),v(!0),it("Screen sharing started")}catch(Fe){console.error("Failed to start screen sharing",Fe),it.error("Failed to start screen sharing")}},Ge=()=>{var ht;const ze=(ht=r.find(dt=>dt.isSelf))==null?void 0:ht.id;O===ze?(G(null),it("Your video unpinned")):(G(ze||null),it("Your video pinned"))},le=ze=>{if(O===ze)G(null),it("Video unpinned");else{G(ze);const ht=r.find(dt=>dt.id===ze);it(`${ht==null?void 0:ht.name}'s video pinned`)}},Le=async()=>{if(!L.current){window.location.href="/home";return}if(!_e){window.location.href="/home";return}B&&(B.stop(),B.close()),z&&(z.stop(),z.close());try{await Cr.post(`/api/calls/${_e}/end`)}catch(ze){console.error("Error ending call",ze)}L.current&&L.current.leave(),W(null),$(null),pe(!1),window.location.href="/home"},Xe=((st=r.find(ze=>ze.isSelf))==null?void 0:st.id)===O;return S.jsxs("div",{className:`flex flex-col h-screen bg-gray-950 text-[#93C5FD] transition-opacity duration-500 ${w?"opacity-100":"opacity-0"}`,children:[S.jsx(P0e,{callTitle:"Team Weekly Sync",participantCount:r.length,duration:xe(F)}),S.jsxs("div",{className:"flex flex-1 overflow-hidden",children:[S.jsx(A0e,{participants:r,activeSpeakerId:N,isScreenSharing:_,selfVideoEnabled:u,pinnedParticipantId:O,onTogglePin:le,className:"flex-1"}),S.jsx(O0e,{participants:r,activeSpeakerId:N,pinnedParticipantId:O,onTogglePin:le})]}),S.jsx(N0e,{isMuted:a,isVideoOn:u,isScreenSharing:_,isPinned:Xe,onToggleMute:be,onToggleVideo:ft,onToggleScreenShare:je,onTogglePin:Ge,onLeaveCall:Le})]})},x0e=new pme,L0e=()=>S.jsx(mme,{client:x0e,children:S.jsxs(oc,{children:[S.jsx(pge,{children:S.jsx(NEe,{children:S.jsx(I0e,{children:S.jsx(sge,{children:S.jsxs(To,{element:S.jsxs(S.Fragment,{children:[S.jsx(xEe,{}),S.jsx(ige,{})]}),children:[S.jsx(To,{path:"/",element:S.jsx(LEe,{})}),S.jsx(To,{path:"/signup",element:S.jsx(tye,{})}),S.jsx(To,{path:"/login",element:S.jsx(wye,{})}),S.jsx(To,{path:"/home",element:S.jsx(FSe,{})}),S.jsx(To,{path:"/Profile",element:S.jsx(YSe,{})}),S.jsx(To,{path:"/Brother",element:S.jsx($Se,{})}),S.jsx(To,{path:"/history",element:S.jsx(ZSe,{})}),S.jsx(To,{path:"/notifications",element:S.jsx(m0e,{})}),S.jsx(To,{path:"/translation",element:S.jsx(R0e,{})}),S.jsx(To,{path:"/VideoCallScreen",element:S.jsx(k0e,{})}),S.jsx(To,{path:"*",element:S.jsx(e0e,{})})]})})})})}),S.jsx(Hhe,{}),S.jsx(Epe,{})]})});OW(document.getElementById("root")).render(S.jsx(L0e,{}));
